/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "_content/Syncfusion.Blazor/scripts/";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./bundles/sf-documenteditor.js");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./bundles/sf-documenteditor.js":
/*!**************************************!*\
  !*** ./bundles/sf-documenteditor.js ***!
  \**************************************/
/*! no exports provided */
/*! all exports used */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _modules_sf_documenteditor_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../modules/sf-documenteditor.js */ "./modules/sf-documenteditor.js");
/* harmony import */ var _modules_sf_documenteditor_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_modules_sf_documenteditor_js__WEBPACK_IMPORTED_MODULE_0__);


/***/ }),

/***/ "./modules/sf-documenteditor.js":
/*!**************************************!*\
  !*** ./modules/sf-documenteditor.js ***!
  \**************************************/
/*! no static exports found */
/***/ (function(module, exports) {

function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj;};}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};}return _typeof(obj);}window.sfBlazor=window.sfBlazor||{};window.sfBlazor.DocumentEditor=function(){'use strict';/**
 * Document Editor container component.
 */var SfDocumentEditorContainer=/** @class */function(){/**
     * Gets toolbar instance.
     * @blazorType Toolbar
     */ // public get toolbar(): Toolbar {
//     return this.toolbarModule;
// }
/**
     * Initialize the constructor of DocumentEditorContainer
     */function SfDocumentEditorContainer(element,options,editorOptions,dotnetRef){/**
         * @private
         */this.previousContext='';/**
         * @private
         */ // public characterFormat: CharacterFormatProperties;
/**
         * @private
         */ // public paragraphFormat: ParagraphFormatProperties;
// /**
//  * @private
//  */
// public sectionFormat: SectionFormatProperties;
/**
         * @private
         */this.showHeaderProperties=true;// debugger;        
this.element=element;if(sf.base.isNullOrUndefined(element)){return;}if(!sf.base.isNullOrUndefined(element)){this.element.blazor__instance=this;}this.dotNetRef=dotnetRef;this.element=element;this.options=options;this.editorOptions=editorOptions;this.updateOptions(options);}Object.defineProperty(SfDocumentEditorContainer.prototype,"documentEditor",{/**
         * Gets DocumentEditor instance.
         * @aspType DocumentEditor
         * @blazorType DocumentEditor
         */get:function get(){return this.documentEditorInternal;},enumerable:true,configurable:true});SfDocumentEditorContainer.prototype.updateOptions=function(options){// debugger;
this.showPropertiesPane=options.showPropertiesPane;this.currentUser=options.currentUser;this.enableComment=options.enableComment;this.enableLocalPaste=options.enableLocalPaste;this.enableSpellCheck=options.enableSpellCheck;this.enableTrackChanges=options.enableTrackChanges;// this.headers = options.headers;
this.height=options.height;this.serviceUrl=options.serviceUrl;this.userColor=options.userColor;this.width=options.width;this.zIndex=options.zIndex;// this.layoutType = options.layoutType;
this.requiredModules();};SfDocumentEditorContainer.prototype.setOptions=function(newOptions,options){for(var _i=0,_a=Object.keys(newOptions);_i<_a.length;_i++){var prop=_a[_i];var value=newOptions[prop];if(!sf.base.isNullOrUndefined(value)){switch(prop){case"zoomFactor":this.documentEditor.zoomFactor=value;this.documentEditor.onPropertyChanged({"zoomFactor":value},null);break;case"layoutType":// this.layoutType = value;
this.documentEditor.layoutType=value;this.documentEditor.onPropertyChanged({"layoutType":value},null);break;case"enableTrackChanges":this.enableTrackChanges=value;this.documentEditor.enableTrackChanges=value;this.documentEditor.showRevisions=value;this.documentEditor.onPropertyChanged({"enableTrackChanges":value},null);this.documentEditor.onPropertyChanged({"showRevisions":value},null);break;case"restrictEditing":this.restrictEditing=value;this.documentEditor.isReadOnly=value;this.documentEditor.onPropertyChanged({"isReadOnly":value},null);break;case"enableLocalPaste":this.enableLocalPaste=value;this.documentEditor.enableLocalPaste=value;this.documentEditor.onPropertyChanged({"enableLocalPaste":value},null);break;}}}};/**
     * @private
     */SfDocumentEditorContainer.prototype.getModuleName=function(){return'DocumentEditorContainer';};/**
     * @private
     */ // tslint:disable:max-func-body-length
SfDocumentEditorContainer.prototype.onPropertyChanged=function(newModel,oldModel){for(var _i=0,_a=Object.keys(newModel);_i<_a.length;_i++){var prop=_a[_i];switch(prop){case'restrictEditing':this.documentEditor.isReadOnly=newModel.restrictEditing;break;case'showPropertiesPane':this.showHidePropertiesPane(newModel.showPropertiesPane);break;case'enableTrackChanges':if(this.documentEditor){this.documentEditor.enableTrackChanges=newModel.enableTrackChanges;this.documentEditor.showRevisions=newModel.enableTrackChanges;this.documentEditor.resize();}break;case'enableLocalPaste':if(this.documentEditor){this.documentEditor.enableLocalPaste=newModel.enableLocalPaste;}break;case'serviceUrl':if(this.documentEditor){this.documentEditor.serviceUrl=newModel.serviceUrl;}break;case'serverActionSettings':if(this.documentEditor){this.setserverActionSettings();}break;case'zIndex':if(this.documentEditor){this.documentEditor.zIndex=newModel.zIndex;}break;case'headers':// if (this.documentEditor) {
//     this.documentEditor.headers = newModel.headers;
// }
break;case'locale':case'enableRtl':// this.refresh();
break;case'enableComment':if(this.documentEditor){this.documentEditor.enableComment=newModel.enableComment;}// if (this.toolbarModule) {
//     this.toolbarModule.enableDisableInsertComment(newModel.enableComment);
// }
break;case'enableSpellCheck':if(this.documentEditor){this.documentEditor.enableSpellCheck=newModel.enableSpellCheck;}break;case'documentEditorSettings':if(this.documentEditor){this.customizeDocumentEditorSettings();}break;case'toolbarItems':// if (this.toolbarModule) {
//     this.toolbarModule.reInitToolbarItems(newModel.toolbarItems);
// }
break;case'currentUser':if(this.documentEditor){this.documentEditor.currentUser=newModel.currentUser;}break;case'userColor':if(this.documentEditor){this.documentEditor.userColor=newModel.userColor;}break;case'layoutType':if(this.documentEditor){this.documentEditor.layoutType=newModel.layoutType;}break;case'enableToolbar':if(this.documentEditor){this.documentEditor.resize();}break;case'height':var calcHeight='';if(this.height.indexOf('%')!==-1){calcHeight=window.innerHeight*(parseInt(this.height)/100)+'px';}else{calcHeight=sf.base.formatUnit(this.height);}this.element.style.height=calcHeight;if(this.documentEditor){this.documentEditor.resize();}break;case'width':this.element.style.width=sf.base.formatUnit(this.width);if(this.documentEditor){this.documentEditor.resize();}break;}}};/**
     * @private
     */SfDocumentEditorContainer.prototype.preRender=function(element){var calcHeight='';if(this.height.indexOf('%')!==-1){calcHeight=window.innerHeight*(parseInt(this.height)/100)+'px';}else{calcHeight=sf.base.formatUnit(this.height);}this.element.style.height=calcHeight;if(this.width!==''){this.element.style.width=sf.base.formatUnit(this.width);}this.element.style.minHeight='320px';};/**
     * @private
     */SfDocumentEditorContainer.prototype.render=function(element){this.initializeDocumentEditor(element);this.setserverActionSettings();this.customizeDocumentEditorSettings();};SfDocumentEditorContainer.prototype.setFormat=function(){};SfDocumentEditorContainer.prototype.setserverActionSettings=function(){};SfDocumentEditorContainer.prototype.customizeDocumentEditorSettings=function(){};/**
     * @private
     */SfDocumentEditorContainer.prototype.getPersistData=function(){return'documenteditor-container';};//tslint:disable: max-func-body-length
SfDocumentEditorContainer.prototype.requiredModules=function(){var modules=[];if(this.enableToolbar){modules.push({member:'toolbar',args:[this]});}return modules;};SfDocumentEditorContainer.prototype.initializeDocumentEditor=function(element){var documentEditorTarget=element;this.documentEditorInternal=element.blazor__instance;//(this.element as HTMLElement).appendChild(documentEditorTarget);
//this.documentEditorInternal = new SfDocumentEditor(documentEditorTarget, this.dotNetRef, this.editorOptions);
sf.base.EventHandler.add(documentEditorTarget,'selectionChange',this.onSelectionChange,this);this.documentEditor.enableAllModules();this.documentEditor.enableComment=this.enableComment;// this.editorContainer.insertBefore(documentEditorTarget, this.editorContainer.firstChild);
this.setFormat();// this.documentEditor.appendTo(documentEditorTarget);
this.documentEditor.resize();};/**
     * @private
     */SfDocumentEditorContainer.prototype.showHidePropertiesPane=function(show){if(this.showPropertiesPane){this.showPropertiesPaneOnSelection();}//this.propertiesPaneContainer.style.display = show ? 'block' : 'none';
// if (this.toolbarModule) {
//     this.toolbarModule.propertiesPaneButton.element.style.opacity = show ? '1' : '0.5';
// }
this.documentEditor.resize();};/**
     * Resizes the container component and its sub elements based on given size or client size.
     * @param width
     * @param height
     */SfDocumentEditorContainer.prototype.resize=function(width,height){//Since we have syncfusion licensing element wrapped around the container element we have taken element.parentElement.paraentElement
if(this.element){if(sf.base.isNullOrUndefined(height)&&this.element&&this.element.parentElement.parentElement){height=this.element.parentElement.parentElement.clientHeight;}if(sf.base.isNullOrUndefined(width)&&this.element&&this.element.parentElement.parentElement){width=this.element.parentElement.parentElement.clientWidth;}if(!sf.base.isNullOrUndefined(width)&&width>200){this.width=width.toString();this.element.style.width=width+'px';}if(!sf.base.isNullOrUndefined(height)&&height>200){this.height=height.toString();this.element.style.height=height+'px';}if(this.documentEditor){this.documentEditor.resize();}}};/**
     * @private
     */SfDocumentEditorContainer.prototype.onContentChange=function(){};/**
     * @private
     */SfDocumentEditorContainer.prototype.onDocumentChange=function(){this.enableTrackChanges=this.documentEditor.enableTrackChanges;};/**
     * @private
     */SfDocumentEditorContainer.prototype.onSelectionChange=function(){this.showPropertiesPaneOnSelection();};/**
     * @private
     */SfDocumentEditorContainer.prototype.showPropertiesPaneOnSelection=function(){var currentContext=this.documentEditor.selection.contextType;var isInHeaderFooter=currentContext.indexOf('Header')>=0||currentContext.indexOf('Footer')>=0;if(!isInHeaderFooter){this.showHeaderProperties=true;}if(!this.showPropertiesPane){this.showHidePropertiesPane(false);// this.propertiesPaneContainer.style.display = 'none';
}else{//this.propertiesPaneContainer.style.display = 'block';
if(isInHeaderFooter&&this.showHeaderProperties){this.showProperties('headerfooter');}else if(currentContext.indexOf('List')>=0||currentContext.indexOf('Text')>=0&&currentContext.indexOf('Table')<0){this.showProperties('text');}else if(currentContext.indexOf('Image')>=0){this.showProperties('image');}else if(currentContext.indexOf('TableOfContents')>=0){this.showProperties('toc');}else if(currentContext.indexOf('Table')>=0){this.showProperties('table');}}this.previousContext=this.documentEditor.selection.contextType;};/**
     * @private
     * @param property
     */SfDocumentEditorContainer.prototype.showProperties=function(property){this.textProperties.showTextProperties(property==='text');this.tableProperties.showTableProperties(property==='table');this.imageProperties.showImageProperties(property==='image');this.headerFooterProperties.showHeaderFooterPane(property==='headerfooter');this.tocProperties.showTocPane(property==='toc');};/**
     * Destroys all managed resources used by this object.
     */SfDocumentEditorContainer.prototype.destroy=function(){// super.destroy();
// if (this.element) {
//     this.element.classList.remove('e-documenteditorcontainer');
//     this.element.innerHTML = '';
// }
// if (!this.refreshing) {
//     this.element = undefined;
// }
// if (this.toolbarContainer && this.toolbarContainer.parentElement) {
//     this.toolbarContainer.innerHTML = '';
//     this.toolbarContainer.parentElement.removeChild(this.toolbarContainer);
// }
// this.toolbarContainer = undefined;
// if (this.documentEditorInternal) {
//     this.documentEditorInternal.destroy();
// }
// this.documentEditorInternal = undefined;
// if (this.textProperties) {
//     this.textProperties.destroy();
// }
// this.textProperties = undefined;
// if (this.headerFooterProperties) {
//     this.headerFooterProperties.destroy();
// }
// this.headerFooterProperties = undefined;
// if (this.imageProperties) {
//     this.imageProperties.destroy();
// }
// this.imageProperties = undefined;
// if (this.tocProperties) {
//     this.tocProperties.destroy();
// }
// this.tocProperties = undefined;
// if (this.tableProperties) {
//     this.tableProperties.destroy();
// }
// this.tableProperties = undefined;
// if (this.statusBar) {
//     this.statusBar.destroy();
// }
if(this.propertiesPaneContainer&&this.editorContainer.parentElement){this.propertiesPaneContainer.innerHTML='';this.propertiesPaneContainer.parentElement.removeChild(this.propertiesPaneContainer);}this.propertiesPaneContainer=undefined;if(this.editorContainer&&this.editorContainer.parentElement){this.editorContainer.innerHTML='';this.editorContainer.parentElement.removeChild(this.editorContainer);}if(this.statusBarElement&&this.statusBarElement.parentElement){this.statusBarElement.innerHTML='';this.statusBarElement.parentElement.removeChild(this.statusBarElement);}if(this.containerTarget&&this.containerTarget.parentElement){this.containerTarget.innerHTML='';this.containerTarget.parentElement.removeChild(this.containerTarget);}this.containerTarget=undefined;this.statusBarElement=undefined;this.editorContainer=undefined;};return SfDocumentEditorContainer;}();/**
 * Print class
 */var Print=/** @class */function(){function Print(){}Print.prototype.getModuleName=function(){return'Print';};/**
     * Prints the current viewer
     *
     * @private
     * @param {DocumentHelper} documentHelper - Specifies the document helper.
     * @param {Window} printWindow - Specifies the print window.
     * @returns {void}
     */Print.prototype.print=function(documentHelper,printWindow){this.printWindow(documentHelper,navigator.userAgent,printWindow);};/**
     * Opens print window and displays current page to print.
     *
     * @private
     * @param {DocumentHelper} documentHelper - Specifies the document helper.
     * @param {string} browserUserAgent - Specifies the browser user agent.
     * @param {Window} printWindow - Specifies the print window.
     * @returns {void}
     */Print.prototype.printWindow=function(documentHelper,browserUserAgent,printWindow){var height=this.getPageHeight(documentHelper.pages);var width=this.getPageWidth(documentHelper.pages);var printElement=document.createElement('div');printElement.style.width='100%';printElement.style.height='100%';printElement.style.overflow='scroll';// Rendering canvas to print
this.generatePrintContent(documentHelper,printElement);if(sf.base.isNullOrUndefined(printWindow)){printWindow=window.open('','print','height=452,width=1024,tabbar=no');}if(browserUserAgent.indexOf('Chrome')!==-1||browserUserAgent.indexOf('Firefox')!==-1){// Chrome and Firefox
printWindow.document.write('<!DOCTYPE html>');printWindow.document.write('<html moznomarginboxes mozdisallowselectionprint><head><style>html, body { height: 100 %; } img { height: 100 %; width: 100 %; display: block;}img { box-sizing: border-box; }br, button { display: none; }@page{ margin: 0cm; size:'+width.toString()+'px '+height.toString()+'px; }@media print{ body { margin: 0cm; }</style></head> <body><center>');}else{// Internet Explorer and Edge
printWindow.document.write('<html><head><style>@page{margin:0;size:'+width.toString()+'px '+height.toString()+'px;}</style></head><body><center>');}printWindow.document.write(printElement.innerHTML+'</center><script> (function() { window.ready = true; })(); </script></body></html>');printElement=undefined;printWindow.document.close();printWindow.focus();var interval=setInterval(function(){// eslint-disable-next-line
if(printWindow.ready){printWindow.print();printWindow.close();clearInterval(interval);}},500);};/**
     * Generate Document Image.
     * @private
     */Print.prototype.generateDoumentImages=function(documentHelper,pageNumber){var image;if(!sf.base.isNullOrUndefined(pageNumber)&&pageNumber<=documentHelper.pages.length&&pageNumber>=1){var printPage=documentHelper.pages[pageNumber-1];var pageHeight=printPage.boundingRectangle.height;var pageWidth=printPage.boundingRectangle.width;documentHelper.render.isPrinting=true;documentHelper.render.renderWidgets(printPage,0,0,0,0);var canvasURL=documentHelper.render.pageCanvas.toDataURL();documentHelper.render.isPrinting=false;image=new Image();image.src=canvasURL;// tslint:disable-next-line:max-line-length
image.setAttribute('style','margin:0px;display:block;width:'+pageWidth.toString()+'px;height:'+pageHeight.toString()+'px;');}return image;};/**
     * Generates print content.
     *
     * @private
     * @param {DocumentHelper} documentHelper - Specifies the document helper.
     * @param {HTMLDivElement} element - Specifies the element.
     * @returns {void}
     */Print.prototype.generatePrintContent=function(documentHelper,element){// Rendering canvas to print
var htmlString='';for(var i=0;i<documentHelper.pages.length;i++){var page=documentHelper.pages[i];var pageHeight=page.boundingRectangle.height;var pageWidth=page.boundingRectangle.width;documentHelper.render.isPrinting=true;documentHelper.render.renderWidgets(page,0,0,0,0);var canvasURL=documentHelper.render.pageCanvas.toDataURL();documentHelper.render.isPrinting=false;htmlString+='<div><img src='+canvasURL+' style="margin:0px;display:block;width: '+pageWidth.toString()+'px; height:'+pageHeight.toString()+'px; "/></div><br/>';}element.innerHTML=htmlString;};/**
     * Gets page width.
     *
     * @private
     * @param {Page} pages - Specifies the pages.
     * @returns {number} - Returns the page width.
     */Print.prototype.getPageWidth=function(pages){var width=0;for(var i=0;i<pages.length;i++){if(width<pages[i].boundingRectangle.width){width=pages[i].boundingRectangle.width;}}return width;};/**
     * Gets page height.
     *
     * @private
     * @param {Page} pages - Specifies the pages.
     * @returns {number} - Returns the page height.
     */Print.prototype.getPageHeight=function(pages){var height=0;for(var i=0;i<pages.length;i++){if(height<pages[i].boundingRectangle.height){height=pages[i].boundingRectangle.height;}}return height;};/**
     * @private
     * @returns {void}
     */Print.prototype.destroy=function(){return;};return Print;}();/* eslint-disable */ /**
 * @private
 */var Dictionary=/** @class */function(){function Dictionary(){this.keysInternal=[];this.valuesInternal=[];}Object.defineProperty(Dictionary.prototype,"length",{/**
         * @private
         */get:function get(){return this.keysInternal.length;},enumerable:true,configurable:true});Object.defineProperty(Dictionary.prototype,"keys",{/**
         * @private
         */get:function get(){return this.keysInternal;},enumerable:true,configurable:true});/**
     * @private
     */Dictionary.prototype.add=function(key,value){if(sf.base.isNullOrUndefined(key)){throw new ReferenceError('Provided key or value is not valid.');}var index=this.keysInternal.indexOf(key);// if (index < 0 || index > this.keysInternal.length - 1) {
if(index<0){this.keysInternal.push(key);this.valuesInternal.push(value);}return 1;// else {
//     throw new RangeError('An item with the same key has already been added.');
// }
};/**
     * @private
     */Dictionary.prototype.get=function(key){if(sf.base.isNullOrUndefined(key)){throw new ReferenceError('Provided key is not valid.');}var index=this.keysInternal.indexOf(key);if(index<0||index>this.keysInternal.length-1){return undefined;//throw new RangeError('No item with the specified key has been added.');
}else{return this.valuesInternal[index];}};/**
     * @private
     */Dictionary.prototype.set=function(key,value){if(sf.base.isNullOrUndefined(key)){throw new ReferenceError('Provided key is not valid.');}var index=this.keysInternal.indexOf(key);if(index<0||index>this.keysInternal.length-1){throw new RangeError('No item with the specified key has been added.');}else{this.valuesInternal[index]=value;}};/**
     * @private
     */Dictionary.prototype.remove=function(key){if(sf.base.isNullOrUndefined(key)){throw new ReferenceError('Provided key is not valid.');}var index=this.keysInternal.indexOf(key);if(index<0||index>this.keysInternal.length-1){throw new RangeError('No item with the specified key has been added.');}else{this.keysInternal.splice(index,1);this.valuesInternal.splice(index,1);return true;}};/**
     * @private
     */Dictionary.prototype.containsKey=function(key){if(sf.base.isNullOrUndefined(key)){throw new ReferenceError('Provided key is not valid.');}var index=this.keysInternal.indexOf(key);if(index<0||index>this.keysInternal.length-1){return false;}return true;};/**
     * @private
     */Dictionary.prototype.clear=function(){this.keysInternal=[];this.valuesInternal=[];};/**
     * @private
     */Dictionary.prototype.destroy=function(){this.clear();this.keysInternal=undefined;this.valuesInternal=undefined;};return Dictionary;}();/* eslint-disable */ /**
 * @private
 */var WUniqueFormat=/** @class */function(){function WUniqueFormat(type){this.referenceCount=0;this.uniqueFormatType=type;this.propertiesHash=new Dictionary();}/**
     * @private
     */WUniqueFormat.prototype.isEqual=function(source,property,modifiedValue){var isEqual=false;switch(this.uniqueFormatType){case 1:isEqual=this.isBorderEqual(source,property,modifiedValue);break;case 2:isEqual=this.isCharacterFormatEqual(source,property,modifiedValue);break;case 3:isEqual=this.isParagraphFormatEqual(source,property,modifiedValue);break;case 4:isEqual=this.isCellFormatEqual(source,property,modifiedValue);break;case 5:isEqual=this.isShadingEqual(source,property,modifiedValue);break;case 6:isEqual=this.isRowFormatEqual(source,property,modifiedValue);break;case 7:isEqual=this.isListFormatEqual(source,property,modifiedValue);break;case 8:isEqual=this.isTableFormatEqual(source,property,modifiedValue);break;case 9:isEqual=this.isListLevelEqual(source,property,modifiedValue);break;case 10:isEqual=this.isSectionFormatEqual(source,property,modifiedValue);break;default:break;}return isEqual;};WUniqueFormat.prototype.isNotEqual=function(property,source,modifiedProperty,modifiedValue,uniqueFormatType){var targetValue=undefined;var propertyType=WUniqueFormat.getPropertyType(uniqueFormatType,property);if(this.propertiesHash.containsKey(propertyType)){targetValue=this.propertiesHash.get(propertyType);}var sourceValue=undefined;if(property===modifiedProperty){sourceValue=modifiedValue;}else if(source.containsKey(propertyType)){sourceValue=source.get(propertyType);}if(!(targetValue===sourceValue||!sf.base.isNullOrUndefined(targetValue)&&!sf.base.isNullOrUndefined(sourceValue)&&targetValue===sourceValue)){return true;}return false;};/**
     * @private
     */WUniqueFormat.getPropertyType=function(uniqueFormatType,property){var type=0;switch(uniqueFormatType){case 1:type=this.getBorderPropertyType(property);break;case 2:type=this.getCharacterFormatPropertyType(property);break;case 3:type=this.getParaFormatPropertyType(property);break;case 4:type=this.getCellFormatPropertyType(property);break;case 5:type=this.getShadingPropertyType(property);break;case 6:type=this.getRowFormatType(property);break;case 7:type=this.getListFormatType(property);break;case 8:type=this.getTableFormatType(property);break;case 9:type=this.getListLevelType(property);break;case 10:type=this.getSectionFormatType(property);break;default:break;}return type;};WUniqueFormat.getRowFormatType=function(property){if(property==='allowBreakAcrossPages'){return 1;}if(property==='isHeader'){return 2;}if(property==='height'){return 3;}if(property==='heightType'){return 4;}if(property==='gridBefore'){return 5;}if(property==='gridBeforeWidth'){return 6;}if(property==='gridBeforeWidthType'){return 7;}if(property==='gridAfter'){return 8;}if(property==='gridAfterWidth'){return 9;}if(property==='gridAfterWidthType'){return 10;}if(property==='leftMargin'){return 11;}if(property==='topMargin'){return 12;}if(property==='bottomMargin'){return 13;}if(property==='rightMargin'){return 14;}if(property==='leftIndent'){return 15;}return 0;};WUniqueFormat.getListFormatType=function(property){if(property==='listId'){return 1;}if(property==='listLevelNumber'){return 2;}return 0;};WUniqueFormat.getTableFormatType=function(property){if(property==='leftMargin'){return 1;}if(property==='rightMargin'){return 2;}if(property==='topMargin'){return 3;}if(property==='bottomMargin'){return 4;}if(property==='cellSpacing'){return 5;}if(property==='leftIndent'){return 6;}if(property==='tableAlignment'){return 7;}if(property==='preferredWidth'){return 8;}if(property==='preferredWidthType'){return 9;}if(property==='bidi'){return 10;}if(property==='allowAutoFit'){return 11;}if(property==='horizontalPositionAbs'){return 12;}if(property==='horizontalPosition'){return 13;}return 0;};WUniqueFormat.getListLevelType=function(property){if(property==='listLevelPattern'){return 1;}if(property==='startAt'){return 2;}if(property==='followCharacter'){return 3;}if(property==='numberFormat'){return 4;}if(property==='restartLevel'){return 5;}return 0;};WUniqueFormat.getShadingPropertyType=function(property){if(property==='backgroundColor'){return 1;}if(property==='foregroundColor'){return 2;}if(property==='textureStyle'){return 3;}return 0;};WUniqueFormat.getCellFormatPropertyType=function(property){if(property==='leftMargin'){return 1;}if(property==='rightMargin'){return 2;}if(property==='topMargin'){return 3;}if(property==='bottomMargin'){return 4;}if(property==='columnSpan'){return 5;}if(property==='rowSpan'){return 6;}if(property==='verticalAlignment'){return 7;}if(property==='preferredWidthType'){return 8;}if(property==='preferredWidth'){return 9;}if(property==='cellWidth'){return 10;}return 0;};WUniqueFormat.getBorderPropertyType=function(property){if(property==='color'){return 1;}if(property==='lineStyle'){return 2;}if(property==='lineWidth'){return 3;}if(property==='shadow'){return 4;}if(property==='space'){return 5;}if(property==='hasNoneStyle'){return 6;}return 0;};WUniqueFormat.getCharacterFormatPropertyType=function(property){if(property==='fontColor'){return 1;}if(property==='fontFamily'){return 2;}if(property==='fontSize'){return 3;}if(property==='bold'){return 4;}if(property==='italic'){return 5;}if(property==='underline'){return 6;}if(property==='strikethrough'){return 7;}if(property==='baselineAlignment'){return 8;}if(property==='highlightColor'){return 9;}if(property==='bidi'){return 10;}if(property==='bdo'){return 11;}if(property==='boldBidi'){return 12;}if(property==='italicBidi'){return 13;}if(property==='fontFamilyBidi'){return 14;}if(property==='fontSizeBidi'){return 15;}if(property==='allCaps'){return 16;}return 0;};WUniqueFormat.getParaFormatPropertyType=function(property){if(property==='leftIndent'){return 1;}if(property==='rightIndent'){return 2;}if(property==='firstLineIndent'){return 3;}if(property==='textAlignment'){return 4;}if(property==='beforeSpacing'){return 5;}if(property==='afterSpacing'){return 6;}if(property==='lineSpacing'){return 7;}if(property==='lineSpacingType'){return 8;}if(property==='outlineLevel'){return 9;}if(property==='bidi'){return 10;}if(property==='contextualSpacing'){return 11;}if(property==='keepWithNext'){return 12;}if(property==='keepLinesTogether'){return 13;}if(property==='widowControl'){return 14;}return 0;};WUniqueFormat.getSectionFormatType=function(property){if(property==='headerDistance'){return 1;}if(property==='footerDistance'){return 2;}if(property==='differentFirstPage'){return 3;}if(property==='differentOddAndEvenPages'){return 4;}if(property==='pageWidth'){return 5;}if(property==='pageHeight'){return 6;}if(property==='leftMargin'){return 7;}if(property==='topMargin'){return 8;}if(property==='rightMargin'){return 9;}if(property==='bottomMargin'){return 10;}if(property==='bidi'){return 11;}if(property==='restartPageNumbering'){return 12;}if(property==='pageStartingNumber'){return 13;}if(property==='endnoteNumberFormat'){return 14;}if(property==='endnotePosition'){return 15;}if(property==='footNoteNumberFormat'){return 16;}if(property==='footnotePosition'){return 17;}if(property==='restartIndexForEndnotes'){return 18;}if(property==='restartIndexForFootnotes'){return 19;}if(property==='initialFootNoteNumber'){return 20;}if(property==='initialEndNoteNumber'){return 21;}return 0;};/**
     * @private
     */WUniqueFormat.prototype.isBorderEqual=function(source,modifiedProperty,modifiedValue){if(this.isNotEqual('color',source,modifiedProperty,modifiedValue,1)){return false;}if(this.isNotEqual('lineStyle',source,modifiedProperty,modifiedValue,1)){return false;}if(this.isNotEqual('lineWidth',source,modifiedProperty,modifiedValue,1)){return false;}if(this.isNotEqual('shadow',source,modifiedProperty,modifiedValue,1)){return false;}if(this.isNotEqual('space',source,modifiedProperty,modifiedValue,1)){return false;}if(this.isNotEqual('hasNoneStyle',source,modifiedProperty,modifiedValue,1)){return false;}return true;};/**
     * @private
     */WUniqueFormat.prototype.isCharacterFormatEqual=function(source,modifiedProperty,modifiedValue){if(this.isNotEqual('fontColor',source,modifiedProperty,modifiedValue,2)){return false;}if(this.isNotEqual('fontFamily',source,modifiedProperty,modifiedValue,2)){return false;}if(this.isNotEqual('fontSize',source,modifiedProperty,modifiedValue,2)){return false;}if(this.isNotEqual('bold',source,modifiedProperty,modifiedValue,2)){return false;}if(this.isNotEqual('italic',source,modifiedProperty,modifiedValue,2)){return false;}if(this.isNotEqual('underline',source,modifiedProperty,modifiedValue,2)){return false;}if(this.isNotEqual('strikethrough',source,modifiedProperty,modifiedValue,2)){return false;}if(this.isNotEqual('baselineAlignment',source,modifiedProperty,modifiedValue,2)){return false;}if(this.isNotEqual('highlightColor',source,modifiedProperty,modifiedValue,2)){return false;}if(this.isNotEqual('bidi',source,modifiedProperty,modifiedValue,2)){return false;}if(this.isNotEqual('bdo',source,modifiedProperty,modifiedValue,2)){return false;}if(this.isNotEqual('fontColor',source,modifiedProperty,modifiedValue,2)){return false;}if(this.isNotEqual('fontFamilyBidi',source,modifiedProperty,modifiedValue,2)){return false;}if(this.isNotEqual('fontSizeBidi',source,modifiedProperty,modifiedValue,2)){return false;}if(this.isNotEqual('boldBidi',source,modifiedProperty,modifiedValue,2)){return false;}if(this.isNotEqual('italicBidi',source,modifiedProperty,modifiedValue,2)){return false;}if(this.isNotEqual('allCaps',source,modifiedProperty,modifiedValue,2)){return false;}return true;};WUniqueFormat.prototype.isParagraphFormatEqual=function(source,modifiedProperty,modifiedValue){if(this.isNotEqual('leftIndent',source,modifiedProperty,modifiedValue,3)){return false;}if(this.isNotEqual('rightIndent',source,modifiedProperty,modifiedValue,3)){return false;}if(this.isNotEqual('firstLineIndent',source,modifiedProperty,modifiedValue,3)){return false;}if(this.isNotEqual('textAlignment',source,modifiedProperty,modifiedValue,3)){return false;}if(this.isNotEqual('beforeSpacing',source,modifiedProperty,modifiedValue,3)){return false;}if(this.isNotEqual('afterSpacing',source,modifiedProperty,modifiedValue,3)){return false;}if(this.isNotEqual('lineSpacing',source,modifiedProperty,modifiedValue,3)){return false;}if(this.isNotEqual('lineSpacingType',source,modifiedProperty,modifiedValue,3)){return false;}if(this.isNotEqual('outlineLevel',source,modifiedProperty,modifiedValue,3)){return false;}if(this.isNotEqual('bidi',source,modifiedProperty,modifiedValue,3)){return false;}if(this.isNotEqual('contextualSpacing',source,modifiedProperty,modifiedValue,3)){return false;}if(this.isNotEqual('keepWithNext',source,modifiedProperty,modifiedValue,3)){return false;}if(this.isNotEqual('keepLinesTogether',source,modifiedProperty,modifiedValue,3)){return false;}if(this.isNotEqual('widowControl',source,modifiedProperty,modifiedValue,3)){return false;}return true;};/**
     * @private
     */WUniqueFormat.prototype.isCellFormatEqual=function(source,modifiedProperty,modifiedValue){if(this.isNotEqual('leftMargin',source,modifiedProperty,modifiedValue,4)){return false;}if(this.isNotEqual('rightMargin',source,modifiedProperty,modifiedValue,4)){return false;}if(this.isNotEqual('topMargin',source,modifiedProperty,modifiedValue,4)){return false;}if(this.isNotEqual('bottomMargin',source,modifiedProperty,modifiedValue,4)){return false;}if(this.isNotEqual('columnSpan',source,modifiedProperty,modifiedValue,4)){return false;}if(this.isNotEqual('rowSpan',source,modifiedProperty,modifiedValue,4)){return false;}if(this.isNotEqual('verticalAlignment',source,modifiedProperty,modifiedValue,4)){return false;}if(this.isNotEqual('preferredWidthType',source,modifiedProperty,modifiedValue,4)){return false;}if(this.isNotEqual('preferredWidth',source,modifiedProperty,modifiedValue,4)){return false;}if(this.isNotEqual('cellWidth',source,modifiedProperty,modifiedValue,4)){return false;}return true;};/**
     * @private
     */WUniqueFormat.prototype.isShadingEqual=function(source,modifiedProperty,modifiedValue){if(this.isNotEqual('backgroundColor',source,modifiedProperty,modifiedValue,5)){return false;}if(this.isNotEqual('foregroundColor',source,modifiedProperty,modifiedValue,5)){return false;}if(this.isNotEqual('textureStyle',source,modifiedProperty,modifiedValue,5)){return false;}return true;};/**
     * @private
     */WUniqueFormat.prototype.isRowFormatEqual=function(source,modifiedProperty,modifiedValue){if(this.isNotEqual('allowBreakAcrossPages',source,modifiedProperty,modifiedValue,6)){return false;}if(this.isNotEqual('isHeader',source,modifiedProperty,modifiedValue,6)){return false;}if(this.isNotEqual('height',source,modifiedProperty,modifiedValue,6)){return false;}if(this.isNotEqual('heightType',source,modifiedProperty,modifiedValue,6)){return false;}if(this.isNotEqual('gridBefore',source,modifiedProperty,modifiedValue,6)){return false;}if(this.isNotEqual('gridBeforeWidth',source,modifiedProperty,modifiedValue,6)){return false;}if(this.isNotEqual('gridBeforeWidthType',source,modifiedProperty,modifiedValue,6)){return false;}if(this.isNotEqual('gridAfter',source,modifiedProperty,modifiedValue,6)){return false;}if(this.isNotEqual('gridAfterWidth',source,modifiedProperty,modifiedValue,6)){return false;}if(this.isNotEqual('gridAfterWidthType',source,modifiedProperty,modifiedValue,6)){return false;}if(this.isNotEqual('leftMargin',source,modifiedProperty,modifiedValue,6)){return false;}if(this.isNotEqual('topMargin',source,modifiedProperty,modifiedValue,6)){return false;}if(this.isNotEqual('bottomMargin',source,modifiedProperty,modifiedValue,6)){return false;}if(this.isNotEqual('rightMargin',source,modifiedProperty,modifiedValue,6)){return false;}if(this.isNotEqual('leftIndent',source,modifiedProperty,modifiedValue,6)){return false;}return true;};/**
     * @private
     */WUniqueFormat.prototype.isListFormatEqual=function(source,modifiedProperty,modifiedValue){if(this.isNotEqual('listId',source,modifiedProperty,modifiedValue,7)){return false;}if(this.isNotEqual('listLevelNumber',source,modifiedProperty,modifiedValue,7)){return false;}return true;};/**
     * @private
     */WUniqueFormat.prototype.isTableFormatEqual=function(source,modifiedProperty,modifiedValue){if(this.isNotEqual('leftMargin',source,modifiedProperty,modifiedValue,8)){return false;}if(this.isNotEqual('rightMargin',source,modifiedProperty,modifiedValue,8)){return false;}if(this.isNotEqual('topMargin',source,modifiedProperty,modifiedValue,8)){return false;}if(this.isNotEqual('bottomMargin',source,modifiedProperty,modifiedValue,8)){return false;}if(this.isNotEqual('cellSpacing',source,modifiedProperty,modifiedValue,8)){return false;}if(this.isNotEqual('leftIndent',source,modifiedProperty,modifiedValue,8)){return false;}if(this.isNotEqual('tableAlignment',source,modifiedProperty,modifiedValue,8)){return false;}if(this.isNotEqual('preferredWidth',source,modifiedProperty,modifiedValue,8)){return false;}if(this.isNotEqual('preferredWidthType',source,modifiedProperty,modifiedValue,8)){return false;}if(this.isNotEqual('bidi',source,modifiedProperty,modifiedValue,8)){return false;}if(this.isNotEqual('allowAutoFit',source,modifiedProperty,modifiedValue,8)){return false;}if(this.isNotEqual('horizontalPositionAbs',source,modifiedProperty,modifiedValue,8)){return false;}if(this.isNotEqual('horizontalPosition',source,modifiedProperty,modifiedValue,8)){return false;}return true;};/**
     * @private
     */WUniqueFormat.prototype.isListLevelEqual=function(source,modifiedProperty,modifiedValue){if(this.isNotEqual('listLevelPattern',source,modifiedProperty,modifiedValue,9)){return false;}if(this.isNotEqual('startAt',source,modifiedProperty,modifiedValue,9)){return false;}if(this.isNotEqual('followCharacter',source,modifiedProperty,modifiedValue,9)){return false;}if(this.isNotEqual('numberFormat',source,modifiedProperty,modifiedValue,9)){return false;}if(this.isNotEqual('restartLevel',source,modifiedProperty,modifiedValue,9)){return false;}return true;};/**
     * @private
     */WUniqueFormat.prototype.isSectionFormatEqual=function(source,modifiedProperty,modifiedValue){if(this.isNotEqual('headerDistance',source,modifiedProperty,modifiedValue,10)){return false;}if(this.isNotEqual('footerDistance',source,modifiedProperty,modifiedValue,10)){return false;}if(this.isNotEqual('differentFirstPage',source,modifiedProperty,modifiedValue,10)){return false;}if(this.isNotEqual('differentOddAndEvenPages',source,modifiedProperty,modifiedValue,10)){return false;}if(this.isNotEqual('pageWidth',source,modifiedProperty,modifiedValue,10)){return false;}if(this.isNotEqual('pageHeight',source,modifiedProperty,modifiedValue,10)){return false;}if(this.isNotEqual('leftMargin',source,modifiedProperty,modifiedValue,10)){return false;}if(this.isNotEqual('topMargin',source,modifiedProperty,modifiedValue,10)){return false;}if(this.isNotEqual('rightMargin',source,modifiedProperty,modifiedValue,10)){return false;}if(this.isNotEqual('bottomMargin',source,modifiedProperty,modifiedValue,10)){return false;}if(this.isNotEqual('bidi',source,modifiedProperty,modifiedValue,10)){return false;}if(this.isNotEqual('restartPageNumbering',source,modifiedProperty,modifiedValue,10)){return false;}if(this.isNotEqual('pageStartingNumber',source,modifiedProperty,modifiedValue,10)){return false;}if(this.isNotEqual('endnoteNumberFormat',source,modifiedProperty,modifiedValue,10)){return false;}if(this.isNotEqual('endnotePosition',source,modifiedProperty,modifiedValue,10)){return false;}if(this.isNotEqual('footNoteNumberFormat',source,modifiedProperty,modifiedValue,10)){return false;}if(this.isNotEqual('footnotePosition',source,modifiedProperty,modifiedValue,10)){return false;}if(this.isNotEqual('restartIndexForEndnotes',source,modifiedProperty,modifiedValue,10)){return false;}if(this.isNotEqual('restartIndexForFootnotes',source,modifiedProperty,modifiedValue,10)){return false;}if(this.isNotEqual('initialFootNoteNumber',source,modifiedProperty,modifiedValue,10)){return false;}if(this.isNotEqual('initialEndNoteNumber',source,modifiedProperty,modifiedValue,10)){return false;}return true;};/**
     * @private
     */WUniqueFormat.prototype.cloneItems=function(format,property,value,uniqueFormatType){var propertyType=WUniqueFormat.getPropertyType(uniqueFormatType,property);var keys=format.propertiesHash.keys;for(var i=0;i<keys.length;i++){if(keys[i]===propertyType){this.propertiesHash.add(propertyType,value);}else{this.propertiesHash.add(keys[i],format.propertiesHash.get(keys[i]));}}if(!format.propertiesHash.containsKey(propertyType)){this.propertiesHash.add(propertyType,value);}};/**
     * @private
     */WUniqueFormat.prototype.mergeProperties=function(format){var hash=format.cloneProperties();var keys=this.propertiesHash.keys;for(var i=0;i<keys.length;i++){if(!hash.containsKey(keys[i])){hash.add(keys[i],this.propertiesHash.get(keys[i]));}}return hash;};/**
     * @private
     */WUniqueFormat.prototype.cloneProperties=function(){var hash=new Dictionary();var keys=this.propertiesHash.keys;for(var i=0;i<keys.length;i++){hash.add(keys[i],this.propertiesHash.get(keys[i]));}return hash;};// public cloneItemsInternal(format: WUniqueFormat): void {
//     let keys: number[] = format.propertiesHash.getItem();
//     for (let i: number = 0; i < keys.length; i++) {
//         this.propertiesHash.add(keys[i], format.propertiesHash.get(keys[i]));
//     }
//     this.referenceCount = format.referenceCount;
// }
/**
     * @private
     */WUniqueFormat.prototype.destroy=function(){if(!sf.base.isNullOrUndefined(this.propertiesHash)){this.propertiesHash.destroy();}this.propertiesHash=undefined;this.referenceCount=undefined;this.uniqueFormatType=undefined;};return WUniqueFormat;}();/* eslint-disable */ /**
 * @private
 */var WUniqueFormats=/** @class */function(){function WUniqueFormats(){this.items=[];}/**
     * @private
     */WUniqueFormats.prototype.addUniqueFormat=function(format,type){var matchedFormat=undefined;for(var i=0;i<this.items.length;i++){if(this.items[i].isEqual(format,undefined,undefined)){matchedFormat=this.items[i];break;}}if(sf.base.isNullOrUndefined(matchedFormat)){matchedFormat=new WUniqueFormat(type);matchedFormat.propertiesHash=format;matchedFormat.referenceCount=1;this.items.push(matchedFormat);}else{matchedFormat.referenceCount++;}return matchedFormat;};/**
     * @private
     */WUniqueFormats.prototype.updateUniqueFormat=function(uniqueFormat,property,value){var matchedFormat=undefined;for(var i=0;i<this.items.length;i++){if(this.items[i].isEqual(uniqueFormat.propertiesHash,property,value)){matchedFormat=this.items[i];break;}}if(sf.base.isNullOrUndefined(matchedFormat)){matchedFormat=new WUniqueFormat(uniqueFormat.uniqueFormatType);matchedFormat.cloneItems(uniqueFormat,property,value,uniqueFormat.uniqueFormatType);matchedFormat.referenceCount=1;this.items.push(matchedFormat);}else{matchedFormat.referenceCount++;}this.remove(uniqueFormat);uniqueFormat=undefined;return matchedFormat;};/**
     * @private
     */WUniqueFormats.prototype.remove=function(uniqueFormat){uniqueFormat.referenceCount--;if(uniqueFormat.referenceCount<=0){this.items.splice(this.items.indexOf(uniqueFormat),1);uniqueFormat.destroy();uniqueFormat=undefined;}};/**
     * @private
     */WUniqueFormats.prototype.clear=function(){if(sf.base.isNullOrUndefined(this.items)){for(var i=0;i<this.items.length;i++){this.items[i].destroy();}}this.items=[];};/**
     * @private
     */WUniqueFormats.prototype.destroy=function(){this.clear();this.items=undefined;};return WUniqueFormats;}();/* eslint-disable */ /**
 * @private
 */var WSectionFormat=/** @class */function(){function WSectionFormat(node){this.uniqueSectionFormat=undefined;this.ownerBase=node;}Object.defineProperty(WSectionFormat.prototype,"headerDistance",{get:function get(){return this.getPropertyValue('headerDistance');},set:function set(value){this.setPropertyValue('headerDistance',value);},enumerable:true,configurable:true});Object.defineProperty(WSectionFormat.prototype,"footerDistance",{get:function get(){return this.getPropertyValue('footerDistance');},set:function set(value){this.setPropertyValue('footerDistance',value);},enumerable:true,configurable:true});Object.defineProperty(WSectionFormat.prototype,"differentFirstPage",{get:function get(){return this.getPropertyValue('differentFirstPage');},set:function set(value){this.setPropertyValue('differentFirstPage',value);},enumerable:true,configurable:true});Object.defineProperty(WSectionFormat.prototype,"differentOddAndEvenPages",{get:function get(){return this.getPropertyValue('differentOddAndEvenPages');},set:function set(value){this.setPropertyValue('differentOddAndEvenPages',value);},enumerable:true,configurable:true});Object.defineProperty(WSectionFormat.prototype,"pageHeight",{get:function get(){return this.getPropertyValue('pageHeight');},set:function set(value){this.setPropertyValue('pageHeight',value);},enumerable:true,configurable:true});Object.defineProperty(WSectionFormat.prototype,"rightMargin",{get:function get(){return this.getPropertyValue('rightMargin');},set:function set(value){this.setPropertyValue('rightMargin',value);},enumerable:true,configurable:true});Object.defineProperty(WSectionFormat.prototype,"pageWidth",{get:function get(){return this.getPropertyValue('pageWidth');},set:function set(value){this.setPropertyValue('pageWidth',value);},enumerable:true,configurable:true});Object.defineProperty(WSectionFormat.prototype,"leftMargin",{get:function get(){return this.getPropertyValue('leftMargin');},set:function set(value){this.setPropertyValue('leftMargin',value);},enumerable:true,configurable:true});Object.defineProperty(WSectionFormat.prototype,"bottomMargin",{get:function get(){return this.getPropertyValue('bottomMargin');},set:function set(value){this.setPropertyValue('bottomMargin',value);},enumerable:true,configurable:true});Object.defineProperty(WSectionFormat.prototype,"topMargin",{get:function get(){return this.getPropertyValue('topMargin');},set:function set(value){this.setPropertyValue('topMargin',value);},enumerable:true,configurable:true});Object.defineProperty(WSectionFormat.prototype,"bidi",{get:function get(){return this.getPropertyValue('bidi');},set:function set(value){this.setPropertyValue('bidi',value);},enumerable:true,configurable:true});Object.defineProperty(WSectionFormat.prototype,"restartPageNumbering",{get:function get(){return this.getPropertyValue('restartPageNumbering');},set:function set(value){this.setPropertyValue('restartPageNumbering',value);},enumerable:true,configurable:true});Object.defineProperty(WSectionFormat.prototype,"pageStartingNumber",{get:function get(){return this.getPropertyValue('pageStartingNumber');},set:function set(value){this.setPropertyValue('pageStartingNumber',value);},enumerable:true,configurable:true});Object.defineProperty(WSectionFormat.prototype,"endnoteNumberFormat",{get:function get(){return this.getPropertyValue('endnoteNumberFormat');},set:function set(value){this.setPropertyValue('endnoteNumberFormat',value);},enumerable:true,configurable:true});Object.defineProperty(WSectionFormat.prototype,"restartIndexForEndnotes",{get:function get(){return this.getPropertyValue('restartIndexForEndnotes');},set:function set(value){this.setPropertyValue('restartIndexForEndnotes',value);},enumerable:true,configurable:true});Object.defineProperty(WSectionFormat.prototype,"restartIndexForFootnotes",{get:function get(){return this.getPropertyValue('restartIndexForFootnotes');},set:function set(value){this.setPropertyValue('restartIndexForFootnotes',value);},enumerable:true,configurable:true});Object.defineProperty(WSectionFormat.prototype,"footNoteNumberFormat",{get:function get(){return this.getPropertyValue('footNoteNumberFormat');},set:function set(value){this.setPropertyValue('footNoteNumberFormat',value);},enumerable:true,configurable:true});Object.defineProperty(WSectionFormat.prototype,"initialFootNoteNumber",{get:function get(){return this.getPropertyValue('initialFootNoteNumber');},set:function set(value){this.setPropertyValue('initialFootNoteNumber',value);},enumerable:true,configurable:true});Object.defineProperty(WSectionFormat.prototype,"initialEndNoteNumber",{get:function get(){return this.getPropertyValue('initialEndNoteNumber');},set:function set(value){this.setPropertyValue('initialEndNoteNumber',value);},enumerable:true,configurable:true});WSectionFormat.prototype.destroy=function(){if(!sf.base.isNullOrUndefined(this.uniqueSectionFormat)){WSectionFormat.uniqueSectionFormats.remove(this.uniqueSectionFormat);}this.uniqueSectionFormat=undefined;};WSectionFormat.prototype.hasValue=function(property){if(!sf.base.isNullOrUndefined(this.uniqueSectionFormat)){var propertyType=WUniqueFormat.getPropertyType(this.uniqueSectionFormat.uniqueFormatType,property);return this.uniqueSectionFormat.propertiesHash.containsKey(propertyType);}return false;};WSectionFormat.getPropertyDefaultValue=function(property){var value=undefined;switch(property){case'headerDistance':value=36;break;case'footerDistance':value=36;break;case'differentFirstPage':value=false;break;case'differentOddAndEvenPages':value=false;break;case'pageWidth':value=612;break;case'pageHeight':value=792;break;case'leftMargin':value=72;break;case'topMargin':value=72;break;case'rightMargin':value=72;break;case'bottomMargin':value=72;break;case'bidi':value=false;break;case'restartPageNumbering':value=false;break;case'pageStartingNumber':value=1;break;case'footnotePosition':value='PrintAtBottomOfPage';break;case'endnoteNumberFormat':value='LowerCaseRoman';break;case'endnotePosition':value='DisplayEndOfDocument';break;case'restartIndexForEndnotes':value='DoNotRestart';break;case'restartIndexForFootnotes':value='DoNotRestart';break;case'footNoteNumberFormat':value='Arabic';break;case'initialFootNoteNumber':value=1;break;case'initialEndNoteNumber':value=1;break;}return value;};WSectionFormat.prototype.getPropertyValue=function(property){var hasValue=this.hasValue(property);if(hasValue){var propertyType=WUniqueFormat.getPropertyType(WSectionFormat.uniqueFormatType,property);if(!sf.base.isNullOrUndefined(this.uniqueSectionFormat)&&this.uniqueSectionFormat.propertiesHash.containsKey(propertyType)){return this.uniqueSectionFormat.propertiesHash.get(propertyType);}}return WSectionFormat.getPropertyDefaultValue(property);};WSectionFormat.prototype.setPropertyValue=function(property,value){if(sf.base.isNullOrUndefined(value)||value===''){value=WSectionFormat.getPropertyDefaultValue(property);}if(sf.base.isNullOrUndefined(this.uniqueSectionFormat)){this.initializeUniqueSectionFormat(property,value);}else{var propertyType=WUniqueFormat.getPropertyType(this.uniqueSectionFormat.uniqueFormatType,property);if(this.uniqueSectionFormat.propertiesHash.containsKey(propertyType)&&this.uniqueSectionFormat.propertiesHash.get(propertyType)===value){//Do nothing, since no change in property value and return
return;}this.uniqueSectionFormat=WSectionFormat.uniqueSectionFormats.updateUniqueFormat(this.uniqueSectionFormat,property,value);}};WSectionFormat.prototype.initializeUniqueSectionFormat=function(property,propValue){var uniqueSectionFormatTemp=new Dictionary();this.addUniqueSectionFormat('headerDistance',property,propValue,uniqueSectionFormatTemp);this.addUniqueSectionFormat('footerDistance',property,propValue,uniqueSectionFormatTemp);this.addUniqueSectionFormat('differentFirstPage',property,propValue,uniqueSectionFormatTemp);this.addUniqueSectionFormat('differentOddAndEvenPages',property,propValue,uniqueSectionFormatTemp);this.addUniqueSectionFormat('pageWidth',property,propValue,uniqueSectionFormatTemp);this.addUniqueSectionFormat('pageHeight',property,propValue,uniqueSectionFormatTemp);this.addUniqueSectionFormat('leftMargin',property,propValue,uniqueSectionFormatTemp);this.addUniqueSectionFormat('topMargin',property,propValue,uniqueSectionFormatTemp);this.addUniqueSectionFormat('rightMargin',property,propValue,uniqueSectionFormatTemp);this.addUniqueSectionFormat('bottomMargin',property,propValue,uniqueSectionFormatTemp);this.addUniqueSectionFormat('bidi',property,propValue,uniqueSectionFormatTemp);this.addUniqueSectionFormat('restartPageNumbering',property,propValue,uniqueSectionFormatTemp);this.addUniqueSectionFormat('pageStartingNumber',property,propValue,uniqueSectionFormatTemp);this.addUniqueSectionFormat('endnoteNumberFormat',property,propValue,uniqueSectionFormatTemp);this.addUniqueSectionFormat('endnotePosition',property,propValue,uniqueSectionFormatTemp);this.addUniqueSectionFormat('footNoteNumberFormat',property,propValue,uniqueSectionFormatTemp);this.addUniqueSectionFormat('footnotePosition',property,propValue,uniqueSectionFormatTemp);this.addUniqueSectionFormat('restartIndexForEndnotes',property,propValue,uniqueSectionFormatTemp);this.addUniqueSectionFormat('restartIndexForFootnotes',property,propValue,uniqueSectionFormatTemp);this.addUniqueSectionFormat('initialFootNoteNumber',property,propValue,uniqueSectionFormatTemp);this.addUniqueSectionFormat('initialEndNoteNumber',property,propValue,uniqueSectionFormatTemp);this.uniqueSectionFormat=WSectionFormat.uniqueSectionFormats.addUniqueFormat(uniqueSectionFormatTemp,WSectionFormat.uniqueFormatType);};WSectionFormat.prototype.addUniqueSectionFormat=function(property,modifiedProperty,propValue,uniqueSectionFormatTemp){var propertyType=WUniqueFormat.getPropertyType(WSectionFormat.uniqueFormatType,property);if(property===modifiedProperty){uniqueSectionFormatTemp.add(propertyType,propValue);}else{uniqueSectionFormatTemp.add(propertyType,WSectionFormat.getPropertyDefaultValue(property));}};WSectionFormat.prototype.copyFormat=function(format,history){if(history&&(history.isUndoing||history.isRedoing)){this.uniqueSectionFormat=format.uniqueSectionFormat;}else{if(!sf.base.isNullOrUndefined(format)){if(!sf.base.isNullOrUndefined(format.uniqueSectionFormat)&&format.uniqueSectionFormat.propertiesHash){this.updateUniqueSectionFormat(format);}}}};WSectionFormat.prototype.updateUniqueSectionFormat=function(format){var hash=undefined;if(this.uniqueSectionFormat){hash=this.uniqueSectionFormat.mergeProperties(format.uniqueSectionFormat);if(this.uniqueSectionFormat.referenceCount===0){WSectionFormat.uniqueSectionFormats.remove(this.uniqueSectionFormat);this.uniqueSectionFormat=undefined;}}this.uniqueSectionFormat=new WUniqueFormat(WSectionFormat.uniqueFormatType);if(sf.base.isNullOrUndefined(hash)){hash=this.uniqueSectionFormat.mergeProperties(format.uniqueSectionFormat);}this.uniqueSectionFormat=WSectionFormat.uniqueSectionFormats.addUniqueFormat(hash,WSectionFormat.uniqueFormatType);};WSectionFormat.prototype.cloneFormat=function(){var format=new WSectionFormat();format.uniqueSectionFormat=this.uniqueSectionFormat;return format;};WSectionFormat.clear=function(){this.uniqueSectionFormats.clear();};WSectionFormat.uniqueSectionFormats=new WUniqueFormats();WSectionFormat.uniqueFormatType=10;return WSectionFormat;}();/**
 * @private
 */var WLevelOverride=/** @class */function(){function WLevelOverride(){}WLevelOverride.prototype.destroy=function(){if(!sf.base.isNullOrUndefined(this.overrideListLevel)){this.overrideListLevel.destroy();}this.levelNumber=undefined;this.startAt=undefined;this.overrideListLevel=undefined;};WLevelOverride.prototype.clone=function(){var levelOverride=new WLevelOverride();levelOverride.startAt=this.startAt;levelOverride.levelNumber=this.levelNumber;if(!sf.base.isNullOrUndefined(this.overrideListLevel)){levelOverride.overrideListLevel=this.overrideListLevel.clone(levelOverride);}return levelOverride;};return WLevelOverride;}();/**
 * @private
 */var WList=/** @class */function(){function WList(){this.listId=-1;this.sourceListId=-1;this.abstractListId=-1;this.abstractList=undefined;this.levelOverrides=[];}WList.prototype.getListLevel=function(levelNumber){var listLevel=undefined;var levelOverride=this.getLevelOverride(levelNumber);if(!sf.base.isNullOrUndefined(levelOverride)&&!sf.base.isNullOrUndefined(levelOverride.overrideListLevel)){listLevel=levelOverride.overrideListLevel;}else{listLevel=this.abstractList.levels[levelNumber];}return listLevel;};WList.prototype.getLevelOverride=function(levelNumber){for(var i=0;i<this.levelOverrides.length;i++){if(this.levelOverrides[i]instanceof WLevelOverride){var levelOverride=this.levelOverrides[i];if(levelOverride.levelNumber===levelNumber){return levelOverride;}}}return undefined;};WList.prototype.destroy=function(){if(!sf.base.isNullOrUndefined(this.levelOverrides)){this.levelOverrides=[];}this.abstractListId=undefined;this.listId=undefined;this.sourceListId=undefined;this.levelOverrides=undefined;};WList.prototype.mergeList=function(list){if(!sf.base.isNullOrUndefined(this.abstractListId)&&this.abstractListId!==-1){this.abstractListId=list.abstractListId;}if(!sf.base.isNullOrUndefined(this.listId)&&this.listId!==-1){this.listId=list.listId;}if(!sf.base.isNullOrUndefined(this.sourceListId)&&this.sourceListId!==-1){this.sourceListId=list.sourceListId;}if(!sf.base.isNullOrUndefined(this.levelOverrides)&&this.levelOverrides.length!==0){this.levelOverrides=list.levelOverrides;}};WList.prototype.clone=function(){var list=new WList();for(var i=0;i<this.levelOverrides.length;i++){list.levelOverrides.push(this.levelOverrides[i].clone());}return list;};return WList;}();/* eslint-disable */ /**
 * @private
 */var WListFormat=/** @class */function(){function WListFormat(node){this.uniqueListFormat=undefined;this.ownerBase=undefined;this.baseStyle=undefined;this.list=undefined;this.ownerBase=node;}Object.defineProperty(WListFormat.prototype,"listId",{get:function get(){return this.getPropertyValue('listId');},set:function set(listId){this.setPropertyValue('listId',listId);},enumerable:true,configurable:true});Object.defineProperty(WListFormat.prototype,"listLevelNumber",{get:function get(){return this.getPropertyValue('listLevelNumber');},set:function set(value){this.setPropertyValue('listLevelNumber',value);},enumerable:true,configurable:true});Object.defineProperty(WListFormat.prototype,"listLevel",{get:function get(){var list=undefined;if(!sf.base.isNullOrUndefined(this.list)){list=this.list;}else{var baseListStyle=this.baseStyle;while(!sf.base.isNullOrUndefined(baseListStyle)){if(baseListStyle.paragraphFormat.listFormat.list){list=baseListStyle.paragraphFormat.listFormat.list;break;}else{baseListStyle=baseListStyle.basedOn;}}}if(!sf.base.isNullOrUndefined(list)){return list.getListLevel(this.listLevelNumber);}else{return undefined;}},enumerable:true,configurable:true});WListFormat.prototype.getPropertyValue=function(property){if(!this.hasValue(property)){if(this.baseStyle instanceof WParagraphStyle){var baseStyle=this.baseStyle;while(!sf.base.isNullOrUndefined(baseStyle)){if(baseStyle.paragraphFormat.listFormat.hasValue(property)){break;}else{baseStyle=baseStyle.basedOn;}}if(!sf.base.isNullOrUndefined(baseStyle)){var propertyType=WUniqueFormat.getPropertyType(WListFormat.uniqueFormatType,property);return baseStyle.paragraphFormat.listFormat.uniqueListFormat.propertiesHash.get(propertyType);}}}else{var propertyType=WUniqueFormat.getPropertyType(WListFormat.uniqueFormatType,property);if(!sf.base.isNullOrUndefined(this.uniqueListFormat)&&this.uniqueListFormat.propertiesHash.containsKey(propertyType)){return this.uniqueListFormat.propertiesHash.get(propertyType);}}return WListFormat.getPropertyDefaultValue(property);};WListFormat.prototype.setPropertyValue=function(property,value){if(sf.base.isNullOrUndefined(value)||value===''){value=WListFormat.getPropertyDefaultValue(property);}if(sf.base.isNullOrUndefined(this.uniqueListFormat)){this.initializeUniqueListFormat(property,value);}else{var propertyType=WUniqueFormat.getPropertyType(this.uniqueListFormat.uniqueFormatType,property);if(this.uniqueListFormat.propertiesHash.containsKey(propertyType)&&this.uniqueListFormat.propertiesHash.get(propertyType)===value){//Do nothing, since no change in property value and return
return;}this.uniqueListFormat=WListFormat.uniqueListFormats.updateUniqueFormat(this.uniqueListFormat,property,value);}};WListFormat.prototype.initializeUniqueListFormat=function(property,propValue){var uniqueListFormatTemp=new Dictionary();this.addUniqueListFormat('listId',property,propValue,uniqueListFormatTemp);this.addUniqueListFormat('listLevelNumber',property,propValue,uniqueListFormatTemp);this.uniqueListFormat=WListFormat.uniqueListFormats.addUniqueFormat(uniqueListFormatTemp,WListFormat.uniqueFormatType);};WListFormat.prototype.addUniqueListFormat=function(property,modifiedProperty,propValue,uniqueListFormatTemp){var propertyType=WUniqueFormat.getPropertyType(WListFormat.uniqueFormatType,property);if(property===modifiedProperty){uniqueListFormatTemp.add(propertyType,propValue);}};WListFormat.getPropertyDefaultValue=function(property){var value=undefined;switch(property){case'listId':value=-1;break;case'listLevelNumber':value=0;break;}return value;};WListFormat.prototype.copyFormat=function(format){if(!sf.base.isNullOrUndefined(format)){if(!sf.base.isNullOrUndefined(format.uniqueListFormat)){this.listId=format.listId;this.listLevelNumber=format.listLevelNumber;}if(!sf.base.isNullOrUndefined(format.baseStyle)){this.baseStyle=format.baseStyle;}if(!sf.base.isNullOrUndefined(format.list)){this.list=format.list;}}};WListFormat.prototype.hasValue=function(property){if(!sf.base.isNullOrUndefined(this.uniqueListFormat)){var propertyType=WUniqueFormat.getPropertyType(this.uniqueListFormat.uniqueFormatType,property);return this.uniqueListFormat.propertiesHash.containsKey(propertyType);}return false;};WListFormat.prototype.clearFormat=function(){if(!sf.base.isNullOrUndefined(this.uniqueListFormat)&&this.uniqueListFormat.referenceCount===0){WListFormat.uniqueListFormats.remove(this.uniqueListFormat);}this.uniqueListFormat=undefined;this.list=undefined;};WListFormat.prototype.destroy=function(){this.clearFormat();};WListFormat.clear=function(){this.uniqueListFormats.clear();};WListFormat.prototype.applyStyle=function(baseStyle){this.baseStyle=baseStyle;};WListFormat.prototype.getValue=function(property){return this.hasValue(property)?this.getPropertyValue(property):undefined;};WListFormat.prototype.mergeFormat=function(format){if(sf.base.isNullOrUndefined(this.getValue('listId'))){this.listId=format.getValue('listId');}if(sf.base.isNullOrUndefined(this.getValue('listLevelNumber'))){this.listLevelNumber=format.getValue('listLevelNumber');}if(!sf.base.isNullOrUndefined(format.list)){if(sf.base.isNullOrUndefined(this.list)){this.list=new WList();}this.list.mergeList(format.list);}};WListFormat.prototype.cloneListFormat=function(){var format=new WListFormat(undefined);format.list=this.list;format.listId=this.listId;format.baseStyle=this.baseStyle;format.listLevelNumber=this.listLevelNumber;format.uniqueListFormat=this.uniqueListFormat;return format;};WListFormat.uniqueListFormats=new WUniqueFormats();WListFormat.uniqueFormatType=7;return WListFormat;}();/**
 * @private
 */var HelperMethods=/** @class */function(){function HelperMethods(){}/**
     * Inserts text at specified index in string.
     *
     * @private
     * @param {string} spanText - Specifies the span text.
     * @param {number} index - Specifies the index
     * @param {string} text - Specifies the text
     * @returns {string} - Returns modified string
     */HelperMethods.insert=function(spanText,index,text){if(index>=0){return[spanText.slice(0,index)+text+spanText.slice(index)].join('');}else{return text+this;}};/**
     * Removes text from specified index in string.
     *
     * @private
     * @param {string} text - Specifies the text
     * @param {number} index - Specifies the index
     * @returns {string} - Returns modified string
     */HelperMethods.remove=function(text,index){if(index===0){return text.substring(index+1,text.length);}else{return text.substring(0,index)+text.substring(index+1,text.length);}};/* eslint-disable @typescript-eslint/no-explicit-any */HelperMethods.indexOfAny=function(text,wordSplitCharacter){var index=undefined;for(var j=0;j<wordSplitCharacter.length;j++){var temp=text.indexOf(wordSplitCharacter[j]);if(temp!==-1&&sf.base.isNullOrUndefined(index)){index=temp;}else if(temp!==-1&&temp<index){index=temp;}}return sf.base.isNullOrUndefined(index)?-1:index;};HelperMethods.lastIndexOfAny=function(text,wordSplitCharacter){for(var i=text.length-1;i>=0;i--){for(var j=0;j<=wordSplitCharacter.length-1;j++){if(text[i]===wordSplitCharacter[j]){return i;}}}return-1;};HelperMethods.addCssStyle=function(css){var style=document.createElement('style');if(style.style.cssText){style.style.cssText=css;}else{style.appendChild(document.createTextNode(css));}document.getElementsByTagName('head')[0].appendChild(style);};HelperMethods.getHighlightColorCode=function(highlightColor){var color='#ffffff';switch(highlightColor){case'Yellow':color='#ffff00';break;case'BrightGreen':color='#00ff00';break;case'Turquoise':color='#00ffff';break;case'Pink':color='#ff00ff';break;case'Blue':color='#0000ff';break;case'Red':color='#ff0000';break;case'DarkBlue':color='#000080';break;case'Teal':color='#008080';break;case'Green':color='#008000';break;case'Violet':color='#800080';break;case'DarkRed':color='#800000';break;case'DarkYellow':color='#808000';break;case'Gray50':color='#808080';break;case'Gray25':color='#c0c0c0';break;case'Black':color='#000000';break;}return color;};HelperMethods.isVeryDark=function(backColor){var backgroundColor=backColor.substring(1);var r=parseInt(backgroundColor.substr(0,2),16);var g=parseInt(backgroundColor.substr(2,2),16);var b=parseInt(backgroundColor.substr(4,2),16);var contrast=(r*299+g*587+b*114)/1000;return contrast<=60;};HelperMethods.getColor=function(color){if(color.length>0){if(color[0]==='#'){if(color.length>7){return color.substr(0,7);}}}return color;};HelperMethods.convertPointToPixel=function(point){var pixel=HelperMethods.round(point*96/72,5);return pixel;};HelperMethods.convertPixelToPoint=function(pixel){var point=HelperMethods.round(pixel*72/96,5);return point;};HelperMethods.isLinkedFieldCharacter=function(inline){if(inline instanceof FieldElementBox&&inline.fieldType===0){return!sf.base.isNullOrUndefined(inline.fieldEnd);}else if(inline instanceof FieldElementBox&&inline.fieldType===2){return!sf.base.isNullOrUndefined(inline.fieldBegin)&&!sf.base.isNullOrUndefined(inline.fieldEnd);}else{return!sf.base.isNullOrUndefined(inline.fieldBegin);}};/**
     * Removes white space in a string.
     *
     * @private
     * @param {string} text - Specifies text to trim.
     * @returns {string} - Returns modified text.
     */HelperMethods.removeSpace=function(text){if(!sf.base.isNullOrUndefined(text)&&text.length!==0){for(var i=0;i<text.length;i++){if(text.charAt(i)===' '){//replace the space by empty string in string
text=text.replace(' ','');}}}return text;};/**
     * Trims white space at start of the string.
     *
     * @private
     * @param {string} text - Specifies text to trim.
     * @returns {string} - Returns modified text.
     */HelperMethods.trimStart=function(text){var i=0;for(i;i<text.length;i++){if(text[i]!==' '){break;}}return text.substring(i,text.length);};/**
     * Trims white space at end of the string.
     *
     * @private
     * @param {string} text - Specifies text to trim.
     * @returns {string} - Returns modified text.
     */HelperMethods.trimEnd=function(text){var i=text.length-1;for(i;i>=0;i--){if(text[i]!==' '){break;}}return text.substring(0,i+1);};/**
     * Checks whether string ends with whitespace.
     *
     * @private
     * @param {string} text - Specifies the text.
     * @returns {boolean} - Returns true if text ends with specified text.
     */HelperMethods.endsWith=function(text){if(!sf.base.isNullOrUndefined(text)&&text.length!==0){return text[text.length-1]===' ';}return false;};HelperMethods.addSpace=function(length){var str='';if(length>0){for(var i=0;i<length;i++){str+=' ';}}return str;};/* eslint-disable */HelperMethods.writeCharacterFormat=function(characterFormat,isInline,format){characterFormat.bold=isInline?format.bold:format.getValue('bold');characterFormat.italic=isInline?format.italic:format.getValue('italic');characterFormat.fontSize=isInline?this.toWriteInline(format,'fontSize'):format.getValue('fontSize');characterFormat.fontFamily=isInline?this.toWriteInline(format,'fontFamily'):format.getValue('fontFamily');characterFormat.underline=isInline?format.underline:format.getValue('underline');characterFormat.strikethrough=isInline?format.strikethrough:format.getValue('strikethrough');characterFormat.baselineAlignment=isInline?format.baselineAlignment:format.getValue('baselineAlignment');characterFormat.highlightColor=isInline?format.highlightColor:format.getValue('highlightColor');characterFormat.fontColor=isInline?this.toWriteInline(format,'fontColor'):format.getValue('fontColor');characterFormat.styleName=!sf.base.isNullOrUndefined(format.baseCharStyle)?format.baseCharStyle.name:undefined;characterFormat.bidi=isInline?format.bidi:format.getValue('bidi');characterFormat.bdo=isInline?format.bdo:format.getValue('bdo');characterFormat.boldBidi=isInline?format.boldBidi:format.getValue('boldBidi');characterFormat.italicBidi=isInline?format.italicBidi:format.getValue('italicBidi');characterFormat.fontSizeBidi=isInline?format.fontSizeBidi:format.getValue('fontSizeBidi');characterFormat.fontFamilyBidi=isInline?format.fontFamilyBidi:format.getValue('fontFamilyBidi');characterFormat.allCaps=isInline?format.allCaps:format.getValue('allCaps');};HelperMethods.toWriteInline=function(format,propertyName){if(!sf.base.isNullOrUndefined(format.ownerBase)&&format.ownerBase instanceof ElementBox){return format.hasValue(propertyName)?format[propertyName]:format.getValue(propertyName);}else{return format[propertyName];}};/* eslint-enable */HelperMethods.round=function(value,decimalDigits){var temp=value;for(var i=0;i<decimalDigits;i++){temp=temp*10;}temp=Math.round(temp);for(var i=0;i<decimalDigits;i++){temp=temp/10;}return temp;};HelperMethods.reverseString=function(text){if(!sf.base.isNullOrUndefined(text)&&text!==''){// return a new array
var splitString=text.split('');// reverse the new created array
var reverseString=splitString.reverse();// join all elements of the array into a string
text=reverseString.join('');}return text;};HelperMethods.formatClippedString=function(base64ImageString){var extension='';var formatClippedString='';if(this.startsWith(base64ImageString,'data:image/bmp;base64,')){extension='.bmp';formatClippedString=base64ImageString.replace('data:image/bmp;base64,','');}else if(this.startsWith(base64ImageString,'data:image/x-emf;base64,')){extension='.emf';formatClippedString=base64ImageString.replace('data:image/x-emf;base64,','');}else if(this.startsWith(base64ImageString,'data:image/exif;base64,')){extension='.exif';formatClippedString=base64ImageString.replace('data:image/exif;base64,','');}else if(this.startsWith(base64ImageString,'data:image/gif;base64,')){extension='.gif';formatClippedString=base64ImageString.replace('data:image/gif;base64,','');}else if(this.startsWith(base64ImageString,'data:image/icon;base64,')){extension='.ico';formatClippedString=base64ImageString.replace('data:image/icon;base64,','');}else if(this.startsWith(base64ImageString,'data:image/jpeg;base64,')){extension='.jpeg';formatClippedString=base64ImageString.replace('data:image/jpeg;base64,','');}else if(this.startsWith(base64ImageString,'data:image/jpg;base64,')){extension='.jpg';formatClippedString=base64ImageString.replace('data:image/jpg;base64,','');}else if(this.startsWith(base64ImageString,'data:image/png;base64,')){extension='.png';formatClippedString=base64ImageString.replace('data:image/png;base64,','');}else if(this.startsWith(base64ImageString,'data:image/tiff;base64,')){extension='.tif';formatClippedString=base64ImageString.replace('data:image/tiff;base64,','');}else if(this.startsWith(base64ImageString,'data:image/x-wmf;base64,')){extension='.wmf';formatClippedString=base64ImageString.replace('data:image/x-wmf;base64,','');}else{extension='.jpeg';}return{'extension':extension,'formatClippedString':formatClippedString};};HelperMethods.startsWith=function(sourceString,startString){return startString.length>0&&sourceString.substring(0,startString.length)===startString;};HelperMethods.formatText=function(format,value){var text=value;switch(format.toLowerCase()){case'uppercase':text=value.toUpperCase();break;case'lowercase':text=value.toLowerCase();break;case'firstlower':text=this.lowerFirstChar(value);break;case'firstcapital':text=this.capitaliseFirst(value,'FirstCapital');break;case'titlecase':text=this.capitaliseFirst(value,'Titlecase');break;}return text;};HelperMethods.formatNumber=function(format,value){var intl=new sf.base.Internationalization();var dotData=value.split('.');value=dotData[0];var numberValue=intl.parseNumber(value);if(value.toString()==='NaN'){return'';}if(format===''){format='0';}var numberFormat={format:format};return intl.formatNumber(numberValue,numberFormat);};HelperMethods.formatDate=function(format,value){var intl=new sf.base.Internationalization();var date=new Date(value);if(isNaN(date.getDate())){return'';}if(format===''){return value;}if(format.indexOf('am/pm')!==-1){format=format.replace(/am\/pm/gi,'a');}var dateFormat={'format':format};return intl.formatDate(date,dateFormat);};/* eslint-enable @typescript-eslint/no-explicit-any */HelperMethods.capitaliseFirst=function(value,type,splitBy){var text='';if(type==='Titlecase'){var valArry=splitBy?value.split(splitBy):value.split(' ');for(var i=0;i<valArry.length;i++){// eslint-disable-next-line max-len
text+=splitBy?valArry[i].charAt(0).toUpperCase()+valArry[i].slice(1,valArry[i].length):this.capitaliseFirstInternal(valArry[i]);if(valArry.length>=0&&!splitBy){text+=' ';}}if(!splitBy){text=this.capitaliseFirst(text,'Titlecase','\r');}}else if(type==='FirstCapital'){text=this.capitaliseFirstInternal(value);}return text;};HelperMethods.lowerFirstChar=function(value){return value.charAt(0).toLowerCase()+value.slice(1,value.length);};HelperMethods.capitaliseFirstInternal=function(value){return value.charAt(0).toUpperCase()+value.slice(1,value.length).toLowerCase();};HelperMethods.getModifiedDate=function(date){var modifiedDate=new Date(date);var dateString=modifiedDate.toLocaleDateString([],{year:'numeric',month:'long',day:'numeric'});var time=modifiedDate.toLocaleTimeString([],{hour:'numeric',minute:'numeric'});var dateTime=dateString+' '+time;return dateTime;};HelperMethods.getCompatibilityModeValue=function(compatibilityMode){var compatValue;switch(compatibilityMode){case'Word2003':compatValue='11';break;case'Word2007':compatValue='12';break;case'Word2010':compatValue='14';break;default:compatValue='15';break;}return compatValue;};/**
     * @private
     */HelperMethods.wordBefore='\\b';/**
     * @private
     */HelperMethods.wordAfter='\\b';/**
     * @private
     */HelperMethods.wordSplitCharacters=[' ',',','.',':',';','<','>','=','+','-','_','{','}','[',']','`','~','!','@','#','$','%','^','&','*','(',')','"','?','/','|','\\','','','','','','',''];return HelperMethods;}();/**
 * @private
 */var Point=/** @class */function(){function Point(xPosition,yPosition){this.xIn=0;this.yIn=0;this.xIn=xPosition;this.yIn=yPosition;}Object.defineProperty(Point.prototype,"x",{get:function get(){return this.xIn;},set:function set(value){this.xIn=value;},enumerable:true,configurable:true});Object.defineProperty(Point.prototype,"y",{get:function get(){return this.yIn;},set:function set(value){this.yIn=value;},enumerable:true,configurable:true});Point.prototype.copy=function(point){this.xIn=point.xIn;this.yIn=point.yIn;};/**
     * Destroys the internal objects maintained.
     *
     * @returns {void}
     */Point.prototype.destroy=function(){this.xIn=undefined;this.yIn=undefined;};return Point;}();/**
 * @private
 */var Base64=/** @class */function(){function Base64(){this.keyStr='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';}// public method for encoding
Base64.prototype.encodeString=function(input){var output='';var chr1;var chr2;var chr3;var enc1;var enc2;var enc3;var enc4;var i=0;input=this.unicodeEncode(input);while(i<input.length){chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);enc1=chr1>>2;enc2=(chr1&3)<<4|chr2>>4;enc3=(chr2&15)<<2|chr3>>6;enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64;}else if(isNaN(chr3)){enc4=64;}output=output+this.keyStr.charAt(enc1)+this.keyStr.charAt(enc2)+this.keyStr.charAt(enc3)+this.keyStr.charAt(enc4);}return output;};// private method for UTF-8 encoding
Base64.prototype.unicodeEncode=function(input){var tempInput=input.replace(/\r\n/g,'\n');var utftext='';for(var n=0;n<tempInput.length;n++){var c=tempInput.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c);}else if(c>127&&c<2048){utftext+=String.fromCharCode(c>>6|192);utftext+=String.fromCharCode(c&63|128);}else{utftext+=String.fromCharCode(c>>12|224);utftext+=String.fromCharCode(c>>6&63|128);utftext+=String.fromCharCode(c&63|128);}}return utftext;};Base64.prototype.decodeString=function(input){var chr1;var chr2;var chr3;var enc1;var enc2;var enc3;var enc4;var i=0;var resultIndex=0;/*let dataUrlPrefix: string = 'data:';*/input=input.replace(/[^A-Za-z0-9+/=]/g,'');var totalLength=input.length*3/4;if(input.charAt(input.length-1)===this.keyStr.charAt(64)){totalLength--;}if(input.charAt(input.length-2)===this.keyStr.charAt(64)){totalLength--;}if(totalLength%1!==0){// totalLength is not an integer, the length does not match a valid
// base64 content. That can happen if:
// - the input is not a base64 content
// - the input is *almost* a base64 content, with a extra chars at the
// beginning or at the end
// - the input uses a base64 variant (base64url for example)
throw new Error('Invalid base64 input, bad content length.');}var output=new Uint8Array(totalLength|0);while(i<input.length){enc1=this.keyStr.indexOf(input.charAt(i++));enc2=this.keyStr.indexOf(input.charAt(i++));enc3=this.keyStr.indexOf(input.charAt(i++));enc4=this.keyStr.indexOf(input.charAt(i++));chr1=enc1<<2|enc2>>4;chr2=(enc2&15)<<4|enc3>>2;chr3=(enc3&3)<<6|enc4;output[resultIndex++]=chr1;if(enc3!==64){output[resultIndex++]=chr2;}if(enc4!==64){output[resultIndex++]=chr3;}}return output;};return Base64;}();/**
 * @private
 */var WrapPosition=/** @class */function(){function WrapPosition(x,width){this.x=0;this.width=0;this.x=x;this.width=width;}Object.defineProperty(WrapPosition.prototype,"right",{get:function get(){return this.x+this.width;},enumerable:true,configurable:true});return WrapPosition;}();/**
 * @private
 */var WAbstractList=/** @class */function(){function WAbstractList(){this.abstractListIdIn=-1;this.levels=[];}Object.defineProperty(WAbstractList.prototype,"abstractListId",{get:function get(){return this.abstractListIdIn;},set:function set(abstractListId){this.abstractListIdIn=abstractListId;},enumerable:true,configurable:true});WAbstractList.prototype.destroy=function(){if(!sf.base.isNullOrUndefined(this.levels)){for(var i=0;i<this.levels.length;i++){var listLevel=this.levels[i];listLevel.destroy();this.levels.splice(this.levels.indexOf(listLevel),1);i--;}this.levels=[];}this.levels=undefined;};WAbstractList.prototype.clone=function(){var absList=new WAbstractList();for(var i=0;i<this.levels.length;i++){absList.levels.push(this.levels[i].clone(absList));}return absList;};return WAbstractList;}();/**
 * @private
 */var WBorder=/** @class */function(){function WBorder(node){this.uniqueBorderFormat=undefined;this.ownerBase=undefined;this.ownerBase=node;}Object.defineProperty(WBorder.prototype,"color",{get:function get(){return this.getPropertyValue('color');},set:function set(value){this.setPropertyValue('color',value);},enumerable:true,configurable:true});Object.defineProperty(WBorder.prototype,"lineStyle",{get:function get(){return this.getPropertyValue('lineStyle');},set:function set(value){this.setPropertyValue('lineStyle',value);},enumerable:true,configurable:true});Object.defineProperty(WBorder.prototype,"lineWidth",{get:function get(){return this.getPropertyValue('lineWidth');},set:function set(value){this.setPropertyValue('lineWidth',value);},enumerable:true,configurable:true});Object.defineProperty(WBorder.prototype,"shadow",{get:function get(){return this.getPropertyValue('shadow');},set:function set(value){this.setPropertyValue('shadow',value);},enumerable:true,configurable:true});Object.defineProperty(WBorder.prototype,"space",{get:function get(){return this.getPropertyValue('space');},set:function set(value){this.setPropertyValue('space',value);},enumerable:true,configurable:true});Object.defineProperty(WBorder.prototype,"hasNoneStyle",{get:function get(){return this.getPropertyValue('hasNoneStyle');},set:function set(value){this.setPropertyValue('hasNoneStyle',value);},enumerable:true,configurable:true});Object.defineProperty(WBorder.prototype,"isBorderDefined",{get:function get(){return this.lineStyle!=='None'||this.hasNoneStyle&&this.hasValue('hasNoneStyle');},enumerable:true,configurable:true});/* eslint-disable */WBorder.prototype.getPropertyValue=function(property){var hasValue=this.hasValue(property);if(hasValue){var propertyType=WUniqueFormat.getPropertyType(WBorder.uniqueFormatType,property);if(!sf.base.isNullOrUndefined(this.uniqueBorderFormat)){var propValue=this.uniqueBorderFormat.propertiesHash.get(propertyType);if(!sf.base.isNullOrUndefined(propValue)){return propValue;}}}return WBorder.getPropertyDefaultValue(property);};WBorder.prototype.setPropertyValue=function(property,value){if(sf.base.isNullOrUndefined(value)||value===''){value=WBorder.getPropertyDefaultValue(property);}if(sf.base.isNullOrUndefined(this.uniqueBorderFormat)){this.initializeUniqueBorder(property,value);}else{var propertyType=WUniqueFormat.getPropertyType(this.uniqueBorderFormat.uniqueFormatType,property);if(this.uniqueBorderFormat.propertiesHash.containsKey(propertyType)&&this.uniqueBorderFormat.propertiesHash.get(propertyType)===value){//Do nothing, since no change in property value and return
return;}this.uniqueBorderFormat=WBorder.uniqueBorderFormats.updateUniqueFormat(this.uniqueBorderFormat,property,value);}};WBorder.prototype.initializeUniqueBorder=function(property,propValue){var uniqueBorderFormatTemp=new Dictionary();this.addUniqueBorderFormat('color',property,propValue,uniqueBorderFormatTemp);this.addUniqueBorderFormat('lineStyle',property,propValue,uniqueBorderFormatTemp);this.addUniqueBorderFormat('lineWidth',property,propValue,uniqueBorderFormatTemp);this.addUniqueBorderFormat('shadow',property,propValue,uniqueBorderFormatTemp);this.addUniqueBorderFormat('space',property,propValue,uniqueBorderFormatTemp);this.addUniqueBorderFormat('hasNoneStyle',property,propValue,uniqueBorderFormatTemp);this.uniqueBorderFormat=WBorder.uniqueBorderFormats.addUniqueFormat(uniqueBorderFormatTemp,WBorder.uniqueFormatType);};WBorder.prototype.addUniqueBorderFormat=function(property,modifiedProperty,propValue,uniqueBorderFormatTemp){var propertyType=WUniqueFormat.getPropertyType(WBorder.uniqueFormatType,property);if(property===modifiedProperty){uniqueBorderFormatTemp.add(propertyType,propValue);}};WBorder.getPropertyDefaultValue=function(property){var value=undefined;/* eslint-enable */switch(property){case'color':value='#000000';break;case'lineStyle':value='None';break;case'lineWidth':value=0;break;case'shadow':value=false;break;case'space':value=0;break;case'hasNoneStyle':value=false;break;}return value;};WBorder.prototype.getLineWidth=function(){/* eslint-disable */switch(this.lineStyle){case'None':case'Cleared':return 0;case'Triple':case'Double':case'ThinThickSmallGap':case'ThickThinSmallGap':case'ThinThickThinSmallGap':case'ThinThickMediumGap':case'ThickThinMediumGap':case'ThinThickThinMediumGap':case'ThinThickLargeGap':case'ThickThinLargeGap':case'ThinThickThinLargeGap':case'Emboss3D':case'Engrave3D':{var lineArray=this.getBorderLineWidthArray(this.lineStyle,this.lineWidth);var width=0;for(var i=0;i<lineArray.length;i++){width+=lineArray[i];}return width;}case'Single':case'DashLargeGap':case'DashSmallGap':case'Dot':case'DashDot':case'DashDotDot':case'Thick':return this.lineWidth;case'SingleWavy':return this.lineWidth===1.5?3:2.5;//Double wave border only draw with the fixed width
case'DoubleWavy':return 6.75;//Double wave border only draw with the fixed width
case'DashDotStroked':case'Outset':return this.lineWidth;}return this.lineWidth;/* eslint-enable */};WBorder.prototype.getBorderLineWidthArray=function(lineStyle,lineWidth){var borderLineArray=[lineWidth];switch(lineStyle){case'Double':borderLineArray=[1,1,1];break;case'ThinThickSmallGap':borderLineArray=[1,-0.75,-0.75];break;case'ThickThinSmallGap':borderLineArray=[-0.75,-0.75,1];break;case'ThinThickMediumGap':borderLineArray=[1,0.5,0.5];break;case'ThickThinMediumGap':borderLineArray=[0.5,0.5,1];break;case'ThinThickLargeGap':borderLineArray=[-1.5,1,-0.75];break;case'ThickThinLargeGap':borderLineArray=[-0.75,1,-1.5];break;case'Triple':borderLineArray=[1,1,1,1,1];break;case'ThinThickThinSmallGap':borderLineArray=[-0.75,-0.75,1,-0.75,-0.75];break;case'ThinThickThinMediumGap':borderLineArray=[0.5,0.5,1,0.5,0.5];break;case'ThinThickThinLargeGap':borderLineArray=[-0.75,1,-1.5,1,-0.75];break;case'Emboss3D':case'Engrave3D':borderLineArray=[0.25,0,1,0,0.25];break;}if(borderLineArray.length===1){return[lineWidth];}for(var i=0;i<borderLineArray.length;i++){if(borderLineArray[i]>=0){borderLineArray[i]=borderLineArray[i]*lineWidth;}else{borderLineArray[i]=Math.abs(borderLineArray[i]);}}return borderLineArray;};WBorder.prototype.getBorderWeight=function(){var weight=0;var numberOfLines=this.getNumberOfLines();var borderNumber=this.getBorderNumber();switch(this.lineStyle){case'Single':case'DashSmallGap':case'DashDot':case'DashDotDot':case'Double':case'Triple':case'ThinThickSmallGap':case'ThickThinSmallGap':case'ThinThickThinSmallGap':case'ThinThickMediumGap':case'ThickThinMediumGap':case'ThinThickThinMediumGap':case'ThinThickLargeGap':case'ThickThinLargeGap':case'ThinThickThinLargeGap':case'SingleWavy':case'DoubleWavy':case'DashDotStroked':case'Emboss3D':case'Engrave3D':case'Outset':case'Inset':case'Thick':weight=numberOfLines*borderNumber;break;case'Dot':case'DashLargeGap':weight=1;break;}return weight;};WBorder.prototype.getBorderNumber=function(){var borderNumber=0;switch(this.lineStyle){case'Single':borderNumber=1;break;case'Thick':borderNumber=2;break;case'Double':borderNumber=3;break;case'Dot':borderNumber=4;break;case'DashLargeGap'://dashed.
borderNumber=5;break;case'DashDot':borderNumber=6;break;case'DashDotDot':borderNumber=7;break;case'Triple':borderNumber=8;break;case'ThinThickSmallGap':borderNumber=9;break;case'ThickThinSmallGap':borderNumber=10;break;case'ThinThickThinSmallGap':borderNumber=11;break;case'ThinThickMediumGap':borderNumber=12;break;case'ThickThinMediumGap':borderNumber=13;break;case'ThinThickThinMediumGap':borderNumber=14;break;case'ThinThickLargeGap':borderNumber=15;break;case'ThickThinLargeGap':borderNumber=16;break;case'ThinThickThinLargeGap':borderNumber=17;break;case'SingleWavy'://wave.
borderNumber=18;break;case'DoubleWavy':borderNumber=19;break;case'DashSmallGap':borderNumber=20;break;case'DashDotStroked':borderNumber=21;break;case'Emboss3D':borderNumber=22;break;case'Engrave3D':borderNumber=23;break;case'Outset':borderNumber=24;break;case'Inset':borderNumber=25;break;}return borderNumber;};WBorder.prototype.getNumberOfLines=function(){//ToDo: Need to analyze more on this.
var value=0;switch(this.lineStyle){case'Single':case'Dot':case'DashSmallGap':case'DashLargeGap':case'DashDot':case'DashDotDot':value=1;break;case'Double':value=3;break;case'Triple':value=5;break;case'ThinThickSmallGap':value=3;break;case'ThickThinSmallGap':value=3;break;case'ThinThickThinSmallGap':value=5;break;case'ThinThickMediumGap':value=3;break;case'ThickThinMediumGap':value=3;break;case'ThinThickThinMediumGap':value=5;break;case'ThinThickLargeGap':value=3;break;case'ThickThinLargeGap':value=3;break;case'ThinThickThinLargeGap':value=5;break;case'SingleWavy':value=1;break;case'DoubleWavy':value=2;break;case'DashDotStroked':value=1;break;case'Emboss3D':case'Engrave3D':value=3;break;case'Outset':case'Inset':case'Thick':value=1;break;}return value;};WBorder.prototype.getPrecedence=function(){var value=0;switch(this.lineStyle){case'Single':value=1;break;case'Thick':value=2;break;case'Double':value=3;break;case'Dot':value=4;break;case'DashLargeGap'://dashed.
value=5;break;case'DashDot':value=6;break;case'DashDotDot':value=7;break;case'Triple':value=8;break;case'ThinThickSmallGap':value=9;break;case'ThickThinSmallGap':value=10;break;case'ThinThickThinSmallGap':value=11;break;case'ThinThickMediumGap':value=12;break;case'ThickThinMediumGap':value=13;break;case'ThinThickThinMediumGap':value=14;break;case'ThinThickLargeGap':value=15;break;case'ThickThinLargeGap':value=16;break;case'ThinThickThinLargeGap':value=17;break;case'SingleWavy'://wave.
value=18;break;case'DoubleWavy':value=19;break;case'DashSmallGap':value=20;break;case'DashDotStroked':value=21;break;case'Emboss3D':value=22;break;case'Engrave3D':value=23;break;case'Outset':value=24;break;case'Inset':value=25;break;}return value;};WBorder.prototype.hasValue=function(property){if(!sf.base.isNullOrUndefined(this.uniqueBorderFormat)){var propertyType=WUniqueFormat.getPropertyType(this.uniqueBorderFormat.uniqueFormatType,property);return this.uniqueBorderFormat.propertiesHash.containsKey(propertyType);}return false;};WBorder.prototype.cloneFormat=function(){var border=new WBorder(undefined);border.color=this.color;border.lineStyle=this.lineStyle;border.lineWidth=this.lineWidth;border.shadow=this.shadow;border.space=this.space;return border;};WBorder.prototype.destroy=function(){if(!sf.base.isNullOrUndefined(this.uniqueBorderFormat)){WBorder.uniqueBorderFormats.remove(this.uniqueBorderFormat);}this.uniqueBorderFormat=undefined;};WBorder.prototype.copyFormat=function(border){if(!sf.base.isNullOrUndefined(border)&&!sf.base.isNullOrUndefined(border.uniqueBorderFormat)){if(border.hasValue('color')){this.color=border.color;}if(border.hasValue('lineStyle')){this.lineStyle=border.lineStyle;}if(border.hasValue('lineWidth')){this.lineWidth=border.lineWidth;}if(border.hasValue('shadow')){this.shadow=border.shadow;}if(border.hasValue('space')){this.space=border.space;}}};WBorder.clear=function(){this.uniqueBorderFormats.clear();};WBorder.uniqueBorderFormats=new WUniqueFormats();WBorder.uniqueFormatType=1;return WBorder;}();/**
 * @private
 */var WBorders=/** @class */function(){function WBorders(node){this.leftIn=new WBorder(this);this.rightIn=new WBorder(this);this.topIn=new WBorder(this);this.bottomIn=new WBorder(this);this.horizontalIn=new WBorder(this);this.verticalIn=new WBorder(this);this.diagonalUpIn=new WBorder(this);this.diagonalDownIn=new WBorder(this);this.lineWidthIn=0;this.ownerBase=node;}Object.defineProperty(WBorders.prototype,"left",{get:function get(){return this.leftIn;},set:function set(value){this.leftIn=value;},enumerable:true,configurable:true});Object.defineProperty(WBorders.prototype,"right",{get:function get(){return this.rightIn;},set:function set(value){this.rightIn=value;},enumerable:true,configurable:true});Object.defineProperty(WBorders.prototype,"top",{get:function get(){return this.topIn;},set:function set(value){this.topIn=value;},enumerable:true,configurable:true});Object.defineProperty(WBorders.prototype,"bottom",{get:function get(){return this.bottomIn;},set:function set(value){this.bottomIn=value;},enumerable:true,configurable:true});Object.defineProperty(WBorders.prototype,"horizontal",{get:function get(){return this.horizontalIn;},set:function set(value){this.horizontalIn=value;},enumerable:true,configurable:true});Object.defineProperty(WBorders.prototype,"vertical",{get:function get(){return this.verticalIn;},set:function set(value){this.verticalIn=value;},enumerable:true,configurable:true});Object.defineProperty(WBorders.prototype,"diagonalUp",{get:function get(){return this.diagonalUpIn;},set:function set(value){this.diagonalUpIn=value;},enumerable:true,configurable:true});Object.defineProperty(WBorders.prototype,"diagonalDown",{get:function get(){return this.diagonalDownIn;},set:function set(value){this.diagonalDownIn=value;},enumerable:true,configurable:true});/* eslint-enable */WBorders.prototype.destroy=function(){if(!sf.base.isNullOrUndefined(this.left)){this.left.destroy();}if(!sf.base.isNullOrUndefined(this.top)){this.top.destroy();}if(!sf.base.isNullOrUndefined(this.bottom)){this.bottom.destroy();}if(!sf.base.isNullOrUndefined(this.right)){this.right.destroy();}if(!sf.base.isNullOrUndefined(this.horizontal)){this.horizontal.destroy();}if(!sf.base.isNullOrUndefined(this.vertical)){this.vertical.destroy();}if(!sf.base.isNullOrUndefined(this.diagonalDown)){this.diagonalDown.destroy();}if(!sf.base.isNullOrUndefined(this.diagonalUp)){this.diagonalUp.destroy();}this.topIn=undefined;this.bottomIn=undefined;this.leftIn=undefined;this.rightIn=undefined;this.horizontalIn=undefined;this.verticalIn=undefined;this.diagonalDownIn=undefined;this.diagonalUpIn=undefined;this.lineWidthIn=undefined;this.valueIn=undefined;};WBorders.prototype.cloneFormat=function(){var borders=new WBorders(undefined);borders.top=sf.base.isNullOrUndefined(this.top)?undefined:this.top.cloneFormat();borders.bottom=sf.base.isNullOrUndefined(this.bottom)?undefined:this.bottom.cloneFormat();borders.left=sf.base.isNullOrUndefined(this.left)?undefined:this.left.cloneFormat();borders.right=sf.base.isNullOrUndefined(this.right)?undefined:this.right.cloneFormat();borders.horizontal=sf.base.isNullOrUndefined(this.horizontal)?undefined:this.horizontal.cloneFormat();borders.vertical=sf.base.isNullOrUndefined(this.vertical)?undefined:this.vertical.cloneFormat();borders.diagonalUp=sf.base.isNullOrUndefined(this.diagonalUp)?undefined:this.diagonalUp.cloneFormat();borders.diagonalDown=sf.base.isNullOrUndefined(this.diagonalDown)?undefined:this.diagonalDown.cloneFormat();return borders;};WBorders.prototype.copyFormat=function(borders){if(!sf.base.isNullOrUndefined(borders.left)&&borders.left instanceof WBorder){this.left=new WBorder(this);this.left.copyFormat(borders.left);}if(!sf.base.isNullOrUndefined(borders.right)&&borders.right instanceof WBorder){this.right=new WBorder(this);this.right.copyFormat(borders.right);}if(!sf.base.isNullOrUndefined(borders.top)&&borders.top instanceof WBorder){this.top=new WBorder(this);this.top.copyFormat(borders.top);}if(!sf.base.isNullOrUndefined(borders.bottom)&&borders.bottom instanceof WBorder){this.bottom=new WBorder(this);this.bottom.copyFormat(borders.bottom);}if(!sf.base.isNullOrUndefined(borders.horizontal)&&borders.horizontal instanceof WBorder){this.horizontal=new WBorder(this);this.horizontal.copyFormat(borders.horizontal);}if(!sf.base.isNullOrUndefined(borders.vertical)&&borders.vertical instanceof WBorder){this.vertical=new WBorder(this);this.vertical.copyFormat(borders.vertical);}if(!sf.base.isNullOrUndefined(borders.diagonalDown)&&borders.diagonalDown instanceof WBorder){this.diagonalDown=new WBorder(this);this.diagonalDown.copyFormat(borders.diagonalDown);}if(!sf.base.isNullOrUndefined(borders.diagonalUp)&&borders.diagonalUp instanceof WBorder){this.diagonalUp=new WBorder(this);this.diagonalUp.copyFormat(borders.diagonalUp);}};return WBorders;}();/* eslint-disable */ /**
 * @private
 */var WRowFormat=/** @class */function(){function WRowFormat(node){this.uniqueRowFormat=undefined;/**
         * @private
         */this.borders=new WBorders(this);/**
         * @private
         */this.ownerBase=undefined;/**
         * @private
         */this.beforeWidth=0;/**
         * @private
         */this.afterWidth=0;/**
         * @private
         */this.revisions=[];/**
         * @private
         */this.removedIds=[];this.ownerBase=node;}Object.defineProperty(WRowFormat.prototype,"gridBefore",{get:function get(){return this.getPropertyValue('gridBefore');},set:function set(value){this.setPropertyValue('gridBefore',value);},enumerable:true,configurable:true});Object.defineProperty(WRowFormat.prototype,"gridBeforeWidth",{get:function get(){return this.getPropertyValue('gridBeforeWidth');},set:function set(value){this.setPropertyValue('gridBeforeWidth',value);},enumerable:true,configurable:true});Object.defineProperty(WRowFormat.prototype,"gridBeforeWidthType",{get:function get(){return this.getPropertyValue('gridBeforeWidthType');},set:function set(value){this.setPropertyValue('gridBeforeWidthType',value);},enumerable:true,configurable:true});Object.defineProperty(WRowFormat.prototype,"gridAfter",{get:function get(){return this.getPropertyValue('gridAfter');},set:function set(value){this.setPropertyValue('gridAfter',value);},enumerable:true,configurable:true});Object.defineProperty(WRowFormat.prototype,"gridAfterWidth",{get:function get(){return this.getPropertyValue('gridAfterWidth');},set:function set(value){this.setPropertyValue('gridAfterWidth',value);},enumerable:true,configurable:true});Object.defineProperty(WRowFormat.prototype,"gridAfterWidthType",{get:function get(){return this.getPropertyValue('gridAfterWidthType');},set:function set(value){this.setPropertyValue('gridAfterWidthType',value);},enumerable:true,configurable:true});Object.defineProperty(WRowFormat.prototype,"allowBreakAcrossPages",{get:function get(){return this.getPropertyValue('allowBreakAcrossPages');},set:function set(value){this.setPropertyValue('allowBreakAcrossPages',value);},enumerable:true,configurable:true});Object.defineProperty(WRowFormat.prototype,"isHeader",{get:function get(){return this.getPropertyValue('isHeader');},set:function set(value){this.setPropertyValue('isHeader',value);},enumerable:true,configurable:true});Object.defineProperty(WRowFormat.prototype,"rightMargin",{get:function get(){return this.getPropertyValue('rightMargin');},set:function set(value){this.setPropertyValue('rightMargin',value);},enumerable:true,configurable:true});Object.defineProperty(WRowFormat.prototype,"height",{get:function get(){return this.getPropertyValue('height');},set:function set(value){if(value===0&&(this.heightType==='AtLeast'||this.heightType==='Exactly')){value=1;}else if(this.heightType==='Auto'){value=0;}this.setPropertyValue('height',value);},enumerable:true,configurable:true});Object.defineProperty(WRowFormat.prototype,"heightType",{get:function get(){return this.getPropertyValue('heightType');},set:function set(value){if(value==='AtLeast'||value==='Exactly'){this.height=1;}else{this.height=0;}this.setPropertyValue('heightType',value);},enumerable:true,configurable:true});Object.defineProperty(WRowFormat.prototype,"bottomMargin",{get:function get(){return this.getPropertyValue('bottomMargin');},set:function set(value){this.setPropertyValue('bottomMargin',value);},enumerable:true,configurable:true});Object.defineProperty(WRowFormat.prototype,"leftIndent",{get:function get(){return this.getPropertyValue('leftIndent');},set:function set(value){this.setPropertyValue('leftIndent',value);},enumerable:true,configurable:true});Object.defineProperty(WRowFormat.prototype,"topMargin",{get:function get(){return this.getPropertyValue('topMargin');},set:function set(value){this.setPropertyValue('topMargin',value);},enumerable:true,configurable:true});Object.defineProperty(WRowFormat.prototype,"leftMargin",{get:function get(){return this.getPropertyValue('leftMargin');},set:function set(value){this.setPropertyValue('leftMargin',value);},enumerable:true,configurable:true});WRowFormat.prototype.getPropertyValue=function(property){var hasValue=this.hasValue(property);if(hasValue){var propertyType=WUniqueFormat.getPropertyType(WRowFormat.uniqueFormatType,property);if(!sf.base.isNullOrUndefined(this.uniqueRowFormat)&&this.uniqueRowFormat.propertiesHash.containsKey(propertyType)){return this.uniqueRowFormat.propertiesHash.get(propertyType);}}return WRowFormat.getPropertyDefaultValue(property);};WRowFormat.prototype.setPropertyValue=function(property,value){if(sf.base.isNullOrUndefined(value)||value===''){value=WRowFormat.getPropertyDefaultValue(property);}if(sf.base.isNullOrUndefined(this.uniqueRowFormat)){this.initializeUniqueRowFormat(property,value);}else{var propertyType=WUniqueFormat.getPropertyType(this.uniqueRowFormat.uniqueFormatType,property);if(this.uniqueRowFormat.propertiesHash.containsKey(propertyType)&&this.uniqueRowFormat.propertiesHash.get(propertyType)===value){//Do nothing, since no change in property value and return
return;}this.uniqueRowFormat=WRowFormat.uniqueRowFormats.updateUniqueFormat(this.uniqueRowFormat,property,value);}};WRowFormat.prototype.initializeUniqueRowFormat=function(property,propValue){var uniqueRowFormatTemp=new Dictionary();this.addUniqueRowFormat('allowBreakAcrossPages',property,propValue,uniqueRowFormatTemp);this.addUniqueRowFormat('isHeader',property,propValue,uniqueRowFormatTemp);this.addUniqueRowFormat('height',property,propValue,uniqueRowFormatTemp);this.addUniqueRowFormat('heightType',property,propValue,uniqueRowFormatTemp);this.addUniqueRowFormat('gridBefore',property,propValue,uniqueRowFormatTemp);this.addUniqueRowFormat('gridBeforeWidth',property,propValue,uniqueRowFormatTemp);this.addUniqueRowFormat('gridBeforeWidthType',property,propValue,uniqueRowFormatTemp);this.addUniqueRowFormat('gridAfter',property,propValue,uniqueRowFormatTemp);this.addUniqueRowFormat('gridAfterWidth',property,propValue,uniqueRowFormatTemp);this.addUniqueRowFormat('gridgridAfterWidth',property,propValue,uniqueRowFormatTemp);this.addUniqueRowFormat('gridBeforeWidthType',property,propValue,uniqueRowFormatTemp);this.addUniqueRowFormat('leftMargin',property,propValue,uniqueRowFormatTemp);this.addUniqueRowFormat('rightMargin',property,propValue,uniqueRowFormatTemp);this.addUniqueRowFormat('topMargin',property,propValue,uniqueRowFormatTemp);this.addUniqueRowFormat('bottomMargin',property,propValue,uniqueRowFormatTemp);this.addUniqueRowFormat('leftIndent',property,propValue,uniqueRowFormatTemp);this.uniqueRowFormat=WRowFormat.uniqueRowFormats.addUniqueFormat(uniqueRowFormatTemp,WRowFormat.uniqueFormatType);};WRowFormat.prototype.addUniqueRowFormat=function(property,modifiedProperty,propValue,uniqueRowFormatTemp){var propertyType=WUniqueFormat.getPropertyType(WRowFormat.uniqueFormatType,property);if(property===modifiedProperty){uniqueRowFormatTemp.add(propertyType,propValue);}};WRowFormat.getPropertyDefaultValue=function(property){var value=undefined;switch(property){case'allowBreakAcrossPages':value=true;break;case'isHeader':value=false;break;case'height':value=0;break;case'heightType':value='Auto';break;case'gridBefore':value=0;break;case'gridBeforeWidth':value=0;break;case'gridBeforeWidthType':value='Point';break;case'gridAfter':value=0;break;case'gridAfterWidth':value=0;break;case'gridAfterWidthType':value='Point';break;case'leftMargin':value=undefined;break;case'topMargin':value=undefined;break;case'bottomMargin':value=undefined;break;case'rightMargin':value=undefined;break;case'leftIndent':value=0;break;}return value;};WRowFormat.prototype.containsMargins=function(){return!sf.base.isNullOrUndefined(this.leftMargin)||!sf.base.isNullOrUndefined(this.rightMargin)||!sf.base.isNullOrUndefined(this.bottomMargin)||!sf.base.isNullOrUndefined(this.topMargin);};WRowFormat.prototype.cloneFormat=function(){var format=new WRowFormat();format.allowBreakAcrossPages=this.allowBreakAcrossPages;format.heightType=this.heightType;format.height=this.height;format.isHeader=this.isHeader;format.gridBefore=this.gridBefore;format.gridBeforeWidth=this.gridBeforeWidth;format.gridBeforeWidthType=this.gridBeforeWidthType;format.gridAfter=this.gridAfter;format.gridAfterWidth=this.gridAfterWidth;format.gridAfterWidthType=this.gridAfterWidthType;format.leftMargin=this.leftMargin;format.rightMargin=this.rightMargin;format.topMargin=this.topMargin;format.bottomMargin=this.bottomMargin;format.leftIndent=this.leftIndent;if(this.revisions.length>0){format.removedIds=Revision.cloneRevisions(this.revisions);}else{format.removedIds=this.removedIds.slice();}return format;};WRowFormat.prototype.hasValue=function(property){if(!sf.base.isNullOrUndefined(this.uniqueRowFormat)){var propertyType=WUniqueFormat.getPropertyType(this.uniqueRowFormat.uniqueFormatType,property);return this.uniqueRowFormat.propertiesHash.containsKey(propertyType);}return false;};WRowFormat.prototype.copyFormat=function(format){if(!sf.base.isNullOrUndefined(format)){if(!sf.base.isNullOrUndefined(format.uniqueRowFormat)){this.allowBreakAcrossPages=format.allowBreakAcrossPages;this.isHeader=format.isHeader;this.heightType=format.heightType;this.height=format.height;this.gridBefore=format.gridBefore;this.gridBeforeWidth=format.gridBeforeWidth;this.gridBeforeWidthType=format.gridBeforeWidthType;this.gridAfter=format.gridAfter;this.gridAfterWidth=format.gridAfterWidth;this.gridAfterWidthType=format.gridAfterWidthType;this.leftMargin=format.leftMargin;this.topMargin=format.topMargin;this.rightMargin=format.rightMargin;this.bottomMargin=format.bottomMargin;this.leftIndent=format.leftIndent;}if(!sf.base.isNullOrUndefined(format.borders)){this.borders=new WBorders(this);this.borders.ownerBase=format;this.borders.copyFormat(format.borders);}if(format.revisions.length>0){this.removedIds=Revision.cloneRevisions(format.revisions);}else{this.removedIds=format.removedIds.slice();}}};WRowFormat.prototype.destroy=function(){if(!sf.base.isNullOrUndefined(this.borders)){this.borders.destroy();}if(!sf.base.isNullOrUndefined(this.uniqueRowFormat)){WRowFormat.uniqueRowFormats.remove(this.uniqueRowFormat);}this.beforeWidth=undefined;this.afterWidth=undefined;this.borders=undefined;this.uniqueRowFormat=undefined;};WRowFormat.clear=function(){this.uniqueRowFormats.clear();};WRowFormat.uniqueRowFormats=new WUniqueFormats();WRowFormat.uniqueFormatType=6;return WRowFormat;}();/**
 * The revision class which holds the information related to changes made in the document
 */var Revision=/** @class */function(){function Revision(documentHelper,author,date){/**
         * Gets or sets the author name who made the change
         *
         * @private
         */this.author=null;/**
         * Indicates when the track changes made
         *
         * @private
         */this.date=null;/**
         * Holds the reference of the items which are under this revision.
         *
         * @private
         */this.range=[];/**
         * @private
         */this.revisionID='';/**
         * Used to update cursor position by ensuring items were removed or not
         */this.isContentRemoved=false;this.isTableRevision=false;/**
         * Indicates whether to skip unlinking ranges for table elements.
         */this.canSkipTableItems=false;this.skipUnLinkElement=false;this.author=author;this.date=date;this.owner=documentHelper;}Revision.prototype.handleAcceptReject=function(isFromAccept){this.owner.selection.selectRevision(this);var selection=this.owner.selection;var startPos=selection.start;var endPos=selection.end;if(!selection.start.isExistBefore(selection.end)){startPos=selection.end;endPos=selection.start;}var blockInfo=selection.getParagraphInfo(startPos);this.owner.editor.initHistory(isFromAccept?'Accept Change':'Reject Change');if(this.revisionType==='Deletion'){blockInfo=selection.getParagraphInfo(this.owner.selection.start);selection.editPosition=this.owner.selection.getHierarchicalIndex(blockInfo.paragraph,blockInfo.offset.toString());}else{selection.editPosition=this.owner.selection.getHierarchicalIndex(blockInfo.paragraph,blockInfo.offset.toString());}this.owner.editor.updateInsertPosition();this.isContentRemoved=false;this.canSkipTableItems=false;this.skipUnLinkElement=false;// Implement to accept/reject the revision
if(this.revisionType==='Insertion'||this.revisionType==='Deletion'||this.revisionType==='MoveFrom'||this.revisionType==='MoveTo'){var rangeIndex=0;while(this.range.length>0){if(this.range[rangeIndex]instanceof ElementBox||this.range[rangeIndex]instanceof WCharacterFormat||this.range[rangeIndex]instanceof WRowFormat){var moveToNextItem=this.unlinkRangeItem(this.range[rangeIndex],this,isFromAccept);if(moveToNextItem){rangeIndex++;}else{rangeIndex=0;}}else{break;}}}this.isTableRevision=false;if(this.isContentRemoved){var textPosition=selection.getTextPosBasedOnLogicalIndex(selection.editPosition);this.owner.selection.selectContent(textPosition,true);this.owner.editor.updateEndPosition();}else{selection.selectRange(startPos,endPos);this.owner.editor.updateHistoryPosition(endPos,false);}if(this.owner.editorHistory&&this.owner.editorHistory.currentBaseHistoryInfo.action!=='BackSpace'){this.owner.editorHistory.currentBaseHistoryInfo.removedNodes.reverse();}if(this.owner.editorHistory){if(this.owner.trackChangesPane.isTrackingPageBreak){this.owner.editorHistory.currentBaseHistoryInfo.action='TrackingPageBreak';}var editorHistory=this.owner.editorHistory;if(editorHistory.currentHistoryInfo&&(editorHistory.currentHistoryInfo.action==='Accept All'||editorHistory.currentHistoryInfo.action==='Reject All')){if(this.owner.documentHelper.blockToShift){this.owner.documentHelper.layout.shiftLayoutedItems(false);}}editorHistory.updateHistory();}this.owner.editor.reLayout(this.owner.selection);if(blockInfo.paragraph.isInHeaderFooter){this.owner.editor.updateHeaderFooterWidget();}};/**
     * Method which accepts the selected revision, revision marks will be removed and changes will be included in the viewer.
     *
     * @returns {void}
     */Revision.prototype.accept=function(){this.handleAcceptReject(true);};/**
     * Method which rejects the selected revision, revision marks will be removed leaving the original content.
     */Revision.prototype.reject=function(){this.handleAcceptReject(false);};/**
     * Unlinks revision and its assosiated range
     * @private
     * @param item
     * @param revision
     * @param isFromAccept
     */ /* eslint-disable  */Revision.prototype.unlinkRangeItem=function(item,revision,isFromAccept){if(this.isTableRevision){this.removeRangeRevisionForItem(item);if(revision.range.length===0){this.owner.revisions.remove(revision);}return false;}var removeChanges=!sf.base.isNullOrUndefined(isFromAccept)&&(revision.revisionType==='MoveFrom'||revision.revisionType==='Deletion')&&isFromAccept||(revision.revisionType==='Insertion'||revision.revisionType==='MoveTo')&&!isFromAccept;if(this.owner.selection.isTOC()){if(removeChanges){this.owner.editor.deleteSelectedContents(this.owner.selection,true);if(revision.range.length===0){this.owner.revisions.remove(revision);}this.isContentRemoved=true;this.owner.editorHistory.currentBaseHistoryInfo.action='BackSpace';}else{while(this.range.length>0){var currentElement=this.range[0];this.removeRangeRevisionForItem(currentElement);if(revision.range.length===0){this.owner.revisions.remove(revision);}}this.owner.editor.addRemovedNodes(this.revisionID);this.owner.editorHistory.currentBaseHistoryInfo.action='AcceptTOC';}return false;}if(item instanceof ElementBox&&!this.canSkipTableItems){if(removeChanges){if(!this.skipeElementRemoval(item)){this.owner.editor.addRemovedNodes(item.clone());}else{this.skipUnLinkElement=true;return true;}}else{this.owner.editorHistory.currentBaseHistoryInfo.action='ClearRevisions';this.updateRevisionID();}}else if(!this.canSkipTableItems&&item instanceof WCharacterFormat&&!removeChanges){this.owner.editorHistory.currentBaseHistoryInfo.action='ClearRevisions';this.updateRevisionID();}else if(item instanceof WRowFormat&&!removeChanges){this.isTableRevision=true;var tableWidget=item.ownerBase.ownerTable;var currentRow=item.ownerBase;this.owner.editorHistory.currentBaseHistoryInfo.action='RemoveRowTrack';this.owner.editor.cloneTableToHistoryInfo(tableWidget);}removeChanges=removeChanges&&!this.canSkipTableItems;if(item instanceof ElementBox&&removeChanges){var currentPara=item.line.paragraph;this.removeRevisionItemsFromRange(item);this.removeItem(item);this.isContentRemoved=true;this.owner.documentHelper.layout.reLayoutParagraph(currentPara,0,0);}else if(item instanceof WCharacterFormat&&removeChanges){this.isContentRemoved=true;this.skipUnLinkElement=false;this.removeRevisionItemsFromRange(item);if(revision.range.length===1){this.owner.editor.deleteSelectedContents(this.owner.selection,true);}else{this.owner.editor.deleteSelectedContents(this.owner.selection,true);var rangeIndex=revision.range.indexOf(item);revision.range.splice(rangeIndex,1);while(this.range.length>0){this.removeRangeRevisionForItem(this.range[0]);}}this.owner.editorHistory.currentBaseHistoryInfo.action='BackSpace';}else if(item instanceof WRowFormat&&removeChanges){var tableWidget=item.ownerBase.ownerTable;var currentRow=item.ownerBase;this.removeRevisionItemsFromRange(item);this.owner.editorHistory.currentBaseHistoryInfo.action='DeleteCells';this.owner.editor.cloneTableToHistoryInfo(tableWidget);this.owner.editor.removeDeletedCellRevision(currentRow);this.isContentRemoved=true;tableWidget.removeChild(tableWidget.childWidgets.indexOf(currentRow));this.canSkipTableItems=true;currentRow.destroy();if(tableWidget.childWidgets.length===0){this.owner.selection.editPosition=this.owner.selection.getHierarchicalIndex(tableWidget,'0');this.owner.editor.removeBlock(tableWidget);tableWidget.destroy();}else{this.owner.editor.updateTable(tableWidget);}}// if the range is of row format, we will remove the row and for history preservation we use whole table to be cloned, hence skipping this part
if(!(item instanceof WRowFormat)||!removeChanges){if(!this.skipUnLinkElement){this.removeRangeRevisionForItem(item);}}if(revision.range.length===0){this.owner.revisions.remove(revision);}return false;};Revision.prototype.updateRevisionID=function(){this.owner.editor.addRemovedNodes(this.revisionID);while(this.range.length>0){this.removeRangeRevisionForItem(this.range[0]);}};/* eslint-disable @typescript-eslint/no-explicit-any */Revision.prototype.removeRevisionItemsFromRange=function(item){if(item.revisions.length>0){for(var revisionIndex=0;revisionIndex<item.revisions.length;revisionIndex++){var currentRevision=item.revisions[revisionIndex];if(this.revisionID!==currentRevision.revisionID){var rangeIndex=currentRevision.range.indexOf(item);item.revisions[revisionIndex].range.splice(rangeIndex,1);}if(currentRevision.range.length===0){this.owner.revisions.remove(currentRevision);}}}};/**
     * Method to clear linked ranges in revision
     *
     * @private
     * @param {any} item - Specifies the item
     * @returns {void}
     */ /* eslint-disable @typescript-eslint/no-explicit-any */Revision.prototype.removeRangeRevisionForItem=function(item){var revisionIndex=item.revisions.indexOf(this);if(revisionIndex>=0){item.revisions.splice(revisionIndex,1);var rangeIndex=this.range.indexOf(item);this.range.splice(rangeIndex,1);}};/**
     * @private
     * @param {Element} element - Specifies the element.
     * @returns {boolean} Resturs skip element removal
     */Revision.prototype.skipeElementRemoval=function(element){var elementPara=element.paragraph;if(elementPara.characterFormat.revisions.length>0){for(var i=0;i<elementPara.characterFormat.revisions.length;i++){var currentRevision=elementPara.characterFormat.revisions[i];var rangeIndex=currentRevision.range.indexOf(element);if(rangeIndex>=0){return true;}}}return false;};Revision.prototype.removeRevisionFromRow=function(row){this.owner.editor.unlinkRangeFromRevision(row.rowFormat);//this.owner.editor.addRemovedRevisionInfo(row.rowFormat, undefined);
for(var i=0;i<row.childWidgets.length;i++){var cellWidget=row.childWidgets[i];this.owner.editor.removeRevisionForCell(cellWidget,false);}};Revision.prototype.removeItem=function(element){var paraWidget=element.line.paragraph;this.owner.editor.unLinkFieldCharacter(element);var elementIndex=element.line.children.indexOf(element);element.line.children.splice(elementIndex,1);this.owner.editor.removeEmptyLine(paraWidget);};Revision.prototype.canSkipCloning=function(){if(!sf.base.isNullOrUndefined(this.owner)&&this.owner.editorHistory&&this.owner.editorHistory.currentBaseHistoryInfo){var baseHistoryInfo=this.owner.editorHistory.currentBaseHistoryInfo;if(baseHistoryInfo.action==='DeleteCells'){return true;}}return false;};/**
     * @private
     * @returns {Revision} - Returns revision
     */Revision.prototype.clone=function(){if(this.canSkipCloning()){return this;}var revision=new Revision(undefined,this.author,this.date);revision.revisionID=this.revisionID;revision.revisionType=this.revisionType;return revision;};/**
     * Method to clone the revisions for the element
     *
     * @param {Revision[]} revisions - revision array.
     * @returns {string[]} - returns clones revisions.
     */Revision.cloneRevisions=function(revisions){var clonedRevisions=[];for(var i=0;i<revisions.length;i++){clonedRevisions.push(revisions[i].revisionID);}return clonedRevisions;};return Revision;}();/**
 * Represents the revision collections in the document.
 */var RevisionCollection=/** @class */function(){function RevisionCollection(owner){/**
         * @private
         */this.changes=[];this.owner=owner;}/**
     * @private
     */RevisionCollection.prototype.get=function(index){if(index>=this.changes.length||index<0){throw new ReferenceError('Provided index is not within the range');}return this.changes[index];};Object.defineProperty(RevisionCollection.prototype,"length",{get:function get(){return this.changes.length;},enumerable:true,configurable:true});RevisionCollection.prototype.remove=function(revision){if(sf.base.isNullOrUndefined(revision)||this.changes.indexOf(revision)<0){return;}this.changes.splice(this.changes.indexOf(revision),1);};/**
     * Method which accepts all the revision in the revision collection
     *
     * @returns {void}
     */RevisionCollection.prototype.acceptAll=function(){if(!this.owner.isReadOnly){this.handleRevisionCollection(true);}};/**
     * Method which rejects all the revision in the revision collection
     *
     * @returns {void}
     */RevisionCollection.prototype.rejectAll=function(){if(!this.owner.isReadOnly){this.handleRevisionCollection(false);}};/**
     * @private
     * @param {boolean} isfromAcceptAll - Specifies the is accept all.
     * @param {Revision[]} changes - Specifies the revisions.
     * @returns {void}
     */RevisionCollection.prototype.handleRevisionCollection=function(isfromAcceptAll,changes){var selection=this.owner.selection;var startPos=selection.start;var endPos=selection.end;if(!selection.start.isExistBefore(selection.end)){startPos=selection.end;endPos=selection.start;}startPos=startPos.clone();endPos=endPos.clone();if(isfromAcceptAll){this.owner.editor.initComplexHistory('Accept All');}else{this.owner.editor.initComplexHistory('Reject All');}var revisionCollec=changes?changes:this.changes;while(revisionCollec.length>0){if(isfromAcceptAll){revisionCollec[0].accept();}else{revisionCollec[0].reject();}if(changes){revisionCollec.splice(0,1);}if(this.owner.enableHeaderAndFooter){this.owner.editor.updateHeaderFooterWidget();}}var textPosition=selection.getTextPosBasedOnLogicalIndex(selection.editPosition);this.owner.selection.selectContent(textPosition,true);if(this.owner.editorHistory){this.owner.editorHistory.updateComplexHistory();}this.owner.editor.reLayout(this.owner.selection,false);};RevisionCollection.prototype.destroy=function(){this.changes=[];};return RevisionCollection;}();/* eslint-disable */ /**
 * @private
 */var WCharacterFormat=/** @class */function(){function WCharacterFormat(node){this.uniqueCharacterFormat=undefined;this.ownerBase=undefined;this.baseCharStyle=undefined;/**
         * @private
         */this.removedIds=[];/**
         * @private
         */this.revisions=[];this.ownerBase=node;}Object.defineProperty(WCharacterFormat.prototype,"bold",{get:function get(){return this.getPropertyValue('bold');},set:function set(value){this.setPropertyValue('bold',value);},enumerable:true,configurable:true});Object.defineProperty(WCharacterFormat.prototype,"italic",{get:function get(){return this.getPropertyValue('italic');},set:function set(value){this.setPropertyValue('italic',value);},enumerable:true,configurable:true});Object.defineProperty(WCharacterFormat.prototype,"fontSize",{get:function get(){return this.getPropertyValue('fontSize');},set:function set(value){this.setPropertyValue('fontSize',value);},enumerable:true,configurable:true});Object.defineProperty(WCharacterFormat.prototype,"fontFamily",{get:function get(){return this.getPropertyValue('fontFamily');},set:function set(value){this.setPropertyValue('fontFamily',value);},enumerable:true,configurable:true});Object.defineProperty(WCharacterFormat.prototype,"underline",{get:function get(){return this.getPropertyValue('underline');},set:function set(value){this.setPropertyValue('underline',value);},enumerable:true,configurable:true});Object.defineProperty(WCharacterFormat.prototype,"strikethrough",{get:function get(){return this.getPropertyValue('strikethrough');},set:function set(value){this.setPropertyValue('strikethrough',value);},enumerable:true,configurable:true});Object.defineProperty(WCharacterFormat.prototype,"baselineAlignment",{get:function get(){return this.getPropertyValue('baselineAlignment');},set:function set(value){this.setPropertyValue('baselineAlignment',value);},enumerable:true,configurable:true});Object.defineProperty(WCharacterFormat.prototype,"highlightColor",{get:function get(){return this.getPropertyValue('highlightColor');},set:function set(value){this.setPropertyValue('highlightColor',value);},enumerable:true,configurable:true});Object.defineProperty(WCharacterFormat.prototype,"fontColor",{get:function get(){return this.getPropertyValue('fontColor');},set:function set(value){this.setPropertyValue('fontColor',value);},enumerable:true,configurable:true});Object.defineProperty(WCharacterFormat.prototype,"bidi",{get:function get(){return this.getPropertyValue('bidi');},set:function set(value){this.setPropertyValue('bidi',value);},enumerable:true,configurable:true});Object.defineProperty(WCharacterFormat.prototype,"bdo",{get:function get(){return this.getPropertyValue('bdo');},set:function set(value){this.setPropertyValue('bdo',value);},enumerable:true,configurable:true});Object.defineProperty(WCharacterFormat.prototype,"boldBidi",{get:function get(){return this.getPropertyValue('boldBidi');},set:function set(value){this.setPropertyValue('boldBidi',value);},enumerable:true,configurable:true});Object.defineProperty(WCharacterFormat.prototype,"italicBidi",{get:function get(){return this.getPropertyValue('italicBidi');},set:function set(value){this.setPropertyValue('italicBidi',value);},enumerable:true,configurable:true});Object.defineProperty(WCharacterFormat.prototype,"fontSizeBidi",{get:function get(){return this.getPropertyValue('fontSizeBidi');},set:function set(value){this.setPropertyValue('fontSizeBidi',value);},enumerable:true,configurable:true});Object.defineProperty(WCharacterFormat.prototype,"fontFamilyBidi",{get:function get(){return this.getPropertyValue('fontFamilyBidi');},set:function set(value){this.setPropertyValue('fontFamilyBidi',value);},enumerable:true,configurable:true});Object.defineProperty(WCharacterFormat.prototype,"allCaps",{get:function get(){return this.getPropertyValue('allCaps');},set:function set(value){this.setPropertyValue('allCaps',value);},enumerable:true,configurable:true});WCharacterFormat.prototype.getPropertyValue=function(property){if(!this.hasValue(property)){var charStyleValue=this.checkCharacterStyle(property);if(!sf.base.isNullOrUndefined(charStyleValue)){return charStyleValue;}else{if(!sf.base.isNullOrUndefined(this.baseCharStyle)){var paragraph=this.ownerBase.paragraph;var line=this.ownerBase.line;if(!sf.base.isNullOrUndefined(paragraph)&&!sf.base.isNullOrUndefined(line)){var length_1=line.children.length;for(var i=0;i<length_1;i++){var element=this.ownerBase.line.children[i];if(element instanceof TextElementBox){var text=element.text;if(text.startsWith('HYPERLINK')){var index=text.indexOf('_Toc');if(index!==-1){this.baseCharStyle=this.ownerBase.paragraph.paragraphFormat.baseStyle;}}}}}}var baseStyleValue=this.checkBaseStyle(property);if(!sf.base.isNullOrUndefined(baseStyleValue)){return baseStyleValue;}}}else{var propertyType=WUniqueFormat.getPropertyType(WCharacterFormat.uniqueFormatType,property);if(!sf.base.isNullOrUndefined(this.uniqueCharacterFormat)&&this.uniqueCharacterFormat.propertiesHash.containsKey(propertyType)){return this.uniqueCharacterFormat.propertiesHash.get(propertyType);}}return this.getDefaultValue(property);};WCharacterFormat.prototype.getDefaultValue=function(property){var propertyType=WUniqueFormat.getPropertyType(WCharacterFormat.uniqueFormatType,property);var docCharacterFormat=this.documentCharacterFormat();if(!sf.base.isNullOrUndefined(docCharacterFormat)&&!sf.base.isNullOrUndefined(docCharacterFormat.uniqueCharacterFormat)&&docCharacterFormat.uniqueCharacterFormat.propertiesHash.containsKey(propertyType)){return docCharacterFormat.uniqueCharacterFormat.propertiesHash.get(propertyType);}else{return WCharacterFormat.getPropertyDefaultValue(property);}};WCharacterFormat.prototype.documentCharacterFormat=function(){var docCharacterFormat;if(!sf.base.isNullOrUndefined(this.ownerBase)){if(!sf.base.isNullOrUndefined(this.ownerBase.paragraph)&&!sf.base.isNullOrUndefined(this.ownerBase.paragraph.bodyWidget)){docCharacterFormat=this.ownerBase.paragraph.bodyWidget.page.documentHelper.characterFormat;}else{if(!sf.base.isNullOrUndefined(this.ownerBase.bodyWidget)){docCharacterFormat=this.ownerBase.bodyWidget.page.documentHelper.characterFormat;}}}return docCharacterFormat;};WCharacterFormat.prototype.checkBaseStyle=function(property){var baseStyle;if(!sf.base.isNullOrUndefined(this.ownerBase)){if(!sf.base.isNullOrUndefined(this.ownerBase.paragraph)){baseStyle=this.ownerBase.paragraph.paragraphFormat.baseStyle;}else{if(this.ownerBase instanceof ParagraphWidget&&!sf.base.isNullOrUndefined(this.ownerBase.paragraphFormat)){baseStyle=this.ownerBase.paragraphFormat.baseStyle;}else{if(!sf.base.isNullOrUndefined(this.ownerBase instanceof WParagraphStyle)){baseStyle=this.ownerBase.basedOn;}}}}while(!sf.base.isNullOrUndefined(baseStyle)){if(baseStyle.characterFormat.hasValue(property)){break;}else{baseStyle=baseStyle.basedOn;}}if(!sf.base.isNullOrUndefined(baseStyle)){var propertyType=WUniqueFormat.getPropertyType(WCharacterFormat.uniqueFormatType,property);return baseStyle.characterFormat.uniqueCharacterFormat.propertiesHash.get(propertyType);}return undefined;};WCharacterFormat.prototype.checkCharacterStyle=function(property){var baseStyle=this.baseCharStyle;if(!sf.base.isNullOrUndefined(baseStyle)){while(!sf.base.isNullOrUndefined(baseStyle)&&baseStyle.name!=='Default Paragraph Font'){var hasKey=baseStyle.characterFormat.hasValue(property);if(hasKey){var returnPropertyType=WUniqueFormat.getPropertyType(WCharacterFormat.uniqueFormatType,property);return baseStyle.characterFormat.uniqueCharacterFormat.propertiesHash.get(returnPropertyType);}else{baseStyle=baseStyle.basedOn;}}}return undefined;};WCharacterFormat.prototype.setPropertyValue=function(property,value){if(sf.base.isNullOrUndefined(value)||value===''){value=WCharacterFormat.getPropertyDefaultValue(property);}if(sf.base.isNullOrUndefined(this.uniqueCharacterFormat)){this.initializeUniqueCharacterFormat(property,value);}else{var propertyType=WUniqueFormat.getPropertyType(this.uniqueCharacterFormat.uniqueFormatType,property);if(this.uniqueCharacterFormat.propertiesHash.containsKey(propertyType)&&this.uniqueCharacterFormat.propertiesHash.get(propertyType)===value){//Do nothing, since no change in property value and return
return;}this.uniqueCharacterFormat=WCharacterFormat.uniqueCharacterFormats.updateUniqueFormat(this.uniqueCharacterFormat,property,value);}};WCharacterFormat.prototype.initializeUniqueCharacterFormat=function(property,propValue){var uniqueCharFormatTemp=new Dictionary();this.addUniqueCharacterFormat('fontColor',property,propValue,uniqueCharFormatTemp);this.addUniqueCharacterFormat('fontFamily',property,propValue,uniqueCharFormatTemp);this.addUniqueCharacterFormat('fontSize',property,propValue,uniqueCharFormatTemp);this.addUniqueCharacterFormat('bold',property,propValue,uniqueCharFormatTemp);this.addUniqueCharacterFormat('italic',property,propValue,uniqueCharFormatTemp);this.addUniqueCharacterFormat('underline',property,propValue,uniqueCharFormatTemp);this.addUniqueCharacterFormat('strikethrough',property,propValue,uniqueCharFormatTemp);this.addUniqueCharacterFormat('baselineAlignment',property,propValue,uniqueCharFormatTemp);this.addUniqueCharacterFormat('highlightColor',property,propValue,uniqueCharFormatTemp);this.addUniqueCharacterFormat('styleName',property,propValue,uniqueCharFormatTemp);this.addUniqueCharacterFormat('bidi',property,propValue,uniqueCharFormatTemp);this.addUniqueCharacterFormat('bdo',property,propValue,uniqueCharFormatTemp);this.addUniqueCharacterFormat('fontFamilyBidi',property,propValue,uniqueCharFormatTemp);this.addUniqueCharacterFormat('fontSizeBidi',property,propValue,uniqueCharFormatTemp);this.addUniqueCharacterFormat('boldBidi',property,propValue,uniqueCharFormatTemp);this.addUniqueCharacterFormat('italicBidi',property,propValue,uniqueCharFormatTemp);this.addUniqueCharacterFormat('allCaps',property,propValue,uniqueCharFormatTemp);this.uniqueCharacterFormat=WCharacterFormat.uniqueCharacterFormats.addUniqueFormat(uniqueCharFormatTemp,WCharacterFormat.uniqueFormatType);};WCharacterFormat.prototype.addUniqueCharacterFormat=function(property,modifiedProperty,propValue,uniqueCharFormatTemp){var propertyType=WUniqueFormat.getPropertyType(WCharacterFormat.uniqueFormatType,property);if(property===modifiedProperty){uniqueCharFormatTemp.add(propertyType,propValue);}};WCharacterFormat.getPropertyDefaultValue=function(property){var value=undefined;switch(property){case'bold':value=false;break;case'italic':value=false;break;case'fontSize':value=11;break;case'underline':value='None';break;case'strikethrough':value='None';break;case'baselineAlignment':value='Normal';break;case'highlightColor':value='NoColor';break;case'fontColor':value='#00000000';break;case'fontFamily':value='Calibri';break;case'styleName':value='Default Paragraph Font';break;case'bidi':value=false;break;case'bdo':value='None';break;case'boldBidi':value=false;break;case'italicBidi':value=false;break;case'fontSizeBidi':value=11;break;case'fontFamilyBidi':value='Calibri';break;case'allCaps':value=false;break;}return value;};WCharacterFormat.prototype.isEqualFormat=function(format){return this.fontSize===format.fontSize&&this.fontFamily===format.fontFamily&&this.bold===format.bold&&this.italic===format.italic&&this.baselineAlignment===format.baselineAlignment&&this.underline===format.underline&&this.fontColor===format.fontColor&&this.strikethrough===format.strikethrough&&this.highlightColor===format.highlightColor&&this.bidi===format.bidi&&this.bdo===format.bdo&&this.allCaps===format.allCaps;};WCharacterFormat.prototype.isSameFormat=function(format){return this.baseCharStyle===format.baseCharStyle&&this.uniqueCharacterFormat===format.uniqueCharacterFormat;};WCharacterFormat.prototype.cloneFormat=function(){var format=new WCharacterFormat(undefined);format.uniqueCharacterFormat=this.uniqueCharacterFormat;format.baseCharStyle=this.baseCharStyle;if(this.revisions.length>0){format.removedIds=Revision.cloneRevisions(this.revisions);}else{format.removedIds=this.removedIds.slice();}return format;};WCharacterFormat.prototype.hasValue=function(property){if(!sf.base.isNullOrUndefined(this.uniqueCharacterFormat)&&!sf.base.isNullOrUndefined(this.uniqueCharacterFormat.propertiesHash)){var propertyType=WUniqueFormat.getPropertyType(this.uniqueCharacterFormat.uniqueFormatType,property);return this.uniqueCharacterFormat.propertiesHash.containsKey(propertyType);}return false;};WCharacterFormat.prototype.clearFormat=function(){if(!sf.base.isNullOrUndefined(this.uniqueCharacterFormat)&&this.uniqueCharacterFormat.referenceCount===0){WCharacterFormat.uniqueCharacterFormats.remove(this.uniqueCharacterFormat);}this.uniqueCharacterFormat=undefined;this.baseCharStyle=undefined;};WCharacterFormat.prototype.destroy=function(){this.clearFormat();};WCharacterFormat.prototype.copyFormat=function(format){if(!sf.base.isNullOrUndefined(format)){if(!sf.base.isNullOrUndefined(format.uniqueCharacterFormat)&&format.uniqueCharacterFormat.propertiesHash){this.updateUniqueCharacterFormat(format);}if(!sf.base.isNullOrUndefined(format.baseCharStyle)){this.baseCharStyle=format.baseCharStyle;}if(format.revisions.length>0){this.removedIds=Revision.cloneRevisions(format.revisions);}else{this.removedIds=format.removedIds.slice();}}};WCharacterFormat.prototype.updateUniqueCharacterFormat=function(format){var hash=undefined;if(this.uniqueCharacterFormat){hash=this.uniqueCharacterFormat.mergeProperties(format.uniqueCharacterFormat);if(this.uniqueCharacterFormat.referenceCount===0){WCharacterFormat.uniqueCharacterFormats.remove(this.uniqueCharacterFormat);this.uniqueCharacterFormat=undefined;}}this.uniqueCharacterFormat=new WUniqueFormat(WCharacterFormat.uniqueFormatType);if(sf.base.isNullOrUndefined(hash)){hash=this.uniqueCharacterFormat.mergeProperties(format.uniqueCharacterFormat);}this.uniqueCharacterFormat=WCharacterFormat.uniqueCharacterFormats.addUniqueFormat(hash,WCharacterFormat.uniqueFormatType);};WCharacterFormat.clear=function(){this.uniqueCharacterFormats.clear();};WCharacterFormat.prototype.applyStyle=function(baseCharStyle){this.baseCharStyle=baseCharStyle;};WCharacterFormat.prototype.getValue=function(property){return this.hasValue(property)?this.getPropertyValue(property):undefined;};WCharacterFormat.prototype.mergeFormat=function(format){if(sf.base.isNullOrUndefined(this.getValue('bold'))){this.bold=format.getValue('bold');}if(sf.base.isNullOrUndefined(this.getValue('italic'))){this.italic=format.getValue('italic');}if(sf.base.isNullOrUndefined(this.getValue('fontSize'))){this.fontSize=format.getValue('fontSize');}if(sf.base.isNullOrUndefined(this.getValue('fontFamily'))){this.fontFamily=format.getValue('fontFamily');}if(sf.base.isNullOrUndefined(this.getValue('underline'))){this.underline=format.getValue('underline');}if(sf.base.isNullOrUndefined(this.getValue('strikethrough'))){this.strikethrough=format.getValue('strikethrough');}if(sf.base.isNullOrUndefined(this.getValue('baselineAlignment'))){this.baselineAlignment=format.getValue('baselineAlignment');}if(sf.base.isNullOrUndefined(this.getValue('highlightColor'))){this.highlightColor=format.getValue('highlightColor');}if(sf.base.isNullOrUndefined(this.getValue('fontColor'))){this.fontColor=format.getValue('fontColor');}if(sf.base.isNullOrUndefined(this.getValue('bidi'))){this.bidi=format.getValue('bidi');}if(sf.base.isNullOrUndefined(this.getValue('bdo'))){this.bdo=format.getValue('bdo');}if(sf.base.isNullOrUndefined(this.getValue('allCaps'))){this.allCaps=format.getValue('allCaps');}};WCharacterFormat.uniqueCharacterFormats=new WUniqueFormats();WCharacterFormat.uniqueFormatType=2;return WCharacterFormat;}();/**
 * @private
 */var WListLevel=/** @class */function(){function WListLevel(node){this.uniqueListLevel=undefined;this.paragraphFormat=undefined;this.characterFormat=undefined;if(node instanceof WAbstractList){this.ownerBase=node;}else{this.ownerBase=node;}this.characterFormat=new WCharacterFormat(undefined);this.paragraphFormat=new WParagraphFormat(undefined);}Object.defineProperty(WListLevel.prototype,"listLevelPattern",{get:function get(){return this.getPropertyValue('listLevelPattern');},set:function set(listLevelPattern){this.setPropertyValue('listLevelPattern',listLevelPattern);},enumerable:true,configurable:true});Object.defineProperty(WListLevel.prototype,"followCharacter",{get:function get(){return this.getPropertyValue('followCharacter');},set:function set(followCharacter){this.setPropertyValue('followCharacter',followCharacter);},enumerable:true,configurable:true});Object.defineProperty(WListLevel.prototype,"startAt",{get:function get(){return this.getPropertyValue('startAt');},set:function set(startAt){this.setPropertyValue('startAt',startAt);},enumerable:true,configurable:true});Object.defineProperty(WListLevel.prototype,"numberFormat",{get:function get(){return this.getPropertyValue('numberFormat');},set:function set(numberFormat){this.setPropertyValue('numberFormat',numberFormat);},enumerable:true,configurable:true});Object.defineProperty(WListLevel.prototype,"restartLevel",{get:function get(){return this.getPropertyValue('restartLevel');},set:function set(restartLevel){this.setPropertyValue('restartLevel',restartLevel);},enumerable:true,configurable:true});/* eslint-disable */WListLevel.prototype.getPropertyValue=function(property){var propertyType=WUniqueFormat.getPropertyType(WListLevel.uniqueFormatType,property);if(!sf.base.isNullOrUndefined(this.uniqueListLevel)&&this.uniqueListLevel.propertiesHash.containsKey(propertyType)){return this.uniqueListLevel.propertiesHash.get(propertyType);}return WListLevel.getPropertyDefaultValue(property);};WListLevel.prototype.setPropertyValue=function(property,value){if(sf.base.isNullOrUndefined(value)||value===''){value=WListLevel.getPropertyDefaultValue(property);}if(sf.base.isNullOrUndefined(this.uniqueListLevel)){this.initializeUniqueWListLevel(property,value);}else{var propertyType=WUniqueFormat.getPropertyType(this.uniqueListLevel.uniqueFormatType,property);if(this.uniqueListLevel.propertiesHash.containsKey(propertyType)&&this.uniqueListLevel.propertiesHash.get(propertyType)===value){//Do nothing, since no change in property value and return
return;}this.uniqueListLevel=WListLevel.uniqueListLevels.updateUniqueFormat(this.uniqueListLevel,property,value);}};WListLevel.prototype.initializeUniqueWListLevel=function(property,propValue){var uniqueListLevelTemp=new Dictionary();this.addUniqueWListLevel('listLevelPattern',property,propValue,uniqueListLevelTemp);this.addUniqueWListLevel('startAt',property,propValue,uniqueListLevelTemp);this.addUniqueWListLevel('followCharacter',property,propValue,uniqueListLevelTemp);this.addUniqueWListLevel('numberFormat',property,propValue,uniqueListLevelTemp);this.addUniqueWListLevel('restartLevel',property,propValue,uniqueListLevelTemp);this.uniqueListLevel=WListLevel.uniqueListLevels.addUniqueFormat(uniqueListLevelTemp,WListLevel.uniqueFormatType);};WListLevel.prototype.addUniqueWListLevel=function(property,modifiedProperty,propValue,uniqueCharFormatTemp){var propertyType;propertyType=WUniqueFormat.getPropertyType(WListLevel.uniqueFormatType,property);if(property===modifiedProperty){uniqueCharFormatTemp.add(propertyType,propValue);}else{uniqueCharFormatTemp.add(propertyType,WListLevel.getPropertyDefaultValue(property));}};WListLevel.getPropertyDefaultValue=function(property){/* eslint-disable */var value=undefined;switch(property){case'listLevelPattern':value='Arabic';break;case'startAt':value=0;break;case'followCharacter':value='Tab';break;case'numberFormat':value='';break;case'restartLevel':value=0;break;}return value;/* eslint-enable */};WListLevel.prototype.destroy=function(){if(!sf.base.isNullOrUndefined(this.characterFormat)){this.characterFormat.destroy();}if(!sf.base.isNullOrUndefined(this.paragraphFormat)){this.paragraphFormat.destroy();}if(!sf.base.isNullOrUndefined(this.uniqueListLevel)){WListLevel.uniqueListLevels.remove(this.uniqueListLevel);}this.uniqueListLevel=undefined;this.characterFormat=undefined;this.paragraphFormat=undefined;};WListLevel.clear=function(){this.uniqueListLevels.clear();};WListLevel.prototype.clone=function(node){var listLevel=new WListLevel(node);listLevel.paragraphFormat=this.paragraphFormat.cloneFormat();listLevel.characterFormat=this.characterFormat.cloneFormat();if(this.uniqueListLevel){listLevel.uniqueListLevel=this.uniqueListLevel;listLevel.uniqueListLevel.referenceCount++;}return listLevel;};WListLevel.dotBullet="\uF0B7";WListLevel.squareBullet="\uF0A7";//Symbol font \u25aa.
WListLevel.arrowBullet="\u27A4";WListLevel.circleBullet="\uF06F"+" ";WListLevel.uniqueListLevels=new WUniqueFormats();WListLevel.uniqueFormatType=9;return WListLevel;}();/**
 * @private
 */var Layout=/** @class */function(){function Layout(documentHelper){this.islayoutFootnote=false;/**
         * @private
         */this.allowLayout=true;/**
         * @private
         */this.footHeight=0;/**
         * @private
         */this.footnoteHeight=0;/**
         * @private
         */this.isTableFootNote=false;/**
         * @private
         */this.isRelayout=false;/**
         * @private
         */this.isRelayoutneed=false;/**
         * @private
         */this.isOverlapFloatTable=false;this.isInitialLoad=true;this.fieldBegin=undefined;this.maxTextHeight=0;this.maxBaseline=0;this.maxTextBaseline=0;this.isFieldCode=false;this.isRtlFieldCode=false;this.isRTLLayout=false;this.currentCell=undefined;this.isFootnoteContentChanged=false;this.isEndnoteContentChanged=false;this.keepWithNext=false;this.isLayoutWhole=false;/**
         * @private
         */this.isBidiReLayout=false;/**
         * @private
         */this.defaultTabWidthPixel=48;/**
         * @private
         */this.isRelayoutFootnote=false;this.isRelayoutOverlap=false;this.isWrapText=false;this.isYPositionUpdated=false;this.isXPositionUpdated=false;this.hasFloatingElement=false;this.isFootNoteLayoutStart=false;this.wrapPosition=[];this.shiftedFloatingItemsFromTable=[];this.documentHelper=documentHelper;}Layout.prototype.isSameStyle=function(currentParagraph,isAfterSpacing){var nextOrPrevSibling=undefined;if(isAfterSpacing){if(currentParagraph.nextWidget instanceof ParagraphWidget){nextOrPrevSibling=currentParagraph.nextWidget;}}else{if(currentParagraph.previousWidget instanceof ParagraphWidget){nextOrPrevSibling=currentParagraph.previousWidget;}}if(sf.base.isNullOrUndefined(nextOrPrevSibling)){return false;}if(currentParagraph.paragraphFormat.baseStyle===nextOrPrevSibling.paragraphFormat.baseStyle){return currentParagraph.paragraphFormat.contextualSpacing;}return false;};Object.defineProperty(Layout.prototype,"viewer",{get:function get(){return this.documentHelper.owner.viewer;},enumerable:true,configurable:true});Layout.prototype.layout=function(){// Todo: Need to handle complete document layout(relayout).
//const page: Page = this.documentHelper.pages[0];
//const body: BodyWidget = page.bodyWidgets[0];
};/**
     * Releases un-managed and - optionally - managed resources.
     *
     * @returns {void}
     */Layout.prototype.destroy=function(){this.documentHelper=undefined;this.value=undefined;this.allowLayout=undefined;this.isInitialLoad=undefined;this.fieldBegin=undefined;this.maxTextHeight=undefined;this.maxBaseline=undefined;this.maxTextBaseline=undefined;this.isFieldCode=undefined;this.footnoteHeight=undefined;};Layout.prototype.layoutItems=function(sections,isReLayout){var _this=this;var page;for(var i=0;i<sections.length;i++){var section=sections[i];var lastpage=this.documentHelper.pages[this.documentHelper.pages.length-1];// eslint-disable-next-line max-len
if(i>0&&sections[i-1].lastChild.isEndsWithPageBreak&&lastpage.bodyWidgets[0].childWidgets.length===0){this.documentHelper.pages.splice(this.documentHelper.pages.length-1,1);}page=this.viewer.createNewPage(section);this.addBodyWidget(this.viewer.clientActiveArea,section);if(this.documentHelper.pages.length>1){var pageIndex=0;for(var i_1=0;i_1<this.documentHelper.pages.length;i_1++){var prevPage=this.documentHelper.pages[i_1];var prevSectionIndex=prevPage.sectionIndex;var index=section.index;if(prevSectionIndex>index||prevPage===page){break;}pageIndex++;}if(pageIndex<this.documentHelper.pages.length-1){this.documentHelper.insertPage(pageIndex,page);}}this.layoutSection(section,0);}if(!isReLayout){this.layoutComments(this.documentHelper.comments);}this.updateFieldElements();if(this.documentHelper.owner.layoutType==='Pages'){this.layoutEndNoteElement();}/* tslint:disable:align */setTimeout(function(){if(_this.documentHelper){_this.documentHelper.isScrollHandler=true;if(_this.documentHelper.owner.isSpellCheck&&_this.documentHelper.owner.spellChecker.enableOptimizedSpellCheck){_this.documentHelper.triggerElementsOnLoading=true;}_this.documentHelper.clearContent();_this.viewer.updateScrollBars();// Update cursor after document change in Blazor
if(!sf.base.isNullOrUndefined(_this.documentHelper.owner.selection)){_this.documentHelper.owner.selection.updateCaretPosition();}_this.documentHelper.isScrollHandler=false;_this.isInitialLoad=false;}},50);};Layout.prototype.layoutComments=function(comments){if(!sf.base.isNullOrUndefined(comments)){//this.viewer.owner.commentReviewPane.layoutComments();
}};Layout.prototype.layoutSection=function(section,index){var block=section.firstChild;var nextBlock;var prevBlock;do{if(block instanceof TableWidget&&block.tableFormat.preferredWidthType==='Auto'&&!block.tableFormat.allowAutoFit){block.calculateGrid();}this.viewer.updateClientAreaForBlock(block,true);nextBlock=this.layoutBlock(block,index);index=0;this.viewer.updateClientAreaForBlock(block,false);if(prevBlock&&sf.base.isNullOrUndefined(prevBlock.nextWidget)&&prevBlock.bodyWidget&&prevBlock.bodyWidget.page.footnoteWidget){this.layoutfootNote(prevBlock.bodyWidget.page.footnoteWidget);}prevBlock=block;block=nextBlock;if(sf.base.isNullOrUndefined(block)&&prevBlock.bodyWidget.page.footnoteWidget){this.layoutfootNote(prevBlock.bodyWidget.page.footnoteWidget);}}while(block);};Layout.prototype.layoutHeaderFooter=function(section,viewer,page){//Header layout
var headerFooterWidget=viewer.getCurrentPageHeaderFooter(section,true);if(headerFooterWidget){var header=headerFooterWidget.clone();header.page=page;this.updateRevisionsToHeaderFooter(header,page);viewer.updateHFClientArea(section.sectionFormat,true);page.headerWidget=this.layoutHeaderFooterItems(viewer,header);this.updateHeaderFooterToParent(header);}//Footer Layout
headerFooterWidget=viewer.getCurrentPageHeaderFooter(section,false);if(headerFooterWidget){var footer=headerFooterWidget.clone();footer.page=page;viewer.updateHFClientArea(section.sectionFormat,false);this.updateRevisionsToHeaderFooter(footer,page);page.footerWidget=this.layoutHeaderFooterItems(viewer,footer);this.updateHeaderFooterToParent(footer);}};Layout.prototype.updateHeaderFooterToParent=function(node){var sectionIndex=node.page.sectionIndex;var typeIndex=this.viewer.getHeaderFooter(node.headerFooterType);var clone=node.clone();this.documentHelper.headersFooters[sectionIndex][typeIndex]=clone;for(var j=0;j<clone.childWidgets.length;j++){var child=clone.childWidgets[j];if(child instanceof TableWidget){this.clearTableWidget(child,false,true);}}return clone;};/* eslint-disable @typescript-eslint/no-explicit-any */Layout.prototype.updateRevisionsToHeaderFooter=function(clone,page){var childWidge=clone.childWidgets;if(clone instanceof HeaderFooterWidget&&childWidge.length>0){for(var i=0;i<childWidge.length;i++){if(childWidge[i].childWidgets.length>0){var lineWidge=childWidge[i].childWidgets;for(var j=0;j<lineWidge.length;j++){var childrens=lineWidge[j].children;if(childrens){for(var k=0;k<childrens.length;k++){if(childrens[k].removedIds.length>0){var removeId=childrens[k].removedIds;for(var l=0;l<removeId.length;l++){var revision=this.documentHelper.revisionsInternal.get(removeId[l]);childrens[k].revisions[l]=revision;this.updateRevisionRange(revision,page);}}}}}}}}};Layout.prototype.updateRevisionRange=function(revision,page){for(var i=0;i<revision.range.length;i++){var inline=revision.range[i];if(!inline.line.paragraph.bodyWidget.page){inline.line.paragraph.bodyWidget.page=page;}}};Layout.prototype.linkFieldInHeaderFooter=function(widget){var firstChild=widget.firstChild;do{if(firstChild instanceof ParagraphWidget){this.linkFieldInParagraph(firstChild);}else{this.linkFieldInTable(firstChild);}/* eslint-disable no-cond-assign */}while(firstChild=firstChild.nextWidget);};Layout.prototype.linkFieldInParagraph=function(widget){for(var j=0;j<widget.childWidgets.length;j++){var line=widget.childWidgets[j];for(var i=0;i<line.children.length;i++){var element=line.children[i];if(element instanceof FieldElementBox&&(element.fieldType!==0||element.fieldType===0&&this.documentHelper.fields.indexOf(element)===-1)){element.linkFieldCharacter(this.documentHelper);}if(element instanceof FieldTextElementBox&&element.fieldBegin!==element.previousElement.fieldBegin){element.fieldBegin=element.previousElement.fieldBegin;}if(element instanceof ShapeElementBox){var firstBlock=element.textFrame.firstChild;do{if(firstBlock instanceof ParagraphWidget){this.linkFieldInParagraph(firstBlock);}else{this.linkFieldInTable(firstBlock);}/* eslint-disable no-cond-assign */}while(firstBlock=firstBlock.nextWidget);}}}};Layout.prototype.linkFieldInTable=function(widget){for(var i=0;i<widget.childWidgets.length;i++){var row=widget.childWidgets[i];for(var j=0;j<row.childWidgets.length;j++){var cell=row.childWidgets[j];for(var k=0;k<cell.childWidgets.length;k++){var block=cell.childWidgets[k];if(block instanceof ParagraphWidget){this.linkFieldInParagraph(block);}else{this.linkFieldInTable(block);}}}}};Layout.prototype.layoutHeaderFooterItems=function(viewer,widget){this.viewer.updateClientAreaLocation(widget,viewer.clientActiveArea);if(widget.childWidgets.length===0){var pargaraph=new ParagraphWidget();var line=new LineWidget(pargaraph);pargaraph.childWidgets.push(line);widget.childWidgets.push(pargaraph);pargaraph.containerWidget=widget;}this.linkFieldInHeaderFooter(widget);for(var i=0;i<widget.childWidgets.length;i++){var block=widget.childWidgets[i];if(block instanceof TableWidget&&block.tableFormat.preferredWidthType==='Auto'&&!block.tableFormat.allowAutoFit&&!block.isGridUpdated){block.calculateGrid();}viewer.updateClientAreaForBlock(block,true);this.layoutBlock(block,0);viewer.updateClientAreaForBlock(block,false);}var type=widget.headerFooterType;if(type==='OddFooter'||type==='EvenFooter'||type==='FirstPageFooter'){this.shiftChildLocation(viewer.clientArea.y-viewer.clientActiveArea.y,widget);}return widget;};Layout.prototype.shiftChildLocation=function(shiftTop,bodyWidget){var widgetTop=bodyWidget.y+shiftTop;var footerMaxHeight=bodyWidget.page.boundingRectangle.height-bodyWidget.page.boundingRectangle.height/100*40;widgetTop=Math.max(widgetTop,footerMaxHeight);shiftTop=widgetTop-bodyWidget.y;var childTop=bodyWidget.y=widgetTop;for(var i=0;i<bodyWidget.childWidgets.length;i++){var childWidget=bodyWidget.childWidgets[i];if(childWidget instanceof ParagraphWidget){var widget=childWidget.childWidgets[0];childWidget.x=childWidget.x;childWidget.y=i===0?childWidget.y+shiftTop:childTop;childTop+=childWidget.height;for(var j=0;j<widget.children.length;j++){var element=widget.children[j];if(element instanceof ShapeElementBox){element.y=childWidget.y+element.verticalPosition;}}}else{this.shiftChildLocationForTableWidget(childWidget,shiftTop);childTop+=childWidget.height;}}};Layout.prototype.shiftChildLocationForTableWidget=function(tableWidget,shiftTop){tableWidget.y=tableWidget.y+shiftTop;for(var i=0;i<tableWidget.childWidgets.length;i++){var childWidget=tableWidget.childWidgets[i];if(childWidget instanceof TableRowWidget){this.shiftChildLocationForTableRowWidget(childWidget,shiftTop);}}};Layout.prototype.shiftChildLocationForTableRowWidget=function(rowWidget,shiftTop){rowWidget.y=rowWidget.y+shiftTop;for(var i=0;i<rowWidget.childWidgets.length;i++){this.shiftChildLocationForTableCellWidget(rowWidget.childWidgets[i],shiftTop);}};Layout.prototype.shiftChildLocationForTableCellWidget=function(cellWidget,shiftTop){cellWidget.y=cellWidget.y+shiftTop;for(var i=0;i<cellWidget.childWidgets.length;i++){if(cellWidget.childWidgets[i]instanceof ParagraphWidget){cellWidget.childWidgets[i].x=cellWidget.childWidgets[i].x;cellWidget.childWidgets[i].y=cellWidget.childWidgets[i].y+shiftTop;}else{this.shiftChildLocationForTableWidget(cellWidget.childWidgets[i],shiftTop);}}};Layout.prototype.layoutBlock=function(block,index){var nextBlock;if(block instanceof ParagraphWidget){nextBlock=this.layoutParagraph(block,index);var nextBlockToLayout=this.checkAndRelayoutPreviousOverlappingBlock(nextBlock.getSplitWidgets()[0]);if(nextBlockToLayout){nextBlock=nextBlockToLayout;}}else{block.calculateGrid();block.isGridUpdated=false;block.buildTableColumns();block.isGridUpdated=true;nextBlock=this.layoutTable(block,index);this.checkAndRelayoutPreviousOverlappingBlock(block);this.updateTableYPositionBasedonTextWrap(nextBlock);}return nextBlock.nextRenderedWidget;};Layout.prototype.updateTableYPositionBasedonTextWrap=function(table){var _this=this;if(!sf.base.isNullOrUndefined(table.bodyWidget)){var tableY_1=table.y;var tableRect_1=new Rect(table.x,table.y,table.width,table.height);table.bodyWidget.floatingElements.forEach(function(shape){if(shape instanceof ShapeElementBox&&!shape.paragraph.isInsideTable){var shapeRect=new Rect(shape.x,shape.y,shape.width,shape.height);var considerShape=shape.textWrappingStyle==='TopAndBottom'||shape.textWrappingStyle==='Square';if(considerShape&&tableRect_1.isIntersecting(shapeRect)){table.y=shape.y+shape.height+shape.distanceBottom;_this.updateChildLocationForTable(table.y,table);var height=table.y-tableY_1;_this.viewer.cutFromTop(_this.viewer.clientActiveArea.y+height);}}});}};Layout.prototype.checkAndRelayoutPreviousOverlappingBlock=function(block){if(!(block.containerWidget instanceof TextFrame)&&!this.isRelayoutOverlap){var preivousBlock=block.previousWidget;if(block instanceof ParagraphWidget){if(block.floatingElements.length>0){for(var i=0;i<block.floatingElements.length;i++){var element=block.floatingElements[i];if(element.textWrappingStyle==='InFrontOfText'||element.textWrappingStyle==='Behind'){continue;}var shapeRect=new Rect(element.x,element.y,element.width,element.height);while(preivousBlock){if(preivousBlock instanceof ParagraphWidget){// eslint-disable-next-line max-len
var paraRect=new Rect(preivousBlock.x,preivousBlock.y,preivousBlock.width,preivousBlock.height);if(shapeRect.isIntersecting(paraRect)&&this.startOverlapWidget!==preivousBlock){this.startOverlapWidget=preivousBlock;this.endOverlapWidget=block;}}preivousBlock=preivousBlock.previousWidget;}preivousBlock=block.previousWidget;}}else{var widget=block.getSplitWidgets();if(widget){return widget[widget.length-1];}}}else{var table=block;if(!table.wrapTextAround){return table;}var tableRect=new Rect(table.x,table.y,table.getTableCellWidth(),table.height);while(preivousBlock){if(preivousBlock instanceof ParagraphWidget){var blockRect=new Rect(preivousBlock.x,preivousBlock.y,preivousBlock.width,preivousBlock.height);if(tableRect.isIntersecting(blockRect)&&this.startOverlapWidget!==preivousBlock){this.startOverlapWidget=preivousBlock;this.endOverlapWidget=block;}}preivousBlock=preivousBlock.previousWidget;}preivousBlock=block.previousWidget;}if(this.startOverlapWidget){this.isRelayoutOverlap=true;this.layoutStartEndBlocks(this.startOverlapWidget,block);this.isRelayoutOverlap=false;}this.startOverlapWidget=undefined;this.endOverlapWidget=undefined;}return block;};Layout.prototype.addParagraphWidget=function(area,paragraphWidget){// const ownerParaWidget: ParagraphWidget = undefined;
if(paragraphWidget.isEmpty()&&!sf.base.isNullOrUndefined(paragraphWidget.paragraphFormat)&&(paragraphWidget.paragraphFormat.textAlignment==='Center'||paragraphWidget.paragraphFormat.textAlignment==='Right')&&paragraphWidget.paragraphFormat.listFormat.listId===-1){// const top: number = 0;
// const bottom: number = 0;
var width=this.documentHelper.textHelper.getParagraphMarkWidth(paragraphWidget.characterFormat);var left=area.x;if(paragraphWidget.paragraphFormat.textAlignment==='Center'){left+=(area.width-width)/2;}else{left+=area.width-width;}paragraphWidget.width=width;paragraphWidget.x=left;paragraphWidget.y=area.y;}else{paragraphWidget.width=area.width;paragraphWidget.x=area.x;paragraphWidget.y=area.y;}return paragraphWidget;};Layout.prototype.addLineWidget=function(paragraphWidget){var line=undefined;line=new LineWidget(paragraphWidget);line.width=paragraphWidget.width;paragraphWidget.childWidgets.push(line);line.paragraph=paragraphWidget;return line;};Layout.prototype.isFirstElementWithPageBreak=function(paragraphWidget){var isPageBreak=false;if(this.viewer instanceof PageLayoutViewer){var lineWidget=paragraphWidget.childWidgets[0];if(lineWidget){var element=lineWidget.children[0];while(element){if(element instanceof BookmarkElementBox&&element.name.indexOf('_')>=0){element=element.nextElement;continue;}if(element instanceof TextElementBox&&element.text==='\f'){isPageBreak=true;}break;}}}return isPageBreak;};/**
     * Layouts specified paragraph.
     *
     * @private
     * @param footnote
     */Layout.prototype.layoutfootNote=function(footnote){if(this.documentHelper.owner.layoutType==='Pages'){var clientActiveArea=this.viewer.clientActiveArea;var clientArea=this.viewer.clientArea;if(footnote.footNoteType==='Footnote'){this.viewer.updateFootnoteClientArea(footnote.sectionFormat,footnote);}var paragraph=void 0;this.isRelayoutFootnote=false;// eslint-disable-next-line max-len
this.viewer.clientActiveArea.y=this.viewer.clientActiveArea.y-footnote.page.footerWidget.height+footnote.page.bodyWidgets[0].sectionFormat.footerDistance;for(var i=0;i<footnote.childWidgets.length;i++){paragraph=footnote.childWidgets[i];paragraph.index=i;paragraph.containerWidget=footnote;// paragraph.index = i > 1 ? i - 1 : 0;
this.viewer.updateClientAreaForBlock(paragraph,true);this.layoutBlock(paragraph,0);if(i===0){footnote.y=paragraph.y;}this.viewer.updateClientAreaForBlock(paragraph,false);}this.viewer.clientActiveArea=clientActiveArea;this.viewer.clientArea=clientArea;// eslint-disable-next-line max-len
if(footnote.page.bodyWidgets[0].lastChild instanceof TableWidget&&footnote.page.bodyWidgets[0].lastChild.y+footnote.page.bodyWidgets[0].lastChild.height>footnote.y){this.reLayoutTable(footnote.page.bodyWidgets[0].lastChild,true);}}return footnote;};Layout.prototype.layoutParagraph=function(paragraph,lineIndex){this.addParagraphWidget(this.viewer.clientActiveArea,paragraph);var isListLayout=true;var isFirstElmIsparagraph=this.isFirstElementWithPageBreak(paragraph);if(!isFirstElmIsparagraph){this.layoutListItems(paragraph);isListLayout=false;}if(paragraph.isEmpty()){this.layoutEmptyLineWidget(paragraph,true);}else{var line=lineIndex<paragraph.childWidgets.length?paragraph.childWidgets[lineIndex]:undefined;if(!this.isRelayoutOverlap&&!(paragraph.containerWidget instanceof TextFrame)){this.layoutFloatElements(paragraph);}while(line instanceof LineWidget){if(paragraph!==line.paragraph&&line.indexInOwner===0&&isListLayout){this.layoutListItems(line.paragraph);}if(line.isFirstLine()&&sf.base.isNullOrUndefined(this.fieldBegin)){if(!sf.base.isNullOrUndefined(paragraph.paragraphFormat)){var firstLineIndent=-HelperMethods.convertPointToPixel(paragraph.paragraphFormat.firstLineIndent);this.viewer.updateClientWidth(firstLineIndent);}}line.marginTop=0;line=this.layoutLine(line,0);paragraph=line.paragraph;line=line.nextLine;// if (paragraph.isContainsShapeAlone() && paragraph.height === 0) {
//     this.layoutEmptyLineWidget(paragraph, false, paragraph.childWidgets[0] as LineWidget);
// }
}}this.updateWidgetToPage(this.viewer,paragraph);paragraph.isLayouted=true;return paragraph;};Layout.prototype.clearLineMeasures=function(){this.maxBaseline=0;this.maxTextBaseline=0;this.maxTextHeight=0;};Layout.prototype.layoutFloatElements=function(paragraph){var _this=this;paragraph.floatingElements.forEach(function(shape){if(shape instanceof ShapeBase){if(!_this.isRelayoutOverlap){_this.layoutShape(shape);}}});};Layout.prototype.layoutShape=function(element){if(element.textWrappingStyle!=='Inline'){var position=this.getFloatingItemPoints(element);element.x=position.x;element.y=position.y;var bodyWidget=element.paragraph.bodyWidget;if(bodyWidget.floatingElements.indexOf(element)===-1){bodyWidget.floatingElements.push(element);/* eslint:disable */bodyWidget.floatingElements.sort(function(a,b){return a.y-b.y;});}if(element.paragraph.floatingElements.indexOf(element)===-1){element.paragraph.floatingElements.push(element);}}else{if(element.width===0&&element.widthScale!==0){var containerWidth=HelperMethods.convertPointToPixel(element.line.paragraph.getContainerWidth());element.width=containerWidth/100*element.widthScale;}}var clientArea=this.viewer.clientArea;var clientActiveArea=this.viewer.clientActiveArea;if(element instanceof ShapeElementBox){var blocks=element.textFrame.childWidgets;this.viewer.updateClientAreaForTextBoxShape(element,true);for(var i=0;i<blocks.length;i++){var block=blocks[i];this.viewer.updateClientAreaForBlock(block,true);if(block instanceof TableWidget){this.clearTableWidget(block,true,true);}this.layoutBlock(block,0);this.viewer.updateClientAreaForBlock(block,false);}}this.viewer.clientActiveArea=clientActiveArea;this.viewer.clientArea=clientArea;};Layout.prototype.moveElementFromNextLine=function(line){var nextLine=line.nextLine;while(nextLine instanceof LineWidget){if(nextLine.children.length>0){var element=nextLine.children.splice(0,1)[0];line.children.push(element);element.line=line;break;}else{if(nextLine.paragraph.childWidgets.length===1){nextLine.paragraph.destroy();}else{nextLine.paragraph.childWidgets.splice(nextLine.paragraph.childWidgets.indexOf(nextLine),1);}nextLine=line.nextLine;}}};Layout.prototype.layoutLine=function(line,count){var paragraph=line.paragraph;if(line.children.length===0){this.moveElementFromNextLine(line);}var element=line.children[count];this.clearLineMeasures();line.marginTop=0;while(element instanceof ElementBox){element.padding.left=0;this.layoutElement(element,paragraph);line=element.line;if(element instanceof TextElementBox){var textElement=element;if(!sf.base.isNullOrUndefined(textElement.errorCollection)&&textElement.errorCollection.length>0){textElement.ischangeDetected=true;}}if(!this.isRTLLayout){if(this.hasFloatingElement){this.hasFloatingElement=false;var lineIndex=paragraph.childWidgets.indexOf(element.line);if(lineIndex>0&&paragraph.bodyWidget.floatingElements.length>0&&element instanceof TextElementBox&&!(paragraph.containerWidget instanceof TableCellWidget)){element=paragraph.childWidgets[lineIndex].children[0];}}else{element=element.nextElement;}}else{element=undefined;this.isRTLLayout=false;}}return line;};/* eslint-disable  */Layout.prototype.layoutElement=function(element,paragraph){var line=element.line;var text='';var index=element.indexInOwner;if(element instanceof FieldElementBox){if(element.fieldType===0){if(this.documentHelper.fields.indexOf(element)===-1){this.documentHelper.fields.push(element);}if(!sf.base.isNullOrUndefined(element.formFieldData)&&this.documentHelper.formFields.indexOf(element)===-1){this.documentHelper.formFields.push(element);}}this.layoutFieldCharacters(element);if(element.line.isLastLine()&&sf.base.isNullOrUndefined(element.nextNode)&&!this.isFieldCode){if(element.fieldType!==2&&sf.base.isNullOrUndefined(element.fieldSeparator)){this.layoutEmptyLineWidget(paragraph,false,element.line);}this.moveToNextLine(line);}else if(sf.base.isNullOrUndefined(element.nextElement)&&this.viewer.clientActiveArea.width>0&&!element.line.isLastLine()){this.moveElementFromNextLine(line);if(element.line.isLastLine()&&sf.base.isNullOrUndefined(element.nextNode)&&!this.isFieldCode){if(element.fieldType!==2&&sf.base.isNullOrUndefined(element.fieldSeparator)){this.layoutEmptyLineWidget(paragraph,false,element.line);}this.moveToNextLine(line);}}else if(sf.base.isNullOrUndefined(element.nextElement)&&this.viewer.clientActiveArea.width===0){this.moveToNextLine(line);if(line.paragraph.lastChild===line&&!sf.base.isNullOrUndefined(line.nextLine)&&this.viewer.clientActiveArea.height>=0){this.moveFromNextPage(line);}}return;}if(element instanceof ListTextElementBox||this.isFieldCode||element instanceof BookmarkElementBox||element instanceof EditRangeEndElementBox||element instanceof EditRangeStartElementBox||element instanceof ContentControl||element instanceof ShapeBase&&element.textWrappingStyle!=='Inline'){if(element instanceof BookmarkElementBox){if(element.bookmarkType===0&&!this.documentHelper.bookmarks.containsKey(element.name)){this.documentHelper.bookmarks.add(element.name,element);}else if(element.bookmarkType===1&&this.documentHelper.bookmarks.containsKey(element.name)){var bookmrkElement=this.documentHelper.bookmarks.get(element.name);if(sf.base.isNullOrUndefined(bookmrkElement.reference)||sf.base.isNullOrUndefined(bookmrkElement.reference.paragraph.bodyWidget)){bookmrkElement.reference=element;element.reference=bookmrkElement;}}else if(element.bookmarkType===0&&this.documentHelper.bookmarks.containsKey(element.name)){if(sf.base.isNullOrUndefined(element.reference)){this.documentHelper.bookmarks.remove(element.name);}}}if(element instanceof ContentControl&&this.documentHelper.contentControlCollection.indexOf(element)===-1){if(element.type===0){this.documentHelper.contentControlCollection.push(element);}else if(element.type===1){var endPage=element.paragraph.bodyWidget.page;for(var i=0;i<this.documentHelper.contentControlCollection.length;i++){var cCStart=this.documentHelper.contentControlCollection[i];var isInHeaderFooter=cCStart.line.paragraph.isInHeaderFooter;// Link content control present in same header.
if(isInHeaderFooter&&element.contentControlProperties===cCStart.contentControlProperties&&endPage===cCStart.line.paragraph.bodyWidget.page){element.reference=cCStart;cCStart.reference=element;}else if(!isInHeaderFooter&&element.contentControlProperties===cCStart.contentControlProperties){element.reference=cCStart;cCStart.reference=element;}}}}if(sf.base.isNullOrUndefined(element.nextElement)&&this.viewer.clientActiveArea.width>0&&!element.line.isLastLine()){this.moveElementFromNextLine(line);}if(element.line.isLastLine()&&sf.base.isNullOrUndefined(element.nextElement)){if(this.hasValidElement(line.paragraph)){this.moveToNextLine(line);}else{this.layoutEmptyLineWidget(line.paragraph,false,line,false);}}return;}var width=element.width;if(element instanceof FieldTextElementBox&&!this.isTocField(element.fieldBegin)){text=this.documentHelper.getFieldResult(element.fieldBegin,element.paragraph.bodyWidget.page);if(text!==''){element.text=text;}else{text=element.text;}}else if(element instanceof FootnoteElementBox){text=this.startAt(element,text);if(text!==''){element.text=text;}}else if(element instanceof TextElementBox){this.checkAndSplitTabOrLineBreakCharacter(element.text,element);if(element.text.length>1&&element.line.paragraph.bidi){var splittedText=this.splitTextByConsecutiveLtrAndRtl(element);this.updateSplittedText(element,splittedText);}text=element.text;}// Here field code width and height update need to skipped based on the hidden property.
if(element instanceof TextElementBox){// if (this.isRelayout) {
width=this.documentHelper.textHelper.getTextSize(element,element.characterFormat);/*} else {
                width = element.trimEndWidth;
            }*/if(element.text==='\t'){element.width=this.getTabWidth(paragraph,this.viewer,index,line,element);}}if(!sf.base.isNullOrUndefined(paragraph.containerWidget)&&paragraph.bodyWidget.floatingElements.length>0&&!(element instanceof ShapeElementBox)&&!(paragraph.containerWidget instanceof TextFrame)){this.adjustPosition(element,element.line.paragraph.bodyWidget);}if(this.viewer instanceof PageLayoutViewer&&(element instanceof ShapeElementBox&&element.textWrappingStyle==='Inline'||!(element instanceof ShapeElementBox))&&this.viewer.clientActiveArea.height<element.height&&this.viewer.clientActiveArea.y!==this.viewer.clientArea.y){if(element instanceof TextElementBox&&element.text!=='\f'||!(element instanceof TextElementBox)){this.moveToNextPage(this.viewer,line);}if(element instanceof FieldTextElementBox){this.updateFieldText(element);}if(element.previousElement&&(element.previousElement instanceof ShapeElementBox&&element.previousElement.textWrappingStyle==='Inline'||!(element.previousElement instanceof ShapeElementBox))){this.cutClientWidth(element.previousElement);}}if(element instanceof ShapeElementBox&&element.textWrappingStyle==='Inline'){this.layoutShape(element);}// tslint:disable-next-line:max-line-length
if(element instanceof FootnoteElementBox&&(!element.isLayout||this.isLayoutWhole)&&this.documentHelper.owner.layoutType==='Pages'){this.layoutFootEndNoteElement(element);}if(element instanceof ImageElementBox){if(element.top!==0&&!sf.base.isNullOrUndefined(element.top)||element.bottom!==0&&!sf.base.isNullOrUndefined(element.bottom)||element.left!==0&&!sf.base.isNullOrUndefined(element.left)||element.right!==0&&!sf.base.isNullOrUndefined(element.right)){this.cropPosition(element);}}if(parseFloat(width.toFixed(4))<=parseFloat(this.viewer.clientActiveArea.width.toFixed(4))||!this.viewer.textWrap){//Fits the text in current line.
this.addElementToLine(paragraph,element);if(sf.base.isNullOrUndefined(element.nextElement)&&this.viewer.clientActiveArea.width>0&&!element.line.isLastLine()){this.moveElementFromNextLine(line);}else if(!element.line.isLastLine()&&sf.base.isNullOrUndefined(element.nextElement)&&this.viewer.clientActiveArea.width===0){this.moveToNextLine(line);if(line.paragraph.lastChild===line&&this.viewer.clientActiveArea.height>=0){this.moveFromNextPage(line);}}}else if(element instanceof TextElementBox){if(element.text==='\t'){var currentLine=element.line;this.addSplittedLineWidget(currentLine,currentLine.children.indexOf(element)-1);this.moveToNextLine(currentLine);// Recalculates tab width based on new client active area X position
element.width=this.getTabWidth(paragraph,this.viewer,index,element.line,element);this.addElementToLine(paragraph,element);}else{//Splits the text and arrange line by line, till end of text.
do{line=element.line;this.splitTextForClientArea(line,element,element.text,element.width,element.characterFormat);this.checkLineWidgetWithClientArea(line,element);if(element instanceof FieldTextElementBox){this.updateFieldText(element);}}while(element.line!==line&&this.cutClientWidth(element));}}else{do{line=element.line;this.splitElementForClientArea(paragraph,element);this.checkLineWidgetWithClientArea(line,element);if(element instanceof FieldTextElementBox){this.updateFieldText(element);}}while(element.line!==line&&this.cutClientWidth(element));}if(text==='\v'||text==='\f'){var elementIndex=line.children.indexOf(element);if(elementIndex>-1){this.addSplittedLineWidget(line,elementIndex);}}if(element.line.isLastLine()&&sf.base.isNullOrUndefined(element.nextElement)||text==='\v'||text==='\f'){if(this.isXPositionUpdated){this.isXPositionUpdated=false;return;}this.moveToNextLine(element.line);if(text==='\v'&&sf.base.isNullOrUndefined(element.nextNode)){this.layoutEmptyLineWidget(paragraph,true,line,true);}else if(text==='\f'&&this.viewer instanceof PageLayoutViewer){if(sf.base.isNullOrUndefined(element.nextNode)){this.moveToNextPage(this.viewer,element.line,true);}else if(!sf.base.isNullOrUndefined(element.line.nextLine)){this.moveToNextPage(this.viewer,element.line.nextLine,false);}}}this.isXPositionUpdated=false;};/**
    * @private
    */Layout.prototype.adjustPosition=function(element,bodyWidget){var clientArea=this.viewer.clientActiveArea;var previousLeft=this.viewer.clientActiveArea.x;var previousTop=this.viewer.clientActiveArea.y;var previousWidth=this.viewer.clientActiveArea.width;var adjustedRect=this.adjustClientAreaBasedOnTextWrap(element,new Rect(clientArea.x,clientArea.y,clientArea.width,clientArea.height));this.viewer.clientActiveArea.width=adjustedRect.width;//Updated element padding for wrapping.
// if (this.isWrapText) {
var wrapDiff=this.viewer.clientActiveArea.x-previousLeft;// if (element.indexInOwner === 0 && element.line.isFirstLine()) {
//     wrapDiff -= HelperMethods.convertPointToPixel(element.line.paragraph.paragraphFormat.firstLineIndent);
// }
element.padding.left=wrapDiff;if(previousWidth!==this.viewer.clientActiveArea.width){var wrapPos=new WrapPosition(this.viewer.clientActiveArea.x,this.viewer.clientActiveArea.width);this.updateWrapPosition(wrapPos);}//this.isWrapText = false;
// }
if(this.viewer.clientActiveArea.width===0){this.isWrapText=false;}if(this.isYPositionUpdated){if(element.line.isFirstLine()){element.line.paragraph.y+=this.viewer.clientActiveArea.y-previousTop;}else{element.line.marginTop+=this.viewer.clientActiveArea.y-previousTop;}this.isYPositionUpdated=false;}};Layout.prototype.updateWrapPosition=function(wrapPos){for(var i=0;i<this.wrapPosition.length;i++){var previousWrapPos=this.wrapPosition[i];if(Math.abs(previousWrapPos.right-wrapPos.right)>1){continue;}else{return;}}this.wrapPosition.push(wrapPos);};Layout.prototype.isFirstitemInPage=function(element,yposition){if(!element.line.paragraph.isInHeaderFooter&&Math.round(yposition)===this.viewer.clientArea.y){return true;}return false;};Layout.prototype.isTextFitBelow=function(rect,top,element){//TODO: After shape implementation.
return false;};Layout.prototype.isNeedToWrapForSquareTightAndThrough=function(bodyWidget,elementBox,wrapOwnerIndex,wrapItemIndex,textWrappingStyle,textWrappingBounds,allowOverlap,wrapCollectionIndex,floatingEntity,isTextRangeInTextBox,rect,width,height){return bodyWidget.floatingElements.length>0&&wrapOwnerIndex!==wrapCollectionIndex&&wrapItemIndex!==wrapCollectionIndex&&textWrappingStyle!=='Inline'&&textWrappingStyle!=='Behind'&&textWrappingStyle!=='TopAndBottom'&&textWrappingStyle!=='InFrontOfText'&&(Math.round(rect.y+height)>Math.round(textWrappingBounds.y)||this.isTextFitBelow(textWrappingBounds,rect.y+height,floatingEntity))&&Math.round(rect.y)<Math.round(textWrappingBounds.y+textWrappingBounds.height)&&!(allowOverlap&&(isTextRangeInTextBox||elementBox instanceof ImageElementBox&&elementBox.textWrappingStyle!=='Inline'&&elementBox.allowOverlap));};Layout.prototype.isNeedToWrapForSquareTightAndThroughForTable=function(container,table,wrapIndex,wrapItemIndex,wrappingStyle,textWrappingBounds,allowOverlap,wrapCollectionIndex,floatingElemnt,isInTextBox,rect,width,height){return container.floatingElements.length>0&&wrapIndex!==wrapCollectionIndex&&wrapItemIndex!==wrapCollectionIndex&&wrappingStyle!=='Inline'&&wrappingStyle!=='Behind'&&wrappingStyle!=='TopAndBottom'&&wrappingStyle!=='InFrontOfText'&&Math.round(rect.y+height)>=Math.round(textWrappingBounds.y)&&Math.round(rect.y)<Math.round(textWrappingBounds.y+textWrappingBounds.height)&&!(allowOverlap&&isInTextBox);};Layout.prototype.isNeedToWrapLeafWidget=function(pargaraph,elementBox){var IsNeedToWrap=true;return pargaraph.bodyWidget.floatingElements.length>0&&IsNeedToWrap&&(!pargaraph.isInHeaderFooter||pargaraph.associatedCell)&&!(elementBox instanceof ImageElementBox);};Layout.prototype.getMinWidth=function(currTextRange,width,height,rect){var text=currTextRange.text;var split=text.split(' ');// Gets the minimum width from the text when it contains only empty space.
if(text!==''&&text.trim()===''&&currTextRange&&currTextRange.line.paragraph&&currTextRange.previousNode&&currTextRange.nextNode&&currTextRange.line.paragraph.isEmpty){split=[''];}// Initialized the text with additional empty string.
// It avoids the minimum width calculation from next sibling (GetNextTextRangeWidth).
var minwidth=this.documentHelper.textHelper.measureText(split[0],currTextRange.characterFormat).Width;//Need to layout the unicode characters (chinese) character by character.
// if (DrawingContext.IsUnicodeText(text)) {
//     minwidth = DrawingContext.MeasureTextRange(currTextRange, text[0].ToString()).Width;
// }
var nextSibling=this.getNextSibling(currTextRange);if(split.length===1&&nextSibling){var nextSiblingText=nextSibling.text;minwidth+=this.getNextTextRangeWidth(nextSibling,nextSiblingText,width,height,rect);}// Add the minimum character width of that paragraph, if this text range is para mark
return minwidth;};Layout.prototype.getNextTextRangeWidth=function(nextSiblingTextRange,nextSiblingText,width,height,rect){var nextsibling=nextSiblingTextRange;// if (nextSiblingTextRange instanceof WFootnote)
//     nextsibling = ((nextSiblingTextRange as IWidget).LayoutInfo as LayoutFootnoteInfoImpl).TextRange;
var sizeNext=new Rect(0,0,0,0);var isNextSiblingSizeNeedToBeMeasure=this.isNextSibligSizeNeedToBeMeasure(sizeNext,nextSiblingTextRange,rect,width,height);while(isNextSiblingSizeNeedToBeMeasure&&this.isLeafWidgetNextSiblingIsTextRange(nextsibling)&&width+sizeNext.width<rect.width){nextsibling=this.getNextSibling(nextsibling);if(!this.isNextSibligSizeNeedToBeMeasure(sizeNext,nextsibling,rect,width,height)){break;}nextSiblingText+=nextsibling.text;}return sizeNext.width;};Layout.prototype.isLeafWidgetNextSiblingIsTextRange=function(textRange){var nextSiblingTextRange=this.getNextSibling(textRange);if(nextSiblingTextRange&&nextSiblingTextRange instanceof TextElementBox){return true;}return false;};Layout.prototype.isNextSibligSizeNeedToBeMeasure=function(sizeNext,nextSiblingwidget,rect,width,height){var text=null;var nextSiblingTextRange=nextSiblingwidget;if(nextSiblingTextRange){text=nextSiblingTextRange.text;if(text.indexOf(' ')!==-1||text.indexOf('-')!==-1||text.indexOf('_')!==-1&&width+sizeNext.width+this.documentHelper.textHelper.measureText(text.split('-')[0],nextSiblingTextRange.characterFormat).Width<rect.width||nextSiblingTextRange.text==='\t'){var elementWidth=nextSiblingTextRange.width;if(text!==text.split(' ')[0]){elementWidth=this.documentHelper.textHelper.measureText(text.split(' ')[0],nextSiblingTextRange.characterFormat).Width;}if(width+sizeNext.width+elementWidth>rect.width&&text.indexOf('-')){if(text!==text.split('-')[0]+'-'){elementWidth=this.documentHelper.textHelper.measureText(text.split('-')[0]+'-',nextSiblingTextRange.characterFormat).Width;}}sizeNext.width+=elementWidth;return false;}else{if(nextSiblingTextRange.text.length>0){var textInfo=this.documentHelper.textHelper.measureText(nextSiblingTextRange.text,nextSiblingTextRange.characterFormat);sizeNext.height+=textInfo.Height;sizeNext.width+=textInfo.Width;}}}return true;};Layout.prototype.isNeedDoIntermediateWrapping=function(remainingClientWidth,textWrappingStyle,rect,width,paragraph,textWrappingBounds,leafWidget,minwidth,minimumWidthRequired){return remainingClientWidth>minimumWidthRequired&&((Math.round(rect.width)<=Math.round(minwidth)||rect.width<width&&leafWidget.paragraph.isInsideTable)&&textWrappingStyle!=='Left'// Skip to update width when the wrap type as left
&&textWrappingStyle!=='Largest'||textWrappingStyle==='Right'//To layout right side when the wrap type as right
||rect.width<remainingClientWidth&&textWrappingStyle==='Largest')||// Check whether the right side width is greater than the left side when the wrap type as largest
(Math.round(textWrappingBounds.x-paragraph.x+paragraph.leftIndent)<minimumWidthRequired// Check whether the left side of text wrap object is have minimum width to layout or not
||leafWidget instanceof TextElementBox&&this.isFloatingItemOnLeft(rect,minwidth,textWrappingBounds))&&(textWrappingStyle!=='Left'||remainingClientWidth<minimumWidthRequired);};Layout.prototype.isFloatingItemOnLeft=function(rect,minWidth,bounds){return false;};Layout.prototype.getNextSibling=function(currentElementBox){var paragraph=currentElementBox.line.paragraph;var nextSibling=currentElementBox.nextNode;var isFieldCode=false;while(nextSibling){if(nextSibling instanceof FieldElementBox||nextSibling instanceof BookmarkElementBox||isFieldCode||nextSibling instanceof ListTextElementBox){if(nextSibling instanceof FieldElementBox){if(nextSibling.fieldType===0){isFieldCode=true;}else if(nextSibling.fieldType===2){isFieldCode=false;}}}else if(nextSibling instanceof TextElementBox){break;}nextSibling=nextSibling.nextNode;}return nextSibling;};Layout.prototype.adjustClientAreaBasedOnTextWrap=function(elementBox,rect){var ownerPara=elementBox.line.paragraph;var bodyWidget=ownerPara.bodyWidget;var layouter=this.viewer;var yposition=rect.y;var isFirstItem=this.isFirstitemInPage(elementBox,yposition);isFirstItem=sf.base.isNullOrUndefined(ownerPara.previousWidget);if(this.isNeedToWrapLeafWidget(ownerPara,elementBox)){var clientLayoutArea=layouter.clientArea;//Need to handle sorting floating items.
// Sort based on Y position
bodyWidget.floatingElements.sort(function(a,b){return a.y-b.y;});// Sort based on X position
bodyWidget.floatingElements.sort(function(a,b){return a.x-b.x;});for(var i=0;i<bodyWidget.floatingElements.length;i++){var floatingItem=bodyWidget.floatingElements[i];var allowOverlap=false;if(floatingItem instanceof ShapeBase){allowOverlap=floatingItem.allowOverlap;}else{allowOverlap=floatingItem.positioning.allowOverlap;}if(ownerPara.isInsideTable){if(floatingItem instanceof TableWidget&&!floatingItem.isInsideTable){continue;}}if(this.isRelayout&&!this.isRelayoutOverlap&&this.viewer.documentHelper.selection.isExistAfter(floatingItem instanceof TableWidget?floatingItem:floatingItem.line.paragraph,elementBox.line.paragraph)||this.isRelayout&&this.isRelayoutOverlap&&this.viewer.documentHelper.selection.isExistAfter(floatingItem instanceof TableWidget?floatingItem:floatingItem.line.paragraph,this.endOverlapWidget)){continue;}// if (ownerPara.isInsideTable && allowOverlap
//     && (ownerPara.associatedCell.ownerTable.positioning.allowOverlap))
// {
//     WParagraph ownerParagraph = (m_lcOperator as Layouter).FloatingItems[i].OwnerParagraph;
//     if (!(ownerParagraph !== null
//         && ownerParagraph.IsInCell
//         && ownerPara.GetOwnerEntity() === ownerParagraph.GetOwnerEntity()))
//     {
//         continue;
//     }
// }
var xPosition=floatingItem.x;var distanceLeft=0;var distanceTop=0;var distanceRight=0;var distanceBottom=0;var width=0;if(floatingItem instanceof ShapeBase){distanceLeft=floatingItem.distanceLeft;distanceTop=floatingItem.distanceTop;distanceRight=floatingItem.distanceRight;distanceBottom=floatingItem.distanceBottom;width=floatingItem.width;}else{width=floatingItem.getTableCellWidth();}var textWrappingBounds=new Rect(floatingItem.x-distanceLeft,floatingItem.y-distanceTop,width+distanceLeft+distanceRight,floatingItem.height+distanceTop+distanceBottom);var textWrappingStyle=floatingItem instanceof TableWidget?'Square':floatingItem.textWrappingStyle;var textWrappingType=floatingItem instanceof TableWidget?'Both':floatingItem.textWrappingType;//  //Need to skip the wrapping for line break when it is first item of corresponding paragraph and that paragraph contains First line indent as per Word 2010 and its lower version behavior.
//  if (IsLineBreakIntersectOnFloatingItem(leafWidget, textWrappingStyle, textWrappingBounds, rect, size, ownerPara))
//  continue;
var minimumWidthRequired=18;var bottom=layouter.clientArea.y+floatingItem.height;// if (this.isNeedToWrapParaMarkToRightSide(elementBox, ownerPara, textWrappingBounds, bottom, layouter, this.viewer.clientArea, textWrappingType, minimumWidthRequired)) {
//     if (lineBreakPosition !== 0) {
//         this.viewer.clientArea.y = lineBreakPosition;
//         //m_layoutArea.UpdateBoundsBasedOnTextWrap(lineBreakPosition);
//     }
//     this.viewer.clientArea.x += textWrappingBounds.width;
//     //(LeafWidget as IWidget).LayoutInfo.IsLineBreak = false;
//     elementBox.height = 0;
//     elementBox.width = textWrappingBounds.width;
//     return;
// }
if(!(clientLayoutArea.x>textWrappingBounds.right+minimumWidthRequired||clientLayoutArea.right<textWrappingBounds.x-minimumWidthRequired)){if(this.isNeedToWrapForSquareTightAndThrough(bodyWidget,elementBox,-1,-1,textWrappingStyle,textWrappingBounds,allowOverlap,1,floatingItem,false,rect,elementBox.width,elementBox.height)){var rightIndent=0;var leftIndent=0;var listLeftIndent=0;var firstLineIndent=HelperMethods.convertPointToPixel(elementBox.paragraph.paragraphFormat.firstLineIndent);var paragraphLeftIndent=HelperMethods.convertPointToPixel(ownerPara.paragraphFormat.leftIndent);firstLineIndent=elementBox.indexInOwner===0&&elementBox.line.isFirstLine()&&firstLineIndent>0?firstLineIndent:0;var currTextRange=elementBox;var containerWidget=floatingItem instanceof TableWidget?floatingItem.containerWidget:floatingItem.line.paragraph.containerWidget;var isnewline=false;if(elementBox.line.paragraph){//Right indent is considered only if the rect.X greater than the floating item's X position and
//Text wrapping style should not be left
if(rect.x>=textWrappingBounds.x&&textWrappingType!=='Left'){rightIndent=ownerPara.paragraphFormat.rightIndent;}//Left indent is considered only if the rect.X less than the floating item's X position and
//Text wrapping style should not be right
if(rect.x<textWrappingBounds.x&&textWrappingType!=='Right'){leftIndent=paragraphLeftIndent;}var listFormat=ownerPara.paragraphFormat.listFormat;var listLevel=this.getListLevel(listFormat.list,listFormat.listLevelNumber);if(rect.x===clientLayoutArea.x+paragraphLeftIndent&&listFormat&&listFormat.baseStyle&&listLevel&&listLevel.paragraphFormat.leftIndent!==0){listLeftIndent=paragraphLeftIndent;isnewline=true;// to denote the current line is new line of the paragraph
}}// if (this.isXPositionUpdated && textWrappingType === 'Both' && this.layoutState === 'Splitted') {
//     rect.width = bodyWidget.width - this.viewer.clientActiveArea.x;
//     rect.x = textWrappingBounds.right;
//     this.viewer.updateClientAreaForTextWrap(rect);
//     return rect;
// }
// Skip to update when the wrap type as left
if(rect.x>=textWrappingBounds.x&&rect.x<textWrappingBounds.right&&textWrappingType!=='Left')// Skip to update when the wrap type as left
{rect.width=rect.width-(textWrappingBounds.right-rect.x)-rightIndent;this.isWrapText=true;var isEntityFitInCurrentLine=true;if(!isEntityFitInCurrentLine||Math.round(rect.width)<minimumWidthRequired||rect.width<elementBox.width&&elementBox.text==='\t'||textWrappingBounds.x<ownerPara.x+paragraphLeftIndent)// check whether the TextWrap X position is less than the paragraph X position
{//TODO
rect.width=this.viewer.clientArea.right-textWrappingBounds.right-(isnewline?listLeftIndent:0);var minwidth=0;if(currTextRange){minwidth=this.getMinWidth(elementBox,elementBox.width,elementBox.height,rect);}else{minwidth=elementBox.width;}if(Math.round(rect.width)<minimumWidthRequired||rect.width<minwidth){if(isEntityFitInCurrentLine&&textWrappingBounds.x-(ownerPara.x+ownerPara.leftIndent)>minimumWidthRequired&&this.viewer.clientArea.right-textWrappingBounds.right>minimumWidthRequired){rect.width=0;}else{var topMarginValue=0;//topMarginValue = GetTopMarginValueForFloatingTable(ownerPara,
//layouter.FloatingItems[i].FloatingEntity, rect.Y);
var isPositionsUpdated=false;//Check whether left side of current floating item has enoush place to fit current widget.
//If it has, need to fit left side of the floating item, instead of moving to bottom.
// if (layouter.clientArea.x + elementBox.width < floatingItem.x) {
//     //Current item should preserve below to the floating item,which preserved left side of the floating item.
//     //If left side has multiple items or none of items this may fail, need to handle this cases.
//     let tempBounds: Rect = GetIntersectingItemBounds(floatingItem, yposition);
//     if (tempBounds.bottom !== 0 && tempBounds.bottom <= textWrappingBounds.bottom) {
//         rect.x = clientLayoutArea.x;
//         rect.width = clientLayoutArea.width;
//         rect.y = tempBounds.bottom + topMarginValue;
//         rect.height = clientLayoutArea.bottom - tempBounds.bottom;
//         this.isYPositionUpdated = true;
//         isPositionsUpdated = true;
//     }
// }
if(!isPositionsUpdated){this.isYPositionUpdated=true;rect.width=this.viewer.clientArea.width;rect.height-=textWrappingBounds.bottom+topMarginValue-rect.y;rect.y=textWrappingBounds.bottom+topMarginValue;}}this.viewer.updateClientAreaForTextWrap(rect);this.isWrapText=false;}else{var xposition=rect.x;//TabsLayoutInfo tabsInfo = null;
rect.x=textWrappingBounds.right+(isnewline?listLeftIndent:0)+firstLineIndent;rect.width-=firstLineIndent;//When there is no space to fit the content in right, then update the y position.
if(textWrappingStyle==='Square'&&rect.width<0&&elementBox.width>0){// let topMarginValue = GetTopMarginValueForFloatingTable(ownerPara, layouter.FloatingItems[i].FloatingEntity, rect.Y);
var topMarginValue=0;this.isYPositionUpdated=true;rect.width=this.viewer.clientArea.width;rect.height-=textWrappingBounds.bottom+topMarginValue-rect.y;rect.y=textWrappingBounds.bottom+topMarginValue;rect.x=xposition;}else{// this.isXPositionUpdated = true;
}this.viewer.updateClientAreaForTextWrap(rect);//
// if (!(leafWidget is Break))
// AdjustClientAreaBasedOnExceededTab(leafWidget, size, ref rect, ownerPara);
// if (leafWidget != null)
//     tabsInfo = (leafWidget as ILeafWidget).LayoutInfo as TabsLayoutInfo;
//if (tabsInfo == null) {
//this.isWrapText = true;
//this.viewer.updateClientAreaForTextWrap(rect);//
// if (layouter.FloatingItems[i].FloatingEntity is WTable)
// layouter.FloatingTableBottom = textWrappingBounds.Bottom;
//}
}}else{//Check whether the RightPositionOfTabStopInterSectingFloattingItems have the value or not.
//if contains value means continue the layouting even x position exceeds the page right position.
var xposition=rect.x;rect.x=textWrappingBounds.right+(isnewline?listLeftIndent:0)+firstLineIndent;rect.width=this.viewer.clientArea.right-textWrappingBounds.right-(isnewline?listLeftIndent:0)-firstLineIndent;//When there is no space to fit the content in right, then update the y position.
if(textWrappingStyle==='Square'&&rect.width<0&&elementBox.width>0){// float topMarginValue = GetTopMarginValueForFloatingTable(ownerPara,
//     layouter.FloatingItems[i].FloatingEntity, rect.Y);
var topMarginValue=0;this.isYPositionUpdated=true;rect.width=this.viewer.clientArea.width;rect.height-=textWrappingBounds.bottom+topMarginValue-rect.y;rect.y=textWrappingBounds.bottom+topMarginValue;rect.x=xposition;}//else
// this.isXPositionUpdated = true;
// if (!(leafWidget is Break))
//     AdjustClientAreaBasedOnExceededTab(leafWidget, size, ref rect, ownerPara);
// //Microsoft Word 2013 doesn't split text character by character, when current line has floating item.
// if (ownerPara != null && ownerPara.Document.Settings.CompatibilityMode == CompatibilityMode.Word2013)
//     layouter.m_canSplitbyCharacter = false;
this.isWrapText=true;this.viewer.updateClientAreaForTextWrap(rect);//
}}else if(textWrappingBounds.x>=rect.x&&rect.right>textWrappingBounds.x){rect.width=textWrappingBounds.x-rect.x-rightIndent;//Remaining right side width
var remainingClientWidth=this.viewer.clientArea.right-textWrappingBounds.right;remainingClientWidth=remainingClientWidth>0?remainingClientWidth:0;this.isWrapText=true;var minwidth=0;if(currTextRange){minwidth=this.getMinWidth(currTextRange,elementBox.width,elementBox.height,rect);}else{minwidth=elementBox.width;}if(this.isNeedDoIntermediateWrapping(remainingClientWidth,textWrappingType,rect,elementBox.width,elementBox.paragraph,textWrappingBounds,elementBox,minwidth,minimumWidthRequired)){rect.width=remainingClientWidth;this.isWrapText=true;if(rect.x+minwidth>textWrappingBounds.x||textWrappingType==='Right')//Update X position when the wrap type as largest or right or the minimum width + rect.X > wrap x position
{rect.x=textWrappingBounds.right;// let listFormat: WListFormat = null;
// let listLevel: WListLevel = null;
// if (elementBox.line.isFirstLine
//    && (listFormat = ownerPara.GetListFormatValue()) != null
//    && listFormat.CurrentListStyle != null
//    && (listLevel = ownerPara.GetListLevel(listFormat)) != null
//    && listLevel.ParagraphFormat.LeftIndent != 0)
// {
//     float x = 0;
//     float width = rect.Width;
//     //Updates the paragraph firstline horizontal positions, such as first line indent and listtab value
//     UpdateParaFirstLineHorizontalPositions(paragraphLayoutInfo, ownerPara, ref x, ref width);
//     rect.X += (x + (float)paragraphLayoutInfo.Margins.Left);
//     rect.Width -= (x + (float)paragraphLayoutInfo.Margins.Left);
// }
// this.isXPositionUpdated = true;
// if (textWrappingStyle == TextWrappingStyle.Through
//     && layouter.FloatingItems[i].IsDoesNotDenotesRectangle) {
//     UpdateXposition(textWrappingBounds, i, ref rect, size, minwidth);
// }
if(rect.width>minwidth||textWrappingType==='Right'){this.viewer.updateClientAreaForTextWrap(rect);}}if(rect.width<minimumWidthRequired&&!(minwidth<remainingClientWidth&&'Tight'===textWrappingStyle)||rect.width<minwidth&&Math.round(rect.right)===Math.round(this.viewer.clientArea.right)&&textWrappingType==='Both'){var rect1=textWrappingBounds;if(Math.round(rect.x)===Math.round(bodyWidget.sectionFormat.leftMargin+ownerPara.paragraphFormat.leftIndent)){//Updates top margin of the paragraph when paragraph mark not wrap based on the floating table.
var topMarginValue=0;//topMarginValue = GetTopMarginValueForFloatingTable(ownerPara, floatingItem, rect.y);
rect.y=rect1.bottom+topMarginValue;this.isYPositionUpdated=true;rect.width=this.viewer.clientArea.width;rect.height=rect.height-(rect1.height+topMarginValue);this.viewer.updateClientAreaForTextWrap(rect);this.isWrapText=false;}// Reset the rectangle position when the rectangle right position is equialent to layout area right position
else if(Math.round(rect.right)>=Math.round(this.viewer.clientArea.right)&&textWrappingType==='Both'){//Updates top margin of the paragraph when paragraph mark not wrap based on the floating table.
var topMarginValue=0;// topMarginValue = GetTopMarginValueForFloatingTable(ownerPara, floatingItem, rect.y);
rect.y=rect1.bottom+topMarginValue;rect.width=this.viewer.clientArea.width;rect.height=rect.height-(rect1.height+topMarginValue);rect.x=this.viewer.clientArea.x+leftIndent;this.viewer.updateClientAreaForTextWrap(rect);// this.isXPositionUpdated = true;
this.isYPositionUpdated=true;this.isWrapText=false;}else{rect.width=0;this.viewer.updateClientAreaForTextWrap(rect);}}}else{//While text intersecting with SQUARE type floating item and there is no space
//available to fit this text in current line then move the text to bottom
//of the floating item and this behavior is applicable only for Word 2013.
//Lower versions split the text character by character.
if(elementBox.line.isFirstLine()&&elementBox.indexInOwner===0&&textWrappingStyle==='Square'&&Math.round(rect.width)<=Math.round(minwidth)&&ownerPara.containerWidget===containerWidget){rect.x=clientLayoutArea.x;rect.y=textWrappingBounds.bottom;rect.width=clientLayoutArea.width;rect.height-=textWrappingBounds.bottom-rect.y;this.isYPositionUpdated=true;}else if(Math.round(rect.width)<=Math.round(minwidth)&&Math.round(rect.x-leftIndent)!==Math.round(this.viewer.clientArea.x)){rect.width=0;}this.viewer.updateClientAreaForTextWrap(rect);//
}}if(textWrappingType!=='Both'){this.isWrapText=false;}}}}}return rect;};Layout.prototype.adjustClientAreaBasedOnTextWrapForTable=function(table,rect){//let ownerPara: ParagraphWidget = elementBox.line.paragraph;
if(sf.base.isNullOrUndefined(table.containerWidget)||sf.base.isNullOrUndefined(table.bodyWidget)){return rect;}var bodyWidget=table.bodyWidget;var layouter=this.viewer;var yposition=rect.y;var isFirstItem=sf.base.isNullOrUndefined(table.previousWidget);if(bodyWidget.floatingElements.length>0){var clientLayoutArea=layouter.clientActiveArea;bodyWidget.floatingElements.sort(function(a,b){return a.y-b.y;});bodyWidget.floatingElements.sort(function(a,b){return a.x-b.x;});for(var i=0;i<bodyWidget.floatingElements.length;i++){var floatingElement=bodyWidget.floatingElements[i];var allowOverlap=false;if(floatingElement instanceof ShapeBase){allowOverlap=floatingElement.allowOverlap;}else{allowOverlap=floatingElement.positioning.allowOverlap;}if(table.isInsideTable){if(floatingElement instanceof TableWidget&&!floatingElement.isInsideTable){continue;}}var tableWidth=table.getTableCellWidth();var isShape=floatingElement instanceof ShapeBase;var distanceLeft=isShape?floatingElement.distanceLeft:floatingElement.positioning.distanceLeft;var distanceTop=isShape?floatingElement.distanceTop:floatingElement.positioning.distanceTop;var distanceRight=isShape?floatingElement.distanceRight:floatingElement.positioning.distanceRight;var distanceBottom=isShape?floatingElement.distanceBottom:floatingElement.positioning.distanceBottom;var width=isShape?floatingElement.width:floatingElement.getTableCellWidth();var wrappingBounds=new Rect(floatingElement.x-distanceLeft,floatingElement.y-distanceTop,width+distanceLeft+distanceRight,floatingElement.height+distanceTop+distanceBottom);var textWrappingStyle=floatingElement instanceof TableWidget?'Square':floatingElement.textWrappingStyle;var textWrappingType=floatingElement instanceof TableWidget?'Both':floatingElement.textWrappingType;var minimumWidthRequired=18;if(!(clientLayoutArea.x>wrappingBounds.right+minimumWidthRequired||clientLayoutArea.right<wrappingBounds.x-minimumWidthRequired)){if(this.isNeedToWrapForSquareTightAndThroughForTable(bodyWidget,table,-1,-1,textWrappingStyle,wrappingBounds,allowOverlap,1,floatingElement,false,rect,tableWidth,table.height)){// Skip to update when the wrap type as left
if(rect.x>=wrappingBounds.x&&rect.x<wrappingBounds.right&&textWrappingType!=='Left')// Skip to update when the wrap type as left
{rect.width=rect.width-(wrappingBounds.right-rect.x);this.isWrapText=true;var isEntityFitInCurrentLine=true;if(!isEntityFitInCurrentLine||Math.round(rect.width)<minimumWidthRequired||rect.width<tableWidth||wrappingBounds.x<table.x)// check whether the TextWrap X position is less than the paragraph X position
{rect.width=this.viewer.clientArea.right-wrappingBounds.right;var minwidth=tableWidth;if(Math.round(rect.width)<minimumWidthRequired||rect.width<minwidth){if(isEntityFitInCurrentLine&&wrappingBounds.x-table.x>minimumWidthRequired&&this.viewer.clientArea.right-wrappingBounds.right>minimumWidthRequired){rect.width=0;}else{var topMarginValue=0;var isPositionsUpdated=false;if(!isPositionsUpdated){this.isYPositionUpdated=true;rect.width=this.viewer.clientArea.width;rect.height-=wrappingBounds.bottom+topMarginValue-rect.y;rect.y=wrappingBounds.bottom+topMarginValue;}}this.viewer.updateClientAreaForTextWrap(rect);this.isWrapText=false;}else{var xposition=rect.x;//TabsLayoutInfo tabsInfo = null;
rect.x=wrappingBounds.right;//When there is no space to fit the content in right, then update the y position.
if(textWrappingStyle==='Square'&&rect.width<0&&tableWidth>0){// let topMarginValue = GetTopMarginValueForFloatingTable(ownerPara, layouter.FloatingItems[i].FloatingEntity, rect.Y);
var marginTop=0;this.isYPositionUpdated=true;rect.height-=wrappingBounds.bottom+marginTop-rect.y;rect.width=this.viewer.clientArea.width;rect.y=wrappingBounds.bottom+marginTop;rect.x=xposition;}this.viewer.updateClientAreaForTextWrap(rect);//
}}else{var xposition=rect.x;rect.x=wrappingBounds.right+table.firstChild.firstChild.leftMargin;rect.width=this.viewer.clientArea.right-wrappingBounds.right;//When there is no space to fit the content in right, then update the y position.
if(textWrappingStyle==='Square'&&rect.width<0&&tableWidth>0){// float topMarginValue = GetTopMarginValueForFloatingTable(ownerPara,
//     layouter.FloatingItems[i].FloatingEntity, rect.Y);
var topMarginValue=0;this.isYPositionUpdated=true;rect.width=this.viewer.clientArea.width;rect.height-=wrappingBounds.bottom+topMarginValue-rect.y;rect.y=wrappingBounds.bottom+topMarginValue;rect.x=xposition;}this.viewer.updateClientAreaForTextWrap(rect);//
}}}}}}return rect;};Layout.prototype.startAt=function(element,text){if(element.footnoteType==='Footnote'){this.startat=element.paragraph.bodyWidget.sectionFormat.initialFootNoteNumber;text=this.getFootEndNote(element.paragraph.bodyWidget.sectionFormat.footNoteNumberFormat,this.documentHelper.footnoteCollection.indexOf(element)+this.startat);}else{this.startat=element.paragraph.bodyWidget.sectionFormat.initialEndNoteNumber;text=this.getFootEndNote(element.paragraph.bodyWidget.sectionFormat.endnoteNumberFormat,this.documentHelper.endnoteCollection.indexOf(element)+this.startat);}return text;};Layout.prototype.layoutFootEndNoteElement=function(element){this.isFootnoteContentChanged=true;var len=this.documentHelper.footnoteCollection.length;var footnote;var footIndex=this.documentHelper.footnoteCollection.indexOf(element);var insertIndex=1;this.islayoutFootnote=true;var isFitted;var clientArea=new Rect(this.viewer.clientArea.x,this.viewer.clientArea.y,this.viewer.clientArea.width,this.viewer.clientArea.height);var clientActiveArea=new Rect(this.viewer.clientActiveArea.x,this.viewer.clientActiveArea.y,this.viewer.clientActiveArea.width,this.viewer.clientActiveArea.height);var bodyWidget=element.paragraph.bodyWidget;var isCreated=false;var height=0;if(bodyWidget.page.footnoteWidget){for(var j=0;j<bodyWidget.page.footnoteWidget.childWidgets.length;j++){insertIndex=bodyWidget.page.footnoteWidget.childWidgets.length;var currentIndex=this.documentHelper.footnoteCollection.indexOf(bodyWidget.page.footnoteWidget.childWidgets[j].footNoteReference);if(currentIndex>footIndex){if(currentIndex-footIndex===1){insertIndex=j;break;}}}}element.isLayout=true;if(element.footnoteType==='Footnote'){if(bodyWidget.page.footnoteWidget&&bodyWidget.page.footnoteWidget instanceof FootNoteWidget){footnote=bodyWidget.page.footnoteWidget;}else{isCreated=true;footnote=new FootNoteWidget();footnote.footNoteType='Footnote';footnote.page=bodyWidget.page;var newParagraph=new ParagraphWidget();newParagraph.characterFormat=new WCharacterFormat();newParagraph.paragraphFormat=new WParagraphFormat();newParagraph.index=0;var lineWidget=new LineWidget(newParagraph);newParagraph.childWidgets.push(lineWidget);footnote.childWidgets.push(newParagraph);height=this.documentHelper.textHelper.getParagraphMarkSize(newParagraph.characterFormat).Height;}// clientArea = this.viewer.clientArea;
// clientActiveArea = this.viewer.clientActiveArea;
this.isFootNoteLayoutStart=true;for(var i=0;i<element.blocks.length;i++){var block_1=element.blocks[i];if(this.isLayoutWhole){block_1.containerWidget=undefined;}else{block_1.containerWidget=footnote;}this.viewer.updateClientAreaForBlock(block_1,true);if(block_1 instanceof TableWidget){this.clearTableWidget(block_1,true,true);}this.layoutBlock(block_1,0);height+=block_1.height;block_1.y=0;this.viewer.updateClientAreaForBlock(block_1,false);}this.isFootNoteLayoutStart=false;isFitted=false;if(height<=clientActiveArea.height){element.blocks.forEach(function(element){footnote.childWidgets.splice(insertIndex,0,element);insertIndex++;});if(isCreated){bodyWidget.page.footnoteWidget=footnote;}// clientActiveArea.height += height;
footnote.height+=height;isFitted=true;// footnote.containerWidget = bodyWidget;
}this.viewer.clientActiveArea=clientActiveArea;if(isFitted){this.viewer.clientActiveArea.height-=height;this.footnoteHeight+=height;// this.footHeight += height;
}this.viewer.clientArea=clientArea;// footnote.childWidgets.push(foot);
/*  if (this.documentHelper.footnoteCollection != element.previousCollection) {
                  this.layoutfootNote(footnote);
              }*/}return isFitted;};Layout.prototype.layoutEndNoteElement=function(){var lastpage=this.documentHelper.pages.length;if(this.documentHelper.endnoteCollection.length>0){var foot=void 0;var endNote=void 0;var height=0;var isCreated=void 0;var bodyWidget=this.documentHelper.pages[lastpage-1].bodyWidgets[0];for(var i=0;i<this.documentHelper.endnoteCollection.length;i++){foot=this.documentHelper.endnoteCollection[i];if(bodyWidget.page.endnoteWidget instanceof FootNoteWidget&&bodyWidget.page.endnoteWidget.footNoteType==='Endnote'){endNote=bodyWidget.page.endnoteWidget;}else{isCreated=true;endNote=new FootNoteWidget();endNote.footNoteType='Endnote';endNote.page=bodyWidget.page;var newParagraph=new ParagraphWidget();newParagraph.characterFormat=new WCharacterFormat();newParagraph.paragraphFormat=new WParagraphFormat();newParagraph.index=0;var lineWidget=new LineWidget(newParagraph);newParagraph.childWidgets.push(lineWidget);endNote.childWidgets.push(newParagraph);}for(var j=0;j<foot.blocks.length;j++){var block=foot.blocks[j];endNote.childWidgets.push(block);}if(isCreated){bodyWidget.page.endnoteWidget=endNote;}// endNote.containerWidget = bodyWidget;
endNote.height+=height;}this.layoutfootNote(endNote);}};Layout.prototype.hasValidElement=function(paragraph){var line=paragraph.firstChild;if(line&&!sf.base.isNullOrUndefined(this.documentHelper.selection)){var elementBox=line.children[0];while(elementBox){if(elementBox instanceof FieldElementBox){elementBox=this.documentHelper.selection.getNextValidElementForField(elementBox);if(!sf.base.isNullOrUndefined(elementBox)&&!elementBox.line.paragraph.equals(paragraph)){return false;}}if(elementBox instanceof TextElementBox||elementBox instanceof ImageElementBox){return true;}if(!sf.base.isNullOrUndefined(elementBox)){elementBox=elementBox.nextNode;}}}return false;};Layout.prototype.updateFieldText=function(element){var text=this.documentHelper.getFieldResult(element.fieldBegin,element.paragraph.bodyWidget.page);if(text!==''){element.text=text;this.documentHelper.textHelper.getTextSize(element,element.characterFormat);}};Layout.prototype.checkLineWidgetWithClientArea=function(line,element){if(line!==element.line||element.line===line&&sf.base.isNullOrUndefined(element.nextElement)&&!element.line.isLastLine()){this.moveToNextLine(line);if(this.documentHelper.compatibilityMode!=='Word2013'&&this.isOverlapFloatTable){var table=void 0;if(element.line.paragraph.previousRenderedWidget instanceof TableWidget&&element.line.paragraph.previousRenderedWidget.wrapTextAround){table=element.line.paragraph.previousRenderedWidget;this.viewer.clientActiveArea.x=this.viewer.clientActiveArea.x-HelperMethods.convertPointToPixel(table.firstChild.firstChild.leftMargin);}this.viewer.clientActiveArea.x+=line.paragraph.leftIndent;this.isOverlapFloatTable=false;}if(line!==element.line){this.isRTLLayout=false;}}if(element.line!==line&&this.viewer instanceof PageLayoutViewer&&this.viewer.clientActiveArea.height<element.height&&this.viewer.clientActiveArea.y!==this.viewer.clientArea.y){this.moveToNextPage(this.viewer,element.line);}else if(element.line===line&&sf.base.isNullOrUndefined(element.nextElement)&&line.paragraph.lastChild===line&&!line.isLastLine()&&this.viewer.clientActiveArea.height>=0){this.moveFromNextPage(line);}};Layout.prototype.checkAndSplitTabOrLineBreakCharacter=function(text,element){var _char=['\t','\v','\f'];var index=HelperMethods.indexOfAny(text,_char);if(index>-1){var character=text[index];if(character==='\t'&&text!=='\t'||character==='\v'&&text!=='\v'||character==='\f'&&text!=='\f'){this.splitByLineBreakOrTab(this.viewer,element,index,character);}}};Layout.prototype.splitTextByConsecutiveLtrAndRtl=function(element){var text=element.text;var charTypeIndex=0;var splittedText=[];var hasRTLCharacter=false;var characterRangeTypes=[];var lastLtrIndex=-1;var ltrText='';var rtlText='';var wordSplitChars='';var numberText='';var isTextBidi=element.characterFormat.bidi;for(var i=0;i<text.length;i++){var currentCharacterType=0;var separateEachWordSplitChars=false;// if ((isPrevLTRText.HasValue ? !isPrevLTRText.Value : isTextBidi) && char.IsNumber(text[i]))
if(isTextBidi&&/^[0-9]+$/.test(text[i])){numberText+=text[i];currentCharacterType=4;}else if(this.documentHelper.textHelper.containsSpecialCharAlone(text.charAt(i))){currentCharacterType=2;if(separateEachWordSplitChars=isTextBidi||text.charAt(i)===' '&&wordSplitChars===''){wordSplitChars+=text[i];}}else if(this.documentHelper.textHelper.isRTLText(text.charAt(i))){hasRTLCharacter=true;rtlText+=text[i];currentCharacterType=1;}else{ltrText+=text[i];}if(numberText!==''&&currentCharacterType!==4){splittedText.push(numberText);characterRangeTypes.push('Number');numberText='';}if(rtlText!==''&&currentCharacterType!==1){splittedText.push(rtlText);characterRangeTypes.push('RTL');rtlText='';}if(ltrText!==''&&currentCharacterType!==0){splittedText.push(ltrText);lastLtrIndex=splittedText.length-1;characterRangeTypes.push('LTR');ltrText='';}if(wordSplitChars!==''&&(currentCharacterType!==2||separateEachWordSplitChars)){splittedText.push(wordSplitChars);characterRangeTypes.push('WordSplit');wordSplitChars='';}}if(numberText!==''){splittedText.push(numberText);characterRangeTypes.push('Number');}else if(rtlText!==''){splittedText.push(rtlText);characterRangeTypes.push('RTL');}else if(ltrText!==''){splittedText.push(ltrText);lastLtrIndex=splittedText.length-1;characterRangeTypes.push('LTR');}else if(wordSplitChars!==''){splittedText.push(wordSplitChars);characterRangeTypes.push('WordSplit');}if(hasRTLCharacter){for(var i=1;i<splittedText.length;i++){//Combines the consecutive LTR,RTL,and Number(Number get combined only if it's splitted by non reversing characters (.,:)) 
//along with single in-between word split character.
var charType=characterRangeTypes[i+charTypeIndex];if(charType==='WordSplit'&&splittedText[i].length===1&&i+charTypeIndex+1<characterRangeTypes.length&&characterRangeTypes[i+charTypeIndex-1]!=='WordSplit'&&(characterRangeTypes[i+charTypeIndex-1]!=='Number'//Else handled to combine consecutive number 
//when text bidi is false and middle word split character is not white space.
||this.isNumberNonReversingCharacter(splittedText[i],isTextBidi))&&characterRangeTypes[i+charTypeIndex-1]===characterRangeTypes[i+charTypeIndex+1]){splittedText[i-1]=splittedText[i-1]+splittedText[i]+splittedText[i+1];splittedText.splice(i,1);splittedText.splice(i,1);characterRangeTypes.splice(i+charTypeIndex,1);characterRangeTypes.splice(i+charTypeIndex,1);i--;}}}else if(lastLtrIndex!==-1){if(isTextBidi){for(var i=1;i<lastLtrIndex;i++){//Combines the first and last LTR along with all in-between splited text's.
var charType=characterRangeTypes[i+charTypeIndex];if(charType==='WordSplit'&&i<lastLtrIndex&&characterRangeTypes[i+charTypeIndex-1]==='LTR'){ltrText='';for(var j=i+1;j<=lastLtrIndex;j++){ltrText+=splittedText[j];splittedText.splice(j,1);characterRangeTypes.splice(j+charTypeIndex);j--;lastLtrIndex--;}splittedText[i-1]=splittedText[i-1]+splittedText[i]+ltrText;splittedText.splice(i,1);characterRangeTypes.splice(i+charTypeIndex);i--;lastLtrIndex--;}}}else{//Return the input text if text bidi is false.
splittedText=[];splittedText.push(text);}}else if(!isTextBidi){//Return the input text if text bidi is false.
splittedText=[];splittedText.push(text);}if(isTextBidi){for(var j=1;j<splittedText.length;j++){//Combines the consecutive LTR, RTL, and Number(Number get combined only if it's splitted by non reversing characters (.,:)
//or if it's lang attribute is represent a RTL language)
//along with single in-between number non reversing word split character.
var characterType=characterRangeTypes[j+charTypeIndex];if(characterType==='WordSplit'&&splittedText[j].length===1&&j+charTypeIndex+1<characterRangeTypes.length&&characterRangeTypes[j+charTypeIndex-1]!=='WordSplit'&&(characterRangeTypes[j+charTypeIndex-1]!=='Number'||this.isNumberNonReversingCharacter(splittedText[j],isTextBidi))&&characterRangeTypes[j+charTypeIndex-1]===characterRangeTypes[j+charTypeIndex+1]){splittedText[j-1]=splittedText[j-1]+splittedText[j]+splittedText[j+1];splittedText.splice(j,1);splittedText.splice(j,1);characterRangeTypes.splice(j+charTypeIndex,1);characterRangeTypes.splice(j+charTypeIndex);j--;// //Combines the Number along with single non-word split characters (% $ #).
// else if (charType=='WordSplit'
//     && characterRangeTypes[i + charTypeIndex - 1]=='Number') {
//     splittedText[i - 1] = splittedText[i - 1] + splittedText[i];
//     splittedText.splice(i, 1);
//     characterRangeTypes.splice(i + charTypeIndex, 1);
//     i--;
// }
//Combines the consecutive LTR and Number
}else if(characterType==='LTR'&&(characterRangeTypes[j+charTypeIndex-1]==='Number'||characterRangeTypes[j+charTypeIndex-1]==='LTR')){splittedText[j-1]=splittedText[j-1]+splittedText[j];characterRangeTypes[j+charTypeIndex-1]='LTR';splittedText.splice(j,1);characterRangeTypes.splice(j+charTypeIndex,1);j--;}}}return splittedText;};Layout.prototype.isNumberNonReversingCharacter=function(character,isTextBidi){var numberNonReversingCharacters=',.:';//(.,:) are the number non-reversing characters.
if(numberNonReversingCharacters.indexOf(character[0])!==-1){if(character[0]==='.'?!isTextBidi:true){return true;}}return false;};Layout.prototype.updateSplittedText=function(span,splittedText){var text='';var inlineIndex=span.line.children.indexOf(span);if(splittedText.length>1){for(var j=0;j<splittedText.length;j++){text=splittedText[j];if(j>0){var newSpan2=new TextElementBox();newSpan2.line=span.line;newSpan2.characterFormat.copyFormat(span.characterFormat);span.line.children.splice(inlineIndex+j,0,newSpan2);if(span.revisions.length>0){this.updateRevisionForSpittedElement(span,newSpan2,true);newSpan2.isMarkedForRevision=span.isMarkedForRevision;}newSpan2.text=text;}else{//Replace the source text range with splitted text.
span.text=text;}}}};Layout.prototype.moveFromNextPage=function(line){var nextLine=line.nextLine;if(nextLine&&line.paragraph.childWidgets.indexOf(nextLine)===-1){var splittedParagraph=nextLine.paragraph;nextLine.paragraph.childWidgets.splice(nextLine.indexInOwner,1);line.paragraph.childWidgets.push(nextLine);nextLine.paragraph=line.paragraph;if(splittedParagraph.childWidgets.length===0){splittedParagraph.destroy();}}};Layout.prototype.cutClientWidth=function(currentElement){this.clearLineMeasures();var line=currentElement.line;line.marginTop=0;var width=0;for(var i=0;i<line.children.length;i++){var element=line.children[i];width+=element.width;if(currentElement===element){break;}}var splitCurrentWidget=this.viewer.clientActiveArea.width-width<0;var paragarph=currentElement.line.paragraph;var bodyWidget=paragarph.bodyWidget;if(bodyWidget&&bodyWidget.floatingElements.length>0){this.hasFloatingElement=true;this.isXPositionUpdated=true;return false;}if(!splitCurrentWidget){this.viewer.cutFromLeft(this.viewer.clientActiveArea.x+width);if(currentElement.line.paragraph.paragraphFormat.textAlignment==='Justify'&&currentElement instanceof TextElementBox){this.splitTextElementWordByWord(currentElement);}if(sf.base.isNullOrUndefined(currentElement.nextElement)&&this.viewer.clientActiveArea.width>0&&!currentElement.line.isLastLine()){this.moveElementFromNextLine(line);}}else if(currentElement.previousElement){this.cutClientWidth(currentElement.previousElement);}return splitCurrentWidget;};Layout.prototype.layoutFieldCharacters=function(element){if(element.fieldType===0){if(!sf.base.isNullOrUndefined(element.formFieldData)&&this.isInitialLoad){this.checkAndUpdateFieldData(element);}if(!this.isFieldCode&&(!sf.base.isNullOrUndefined(element.fieldEnd)||element.hasFieldEnd)){this.documentHelper.fieldStacks.push(element);this.isFieldCode=true;element.hasFieldEnd=true;}}else if(this.documentHelper.fieldStacks.length>0){if(element.fieldType===2){var field=this.documentHelper.fieldStacks[this.documentHelper.fieldStacks.length-1];if(field.fieldSeparator===element&&(!sf.base.isNullOrUndefined(field.fieldEnd)||field.hasFieldEnd)){this.isFieldCode=false;}}else{var field=this.documentHelper.fieldStacks[this.documentHelper.fieldStacks.length-1];if(element===field.fieldEnd){this.documentHelper.fieldStacks.pop();this.isFieldCode=false;}}}};Layout.prototype.checkAndUpdateFieldData=function(fieldBegin){if(fieldBegin.hasFieldEnd&&!sf.base.isNullOrUndefined(fieldBegin.fieldEnd)){if(sf.base.isNullOrUndefined(fieldBegin.fieldSeparator)){var seperator=new FieldElementBox(2);seperator.fieldBegin=fieldBegin;seperator.fieldEnd=fieldBegin.fieldEnd;seperator.line=fieldBegin.line;fieldBegin.line.children.splice(fieldBegin.fieldEnd.indexInOwner,0,seperator);fieldBegin.fieldSeparator=seperator;fieldBegin.fieldEnd.fieldSeparator=seperator;}var previousNode=fieldBegin.fieldEnd.previousNode;if(previousNode instanceof FieldElementBox&&previousNode.fieldType===2){var formFieldData=fieldBegin.formFieldData;if(formFieldData instanceof CheckBoxFormField){// Check box character is rendered smaller when compared to MS Word
// So, mutiplied the font side by below factor to render check box character large.
var factor=1.2;var checkBoxTextElement=new TextElementBox();checkBoxTextElement.line=fieldBegin.line;var index=fieldBegin.line.children.indexOf(fieldBegin.fieldEnd);fieldBegin.line.children.splice(index,0,checkBoxTextElement);checkBoxTextElement.characterFormat.copyFormat(fieldBegin.characterFormat);if(formFieldData.checked){checkBoxTextElement.text=String.fromCharCode(9745);}else{checkBoxTextElement.text=String.fromCharCode(9744);}if(formFieldData.sizeType!=='Auto'){checkBoxTextElement.characterFormat.fontSize=formFieldData.size*factor;}else{checkBoxTextElement.characterFormat.fontSize=checkBoxTextElement.characterFormat.fontSize*factor;}}else if(formFieldData instanceof DropDownFormField){var dropDownTextElement=new TextElementBox();dropDownTextElement.characterFormat.copyFormat(fieldBegin.characterFormat);dropDownTextElement.line=fieldBegin.line;if(formFieldData.dropdownItems.length>0){dropDownTextElement.text=formFieldData.dropdownItems[formFieldData.selectedIndex];}else{dropDownTextElement.text=this.documentHelper.textHelper.repeatChar(this.documentHelper.textHelper.getEnSpaceCharacter(),5);}var index=fieldBegin.line.children.indexOf(fieldBegin.fieldEnd);fieldBegin.line.children.splice(index,0,dropDownTextElement);}}}};Layout.prototype.layoutEmptyLineWidget=function(paragraph,isEmptyLine,line,isShiftEnter){var paraFormat=paragraph.paragraphFormat;var subWidth=0;var whiteSpaceCount=0;isShiftEnter=sf.base.isNullOrUndefined(isShiftEnter)?false:isShiftEnter;//Calculate line height and descent based on formatting defined in paragraph.
var paragraphMarkSize=this.documentHelper.textHelper.getParagraphMarkSize(paragraph.characterFormat);var maxHeight=paragraphMarkSize.Height;var beforeSpacing=this.getBeforeSpacing(paragraph);var lineWidget;if(paragraph.childWidgets.length>0&&!isShiftEnter){lineWidget=paragraph.childWidgets[0];if(lineWidget.children.length>0){if(!this.isBidiReLayout&&(paraFormat.bidi||this.isContainsRtl(lineWidget))){this.reArrangeElementsForRtl(lineWidget,paraFormat.bidi);this.isRTLLayout=true;}var isParagraphStart=lineWidget.isFirstLine();var isParagraphEnd=lineWidget.isLastLine();var firstLineIndent=0;if(isParagraphStart){beforeSpacing=this.getBeforeSpacing(paragraph);firstLineIndent=HelperMethods.convertPointToPixel(paraFormat.firstLineIndent);}var textAlignment=paraFormat.textAlignment;if(textAlignment!=='Left'&&this.viewer.textWrap&&(!(textAlignment==='Justify'&&isParagraphEnd)||textAlignment==='Justify'&&paraFormat.bidi)){var getWidthAndSpace=this.getSubWidth(lineWidget,textAlignment==='Justify',whiteSpaceCount,firstLineIndent,isParagraphEnd);subWidth=getWidthAndSpace[0].subWidth;whiteSpaceCount=getWidthAndSpace[0].spaceCount;}}}else{lineWidget=isEmptyLine?this.addLineWidget(paragraph):line;}if(!sf.base.isNullOrUndefined(paragraph.containerWidget)&&paragraph.bodyWidget.floatingElements.length>0&&!(paragraph.containerWidget instanceof TextFrame)){var elementBox=new TextElementBox();elementBox.line=lineWidget;lineWidget.children.push(elementBox);elementBox.text='';elementBox.characterFormat=paragraph.characterFormat;elementBox.width=this.documentHelper.textHelper.getTextSize(elementBox,elementBox.characterFormat);this.adjustPosition(elementBox,paragraph.bodyWidget);paragraph.x+=elementBox.padding.left;lineWidget.children.splice(elementBox.indexInOwner,1);}//isNullOrUndefined(this.viewer.currentHeaderFooter) &&
if(this.viewer instanceof PageLayoutViewer&&this.viewer.clientActiveArea.height<beforeSpacing+maxHeight&&this.viewer.clientActiveArea.y!==this.viewer.clientArea.y){this.moveToNextPage(this.viewer,lineWidget);}//Gets line spacing.
var lineSpacing=this.getLineSpacing(paragraph,maxHeight);//let maxDescent: number = maxHeight - paragraphMarkSize.BaselineOffset;
//Calculate the bottom position of current line - max height + line spacing.
if(!isNaN(this.maxTextHeight)&&maxHeight<this.maxTextHeight){maxHeight=this.maxTextHeight;//maxDescent = maxHeight - this.maxTextBaseline;
}var topMargin=0;var bottomMargin=0;var leftMargin=0;var height=maxHeight;var lineSpacingType=paragraph.paragraphFormat.lineSpacingType;if(lineSpacingType==='Multiple'){if(lineSpacing>maxHeight){bottomMargin+=lineSpacing-maxHeight;}else{topMargin+=lineSpacing-maxHeight;}}else if(lineSpacingType==='Exactly'){topMargin+=lineSpacing-(topMargin+height+bottomMargin);}else if(lineSpacing>topMargin+height+bottomMargin){topMargin+=lineSpacing-(topMargin+height+bottomMargin);}topMargin+=beforeSpacing;bottomMargin+=HelperMethods.convertPointToPixel(this.getAfterSpacing(paragraph));for(var i=0;i<lineWidget.children.length;i++){var element=lineWidget.children[i];if(i===0&&element instanceof ListTextElementBox){var textAlignment=paragraph.paragraphFormat.textAlignment;if(textAlignment==='Right'){//Aligns the text as right justified.
leftMargin=subWidth;}else if(textAlignment==='Center'){//Aligns the text as center justified.
leftMargin=subWidth/2;}element.margin=new Margin(leftMargin,topMargin,0,bottomMargin);element.line=lineWidget;lineWidget.height=topMargin+height+bottomMargin;}}lineWidget.height=topMargin+height+bottomMargin;if(sf.base.isNullOrUndefined(paragraph.nextRenderedWidget)&&paragraph.isInsideTable&&paragraph.previousRenderedWidget instanceof TableWidget&&paragraph.isEmpty()&&(!(paragraph.childWidgets[0].children.length>0&&paragraph.childWidgets[0].children[0]instanceof ListTextElementBox)||paragraph.childWidgets[0].children.length===0)){//Special behavior for empty cell mark after nested table, preserved with zero height by default.
//Empty line is displayed in cell for the last empty paragraph (Cell mark - last paragraph in cell) after a nested table.
lineWidget.height=0;}this.viewer.cutFromTop(this.viewer.clientActiveArea.y+lineWidget.height);//Clears the previous line elements from collection.
};Layout.prototype.layoutListItems=function(paragraph){if(!this.isFieldCode){if(!sf.base.isNullOrUndefined(paragraph.paragraphFormat)&&!sf.base.isNullOrUndefined(paragraph.paragraphFormat.listFormat)&&!sf.base.isNullOrUndefined(this.documentHelper.getListById(paragraph.paragraphFormat.listFormat.listId))&&paragraph.paragraphFormat.listFormat.listLevelNumber>=0&&paragraph.paragraphFormat.listFormat.listLevelNumber<9){this.clearListElementBox(paragraph);this.layoutList(paragraph,this.documentHelper);}else if(paragraph.paragraphFormat.listFormat&&paragraph.paragraphFormat.listFormat.listId===-1){this.clearListElementBox(paragraph);}}};Layout.prototype.layoutList=function(paragraph,documentHelper){var list=documentHelper.getListById(paragraph.paragraphFormat.listFormat.listId);this.viewer.updateClientWidth(-HelperMethods.convertPointToPixel(paragraph.paragraphFormat.firstLineIndent));var currentListLevel=this.getListLevel(list,paragraph.paragraphFormat.listFormat.listLevelNumber);// if (isNullOrUndefined(currentListLevel)) {
//     return;
// }
var lineWidget=paragraph.childWidgets[0];if(sf.base.isNullOrUndefined(lineWidget)){lineWidget=new LineWidget(paragraph);paragraph.childWidgets.push(lineWidget);}var element=new ListTextElementBox(currentListLevel,false);element.line=lineWidget;if(currentListLevel.listLevelPattern==='Bullet'){element.text=currentListLevel.numberFormat;}else{element.text=this.getListNumber(paragraph.paragraphFormat.listFormat);}if(this.documentHelper.isIosDevice){var text=element.text;text=text==="\uF0B7"?"\u25CF":text==="\uF06F"+" "?"\u25CB":text;if(text!==element.text){element.text=text;}}documentHelper.textHelper.updateTextSize(element,paragraph);var moveToNextPage;if(this.viewer instanceof PageLayoutViewer&&this.viewer.clientActiveArea.height<element.height&&this.viewer.clientActiveArea.y!==this.viewer.clientArea.y){moveToNextPage=true;}this.viewer.cutFromLeft(this.viewer.clientActiveArea.x+element.width);//Adds the text element to the line
lineWidget.children.splice(0,0,element);if(currentListLevel.followCharacter!=='None'){element=new ListTextElementBox(currentListLevel,true);if(currentListLevel.followCharacter==='Tab'){element.text='\t';var index=lineWidget.children.indexOf(element);var tabWidth=this.getTabWidth(paragraph,this.viewer,index,lineWidget,element);documentHelper.textHelper.updateTextSize(element,paragraph);element.width=tabWidth;}else{element.text=' ';documentHelper.textHelper.updateTextSize(element,paragraph);}this.viewer.cutFromLeft(this.viewer.clientActiveArea.x+element.width);//Adds the tabSpace to the line
lineWidget.children.splice(1,0,element);element.line=lineWidget;}if(moveToNextPage){this.moveToNextPage(this.viewer,lineWidget);this.cutClientWidth(element);this.hasFloatingElement=false;this.isXPositionUpdated=false;return;}if(currentListLevel.followCharacter!=='None'){this.viewer.updateClientWidth(HelperMethods.convertPointToPixel(paragraph.paragraphFormat.firstLineIndent));}};Layout.prototype.addBodyWidget=function(area,widget){var bodyWidget;if(widget){bodyWidget=widget;}else{bodyWidget=new BodyWidget();}bodyWidget.width=area.width;bodyWidget.x=area.x;bodyWidget.y=area.y;// this.addSectionInDictionary(this.viewer, section, bodyWidget);
return bodyWidget;};Layout.prototype.addListLevels=function(abstractList){for(var i=abstractList.levels.length;i<9;i++){var listLevel=new WListLevel(abstractList);var val=i%3;if(abstractList.levels[0].listLevelPattern==='Bullet'){listLevel.listLevelPattern='Bullet';listLevel.numberFormat=val===0?"\uF0B7":val===1?"\uF06F"+" ":"\uF0A7";listLevel.characterFormat.fontFamily=listLevel.numberFormat==="\uF0A7"?'Wingdings':'Symbol';}else{listLevel.listLevelPattern=this.getListLevelPattern(val);listLevel.numberFormat='%'+(i+1).toString()+'.';listLevel.startAt=1;listLevel.restartLevel=i;}listLevel.paragraphFormat=new WParagraphFormat(undefined);listLevel.paragraphFormat.leftIndent=48*(i+1);listLevel.paragraphFormat.firstLineIndent=-24;abstractList.levels.push(listLevel);}};Layout.prototype.addSplittedLineWidget=function(lineWidget,elementIndex,splittedElementBox){if(this.isWrapText){if(!sf.base.isNullOrUndefined(splittedElementBox)){lineWidget.children.splice(elementIndex+1,0,splittedElementBox);splittedElementBox.line=lineWidget;}return;}var paragraph=lineWidget.paragraph;var movedElementBox=[];var lineIndex=paragraph.childWidgets.indexOf(lineWidget);if(!sf.base.isNullOrUndefined(splittedElementBox)){movedElementBox.push(splittedElementBox);}var newLineWidget=undefined;//Move Next element box to temp collection
for(var i=elementIndex+1;i<lineWidget.children.length;i++){movedElementBox.push(lineWidget.children[i]);}if(movedElementBox.length>0){if(lineIndex===paragraph.childWidgets.length-1){newLineWidget=new LineWidget(paragraph);}else{newLineWidget=paragraph.childWidgets[lineIndex+1];}for(var j=0;j<movedElementBox.length;j++){movedElementBox[j].line=newLineWidget;}lineWidget.children.splice(elementIndex+1,lineWidget.children.length-1);newLineWidget.children=movedElementBox.concat(newLineWidget.children);if(paragraph.childWidgets.indexOf(newLineWidget)===-1){paragraph.childWidgets.splice(lineIndex+1,0,newLineWidget);}}};Layout.prototype.addElementToLine=function(paragraph,element){if(!(element instanceof ShapeBase&&element.textWrappingStyle!=='Inline')){if(this.isWrapText){this.isWrapText=false;this.viewer.clientActiveArea.width=this.viewer.clientArea.right-this.viewer.clientActiveArea.x;}this.viewer.cutFromLeft(this.viewer.clientActiveArea.x+element.width);}if(paragraph.paragraphFormat.textAlignment==='Justify'&&element instanceof TextElementBox){this.splitTextElementWordByWord(element);}};Layout.prototype.splitElementForClientArea=function(paragraph,element){//const line: LineWidget = element.line;
if(element.line.children.length>0){var previousElement=element.previousElement;var index=element.indexInOwner;// if line widget contain only single image element box need to skip this from splitting
// else move element to next line
if(element.line.children.length>1){if(previousElement&&this.viewer.clientActiveArea.x!==this.viewer.clientArea.x){index-=1;}}this.addSplittedLineWidget(element.line,index);}};Layout.prototype.splitByWord=function(lineWidget,paragraph,elementBox,text,width,characterFormat){var index=this.getSplitIndexByWord(this.viewer.clientActiveArea.width,text,width,characterFormat);if(index>0&&index<elementBox.length){var indexOf=lineWidget.children.indexOf(elementBox);//const lineIndex: number = paragraph.childWidgets.indexOf(lineWidget);
var splittedElementBox=new TextElementBox();text=text.substring(index);splittedElementBox.text=text;if(text[0]===' '){var prevLength=text.length;text=HelperMethods.trimStart(text);//To trim white space at starting of the text.
index+=prevLength-text.length;}splittedElementBox.characterFormat.copyFormat(elementBox.characterFormat);splittedElementBox.width=this.documentHelper.textHelper.getWidth(splittedElementBox.text,characterFormat);splittedElementBox.trimEndWidth=splittedElementBox.width;//splittedElementBox.revisions = splittedElementBox.revisions;
elementBox.text=elementBox.text.substr(0,index);elementBox.width-=splittedElementBox.width;elementBox.trimEndWidth=elementBox.width;if(elementBox.revisions.length>0){this.updateRevisionForSpittedElement(elementBox,splittedElementBox,true);splittedElementBox.isMarkedForRevision=elementBox.isMarkedForRevision;}splittedElementBox.height=elementBox.height;splittedElementBox.baselineOffset=elementBox.baselineOffset;this.splitErrorCollection(elementBox,splittedElementBox);this.addSplittedLineWidget(lineWidget,indexOf,splittedElementBox);this.addElementToLine(paragraph,elementBox);if(elementBox.width===0){lineWidget.children.splice(indexOf,1);}}};Layout.prototype.splitErrorCollection=function(elementBox,splittedBox){if(elementBox.errorCollection.length>0){var errorCollection=[];var ignoreItems=elementBox.ignoreOnceItems;for(var i=0;i<elementBox.errorCollection.length;i++){errorCollection.push(elementBox.errorCollection[i]);}for(var j=0;j<elementBox.errorCollection.length;j++){var index=elementBox.text.indexOf(elementBox.errorCollection[j].text);var textElement=elementBox.errorCollection[j];if(index<0){errorCollection.splice(0,1);splittedBox.errorCollection.push(textElement);}else if(splittedBox.text.indexOf(textElement.text)>0){splittedBox.errorCollection.push(textElement);}}splittedBox.ignoreOnceItems=ignoreItems;elementBox.ignoreOnceItems=[];elementBox.errorCollection=errorCollection;}};Layout.prototype.splitByCharacter=function(lineWidget,textElement,text,width,characterFormat){var paragraph=lineWidget.paragraph;var index=this.getTextSplitIndexByCharacter(this.viewer.clientArea.width,this.viewer.clientActiveArea.width,text,width,characterFormat);var splitWidth=0;if(index<textElement.length){splitWidth=this.documentHelper.textHelper.measureTextExcludingSpaceAtEnd(text.substring(0,index),characterFormat);text=text.substring(index);}if(splitWidth>this.viewer.clientActiveArea.width&&textElement.indexInOwner>0){this.addSplittedLineWidget(lineWidget,textElement.indexInOwner-1);return;}var indexOf=lineWidget.children.indexOf(textElement);if(index<textElement.length){//const lineIndex: number = paragraph.childWidgets.indexOf(lineWidget);
var splittedElement=new TextElementBox();splittedElement.text=text;splittedElement.errorCollection=textElement.errorCollection;textElement.text=textElement.text.substr(0,index);splittedElement.characterFormat.copyFormat(textElement.characterFormat);splittedElement.width=this.documentHelper.textHelper.getWidth(splittedElement.text,characterFormat);splittedElement.trimEndWidth=splittedElement.width;textElement.width-=splittedElement.width;textElement.trimEndWidth=textElement.width;splittedElement.height=textElement.height;splittedElement.baselineOffset=textElement.baselineOffset;lineWidget.children.splice(textElement.indexInOwner+1,0,splittedElement);if(textElement.revisions.length>0){this.updateRevisionForSpittedElement(textElement,splittedElement,index>0);splittedElement.isMarkedForRevision=textElement.isMarkedForRevision;}this.addElementToLine(paragraph,textElement);this.addSplittedLineWidget(lineWidget,indexOf);if(textElement.width===0){lineWidget.children.splice(indexOf,1);}}else{//Adds the last text element on inline to line elements collection.
this.addSplittedLineWidget(lineWidget,indexOf);this.addElementToLine(paragraph,textElement);}};Layout.prototype.updateRevisionForSpittedElement=function(item,spittedElement,isSpitted,isJustify){if(item.revisions.length>0){for(var i=0;i<item.revisions.length;i++){var currentRevision=item.revisions[i];if(isSpitted){spittedElement.revisions.push(currentRevision);var rangeIndex=currentRevision.range.length-1;if(currentRevision.range[rangeIndex]instanceof WCharacterFormat){currentRevision.range.splice(rangeIndex-1,0,spittedElement);}else{rangeIndex=currentRevision.range.indexOf(item);if(rangeIndex<0){currentRevision.range.push(spittedElement);}else{if(isJustify){currentRevision.range.splice(rangeIndex,0,spittedElement);}else{currentRevision.range.splice(rangeIndex+1,0,spittedElement);}}}}else{currentRevision.range.splice(currentRevision.range.length-1,1);currentRevision.range.push(spittedElement);spittedElement.revisions.push(currentRevision);}}}};Layout.prototype.splitTextElementWordByWord=function(textElement){var lineWidget=textElement.line;var indexOf=lineWidget.children.indexOf(textElement);var startIndex=indexOf;var paddingLeft=textElement.padding.left;textElement.padding.left=0;var text=textElement.text;var format;var characterUptoWs=text.trim().indexOf(' ');if(characterUptoWs>=0){lineWidget.children.splice(indexOf,1);format=textElement.characterFormat;//const fontSize: number = format.fontSize;
var index=textElement.length-HelperMethods.trimStart(text).length;//Trim start
while(index<textElement.length){index=this.getTextIndexAfterSpace(text,index);if(index===0||index===textElement.length){break;}if(index<textElement.length){var splittedElement=new TextElementBox();var splittedText=text.substring(0,index);text=text.substring(index);if(text.substring(0,1)===' '){// start of the text is trimmed and its length is reduced from text length.
index+=text.length-HelperMethods.trimStart(text).length;}splittedElement.text=splittedText;splittedElement.characterFormat.copyFormat(textElement.characterFormat);splittedElement.line=lineWidget;splittedElement.width=this.documentHelper.textHelper.getWidth(splittedElement.text,format);splittedElement.trimEndWidth=splittedElement.width;splittedElement.height=textElement.height;splittedElement.baselineOffset=textElement.baselineOffset;lineWidget.children.splice(indexOf,0,splittedElement);if(textElement.revisions.length>0){this.updateRevisionForSpittedElement(textElement,splittedElement,index>0,true);splittedElement.isMarkedForRevision=textElement.isMarkedForRevision;}textElement.text=text;textElement.width-=splittedElement.width;textElement.trimEndWidth=textElement.width;if(textElement.width===0&&lineWidget.children.indexOf(textElement)!==-1){lineWidget.children.splice(lineWidget.children.indexOf(textElement),1);}index=0;indexOf++;}}textElement.text=text;lineWidget.children.splice(indexOf,0,textElement);}lineWidget.children[startIndex].padding.left=paddingLeft;};Layout.prototype.splitTextForClientArea=function(lineWidget,element,text,width,characterFormat){var paragraph=lineWidget.paragraph;var isSplitByWord=true;var index=-1;if(!(text.substring(0,1)===' ')){var textWidth=width;var characterUptoWS=0;characterUptoWS=HelperMethods.trimEnd(text).indexOf(' ')+1;index=characterUptoWS;//Checks whether text not starts with white space. If starts with white space, no need to check previous text blocks.
if(index>0){textWidth=this.documentHelper.textHelper.measureTextExcludingSpaceAtEnd(text.slice(0,index),characterFormat);}if(this.viewer.clientActiveArea.width<textWidth){//Check and split the previous text elements to next line.
isSplitByWord=this.checkPreviousElement(lineWidget,lineWidget.children.indexOf(element),characterFormat);if(isSplitByWord){//lineWidget = paragraph.childWidgets[paragraph.childWidgets.indexOf(lineWidget) + 1] as LineWidget;
//isSplitByWord = textWidth <= this.viewer.clientActiveArea.width;
return;}}}else{index=1;}if(width<=this.viewer.clientActiveArea.width){//Fits the text in current line.
this.addElementToLine(paragraph,element);}else if(isSplitByWord&&(index>0||text.indexOf(' ')!==-1)){this.splitByWord(lineWidget,paragraph,element,text,width,characterFormat);}else{this.splitByCharacter(lineWidget,element,text,width,characterFormat);}};Layout.prototype.splitByLineBreakOrTab=function(viewer,span,index,spiltBy){// Splits tab character to separate SpanAdv
var inlineIndex=span.line.children.indexOf(span);var value=span.text;var remainder=value.substring(index);var newSpan=spiltBy==='\t'?new TabElementBox():new TextElementBox();newSpan.line=span.line;newSpan.characterFormat.copyFormat(span.characterFormat);span.line.children.splice(inlineIndex+1,0,newSpan);if(index>0&&remainder.length===1){newSpan.text=value.substring(index);span.text=value.substring(0,index);}else if(index>0){newSpan.text=spiltBy;var newText=new TextElementBox();newText.line=span.line;newText.text=value.substring(index+1);newText.characterFormat.copyFormat(span.characterFormat);span.line.children.splice(inlineIndex+2,0,newText);span.text=value.substring(0,index);}else if(remainder!==''){newSpan.text=value.substring(index+1);span.text=spiltBy;}};/* eslint-disable  */Layout.prototype.moveToNextLine=function(line){var paragraph=line.paragraph;var paraFormat=paragraph.paragraphFormat;var isParagraphStart=line.isFirstLine();var isParagraphEnd=line.isLastLine();var height=0;var maxDescent=0;var afterSpacing=0;var beforeSpacing=0;var lineSpacing=0;var firstLineIndent=0;this.updateLineWidget(line);height=this.maxTextHeight;maxDescent=height-this.maxTextBaseline;var pageIndex=0;if(paragraph.bodyWidget){pageIndex=this.documentHelper.pages.indexOf(paragraph.bodyWidget.page);}//Updates before spacing at the top of Paragraph first line.
if(isParagraphStart){beforeSpacing=this.getBeforeSpacing(paragraph);firstLineIndent=HelperMethods.convertPointToPixel(paraFormat.firstLineIndent);}//Updates after spacing at the bottom of Paragraph last line.
if(isParagraphEnd){afterSpacing=HelperMethods.convertPointToPixel(this.getAfterSpacing(paragraph));}if(!this.isBidiReLayout&&(paraFormat.bidi||this.isContainsRtl(line))){this.reArrangeElementsForRtl(line,paraFormat.bidi);this.isRTLLayout=true;}if(isNaN(this.maxTextHeight)){//Calculate line height and descent based on formatting defined in paragraph.
var measurement=this.documentHelper.textHelper.measureText('a',paragraph.characterFormat);height=measurement.Height;maxDescent=height-measurement.BaselineOffset;}else{height=this.maxTextHeight;maxDescent=height-this.maxTextBaseline;}// Gets line spacing.
lineSpacing=this.getLineSpacing(paragraph,height);if(paraFormat.lineSpacingType==='Exactly'&&lineSpacing<maxDescent+this.maxBaseline){lineSpacing=maxDescent+this.maxBaseline;}var subWidth=0;var whiteSpaceCount=0;var getWidthAndSpace;var textAlignment=paraFormat.textAlignment;// calculates the sub width, for text alignments - Center, Right, Justify.
// if the element is paragraph end and para bidi is true and text alignment is justify
// we need to calculate subwidth and add it to the left margin of the element.
if(textAlignment!=='Left'&&this.viewer.textWrap&&(!(textAlignment==='Justify'&&isParagraphEnd)||textAlignment==='Justify'&&paraFormat.bidi)){getWidthAndSpace=this.getSubWidth(line,textAlignment==='Justify',whiteSpaceCount,firstLineIndent,isParagraphEnd);subWidth=getWidthAndSpace[0].subWidth;whiteSpaceCount=getWidthAndSpace[0].spaceCount;}var addSubWidth=false;var wrapIndex=0;var lineSpacingType=paraFormat.lineSpacingType;var isStarted=false;for(var i=0;i<line.children.length;i++){var topMargin=0;var bottomMargin=0;var leftMargin=0;var elementBox=line.children[i];if(!sf.base.isNullOrUndefined(getWidthAndSpace)&&isStarted&&elementBox.padding.left>0&&getWidthAndSpace.length>wrapIndex+1){var previousWidth=subWidth;if(textAlignment==="Justify"){previousWidth=subWidth*getWidthAndSpace[wrapIndex].spaceCount;}else if(textAlignment==="Center"){previousWidth=subWidth/2;}elementBox.padding.left=elementBox.padding.left-previousWidth;var subWidthInfo=getWidthAndSpace[++wrapIndex];subWidth=subWidthInfo.subWidth;whiteSpaceCount=subWidthInfo.spaceCount;}if(elementBox instanceof ShapeBase&&elementBox.textWrappingStyle!=='Inline'){continue;}isStarted=true;var alignElements=this.alignLineElements(elementBox,topMargin,bottomMargin,maxDescent,addSubWidth,subWidth,textAlignment,whiteSpaceCount,i===line.children.length-1);topMargin=alignElements.topMargin;bottomMargin=alignElements.bottomMargin;addSubWidth=alignElements.addSubWidth;whiteSpaceCount=alignElements.whiteSpaceCount;//Updates line spacing, paragraph after/ before spacing and aligns the text to base line offset.
if(lineSpacingType==='Multiple'){if(lineSpacing>height){bottomMargin+=lineSpacing-height;}else{topMargin+=lineSpacing-height;}}else if(lineSpacingType==='Exactly'){topMargin+=lineSpacing-(topMargin+elementBox.height+bottomMargin);}else if(lineSpacing>topMargin+elementBox.height+bottomMargin){topMargin+=lineSpacing-(topMargin+elementBox.height+bottomMargin);}if(pageIndex>0&&paragraph===paragraph.bodyWidget.childWidgets[0]){topMargin+=0;}else{topMargin+=beforeSpacing;}bottomMargin+=afterSpacing;if(i===0||!(elementBox instanceof ShapeBase&&elementBox.textWrappingStyle!=='Inline')&&elementBox.previousElement instanceof ShapeBase&&elementBox.previousElement.textWrappingStyle!=='Inline'||elementBox.padding.left>0){line.height=topMargin+elementBox.height+bottomMargin;if(textAlignment==='Right'||textAlignment==='Justify'&&paraFormat.bidi&&isParagraphEnd){//Aligns the text as right justified and consider subwidth for bidirectional paragrph with justify.
leftMargin=subWidth;}else if(textAlignment==='Center'){//Aligns the text as center justified.
leftMargin=subWidth/2;}}elementBox.margin=new Margin(leftMargin,topMargin,0,bottomMargin);elementBox.line=line;}this.checkInbetweenShapeOverlap(line);if(line.isLastLine()&&line.indexInOwner===0&&line.paragraph.paragraphFormat.widowControl){var previousSplitWidget=line.paragraph.previousSplitWidget;if(!sf.base.isNullOrUndefined(previousSplitWidget)){var startLineIndex=previousSplitWidget.childWidgets.length-1;if(previousSplitWidget.childWidgets.length===2){startLineIndex=0;}this.splitParagraph(previousSplitWidget,startLineIndex,line.paragraph);this.updateClientAreaForNextBlock(line,line.paragraph);}}this.viewer.cutFromTop(this.viewer.clientActiveArea.y+line.height);this.wrapPosition=[];};//Checks Inbetween Overlap & Updates Line marginTop
Layout.prototype.checkInbetweenShapeOverlap=function(line){var _this=this;if(!(line.paragraph.containerWidget instanceof TextFrame)&&line.paragraph.bodyWidget){var overlapShape_1;var lineY_1=this.getLineY(line);var isInsideTable_1=line.paragraph.isInsideTable;/* eslint:disable */line.paragraph.bodyWidget.floatingElements.sort(function(a,b){return a.y-b.y;});line.paragraph.bodyWidget.floatingElements.forEach(function(shape){if(isInsideTable_1&&shape.line&&!shape.line.paragraph.isInsideTable||sf.base.isNullOrUndefined(shape.line)){return;}var lineRect=new Rect(line.paragraph.x,_this.viewer.clientActiveArea.y,line.paragraph.width,line.height);var shapeRect=new Rect(shape.x,shape.y-shape.distanceTop,shape.width,shape.height);if(shape.line&&_this.isRelayout&&!_this.isRelayoutOverlap&&_this.viewer.documentHelper.selection.isExistAfter(shape.line.paragraph,line.paragraph)||_this.isRelayout&&_this.isRelayoutOverlap&&_this.viewer.documentHelper.selection.isExistAfter(shape.line.paragraph,_this.endOverlapWidget)){return;}var considerShape=shape.textWrappingStyle==='TopAndBottom';if(overlapShape_1&&considerShape&&overlapShape_1.y+overlapShape_1.height+overlapShape_1.distanceBottom+line.height>shape.y-shape.distanceTop&&overlapShape_1.y-overlapShape_1.distanceTop<shape.y-shape.distanceTop&&shape.y+shape.height+shape.distanceBottom>overlapShape_1.y+overlapShape_1.height+overlapShape_1.distanceBottom){overlapShape_1=shape;line.marginTop=shape.y+shape.height+shape.distanceBottom-lineY_1;}else if(considerShape&&!overlapShape_1&&lineRect.isIntersecting(shapeRect)){overlapShape_1=shape;line.marginTop=shape.y+shape.height+shape.distanceBottom-lineY_1;}});if(overlapShape_1){this.viewer.cutFromTop(overlapShape_1.y+overlapShape_1.height+overlapShape_1.distanceBottom);}else if(this.isRelayoutOverlap){line.marginTop=0;}}};Layout.prototype.getLineY=function(line){var para=line.paragraph;var lineY=para.y;if(!para.isEmpty()){var lineWidget=para.firstChild;while(lineWidget!==line){lineY=lineY+lineWidget.height+lineWidget.marginTop;lineWidget=lineWidget.nextLine;}}return lineY;};Layout.prototype.updateLineWidget=function(line){for(var i=0;i<line.children.length;i++){var element=line.children[i];if(element instanceof ShapeBase&&element.textWrappingStyle!=='Inline'){continue;}if(element instanceof TextElementBox||element instanceof ListTextElementBox){if(this.maxTextHeight<element.height){this.maxTextHeight=element.height;this.maxTextBaseline=element.baselineOffset;}if(this.maxBaseline<this.maxTextBaseline){this.maxBaseline=this.maxTextBaseline;}}else if(this.maxBaseline<element.height){this.maxBaseline=element.height;}}};Layout.prototype.moveToNextPage=function(viewer,line,isPageBreak){if(this.isFootNoteLayoutStart){return;}if(this.isRelayoutOverlap&&this.endOverlapWidget!==line.paragraph){line=this.endOverlapWidget.childWidgets[0];}var paragraphWidget=line.paragraph;var startBlock;var startIndex=0;var keepLinesTogether=false;var keepWithNext=false;if(paragraphWidget&&!(paragraphWidget.containerWidget instanceof FootNoteWidget)){var index=0;if(paragraphWidget instanceof FootNoteWidget){return;}if(!sf.base.isNullOrUndefined(line)){index=paragraphWidget.childWidgets.indexOf(line);if(index!==0){if(paragraphWidget.paragraphFormat.keepLinesTogether&&!sf.base.isNullOrUndefined(paragraphWidget.previousWidget)){index=0;keepLinesTogether=true;}else if(index==1&&paragraphWidget.paragraphFormat.widowControl&&!sf.base.isNullOrUndefined(paragraphWidget.previousWidget)){index=0;keepLinesTogether=true;}}if(index>0||isPageBreak){paragraphWidget.height=viewer.clientActiveArea.y-paragraphWidget.y;}if(index===0&&!paragraphWidget.isEndsWithPageBreak){var blockInfo=this.alignBlockElement(paragraphWidget);if(!sf.base.isNullOrUndefined(blockInfo.node)){startBlock=blockInfo.node instanceof TableRowWidget?this.splitRow(blockInfo.node):blockInfo.node;startIndex=startBlock instanceof TableWidget?0:parseInt(blockInfo.position.index,10);paragraphWidget=startBlock;index=startIndex;keepLinesTogether=false;keepWithNext=true;}}}// eslint-disable-next-line max-len
if(!sf.base.isNullOrUndefined(paragraphWidget.bodyWidget)&&!(paragraphWidget.bodyWidget instanceof FootNoteWidget)&&paragraphWidget.bodyWidget.page.footnoteWidget!==undefined){// this.viewer.updateClientAreaForBlock(paragraphWidget.bodyWidget.page.footnoteWidget.block, true);
this.layoutfootNote(paragraphWidget.bodyWidget.page.footnoteWidget);// this.viewer.updateClientAreaForBlock(paragraphWidget.bodyWidget.page.footnoteWidget.block, false);
}var nextBody=this.moveBlocksToNextPage(paragraphWidget);this.viewer.updateClientArea(nextBody.sectionFormat,nextBody.page);this.viewer.updateClientAreaForBlock(paragraphWidget,true);if(index>0){if(line.isLastLine()&&isPageBreak){return;}var nextParagraph=void 0;if(nextBody.firstChild instanceof ParagraphWidget&&nextBody.firstChild.equals(paragraphWidget)){nextParagraph=nextBody.firstChild;}else{nextParagraph=new ParagraphWidget();}nextParagraph=this.addParagraphWidget(this.viewer.clientActiveArea,nextParagraph);nextParagraph.index=paragraphWidget.index;var insertIndex=0;for(var i=index;i<paragraphWidget.childWidgets.length;i++){var lineWidget=paragraphWidget.childWidgets[i];lineWidget.paragraph=nextParagraph;nextParagraph.childWidgets.splice(insertIndex,0,lineWidget);lineWidget.paragraph=nextParagraph;insertIndex++;}nextParagraph.paragraphFormat=paragraphWidget.paragraphFormat;nextParagraph.characterFormat=paragraphWidget.characterFormat;paragraphWidget.childWidgets.splice(index);paragraphWidget=nextParagraph;}else if(!isPageBreak){paragraphWidget.containerWidget.removeChild(paragraphWidget.indexInOwner);}if(!isPageBreak){if(nextBody.childWidgets.indexOf(paragraphWidget)===-1){nextBody.childWidgets.splice(0,0,paragraphWidget);}paragraphWidget.containerWidget=nextBody;this.viewer.updateClientAreaLocation(paragraphWidget,this.viewer.clientActiveArea);if(keepLinesTogether||keepWithNext){// conside table case
if(line.paragraph!==paragraphWidget){if(paragraphWidget instanceof TableWidget){this.clearTableWidget(paragraphWidget,true,true,false);}this.layoutBlock(paragraphWidget,0);viewer.updateClientAreaForBlock(paragraphWidget,false);}var lastBlock=line.paragraph;if(keepWithNext){var nextBlock=paragraphWidget.nextWidget;if(!sf.base.isNullOrUndefined(nextBlock)){do{viewer.updateClientAreaForBlock(nextBlock,true);if(nextBlock!==lastBlock){if(nextBlock instanceof TableWidget){this.clearTableWidget(nextBlock,true,true,false);}this.layoutBlock(nextBlock,0);viewer.updateClientAreaForBlock(nextBlock,false);}else{this.viewer.updateClientAreaLocation(nextBlock,this.viewer.clientActiveArea);break;}nextBlock=nextBlock.nextWidget;}while(nextBlock);}}this.updateClientAreaForNextBlock(line,lastBlock);}if(line.indexInOwner===0&&!(line.children[0]instanceof ListTextElementBox)){var firstLineIndent=-HelperMethods.convertPointToPixel(line.paragraph.paragraphFormat.firstLineIndent);this.viewer.updateClientWidth(firstLineIndent);}}}if(paragraphWidget instanceof ParagraphWidget&&paragraphWidget.floatingElements.length>0){for(var m=0;m<paragraphWidget.floatingElements.length;m++){var shape=paragraphWidget.floatingElements[m];var position=this.getFloatingItemPoints(shape);shape.y=position.y;shape.x=position.x;if(shape instanceof ShapeElementBox)this.updateChildLocationForCellOrShape(shape.y,shape);}}if(this.isRelayoutOverlap&&this.endOverlapWidget){var block_2=this.endOverlapWidget.previousRenderedWidget;var para=line.paragraph;while(para){para.floatingElements.forEach(function(shape){if(block_2.bodyWidget.floatingElements.indexOf(shape)!==-1){block_2.bodyWidget.floatingElements.splice(block_2.bodyWidget.floatingElements.indexOf(shape),1);line.paragraph.bodyWidget.floatingElements.push(shape);}});para=para!==this.endOverlapWidget?para.nextWidget:undefined;}this.layoutStartEndBlocks(this.startOverlapWidget,this.endOverlapWidget);this.startOverlapWidget=undefined;this.viewer.clientActiveArea.height=this.viewer.clientActiveArea.bottom-this.endOverlapWidget.y;this.viewer.clientActiveArea.y=this.endOverlapWidget.y;}};/**
     * Align block based on keep with next and keep lines together property.
     */Layout.prototype.alignBlockElement=function(block){if(block instanceof ParagraphWidget&&block.isEndsWithPageBreak){return{node:undefined,position:{index:''}};}var startBlock;var startIndex=0;// Check previous block has keep with next property.
var previousBlock=this.getPreviousBlock(block);while(previousBlock){if(previousBlock instanceof ParagraphWidget){if(!previousBlock.paragraphFormat.keepWithNext||previousBlock.isEndsWithPageBreak){break;}startBlock=previousBlock;if(previousBlock.paragraphFormat.keepLinesTogether){if(sf.base.isNullOrUndefined(this.getPreviousBlock(previousBlock))){startBlock=undefined;}else{startIndex=0;}}else{if(sf.base.isNullOrUndefined(this.getPreviousBlock(previousBlock))&&previousBlock.childWidgets.length===1){startBlock=undefined;}else{if(!previousBlock.paragraphFormat.widowControl){startIndex=previousBlock.lastChild.indexInOwner;}else{startIndex=previousBlock.lastChild.indexInOwner-1;if(startIndex===1||startIndex<0){// Move entire block to next page based on widow control.
startIndex=0;}if(startIndex!==0){break;}}}}}else if(previousBlock instanceof TableRowWidget){var firstBlock=this.documentHelper.selection.getFirstParagraphInCell(previousBlock.childWidgets[0]);if(!firstBlock.paragraphFormat.keepWithNext){break;}if(firstBlock.paragraphFormat.keepWithNext){if(sf.base.isNullOrUndefined(this.getPreviousBlock(previousBlock))){startBlock=undefined;}else{startBlock=previousBlock;startIndex=startBlock.indexInOwner;}}// TODO: Table row splitting case
}previousBlock=this.getPreviousBlock(previousBlock);}return{node:startBlock,position:{index:startIndex.toString()}};};Layout.prototype.getPreviousBlock=function(block){var previousBlock;if(block instanceof ParagraphWidget){previousBlock=block.previousWidget;}else if(block instanceof TableRowWidget){previousBlock=block.previousWidget;if(sf.base.isNullOrUndefined(previousBlock)){previousBlock=block.ownerTable.previousWidget;}}if(previousBlock instanceof TableWidget){previousBlock=previousBlock.lastChild;}return previousBlock;};Layout.prototype.splitRow=function(startRow){var table=startRow.ownerTable;if(startRow.indexInOwner===0){return table;}var newTable=this.createTableWidget(table);for(var i=startRow.indexInOwner;i<table.childWidgets.length;){var rowWidget=table.childWidgets.splice(i,1)[0];newTable.childWidgets.push(rowWidget);rowWidget.containerWidget=newTable;table.height-=rowWidget.height;newTable.height+=rowWidget.height;}table.containerWidget.childWidgets.splice(table.indexInOwner+1,0,newTable);newTable.containerWidget=table.containerWidget;return newTable;};Layout.prototype.splitParagraph=function(paragarph,index,nextParagraph){if(index===0&&sf.base.isNullOrUndefined(nextParagraph)){return paragarph;}var isMoveCurrentBlock=false;if(sf.base.isNullOrUndefined(nextParagraph)){nextParagraph=new ParagraphWidget();nextParagraph.containerWidget=paragarph.containerWidget;paragarph.containerWidget.childWidgets.splice(paragarph.indexInOwner+1,0,nextParagraph);nextParagraph.paragraphFormat=paragarph.paragraphFormat;nextParagraph.characterFormat=paragarph.characterFormat;nextParagraph.index=paragarph.index;}else if(index===0){isMoveCurrentBlock=true;var temp=paragarph;paragarph=nextParagraph;nextParagraph=temp;}var insertIndex=0;for(var i=index;i<paragarph.childWidgets.length;i++){var lineWidget=paragarph.childWidgets[i];lineWidget.paragraph=nextParagraph;if(isMoveCurrentBlock){nextParagraph.childWidgets.push(lineWidget);}else{nextParagraph.childWidgets.splice(insertIndex,0,lineWidget);}nextParagraph.height+=lineWidget.height;paragarph.height-=lineWidget.height;lineWidget.paragraph=nextParagraph;insertIndex++;}if(isMoveCurrentBlock){nextParagraph.containerWidget.childWidgets.splice(nextParagraph.indexInOwner,1);nextParagraph.y=paragarph.y;nextParagraph.x=paragarph.x;nextParagraph.containerWidget=paragarph.containerWidget;paragarph.containerWidget.childWidgets.unshift(nextParagraph);}else{paragarph.childWidgets.splice(index);}if(paragarph.childWidgets.length===0||isMoveCurrentBlock){paragarph.containerWidget.childWidgets.splice(paragarph.indexInOwner,1);}return nextParagraph;};Layout.prototype.updateClientPositionForBlock=function(block,currentBlock){var startBlock=block instanceof TableRowWidget?block.ownerTable:block;var isClientAreaUpdated=false;do{this.viewer.updateClientAreaForBlock(startBlock,true);if(startBlock instanceof ParagraphWidget){if(currentBlock instanceof ParagraphWidget&&currentBlock.equals(startBlock)){isClientAreaUpdated=true;break;}this.addParagraphWidget(this.viewer.clientActiveArea,startBlock);this.viewer.cutFromTop(this.viewer.clientActiveArea.y+startBlock.height);this.viewer.updateClientAreaForBlock(startBlock,false);}else if(startBlock instanceof TableWidget){this.addTableWidget(this.viewer.clientActiveArea,[startBlock]);var nextRow=startBlock.firstChild;if(currentBlock instanceof TableRowWidget&&startBlock.equals(currentBlock.ownerTable)&&!sf.base.isNullOrUndefined(nextRow)){do{if(nextRow.equals(currentBlock)){isClientAreaUpdated=true;break;}this.addTableRowWidget(this.viewer.clientActiveArea,[nextRow]);this.updateChildLocationForRow(this.viewer.clientActiveArea.y,nextRow);this.viewer.cutFromTop(this.viewer.clientActiveArea.y+nextRow.height);startBlock.height+=nextRow.height;nextRow=nextRow.nextWidget;}while(nextRow);}else{this.updateChildLocationForTable(startBlock.y,startBlock);this.viewer.cutFromTop(this.viewer.clientActiveArea.y+startBlock.height);this.viewer.updateClientAreaForBlock(startBlock,false);}}startBlock=startBlock.nextWidget;}while(startBlock&&!isClientAreaUpdated);};Layout.prototype.updateClientAreaForNextBlock=function(line,paragraphWidget){for(var m=0;m<paragraphWidget.childWidgets.length;m++){var child=paragraphWidget.childWidgets[m];if(line===child){break;}this.viewer.cutFromTop(this.viewer.clientActiveArea.y+child.height);}};Layout.prototype.layoutStartEndBlocks=function(startBlock,endBlock){var block=startBlock;this.isOverlapFloatTable=true;this.viewer.clientActiveArea.height=this.viewer.clientActiveArea.bottom-startBlock.y;this.viewer.clientActiveArea.y=startBlock.y;while(block){this.viewer.updateClientAreaForBlock(block,true);if(block instanceof ParagraphWidget){this.layoutParagraph(block,0);}else{this.clearTableWidget(block,true,true,true);this.layoutTable(block,0);}this.viewer.updateClientAreaForBlock(block,false);block=block!==endBlock?block.nextWidget:undefined;}};// eslint-disable-next-line max-len
Layout.prototype.alignLineElements=function(element,topMargin,bottomMargin,maxDescent,addSubWidth,subWidth,textAlignment,whiteSpaceCount,isLastElement){if(element.width>0&&(element instanceof TextElementBox||element instanceof ListTextElementBox)){var textElement=element instanceof TextElementBox?element:undefined;//Updates the text to base line offset.
var baselineOffset=element instanceof TextElementBox?textElement.baselineOffset:element.baselineOffset;topMargin+=this.maxBaseline-baselineOffset;bottomMargin+=maxDescent-(element.height-baselineOffset);//Updates the text to base line offset.
if(!sf.base.isNullOrUndefined(textElement)&&textAlignment==='Justify'&&whiteSpaceCount>0){//Aligns the text as Justified.
var width=textElement.width;var text=textElement.text;if(!addSubWidth){text=HelperMethods.trimStart(text);// trim start
addSubWidth=text.length>0;}if(addSubWidth){var spaceCount=text.length-HelperMethods.removeSpace(text).length;if(isLastElement){spaceCount-=text.length-HelperMethods.trimEnd(text).length;}if(whiteSpaceCount<spaceCount){width=this.documentHelper.textHelper.measureTextExcludingSpaceAtEnd(text,textElement.characterFormat);spaceCount=whiteSpaceCount;}if(spaceCount>0){textElement.width=width+subWidth*spaceCount;whiteSpaceCount-=spaceCount;}}}}else{addSubWidth=true;//Updates the Image/UIElement to base line offset.
topMargin+=this.maxBaseline-element.height;bottomMargin+=maxDescent;}return{'topMargin':topMargin,'bottomMargin':bottomMargin,'addSubWidth':addSubWidth,'whiteSpaceCount':whiteSpaceCount};};Layout.prototype.updateWidgetToPage=function(viewer,paragraphWidget){if(paragraphWidget.isInsideTable){var cellWidget=paragraphWidget.associatedCell;paragraphWidget.height=viewer.clientActiveArea.y-paragraphWidget.y;// if (viewer instanceof PageLayoutViewer) {
if(sf.base.isNullOrUndefined(paragraphWidget.associatedCell)||sf.base.isNullOrUndefined(paragraphWidget.associatedCell.ownerRow)||sf.base.isNullOrUndefined(paragraphWidget.associatedCell.ownerRow.rowFormat)){return;}if(paragraphWidget.associatedCell.ownerRow.rowFormat.heightType==='Exactly'){cellWidget.height=HelperMethods.convertPointToPixel(paragraphWidget.associatedCell.ownerRow.rowFormat.height);}else{if([cellWidget].length<=1&&paragraphWidget.associatedCell.ownerRow.rowFormat.heightType==='AtLeast'){cellWidget.height=Math.max(HelperMethods.convertPointToPixel(paragraphWidget.associatedCell.ownerRow.rowFormat.height),this.getCellContentHeight(cellWidget));}else{cellWidget.height=cellWidget.height+paragraphWidget.height;}}// } else {
//     cellWidget.height = cellWidget.height + paragraphWidget.height;
// }
// cellWidget.childWidgets.push(paragraphWidget);
paragraphWidget.containerWidget=cellWidget;}else{if(!paragraphWidget.isEndsWithPageBreak||viewer instanceof WebLayoutViewer){paragraphWidget.height=viewer.clientActiveArea.y-paragraphWidget.y;}//Adds the paragraph widget to the Header Footer/ Body widget.
// this.updateWidgetsToBody(paragraphWidget, viewer, paragraphWidget);
//For canvas no need to render paragraph widget here. In case of div, need to render paragraph here.
// this.render.renderParagraphWidget((paragraphWidget.containerWidget as BodyWidget).page, paragraphWidget);
}if(this.isRelayoutFootnote&&paragraphWidget.bodyWidget instanceof FootNoteWidget){if(!paragraphWidget.isInsideTable){paragraphWidget.containerWidget.height+=paragraphWidget.height;}//this.isRelayoutFootnote = false;
this.shiftFootnoteChildLocation(paragraphWidget.bodyWidget,this.viewer);}if(paragraphWidget.bodyWidget instanceof HeaderFooterWidget){if(!paragraphWidget.isInsideTable){paragraphWidget.containerWidget.height+=paragraphWidget.height;}if(this.viewer.owner.enableHeaderAndFooter&&paragraphWidget.bodyWidget.headerFooterType.indexOf('Footer')!==-1){this.shiftFooterChildLocation(paragraphWidget.bodyWidget,this.viewer);}}if(viewer instanceof WebLayoutViewer&&paragraphWidget.containerWidget instanceof BodyWidget){paragraphWidget.containerWidget.height+=paragraphWidget.height;}};Layout.prototype.shiftFooterChildLocation=function(widget,viewer){var pageHeight=widget.page.bodyWidgets[0].sectionFormat.pageHeight;if(widget.headerFooterType.indexOf('Footer')!==-1){var footerDistance=widget.page.bodyWidgets[0].sectionFormat.footerDistance;var height=HelperMethods.convertPointToPixel(pageHeight-footerDistance);var top_1;if(widget.y+widget.height>height){top_1=height-(widget.y+widget.height);}else if(widget.y+widget.height<height){top_1=widget.y+widget.height-height;}if(!sf.base.isNullOrUndefined(top_1)){top_1=height-(widget.y+widget.height);this.shiftChildLocation(top_1,widget);viewer.clientActiveArea.y+=top_1;}}};Layout.prototype.shiftFootnoteChildLocation=function(widget,viewer){var pageHeight=widget.page.bodyWidgets[0].sectionFormat.pageHeight;var footerDistance=widget.page.bodyWidgets[0].sectionFormat.footerDistance;var bottomMargin=widget.page.bodyWidgets[0].sectionFormat.bottomMargin;var height=HelperMethods.convertPointToPixel(pageHeight-bottomMargin);var top;if(widget.y+widget.height>height){top=height-(widget.y+widget.height);}else if(widget.y+widget.height<height){top=widget.y+widget.height-height;}if(!sf.base.isNullOrUndefined(top)){top=height-(widget.y+widget.height);this.shiftChildLocation(top,widget);viewer.clientActiveArea.y+=top;}};Layout.prototype.checkPreviousElement=function(line,index,characterFormat){var paragraph=line.paragraph;var isSplitByWord=false;var lastTextElement=0;for(var i=index-1;i>=0;i--){var textElement=line.children[i];if(textElement instanceof TextElementBox&&textElement.width>0){var text=textElement.text;lastTextElement=i;if(text.length>0&&text[text.length-1]===' '){if(i===index-1){this.addSplittedLineWidget(line,index-1);return true;}isSplitByWord=true;break;}else if(text==='\t'){return false;}else if(text.indexOf(' ')>=0){isSplitByWord=true;var index_1=text.lastIndexOf(' ')+1;//Splits the text element by space.
var splittedElement=new TextElementBox();splittedElement.text=text.substr(index_1);splittedElement.characterFormat.copyFormat(textElement.characterFormat);if(textElement.revisions.length>0){this.updateRevisionForSpittedElement(textElement,splittedElement,index_1>0);splittedElement.isMarkedForRevision=textElement.isMarkedForRevision;}textElement.text=text.substr(0,index_1);this.documentHelper.textHelper.getTextSize(splittedElement,characterFormat);textElement.width-=splittedElement.width;textElement.height=splittedElement.height;if(textElement.width===0){line.children.splice(i,1);}//Adds the text element to the line
line.children.splice(i+1,0,splittedElement);break;}}else if(!(textElement instanceof ListTextElementBox||textElement instanceof FieldElementBox// to skip field code
||textElement instanceof TextElementBox&&textElement.width===0)){//Handled for inline images/UIelements.
lastTextElement=i;isSplitByWord=true;break;}}if(isSplitByWord){lastTextElement++;if(lastTextElement<line.children.length){var splitWidth=0;for(var i=lastTextElement;i<line.children.length;i++){splitWidth+=line.children[i].width;this.addSplittedLineWidget(line,i-1);i--;}this.viewer.updateClientWidth(splitWidth);}}return isSplitByWord;};Layout.prototype.clearListElementBox=function(paragraph){if(paragraph.childWidgets.length===0){return;}var line=paragraph.childWidgets[0];if(sf.base.isNullOrUndefined(line.children)){return;}for(var i=line.children.length-1;i>0;i--){if(line.children[i]instanceof ListTextElementBox){line.children.splice(i,1);}else{break;}}for(var i=0;i<line.children.length;i++){if(line.children[i]instanceof ListTextElementBox){line.children.splice(i,1);i--;}else{break;}}};Layout.prototype.getListNumber=function(listFormat,isAutoList){var list=this.documentHelper.getListById(listFormat.listId);var levelNumber=listFormat.listLevelNumber;var listLevel=this.getListLevel(list,listFormat.listLevelNumber);var levelOverride=!sf.base.isNullOrUndefined(list.levelOverrides)?list.levelOverrides[levelNumber]:undefined;// If LevelOverride exists and have either override list level or StartAtOverride, then only list numbering will be restarted.
if(!sf.base.isNullOrUndefined(levelOverride)&&this.documentHelper.renderedLevelOverrides.indexOf(levelOverride)===-1&&sf.base.isNullOrUndefined(levelOverride.overrideListLevel)){//Add List Override style
this.documentHelper.renderedLevelOverrides.push(levelOverride);if(this.documentHelper.renderedLists.containsKey(this.documentHelper.getAbstractListById(list.abstractListId))){var levels=this.documentHelper.renderedLists.get(this.documentHelper.getAbstractListById(list.abstractListId));if(levels.containsKey(levelNumber)){levels.remove(levelNumber);}}}if(sf.base.isNullOrUndefined(isAutoList)){this.updateListValues(list,levelNumber);}return this.getListText(list,levelNumber,listLevel);};Layout.prototype.getListStartValue=function(listLevelNumber,list){var levelOverride=!sf.base.isNullOrUndefined(list.levelOverrides)?list.levelOverrides[listLevelNumber]:undefined;if(!sf.base.isNullOrUndefined(levelOverride)&&sf.base.isNullOrUndefined(levelOverride.overrideListLevel)){return levelOverride.startAt;}var listLevel=this.getListLevel(list,listLevelNumber);if(sf.base.isNullOrUndefined(listLevel)){return 0;}else{return listLevel.startAt;}};Layout.prototype.updateListValues=function(list,listLevelNumber){if(!this.documentHelper.renderedLists.containsKey(this.documentHelper.getAbstractListById(list.abstractListId))){var startVal=new Dictionary();this.documentHelper.renderedLists.add(this.documentHelper.getAbstractListById(list.abstractListId),startVal);var listLevel=this.getListLevel(list,listLevelNumber);for(var i=0;i<=listLevelNumber;i++){startVal.add(i,this.getListStartValue(i,list));}}else{var levels=this.documentHelper.renderedLists.get(this.documentHelper.getAbstractListById(list.abstractListId));if(levels.containsKey(listLevelNumber)){var startAt=levels.get(listLevelNumber);levels.set(listLevelNumber,startAt+1);var levelNumber=listLevelNumber+1;while(levelNumber<this.documentHelper.getAbstractListById(list.abstractListId).levels.length){var listLevel=this.getListLevel(list,levelNumber);// if (!isNullOrUndefined(listLevel)) {
if(levels.containsKey(levelNumber)&&listLevel.restartLevel>listLevelNumber){levels.remove(levelNumber);// if (document.renderedListLevels.indexOf(listLevel) > -1) {
//     document.renderedListLevels.pop();
// }
}// }
levelNumber++;}}else{var levelNumber=listLevelNumber;while(!levels.containsKey(levelNumber-1)&&levelNumber>0){var listLevel=this.getListLevel(list,levelNumber-1);// if (!isNullOrUndefined(listLevel)) {
levels.add(levelNumber-1,this.getListStartValue(levelNumber-1,list));// if (document.renderedListLevels.indexOf(listLevel) !== -1) {
//     document.renderedListLevels.push(listLevel);
// }
// }
levelNumber--;}var startAt=this.getListStartValue(listLevelNumber,list);levels.add(listLevelNumber,startAt);}}};Layout.prototype.getListText=function(listAdv,listLevelNumber,currentListLevel){var listText=currentListLevel.numberFormat;if(this.documentHelper.renderedLists.containsKey(this.documentHelper.getAbstractListById(listAdv.abstractListId))){var levels=this.documentHelper.renderedLists.get(this.documentHelper.getAbstractListById(listAdv.abstractListId));var keys=levels.keys;for(var i=0;i<keys.length;i++){var levelNumber=keys[i];var levelKey='%'+(levelNumber+1).toString();var listLevel=this.getListLevel(listAdv,levelNumber);if(listText.match(levelKey)&&listText.match((listLevelNumber+1).toString())){if(levelNumber>listLevelNumber){return'';}else if(levels.containsKey(levelNumber)&&!sf.base.isNullOrUndefined(listLevel)){listText=listText.replace(levelKey,this.getListTextListLevel(listLevel,levels.get(levelNumber)));}else{listText=listText.replace(levelKey,'0');}}else if(listText.match(levelKey)&&listLevelNumber>0){listLevel=this.getListLevel(listAdv,keys[listLevelNumber]);return this.getListTextListLevel(listLevel,levels.get(listLevelNumber))+'.';}}}return listText;};Layout.prototype.getAsLetter=function(number){// if (number <= 0) {
//     return '';
// }
var quotient=number/26;var remainder=number%26;if(remainder===0){//If number denotes the factor of 26, then reduce quotient by 1 and set remainder as 26.
remainder=26;quotient--;}//Index of A char in the ASCII table.     
var letter=String.fromCharCode(65-1+remainder);var listValue='';while(quotient>=0){listValue=listValue+letter.toString();quotient--;}return listValue;};Layout.prototype.getListTextListLevel=function(listLevel,listValue){switch(listLevel.listLevelPattern){case'UpRoman':return this.getAsRoman(listValue).toUpperCase();case'LowRoman':return this.getAsRoman(listValue).toLowerCase();case'UpLetter':return this.getAsLetter(listValue).toUpperCase();case'LowLetter':return this.getAsLetter(listValue).toLowerCase();case'Arabic':return listValue.toString();case'LeadingZero':return this.getAsLeadingZero(listValue);case'Number':return listValue.toString();case'OrdinalText':return listValue.toString();case'Ordinal':return listValue.toString();case'FarEast':return listValue.toString();case'Special':return listValue.toString();default:return'';}};Layout.prototype.getFootEndNote=function(numberFormat,value){switch(numberFormat){case'UpperCaseRoman':return this.getAsRoman(value).toUpperCase();case'LowerCaseRoman':return this.getAsRoman(value).toLowerCase();case'UpperCaseLetter':return this.getAsLetter(value).toUpperCase();case'LowerCaseLetter':return this.getAsLetter(value).toLowerCase();default:return value.toString();}};Layout.prototype.generateNumber=function(number,magnitude,letter){var numberstring='';while(number>=magnitude){number-=magnitude;numberstring+=letter;this.value=number;}return numberstring.toString();};Layout.prototype.getAsLeadingZero=function(listValue){if(listValue<10){return'0'+listValue.toString();}else{return listValue.toString();}};Layout.prototype.getAsRoman=function(number){var retval='';this.value=number;retval+=this.generateNumber(this.value,1000,'M');retval+=this.generateNumber(this.value,900,'CM');retval+=this.generateNumber(this.value,500,'D');retval+=this.generateNumber(this.value,400,'CD');retval+=this.generateNumber(this.value,100,'C');retval+=this.generateNumber(this.value,90,'XC');retval+=this.generateNumber(this.value,50,'L');retval+=this.generateNumber(this.value,40,'XL');retval+=this.generateNumber(this.value,10,'X');retval+=this.generateNumber(this.value,9,'IX');retval+=this.generateNumber(this.value,5,'V');retval+=this.generateNumber(this.value,4,'IV');retval+=this.generateNumber(this.value,1,'I');return retval.toString();};Layout.prototype.getListLevel=function(list,listLevelNumber){if(!sf.base.isNullOrUndefined(list)){var abstractList=this.documentHelper.getAbstractListById(list.abstractListId);if(!sf.base.isNullOrUndefined(list)&&abstractList.levels.length<=listLevelNumber&&listLevelNumber>=0&&listLevelNumber<9){this.addListLevels(abstractList);}var levelOverrideAdv=undefined;var level=false;level=!sf.base.isNullOrUndefined(list.levelOverrides)&&!sf.base.isNullOrUndefined(levelOverrideAdv=list.levelOverrides[listLevelNumber])&&!sf.base.isNullOrUndefined(levelOverrideAdv.overrideListLevel);if(level){return levelOverrideAdv.overrideListLevel;}else if(!sf.base.isNullOrUndefined(abstractList)&&listLevelNumber>=0&&listLevelNumber<abstractList.levels.length){return abstractList.levels[listLevelNumber];}}return undefined;};Layout.prototype.getTabWidth=function(paragraph,viewer,index,lineWidget,element){var elementWidth=element?this.documentHelper.textHelper.getTextSize(element,element.characterFormat):0;var fPosition=0;var isCustomTab=false;var tabs=paragraph.paragraphFormat.getUpdatedTabs();var isList=false;var sectionFormat=paragraph.bodyWidget.sectionFormat;var leftMargin=HelperMethods.convertPointToPixel(sectionFormat.leftMargin);if(!sf.base.isNullOrUndefined(paragraph.paragraphFormat.listFormat.listLevel)&&!sf.base.isNullOrUndefined(paragraph.paragraphFormat.listFormat.listLevel.paragraphFormat)){var listFormat=paragraph.paragraphFormat.listFormat.listLevel.paragraphFormat;if(paragraph.paragraphFormat.leftIndent!==listFormat.leftIndent){isList=true;}}var clientWidth=0;var clientActiveX=viewer.clientActiveArea.x;var firstLineIndent=HelperMethods.convertPointToPixel(paragraph.paragraphFormat.firstLineIndent);var leftIndent=HelperMethods.convertPointToPixel(paragraph.paragraphFormat.leftIndent);if(!sf.base.isNullOrUndefined(element)&&lineWidget.isFirstLine()){clientWidth=this.viewer.clientArea.x+firstLineIndent;if(isList){clientActiveX=clientActiveX+firstLineIndent;}}else{clientWidth=this.viewer.clientArea.x;}if(clientActiveX<clientWidth){return viewer.clientArea.x-viewer.clientActiveArea.x;}if(element instanceof ListTextElementBox&&lineWidget.isFirstLine()&&leftIndent>0&&firstLineIndent<0){if(viewer.clientArea.x-viewer.clientActiveArea.x>0){return viewer.clientArea.x-viewer.clientActiveArea.x;}else if(tabs.length===0&&paragraph.paragraphFormat.listFormat){tabs=paragraph.paragraphFormat.listFormat.listLevel.paragraphFormat.tabs;}}// Calculates tabwidth based on pageleftmargin and defaulttabwidth property
var position=viewer.clientActiveArea.x-(viewer.clientArea.x-HelperMethods.convertPointToPixel(paragraph.paragraphFormat.leftIndent));var defaultTabWidth=HelperMethods.convertPointToPixel(this.documentHelper.defaultTabWidth);var breakInLeftIndent=false;if(tabs.length===0&&(position>0&&defaultTabWidth>Math.round(position)&&isList||defaultTabWidth===this.defaultTabWidthPixel&&defaultTabWidth>Math.round(position))){return defaultTabWidth-position;}else{if(tabs.length>0){for(var i=0;i<tabs.length;i++){var tabStop=tabs[i];var tabPosition=HelperMethods.convertPointToPixel(tabs[i].position);if(leftMargin+tabPosition+elementWidth>viewer.clientArea.x){breakInLeftIndent=true;}else{breakInLeftIndent=false;}if(Math.floor(position+elementWidth)<=tabPosition){isCustomTab=true;if(tabStop.tabJustification==='Left'||tabStop.tabJustification==='List'){fPosition=tabPosition;if(element instanceof TabElementBox){element.tabLeader=tabs[i].tabLeader;element.tabText='';}break;}else{var tabWidth=tabPosition-position;var width=this.getRightTabWidth(element.indexInOwner+1,lineWidget,paragraph);if(width<tabWidth){if(tabStop.tabJustification==='Right'){defaultTabWidth=tabWidth-width;var rightIndent=HelperMethods.convertPointToPixel(paragraph.rightIndent);var areaWidth=this.viewer.clientActiveArea.width+rightIndent-defaultTabWidth;this.viewer.clientActiveArea.width+=rightIndent;if(areaWidth<0){defaultTabWidth+=areaWidth-width;}else if(width>areaWidth){defaultTabWidth-=width-areaWidth;}}else{defaultTabWidth=tabWidth-width/2;}}else if(tabStop.tabJustification==='Center'&&width/2<tabWidth){defaultTabWidth=tabWidth-width/2;}else{defaultTabWidth=tabStop.tabJustification==='Right'?0:elementWidth;}fPosition=position;if(element instanceof TabElementBox){element.tabLeader=tabs[i].tabLeader;element.tabText='';}break;}}}}if(!isCustomTab){var diff=Math.round(position)*100%(Math.round(defaultTabWidth)*100)/100;var cnt=(Math.round(position)-diff)/Math.round(defaultTabWidth);fPosition=(cnt+1)*defaultTabWidth;}if(breakInLeftIndent&&leftIndent>0&&viewer.clientArea.x>clientActiveX){return viewer.clientArea.x-clientActiveX;}return fPosition-position>0?fPosition-position:defaultTabWidth;}};Layout.prototype.getRightTabWidth=function(index,lineWidget,paragraph){var width=0;var isFieldCode=false;var elementBox=lineWidget.children[index];while(elementBox){if(elementBox instanceof FieldElementBox||elementBox instanceof BookmarkElementBox||isFieldCode){if(elementBox instanceof FieldElementBox){if(elementBox.fieldType===0){isFieldCode=true;}else if(elementBox.fieldType===2){isFieldCode=false;}}elementBox.width=0;}else{if(elementBox instanceof TextElementBox){this.documentHelper.textHelper.getTextSize(elementBox,elementBox.characterFormat);}}if(elementBox instanceof TextElementBox&&elementBox.text==='\t'){return width;}else{width=width+elementBox.width;}elementBox=elementBox.nextNode;}return width;};Layout.prototype.getSplitIndexByWord=function(clientActiveWidth,text,width,characterFormat){var index=0;var length=text.length;while(index<length){var nextIndex=this.getTextIndexAfterSpace(text,index);if(nextIndex===0||nextIndex===length){nextIndex=length-1;}var splitWidth=width;if((nextIndex<length-1||nextIndex===length-1&&text[nextIndex-1]===' ')&&index!==nextIndex){splitWidth=this.documentHelper.textHelper.measureTextExcludingSpaceAtEnd(text.slice(0,nextIndex),characterFormat);}if(splitWidth<=clientActiveWidth){index=nextIndex;}else{if(index===0&&text[0]===' '){index=this.getTextIndexAfterSpace(text,0);}break;}}return index;};Layout.prototype.getTextSplitIndexByCharacter=function(totalClientWidth,clientActiveAreaWidth,text,width,characterFormat){var length=text.length;for(var i=0;i<length;i++){var splitWidth=width;if(i+1<length){splitWidth=this.documentHelper.textHelper.measureTextExcludingSpaceAtEnd(text.substring(0,i+1),characterFormat);}if(splitWidth>clientActiveAreaWidth){if(i===0&&splitWidth>totalClientWidth){//Handle for cell/section having client width less than a character's width.
return length>1&&text[1]===' '?this.getTextIndexAfterSpace(text,1):1;}return i;}}return 0;};Layout.prototype.getSubWidth=function(lineWidget,justify,spaceCount,firstLineIndent,isParagraphEnd){var width=0;var trimSpace=true;var lineText='';if(this.wrapPosition.length>0){var subWidths=this.getSubWidthBasedOnTextWrap(lineWidget,justify,spaceCount,firstLineIndent,isParagraphEnd);if(subWidths.length>0){return subWidths;}}for(var i=lineWidget.children.length-1;i>=0;i--){var element=lineWidget.children[i];if(element.width>0&&element instanceof TextElementBox){var elementText=element.text;lineText=elementText+lineText;if(trimSpace&&(elementText.trim()!==''||elementText==='\t')){if(HelperMethods.endsWith(elementText)){width+=this.documentHelper.textHelper.measureTextExcludingSpaceAtEnd(elementText,element.characterFormat);}else{width+=element.width;}trimSpace=false;}else if(!trimSpace){width+=element.width;}}else{lineText='a'+lineText;trimSpace=false;if(element instanceof ShapeBase&&element.textWrappingStyle!=='Inline'){continue;}width+=element.width;}if(!justify){width=Math.round(width);}else{width=width;}}lineText=lineText.trim();spaceCount=lineText.length-HelperMethods.removeSpace(lineText).length;var subWidth=this.viewer.clientArea.width-firstLineIndent-width;if(subWidth<=0||spaceCount===0&&justify&&!lineWidget.paragraph.paragraphFormat.bidi){spaceCount=0;subWidth=0;}else if(justify){// For justify alignment, element width will be updated based space count value.
// So when the element is paragraph end, need to set space count to zero.
if(!isParagraphEnd&&spaceCount>0){subWidth=subWidth/spaceCount;}else{spaceCount=0;}}// So set sub width to zero to layout the element in left alignment
// Need to remove is once after implementing subwidth update separatly
return[{'subWidth':subWidth,'spaceCount':spaceCount}];};Layout.prototype.getSubWidthBasedOnTextWrap=function(lineWidget,justify,spaceCount,firstLineIndent,isParagraphEnd){var subWidths=[];var width=0;var lineContent='';var wrapIndex=this.wrapPosition.length-1;var trimSpace=true;for(var z=lineWidget.children.length-1;z>=0;z--){var elementBox=lineWidget.children[z];if(elementBox.width>0&&elementBox instanceof TextElementBox){var elementText=elementBox.text;lineContent=elementText+lineContent;if(trimSpace&&(elementText.trim()!==''||elementText==='\t')){if(HelperMethods.endsWith(elementText)){width+=this.documentHelper.textHelper.measureTextExcludingSpaceAtEnd(elementText,elementBox.characterFormat);}else{width+=elementBox.width;}trimSpace=false;}else if(!trimSpace){width+=elementBox.width;}}else{lineContent='a'+lineContent;trimSpace=false;if(!(elementBox instanceof ShapeBase&&elementBox.textWrappingStyle!=='Inline')){width+=elementBox.width;}}if((elementBox.padding.left>0||z===0)&&wrapIndex>=0){var wrapPosition=this.wrapPosition[wrapIndex--];while(wrapPosition.width<=0&&wrapIndex>=0){wrapPosition=this.wrapPosition[wrapIndex--];}var info=this.getSubWidthInfo(lineWidget,wrapPosition.width,width,lineContent,spaceCount,justify,isParagraphEnd);if(!sf.base.isNullOrUndefined(info)){width=0;lineContent='';subWidths.unshift(info);}}}return subWidths;};Layout.prototype.getSubWidthInfo=function(lineWidget,lastWrapPositionWidth,width,lineContent,spaceCount,justify,isParagraphEnd){if(lastWrapPositionWidth>0){var wrappedSubWidth=lastWrapPositionWidth-width;lineContent=lineContent.trim();spaceCount=lineContent.length-HelperMethods.removeSpace(lineContent).length;// TODO: Consider first line indent.
var totalSubWidth=wrappedSubWidth;if(totalSubWidth<=0||spaceCount===0&&justify&&!lineWidget.paragraph.paragraphFormat.bidi){spaceCount=0;totalSubWidth=0;}else if(justify){// For justify alignment, element width will be updated based space count value.
// So when the element is paragraph end, need to set space count to zero.
if(!isParagraphEnd&&spaceCount>0){totalSubWidth=totalSubWidth/spaceCount;}else{spaceCount=0;}}return{'subWidth':totalSubWidth,'spaceCount':spaceCount};}return undefined;};Layout.prototype.getBeforeSpacing=function(paragraph){var beforeSpacing=0;if(paragraph.previousWidget instanceof ParagraphWidget&&!this.documentHelper.dontUseHtmlParagraphAutoSpacing){var afterSpacing=this.getAfterSpacing(paragraph.previousWidget);if(afterSpacing<paragraph.paragraphFormat.beforeSpacing){beforeSpacing=paragraph.paragraphFormat.beforeSpacing-afterSpacing;}}else{beforeSpacing=paragraph.paragraphFormat.beforeSpacing;}if(this.isSameStyle(paragraph,false)){return 0;}else{return HelperMethods.convertPointToPixel(beforeSpacing);}};Layout.prototype.getAfterSpacing=function(paragraph){var afterSpacing=paragraph.paragraphFormat.afterSpacing;if(this.isSameStyle(paragraph,true)){return 0;}else{return afterSpacing;}};Layout.prototype.getLineSpacing=function(paragraph,maxHeight,alterLineSpacing){if(sf.base.isNullOrUndefined(paragraph.paragraphFormat)){return 0;}var lineSpacing=0;switch(paragraph.paragraphFormat.lineSpacingType){case'AtLeast':case'Exactly':lineSpacing=paragraph.paragraphFormat.lineSpacing;break;default:lineSpacing=paragraph.paragraphFormat.lineSpacing;if(alterLineSpacing){lineSpacing=lineSpacing-1;}lineSpacing=lineSpacing*maxHeight;break;}return lineSpacing;};Layout.prototype.isParagraphFirstLine=function(paragraph,line){var widget=paragraph;if(sf.base.isNullOrUndefined(widget.childWidgets)||widget.childWidgets.indexOf(line)===0){//If the line elements conatins the elements from previous paragraph then need to retun false.
//Example scenario, Field start and field end in different paragraphs.
if(line.children.length>0&&!sf.base.isNullOrUndefined(paragraph.previousWidget)&&paragraph.previousWidget instanceof ParagraphWidget){return line.paragraph.index!==paragraph.previousWidget.index;}return true;//If the line elements count is zero then also need to return true.
}return false;};Layout.prototype.isParagraphLastLine=function(element){var paragraph=element.line.paragraph;var lastLineWidget=paragraph.childWidgets[paragraph.childWidgets.length-1];var lastInline=lastLineWidget.children[lastLineWidget.children.length-1];if(element===lastInline){return lastInline instanceof FieldElementBox||!(lastInline instanceof TextElementBox&&lastInline.text==='\v');}return false;};Layout.prototype.getTextIndexAfterSpace=function(text,startIndex){var length=text.length;var index=0;index=text.indexOf(' ',startIndex)+1;var nextIndex=index;if(nextIndex===0||nextIndex===length){return nextIndex;}while(text[nextIndex]===' '){nextIndex++;if(nextIndex===length){break;}}return nextIndex;};//#region Table
Layout.prototype.moveNextWidgetsToTable=function(tableWidget,currentRow,moveFromNext){var rowIndex=currentRow.indexInOwner;var currentTable=tableWidget[tableWidget.length-1];if(moveFromNext){rowIndex+=1;}var nextWidgets=currentRow.containerWidget.childWidgets.splice(rowIndex);for(var i=0;i<nextWidgets.length;i++){currentTable.childWidgets.push(nextWidgets[i]);nextWidgets[i].containerWidget=currentTable;}};Layout.prototype.addTableCellWidget=function(cell,area,maxCellMarginTop,maxCellMarginBottom){//let tableCellWidget: TableCellWidget = new TableCellWidget(cell);
var prevColumnIndex=0;var cellspace=0;var left=0;var top=maxCellMarginTop;var right=0;var bottom=maxCellMarginBottom;if(!sf.base.isNullOrUndefined(cell.cellFormat)){if(cell.cellFormat.containsMargins()){left=sf.base.isNullOrUndefined(cell.cellFormat.leftMargin)?HelperMethods.convertPointToPixel(cell.ownerTable.tableFormat.leftMargin):HelperMethods.convertPointToPixel(cell.cellFormat.leftMargin);right=sf.base.isNullOrUndefined(cell.cellFormat.rightMargin)?HelperMethods.convertPointToPixel(cell.ownerTable.tableFormat.rightMargin):HelperMethods.convertPointToPixel(cell.cellFormat.rightMargin);}else{if(cell.columnIndex===0&&cell.ownerRow.rowFormat.hasValue('leftMargin')){left=HelperMethods.convertPointToPixel(cell.ownerRow.rowFormat.leftMargin);}else{left=HelperMethods.convertPointToPixel(cell.ownerTable.tableFormat.leftMargin);}if(cell.columnIndex===cell.ownerTable.tableHolder.columns.length-1&&cell.ownerRow.rowFormat.hasValue('rightMargin')){right=HelperMethods.convertPointToPixel(cell.ownerRow.rowFormat.rightMargin);}else{right=HelperMethods.convertPointToPixel(cell.ownerTable.tableFormat.rightMargin);}}}cell.margin=new Margin(left,top,right,bottom);var autofit=cell.ownerTable.tableFormat.allowAutoFit;var cellWidth=cell.cellFormat.cellWidth;if(cellWidth>cell.cellFormat.preferredWidth&&cell.cellFormat.preferredWidth!==0&&cell.cellFormat.preferredWidthType!=='Percent'&&cell.ownerTable.tableFormat.preferredWidthType!=='Percent'&&sf.base.isNullOrUndefined(cell.ownerTable.positioning)&&!cell.ownerTable.isContainInsideTable){cellWidth=cell.cellFormat.preferredWidth;}cell.width=HelperMethods.convertPointToPixel(cellWidth);if(!sf.base.isNullOrUndefined(cell.previousWidget)){prevColumnIndex=cell.previousWidget.columnIndex+cell.previousWidget.cellFormat.columnSpan;}cellspace=!sf.base.isNullOrUndefined(cell.ownerTable)&&!sf.base.isNullOrUndefined(cell.ownerTable.tableFormat)?HelperMethods.convertPointToPixel(cell.ownerTable.tableFormat.cellSpacing):0;var prevSpannedCellWidth=0;if(prevColumnIndex<cell.columnIndex){prevSpannedCellWidth=HelperMethods.convertPointToPixel(cell.ownerTable.tableHolder.getPreviousSpannedCellWidth(prevColumnIndex,cell.columnIndex));if(prevColumnIndex===0){prevSpannedCellWidth=prevSpannedCellWidth-cellspace/2;}}cell.x=area.x+prevSpannedCellWidth+cell.margin.left;cell.y=area.y+cell.margin.top+cellspace;cell.width=cell.width-cell.margin.left-cell.margin.right;if(cellspace>0){cell.x+=cellspace;if(cell.ownerTable.tableHolder.columns.length===1){cell.width-=cellspace*2;}else if(cell.columnIndex===0||cell.columnIndex===cell.ownerTable.tableHolder.columns.length-1){cell.width-=cellspace*2-cellspace/2;}else{cell.width-=cellspace;}}var leftBorderWidth=HelperMethods.convertPointToPixel(TableCellWidget.getCellLeftBorder(cell).getLineWidth());var rightBorderWidth=HelperMethods.convertPointToPixel(TableCellWidget.getCellRightBorder(cell).getLineWidth());// update the margins values respect to layouting of borders.
// for normal table cells only left border is rendred. for last cell left and right border is rendred.
// this border widths are not included in margins.
cell.leftBorderWidth=!cell.ownerTable.isBidiTable?leftBorderWidth:rightBorderWidth;var isLeftStyleNone=cell.cellFormat.borders.left.lineStyle==='None';var isRightStyleNone=cell.cellFormat.borders.right.lineStyle==='None';cell.x+=!isLeftStyleNone?0:cell.leftBorderWidth>0?0:cell.leftBorderWidth;cell.width-=!isLeftStyleNone?0:cell.leftBorderWidth>0?0:cell.leftBorderWidth;var lastCell=!cell.ownerTable.isBidiTable?cell.cellIndex===cell.ownerRow.childWidgets.length-1:cell.cellIndex===0;if(cellspace>0||cell.columnIndex===cell.ownerTable.tableHolder.columns.length-1||cell.columnIndex===cell.containerWidget.childWidgets.length-1&&cell.cellFormat.columnSpan>1){cell.rightBorderWidth=!cell.ownerTable.isBidiTable?rightBorderWidth:leftBorderWidth;if(!cell.ownerTable.tableFormat.allowAutoFit){cell.width-=cell.rightBorderWidth;}}//Add the border widths to respective margin side.
//cell.margin.left += (isLeftStyleNone) ? 0 : (cell.leftBorderWidth);
cell.margin.right+=isRightStyleNone?0:cell.rightBorderWidth;//cell.ownerWidget = owner;
return cell;};Layout.prototype.addWidgetToTable=function(viewer,tableCollection,rowCollection,row,endRowWidget,isInitialLayout){//Adds table row widget to owner table widget.
var tableWidget=tableCollection[0];var index=tableWidget.childWidgets.length;var prevWidget=undefined;var rowWidgetIndex=rowCollection.indexOf(row);if(rowWidgetIndex>0){prevWidget=rowCollection[rowWidgetIndex-1];// Need to update on this further
}else if(row.previousRenderedWidget instanceof TableRowWidget&&row.previousRenderedWidget.ownerTable.equals(row.ownerTable)){// Need to update on this further
prevWidget=row.previousRenderedWidget;}if(!sf.base.isNullOrUndefined(prevWidget)){tableWidget=prevWidget.containerWidget;// index = tableWidget.childWidgets.length;
index=tableWidget.childWidgets.indexOf(prevWidget)+1;if(Math.round(row.y)!==Math.round(prevWidget.y+prevWidget.height)){var prevIndex=tableCollection.indexOf(tableWidget);if(prevIndex+1>=tableCollection.length){//Creates new table widget for splitted rows.
this.addTableWidget(viewer.clientActiveArea,tableCollection,true);}tableWidget=tableCollection[prevIndex+1];index=tableWidget.childWidgets.length;}if(rowWidgetIndex>0){index=0;}}this.updateRowHeightBySpannedCell(tableWidget,row,index);this.updateRowHeightByCellSpacing(tableCollection,row,viewer);//Remove widget from previous container after splitteing
if(row.containerWidget&&row.containerWidget!==tableWidget&&row.containerWidget.childWidgets.indexOf(row)!==-1){row.containerWidget.childWidgets.splice(row.containerWidget.childWidgets.indexOf(row),1);}if(tableWidget.childWidgets.indexOf(row)===-1){tableWidget.childWidgets.splice(index,0,row);}row.containerWidget=tableWidget;tableWidget.height=tableWidget.height+row.height;// Shift the widgets for Right to left directed table.
if(tableWidget.isBidiTable){row.shiftWidgetForRtlTable(this.viewer.clientArea,tableWidget,row);}if(this.viewer instanceof PageLayoutViewer){if(!sf.base.isNullOrUndefined(tableWidget.containerWidget)&&tableWidget.containerWidget.childWidgets.indexOf(tableWidget)>=0&&!(tableWidget.containerWidget instanceof HeaderFooterWidget)){tableWidget.containerWidget.height+=row.height;}}this.updateHeightForRowWidget(viewer,false,tableCollection,rowCollection,row,false,endRowWidget,isInitialLayout);viewer.cutFromTop(row.y+row.height);};Layout.prototype.updateRowHeightBySpannedCell=function(tableWidget,row,insertIndex){var rowSpan=1;if(tableWidget.childWidgets.length===0||insertIndex===0){this.updateRowHeight(row,row);return;}for(var i=0;i<row.childWidgets.length;i++){var cellWidget=row.childWidgets[i];rowSpan=sf.base.isNullOrUndefined(cellWidget)||sf.base.isNullOrUndefined(cellWidget.cellFormat)?rowSpan:cellWidget.cellFormat.rowSpan;this.updateSpannedRowCollection(rowSpan,row,cellWidget);}if(!sf.base.isNullOrUndefined(row.ownerTable)){for(var i=0;i<row.ownerTable.spannedRowCollection.length;i++){if(row.ownerTable.spannedRowCollection.keys[i]===row.index){// Back track to previous table row widgets and update it height if vertical merge ends with this row.
for(var j=0;j<insertIndex;j++){var prevRowWidget=tableWidget.childWidgets[j];this.updateRowHeight(prevRowWidget,row);}row.ownerTable.spannedRowCollection.remove(row.ownerTable.spannedRowCollection.keys[i]);break;}}}};Layout.prototype.updateRowHeight=function(prevRowWidget,row){var rowIndex=row.index;var rowSpan=1;for(var i=0;i<prevRowWidget.childWidgets.length;i++){var cellWidget=prevRowWidget.childWidgets[i];rowSpan=sf.base.isNullOrUndefined(cellWidget)||sf.base.isNullOrUndefined(cellWidget.cellFormat)?rowSpan:cellWidget.cellFormat.rowSpan;//To update Row height- if row has row span value greater than 1, need to add it in spannedRowCollection            
this.updateSpannedRowCollection(rowSpan,row,cellWidget);if(rowIndex-cellWidget.rowIndex===rowSpan-1){var mergedCellHeight=cellWidget.y+cellWidget.height+cellWidget.margin.bottom-row.y;if((row.rowFormat.heightType!=='Exactly'||row.rowFormat.heightType==='Exactly'&&row.rowFormat.height>mergedCellHeight)&&row.height<mergedCellHeight){row.height=mergedCellHeight;}}}};//if row has row span value greater than 1, need to add it in spannedRowCollection
Layout.prototype.updateSpannedRowCollection=function(rowSpan,row,cellWidget){if(rowSpan>1&&!sf.base.isNullOrUndefined(row.ownerTable)){//Checks the rowspan is already exist in the list
if(!row.ownerTable.spannedRowCollection.containsKey(row.index+rowSpan-1)){row.ownerTable.spannedRowCollection.add(row.index+rowSpan-1,row.index);}}};Layout.prototype.updateRowHeightByCellSpacing=function(tableCollection,row,viewer){if(row.ownerTable.tableFormat.cellSpacing>0){// In the Case of tableWidget is greater than one and rowWidget is start at the Top Position of the page. 
// In such case we have update the row height with half of cell spacing.
// Remaining cases we have to update the entire hight
if(tableCollection.length>1&&row.y===viewer.clientArea.y&&viewer instanceof PageLayoutViewer){row.height=row.height-HelperMethods.convertPointToPixel(row.ownerTable.tableFormat.cellSpacing)/2;}}};Layout.prototype.isRowSpanEnd=function(row,viewer){var rowIndex=row.index;var rowSpan=1;for(var i=0;i<this.documentHelper.splittedCellWidgets.length;i++){var splittedCell=this.documentHelper.splittedCellWidgets[i];rowSpan=sf.base.isNullOrUndefined(splittedCell)||sf.base.isNullOrUndefined(splittedCell.cellFormat)?rowSpan:splittedCell.cellFormat.rowSpan;if(rowIndex-splittedCell.rowIndex===rowSpan-1){return true;}}return false;};Layout.prototype.isVerticalMergedCellContinue=function(row){var colIndex=0;for(var i=0;i<row.childWidgets.length;i++){var cell=row.childWidgets[i];if(colIndex<cell.columnIndex){return true;}colIndex+=cell.cellFormat.columnSpan;}return colIndex<row.ownerTable.tableHolder.columns.length;};Layout.prototype.splitWidgets=function(tableRowWidget,viewer,tableCollection,rowCollection,splittedWidget,isLastRow){if(this.isFirstLineFitForRow(viewer.clientArea.bottom,tableRowWidget)&&tableRowWidget.childWidgets.length>0){splittedWidget=this.getSplittedWidgetForRow(viewer.clientArea.bottom,tableCollection,rowCollection,tableRowWidget);if(this.documentHelper.splittedCellWidgets.length>0||splittedWidget!==tableRowWidget){if(isLastRow){for(var i=0;i<splittedWidget.childWidgets.length;i++){var cell=splittedWidget.childWidgets[i];if(cell.rowIndex!==splittedWidget.index){splittedWidget.childWidgets.splice(i,1);i--;}}}//Adds the splitted widget of a vertical merged cell, to next row widget in the next page.
this.insertSplittedCellWidgets(viewer,tableCollection,splittedWidget,tableRowWidget.index-1);}}else{//Adds the splitted widget of a vertical merged cell, to next row widget in the next page.
this.insertSplittedCellWidgets(viewer,tableCollection,splittedWidget,tableRowWidget.index-1);}return splittedWidget;};Layout.prototype.getSplittedWidgetForRow=function(bottom,tableCollection,rowCollection,tableRowWidget){var splittedWidget=undefined;var rowIndex=tableRowWidget.index;this.isRelayoutneed=false;var issplit=false;for(var i=0;i<tableRowWidget.childWidgets.length;i++){var cellWidget=tableRowWidget.childWidgets[i];var splittedCell=this.getSplittedWidget(bottom,true,tableCollection,rowCollection,cellWidget);if(!sf.base.isNullOrUndefined(splittedCell)){if(splittedCell===cellWidget){//Returns if the whole content of the row does not fit in current page.
return tableRowWidget;}if(tableRowWidget.childWidgets.indexOf(splittedCell)!==-1){tableRowWidget.childWidgets.splice(tableRowWidget.childWidgets.indexOf(splittedCell),1);}if(i===0||tableRowWidget.height<cellWidget.height+cellWidget.margin.top+cellWidget.margin.bottom){tableRowWidget.height=cellWidget.height+cellWidget.margin.top+cellWidget.margin.bottom;}if(sf.base.isNullOrUndefined(splittedWidget)){//Creates new widget, to hold the splitted contents.
splittedWidget=new TableRowWidget();splittedWidget.containerWidget=tableRowWidget.containerWidget;splittedWidget.index=tableRowWidget.index;splittedWidget.rowFormat=tableRowWidget.rowFormat;this.updateWidgetLocation(tableRowWidget,splittedWidget);// splittedWidget.height = 0;
rowCollection.push(splittedWidget);}var rowSpan=1;rowSpan=sf.base.isNullOrUndefined(splittedCell)||sf.base.isNullOrUndefined(splittedCell.cellFormat)?rowSpan:splittedCell.cellFormat.rowSpan;if(rowIndex-splittedCell.rowIndex===rowSpan-1&&splittedWidget.height<splittedCell.height+splittedCell.margin.top+splittedCell.margin.bottom){splittedWidget.height=splittedCell.height+splittedCell.margin.top+splittedCell.margin.bottom;}else{if(tableRowWidget.rowFormat.heightType==='Exactly'||tableRowWidget.rowFormat.heightType==='AtLeast'&&splittedWidget.height<tableRowWidget.rowFormat.height){//Sets the height for row widget if height type is exact or at least.
splittedWidget.height=tableRowWidget.rowFormat.height;}}splittedWidget.childWidgets.push(splittedCell);splittedCell.containerWidget=splittedWidget;this.isRelayoutneed=true;var count=i;while(count>0&&!issplit){var cellWidget_1=tableRowWidget.childWidgets[count-1];splittedCell=this.getSplittedWidget(bottom,true,tableCollection,rowCollection,cellWidget_1);splittedWidget.childWidgets.splice(0,0,splittedCell);splittedCell.containerWidget=splittedWidget;count--;}issplit=true;}}return splittedWidget;};/* eslint-disable */Layout.prototype.updateWidgetsToTable=function(tableWidgets,rowWidgets,row){var rowHeight=this.getRowHeight(row,[row]);var viewer=this.viewer;//initializing row properties with default values.
var isHeader=row.rowFormat.isHeader;var headerRow=undefined;var isAllowBreakAcrossPages=row.rowFormat.allowBreakAcrossPages;var heightType=row.rowFormat.heightType;var cellSpacing=0;var count=0;var tableRowWidget=row;var moveRowToNextTable=false;if(this.isTableFootNote){this.footHeight=tableRowWidget.bodyWidget.page.footnoteWidget.height;this.isTableFootNote=false;}else{this.footHeight=0;}if(row.ownerTable.continueHeader&&!isHeader){row.ownerTable.continueHeader=false;}var isInitialLayout=row.ownerTable.isInsideTable;var isLastRow=false;cellSpacing=!sf.base.isNullOrUndefined(row.ownerTable)&&!sf.base.isNullOrUndefined(row.ownerTable.tableFormat)?HelperMethods.convertPointToPixel(row.ownerTable.tableFormat.cellSpacing):0;while(count<rowWidgets.length){count=rowWidgets.length;if(this.isRowSpanEnd(row,viewer)&&row.rowFormat.heightType==='Exactly'&&this.documentHelper.splittedCellWidgets.length===1){this.documentHelper.splittedCellWidgets=[];}if(row.ownerTable.isInsideTable||this.documentHelper.splittedCellWidgets.length===0&&tableRowWidget.y+tableRowWidget.height+cellSpacing+this.footnoteHeight<=viewer.clientArea.bottom){if(this.isVerticalMergedCellContinue(row)&&(tableRowWidget.y===viewer.clientArea.y||tableRowWidget.y===this.viewer.clientArea.y+tableRowWidget.ownerTable.headerHeight)){this.insertSplittedCellWidgets(viewer,tableWidgets,tableRowWidget,tableRowWidget.index-1);}this.addWidgetToTable(viewer,tableWidgets,rowWidgets,tableRowWidget,undefined,isInitialLayout);if(this.documentHelper.splittedCellWidgets.length>0&&sf.base.isNullOrUndefined(rowWidgets[rowWidgets.length-1].nextRow)){count--;isLastRow=true;}isInitialLayout=false;}else{isInitialLayout=false;//Split widget for next page
if(this.documentHelper.splittedCellWidgets.length>0&&tableRowWidget.y+tableRowWidget.height+this.footHeight<=viewer.clientArea.bottom){var isRowSpanEnd=this.isRowSpanEnd(row,viewer);if(!isRowSpanEnd){if(this.isVerticalMergedCellContinue(row)&&(tableRowWidget.y===viewer.clientArea.y||tableRowWidget.y===this.viewer.clientArea.y+tableRowWidget.ownerTable.headerHeight)){this.insertSplittedCellWidgets(viewer,tableWidgets,tableRowWidget,tableRowWidget.indexInOwner-1);}this.addWidgetToTable(viewer,tableWidgets,rowWidgets,tableRowWidget);continue;}}var splittedWidget=tableRowWidget;var tableWidget=tableWidgets[tableWidgets.length-1];if(rowHeight+tableRowWidget.y+this.footHeight>viewer.clientArea.bottom){if(!isAllowBreakAcrossPages||isHeader&&row.ownerTable.continueHeader||heightType==='AtLeast'&&HelperMethods.convertPointToPixel(row.rowFormat.height)<viewer.clientArea.bottom){if(heightType==='AtLeast'&&HelperMethods.convertPointToPixel(row.rowFormat.height)<viewer.clientActiveArea.height&&isAllowBreakAcrossPages||heightType!=='Exactly'&&tableRowWidget.y===viewer.clientArea.y||heightType==='Auto'&&isAllowBreakAcrossPages){splittedWidget=this.splitWidgets(tableRowWidget,viewer,tableWidgets,rowWidgets,splittedWidget,isLastRow);}if(heightType==='AtLeast'&&row.ownerTable.spannedRowCollection.keys.length>0){splittedWidget=this.splitWidgets(tableRowWidget,viewer,tableWidgets,rowWidgets,splittedWidget,isLastRow);}if(heightType==='AtLeast'&&HelperMethods.convertPointToPixel(row.rowFormat.height)>viewer.clientActiveArea.height&&isAllowBreakAcrossPages&&tableRowWidget.ownerTable.tableHolder.columns.length>this.getTotalColumnSpan(tableRowWidget)){tableRowWidget=this.splitWidgets(tableRowWidget,viewer,tableWidgets,rowWidgets,splittedWidget,isLastRow);splittedWidget=tableRowWidget;}if(heightType==='Exactly'&&tableRowWidget.y===viewer.clientArea.y){this.addWidgetToTable(viewer,tableWidgets,rowWidgets,tableRowWidget);count++;}if(isHeader&&row.ownerTable.continueHeader){row.ownerTable.header=false;row.ownerTable.continueHeader=false;row.ownerTable.headerHeight=0;var pages=undefined;if(viewer instanceof PageLayoutViewer){pages=this.documentHelper.pages;}if(!sf.base.isNullOrUndefined(pages)){for(var i=0;i<pages.length;i++){if(pages[i].repeatHeaderRowTableWidget){pages[i].repeatHeaderRowTableWidget=false;}}}}}else{if((heightType==='Auto'||heightType==='AtLeast')&&isAllowBreakAcrossPages){if(!(HelperMethods.convertPointToPixel(row.rowFormat.height)>viewer.clientArea.bottom)||tableRowWidget.y===viewer.clientArea.y){splittedWidget=this.splitWidgets(tableRowWidget,viewer,tableWidgets,rowWidgets,splittedWidget,isLastRow);}}else if(heightType==='Exactly'&&tableRowWidget.y===viewer.clientArea.y){this.addWidgetToTable(viewer,tableWidgets,rowWidgets,tableRowWidget);count++;}}}else{var isInsertSplittedWidgets=false;// Splitting handled for the merged cell with allowRowBreakAcross pages. 
if(this.isVerticalMergedCellContinue(row)&&(isAllowBreakAcrossPages||(isInsertSplittedWidgets=tableRowWidget.y===viewer.clientArea.y||tableRowWidget.y===this.viewer.clientArea.y+tableRowWidget.ownerTable.headerHeight))){if(isInsertSplittedWidgets){this.insertSplittedCellWidgets(viewer,tableWidgets,splittedWidget,tableRowWidget.indexInOwner-1);}else{splittedWidget=this.splitWidgets(tableRowWidget,viewer,tableWidgets,rowWidgets,splittedWidget,isLastRow);}}else if(isLastRow&&!isAllowBreakAcrossPages){splittedWidget=this.splitWidgets(tableRowWidget,viewer,tableWidgets,rowWidgets,splittedWidget,isLastRow);}}//Create New table for splitted widget
if(!sf.base.isNullOrUndefined(splittedWidget)){if(splittedWidget!==tableRowWidget){this.addWidgetToTable(viewer,tableWidgets,rowWidgets,tableRowWidget,tableRowWidget.nextRow);//Updates the fitted table rows to current page.
this.updateWidgetsToPage(tableWidgets,rowWidgets,row.ownerTable,tableRowWidget.nextRow);var index_2=tableWidgets.indexOf(tableRowWidget.containerWidget);if(index_2+1>=tableWidgets.length){//Creates new table widget for splitted rows.
this.addTableWidget(viewer.clientActiveArea,tableWidgets,true);}tableRowWidget=splittedWidget;}else{if(row.index>0){//Updates the fitted table rows to current page.
this.updateWidgetsToPage(tableWidgets,rowWidgets,row.ownerTable,row);// Need to update on this further
if(row.previousRenderedWidget instanceof TableRowWidget){// Need to update on this further
var prevWidget=row.previousRenderedWidget;if(HelperMethods.round(tableRowWidget.y,2)===HelperMethods.round(prevWidget.y+prevWidget.height,2)){var prevIndex=tableWidgets.indexOf(prevWidget.containerWidget);if(prevIndex+1>=tableWidgets.length){//Creates new table widget for splitted rows.
this.addTableWidget(viewer.clientActiveArea,tableWidgets,true);}}else{//Creates new table widget for splitted rows.
this.addTableWidget(viewer.clientActiveArea,tableWidgets,true);}}else{//Creates new table widget for splitted rows.
this.addTableWidget(viewer.clientActiveArea,tableWidgets,true);}}moveRowToNextTable=true;count--;}tableWidget=tableWidgets[tableWidgets.length-1];var prevBodyWidget=undefined;if(tableWidgets.length>1){//Get Previous Splitted Widget container
prevBodyWidget=tableWidgets[tableWidgets.length-2].containerWidget;}else{var previousBlock=row.ownerTable.previousRenderedWidget;prevBodyWidget=previousBlock.containerWidget;}var pageIndex=0;if(!sf.base.isNullOrUndefined(prevBodyWidget)){pageIndex=this.documentHelper.pages.indexOf(prevBodyWidget.page);}var rowToMove=row;var keepNext=false;var index=row.ownerTable.containerWidget.index;var bodyWidget=void 0;var block=void 0;if(moveRowToNextTable&&tableWidgets.length===1){block=tableWidgets[tableWidgets.length-1];}else{block=tableWidgets[tableWidgets.length-2];}var removeTable=true;//Move Next RowWidge to next page
if(moveRowToNextTable&&rowWidgets.length===1){var prev=this.alignBlockElement(row);if(!sf.base.isNullOrUndefined(prev.node)){var previousRow=prev.node;if(previousRow instanceof TableRowWidget&&previousRow.indexInOwner===0){if(tableWidgets.length>1&&tableWidgets[tableWidgets.length-1].childWidgets.length===0){tableWidgets.pop();tableWidget=tableWidgets[tableWidgets.length-1];tableWidget.height=0;}}else if(prev.node instanceof ParagraphWidget){var previousWidget=this.splitParagraph(prev.node,parseInt(prev.position.index,10));block=previousWidget;if(tableWidgets.length>1&&tableWidgets[tableWidgets.length-1].childWidgets.length===0){tableWidgets.pop();tableWidget=tableWidgets[tableWidgets.length-1];}removeTable=false;}if(previousRow instanceof TableRowWidget){rowToMove=previousRow;if(!rowToMove.ownerTable.equals(row.ownerTable)){removeTable=false;}}keepNext=true;}}bodyWidget=this.moveBlocksToNextPage(block instanceof ParagraphWidget?block.previousWidget:block);var curretTable=tableWidgets[tableWidgets.length-1];//Move Next RowWidge to next page
if(moveRowToNextTable&&removeTable){if(rowToMove.index===0&&curretTable.containerWidget&&curretTable.containerWidget.childWidgets.indexOf(curretTable)!==-1){curretTable.containerWidget.childWidgets.splice(curretTable.containerWidget.childWidgets.indexOf(curretTable),1);}}if(removeTable){if(bodyWidget.childWidgets.indexOf(curretTable)!==-1){bodyWidget.childWidgets.splice(bodyWidget.childWidgets.indexOf(curretTable),1);}bodyWidget.childWidgets.unshift(curretTable);this.shiftFloatingItemsFromTable(curretTable,bodyWidget);}curretTable.containerWidget=bodyWidget;if(moveRowToNextTable&&rowToMove.index>0||rowWidgets.length>1){var currentRow=!moveRowToNextTable?rowWidgets[rowWidgets.length-2]:rowWidgets[rowWidgets.length-1];if(keepNext){currentRow=rowToMove;}this.moveNextWidgetsToTable(tableWidgets,currentRow,!moveRowToNextTable);rowToMove=row;}if(keepNext){this.updateClientPositionForBlock(removeTable?curretTable:block,row);}moveRowToNextTable=false;if(rowToMove.ownerTable.header&&tableRowWidget.height<viewer.clientArea.bottom){if(viewer instanceof PageLayoutViewer){viewer.documentHelper.currentRenderingPage.repeatHeaderRowTableWidget=true;}//Updates table widgets location.
viewer.updateClientAreaForBlock(rowToMove.ownerTable,true,tableWidgets);//Update splitted row widget location. if header is repeated update the y position of splitted widget to header height.
splittedWidget.x=splittedWidget.x;splittedWidget.y=tableWidget.y+rowToMove.ownerTable.headerHeight;// let cellspace: number = viewer instanceof PageLayoutViewer ? cellspacing / 2 : cellspacing;
var cellspace=cellSpacing/2;this.updateChildLocationForRow(tableWidget.y+rowToMove.ownerTable.headerHeight-cellspace,splittedWidget);}else{//Updates table widgets location.
viewer.updateClientAreaForBlock(rowToMove.ownerTable,true,tableWidgets);//Update splitted row widget location. if header is repeated update the y position of splitted widget to header height.
splittedWidget.x=splittedWidget.x;splittedWidget.y=tableWidget.y;// let cellspace: number = viewer instanceof PageLayoutViewer ? cellspacing / 2 : cellspacing;
var cellspace=cellSpacing/2;this.updateChildLocationForRow(tableWidget.y-cellspace,splittedWidget);}if(removeTable&&this.shiftedFloatingItemsFromTable.length>0){for(var i=0;i<this.shiftedFloatingItemsFromTable.length;i++){var floatingItem=this.shiftedFloatingItemsFromTable[i];var position=this.getFloatingItemPoints(floatingItem);floatingItem.y=position.y;floatingItem.x=position.x;if(floatingItem instanceof ShapeElementBox){this.updateChildLocationForCellOrShape(floatingItem.y,floatingItem);}}this.shiftedFloatingItemsFromTable=[];}}isLastRow=false;}if(isHeader){if(row.ownerTable.continueHeader){row.ownerTable.header=true;row.ownerTable.headerHeight=rowHeight+row.ownerTable.headerHeight;}headerRow=this.getHeader(row.ownerTable);if(!sf.base.isNullOrUndefined(headerRow)&&row.index===headerRow.index){var headerHeight=this.getHeaderHeight(row.ownerTable,row,rowWidgets);if(headerHeight>row.ownerTable.headerHeight||headerHeight>row.ownerTable.headerHeight){row.ownerTable.headerHeight=headerHeight;}if(row.ownerTable.headerHeight>viewer.clientArea.height){row.ownerTable.header=false;row.ownerTable.continueHeader=false;row.ownerTable.headerHeight=0;var pages=this.documentHelper.pages;for(var i=0;i<pages.length;i++){if(pages[i].repeatHeaderRowTableWidget){pages[i].repeatHeaderRowTableWidget=false;}}}}}if(tableWidgets.length>2&&row.ownerTable.header&&tableRowWidget.height<viewer.clientActiveArea.bottom&&!viewer.documentHelper.currentRenderingPage.repeatHeaderRowTableWidget){viewer.documentHelper.currentRenderingPage.repeatHeaderRowTableWidget=true;}}};/* eslint-enable */Layout.prototype.getHeader=function(table){var header=undefined;var flag=true;table=table.getSplitWidgets()[0];for(var i=0;i<table.childWidgets.length;i++){var row=table.childWidgets[i];if(row.rowFormat.isHeader){header=row;}else{flag=false;}if(!flag){break;}}return header;};Layout.prototype.getHeaderHeight=function(ownerTable,row,rowCollection){var height=0;if(row.ownerTable.childWidgets.length>0&&ownerTable.childWidgets[0].rowFormat.isHeader){for(var i=0;i<ownerTable.childWidgets.length;i++){var row_1=ownerTable.childWidgets[i];if(row_1.rowFormat.isHeader){height=height+this.getRowHeight(row_1,rowCollection);}else{break;}}}return height;};Layout.prototype.updateWidgetToRow=function(cell){//const viewer: LayoutViewer = this.viewer;
//Adds table cell widget to owner row widget.
var rowWidget=cell.ownerRow;// let cellLeft: number = rowWidget.x;
// if (rowWidget.childWidgets.length > 0) {
//     const lastWidget: TableCellWidget = rowWidget.childWidgets[rowWidget.childWidgets.length - 1] as TableCellWidget;
//     cellLeft = lastWidget.x + lastWidget.width + lastWidget.margin.right;
// }
// rowWidget.childWidgets.push(cell);
cell.containerWidget=rowWidget;//If the row height is set as Atleast then height is set to atleast height for the first cell of the row.
if(!sf.base.isNullOrUndefined(cell.ownerRow)&&cell.ownerRow.rowFormat.heightType!=='Exactly'&&HelperMethods.convertPointToPixel(cell.ownerRow.rowFormat.height)>0&&cell.cellIndex===0){rowWidget.height=rowWidget.height+HelperMethods.convertPointToPixel(cell.ownerRow.rowFormat.height);}//Add condition not cell merged vertically.
if(cell.cellFormat.rowSpan===1){var cellHeight=cell.height+cell.margin.top+cell.margin.bottom;if(rowWidget.height-HelperMethods.convertPointToPixel(cell.ownerTable.tableFormat.cellSpacing)<cellHeight){rowWidget.height=cellHeight+HelperMethods.convertPointToPixel(cell.ownerTable.tableFormat.cellSpacing);}}};// eslint-disable-next-line max-len
Layout.prototype.updateHeightForRowWidget=function(viewer,isUpdateVerticalPosition,tableCollection,rowCollection,rowWidget,isLayouted,endRowWidget,isInitialLayout){for(var i=0;i<rowWidget.childWidgets.length;i++){var cellspacing=0;var cellWidget=undefined;var childWidget=rowWidget.childWidgets[i];// if (childWidget instanceof TableCellWidget) {
cellWidget=childWidget;// }
var rowSpan=1;rowSpan=cellWidget.cellFormat.rowSpan;cellspacing=HelperMethods.convertPointToPixel(cellWidget.ownerTable.tableFormat.cellSpacing);if(rowSpan>1){var currentRowWidgetIndex=rowWidget.containerWidget.childWidgets.indexOf(rowWidget);var rowSpanWidgetEndIndex=currentRowWidgetIndex+rowSpan-1-(rowWidget.index-cellWidget.rowIndex);if(!isInitialLayout&&(viewer.clientArea.bottom<cellWidget.y+cellWidget.height+cellWidget.margin.bottom||rowSpanWidgetEndIndex>=currentRowWidgetIndex+1)&&(rowCollection.length===1||rowCollection.length>=1&&rowWidget===rowCollection[rowCollection.length-1])){this.splitSpannedCellWidget(cellWidget,tableCollection,rowCollection,viewer);}var spanEndRowWidget=rowWidget;if(rowSpanWidgetEndIndex>0){if(rowSpanWidgetEndIndex<rowWidget.containerWidget.childWidgets.length){var childWidget_1=rowWidget.containerWidget.childWidgets[rowSpanWidgetEndIndex];if(childWidget_1 instanceof TableRowWidget){spanEndRowWidget=childWidget_1;if(spanEndRowWidget===endRowWidget){spanEndRowWidget=rowWidget;}}}else{// eslint-disable-next-line max-len
spanEndRowWidget=rowWidget.containerWidget.childWidgets[rowWidget.containerWidget.childWidgets.length-1];}}if(cellWidget.y+cellWidget.height+cellWidget.margin.bottom<spanEndRowWidget.y+spanEndRowWidget.height){cellWidget.height=spanEndRowWidget.y+spanEndRowWidget.height-cellWidget.y-cellWidget.margin.bottom;// eslint-disable-next-line max-len
}else if(isLayouted&&spanEndRowWidget&&spanEndRowWidget.y!==0&&spanEndRowWidget.height!==0&&cellWidget.y+cellWidget.height+cellWidget.margin.bottom>spanEndRowWidget.y+spanEndRowWidget.height){if(spanEndRowWidget.rowFormat.heightType!=='Exactly'||spanEndRowWidget.rowFormat.heightType==='Exactly'&&spanEndRowWidget.rowFormat.height>cellWidget.y+cellWidget.height+cellWidget.margin.bottom-spanEndRowWidget.y){spanEndRowWidget.height=cellWidget.y+cellWidget.height+cellWidget.margin.bottom-spanEndRowWidget.y;}else{cellWidget.height=spanEndRowWidget.y-cellWidget.y+spanEndRowWidget.height;}//Update the next rowlayout widget location. Reason for the updation is previous row height is updated when cell height is greater. So already layouted next row location has to be updated again.
// if (rowWidget === spanEndRowWidget && rowWidget.nextWidget instanceof TableRowWidget) {
//     let nextRow: TableRowWidget = rowWidget.nextWidget as TableRowWidget;
//     // Need to update on this further
//     // if (viewer.renderedElements.containsKey(nextRow)) {
//     //     let nextWidget: TableRowWidget[] = viewer.renderedElements.get(nextRow) as TableRowWidget[];
//     //     if (nextWidget.length > 0) {
//     //         nextWidget[0].x = nextWidget[0].x;
//     //         nextWidget[0].y = rowWidget.y + rowWidget.height;
//     //     }
//     // }
// }
}}else{if(cellspacing>0){// In the Case of tableWidget is greater than one and rowWidget is start at the Top Position of the page.
// In such case we have update the cell height with half of cell spacing.
// Remaining cases we have to update the entire hight
if(tableCollection.length>1&&rowWidget.y===viewer.clientArea.y&&viewer instanceof PageLayoutViewer){cellspacing=cellspacing/2;}}cellWidget.height=rowWidget.height-cellWidget.margin.top-cellWidget.margin.bottom-cellspacing;}this.updateHeightForCellWidget(viewer,tableCollection,rowCollection,cellWidget);var widget=rowWidget.containerWidget;while(widget.containerWidget instanceof Widget){widget=widget.containerWidget;}var page=undefined;if(widget instanceof BodyWidget){page=widget.page;}// eslint-disable-next-line max-len
if(viewer instanceof PageLayoutViewer&&viewer.visiblePages.indexOf(page)!==-1||isUpdateVerticalPosition){this.updateCellVerticalPosition(cellWidget,false,cellWidget.ownerTable.isInsideTable);}//Renders the current table row contents, after relayout based on editing.
// if (viewer instanceof PageLayoutViewer && (viewer as PageLayoutViewer).visiblePages.indexOf(page) !== -1) {
//     //Added proper undefined condition check for Asynchronous operation.
//     if (!isNullOrUndefined(rowWidget.tableRow) && !isNullOrUndefined(rowWidget.tableRow.rowFormat)) {
//         this.viewer.updateScrollBars();
//         //this.render.renderTableCellWidget(page, cellWidget);
//     }
// }
}};// eslint-disable-next-line max-len
Layout.prototype.updateHeightForCellWidget=function(viewer,tableWidget,rowCollection,cellWidget){for(var i=0;i<cellWidget.childWidgets.length;i++){if(cellWidget.childWidgets[i]instanceof TableWidget){this.updateHeightForTableWidget(tableWidget,rowCollection,cellWidget.childWidgets[i]);}}};Layout.prototype.getRowHeight=function(row,rowCollection){var height=0;if(row.rowFormat.heightType==='Exactly'){height=row.rowFormat.height;}else{for(var i=0;i<rowCollection.length;i++){if(rowCollection[i]instanceof TableRowWidget){height=rowCollection[i].height+height;}}height=Math.max(height,row.rowFormat.height);}return height;};// eslint-disable-next-line max-len
Layout.prototype.splitSpannedCellWidget=function(cellWidget,tableCollection,rowCollection,viewer){// eslint-disable-next-line max-len
var splittedCell=this.getSplittedWidget(viewer.clientArea.bottom,false,tableCollection,rowCollection,cellWidget);if(!sf.base.isNullOrUndefined(splittedCell)){//Adds the splitted contents of a vertical merged cell, in order preserve in next page.
this.documentHelper.splittedCellWidgets.push(splittedCell);}};// eslint-disable-next-line max-len
Layout.prototype.insertSplittedCellWidgets=function(viewer,tableCollection,rowWidget,previousRowIndex){if(!sf.base.isNullOrUndefined(rowWidget)){var left=rowWidget.x;var tableWidth=0;tableWidth=HelperMethods.convertPointToPixel(rowWidget.ownerTable.tableHolder.tableWidth);for(var i=0;i<rowWidget.childWidgets.length;i++){var cellWidget=rowWidget.childWidgets[i];if(Math.round(left)<Math.round(cellWidget.x-cellWidget.margin.left)){if(this.insertRowSpannedWidget(rowWidget,viewer,left,i)){i--;continue;}var length_1=rowWidget.childWidgets.length;this.insertEmptySplittedCellWidget(rowWidget,tableCollection,left,i,previousRowIndex);if(length_1<rowWidget.childWidgets.length){if(i===0){break;}i--;continue;}}left+=cellWidget.margin.left+cellWidget.width+cellWidget.margin.right;if(i===rowWidget.childWidgets.length-1&&Math.round(left)<Math.round(rowWidget.x+tableWidth)){if(this.insertRowSpannedWidget(rowWidget,viewer,left,i+1)){continue;}this.insertEmptySplittedCellWidget(rowWidget,tableCollection,left,i+1,previousRowIndex);continue;}}// Special case: when the child widgets of row is equal to 0 then the splitted widgets in the viewer is added in the table row widgets.
// eslint-disable-next-line max-len
if((sf.base.isNullOrUndefined(rowWidget.childWidgets)||rowWidget.childWidgets.length===0)&&this.documentHelper.splittedCellWidgets.length>0){for(var j=0;j<this.documentHelper.splittedCellWidgets.length;j++){var widget=this.documentHelper.splittedCellWidgets[j];if(Math.round(left)<=Math.round(widget.x-widget.margin.left)){if(this.insertRowSpannedWidget(rowWidget,viewer,left,j)){j--;continue;}var count=rowWidget.childWidgets.length;this.insertEmptySplittedCellWidget(rowWidget,tableCollection,left,j,previousRowIndex);if(count<rowWidget.childWidgets.length){j--;continue;}}left+=widget.margin.left+widget.width+widget.margin.right;if(j===rowWidget.childWidgets.length-1&&Math.round(left)<Math.round(rowWidget.x+tableWidth)){if(this.insertRowSpannedWidget(rowWidget,viewer,left,j+1)){continue;}this.insertEmptySplittedCellWidget(rowWidget,tableCollection,left,j+1,previousRowIndex);continue;}}}if(this.documentHelper.splittedCellWidgets.length>0){this.documentHelper.splittedCellWidgets=[];}}};Layout.prototype.insertRowSpannedWidget=function(rowWidget,viewer,left,index){var cellSpacing=0;if(rowWidget.ownerTable.tableFormat.cellSpacing>0){cellSpacing=HelperMethods.convertPointToPixel(rowWidget.ownerTable.tableFormat.cellSpacing);}for(var i=0;i<this.documentHelper.splittedCellWidgets.length;i++){var splittedCell=this.documentHelper.splittedCellWidgets[i];if(Math.round(left)===Math.round(splittedCell.x-splittedCell.margin.left)){rowWidget.childWidgets.splice(index,0,splittedCell);splittedCell.containerWidget=rowWidget;if(splittedCell.height>rowWidget.height){rowWidget.height=splittedCell.height;}//If the splitted cell location differs from expected location update the location of row child widgets.
if(splittedCell.y!==rowWidget.y+splittedCell.margin.top+cellSpacing){this.updateChildLocationForRow(rowWidget.y,rowWidget);}this.documentHelper.splittedCellWidgets.splice(i,1);return true;}}return false;};// eslint-disable-next-line max-len
Layout.prototype.insertEmptySplittedCellWidget=function(currentRow,tableCollection,left,index,previousRowIndex){var tableWidget=tableCollection[tableCollection.length-1];var previousRow;for(var j=tableCollection.length-1;j>=0;j--){var table=tableCollection[j];for(var z=table.childWidgets.length-1;z>=0;z--){var row=table.childWidgets[z];if(row.index===previousRowIndex){previousRow=row;break;}}}if(previousRow){tableWidget=previousRow.ownerTable;previousRowIndex=previousRow.indexInOwner;}for(var i=previousRowIndex;i>=0;i--){var rowWidget=tableWidget.childWidgets[i];var previousLeft=rowWidget.x;for(var j=0;j<rowWidget.childWidgets.length;j++){var rowSpan=1;var cellWidget=rowWidget.childWidgets[j];if(Math.round(left)===Math.round(previousLeft)){rowSpan=sf.base.isNullOrUndefined(cellWidget)||sf.base.isNullOrUndefined(cellWidget.cellFormat)?rowSpan:cellWidget.cellFormat.rowSpan;if(rowSpan>1){//if (!isNullOrUndefined(currentRow.childWidgets[index])) {
var emptyCellWidget=this.createCellWidget(cellWidget);//if (emptyCellWidget.x < (currentRow.childWidgets[index] as TableCellWidget).x) {
currentRow.childWidgets.splice(index,0,emptyCellWidget);emptyCellWidget.containerWidget=currentRow;this.updateChildLocationForRow(currentRow.y,currentRow);return;//}
//}
}}previousLeft+=cellWidget.margin.left+cellWidget.width+cellWidget.margin.right;}}};// eslint-disable-next-line max-len
Layout.prototype.getSplittedWidget=function(bottom,splitMinimalWidget,tableCollection,rowCollection,cellWidget){var splittedWidget=undefined;if(cellWidget.y+cellWidget.height>bottom-cellWidget.margin.bottom){for(var i=0;i<cellWidget.childWidgets.length;i++){if(cellWidget.childWidgets[i]instanceof ParagraphWidget){var paragraphWidget=cellWidget.childWidgets[i];var splittedPara=this.getSplittedWidgetForPara(bottom-cellWidget.margin.bottom,paragraphWidget);if(!sf.base.isNullOrUndefined(splittedPara)){if(i===0&&splittedPara===paragraphWidget){//Returns if the whole content of the cell does not fit in current page.
return cellWidget;}if(cellWidget.childWidgets.indexOf(splittedPara)!==-1){cellWidget.childWidgets.splice(cellWidget.childWidgets.indexOf(splittedPara),1);i--;}cellWidget.height-=splittedPara.height;if(sf.base.isNullOrUndefined(splittedWidget)){//Creates new widget, to hold the splitted contents.
splittedWidget=this.createCellWidget(cellWidget);}splittedWidget.height+=splittedPara.height;splittedWidget.childWidgets.push(splittedPara);splittedPara.containerWidget=splittedWidget;}}else{var tableWidget=cellWidget.childWidgets[i];var tableCol=[tableWidget];//Check for nested table.
if(bottom-cellWidget.margin.bottom<tableWidget.y+tableWidget.height){var tableHeight=tableWidget.height;// eslint-disable-next-line max-len
var splittedTable=this.getSplittedWidgetForTable(bottom-cellWidget.margin.bottom,tableCol,tableWidget);if(sf.base.isNullOrUndefined(splittedTable)&&!tableWidget.childWidgets[0].rowFormat.allowBreakAcrossPages){splittedTable=tableWidget;}if(!sf.base.isNullOrUndefined(splittedTable)){if(i===0&&splittedTable===tableWidget){//Returns if the whole table does not fit in current page.
return cellWidget;}if(cellWidget.childWidgets.indexOf(splittedTable)!==-1){cellWidget.childWidgets.splice(cellWidget.childWidgets.indexOf(splittedTable),1);i--;cellWidget.height-=splittedTable.height;}else{cellWidget.height-=tableHeight-tableWidget.height;}if(sf.base.isNullOrUndefined(splittedWidget)){//Creates new widget, to hold the splitted contents.
splittedWidget=this.createCellWidget(cellWidget);}splittedWidget.height+=splittedTable.height;splittedWidget.childWidgets.push(splittedTable);splittedTable.containerWidget=splittedWidget;}}}}}if(sf.base.isNullOrUndefined(splittedWidget)&&splitMinimalWidget&&this.isRelayoutneed){//Creates new widget, to hold the splitted contents.
splittedWidget=this.createCellWidget(cellWidget);}return splittedWidget;};Layout.prototype.getListLevelPattern=function(value){switch(value){case 0:return'Arabic';case 1:return'LowLetter';case 2:return'LowRoman';case 3:return'UpLetter';case 4:return'UpRoman';case 5:return'Ordinal';case 6:return'Number';case 7:return'OrdinalText';case 8:return'LeadingZero';case 9:return'Bullet';case 10:return'FarEast';case 11:return'Special';default:return'None';}};Layout.prototype.createCellWidget=function(cell){var cellWidget=new TableCellWidget();cellWidget.cellFormat=cell.cellFormat;cellWidget.index=cell.index;cellWidget.rowIndex=cell.rowIndex;cellWidget.columnIndex=cell.columnIndex;cellWidget.containerWidget=cell.containerWidget;this.updateWidgetLocation(cell,cellWidget);cellWidget.margin=cell.margin;cellWidget.leftBorderWidth=cell.leftBorderWidth;cellWidget.rightBorderWidth=cell.rightBorderWidth;return cellWidget;};Layout.prototype.createTableWidget=function(table){var newTable=new TableWidget();if(table.header){newTable.header=table.header;newTable.headerHeight=table.headerHeight;}newTable.index=table.index;newTable.tableFormat=table.tableFormat;newTable.tableHolder=table.tableHolder;newTable.isGridUpdated=table.isGridUpdated;newTable.wrapTextAround=table.wrapTextAround;newTable.positioning=table.positioning;newTable.isContainInsideTable=table.isContainInsideTable;return newTable;};Layout.prototype.getSplittedWidgetForPara=function(bottom,paragraphWidget){var lineBottom=paragraphWidget.y;var splittedWidget=undefined;var moveEntireBlock=false;for(var i=0;i<paragraphWidget.childWidgets.length;i++){var lineWidget=paragraphWidget.childWidgets[i];if(bottom<lineBottom+this.footHeight+lineWidget.height){if(paragraphWidget.paragraphFormat.keepLinesTogether&&(paragraphWidget.index!==0||paragraphWidget.index===0&&!sf.base.isNullOrUndefined(paragraphWidget.associatedCell.ownerRow.previousWidget))){moveEntireBlock=true;i=0;lineWidget=paragraphWidget.childWidgets[0];}else if(paragraphWidget.paragraphFormat.widowControl){if(i===1){moveEntireBlock=true;i=0;lineWidget=paragraphWidget.childWidgets[0];}}if(i===0){if(lineWidget.paragraph.containerWidget instanceof TableCellWidget&&!moveEntireBlock){//checks first line of the page is exceed the page height
if(lineWidget.paragraph.containerWidget.y===paragraphWidget.y){lineBottom+=lineWidget.height;continue;}}splittedWidget=paragraphWidget;break;}if(paragraphWidget.childWidgets.indexOf(lineWidget)!==-1){paragraphWidget.childWidgets.splice(paragraphWidget.childWidgets.indexOf(lineWidget),1);i--;}paragraphWidget.height-=lineWidget.height;if(sf.base.isNullOrUndefined(splittedWidget)){//Creates new widget, to hold the splitted contents.
splittedWidget=new ParagraphWidget();splittedWidget.characterFormat=paragraphWidget.characterFormat;splittedWidget.paragraphFormat=paragraphWidget.paragraphFormat;splittedWidget.index=paragraphWidget.index;this.updateWidgetLocation(paragraphWidget,splittedWidget);splittedWidget.height=lineWidget.height;}else{splittedWidget.height+=lineWidget.height;}splittedWidget.childWidgets.push(lineWidget);lineWidget.paragraph=splittedWidget;}lineBottom+=lineWidget.height;}return splittedWidget;};Layout.prototype.getSplittedWidgetForTable=function(bottom,tableCollection,tableWidget){var rowBottom=tableWidget.y;var splittedWidget=undefined;for(var i=0;i<tableWidget.childWidgets.length;i++){var rowWidget=undefined;var childWidget=tableWidget.childWidgets[i];// if (childWidget instanceof TableRowWidget) {
rowWidget=childWidget;// }
var rowHeight=rowWidget.height;if(bottom<rowBottom+rowHeight||!sf.base.isNullOrUndefined(splittedWidget)){//ToDo: Check whether row included in vertical merge or AllowRowSplitbyPage is true, if so split row.
//Checks if atleast first line fits in the client area.
var splittedRow=undefined;var allowRowBreakAcrossPages=true;if(!sf.base.isNullOrUndefined(rowWidget)&&!sf.base.isNullOrUndefined(rowWidget.rowFormat)){allowRowBreakAcrossPages=rowWidget.rowFormat.allowBreakAcrossPages;}if(allowRowBreakAcrossPages){// eslint-disable-next-line max-len
splittedRow=sf.base.isNullOrUndefined(splittedWidget)&&this.isFirstLineFitForRow(bottom,rowWidget)?this.getSplittedWidgetForRow(bottom,tableCollection,[rowWidget],rowWidget):rowWidget;}else{if(sf.base.isNullOrUndefined(tableWidget.containerWidget.containerWidget.previousWidget)&&this.isFirstLineFitForRow(bottom,rowWidget)||tableWidget.isInsideTable&&!tableWidget.containerWidget.containerWidget.rowFormat.allowBreakAcrossPages){splittedRow=this.getSplittedWidgetForRow(bottom,tableCollection,[rowWidget],rowWidget);}else if(!sf.base.isNullOrUndefined(tableWidget.containerWidget.containerWidget.previousWidget)){splittedRow=rowWidget;}}if(!sf.base.isNullOrUndefined(splittedRow)){if(i===0&&splittedRow===rowWidget){//Returns if the whole table does not fit in current page.
return tableWidget;}if(tableWidget.childWidgets.indexOf(splittedRow)!==-1){tableWidget.childWidgets.splice(tableWidget.childWidgets.indexOf(splittedRow),1);i--;tableWidget.height-=splittedRow.height;}else{tableWidget.height-=rowHeight-rowWidget.height;}if(sf.base.isNullOrUndefined(splittedWidget)){//Creates new widget, to hold the splitted contents.
splittedWidget=this.createTableWidget(tableWidget);this.updateWidgetLocation(tableWidget,splittedWidget);splittedWidget.height=splittedRow.height;}else{splittedWidget.height+=splittedRow.height;}splittedWidget.childWidgets.push(splittedRow);splittedRow.containerWidget=splittedWidget;}}rowBottom+=rowWidget.height;}return splittedWidget;};Layout.prototype.isFirstLineFitForPara=function(bottom,paraWidget){var lineWidget=paraWidget.childWidgets[0];var lineHeight=lineWidget.height;if(paraWidget.paragraphFormat.keepLinesTogether){lineHeight=paraWidget.height;}var cellwidget=lineWidget.paragraph.containerWidget;// let document: WordDocument = undefined;
// if (!isNullOrUndefined(lineWidget.paragraph.currentNode) && !isNullOrUndefined(cellwidget.containerWidget)) {
//     document = WordDocument.getDocumentOf(lineWidget.paragraph.currentNode);
// }
//checks first line of the page is exceed the page height
if(this.documentHelper.isFirstLineFitInShiftWidgets){// eslint-disable-next-line max-len
if(this.viewer.clientActiveArea.y===this.viewer.clientArea.y&&paraWidget.y+lineHeight+this.footHeight>=bottom){return true;}}else{// For nested tables,
if(cellwidget.ownerTable.isInsideTable){// Gets the container cell widgets, consider it as client area for the cell widget.
var containerCellWidget=undefined;if(cellwidget.containerWidget instanceof TableRowWidget&&cellwidget.containerWidget.containerWidget instanceof TableWidget&&cellwidget.containerWidget.containerWidget.containerWidget instanceof TableCellWidget){containerCellWidget=cellwidget.containerWidget.containerWidget.containerWidget;}if(!sf.base.isNullOrUndefined(containerCellWidget)&&cellwidget.containerWidget.y===containerCellWidget.y&&paraWidget.y+lineHeight+this.footHeight>=bottom){return true;}// eslint-disable-next-line max-len
}else if(cellwidget.containerWidget.y===this.viewer.clientArea.y&&paraWidget.y+lineHeight+this.footHeight>=bottom){return true;}}return paraWidget.y+lineHeight+this.footHeight<=bottom;};Layout.prototype.isFirstLineFitForTable=function(bottom,tableWidget){var rowWidget=undefined;var isFit=false;var childWidget=tableWidget.childWidgets[0];// if (childWidget instanceof TableRowWidget) {
rowWidget=childWidget;// }
if(!sf.base.isNullOrUndefined(rowWidget)){isFit=this.isFirstLineFitForRow(bottom,rowWidget);}return isFit;};Layout.prototype.isFirstLineFitForRow=function(bottom,rowWidget){for(var i=0;i<rowWidget.childWidgets.length;i++){var cellWidget=rowWidget.childWidgets[i];if(!this.isFirstLineFitForCell(bottom,cellWidget)){return false;}}return true;};Layout.prototype.isFirstLineFitForCell=function(bottom,cellWidget){if(cellWidget.childWidgets.length===0){return true;}if(cellWidget.childWidgets[0]instanceof ParagraphWidget){var paraWidget=cellWidget.childWidgets[0];return this.isFirstLineFitForPara(bottom-cellWidget.margin.bottom,paraWidget);}else{var tableWidget=cellWidget.childWidgets[0];return this.isFirstLineFitForTable(bottom-cellWidget.margin.bottom,tableWidget);}};Layout.prototype.updateWidgetLocation=function(widget,table){table.x=widget.x;table.y=widget.y;table.width=widget.width;};Layout.prototype.updateChildLocationForTable=function(top,tableWidget){for(var i=0;i<tableWidget.childWidgets.length;i++){var rowWidget=tableWidget.childWidgets[i];//rowWidget.x = rowWidget.x;
rowWidget.y=top;this.updateChildLocationForRow(top,rowWidget);top+=rowWidget.height;}};Layout.prototype.updateChildLocationForRow=function(top,rowWidget){var spacing=0;if(rowWidget.ownerTable.tableFormat.cellSpacing>0){spacing=HelperMethods.convertPointToPixel(rowWidget.ownerTable.tableFormat.cellSpacing);}for(var i=0;i<rowWidget.childWidgets.length;i++){var cellWidget=rowWidget.childWidgets[i];//cellWidget.x = cellWidget.x;
cellWidget.index=cellWidget.cellIndex;cellWidget.y=top+cellWidget.margin.top+spacing;this.updateChildLocationForCellOrShape(cellWidget.y,cellWidget);}};Layout.prototype.updateChildLocationForCellOrShape=function(top,widget){var container=widget;if(widget instanceof ShapeElementBox){container=widget.textFrame;}for(var i=0;i<container.childWidgets.length;i++){container.childWidgets[i].x=container.childWidgets[i].x;container.childWidgets[i].y=top;if(container.childWidgets[i]instanceof TableWidget){this.updateChildLocationForTable(top,container.childWidgets[i]);}if(container.childWidgets[i]instanceof ParagraphWidget){var para=container.childWidgets[i];for(var i_2=0;i_2<para.childWidgets.length;i_2++){var line=para.childWidgets[0];for(var k=0;k<line.children.length;k++){var element=line.children[k];if(element instanceof FootnoteElementBox){if(!sf.base.isNullOrUndefined(para.bodyWidget.page.footnoteWidget)){return;}else{var prevWidget=para.bodyWidget.previousRenderedWidget;var prevBodyWidget=para.bodyWidget.previousRenderedWidget;var newBodyWidget=para.bodyWidget;var footWidgets=this.getFootNoteWidgetsOf(para);// this.updateContainerWidget(curretBlock as Widget, newBodyWidget, prevWidget.indexInOwner + 1, false);
this.moveFootNotesToPage(footWidgets,prevBodyWidget,newBodyWidget);this.layoutfootNote(para.bodyWidget.page.footnoteWidget);}}}}}top+=container.childWidgets[i].height;}};Layout.prototype.updateCellVerticalPosition=function(cellWidget,isUpdateToTop,isInsideTable){var containerWidget=cellWidget.ownerTable.containerWidget;if(containerWidget instanceof BlockContainer||containerWidget instanceof TextFrame||isInsideTable){var displacement=this.getDisplacement(cellWidget,isUpdateToTop);//Update Y position alone for the child widget of cell
this.updateCellContentVerticalPosition(cellWidget,displacement,isUpdateToTop);}};Layout.prototype.updateCellContentVerticalPosition=function(cellWidget,displacement,isUpdateToTop){if(displacement===0){return;}var location=cellWidget.y+displacement;for(var i=0;i<cellWidget.childWidgets.length;i++){if(cellWidget.childWidgets[i]instanceof ParagraphWidget){var para=cellWidget.childWidgets[i];para.y=location;this.updateShapeInsideCell(para,displacement);}else{location=this.updateTableWidgetLocation(cellWidget.childWidgets[i],location,isUpdateToTop);}location=location+cellWidget.childWidgets[i].height;}};Layout.prototype.updateShapeInsideCell=function(paragraph,displacement){for(var i=0;i<paragraph.floatingElements.length;i++){var floatElement=paragraph.floatingElements[i];floatElement.y+=displacement;if(floatElement instanceof ShapeElementBox){this.updateChildLocationForCellOrShape(floatElement.y,floatElement);}}};Layout.prototype.updateTableWidgetLocation=function(tableWidget,location,isUpdateToTop){tableWidget.y=location=location+tableWidget.topBorderWidth;var cellSpacing=0;for(var i=0;i<tableWidget.childWidgets.length;i++){var rowWidget=tableWidget.childWidgets[i];rowWidget.y=location;for(var j=0;j<rowWidget.childWidgets.length;j++){var cellWidget=rowWidget.childWidgets[j];cellWidget.y=location+cellWidget.margin.top+cellSpacing;this.updateCellVerticalPosition(cellWidget,isUpdateToTop,true);}location=location+rowWidget.height;}return location;};Layout.prototype.getDisplacement=function(cellWidget,isUpdateToTop){//Gets the height of row
var rowHeight=0;var rowWidget=cellWidget.containerWidget;var padding=cellWidget.margin.top+cellWidget.margin.bottom;if(!sf.base.isNullOrUndefined(cellWidget.cellFormat)&&cellWidget.cellFormat.rowSpan>1){rowHeight=cellWidget.height;}else{rowHeight=(!sf.base.isNullOrUndefined(rowWidget)?rowWidget.height:0)-padding;}//Gets the height of content within the cell
var cellContentHeight=this.getCellContentHeight(cellWidget,true);//Displacement field holds the value which has reduced from rowHeight and cellContentHeight
var displacement=0;if(rowHeight>cellContentHeight){displacement=rowHeight-cellContentHeight;if(cellWidget.cellFormat.verticalAlignment==='Center'){displacement=displacement/2;}else if(cellWidget.cellFormat.verticalAlignment==='Top'||isUpdateToTop){displacement=0;}}return displacement;};Layout.prototype.getCellContentHeight=function(cellWidget,isDisplacement){if(sf.base.isNullOrUndefined(cellWidget.childWidgets)){return 0;}var contentHeight=0;var cellY=cellWidget.y;var withShapeContentHeight=0;var withShapeBottom=0;var considerShapeHeight=false;var considerAsTop=false;for(var i=0;i<cellWidget.childWidgets.length;i++){if(cellWidget.childWidgets[i]instanceof ParagraphWidget){var para=cellWidget.childWidgets[i];contentHeight+=cellWidget.childWidgets[i].height;for(var k=0;k<para.floatingElements.length;k++){considerShapeHeight=true;var floatElement=para.floatingElements[k];if(cellWidget.y+cellWidget.containerWidget.height>floatElement.y+floatElement.height&&floatElement.y+floatElement.height>withShapeBottom){withShapeContentHeight=Math.abs(cellY-(floatElement.y+floatElement.height));withShapeBottom=floatElement.y+floatElement.height;considerAsTop=false;}else{considerAsTop=true;}}}else{contentHeight+=cellWidget.childWidgets[i].height;}}if(cellY+contentHeight>withShapeBottom){considerShapeHeight=false;}return isDisplacement&&considerShapeHeight?withShapeContentHeight:isDisplacement&&considerAsTop?cellWidget.ownerRow.height:contentHeight;};Layout.prototype.getTableLeftBorder=function(borders){if(!sf.base.isNullOrUndefined(borders.left)){return borders.left;}else{var border=new WBorder(borders);border.lineStyle='Single';border.lineWidth=0.66;return border;}};Layout.prototype.getTableRightBorder=function(borders){if(!sf.base.isNullOrUndefined(borders.right)){return borders.right;}else{var border=new WBorder(borders);border.lineStyle='Single';border.lineWidth=0.66;return border;}};Layout.prototype.getTableTopBorder=function(borders){if(!sf.base.isNullOrUndefined(borders.top)){return borders.top;}else{var border=new WBorder(borders);border.lineStyle='Single';border.lineWidth=0.66;return border;}};Layout.prototype.getTableBottomBorder=function(borders){if(!sf.base.isNullOrUndefined(borders.bottom)){return borders.bottom;}else{var border=new WBorder(borders);border.lineStyle='Single';border.lineWidth=0.66;return border;}};Layout.prototype.getCellDiagonalUpBorder=function(tableCell){var diagonalUpBorder=undefined;var cellBorder=undefined;cellBorder=tableCell.cellFormat.borders;diagonalUpBorder=cellBorder.diagonalUp;return diagonalUpBorder;};Layout.prototype.getCellDiagonalDownBorder=function(tableCell){var diagonalDownBorder=undefined;var cellBorder=undefined;cellBorder=tableCell.cellFormat.borders;diagonalDownBorder=cellBorder.diagonalDown;return diagonalDownBorder;};Layout.prototype.getTableWidth=function(table){var width=0;for(var i=0;i<table.childWidgets.length;i++){var row=table.childWidgets[i];var rowWidth=0;for(var j=0;j<row.childWidgets.length;j++){var cell=row.childWidgets[j];rowWidth+=HelperMethods.convertPointToPixel(cell.cellFormat.cellWidth);}if(width<rowWidth){width=rowWidth;}}return width;};//#region shifting
Layout.prototype.layoutNextItemsBlock=function(blockAdv,viewer,isFootnotRelayout){var sectionIndex=blockAdv.bodyWidget.sectionIndex;var block=blockAdv;var splittedWidget=block.getSplitWidgets();var nextBlock=splittedWidget[splittedWidget.length-1].nextRenderedWidget;if(sf.base.isNullOrUndefined(nextBlock)||this.documentHelper.blockToShift===block){this.documentHelper.blockToShift=undefined;}var updateNextBlockList=true;while(nextBlock instanceof BlockWidget&&nextBlock.bodyWidget.sectionIndex===sectionIndex){if(!sf.base.isNullOrUndefined(isFootnotRelayout)&&isFootnotRelayout&&!nextBlock.isLayouted&&this.isInitialLoad){break;}var currentWidget=undefined;var blocks=block.getSplitWidgets();currentWidget=blocks[blocks.length-1];// if (viewer.fieldEndParagraph === block) {
//     //Sets field end paragraph to undefined, inorder to hold reLayouting with this paragraph.
//     viewer.fieldEndParagraph = undefined;
// }
block=nextBlock;if(this.documentHelper.blockToShift===block){this.documentHelper.blockToShift=undefined;}updateNextBlockList=false;var nextWidget=undefined;nextWidget=block.getSplitWidgets()[0];// eslint-disable-next-line max-len
if(this.documentHelper.fieldStacks.length===0&&!sf.base.isNullOrUndefined(nextWidget)&&currentWidget.containerWidget===nextWidget.containerWidget&&HelperMethods.round(nextWidget.y,2)===HelperMethods.round(currentWidget.y+currentWidget.height,2)){if(!sf.base.isNullOrUndefined(this.documentHelper.blockToShift)){this.documentHelper.blockToShift=block;}else if(nextWidget.bodyWidget){var floatingElementLength=nextWidget.bodyWidget.floatingElements.length;if(floatingElementLength>0){this.documentHelper.blockToShift=block;}}break;}updateNextBlockList=true;if(viewer.owner.isShiftingEnabled&&this.documentHelper.fieldStacks.length===0){this.documentHelper.blockToShift=block;break;}else if(sf.base.isNullOrUndefined(this.viewer.owner.editorModule)||!this.viewer.owner.editorModule.isInsertingTOC){block=block.combineWidget(this.viewer);//let paragraph: ParagraphWidget;
if(currentWidget.containerWidget!==block.containerWidget){if(!(currentWidget instanceof ParagraphWidget)||currentWidget instanceof ParagraphWidget&&!currentWidget.isEndsWithPageBreak){// eslint-disable-next-line max-len
this.updateContainerWidget(block,currentWidget.containerWidget,currentWidget.indexInOwner+1,false);}}if(block instanceof TableWidget){this.clearTableWidget(block,true,true);block.isGridUpdated=false;//paragraph = this.documentHelper.selection.getFirstParagraphInFirstCell(block as TableWidget);
}else{//paragraph = block as ParagraphWidget;
}//if ((this.viewer.owner.isDocumentLoaded) && this.viewer.owner.editorModule) {
//    this.viewer.owner.editorModule.updateWholeListItems(paragraph);
//}
viewer.updateClientAreaForBlock(block,true);if(this.viewer instanceof WebLayoutViewer){block.containerWidget.height-=block.height;}this.documentHelper.layout.layoutBlock(block,0);viewer.updateClientAreaForBlock(block,false);}splittedWidget=nextBlock.getSplitWidgets();nextBlock=splittedWidget[splittedWidget.length-1].nextRenderedWidget;}if(!viewer.owner.isShiftingEnabled||this.documentHelper.blockToShift!==block){this.viewer.owner.editorModule.updateListItemsTillEnd(block,updateNextBlockList);}};/**
     * @private
     */Layout.prototype.updateClientAreaForLine=function(startLineWidget){startLineWidget.marginTop=0;//Clears the line widget starting from current line.
var top=this.documentHelper.selection.getTop(startLineWidget);var left=this.viewer.clientArea.x;this.viewer.cutFromTop(top);this.viewer.cutFromLeft(left);};Layout.prototype.getParentTable=function(block){var widget=block;while(widget.containerWidget){if(widget.containerWidget instanceof BlockContainer||widget.containerWidget instanceof TextFrame){return widget;}widget=widget.containerWidget;}return undefined;};// eslint-disable-next-line max-len
Layout.prototype.reLayoutParagraph=function(paragraphWidget,lineIndex,elementBoxIndex,isBidi,isSkip){if(paragraphWidget.containerWidget instanceof TextFrame&&paragraphWidget.containerWidget.containerShape.textWrappingStyle==='Inline'){lineIndex=paragraphWidget.containerWidget.containerShape.line.indexInOwner;paragraphWidget=paragraphWidget.containerWidget.containerShape.paragraph;}this.isRelayout=true;isBidi=sf.base.isNullOrUndefined(isBidi)?false:isBidi;this.isRelayout=true;if(this.documentHelper.blockToShift===paragraphWidget){this.layoutBodyWidgetCollection(paragraphWidget.index,paragraphWidget.containerWidget,paragraphWidget,false);this.isBidiReLayout=true;}else{if(this.isBidiReLayout){this.isBidiReLayout=false;}}// let isElementMoved: boolean = elementBoxIndex > 0;
if(paragraphWidget.isInsideTable){this.isBidiReLayout=true;this.reLayoutTable(paragraphWidget);// eslint-disable-next-line max-len
if(this.isFootnoteContentChanged&&!sf.base.isNullOrUndefined(paragraphWidget.bodyWidget)&&!sf.base.isNullOrUndefined(paragraphWidget.bodyWidget.page.footnoteWidget)){var foot=paragraphWidget.bodyWidget.page.footnoteWidget;this.layoutfootNote(foot);}this.isBidiReLayout=false;}else{// this.isRelayout = true;
this.reLayoutLine(paragraphWidget,lineIndex,isBidi,isSkip);}if(paragraphWidget.bodyWidget instanceof HeaderFooterWidget&&paragraphWidget.bodyWidget.headerFooterType.indexOf('Footer')!==-1){this.shiftFooterChildLocation(paragraphWidget.bodyWidget,this.viewer);}};Layout.prototype.getParentRow=function(block){var cell=block;while(cell.ownerTable!==null&&cell.ownerTable.isInsideTable){cell=cell.ownerTable.associatedCell;}return cell.ownerRow;};Layout.prototype.reLayoutRow=function(block){if(block instanceof ParagraphWidget){block=block.associatedCell;}var currentRow=this.getParentRow(block).getSplitWidgets()[0];if(!sf.base.isNullOrUndefined(currentRow)&&!currentRow.ownerTable.tableFormat.allowAutoFit){var currentTable=currentRow.ownerTable.getSplitWidgets()[0].combineWidget(this.viewer);var startRow=currentRow;while(this.isVerticalMergedCellContinue(startRow)){var previousRow=startRow.previousWidget;if(sf.base.isNullOrUndefined(previousRow)){break;}startRow=previousRow;}var bodyWidget=currentTable.containerWidget;if(this.viewer instanceof WebLayoutViewer){bodyWidget.height-=currentTable.height;}if((this.viewer.owner.enableHeaderAndFooter||block.isInHeaderFooter)&&!(bodyWidget instanceof TextFrame)){block.bodyWidget.isEmpty=false;bodyWidget.height-=currentTable.height;// eslint-disable-next-line max-len
this.viewer.updateHeaderFooterClientAreaWithTop(currentTable.bodyWidget.sectionFormat,this.documentHelper.isBlockInHeader(currentTable),bodyWidget.page);}else if(bodyWidget instanceof TextFrame){this.viewer.updateClientAreaForTextBoxShape(bodyWidget.containerShape,true);}else{this.viewer.updateClientArea(bodyWidget.sectionFormat,bodyWidget.page);}// eslint-disable-next-line max-len
var area=new Rect(this.viewer.clientArea.x,this.viewer.clientArea.y,this.viewer.clientArea.width,this.viewer.clientArea.height);var clientArea=new Rect(area.x,area.y,area.width,area.height);if(this.viewer.owner.isDocumentLoaded&&this.viewer.owner.editorModule){var block_3=this.documentHelper.selection.getFirstParagraphInFirstCell(currentTable);this.viewer.owner.editorModule.updateWholeListItems(block_3);}this.viewer.updateClientAreaForBlock(currentTable,true);this.viewer.cutFromTop(startRow.y);this.viewer.clientActiveArea.height=Number.POSITIVE_INFINITY;//Clear Hieght for all the content
currentTable.height=0;do{this.clearRowWidget(currentRow,true,true,true);this.layoutRow([currentTable],currentRow,true);if(startRow===currentRow){break;}startRow=startRow.nextRow;}while(startRow&&startRow!==currentRow);this.updateChildLocationForTable(currentTable.y,currentTable);this.viewer.clientArea=clientArea;this.viewer.clientActiveArea=new Rect(clientArea.x,clientArea.y,clientArea.width,clientArea.height);this.viewer.updateClientAreaForBlock(currentTable,true);currentTable.x-=currentTable.leftBorderWidth;currentTable.y-=currentTable.topBorderWidth;this.viewer.cutFromTop(currentTable.y);this.shiftTableWidget(currentTable,this.viewer,true);this.layoutNextItemsBlock(currentTable,this.viewer);}else{this.currentCell=block;this.reLayoutTable(block);this.currentCell=undefined;}};Layout.prototype.reLayoutTable=function(block,isFootnotRelayout){//Get Top level owner of block
var table=this.getParentTable(block);//Combine splitted table in to single table
var currentTable=table.combineWidget(this.viewer);var bodyWidget=currentTable.containerWidget;if(this.viewer instanceof WebLayoutViewer){bodyWidget.height-=currentTable.height;}if((this.viewer.owner.enableHeaderAndFooter||block.isInHeaderFooter)&&!(bodyWidget instanceof TextFrame)){block.bodyWidget.isEmpty=false;bodyWidget.height-=currentTable.height;// eslint-disable-next-line max-len
this.viewer.updateHeaderFooterClientAreaWithTop(table.bodyWidget.sectionFormat,this.documentHelper.isBlockInHeader(table),bodyWidget.page);}else if(bodyWidget instanceof TextFrame){this.viewer.updateClientAreaForTextBoxShape(bodyWidget.containerShape,true);}else{this.viewer.updateClientArea(bodyWidget.sectionFormat,bodyWidget.page);}//Clear Hieght for all the content
if(this.viewer.owner.isDocumentLoaded&&this.viewer.owner.editorModule){var block_4=this.documentHelper.selection.getFirstParagraphInFirstCell(currentTable);this.viewer.owner.editorModule.updateWholeListItems(block_4);}this.viewer.updateClientAreaForBlock(currentTable,true);//Remove border width
currentTable.x-=currentTable.leftBorderWidth;currentTable.y-=currentTable.topBorderWidth;//Update Client area for current position
var yPos=this.getYPosition(currentTable);this.viewer.cutFromTop(yPos);this.clearTableWidget(currentTable,true,true,true);this.isBidiReLayout=true;this.layoutBlock(currentTable,0);this.viewer.updateClientAreaForBlock(currentTable,false);this.layoutNextItemsBlock(currentTable,this.viewer,isFootnotRelayout);};Layout.prototype.getYPosition=function(table){if(table.wrapTextAround){var prevWidget=table.previousWidget;while(prevWidget){if(prevWidget instanceof ParagraphWidget){return prevWidget.y+prevWidget.height;}else if(prevWidget instanceof TableWidget){if(prevWidget.wrapTextAround){prevWidget=prevWidget.previousWidget;}else{return prevWidget.y+prevWidget.height;}}}return this.viewer.clientActiveArea.y;}return table.y;};Layout.prototype.clearTableWidget=function(table,clearPosition,clearHeight,clearGrid){table.height=0;if(clearGrid){table.isGridUpdated=false;}if(clearPosition){table.y=0;table.x=0;}for(var i=0;i<table.childWidgets.length;i++){var row=table.childWidgets[i];this.clearRowWidget(row,clearPosition,clearHeight,clearGrid);}};Layout.prototype.clearRowWidget=function(row,clearPosition,clearHeight,clearGrid){row.height=0;if(clearPosition){row.y=0;row.x=0;}for(var i=0;i<row.childWidgets.length;i++){var cell=row.childWidgets[i];this.clearCellWidget(cell,clearPosition,clearHeight,clearGrid);}};Layout.prototype.clearCellWidget=function(cell,clearPosition,clearHeight,clearGrid){cell.height=0;if(clearPosition){cell.y=0;cell.x=0;}for(var i=0;i<cell.childWidgets.length;i++){var block=cell.childWidgets[i];if(block instanceof ParagraphWidget){if(clearHeight){block.height=0;}}else{this.clearTableWidget(block,clearPosition,clearHeight,clearGrid);}}};// eslint-disable-next-line max-len
Layout.prototype.layoutBodyWidgetCollection=function(blockIndex,bodyWidget,block,shiftNextWidget,isSkipShifting){if(!sf.base.isNullOrUndefined(this.documentHelper.owner)&&this.documentHelper.owner.isLayoutEnabled){if(bodyWidget instanceof BlockContainer||bodyWidget instanceof TextFrame){var curretBlock=this.checkAndGetBlock(bodyWidget,blockIndex);if(sf.base.isNullOrUndefined(curretBlock)){return;}if(this.viewer instanceof WebLayoutViewer){curretBlock.containerWidget.height-=curretBlock.height;}if(bodyWidget instanceof HeaderFooterWidget){bodyWidget.isEmpty=false;this.viewer.updateHeaderFooterClientAreaWithTop(bodyWidget.sectionFormat,bodyWidget.headerFooterType.indexOf('Header')!==-1,bodyWidget.page);curretBlock.containerWidget.height-=curretBlock.height;}else if(bodyWidget instanceof TextFrame){this.viewer.updateClientAreaForTextBoxShape(bodyWidget.containerShape,true);}else if(bodyWidget instanceof FootNoteWidget){if(bodyWidget.footNoteType==='Footnote'){this.isRelayoutFootnote=true;this.viewer.updateClientArea(bodyWidget.sectionFormat,bodyWidget.page,true);this.viewer.clientArea.height=Number.POSITIVE_INFINITY;this.viewer.clientActiveArea.height=Number.POSITIVE_INFINITY;curretBlock.containerWidget.height-=curretBlock.height;this.viewer.clientActiveArea.y=curretBlock.containerWidget.y;}// curretBlock.containerWidget.height -= curretBlock.height;
}else{if(!sf.base.isNullOrUndefined(bodyWidget.page.footnoteWidget)){if(bodyWidget.page.footnoteWidget.footNoteType==='Footnote'){this.viewer.updateClientArea(bodyWidget.sectionFormat,bodyWidget.page,true);}else{this.viewer.updateClientArea(bodyWidget.sectionFormat,bodyWidget.page,true);}}else{this.viewer.updateClientArea(bodyWidget.sectionFormat,bodyWidget.page,true);}// if (bodyWidget.page.footnoteWidget) {
//     this.viewer.clientActiveArea.height -= bodyWidget.page.footnoteWidget.height;
//     this.viewer.clientArea.height -= bodyWidget.page.footnoteWidget.height;
// }
}if(blockIndex>0){var prevWidget=curretBlock.getSplitWidgets()[0].previousRenderedWidget;if(!(prevWidget instanceof ParagraphWidget)||prevWidget instanceof ParagraphWidget&&!prevWidget.isEndsWithPageBreak){this.viewer.cutFromTop(prevWidget.y+prevWidget.height);if(sf.base.isNullOrUndefined(isSkipShifting)&&curretBlock.containerWidget!==prevWidget.containerWidget){// eslint-disable-next-line max-len
var prevBodyWidget=curretBlock.containerWidget;var newBodyWidget=prevWidget.containerWidget;var footWidgets=this.getFootNoteWidgetsOf(curretBlock);this.updateContainerWidget(curretBlock,newBodyWidget,prevWidget.indexInOwner+1,false);this.moveFootNotesToPage(footWidgets,prevBodyWidget,newBodyWidget);}}else if(prevWidget instanceof ParagraphWidget&&prevWidget.isEndsWithPageBreak&&prevWidget.containerWidget===curretBlock.containerWidget){this.moveBlocksToNextPage(prevWidget);}}var currentParagraph=void 0;curretBlock=curretBlock.combineWidget(this.viewer);if(curretBlock instanceof TableWidget){this.clearTableWidget(curretBlock,true,true);curretBlock.isGridUpdated=false;currentParagraph=this.documentHelper.selection.getFirstParagraphInFirstCell(curretBlock);}else{currentParagraph=curretBlock;}if(this.viewer.owner.isDocumentLoaded&&this.viewer.owner.editorModule){this.viewer.owner.editorModule.updateWholeListItems(currentParagraph);}this.viewer.updateClientAreaForBlock(curretBlock,true);this.documentHelper.layout.layoutBlock(curretBlock,0);this.viewer.updateClientAreaForBlock(curretBlock,false);if(shiftNextWidget){this.shiftNextWidgets(curretBlock);}else{this.layoutNextItemsBlock(curretBlock,this.viewer);}}else if(bodyWidget instanceof TableCellWidget){// eslint-disable-next-line max-len
var table=this.documentHelper.layout.getParentTable(bodyWidget.ownerTable).getSplitWidgets()[0];this.reLayoutTable(bodyWidget.ownerTable);this.layoutNextItemsBlock(table,this.viewer);}}this.isRelayoutFootnote=false;};Layout.prototype.checkAndGetBlock=function(containerWidget,blockIndex){if(containerWidget instanceof TextFrame){return containerWidget.childWidgets[blockIndex];}else{var sectionIndex=containerWidget.index;while(containerWidget&&containerWidget.index===sectionIndex){if(containerWidget.childWidgets.length>0&&containerWidget.firstChild.index<=blockIndex&&containerWidget.lastChild.index>=blockIndex){for(var i=0;i<containerWidget.childWidgets.length;i++){var block=containerWidget.childWidgets[i];if(block.index===blockIndex){return block;}}}if(containerWidget instanceof BodyWidget){containerWidget=containerWidget.nextRenderedWidget;}else{break;}}}return undefined;};//#endregion
//#region Table
Layout.prototype.layoutTable=function(table,startIndex){table.isBidiTable=table.bidi;if(!table.isGridUpdated){table.buildTableColumns();table.isGridUpdated=true;}if(this.documentHelper.compatibilityMode!=='Word2013'){this.viewer.clientActiveArea.x=this.viewer.clientActiveArea.x-HelperMethods.convertPointToPixel(table.firstChild.firstChild.leftMargin);}var tableView=[table];this.addTableWidget(this.viewer.clientActiveArea,tableView);this.viewer.updateClientAreaTopOrLeft(table,true);var clientActiveAreaForTableWrap;var clientAreaForTableWrap;var wrapDiff=0;if(table.wrapTextAround){clientActiveAreaForTableWrap=this.viewer.clientActiveArea.clone();clientAreaForTableWrap=this.viewer.clientArea.clone();this.updateTableFloatPoints(table);var clienactare=this.viewer.clientActiveArea.clone();var rect=this.adjustClientAreaBasedOnTextWrapForTable(table,this.viewer.clientActiveArea);if(clienactare.x!==rect.x){table.x=this.viewer.clientActiveArea.x;}}else{this.adjustClientAreaBasedOnTextWrapForTable(table,this.viewer.clientActiveArea);if(this.isWrapText){wrapDiff=this.viewer.clientActiveArea.x-this.viewer.clientArea.x;this.isWrapText=false;table.x=this.viewer.clientActiveArea.x;}}var isHeader=table.childWidgets[0].rowFormat.isHeader;if(table.childWidgets.length>0){table.header=isHeader;table.continueHeader=isHeader;table.headerHeight=0;}var row=table.childWidgets[startIndex];while(row){row=this.layoutRow(tableView,row);row=row.nextRow;}if(this.documentHelper.viewer instanceof PageLayoutViewer&&table.wrapTextAround&&(table.positioning.verticalAlignment==='Bottom'||table.positioning.verticalAlignment==='Center'||table.positioning.verticalAlignment==='Outside')){this.updateTableFloatPoints(table);this.updateChildLocationForTable(table.y,table);}this.updateWidgetsToPage(tableView,[],table);if(wrapDiff>0){this.viewer.clientArea.x=this.viewer.clientArea.x-wrapDiff;}if(table.wrapTextAround&&!table.isInsideTable&&table.bodyWidget){if(tableView.length==1){if(table.bodyWidget.floatingElements.indexOf(table)===-1){table.bodyWidget.floatingElements.push(table);}if(!sf.base.isNullOrUndefined(table.previousWidget)||table.isInHeaderFooter){this.viewer.clientActiveArea=clientActiveAreaForTableWrap.clone();this.viewer.clientArea=clientAreaForTableWrap.clone();}else{this.viewer.updateClientArea(table.bodyWidget.sectionFormat,table.bodyWidget.page);}}else{this.documentHelper.tableLefts.pop();this.viewer.updateClientArea(table.bodyWidget.sectionFormat,table.bodyWidget.page);for(var z=0;z<tableView.length;z++){var bodyWidget=tableView[z].bodyWidget;if(!sf.base.isNullOrUndefined(bodyWidget)&&bodyWidget.floatingElements.indexOf(tableView[z])===-1){bodyWidget.floatingElements.push(tableView[z]);}}}}tableView[tableView.length-1].isLayouted=true;if(this.documentHelper.compatibilityMode!=='Word2013'){this.viewer.clientArea.x=this.viewer.clientArea.x+HelperMethods.convertPointToPixel(table.firstChild.firstChild.leftMargin);}return tableView[tableView.length-1];};Layout.prototype.addTableWidget=function(area,table,create){var tableWidget=table[table.length-1];if(create){tableWidget=this.createTableWidget(tableWidget);table.push(tableWidget);}tableWidget.width=area.width;tableWidget.x=area.x;tableWidget.y=area.y;//Update the table height of tableWidget when cell spacing has been defined.
if(tableWidget.tableFormat.cellSpacing>0){tableWidget.height=tableWidget.height+HelperMethods.convertPointToPixel(tableWidget.tableFormat.cellSpacing);if(!tableWidget.isBidiTable){// eslint-disable-next-line max-len
tableWidget.leftBorderWidth=HelperMethods.convertPointToPixel(this.getTableLeftBorder(tableWidget.tableFormat.borders).getLineWidth());// eslint-disable-next-line max-len
tableWidget.rightBorderWidth=HelperMethods.convertPointToPixel(this.getTableRightBorder(tableWidget.tableFormat.borders).getLineWidth());}else{// Right to left direction table.
// eslint-disable-next-line max-len
tableWidget.leftBorderWidth=HelperMethods.convertPointToPixel(this.getTableRightBorder(tableWidget.tableFormat.borders).getLineWidth());// eslint-disable-next-line max-len
tableWidget.rightBorderWidth=HelperMethods.convertPointToPixel(this.getTableLeftBorder(tableWidget.tableFormat.borders).getLineWidth());}// eslint-disable-next-line max-len
tableWidget.topBorderWidth=HelperMethods.convertPointToPixel(this.getTableTopBorder(tableWidget.tableFormat.borders).getLineWidth());// eslint-disable-next-line max-len
tableWidget.bottomBorderWidth=HelperMethods.convertPointToPixel(this.getTableBottomBorder(tableWidget.tableFormat.borders).getLineWidth());tableWidget.x+=tableWidget.leftBorderWidth;tableWidget.y+=tableWidget.topBorderWidth;tableWidget.width-=tableWidget.leftBorderWidth;tableWidget.width-=tableWidget.rightBorderWidth;tableWidget.height+=tableWidget.bottomBorderWidth;}return tableWidget;};Layout.prototype.updateWidgetsToPage=function(tables,rows,table,endRowWidget){var viewer=this.viewer;var tableWidget=tables[tables.length-1];if(!table.isInsideTable){for(var i=0;i<tables.length;i++){this.updateHeightForTableWidget(tables,rows,tables[i],endRowWidget);}if(tableWidget.childWidgets.length>0&&tableWidget.y!==tableWidget.childWidgets[0].y){tableWidget.y=tableWidget.childWidgets[0].y;}// Need to update on this further
//Adds the table widget to owner cell widget.
// (viewer.renderedElements.get(table.associatedCell)[viewer.renderedElements.get(table.associatedCell).length - 1] as TableCellWidget).childWidgets.push(tableWidget);
// tableWidget.containerWidget = viewer.renderedElements.get(table.associatedCell)[viewer.renderedElements.get(table.associatedCell).length - 1] as BodyWidget;
// (viewer.renderedElements.get(table.associatedCell)[viewer.renderedElements.get(table.associatedCell).length - 1] as TableCellWidget).height = (viewer.renderedElements.get(table.associatedCell)[viewer.renderedElements.get(table.associatedCell).length - 1] as TableCellWidget).height + tableWidget.height;
}if(table.tableFormat.cellSpacing>0){// eslint-disable-next-line max-len
if(tableWidget.y+tableWidget.height+HelperMethods.convertPointToPixel(table.tableFormat.cellSpacing)>viewer.clientArea.bottom&&viewer instanceof WebLayoutViewer){//update the table height when split to next page. Which is equivalent Ms Word Behaviour.
//In Ms Word if the Table Split to next page the bottom spacing of the table will be half of the current spacing.
//And the Remaining space will be used in next page top of the table.
tableWidget.height=tableWidget.height-HelperMethods.convertPointToPixel(table.tableFormat.cellSpacing)/2;}//Update the current Y position of current clientactivearea.
viewer.cutFromTop(tableWidget.y+tableWidget.height);}if(this.viewer instanceof WebLayoutViewer){table.containerWidget.height+=table.height;}if(table.bodyWidget instanceof HeaderFooterWidget){table.containerWidget.height+=table.height;if(this.viewer.owner.enableHeaderAndFooter&&table.bodyWidget.headerFooterType.indexOf('Footer')!==-1){this.shiftFooterChildLocation(table.bodyWidget,this.viewer);}}};// eslint-disable-next-line max-len
Layout.prototype.updateHeightForTableWidget=function(tables,rows,tableWidget,endRowWidget){for(var i=0;i<tableWidget.childWidgets.length;i++){var rowWidget=tableWidget.childWidgets[i];if(rowWidget===endRowWidget){break;}this.updateHeightForRowWidget(this.viewer,true,tables,rows,rowWidget,true,endRowWidget);}};//#endregion
//#region Row
Layout.prototype.layoutRow=function(tableWidget,row,isRowLayout){var viewer=this.viewer;var rowWidgets=[row];this.addTableRowWidget(viewer.clientActiveArea,rowWidgets);viewer.updateClientAreaForRow(row,true);var topMargin=this.getMaxTopCellMargin(row);var bottomMargin=this.getMaxBottomCellMargin(row);for(var i=0;i<row.childWidgets.length;i++){var cell=row.childWidgets[i];this.layoutCell(cell,topMargin+row.topBorderWidth,bottomMargin+row.bottomBorderWidth);}viewer.updateClientAreaForRow(row,false);var rows=[row];if(!isRowLayout){this.updateWidgetsToTable(tableWidget,rows,row);}return rows[rows.length-1];};Layout.prototype.getAdjacentRowCell=function(cell,cellStartPos,cellEndPos,rowIndex){var adjCells=[];var adjRow=cell.ownerRow.ownerTable.childWidgets[rowIndex];var previouRow=false;if(adjRow){if(adjRow.childWidgets[0].x>cell.x&&rowIndex!==0){adjRow=cell.ownerRow.ownerTable.childWidgets[rowIndex-1];previouRow=true;}for(var i=0;i<adjRow.childWidgets.length;i++){var adjCell=adjRow.childWidgets[i];var adjCellStartPos=adjCell.x-adjCell.margin.left;var adjCellEndPos=adjCell.x+adjCell.width+adjCell.margin.right;// eslint-disable-next-line max-len
if(HelperMethods.round(adjCellEndPos,2)>HelperMethods.round(cellStartPos,2)&&HelperMethods.round(adjCellEndPos,2)<=HelperMethods.round(cellEndPos,2)||// eslint-disable-next-line max-len
HelperMethods.round(adjCellStartPos,2)>=HelperMethods.round(cellStartPos,2)&&HelperMethods.round(adjCellStartPos,2)<HelperMethods.round(cellEndPos,2)// eslint-disable-next-line max-len
||HelperMethods.round(adjCellStartPos,2)<=HelperMethods.round(cellStartPos,2)&&HelperMethods.round(adjCellEndPos,2)>=HelperMethods.round(cellEndPos,2)){//Skipped adding the Horizontal merge start cell multiple times.
if(adjCells.indexOf(adjCell)===-1){adjCells.push(adjCell);}}if(HelperMethods.round(adjCellEndPos,2)>=HelperMethods.round(cellEndPos,2)){if(previouRow){adjRow=cell.ownerRow.ownerTable.childWidgets[rowIndex];previouRow=false;}else{break;}}if(i===adjRow.childWidgets.length-1&&previouRow){adjRow=cell.ownerRow.ownerTable.childWidgets[rowIndex];previouRow=false;}}}return adjCells;};Layout.prototype.addTableRowWidget=function(area,row){var rowWidget=row[row.length-1];if((rowWidget.rowFormat.beforeWidth!==0||rowWidget.rowFormat.gridBeforeWidth!==0)&&(this.documentHelper.alignTablesRowByRow?rowWidget.ownerTable.tableFormat.tableAlignment==='Left':true)){rowWidget.x+=rowWidget.rowFormat.beforeWidth!==0?rowWidget.rowFormat.beforeWidth:rowWidget.rowFormat.gridBeforeWidth;}else{rowWidget.x=area.x;}rowWidget.y=area.y;rowWidget.width=area.width;var borderWidth=0;if(!sf.base.isNullOrUndefined(rowWidget.ownerTable)&&!sf.base.isNullOrUndefined(rowWidget.ownerTable.tableFormat)&&rowWidget.ownerTable.tableFormat.cellSpacing>0){rowWidget.height=rowWidget.height+HelperMethods.convertPointToPixel(rowWidget.ownerTable.tableFormat.cellSpacing);//Update the table height with the border width to layout the border when the cell spacing is defined..
for(var j=0;j<rowWidget.childWidgets.length;j++){if(!sf.base.isNullOrUndefined(rowWidget.childWidgets[j].cellFormat)&&!sf.base.isNullOrUndefined(rowWidget.childWidgets[j].cellFormat.borders)){// eslint-disable-next-line max-len
var width=TableCellWidget.getCellBottomBorder(rowWidget.childWidgets[j]).getLineWidth();if(width>borderWidth){borderWidth=width;}}}//Maximum border width is calculated and hold it in a variable to add with the padding of the cells.
rowWidget.bottomBorderWidth=HelperMethods.convertPointToPixel(borderWidth);if(rowWidget.index>0&&!sf.base.isNullOrUndefined(rowWidget.previousWidget)){var prevRow=rowWidget.previousWidget;borderWidth=0;for(var i=0;i<prevRow.childWidgets.length;i++){// eslint-disable-next-line max-len
if(!sf.base.isNullOrUndefined(prevRow.childWidgets[i].cellFormat)&&!sf.base.isNullOrUndefined(prevRow.childWidgets[i].cellFormat.borders)){// eslint-disable-next-line max-len
var value=TableCellWidget.getCellBottomBorder(prevRow.childWidgets[i]).getLineWidth();if(value>borderWidth){borderWidth=value;}}}//Maximum border width is calculated and hold it in a variable to add with the padding of the cells.
rowWidget.topBorderWidth=HelperMethods.convertPointToPixel(borderWidth);}}if(!sf.base.isNullOrUndefined(rowWidget.childWidgets)){for(var i=0;i<rowWidget.childWidgets.length;i++){// eslint-disable-next-line max-len
if(!sf.base.isNullOrUndefined(rowWidget.childWidgets[i].cellFormat)&&!sf.base.isNullOrUndefined(rowWidget.childWidgets[i].cellFormat.borders)){// eslint-disable-next-line max-len
var topBorderWidth=TableCellWidget.getCellTopBorder(rowWidget.childWidgets[i]).getLineWidth();if(topBorderWidth>borderWidth){borderWidth=topBorderWidth;}}}}//Maximum border width is calculated and hold it in a variable to add with the padding of the cells.
rowWidget.topBorderWidth=HelperMethods.convertPointToPixel(borderWidth);//Update the table height of tableWidget when cell spacing has been defined.
// eslint-disable-next-line max-len
if(!sf.base.isNullOrUndefined(rowWidget.ownerTable)&&!sf.base.isNullOrUndefined(rowWidget.ownerTable.tableFormat)&&rowWidget.ownerTable.tableFormat.cellSpacing<=0&&rowWidget.rowIndex===rowWidget.ownerTable.childWidgets.length-1){// Update the bottom width for last row .
for(var i=0;i<rowWidget.childWidgets.length;i++){// eslint-disable-next-line max-len
if(!sf.base.isNullOrUndefined(rowWidget.childWidgets[i].cellFormat)&&!sf.base.isNullOrUndefined(rowWidget.childWidgets[i].cellFormat.borders)){// eslint-disable-next-line max-len
var bottomBorderWidth=TableCellWidget.getCellBottomBorder(rowWidget.childWidgets[i]).getLineWidth();if(bottomBorderWidth>borderWidth){borderWidth=bottomBorderWidth;}}}//Maximum border width is calculated and hold it in a variable to add with the padding of the cells.
rowWidget.bottomBorderWidth=HelperMethods.convertPointToPixel(borderWidth);}//tableRowWidget.ownerWidget = owner;
return rowWidget;};Layout.prototype.getMaxTopCellMargin=function(row){if(sf.base.isNullOrUndefined(row.childWidgets)){return 0;}var value=0;for(var i=0;i<row.childWidgets.length;i++){var cell=row.childWidgets[i];var topMargin=0;if(cell.cellFormat.hasValue('topMargin')){topMargin=HelperMethods.convertPointToPixel(cell.cellFormat.topMargin);}else if(row.rowFormat.hasValue('topMargin')){topMargin=HelperMethods.convertPointToPixel(row.rowFormat.topMargin);}else{topMargin=HelperMethods.convertPointToPixel(row.ownerTable.tableFormat.topMargin);}if(topMargin>value){value=topMargin;}}return value;};Layout.prototype.getMaxBottomCellMargin=function(row){if(sf.base.isNullOrUndefined(row.childWidgets)){return 0;}var value=0;for(var i=0;i<row.childWidgets.length;i++){var cell=row.childWidgets[i];var bottomMargin=0;if(cell.cellFormat.hasValue('bottomMargin')){bottomMargin=HelperMethods.convertPointToPixel(cell.cellFormat.bottomMargin);}else if(row.rowFormat.hasValue('bottomMargin')){bottomMargin=HelperMethods.convertPointToPixel(row.rowFormat.bottomMargin);}else{bottomMargin=HelperMethods.convertPointToPixel(row.ownerTable.tableFormat.bottomMargin);}if(bottomMargin>value){value=bottomMargin;}}return value;};//#endregion Row
//#region cell
Layout.prototype.layoutCell=function(cell,maxCellMarginTop,maxCellMarginBottom){var viewer=this.viewer;this.addTableCellWidget(cell,viewer.clientActiveArea,maxCellMarginTop,maxCellMarginBottom);this.updateTopBorders(cell);viewer.updateClientAreaForCell(cell,true);if(cell.childWidgets.length===0){var paragraphWidget=new ParagraphWidget();paragraphWidget.characterFormat=new WCharacterFormat();paragraphWidget.paragraphFormat=new WParagraphFormat();paragraphWidget.index=0;var lineWidget=new LineWidget(paragraphWidget);paragraphWidget.childWidgets.push(lineWidget);cell.childWidgets.push(paragraphWidget);}for(var i=0;i<cell.childWidgets.length;i++){var block=cell.childWidgets[i];viewer.updateClientAreaForBlock(block,true);block.containerWidget=cell;this.layoutBlock(block,0);viewer.updateClientAreaForBlock(block,false);for(var k=0;k<block.childWidgets.length;k++){if(block.childWidgets[k]instanceof LineWidget){// eslint-disable-next-line
var line=block.childWidgets[k];for(var j=0;j<line.children.length;j++){var child=line.children[j];if(child instanceof FootnoteElementBox&&!sf.base.isNullOrUndefined(cell.bodyWidget.page.footnoteWidget)){this.footHeight=cell.bodyWidget.page.footnoteWidget.height;this.isTableFootNote=true;break;}else{this.footHeight=0;}}}}}this.updateWidgetToRow(cell);viewer.updateClientAreaForCell(cell,false);};Layout.prototype.updateTopBorders=function(cell){cell.updatedTopBorders=[];if(cell.ownerTable.tableFormat.cellSpacing===0){var cellTopBorder=cell.cellFormat.borders.top;if(!cellTopBorder.isBorderDefined||cellTopBorder.isBorderDefined&&cellTopBorder.lineStyle==='None'&&cellTopBorder.lineWidth===0&&cellTopBorder.hasValue('color')){cellTopBorder=cell.ownerRow.rowFormat.borders.horizontal;}if(!cellTopBorder.isBorderDefined){cellTopBorder=cell.ownerRow.ownerTable.tableFormat.borders.horizontal;}var cellStartPos=cell.x-cell.margin.left;var cellEndPos=cell.x+cell.width+cell.margin.right;var adjCells=this.getAdjacentRowCell(cell,cellStartPos,cellEndPos,cell.ownerRow.indexInOwner-1);for(var j=0;j<adjCells.length;j++){var adjCell=adjCells[j];var prevCellBottomBorder=adjCell.cellFormat.borders.bottom;if(!prevCellBottomBorder.isBorderDefined||prevCellBottomBorder.isBorderDefined&&prevCellBottomBorder.lineStyle==='None'&&prevCellBottomBorder.lineWidth===0&&prevCellBottomBorder.hasValue('color')){prevCellBottomBorder=adjCell.ownerRow.rowFormat.borders.horizontal;}if(!prevCellBottomBorder.isBorderDefined){prevCellBottomBorder=adjCell.ownerRow.ownerTable.tableFormat.borders.horizontal;}var border=void 0;if(cellTopBorder.lineStyle==='None'||cellTopBorder.lineStyle==='Cleared'){border=prevCellBottomBorder;}else if(prevCellBottomBorder.lineStyle==='Cleared'||prevCellBottomBorder.lineStyle==='None'){border=cellTopBorder;}else{border=cell.getBorderBasedOnPriority(cellTopBorder,prevCellBottomBorder);}var adjCellStartPos=adjCell.x-adjCell.margin.left;var adjCellEndPos=adjCell.x+adjCell.width+adjCell.margin.right;if(j===0&&cellStartPos<adjCellStartPos){cell.updatedTopBorders.push({border:cellTopBorder,width:adjCellStartPos-cellStartPos});}if(border){var width=0;// eslint-disable-next-line max-len
if(HelperMethods.round(adjCellEndPos,2)===HelperMethods.round(cellEndPos,2)&&HelperMethods.round(adjCellStartPos,2)===HelperMethods.round(cellStartPos,2)){width=cellEndPos-cellStartPos;// eslint-disable-next-line max-len
}else if(HelperMethods.round(adjCellStartPos,2)>=HelperMethods.round(cellStartPos,2)&&HelperMethods.round(adjCellEndPos,2)>=HelperMethods.round(cellEndPos,2)){width=cellEndPos-adjCellStartPos;// eslint-disable-next-line max-len
}else if(HelperMethods.round(adjCellStartPos,2)>=HelperMethods.round(cellStartPos,2)&&HelperMethods.round(adjCellEndPos,2)<=HelperMethods.round(cellEndPos,2)){width=adjCellEndPos-adjCellStartPos;// eslint-disable-next-line max-len
}else if(HelperMethods.round(adjCellStartPos,2)<=HelperMethods.round(cellStartPos,2)&&HelperMethods.round(adjCellEndPos,2)<=HelperMethods.round(cellEndPos,2)){width=adjCellEndPos-cellStartPos;// eslint-disable-next-line max-len
}else if(HelperMethods.round(adjCellStartPos,2)<=HelperMethods.round(cellStartPos,2)&&HelperMethods.round(adjCellEndPos,2)>=HelperMethods.round(cellEndPos,2)){width=cellEndPos-cellStartPos;}else{width=cellEndPos-cellStartPos;}if(width<0){width=0;}cell.updatedTopBorders.push({border:border,width:width});}if(j===adjCells.length-1&&cellEndPos>adjCellEndPos){cell.updatedTopBorders.push({border:cellTopBorder,width:cellEndPos-adjCellEndPos});}}}};//endregion cell
//#region Shifting
Layout.prototype.shiftLayoutedItems=function(reLayout){if(sf.base.isNullOrUndefined(this.documentHelper.blockToShift)||sf.base.isNullOrUndefined(this.documentHelper.blockToShift.containerWidget)){this.documentHelper.blockToShift=undefined;return;}var block=this.documentHelper.blockToShift;var sectionIndex=block.bodyWidget.index;this.reLayoutOrShiftWidgets(block,this.viewer);var updateNextBlockList=true;// If flow layout, then all sections are in single page. Hence need to update till last block of last section.
// Todo: For page layout and section break continuous, need to handle the same.
var splittedWidget=block.getSplitWidgets();var nextBlock=splittedWidget[splittedWidget.length-1].nextRenderedWidget;while(nextBlock instanceof BlockWidget&&nextBlock.bodyWidget.index===sectionIndex){var currentWidget=undefined;var blocks=block.getSplitWidgets();currentWidget=blocks[blocks.length-1];block=nextBlock;updateNextBlockList=false;var nextWidget=undefined;blocks=block.getSplitWidgets();if(block instanceof ParagraphWidget){nextWidget=blocks[0];}else{if(block instanceof TableWidget){nextWidget=blocks[0];}}if(currentWidget.containerWidget===nextWidget.containerWidget&&HelperMethods.round(nextWidget.y,2)===HelperMethods.round(this.viewer.clientActiveArea.y,2)&&sf.base.isNullOrUndefined(nextWidget.nextWidget)){break;}if(!sf.base.isNullOrUndefined(currentWidget.floatingElements)){//this.shiftLayoutFloatingItems(currentWidget as ParagraphWidget);
}updateNextBlockList=true;this.reLayoutOrShiftWidgets(block,this.viewer);splittedWidget=block.getSplitWidgets();nextBlock=splittedWidget[splittedWidget.length-1].nextRenderedWidget;}if(this.viewer.owner.editorModule){this.viewer.owner.editorModule.updateListItemsTillEnd(block,updateNextBlockList);}this.documentHelper.blockToShift=undefined;var viewer=this.viewer;// if (viewer instanceof PageLayoutViewer) {
this.documentHelper.removeEmptyPages();this.updateFieldElements();// if (!this.documentHelper.owner.enableLockAndEdit || !reLayout) {
this.viewer.updateScrollBars();// }
// }
};Layout.prototype.updateFieldElements=function(){for(var i=0;i<this.documentHelper.fields.length;i++){var fieldBegin=this.documentHelper.fields[i];if(!sf.base.isNullOrUndefined(this.documentHelper.selection)){var fieldCode=this.documentHelper.selection.getFieldCode(fieldBegin);if(!sf.base.isNullOrUndefined(fieldCode)&&(fieldCode.toLowerCase().match('numpages')||fieldCode.toLowerCase().match('sectionpages'))&&!sf.base.isNullOrUndefined(fieldBegin.fieldSeparator)){var textElement=fieldBegin.fieldSeparator.nextNode;if(!sf.base.isNullOrUndefined(textElement)){var prevPageNum=textElement.text;textElement.text=this.documentHelper.pages.length.toString();var paragraph=fieldBegin.line.paragraph;if(!sf.base.isNullOrUndefined(paragraph.bodyWidget)&&!sf.base.isNullOrUndefined(paragraph.bodyWidget.page)&&prevPageNum!==textElement.text){var lineIndex=paragraph.childWidgets.indexOf(fieldBegin.line);var elementIndex=fieldBegin.line.children.indexOf(textElement);this.reLayoutParagraph(paragraph,lineIndex,elementIndex);}}}}}};Layout.prototype.reLayoutOrShiftWidgets=function(blockAdv,viewer){var block=blockAdv;// if (block instanceof ParagraphWidget) {
//     reLayoutItems = viewer.renderedElements.get(block as ParagraphWidget).length === 0;
// } else {
//     reLayoutItems = viewer.renderedElements.get(block as TableWidget).length === 0;
// }
if(this.isNeedToRelayout(blockAdv.bodyWidget)){this.updateContainerForTable(block,viewer);//Handle layouting the block.
if(block instanceof TableWidget){block=block.combineWidget(this.viewer);this.clearTableWidget(block,true,true,true);}viewer.updateClientAreaForBlock(block,true);this.layoutBlock(block,0);viewer.updateClientAreaForBlock(block,false);}else{//Handled to check client area and shift layouted widget.
this.shiftWidgetsBlock(block,viewer);}var index=this.documentHelper.pages.indexOf(block.bodyWidget.page);if(index>0&&block===block.bodyWidget.childWidgets[0]&&block instanceof ParagraphWidget){var val=block.bodyWidget.childWidgets[0].childWidgets[0].children;for(var i=0;i<val.length;i++){var element=val[i];if(element.margin.top>0&&element.margin.top===this.getBeforeSpacing(element.paragraph)){element.margin.top-=this.getBeforeSpacing(element.paragraph);}}}//Updates the list value of the rendered paragraph.
if(this.viewer.owner.editorModule){this.viewer.owner.editorModule.updateRenderedListItems(block);}if(!this.isRelayoutFootnote&&block.bodyWidget.page.footnoteWidget){this.layoutfootNote(block.bodyWidget.page.footnoteWidget);}if(!(block.bodyWidget instanceof FootNoteWidget)&&!this.isRelayoutFootnote&&block.bodyWidget.page.endnoteWidget){this.layoutfootNote(block.bodyWidget.page.endnoteWidget);}// }
};Layout.prototype.isNeedToRelayout=function(bodyWidget){for(var i=0;i<bodyWidget.floatingElements.length;i++){var floatElement=bodyWidget.floatingElements[i];if(floatElement instanceof TableWidget||floatElement instanceof ShapeBase&&(floatElement.textWrappingStyle==='Square'||floatElement.textWrappingStyle==='TopAndBottom')){return true;}else{return false;}}return false;};Layout.prototype.shiftWidgetsBlock=function(block,viewer){if(block instanceof ParagraphWidget){this.shiftWidgetsForPara(block,viewer);}else if(block instanceof TableWidget){this.shiftWidgetsForTable(block,viewer);}};Layout.prototype.shiftWidgetsForPara=function(paragraph,viewer){if(paragraph.height>viewer.clientArea.height+viewer.clientArea.y){return;}var prevBodyObj=this.getBodyWidgetOfPreviousBlock(paragraph,0);var prevBodyWidget=prevBodyObj.bodyWidget;var index=prevBodyObj.index;var prevWidget=undefined;for(var i=0;i<paragraph.getSplitWidgets().length;i++){var widget=paragraph.getSplitWidgets()[i];if(!sf.base.isNullOrUndefined(prevWidget)){var isPageBreak=prevWidget.lastChild?prevWidget.lastChild.isEndsWithPageBreak:false;this.shiftToPreviousWidget(widget,viewer,prevWidget,isPageBreak);if((sf.base.isNullOrUndefined(widget.childWidgets)||widget.childWidgets.length===0)&&!isPageBreak){i--;continue;}prevWidget=undefined;if(prevBodyWidget!==widget.containerWidget){prevBodyWidget=widget.containerWidget;if(isPageBreak){viewer.updateClientAreaByWidget(widget);}}}//let isContainsFootnote: boolean = false;
var footWidget=this.getFootNoteWidgetsOf(widget);if(this.isFitInClientArea(widget,viewer,footWidget)){if(this.keepWithNext){this.updateClientPositionForBlock(widget.containerWidget.firstChild,widget);this.keepWithNext=false;}//Check whether this widget is moved to previous container widget.
prevWidget=widget;widget.y=viewer.clientActiveArea.y;if(widget.floatingElements.length>0){for(var k=0;k<widget.floatingElements.length;k++){var shape=widget.floatingElements[k];var position=this.getFloatingItemPoints(shape);shape.y=position.y;shape.x=position.x;if(shape instanceof ShapeElementBox){this.updateChildLocationForCellOrShape(shape.y,shape);}}}viewer.cutFromTop(viewer.clientActiveArea.y+widget.height);//Moves the paragraph widget to previous body widget.
if(!sf.base.isNullOrUndefined(prevBodyWidget)&&prevBodyWidget!==widget.containerWidget){index++;if(!prevBodyWidget.lastChild.isEndsWithPageBreak){this.updateContainerWidget(widget,prevBodyWidget,index,true);}if(footWidget.length>0){if(prevBodyWidget.page.footnoteWidget){for(var k=0;k<footWidget.length;k++){prevBodyWidget.page.footnoteWidget.childWidgets.push(footWidget[k]);prevBodyWidget.page.footnoteWidget.height+=footWidget[k].height;}}}}if(widget.isEndsWithPageBreak&&this.viewer instanceof PageLayoutViewer){var nextBodyWidget=this.createOrGetNextBodyWidget(prevBodyWidget,this.viewer);nextBodyWidget=this.moveBlocksToNextPage(widget);viewer.updateClientArea(nextBodyWidget.sectionFormat,nextBodyWidget.page);}}else{var previousBlock=widget.previousRenderedWidget;var isPageBreak=false;if(previousBlock instanceof ParagraphWidget&&previousBlock.isEndsWithPageBreak&&this.viewer instanceof PageLayoutViewer){isPageBreak=true;}var isSplittedToNewPage=this.splitWidget(widget,viewer,prevBodyWidget,index+1,isPageBreak,footWidget);prevWidget=undefined;if(prevBodyWidget!==widget.containerWidget){prevBodyWidget=widget.containerWidget;i--;}index=prevBodyWidget.childWidgets.indexOf(widget);if(isSplittedToNewPage){prevBodyWidget=paragraph.getSplitWidgets()[i+1].containerWidget;}}}};/**
     * @private
     * @param widget
     * @returns
     */Layout.prototype.getFootNotesOfBlock=function(widget){var footnoteElements=[];if(widget.childWidgets.length>0){for(var j=0;j<this.documentHelper.footnoteCollection.length;j++){if(this.documentHelper.footnoteCollection[j].line.paragraph===widget){//isContainsFootnote = true;
footnoteElements.push(this.documentHelper.footnoteCollection[j]);}}}return footnoteElements;};Layout.prototype.getFootNotesWidgetsInLine=function(line){var footnoteElements=[];for(var i=0;i<line.children.length;i++){var element=line.children[i];if(element instanceof FootnoteElementBox){footnoteElements.push(element);}}return this.getFootNoteWidgetsBy(line.paragraph,footnoteElements);};Layout.prototype.getFootNoteWidgetsBy=function(widget,footnoteElements){var footWidgets=[];if(widget.bodyWidget.page.footnoteWidget){for(var i=0;i<widget.bodyWidget.page.footnoteWidget.childWidgets.length;i++){// eslint-disable-next-line max-len
for(var j=0;j<footnoteElements.length;j++){if(widget.bodyWidget.page.footnoteWidget.childWidgets[i].footNoteReference===footnoteElements[j]){footWidgets.push(widget.bodyWidget.page.footnoteWidget.childWidgets[i]);}}}}if(!sf.base.isNullOrUndefined(widget.previousRenderedWidget)&&widget.previousRenderedWidget.bodyWidget.page.footnoteWidget){for(var i=0;i<widget.previousRenderedWidget.bodyWidget.page.footnoteWidget.childWidgets.length;i++){// eslint-disable-next-line max-len
for(var j=0;j<footnoteElements.length;j++){if(widget.previousRenderedWidget.bodyWidget.page.footnoteWidget.childWidgets[i].footNoteReference===footnoteElements[j]){footWidgets.push(widget.previousRenderedWidget.bodyWidget.page.footnoteWidget.childWidgets[i]);}}}}else if(!sf.base.isNullOrUndefined(widget.bodyWidget.previousRenderedWidget)&&widget.bodyWidget.previousRenderedWidget.page.footnoteWidget){for(var i=0;i<widget.bodyWidget.previousRenderedWidget.page.footnoteWidget.childWidgets.length;i++){// eslint-disable-next-line max-len
for(var j=0;j<footnoteElements.length;j++){if(widget.bodyWidget.previousRenderedWidget.page.footnoteWidget.childWidgets[i].footNoteReference===footnoteElements[j]){footWidgets.push(widget.bodyWidget.previousRenderedWidget.page.footnoteWidget.childWidgets[i]);}}}}return footWidgets;};/**
     * @private
     */Layout.prototype.getFootNoteWidgetsOf=function(widget){var footnoteElements=this.getFootNotesOfBlock(widget);var footnoteWidgets=[];if(footnoteElements.length>0){footnoteWidgets=this.getFootNoteWidgetsBy(widget,footnoteElements);}return footnoteWidgets;};Layout.prototype.getFootNodeWidgetsToShiftToPage=function(paragraph){var splittedWidgets=paragraph.getSplitWidgets();var footNoteWidgets=[];var toBodyWidget=paragraph.containerWidget;var fromBodyWidget;for(var i=0;i<splittedWidgets.length;i++){var footWidgets=this.getFootNoteWidgetsOf(splittedWidgets[i]);for(var j=0;j<footWidgets.length;j++){fromBodyWidget=footWidgets[j].containerWidget;if(toBodyWidget!==fromBodyWidget){footNoteWidgets.push(footWidgets[j]);}}}return{'footNoteWidgets':footNoteWidgets,'fromBodyWidget':fromBodyWidget,'toBodyWidget':toBodyWidget};};Layout.prototype.shiftTableWidget=function(table,viewer,isClearHeight){if(isClearHeight===void 0){isClearHeight=false;}var tables=[table];this.addTableWidget(this.viewer.clientActiveArea,tables);this.viewer.updateClientAreaTopOrLeft(table,true);var row=table.childWidgets[0];while(row){row=this.shiftRowWidget(tables,row,isClearHeight);row=row.nextRow;}this.updateWidgetsToPage(tables,[],table);return tables[tables.length-1];};Layout.prototype.shiftRowWidget=function(tables,row,isClearHeight){if(isClearHeight===void 0){isClearHeight=false;}var viewer=this.viewer;if(isClearHeight){row.height=0;}var rows=[row];this.addTableRowWidget(viewer.clientActiveArea,rows);viewer.updateClientAreaForRow(row,true);for(var i=0;i<row.childWidgets.length;i++){var cell=row.childWidgets[i];if(isClearHeight){cell.height=0;}// eslint-disable-next-line max-len
this.shiftCellWidget(cell,this.getMaxTopCellMargin(row)+row.topBorderWidth,this.getMaxBottomCellMargin(row)+row.bottomBorderWidth,isClearHeight);}viewer.updateClientAreaForRow(row,false);this.updateWidgetsToTable(tables,rows,row);return rows[rows.length-1];};Layout.prototype.shiftCellWidget=function(cell,maxCellMarginTop,maxCellMarginBottom,isClearHeight){if(sf.base.isNullOrUndefined(isClearHeight)){isClearHeight=false;}var viewer=this.viewer;this.addTableCellWidget(cell,viewer.clientActiveArea,maxCellMarginTop,maxCellMarginBottom);viewer.updateClientAreaForCell(cell,true);for(var i=0;i<cell.childWidgets.length;i++){var block=cell.childWidgets[i];viewer.updateClientAreaForBlock(block,true);if(block instanceof ParagraphWidget){this.shiftParagraphWidget(block);}else{this.shiftTableWidget(block,viewer,isClearHeight);}viewer.updateClientAreaForBlock(block,false);}this.updateWidgetToRow(cell);viewer.updateClientAreaForCell(cell,false);};Layout.prototype.shiftParagraphWidget=function(paragraph){this.addParagraphWidget(this.viewer.clientActiveArea,paragraph);this.viewer.cutFromTop(this.viewer.clientActiveArea.y+paragraph.height);if(!sf.base.isNullOrUndefined(paragraph.floatingElements)){//this.shiftLayoutFloatingItems(paragraph as ParagraphWidget);
// for (let i: number = 0; i < paragraph.floatingElements.length; i++) {
//     let shape: ShapeElementBox = paragraph.floatingElements[i];
//     this.layoutElement(shape, paragraph);
// }
}this.updateWidgetToPage(this.viewer,paragraph);};Layout.prototype.updateContainerForTable=function(block,viewer){var prevObj=this.getBodyWidgetOfPreviousBlock(block,0);var prevBodyWidget=prevObj.bodyWidget;var index=prevObj.index;var isPageBreak=prevBodyWidget.lastChild.lastChild.isEndsWithPageBreak;if(prevBodyWidget!==block.containerWidget){if(!isPageBreak){this.updateContainerWidget(block,prevBodyWidget,index+1,true);}else{viewer.updateClientArea(block.bodyWidget.sectionFormat,block.bodyWidget.page);}}if(block.isInHeaderFooter||this.viewer instanceof WebLayoutViewer){block.containerWidget.height-=block.height;}};Layout.prototype.shiftWidgetsForTable=function(table,viewer){this.updateContainerForTable(table,viewer);this.viewer.updateClientAreaForBlock(table,true);var tempClientAreaX=this.viewer.clientArea.x;if(this.documentHelper.compatibilityMode!=='Word2013'){this.viewer.clientActiveArea.x=this.viewer.clientActiveArea.x-HelperMethods.convertPointToPixel(table.firstChild.firstChild.leftMargin);}this.updateVerticalPositionToTop(table,true);//const isPageLayout: boolean = viewer instanceof PageLayoutViewer;
var combinedTable=table.combineWidget(this.viewer);this.documentHelper.layout.updateChildLocationForTable(combinedTable.y,combinedTable);this.clearTableWidget(combinedTable,true,false);this.shiftTableWidget(combinedTable,this.viewer);this.updateVerticalPositionToTop(table,false);if(this.documentHelper.compatibilityMode!=='Word2013'){this.viewer.clientArea.x=tempClientAreaX;}this.viewer.updateClientAreaForBlock(table,false);};Layout.prototype.updateVerticalPositionToTop=function(table,isUpdateTop){//Iterate the tableWidgets counts
for(var i=0;i<table.getSplitWidgets().length;i++){var tablewidget=table.getSplitWidgets()[i];//Iterate the tableWidget child items
for(var j=0;j<tablewidget.childWidgets.length;j++){var rowWidget=tablewidget.childWidgets[j];//Iterate the RowWidgets child items
for(var k=0;k<rowWidget.childWidgets.length;k++){var cellWidget=rowWidget.childWidgets[k];//Iterate the RowWidgets child items
this.documentHelper.layout.updateCellVerticalPosition(cellWidget,isUpdateTop,false);}}}};// eslint-disable-next-line max-len
Layout.prototype.splitWidget=function(paragraphWidget,viewer,previousBodyWidget,index,isPageBreak,footWidget){var firstLine=paragraphWidget.childWidgets[0];var keepLinesTogether=paragraphWidget.paragraphFormat.keepLinesTogether&&this.viewer.clientActiveArea.y!==this.viewer.clientArea.y;var maxElementHeight=keepLinesTogether?paragraphWidget.height:this.getMaxElementHeight(firstLine);var paragraphView=paragraphWidget.getSplitWidgets();var nextBodyWidget=paragraphWidget.containerWidget;// Get maximun height based on widow/orphan control.
maxElementHeight=this.getMaximumLineHeightToSplit(paragraphWidget,maxElementHeight,viewer);// TODO: Footnote move on move entire paragraph.
var footNoteInFirstLine=this.getFootNotesWidgetsInLine(firstLine);if(sf.base.isNullOrUndefined(paragraphWidget.previousWidget)&&footNoteInFirstLine.length>0){for(var i=0;i<footNoteInFirstLine.length;i++){maxElementHeight+=footNoteInFirstLine[i].height;}maxElementHeight+=paragraphWidget.bodyWidget.page.footnoteWidget.childWidgets[0].height;}if(viewer.clientActiveArea.height>=maxElementHeight&&!isPageBreak){var splittedWidget=undefined;var widgetIndex=paragraphView.indexOf(paragraphWidget);if(widgetIndex<paragraphView.length-1){splittedWidget=paragraphView[widgetIndex+1];nextBodyWidget=splittedWidget.containerWidget;}else{splittedWidget=new ParagraphWidget();splittedWidget.index=paragraphWidget.index;splittedWidget.characterFormat=paragraphWidget.characterFormat;splittedWidget.paragraphFormat=paragraphWidget.paragraphFormat;splittedWidget.width=paragraphWidget.width;splittedWidget.x=paragraphWidget.x;splittedWidget.y=paragraphWidget.y;paragraphView.push(splittedWidget);}if(previousBodyWidget!==paragraphWidget.containerWidget){var fromBodyWidget=paragraphWidget.containerWidget;if(paragraphWidget.childWidgets.indexOf(this.documentHelper.selection.start.currentWidget)!==-1||paragraphWidget.childWidgets.indexOf(this.documentHelper.selection.end.currentWidget)!==-1){this.updateContainerWidget(paragraphWidget,previousBodyWidget,index,true);this.moveFootNotesToPage(footWidget,fromBodyWidget,previousBodyWidget);}}for(var i=paragraphWidget.childWidgets.length-1;i>0;i--){var line=paragraphWidget.childWidgets[i];if(this.isFitInClientArea(paragraphWidget,viewer,undefined)){if(splittedWidget.childWidgets.length===1){this.updateParagraphWidgetInternal(line,splittedWidget,0);}break;}else{//Moves the line widget to next widget.
this.updateParagraphWidgetInternal(line,splittedWidget,0);}}if(sf.base.isNullOrUndefined(splittedWidget.containerWidget)&&splittedWidget.childWidgets.length>0){var y=viewer.clientActiveArea.y;// eslint-disable-next-line max-len
var clientArea=new Rect(viewer.clientArea.x,viewer.clientArea.y,viewer.clientArea.width,viewer.clientArea.height);// eslint-disable-next-line max-len
var activeArea=new Rect(viewer.clientActiveArea.x,viewer.clientActiveArea.y,viewer.clientActiveArea.width,viewer.clientActiveArea.height);//Checks whether next node exists, else adds new page.
nextBodyWidget=this.moveBlocksToNextPage(paragraphWidget);// nextBodyWidget = this.createOrGetNextBodyWidget(previousBodyWidget, viewer);
nextBodyWidget.childWidgets.splice(0,0,splittedWidget);nextBodyWidget.height+=splittedWidget.height;splittedWidget.containerWidget=nextBodyWidget;if(nextBodyWidget!=previousBodyWidget){footWidget=this.getFootNoteWidgetsOf(splittedWidget);this.moveFootNotesToPage(footWidget,previousBodyWidget,nextBodyWidget);}if(nextBodyWidget.childWidgets.length===1&&nextBodyWidget.firstChild instanceof ParagraphWidget&&nextBodyWidget.firstChild.equals(paragraphWidget)){//paragraphWidget.x = paragraphWidget.x;
paragraphWidget.y=y;return true;}else{//Resetting Client area
viewer.clientArea=clientArea;viewer.clientActiveArea=activeArea;}}}else{nextBodyWidget=this.createOrGetNextBodyWidget(previousBodyWidget,this.viewer);if(paragraphWidget.containerWidget!==nextBodyWidget){var startBlock=paragraphWidget;var blockInfo=this.alignBlockElement(paragraphWidget);if(!sf.base.isNullOrUndefined(blockInfo.node)){startBlock=blockInfo.node instanceof TableRowWidget?this.splitRow(blockInfo.node):this.splitParagraph(blockInfo.node,parseInt(blockInfo.position.index,10));paragraphWidget=startBlock;this.keepWithNext=true;}nextBodyWidget=this.moveBlocksToNextPage(paragraphWidget);this.updateContainerWidget(paragraphWidget,nextBodyWidget,0,true);//footWidget = this.getFootNoteWidgetsOf(paragraphWidget);
if(!sf.base.isNullOrUndefined(previousBodyWidget.page.footnoteWidget)){this.moveFootNotesToPage(footWidget,previousBodyWidget,nextBodyWidget);}}else if(!sf.base.isNullOrUndefined(previousBodyWidget)&&sf.base.isNullOrUndefined(paragraphWidget.previousWidget)){this.updateContainerWidget(paragraphWidget,previousBodyWidget,previousBodyWidget.childWidgets.length,false);var startBlock=paragraphWidget;var blockInfo=this.alignBlockElement(paragraphWidget);if(!sf.base.isNullOrUndefined(blockInfo.node)){startBlock=blockInfo.node instanceof TableRowWidget?this.splitRow(blockInfo.node):this.splitParagraph(blockInfo.node,parseInt(blockInfo.position.index,10));this.keepWithNext=true;nextBodyWidget=this.moveBlocksToNextPage(startBlock.previousWidget);this.updateClientPositionForBlock(paragraphWidget.previousWidget,paragraphWidget);// TODO: Handle moving footnote widget
}else{this.updateContainerWidget(paragraphWidget,nextBodyWidget,0,true);}}}if(previousBodyWidget===paragraphWidget.containerWidget){paragraphWidget.y=viewer.clientActiveArea.y;viewer.cutFromTop(viewer.clientActiveArea.y+paragraphWidget.height);}else{//Updates client area based on next body widget.
viewer.updateClientArea(nextBodyWidget.sectionFormat,nextBodyWidget.page);}return false;};Layout.prototype.getMaximumLineHeightToSplit=function(paragraphWidget,maxElementHeight,viewer){if(viewer.clientActiveArea.height>=maxElementHeight&&!paragraphWidget.paragraphFormat.keepLinesTogether&&paragraphWidget.paragraphFormat.widowControl&&!sf.base.isNullOrUndefined(paragraphWidget.previousWidget)&&sf.base.isNullOrUndefined(paragraphWidget.previousSplitWidget)){var paragraphHeight=paragraphWidget.height;for(var m=paragraphWidget.childWidgets.length-1;m>=0;m--){var lastLine=paragraphWidget.childWidgets[m];var lineHeight=this.getMaxElementHeight(lastLine);if(lastLine.height>lineHeight){paragraphHeight-=lastLine.height-lineHeight;}if(viewer.clientActiveArea.height>=paragraphHeight){// Move entire paragraph to next page, If first line alone not fitted in the client area.
if(m===0){maxElementHeight=paragraphWidget.height;}break;}paragraphHeight-=lastLine.height;}}return maxElementHeight;};/**
     * @private
     * @param footnoteWidgets
     * @param fromBodyWidget
     * @param toBodyWidget
     */Layout.prototype.moveFootNotesToPage=function(footnoteWidgets,fromBodyWidget,toBodyWidget){if(footnoteWidgets.length>0){var footNoteIndex=-1;var footNoteWidget=void 0;var insertIndex=1;for(var k=0;k<footnoteWidgets.length;k++){/* eslint-disable-next-line max-len */footNoteWidget=footnoteWidgets[k];footNoteIndex=fromBodyWidget.page.footnoteWidget.childWidgets.indexOf(footNoteWidget);if(footNoteIndex>=0){if(toBodyWidget.page.footnoteWidget===undefined){this.addEmptyFootNoteToBody(toBodyWidget);}fromBodyWidget.page.footnoteWidget.childWidgets.splice(footNoteIndex,1);if(toBodyWidget.page.footnoteWidget.childWidgets.indexOf(footNoteWidget)<0){toBodyWidget.page.footnoteWidget.childWidgets.push(footNoteWidget);var childLength=toBodyWidget.page.footnoteWidget.childWidgets.length;if(childLength===1){toBodyWidget.page.footnoteWidget.childWidgets.push(footNoteWidget);insertIndex++;}else{toBodyWidget.page.footnoteWidget.childWidgets.splice(insertIndex++,0,footNoteWidget);}toBodyWidget.page.footnoteWidget.height+=footNoteWidget.height;}fromBodyWidget.page.footnoteWidget.height-=footNoteWidget.height;}}if(fromBodyWidget.page.footnoteWidget&&fromBodyWidget.page.footnoteWidget.childWidgets.length===1){fromBodyWidget.page.footnoteWidget=undefined;}}};Layout.prototype.addEmptyFootNoteToBody=function(bodyWidget){var footnoteWidget=new FootNoteWidget();footnoteWidget.footNoteType='Footnote';footnoteWidget.page=bodyWidget.page;var newParagraph=new ParagraphWidget();newParagraph.characterFormat=new WCharacterFormat();newParagraph.paragraphFormat=new WParagraphFormat();newParagraph.index=0;var lineWidget=new LineWidget(newParagraph);newParagraph.childWidgets.push(lineWidget);footnoteWidget.childWidgets.push(newParagraph);footnoteWidget.height=this.documentHelper.textHelper.getParagraphMarkSize(newParagraph.characterFormat).Height;bodyWidget.page.footnoteWidget=footnoteWidget;};Layout.prototype.getMaxElementHeight=function(lineWidget){var height=0;// eslint-disable-next-line max-len
if(lineWidget.children.length===0||lineWidget.children.length===1&&lineWidget.children[0]instanceof ListTextElementBox||lineWidget.children.length===2&&lineWidget.children[0]instanceof ListTextElementBox&&lineWidget.children[1]instanceof ListTextElementBox){var topMargin=0;var bottomMargin=0;height=this.documentHelper.selection.getParagraphMarkSize(lineWidget.paragraph,topMargin,bottomMargin).height;height+=topMargin;if(lineWidget.children.length>0){var element=lineWidget.children[0];if(height<element.margin.top+element.height){height=element.margin.top+element.height;}}}else{for(var i=0;i<lineWidget.children.length;i++){var element=lineWidget.children[i];if(height<element.margin.top+element.height){height=element.margin.top+element.height;}}}return height;};Layout.prototype.createOrGetNextBodyWidget=function(bodyWidget,viewer){var nextBodyWidget=undefined;var pageIndex=0;pageIndex=this.documentHelper.pages.indexOf(bodyWidget.page);var page=undefined;var index=undefined;index=bodyWidget.index;if(pageIndex===this.documentHelper.pages.length-1||this.documentHelper.pages[pageIndex+1].sectionIndex!==index){var currentWidget=new BodyWidget();currentWidget.sectionFormat=bodyWidget.sectionFormat;currentWidget.index=bodyWidget.index;page=viewer.createNewPage(currentWidget);if(this.documentHelper.pages[pageIndex+1].sectionIndex!==index){this.documentHelper.insertPage(pageIndex+1,page);}nextBodyWidget=page.bodyWidgets[0];}else{page=this.documentHelper.pages[pageIndex+1];nextBodyWidget=page.bodyWidgets[0];}return nextBodyWidget;};Layout.prototype.isFitInClientArea=function(paragraphWidget,viewer,blocks){var lastLine=paragraphWidget.childWidgets[paragraphWidget.childWidgets.length-1];var height=paragraphWidget.height;var maxElementHeight=this.getMaxElementHeight(lastLine);if(lastLine.height>maxElementHeight){height-=lastLine.height-maxElementHeight;}var footHeight=0;if(!sf.base.isNullOrUndefined(blocks)){if(blocks.length>0){for(var k=0;k<blocks.length;k++){footHeight+=blocks[k].height;}}}return viewer.clientActiveArea.height>=height+footHeight;};Layout.prototype.isLineInFootNote=function(line,footNotes){for(var i=0;i<footNotes.length;i++){if(footNotes[i].line===line){return true;}}return false;};// eslint-disable-next-line max-len
Layout.prototype.shiftToPreviousWidget=function(paragraphWidget,viewer,previousWidget,isPageBreak){var fromBodyWidget=paragraphWidget.containerWidget;var toBodyWidget=previousWidget.containerWidget;var footNotes=[];var footNoteWidgets=[];if(toBodyWidget!==fromBodyWidget){footNotes=this.getFootNotesOfBlock(paragraphWidget);}for(var i=0;i<paragraphWidget.childWidgets.length;i++){var line=paragraphWidget.childWidgets[i];var maxElementHeight=this.getMaxElementHeight(line);if(viewer.clientActiveArea.height>=maxElementHeight&&!isPageBreak){if(footNotes.length>0&&this.isLineInFootNote(line,footNotes)){footNoteWidgets=footNoteWidgets.concat(this.getFootNoteWidgetsBy(line.paragraph,footNotes));}//Moves the line widget to previous widget.
this.updateParagraphWidgetInternal(line,previousWidget,previousWidget.childWidgets.length);i--;viewer.cutFromTop(viewer.clientActiveArea.y+line.height);if(sf.base.isNullOrUndefined(paragraphWidget.childWidgets)){break;}}else{var bodyWidget=previousWidget.containerWidget;var newBodyWidget=this.createOrGetNextBodyWidget(bodyWidget,viewer);if(paragraphWidget.containerWidget!==newBodyWidget){newBodyWidget=this.moveBlocksToNextPage(paragraphWidget);}if(bodyWidget!==newBodyWidget){footNotes=this.getFootNotesOfBlock(paragraphWidget);if(footNotes.length>0){footNoteWidgets=footNoteWidgets.concat(this.getFootNoteWidgetsBy(paragraphWidget,footNotes));toBodyWidget=newBodyWidget;}this.updateContainerWidget(paragraphWidget,newBodyWidget,0,true);}//Updates client area based on next page.
viewer.updateClientArea(fromBodyWidget.sectionFormat,fromBodyWidget.page);break;}}if(!sf.base.isNullOrUndefined(footNoteWidgets)&&footNoteWidgets.length>0&&fromBodyWidget!=toBodyWidget){this.moveFootNotesToPage(footNoteWidgets,fromBodyWidget,toBodyWidget);}};Layout.prototype.updateParagraphWidgetInternal=function(lineWidget,newParagraphWidget,index){if(!sf.base.isNullOrUndefined(lineWidget.paragraph)){lineWidget.paragraph.childWidgets.splice(lineWidget.paragraph.childWidgets.indexOf(lineWidget),1);lineWidget.paragraph.height-=lineWidget.height;if(!sf.base.isNullOrUndefined(lineWidget.paragraph.containerWidget)){lineWidget.paragraph.containerWidget.height-=lineWidget.height;}if(sf.base.isNullOrUndefined(lineWidget.paragraph.childWidgets)||lineWidget.paragraph.childWidgets.length===0){lineWidget.paragraph.destroyInternal(this.viewer);}}newParagraphWidget.childWidgets.splice(index,0,lineWidget);lineWidget.paragraph=newParagraphWidget;newParagraphWidget.height+=lineWidget.height;if(!sf.base.isNullOrUndefined(newParagraphWidget.containerWidget)){newParagraphWidget.containerWidget.height+=lineWidget.height;}};Layout.prototype.shiftNextWidgets=function(blockAdv){var block=blockAdv;while(block.nextWidget instanceof BlockWidget){block=block.nextWidget;this.reLayoutOrShiftWidgets(block,this.viewer);}};Layout.prototype.updateContainerWidget=function(widget,bodyWidget,index,destroyAndScroll){if(!sf.base.isNullOrUndefined(widget.containerWidget)){widget.containerWidget.childWidgets.splice(widget.containerWidget.childWidgets.indexOf(widget),1);widget.containerWidget.height-=bodyWidget.height;if((sf.base.isNullOrUndefined(widget.containerWidget.childWidgets)||widget.containerWidget.childWidgets.length===0)&&widget.containerWidget instanceof BodyWidget&&widget.containerWidget!==bodyWidget&&destroyAndScroll){var page=widget.containerWidget.page;if(this.documentHelper.pages[this.documentHelper.pages.length-1]===page&&this.viewer.visiblePages.indexOf(page)!==-1){this.documentHelper.scrollToBottom();}if(sf.base.isNullOrUndefined(page.nextPage)||page.nextPage.bodyWidgets[0].index!==widget.containerWidget.index){widget.containerWidget.destroyInternal(this.viewer);}}}bodyWidget.childWidgets.splice(index,0,widget);if(widget instanceof ParagraphWidget&&!sf.base.isNullOrUndefined(widget.floatingElements)){for(var i=0;i<widget.floatingElements.length;i++){var shape=widget.floatingElements[i];if(shape.textWrappingStyle!=='Inline'){bodyWidget.floatingElements.push(shape);widget.bodyWidget.floatingElements.splice(widget.bodyWidget.floatingElements.indexOf(shape),1);/* eslint:disable */bodyWidget.floatingElements.sort(function(a,b){return a.y-b.y;});}}}if(widget instanceof TableWidget&&widget.wrapTextAround&&widget.bodyWidget.floatingElements.indexOf(widget)!==-1){widget.bodyWidget.floatingElements.splice(widget.bodyWidget.floatingElements.indexOf(widget),1);}bodyWidget.height+=bodyWidget.height;widget.containerWidget=bodyWidget;};Layout.prototype.getBodyWidgetOfPreviousBlock=function(block,index){index=0;var prevBodyWidget=undefined;var previousBlock=block.previousRenderedWidget;prevBodyWidget=previousBlock&&previousBlock.containerWidget.equals(block.containerWidget)?previousBlock.containerWidget:block.containerWidget;index=previousBlock&&previousBlock.containerWidget.equals(block.containerWidget)?prevBodyWidget.childWidgets.indexOf(previousBlock):block.containerWidget.childWidgets.indexOf(block);return{bodyWidget:prevBodyWidget,index:index};};Layout.prototype.moveBlocksToNextPage=function(block){var body=block.bodyWidget;var page=body.page;var pageIndex=page.index+1;var nextPage=undefined;var nextBody=undefined;var insertPage=false;if(this.documentHelper.pages.length>pageIndex){nextPage=this.documentHelper.pages[pageIndex];if(nextPage.bodyWidgets.length===0||!body.equals(nextPage.bodyWidgets[0])){nextPage=undefined;insertPage=true;}else{nextBody=nextPage.bodyWidgets[0];this.viewer.updateClientArea(nextBody.sectionFormat,nextBody.page);}}if(sf.base.isNullOrUndefined(nextPage)){nextBody=this.createSplitBody(body);nextPage=this.viewer.createNewPage(nextBody,pageIndex);if(insertPage){this.documentHelper.insertPage(pageIndex,nextPage);}this.clearLineMeasures();}// eslint-disable  no-constant-condition
do{var lastBlock=void 0;if(body.lastChild instanceof FootNoteWidget){lastBlock=body.lastChild.previousWidget;}else{lastBlock=body.lastChild;}var footWidget=this.getFootNoteWidgetsOf(lastBlock);this.moveFootNotesToPage(footWidget,body,nextBody);if(lastBlock instanceof TableWidget&&body.floatingElements.indexOf(lastBlock)!==-1){body.floatingElements.splice(body.floatingElements.indexOf(lastBlock),1);//nextBody.floatingElements.push(lastBlock);
}if(lastBlock instanceof ParagraphWidget&&lastBlock.floatingElements.length>0){for(var m=0;m<lastBlock.floatingElements.length;m++){if(body.floatingElements.indexOf(lastBlock.floatingElements[m])!==-1){body.floatingElements.splice(body.floatingElements.indexOf(lastBlock.floatingElements[m]),1);}nextBody.floatingElements.push(lastBlock.floatingElements[m]);}}if(block===lastBlock){break;}body.childWidgets.splice(body.childWidgets.indexOf(lastBlock),1);nextBody.childWidgets.splice(0,0,lastBlock);lastBlock.containerWidget=nextBody;nextBody.height+=lastBlock.height;// eslint-disable-next-line no-constant-condition
}while(true);return nextBody;};Layout.prototype.createSplitBody=function(body){var newBody=this.addBodyWidget(this.viewer.clientActiveArea);newBody.sectionFormat=body.sectionFormat;newBody.index=body.index;return newBody;};//endregion
//#region Relayout Parargaph
/* eslint-disable  */Layout.prototype.reLayoutLine=function(paragraph,lineIndex,isBidi,isSkip){this.isFootnoteContentChanged=false;if(this.viewer.owner.isDocumentLoaded&&this.viewer.owner.editorModule){this.viewer.owner.editorModule.updateWholeListItems(paragraph);}var lineWidget;if(paragraph.paragraphFormat.listFormat&&paragraph.paragraphFormat.listFormat.listId!==-1){lineWidget=paragraph.getSplitWidgets()[0].firstChild;}else{lineWidget=paragraph.childWidgets[lineIndex];}if(!this.isBidiReLayout&&(paragraph.paragraphFormat.bidi||this.isContainsRtl(lineWidget))){var newLineIndex=lineIndex<=0?0:lineIndex-1;for(var i=newLineIndex;i<paragraph.childWidgets.length;i++){if(isBidi||!(paragraph.paragraphFormat.bidi&&this.isContainsRtl(lineWidget))&&!isSkip){if(i===lineIndex){if(this.viewer.owner.editor.isPaste){this.reArrangeElementsForRtl(paragraph.childWidgets[i],paragraph.paragraphFormat.bidi);}continue;}}this.reArrangeElementsForRtl(paragraph.childWidgets[i],paragraph.paragraphFormat.bidi);}}var lineToLayout=lineWidget.previousLine;if(sf.base.isNullOrUndefined(lineToLayout)){lineToLayout=lineWidget;}var currentParagraph=lineToLayout.paragraph;var bodyWidget=paragraph.containerWidget;bodyWidget.height-=paragraph.height;if((this.viewer.owner.enableHeaderAndFooter||paragraph.isInHeaderFooter)&&!(bodyWidget instanceof TextFrame)){paragraph.bodyWidget.isEmpty=false;this.viewer.updateHeaderFooterClientAreaWithTop(paragraph.bodyWidget.sectionFormat,this.documentHelper.isBlockInHeader(paragraph),bodyWidget.page);}else if(bodyWidget instanceof TextFrame){this.viewer.updateClientAreaForTextBoxShape(bodyWidget.containerShape,true);// } else if (bodyWidget instanceof FootNoteWidget) {
//     this.isRelayoutFootnote = true;
//     this.viewer.updateClientArea(bodyWidget.sectionFormat, bodyWidget.page);
//     this.viewer.clientArea.height = Number.POSITIVE_INFINITY;
//     this.viewer.clientActiveArea.height = Number.POSITIVE_INFINITY;
//     // curretBlock.containerWidget.height -= curretBlock.height;
//     this.viewer.clientActiveArea.y = paragraph.containerWidget.y;
}else{this.viewer.updateClientArea(bodyWidget.sectionFormat,bodyWidget.page,true);}this.viewer.updateClientAreaForBlock(paragraph,true);if(paragraph.containerWidget instanceof FootNoteWidget){this.isRelayoutFootnote=false;var height=paragraph.height;var y=paragraph.y;this.layoutParagraph(paragraph,0);this.viewer.updateClientAreaForBlock(paragraph,false);paragraph.containerWidget.height+=height;paragraph.y=0;if(paragraph.containerWidget.footNoteType==='Footnote'){this.viewer.updateFootnoteClientArea(paragraph.containerWidget.sectionFormat,paragraph.containerWidget);}this.viewer.cutFromTop(y);this.layoutParagraph(paragraph,0);// this.layoutfootNote(paragraph.containerWidget);
// this.layoutNextItemsBlock(paragraph, this.viewer);
return;}else if(lineToLayout.paragraph.isEmpty()){this.viewer.cutFromTop(paragraph.y);this.layoutParagraph(paragraph,0);}else{this.updateClientAreaForLine(lineToLayout);this.layoutListItems(lineToLayout.paragraph);if(lineToLayout.isFirstLine()&&!sf.base.isNullOrUndefined(paragraph.paragraphFormat)){var firstLineIndent=-HelperMethods.convertPointToPixel(paragraph.paragraphFormat.firstLineIndent);this.viewer.updateClientWidth(firstLineIndent);}do{lineToLayout=this.layoutLine(lineToLayout,0);paragraph=lineToLayout.paragraph;lineToLayout=lineToLayout.nextLine;}while(lineToLayout);this.updateWidgetToPage(this.viewer,paragraph);this.viewer.updateClientAreaForBlock(paragraph,false);}this.layoutNextItemsBlock(paragraph,this.viewer);var prevWidget=paragraph.getSplitWidgets()[0].previousRenderedWidget;if(!sf.base.isNullOrUndefined(prevWidget)&&(!(prevWidget instanceof ParagraphWidget)||prevWidget instanceof ParagraphWidget&&!prevWidget.isEndsWithPageBreak)){this.viewer.cutFromTop(paragraph.y+paragraph.height);if(paragraph.containerWidget!==prevWidget.containerWidget&&!sf.base.isNullOrUndefined(prevWidget.containerWidget)){// eslint-disable-next-line max-len
var prevBodyWidget=paragraph.containerWidget;var newBodyWidget_1=prevWidget.containerWidget;var footWidgets=this.getFootNoteWidgetsOf(paragraph);//this.updateContainerWidget(paragraph as Widget, newBodyWidget, prevWidget.indexInOwner + 1, false);
if(!sf.base.isNullOrUndefined(newBodyWidget_1.page.footnoteWidget)){this.moveFootNotesToPage(footWidgets,newBodyWidget_1,prevBodyWidget);}}}var page=this.documentHelper.pages.length;var foot;var newBodyWidget=this.documentHelper.pages[page-1].bodyWidgets[0];if(this.isFootnoteContentChanged&&!sf.base.isNullOrUndefined(paragraph.bodyWidget.page.footnoteWidget)){foot=paragraph.bodyWidget.page.footnoteWidget;this.layoutfootNote(foot);}if(this.isEndnoteContentChanged&&!sf.base.isNullOrUndefined(newBodyWidget.page.endnoteWidget)){foot=newBodyWidget.page.endnoteWidget;this.viewer.cutFromTop(newBodyWidget.childWidgets[newBodyWidget.childWidgets.length-1].y+newBodyWidget.childWidgets[newBodyWidget.childWidgets.length-1].height);this.layoutfootNote(foot);// this.viewer.updateClientAreaForBlock(foot.block, false);
}};//#endregion
//RTL Feature layout start
Layout.prototype.isContainsRtl=function(lineWidget){var isContainsRTL=false;for(var i=0;i<lineWidget.children.length;i++){if(lineWidget.children[i]instanceof TextElementBox){isContainsRTL=lineWidget.children[i].characterFormat.bidi||lineWidget.children[i].characterFormat.bdo==='RTL'||this.documentHelper.textHelper.isRTLText(lineWidget.children[i].text);if(isContainsRTL){break;}}}return isContainsRTL;};// Re arranges the elements for Right to left layotuing.
/* eslint-disable  */Layout.prototype.reArrangeElementsForRtl=function(line,isParaBidi){if(line.children.length===0){return;}var lastAddedElementIsRtl=false;var lastAddedRtlElementIndex=-1;var tempElements=[];for(var i=0;i<line.children.length;i++){var element=line.children[i];var elementCharacterFormat=undefined;if(element.characterFormat){elementCharacterFormat=element.characterFormat;}var isRtl=false;var text='';var containsSpecchrs=false;if(element instanceof BookmarkElementBox){if(isParaBidi){if(lastAddedElementIsRtl||element.bookmarkType===0&&element.nextElement&&element.nextElement.nextElement instanceof TextElementBox&&this.documentHelper.textHelper.isRTLText(element.nextElement.nextElement.text)||element.bookmarkType===1&&element.nextElement instanceof TextElementBox&&this.documentHelper.textHelper.isRTLText(element.nextElement.text)){tempElements.splice(0,0,element);}else{tempElements.splice(lastAddedElementIsRtl?lastAddedRtlElementIndex:lastAddedRtlElementIndex+1,0,element);}lastAddedRtlElementIndex=tempElements.indexOf(element);}else{tempElements.push(element);}continue;}if(element instanceof TextElementBox){text=element.text;containsSpecchrs=this.documentHelper.textHelper.containsSpecialCharAlone(text.trim());if(containsSpecchrs){if(elementCharacterFormat.bidi&&isParaBidi){text=HelperMethods.reverseString(text);for(var k=0;k<text.length;k++){var ch=this.documentHelper.textHelper.inverseCharacter(text.charAt(k));text=text.replace(text.charAt(k),ch);}element.text=text;}}var textElement=element.nextElement;if(element instanceof TextElementBox&&this.documentHelper.textHelper.containsNumberAlone(element.text.trim())){while(textElement instanceof TextElementBox&&textElement.text.trim()!==''&&(this.documentHelper.textHelper.containsNumberAlone(textElement.text.trim())||this.documentHelper.textHelper.containsSpecialCharAlone(textElement.text.trim()))){element.text=element.text+textElement.text;element.line.children.splice(element.line.children.indexOf(textElement),1);textElement=element.nextElement;}element.width=this.documentHelper.textHelper.getTextSize(element,element.characterFormat);}}var isRTLText=false;// let isNumber: boolean = false;
// The list element box shold be added in the last position in line widget for the RTL paragraph 
// and first in the line widget for LTR paragrph.
if(element instanceof ListTextElementBox){isRtl=isParaBidi;}else{// For Text element box we need to check the character format and unicode of text to detect the RTL text. 
isRTLText=this.documentHelper.textHelper.isRTLText(text);isRtl=isRTLText||elementCharacterFormat.bidi||elementCharacterFormat.bdo==='RTL';}if(element instanceof FieldElementBox||this.isRtlFieldCode){if(element.fieldType===0){this.isRtlFieldCode=true;}else if(element.fieldType===1){this.isRtlFieldCode=false;}isRtl=false;}// If the text element box contains only whitespaces, then need to check the previous and next elements.
if(!isRtl&&!sf.base.isNullOrUndefined(text)&&text!==''&&(text!==''&&text.trim()===''||containsSpecchrs)){var elements=line.children;//Checks whether the langugae is RTL.
if(elementCharacterFormat.bidi){// If the last added element is rtl then current text element box also considered as RTL for WhiteSpaces.
if(lastAddedElementIsRtl){isRtl=true;// Else, Check for next element.
}else if(i+1<line.children.length&&line.children[i+1]instanceof TextElementBox){text=elements[i+1].text;isRtl=this.documentHelper.textHelper.isRTLText(text)||elements[i+1].characterFormat.bidi||elements[i+1].characterFormat.bdo==='RTL';}// If the last added element is rtl then current text element box also considered as RTL for WhiteSpaces.
}else if(lastAddedElementIsRtl){isRtl=true;}}// Preserve the isRTL value, to reuse it for navigation and selection.
element.isRightToLeft=isRtl;//Adds the text element to the line
if(isRtl&&elementCharacterFormat.bdo!=='LTR'){if(lastAddedElementIsRtl){tempElements.splice(lastAddedRtlElementIndex,0,element);}else{if(!isParaBidi){tempElements.push(element);}else{tempElements.splice(0,0,element);}lastAddedElementIsRtl=true;lastAddedRtlElementIndex=tempElements.indexOf(element);}}else{if(lastAddedElementIsRtl&&element instanceof ImageElementBox){if(elementCharacterFormat.bidi){tempElements.splice(lastAddedRtlElementIndex+1,0,element);}else{tempElements.splice(lastAddedRtlElementIndex,0,element);}}else{if(!isParaBidi){tempElements.push(element);}else{if(lastAddedElementIsRtl){tempElements.splice(0,0,element);}else{tempElements.splice(lastAddedRtlElementIndex+1,0,element);}lastAddedRtlElementIndex=tempElements.indexOf(element);}lastAddedElementIsRtl=false;}}}// Clear the elemnts and reassign the arranged elements.
line.children=[];line.children=tempElements;};Layout.prototype.shiftLayoutFloatingItems=function(paragraph){for(var i=0;i<paragraph.floatingElements.length;i++){var element=paragraph.floatingElements[i];var position=this.getFloatingItemPoints(element);var height=position.y-element.y;element.x=position.x;element.y=position.y;if(element instanceof ShapeElementBox){for(var j=0;j<element.textFrame.childWidgets.length;j++){var block=element.textFrame.childWidgets[j];if(block instanceof ParagraphWidget){block.y=block.y+height;}else if(block instanceof TableWidget){this.shiftChildLocationForTableWidget(block,height);}}}}};//RTL feature layout end
Layout.prototype.getFloatingItemPoints=function(floatElement){var paragraph=floatElement.line.paragraph;var sectionFormat=paragraph.bodyWidget.sectionFormat;var indentX=0;var indentY=0;if(paragraph){var leftMargin=HelperMethods.convertPointToPixel(sectionFormat.leftMargin);var rightMargin=HelperMethods.convertPointToPixel(sectionFormat.rightMargin);var topMargin=HelperMethods.convertPointToPixel(sectionFormat.topMargin);var bottomMargin=sectionFormat.bottomMargin>0?HelperMethods.convertPointToPixel(sectionFormat.bottomMargin):48;var headerDistance=HelperMethods.convertPointToPixel(sectionFormat.headerDistance);var footerDistance=HelperMethods.convertPointToPixel(sectionFormat.footerDistance);var pageWidth=HelperMethods.convertPointToPixel(sectionFormat.pageWidth);var pageHeight=HelperMethods.convertPointToPixel(sectionFormat.pageHeight);var pageClientWidth=pageWidth-(leftMargin+rightMargin);var pageClientHeight=pageHeight-topMargin-bottomMargin;//Need to consider RTL layout.
if(paragraph.isInHeaderFooter&&sectionFormat.topMargin<=0){topMargin=Math.abs(topMargin)>0?Math.abs(topMargin):HelperMethods.convertPointToPixel(sectionFormat.headerDistance)+paragraph.height;}else{topMargin=topMargin>0?topMargin:48;}//Update the top margin as text body y position when text body y position exceeds the top margin. 
if(!paragraph.isInHeaderFooter&&topMargin<this.viewer.clientArea.y){topMargin=this.viewer.clientArea.y;}var mIsYPositionUpdated=false;var textWrapStyle='InFrontOfText';//if (textWrapStyle !== 'Inline') {
var isLayoutInCell=false;var vertOrigin=floatElement.verticalOrigin;var horzOrigin=floatElement.horizontalOrigin;var horzAlignment=floatElement.horizontalAlignment;var vertAlignment=floatElement.verticalAlignment;var verticalPercent=floatElement.verticalRelativePercent;var horizontalPercent=floatElement.horizontalRelativePercent;var shapeHeight=floatElement.height;//Need to update size width for Horizontal Line when width exceeds client width.
// if(shape !== null && shape.IsHorizontalRule && size.Width > m_layoutArea.ClientActiveArea.Width)
//     size.Width = m_layoutArea.ClientActiveArea.Width;
var shapeWidth=floatElement.width;var vertPosition=floatElement.verticalPosition;var horzPosition=floatElement.horizontalPosition;var layoutInCell=floatElement.layoutInCell;var autoShape=void 0;if(floatElement instanceof ShapeElementBox){autoShape=floatElement.autoShapeType;}//Word 2013 Layout picture in table cell even layoutInCell property was False.
if(paragraph.isInsideTable&&layoutInCell){isLayoutInCell=true;indentY=this.getVerticalPosition(floatElement,vertPosition,vertOrigin,textWrapStyle);indentX=this.getHorizontalPosition(floatElement.width,floatElement,horzAlignment,horzOrigin,horzPosition,textWrapStyle,paragraph.associatedCell.cellFormat.cellWidth);}else{if(this.documentHelper.viewer instanceof WebLayoutViewer){switch(vertOrigin){case'Line':indentY=this.documentHelper.selection.getTop(floatElement.line);break;default:indentY=this.viewer.clientActiveArea.y;break;}switch(horzOrigin){case'Character':indentX=this.viewer.clientActiveArea.x;break;default:switch(horzAlignment){case'Center':indentX=this.viewer.clientArea.width/2-floatElement.width/2;break;default:indentX=this.viewer.clientArea.x;break;}break;}}else{if(mIsYPositionUpdated){/* Upadte the Y Coordinate of floating image when floating image postion is changed based on the wrapping style. */indentY=this.viewer.clientArea.y;}else{switch(vertOrigin){case'Page':case'TopMargin':indentY=vertPosition;switch(vertAlignment){case'Top':indentY=vertPosition;break;case'Center':if(vertOrigin==='TopMargin'){indentY=(topMargin-shapeHeight)/2;}else{indentY=(pageHeight-shapeHeight)/2;}break;case'Outside':case'Bottom':if(vertOrigin==='Page'&&vertAlignment==='Bottom'){indentY=pageHeight-shapeHeight;}else{if(vertOrigin==='TopMargin'){indentY=topMargin-shapeHeight;}else if((paragraph.bodyWidget.page.index+1)%2!==0){indentY=pageHeight-shapeHeight-footerDistance/2;}else{indentY=headerDistance/2;}}break;case'Inside':if(vertOrigin==='Page'){if((paragraph.bodyWidget.page.index+1)%2===0){indentY=pageHeight-shapeHeight-footerDistance/2;}else{indentY=headerDistance/2;}}else{//Need to ensure this behaviour.
if((paragraph.bodyWidget.page.index+1)%2===0){indentY=(topMargin-shapeHeight)/2-headerDistance;}}break;case'None':if(Math.abs(verticalPercent)<=1000){indentY=pageHeight*(verticalPercent/100);}else{indentY=vertPosition;}break;}break;case'Line':indentY=vertPosition;switch(vertAlignment){case'Inside':case'Top'://Need to update line widget height instead of client active area.
indentY=this.viewer.clientActiveArea.y;break;case'Center':indentY=this.viewer.clientActiveArea.y-shapeHeight/2;break;case'Outside':case'Bottom':indentY=this.viewer.clientActiveArea.y-shapeHeight;break;case'None':indentY=Math.round(paragraph.y)+vertPosition;break;}break;case'BottomMargin':indentY=vertPosition;switch(vertAlignment){case'Inside':case'Top':indentY=pageHeight-bottomMargin;break;case'Center':indentY=pageHeight-bottomMargin+(bottomMargin-shapeHeight)/2;break;case'Outside':case'Bottom':if(paragraph.bodyWidget.page.index+1%2!==0&&vertAlignment==='Outside'){indentY=pageHeight-bottomMargin;}else{indentY=pageHeight-shapeHeight;}break;case'None':indentY=pageHeight-bottomMargin+vertPosition;break;}break;case'InsideMargin':case'OutsideMargin':indentY=vertPosition;switch(vertAlignment){case'Inside':if(vertOrigin==='InsideMargin'){if(vertOrigin==='InsideMargin'&&paragraph.bodyWidget.page.index+1%2===0){indentY=pageHeight-shapeHeight;}else{indentY=0;}}else{indentY=(paragraph.bodyWidget.page.index+1)%2!==0?pageHeight-bottomMargin:topMargin-shapeHeight;}break;case'Top':if(vertOrigin==='InsideMargin'){if((paragraph.bodyWidget.page.index+1)%2===0){indentY=pageHeight-bottomMargin;}else{indentY=0;}}else{indentY=(paragraph.bodyWidget.page.index+1)%2!==0?pageHeight-bottomMargin:0;}break;case'Center':if(vertOrigin==='OutsideMargin'){//Need to ensure this.
indentY=(paragraph.bodyWidget.page.index+1)%2!==0?pageHeight-bottomMargin+(bottomMargin-shapeHeight)/2:(topMargin-shapeHeight)/2;}else{if((paragraph.bodyWidget.page.index+1)%2===0){indentY=pageHeight-bottomMargin+(bottomMargin-shapeHeight)/2;}else{indentY=(topMargin-shapeHeight)/2;}}break;case'Outside':if(vertOrigin==='InsideMargin'){if((paragraph.bodyWidget.page.index+1)%2===0){indentY=pageHeight-bottomMargin;}else{indentY=topMargin-shapeHeight;}}else{indentY=(paragraph.bodyWidget.page.index+1)%2!==0?topMargin-shapeHeight:pageHeight-bottomMargin;}break;case'Bottom':if(vertOrigin==='OutsideMargin'){indentY=paragraph.bodyWidget.page.index+1!==0?pageHeight-shapeHeight:topMargin-shapeHeight;}else{if((paragraph.bodyWidget.page.index+1)%2===0){indentY=pageHeight-shapeHeight;}else{indentY=topMargin-shapeHeight;}}break;case'None':break;}break;case'Paragraph':var space=0;//let prevsibling: BlockWidget = paragraph.previousWidget as BlockWidget;
// if (floatElement) {
//     //Need to handle DocIO Implementation.
//     if (Math.round(paragraph.y) !== Math.round(topMargin) && (prevsibling instanceof ParagraphWidget)
//         && ((paragraph.paragraphFormat.beforeSpacing > prevsibling.paragraphFormat.afterSpacing)
//             || (prevsibling.paragraphFormat.afterSpacing < 14)
//             && !paragraph.paragraphFormat.contextualSpacing)) {
//         space = prevsibling.paragraphFormat.afterSpacing;
//     }
// }
// eslint-disable-next-line max-len
//Floating item Y position is calculated from paragraph original Y position not from wrapped paragraph Y(ParagraphLayoutInfo.YPosition) position.
indentY=Math.round(paragraph.y)+space+vertPosition;break;case'Margin'://If header distance is more than top margin, then calculate the position of item based on header distance.
//As per Microsoft Word behavior, it is need to consider paragraph height along with the distance.
if(paragraph.isInHeaderFooter&&headerDistance>topMargin){//Need to udpate.
indentY=headerDistance+paragraph.height+vertPosition;}else{indentY=topMargin+vertPosition;}switch(vertAlignment){case'Top':indentY=topMargin;break;case'Center':indentY=topMargin+(pageClientHeight-shapeHeight)/2;break;case'Outside':case'Bottom':if((paragraph.bodyWidget.page.index+1)%2!==0){indentY=topMargin+pageClientHeight-shapeHeight;}else{indentY=topMargin;}break;case'Inside':if((paragraph.bodyWidget.page.index+1)%2===0){indentY=topMargin+pageClientHeight-shapeHeight;}else{indentY=topMargin;}break;case'None':break;}break;default://Need to analyze further.
indentY=this.viewer.clientArea.y-vertPosition;break;}}// if (horzOrigin !== 'Column' && horzAlignment !== 'None') {
//     indentX = this.viewer.clientArea.x;
//     //Update the floating item x position to zero when floating items width
//     //exceeds the page width when floating item and it wrapping style is not equal to  
//     // infront of text and behind text and also vertical origin is not equal to paragraph.
// } else 
if(paragraph&&textWrapStyle!=='InFrontOfText'&&textWrapStyle!=='Behind'&&vertOrigin==='Paragraph'&&shapeWidth>=pageWidth){indentX=0;}else{switch(horzOrigin){case'Page':indentX=horzPosition;switch(horzAlignment){case'Center':if(isLayoutInCell){indentX=(paragraph.associatedCell.cellFormat.cellWidth-shapeWidth)/2;}else{indentX=(pageWidth-shapeWidth)/2;}break;case'Left':indentX=0;break;case'Outside':case'Right':if(isLayoutInCell){indentX=paragraph.associatedCell.cellFormat.cellWidth-shapeWidth;}else{indentX=pageWidth-shapeWidth;}break;case'None':if(isLayoutInCell){indentX=paragraph.associatedCell.x+horzPosition;}else if(floatElement instanceof ShapeElementBox){indentX=horzPosition;// Shape pItemShape = paraItem as Shape;
// float horRelPercent = pItemShape !== null ? pItemShape.TextFrame.HorizontalRelativePercent
//                       : (paraItem as WTextBox).TextBoxFormat.HorizontalRelativePercent;
// if (Math.Abs(horRelPercent) <= 1000)
//     indentX = pageWidth * (horRelPercent / 100);
// else
//     indentX = pItemShape !== null ? pItemShape.HorizontalPosition
//         : (paraItem as WTextBox).TextBoxFormat.HorizontalPosition;
}else{indentX=horzPosition;}break;}if(indentX<0&&isLayoutInCell){indentX=paragraph.associatedCell.x;}break;case'Column'://Update the Xposition while wrapping element exsit in the paragraph
if(this.viewer.clientActiveArea.x<paragraph.x){// let cellPadings = 0;
// if (paragraph.isInsideTable) {
//     CellLayoutInfo cellLayoutInfo = (ownerPara.GetOwnerEntity() as IWidget).LayoutInfo as CellLayoutInfo;
//     cellPadings = cellLayoutInfo.Paddings.Left + cellLayoutInfo.Paddings.Right;
// }
// float minimumWidthRequired = DEF_MIN_WIDTH_SQUARE;
// if (textWrapStyle === TextWrappingStyle.Tight || textWrapStyle === TextWrappingStyle.Through)
//     minimumWidthRequired = ownerPara.Document.Settings.CompatibilityMode === CompatibilityMode.Word2013 ?
//         DEF_MIN_WIDTH_2013_TIGHTANDTHROW : DEF_MIN_WIDTH_TIGHTANDTHROW;
// minimumWidthRequired -= cellPadings;
// //Re Update the x position to the page left when paragraph starting position not equal to the 
// //column starting and current inline item is x position equal to the column left position.
// if ((ownerPara.IsXpositionUpated && ownerPara.Document.Settings.CompatibilityMode === CompatibilityMode.Word2013)
//     || paragraphLayoutInfo.XPosition > (pageWidth - minimumWidthRequired - rightMargin)
//     || paragraphLayoutInfo.IsXPositionReUpdate)
//     indentX = layouter.ClientLayoutArea.Left + horzPosition;
// else
indentX=paragraph.x+horzPosition;}else{//Re Update the x position to the page left when word version not equal to 2013 
//and wrapping style not equal to infront of text and behind text. 
if(textWrapStyle==='InFrontOfText'||textWrapStyle==='Behind'){if(autoShape==='StraightConnector'||autoShape==='Rectangle'){indentX=horzPosition+HelperMethods.convertPointToPixel(sectionFormat.leftMargin);}else{indentX=paragraph.x+horzPosition;}}else{indentX=this.viewer.clientActiveArea.x+horzPosition;}}//Update the Wrapping element right position as page right when 
//wrapping element right position  exceeds the page right except position 
//InFrontOfText and behindText wrapping style.
if(textWrapStyle!=='InFrontOfText'&&textWrapStyle!=='Behind'&&Math.round(indentX+shapeWidth)>Math.round(pageWidth)&&shapeWidth<pageWidth){indentX=pageWidth-shapeWidth;}switch(horzAlignment){case'Center':indentX=this.viewer.clientActiveArea.x+(this.viewer.clientActiveArea.width-shapeWidth)/2;break;case'Left':indentX=this.viewer.clientActiveArea.x;break;case'Right':indentX=this.viewer.clientActiveArea.x+this.viewer.clientActiveArea.width-shapeWidth;//- TextBoxFormat.InternalMargin.Right;
break;case'None':break;}break;case'Margin':if(paragraph.bodyWidget){indentX=leftMargin+horzPosition;switch(horzAlignment){case'Center':indentX=leftMargin+(pageClientWidth-shapeWidth)/2;break;case'Left':indentX=leftMargin;break;case'Outside':if((paragraph.bodyWidget.page.index+1)%2!==0){indentX=leftMargin+pageClientWidth-shapeWidth;}break;case'Right':indentX=leftMargin+pageClientWidth-shapeWidth;break;case'Inside':if((paragraph.bodyWidget.page.index+1)%2===0){indentX=leftMargin+pageClientWidth-shapeWidth;}break;case'None':break;}}else{indentX=this.viewer.clientArea.x+horzPosition;}break;case'Character':if(horzAlignment==='Right'||horzAlignment==='Center'){indentX=this.getLeftMarginHorizPosition(leftMargin,horzAlignment,horzPosition,shapeWidth,textWrapStyle);}else{//Need to update this while layouting.**
indentX=this.viewer.clientArea.x+horzPosition;}break;case'LeftMargin':indentX=this.getLeftMarginHorizPosition(leftMargin,horzAlignment,horzPosition,shapeWidth,textWrapStyle);break;case'RightMargin':indentX=this.getRightMarginHorizPosition(pageWidth,rightMargin,horzAlignment,horzPosition,shapeWidth,textWrapStyle);break;case'InsideMargin':if((paragraph.bodyWidget.page.index+1)%2===0){indentX=this.getRightMarginHorizPosition(pageWidth,rightMargin,horzAlignment,horzPosition,shapeWidth,textWrapStyle);}else{indentX=this.getLeftMarginHorizPosition(leftMargin,horzAlignment,horzPosition,shapeWidth,textWrapStyle);}break;case'OutsideMargin':if((paragraph.bodyWidget.page.index+1)%2===0){indentX=this.getLeftMarginHorizPosition(leftMargin,horzAlignment,horzPosition,shapeWidth,textWrapStyle);}else{indentX=this.getRightMarginHorizPosition(pageWidth,rightMargin,horzAlignment,horzPosition,shapeWidth,textWrapStyle);}break;default:indentX=this.viewer.clientArea.x+horzPosition;break;}//Update the floating item right position to the page right when floating item 
//right position exceeds the page width and it wrapping style is not equal to  
// InFrontOfText and behind text and also vertical origin is not equal to paragraph.
if(paragraph&&textWrapStyle!=='InFrontOfText'&&textWrapStyle!=='Behind'&&vertOrigin==='Paragraph'&&pageWidth<indentX+shapeWidth){indentX=pageWidth-shapeWidth;}}}}}return new Point(indentX,indentY);};Layout.prototype.getLeftMarginHorizPosition=function(leftMargin,horzAlignment,horzPosition,shapeWidth,textWrapStyle){var indentX=horzPosition;switch(horzAlignment){case'Center':indentX=(leftMargin-shapeWidth)/2;break;case'Left':indentX=0;break;case'Right':indentX=leftMargin-shapeWidth;break;case'None':break;}if(indentX<0&&textWrapStyle!=='InFrontOfText'&&textWrapStyle!=='Behind'){indentX=0;}return indentX;};Layout.prototype.getRightMarginHorizPosition=function(pageWidth,rightMargin,horzAlignment,horzPosition,shapeWidth,textWrapStyle){var xPosition=pageWidth-rightMargin;var indentX=xPosition+horzPosition;switch(horzAlignment){case'Center':indentX=xPosition+(rightMargin-shapeWidth)/2;break;case'Left':indentX=xPosition;break;case'Right':indentX=pageWidth-shapeWidth;break;case'None':break;}if((indentX<0||indentX+shapeWidth>pageWidth)&&textWrapStyle!=='InFrontOfText'&&textWrapStyle!=='Behind'){indentX=pageWidth-shapeWidth;}return indentX;};Layout.prototype.getVerticalPosition=function(paraItem,vertPosition,vertOrigin,textWrapStyle){var paragraph=paraItem.line.paragraph;//ParagraphLayoutInfo paragraphLayoutInfo = (paragraph as IWidget).LayoutInfo as ParagraphLayoutInfo;
var indentY=0;var topMargin=paragraph.associatedCell.y;switch(vertOrigin){case'Page':case'Margin':case'TopMargin':case'InsideMargin':case'BottomMargin':case'OutsideMargin':indentY=topMargin+vertPosition;break;case'Line':case'Paragraph':var space=0;// if (shape) {
//     space = paragraph.paragraphFormat.afterSpacing;
// }
indentY=paragraph.y+vertPosition+space;break;default:indentY=this.viewer.clientActiveArea.y+vertPosition;break;}return indentY;};Layout.prototype.getHorizontalPosition=function(width,paraItem,horzAlignment,horzOrigin,horzPosition,textWrapStyle,cellWid){var indentX=0;var paragraph=paraItem.line.paragraph;// CellLayoutInfo cellLayoutInfo = (paragraph.OwnerTextBody as IWidget).LayoutInfo as CellLayoutInfo;
// ILayoutSpacingsInfo spacings = cellLayoutInfo as ILayoutSpacingsInfo;
var cell=paragraph.associatedCell;var cellWidth=cellWid-cell.leftMargin-cell.rightMargin;var cellInnerWidth=cell.cellFormat.cellWidth;var marginLeft=cell.x;var pageLeft=marginLeft-cell.leftMargin;switch(horzOrigin){case'Page':{indentX=horzPosition;switch(horzAlignment){case'Center':indentX=pageLeft+(cellWidth-width)/2;break;case'Left':indentX=pageLeft;break;case'Right':indentX=pageLeft+(cellWidth-width);break;case'None':indentX=pageLeft+horzPosition;break;}}break;case'Column':case'Margin':{switch(horzAlignment){case'Center':indentX=marginLeft+(cellInnerWidth-width)/2;break;case'Left':indentX=marginLeft;break;case'Right':indentX=marginLeft+(cellInnerWidth-width);break;case'None':indentX=marginLeft+horzPosition;break;}}break;default:{indentX=marginLeft+horzPosition;}break;}return indentX;};Layout.prototype.updateTableFloatPoints=function(table){if(table.wrapTextAround){var tableTotalWidth=table.getTableCellWidth();var position=table.positioning;var sectionFormat=table.bodyWidget.sectionFormat;if(this.documentHelper.viewer instanceof WebLayoutViewer){if(position.horizontalOrigin==='Margin'||position.horizontalOrigin==='Page'||position.horizontalOrigin==='Column'){if(position.horizontalAlignment==='Right'||position.horizontalAlignment==='Outside'){this.viewer.clientActiveArea.x=this.viewer.clientArea.width-tableTotalWidth;}else{this.viewer.clientActiveArea.x=this.viewer.clientArea.x;}}}else{if(!(table.containerWidget instanceof TextFrame)&&!table.isInsideTable){// Vertical position
if(position.verticalOrigin==='Page'){if(position.verticalAlignment==='Top'){this.viewer.clientActiveArea.y=0;}else if(position.verticalAlignment==='Inside'){this.viewer.clientActiveArea.y=0;}else if(sf.base.isNullOrUndefined(position.verticalAlignment)){this.viewer.clientActiveArea.y=HelperMethods.convertPointToPixel(position.verticalPosition);}}else if(position.verticalOrigin==='Margin'){if(position.verticalAlignment==='Top'){this.viewer.clientActiveArea.y=HelperMethods.convertPointToPixel(sectionFormat.topMargin);}else if(position.verticalAlignment==='Inside'){this.viewer.clientActiveArea.y=HelperMethods.convertPointToPixel(sectionFormat.topMargin);}else if(sf.base.isNullOrUndefined(position.verticalAlignment)){this.viewer.clientActiveArea.y=HelperMethods.convertPointToPixel(sectionFormat.topMargin)+HelperMethods.convertPointToPixel(position.verticalPosition);}}else if(position.verticalOrigin==='Paragraph'){if(sf.base.isNullOrUndefined(position.verticalAlignment)){this.viewer.clientActiveArea.y+=HelperMethods.convertPointToPixel(position.verticalPosition);}}if(position.horizontalOrigin==='Page'){if(position.horizontalAlignment==='Left'){this.viewer.clientActiveArea.x=0;}else if(position.horizontalAlignment==='Inside'){// TODO
this.viewer.clientActiveArea.x=0;}else if(position.horizontalAlignment==='Right'){this.viewer.clientActiveArea.x=HelperMethods.convertPointToPixel(sectionFormat.pageWidth)-tableTotalWidth;}else if(position.horizontalAlignment==='Outside'){// TODO
this.viewer.clientActiveArea.x=HelperMethods.convertPointToPixel(sectionFormat.pageWidth)-tableTotalWidth;}}else if(position.horizontalOrigin==='Margin'||position.horizontalOrigin==='Column'){if(position.horizontalAlignment==='Left'){this.viewer.clientActiveArea.x=HelperMethods.convertPointToPixel(sectionFormat.leftMargin);}else if(position.horizontalAlignment==='Inside'){// TODO
this.viewer.clientActiveArea.x=HelperMethods.convertPointToPixel(sectionFormat.leftMargin);}else if(position.horizontalAlignment==='Right'){this.viewer.clientActiveArea.x=HelperMethods.convertPointToPixel(sectionFormat.pageWidth)-(HelperMethods.convertPointToPixel(sectionFormat.rightMargin)+tableTotalWidth);}else if(position.horizontalAlignment==='Outside'){// TODO
this.viewer.clientActiveArea.x=HelperMethods.convertPointToPixel(sectionFormat.pageWidth)-(HelperMethods.convertPointToPixel(sectionFormat.rightMargin)+tableTotalWidth);}}if(Math.round(position.horizontalPosition)>0){this.viewer.clientActiveArea.x+=HelperMethods.convertPointToPixel(position.horizontalPosition);}if(position.horizontalAlignment==='Center'){this.viewer.clientActiveArea.x=HelperMethods.convertPointToPixel(sectionFormat.pageWidth)/2-tableTotalWidth/2;}}else if(table.isInsideTable){var ownerCell=table.containerWidget;var cellFormat=ownerCell.cellFormat;if(position.verticalOrigin==='Page'){this.viewer.clientActiveArea.y=ownerCell.y;this.viewer.clientActiveArea.y+=HelperMethods.convertPointToPixel(position.verticalPosition);}else if(position.verticalOrigin==='Margin'){this.viewer.clientActiveArea.y=ownerCell.y;this.viewer.clientActiveArea.y+=ownerCell.topMargin;this.viewer.clientActiveArea.y+=HelperMethods.convertPointToPixel(position.verticalPosition);}else{this.viewer.clientActiveArea.y+=HelperMethods.convertPointToPixel(position.verticalPosition);}if(position.horizontalOrigin==='Page'){if(position.horizontalAlignment==='Left'||position.horizontalAlignment==='Inside'){this.viewer.clientActiveArea.x=ownerCell.x;}else if(position.horizontalAlignment==='Right'||position.horizontalAlignment==='Outside'){this.viewer.clientActiveArea.x=ownerCell.x+cellFormat.preferredWidth-tableTotalWidth;}}else if(position.horizontalOrigin==='Margin'||position.horizontalOrigin==='Column'){if(position.horizontalAlignment==='Left'||position.horizontalAlignment==='Inside'){this.viewer.clientActiveArea.x=ownerCell.x+ownerCell.leftMargin;}else if(position.horizontalAlignment==='Right'||position.horizontalAlignment==='Outside'){this.viewer.clientActiveArea.x=ownerCell.x+cellFormat.preferredWidth-(tableTotalWidth+ownerCell.rightMargin);}}if(Math.round(position.horizontalPosition)>0){this.viewer.clientActiveArea.x=ownerCell.x;if(position.horizontalOrigin==='Margin'){this.viewer.clientActiveArea.x+=ownerCell.leftMargin;}this.viewer.clientActiveArea.x+=HelperMethods.convertPointToPixel(position.horizontalPosition);}if(position.horizontalAlignment==='Center'){this.viewer.clientActiveArea.x=cellFormat.preferredWidth/2-tableTotalWidth/2;}}}}table.x=this.viewer.clientActiveArea.x;table.y=this.viewer.clientActiveArea.y;};Layout.prototype.cropPosition=function(element){var right=0;var bottom=0;var image=element;image.isCrop=true;if(image.left!==0){image.x=image.left*image.cropWidthScale/100;}if(image.top!==0){image.y=image.top*image.cropHeightScale/100;}if(image.right!==0){right=image.right*image.cropWidthScale/100;}if(image.bottom!==0){bottom=image.bottom*image.cropHeightScale/100;}image.cropWidth=image.cropWidthScale-(image.x+right);image.cropHeight=image.cropHeightScale-(image.y+bottom);};Layout.prototype.isTocField=function(element){if(element instanceof FieldElementBox){var nextElement=element.nextNode;if(element instanceof FieldElementBox&&element.fieldType===0&&nextElement instanceof TextElementBox&&nextElement.text.trim().toLowerCase().indexOf('toc')!==-1){return true;}}return false;};Layout.prototype.getTotalColumnSpan=function(row){var tableRow=row;var totalColumnSpan=0;for(var i=0;i<tableRow.childWidgets.length;i++){totalColumnSpan+=tableRow.childWidgets[i].cellFormat.columnSpan;}return totalColumnSpan;};Layout.prototype.shiftFloatingItemsFromTable=function(table,bodyWidget){if(table.containerWidget instanceof BodyWidget){for(var i=0;i<table.containerWidget.floatingElements.length;i++){var shape=table.containerWidget.floatingElements[i];if(shape.paragraph.containerWidget instanceof TableCellWidget&&shape.paragraph.containerWidget.ownerTable.containerWidget.ownerTable==table){bodyWidget.floatingElements.push(table.containerWidget.floatingElements[i]);table.containerWidget.floatingElements.splice(table.containerWidget.floatingElements.indexOf(table.containerWidget.floatingElements[i]),1);this.shiftedFloatingItemsFromTable.push(shape);i--;}}}};return Layout;}();/**
 * @private
 */var Renderer=/** @class */function(){function Renderer(documentHelper){this.isPrinting=false;this.pageLeft=0;this.pageTop=0;this.pageIndex=-1;this.isFieldCode=false;this.leftPosition=0;this.topPosition=0;this.height=0;this.documentHelper=documentHelper;}Object.defineProperty(Renderer.prototype,"pageCanvas",{get:function get(){if(this.isPrinting){if(sf.base.isNullOrUndefined(this.pageCanvasIn)){this.pageCanvasIn=document.createElement('canvas');this.pageCanvasIn.getContext('2d').save();}return this.pageCanvasIn;}return sf.base.isNullOrUndefined(this.viewer)?undefined:this.documentHelper.containerCanvas;},enumerable:true,configurable:true});Object.defineProperty(Renderer.prototype,"spellChecker",{get:function get(){return this.documentHelper.owner.spellChecker;},enumerable:true,configurable:true});Object.defineProperty(Renderer.prototype,"selectionCanvas",{get:function get(){return sf.base.isNullOrUndefined(this.viewer)?undefined:this.documentHelper.selectionCanvas;},enumerable:true,configurable:true});Object.defineProperty(Renderer.prototype,"pageContext",{get:function get(){return this.pageCanvas.getContext('2d');},enumerable:true,configurable:true});Object.defineProperty(Renderer.prototype,"selectionContext",{get:function get(){return this.selectionCanvas.getContext('2d');},enumerable:true,configurable:true});Object.defineProperty(Renderer.prototype,"viewer",{get:function get(){return this.documentHelper.owner.viewer;},enumerable:true,configurable:true});Renderer.prototype.renderWidgets=function(page,left,top,width,height){if(sf.base.isNullOrUndefined(this.pageCanvas)||sf.base.isNullOrUndefined(page)){return;}this.pageContext.fillStyle=HelperMethods.getColor(this.documentHelper.backgroundColor);this.pageContext.beginPath();if(this.viewer instanceof WebLayoutViewer){height=height>this.documentHelper.visibleBounds.height?height:this.documentHelper.visibleBounds.height;var marginTop=top;if(page.index===0){marginTop=top-this.viewer.padding.top;}// eslint-disable-next-line max-len
this.pageContext.fillRect(left-this.viewer.padding.left,marginTop,width+this.viewer.padding.left,height+this.viewer.padding.top);}else{this.pageContext.fillRect(left,top,width,height);}this.pageContext.closePath();if(this.viewer instanceof PageLayoutViewer){this.pageContext.strokeStyle=this.documentHelper.owner.pageOutline;this.pageContext.strokeRect(left,top,width,height);}this.pageLeft=left;this.pageTop=top;this.pageIndex=page.index;if(this.isPrinting){this.setPageSize(page);}else{this.pageContext.beginPath();this.pageContext.save();this.pageContext.rect(left,top,width,height);this.pageContext.clip();}this.height=height;if(page.headerWidget){this.renderHFWidgets(page,page.headerWidget,width,true);}if(page.footerWidget){this.renderHFWidgets(page,page.footerWidget,width,false);}for(var i=0;i<page.bodyWidgets.length;i++){this.render(page,page.bodyWidgets[i]);if(page.footnoteWidget&&this.documentHelper.owner.layoutType==='Pages'){this.renderfootNoteWidget(page,page.footnoteWidget);}}if(page.endnoteWidget&&this.documentHelper.owner.layoutType==='Pages'){this.renderfootNoteWidget(page,page.endnoteWidget);}if(this.documentHelper.owner.enableHeaderAndFooter&&!this.isPrinting){this.renderHeaderSeparator(page,this.pageLeft,this.pageTop,page.headerWidget);}this.pageLeft=0;this.pageTop=0;this.pageContext.restore();};Renderer.prototype.setPageSize=function(page){this.pageContext.clearRect(0,0,this.pageCanvas.width,this.pageCanvas.height);this.selectionContext.clearRect(0,0,this.selectionCanvas.width,this.selectionCanvas.height);this.pageContext.restore();this.selectionContext.restore();var width=page.boundingRectangle.width;var height=page.boundingRectangle.height;var dpr=Math.max(window.devicePixelRatio,this.documentHelper.owner.documentEditorSettings.printDevicePixelRatio);if(this.pageCanvas.width!==width*dpr||this.pageCanvas.height!==height*dpr){this.pageCanvas.height=height*dpr;this.pageCanvas.width=width*dpr;this.pageCanvas.style.height=height+'px';this.pageCanvas.style.width=width+'px';this.pageContext.globalAlpha=1;this.pageContext.scale(dpr,dpr);}};Renderer.prototype.renderHFWidgets=function(page,widget,width,isHeader){if(!this.isPrinting){this.pageContext.globalAlpha=this.documentHelper.owner.enableHeaderAndFooter?1:0.65;}var cliped=false;var height=0;var pageHt=0;var headerFooterHeight=page.boundingRectangle.height/100*40;if(isHeader){var topMargin=HelperMethods.convertPointToPixel(page.bodyWidgets[0].sectionFormat.topMargin);var widgetHeight=Math.max(widget.y+widget.height,topMargin);if(widgetHeight>headerFooterHeight){cliped=true;this.pageContext.beginPath();this.pageContext.save();this.pageContext.rect(this.pageLeft,this.pageTop,width,this.getScaledValue(headerFooterHeight));this.pageContext.clip();}}else{var footerDistance=HelperMethods.convertPointToPixel(page.bodyWidgets[0].sectionFormat.footerDistance);var footerHeight=page.boundingRectangle.height-// eslint-disable-next-line max-len
Math.max(page.footerWidget.height+footerDistance,HelperMethods.convertPointToPixel(page.footerWidget.sectionFormat.bottomMargin));height=Math.max(page.boundingRectangle.height-headerFooterHeight,footerHeight);pageHt=page.boundingRectangle.height-footerDistance;}this.renderFloatingItems(page,widget.floatingElements,'Behind');for(var i=0;i<widget.childWidgets.length;i++){var block=widget.childWidgets[i];if(!isHeader){height+=block.height;}if(isHeader||!isHeader&&this.getScaledValue(Math.round(height))<=this.getScaledValue(Math.round(pageHt))){this.renderWidget(page,block);}}this.renderFloatingItems(page,widget.floatingElements,"InFrontOfText");if(cliped){this.pageContext.restore();}if(!this.isPrinting){this.pageContext.globalAlpha=this.documentHelper.owner.enableHeaderAndFooter?0.65:1;}};Renderer.prototype.renderHeaderSeparator=function(page,left,top,widget){//Header Widget
var topMargin=HelperMethods.convertPointToPixel(page.bodyWidgets[0].sectionFormat.topMargin);var y=this.getScaledValue(Math.max(widget.y+widget.height,topMargin));var pageWidth=this.getScaledValue(page.boundingRectangle.width);var ctx=this.pageContext;ctx.save();ctx.globalAlpha=0.65;var headerFooterHeight=this.getScaledValue(page.boundingRectangle.height)/100*40;//Maximum header height limit
y=Math.min(y,headerFooterHeight);//Dash line Separator
this.renderDashLine(ctx,left,top+y,pageWidth,'#000000',false);var type=this.getHeaderFooterType(page,true);ctx.font='9pt Arial';var width=ctx.measureText(type).width;this.renderHeaderFooterMark(ctx,left+5,top+y,width+10,20);this.renderHeaderFooterMarkText(ctx,type,left+10,y+top+15);if(page.footerWidget){//Footer Widget
var footerDistance=HelperMethods.convertPointToPixel(page.bodyWidgets[0].sectionFormat.footerDistance);var footerHeight=this.getScaledValue(page.boundingRectangle.height)-// eslint-disable-next-line max-len
this.getScaledValue(Math.max(page.footerWidget.height+footerDistance,HelperMethods.convertPointToPixel(page.footerWidget.sectionFormat.bottomMargin)));//Maximum footer height limit
footerHeight=Math.max(this.getScaledValue(page.boundingRectangle.height)-headerFooterHeight,footerHeight);this.renderDashLine(ctx,left,top+footerHeight,pageWidth,'#000000',false);type=this.getHeaderFooterType(page,false);width=ctx.measureText(type).width;this.renderHeaderFooterMark(ctx,left+5,top+footerHeight-20,width+10,20);this.renderHeaderFooterMarkText(ctx,type,left+10,top+footerHeight-5);ctx.restore();}};Renderer.prototype.getHeaderFooterType=function(page,isHeader){var type;type=isHeader?'Header':'Footer';if(page.bodyWidgets[0].sectionFormat.differentFirstPage&&(sf.base.isNullOrUndefined(page.previousPage)||page.sectionIndex!==page.previousPage.sectionIndex)){type=isHeader?'First Page Header':'First Page Footer';}else if(page.bodyWidgets[0].sectionFormat.differentOddAndEvenPages){if((this.documentHelper.pages.indexOf(page)+1)%2===0){type=isHeader?'Even Page Header':'Even Page Footer';}else{type=isHeader?'Odd Page Header':'Odd Page Footer';}}return type;};// eslint-disable-next-line max-len
Renderer.prototype.renderDashLine=function(context,x,y,width,fillStyle,isSmallDash){context.beginPath();context.strokeStyle=fillStyle;context.lineWidth=1;if(isSmallDash){context.setLineDash([3,2]);}else{context.setLineDash([6,4]);}context.moveTo(x,y);context.lineTo(x+width,y);context.stroke();context.setLineDash([]);context.closePath();};Renderer.prototype.renderSolidLine=function(context,x,y,width,fillStyle){context.beginPath();context.strokeStyle=fillStyle;context.lineWidth=0.5;context.moveTo(x,y);context.lineTo(x+width,y);context.stroke();context.closePath();};Renderer.prototype.renderHeaderFooterMark=function(ctx,x,y,w,h){ctx.beginPath();ctx.fillStyle='lightgray';ctx.fillRect(x,y,w,h);ctx.strokeStyle='black';ctx.strokeRect(x,y,w,h);ctx.closePath();};Renderer.prototype.renderHeaderFooterMarkText=function(ctx,content,x,y){ctx.beginPath();ctx.fillStyle='#000000';ctx.textBaseline='alphabetic';ctx.fillText(content,x,y);ctx.closePath();};Renderer.prototype.render=function(page,bodyWidget){if(this.isFieldCode){this.isFieldCode=false;}this.renderFloatingItems(page,page.bodyWidgets[0].floatingElements,'Behind');for(var i=0;i<bodyWidget.childWidgets.length;i++){var widget=bodyWidget.childWidgets[i];if(i===0&&bodyWidget.childWidgets[0]instanceof TableWidget&&bodyWidget.childWidgets[0].childWidgets.length>0&&(bodyWidget.childWidgets[0].childWidgets[0].rowFormat.isHeader||page.repeatHeaderRowTableWidget)){// eslint-disable-next-line max-len
this.renderHeader(page,widget,this.documentHelper.layout.getHeader(bodyWidget.childWidgets[0]));}this.renderWidget(page,widget);}this.renderFloatingItems(page,page.bodyWidgets[0].floatingElements,'InFrontOfText');};Renderer.prototype.renderFloatingItems=function(page,floatingElements,wrappingType){if(!sf.base.isNullOrUndefined(floatingElements)&&floatingElements.length>0){/* eslint-disable */floatingElements.sort(function(a,b){if(a instanceof TableWidget||b instanceof TableWidget){return 0;}else{return a.zOrderPosition-b.zOrderPosition;}});for(var i=0;i<floatingElements.length;i++){if(floatingElements[i]instanceof TableWidget){continue;}var shape=floatingElements[i];if(wrappingType==="Behind"&&shape.textWrappingStyle!=="Behind"||wrappingType!=="Behind"&&shape.textWrappingStyle==="Behind"){continue;}if(shape instanceof ImageElementBox){this.renderImageElementBox(shape,shape.x,shape.y,0);}else if(shape instanceof ShapeElementBox){var shapeLeft=this.getScaledValue(shape.x,1);var shapeTop=this.getScaledValue(shape.y,2);this.renderShapeElementBox(shape,shapeLeft,shapeTop,page);}}}};Renderer.prototype.renderShapeElementBox=function(shape,shapeLeft,shapeTop,page){var isZeroShapeHeight=shape.height===0?true:false;var shapeType=shape.autoShapeType;var blocks=shape.textFrame.childWidgets;this.pageContext.beginPath();if(shape.fillFormat&&shape.fillFormat.color&&shape.fillFormat.fill){this.pageContext.fillStyle=shape.fillFormat.color;this.pageContext.fillRect(shapeLeft,shapeTop,this.getScaledValue(shape.width),this.getScaledValue(shape.height));}if(!sf.base.isNullOrUndefined(shapeType)){if(shape.lineFormat.line&&shape.lineFormat.lineFormatType!=='None'||!sf.base.isNullOrUndefined(shape.lineFormat.lineFormatType)&&shape.lineFormat.lineFormatType!=='None'){this.pageContext.lineWidth=shape.lineFormat.weight;this.pageContext.strokeStyle=HelperMethods.getColor(shape.lineFormat.color);this.pageContext.strokeRect(shapeLeft,shapeTop,this.getScaledValue(shape.width),this.getScaledValue(shape.height));}}this.pageContext.closePath();var isClipped=false;if(shape.width!=0&&shape.height!=0){isClipped=true;this.clipRect(shape.x,shape.y,this.getScaledValue(shape.width),this.getScaledValue(shape.height));}for(var i=0;i<blocks.length;i++){this.renderWidget(page,blocks[i]);if(isZeroShapeHeight&&shapeType!=='StraightConnector'){shape.height+=blocks[i].height;}}if(isZeroShapeHeight){isZeroShapeHeight=false;}if(isClipped){this.pageContext.restore();}};Renderer.prototype.renderWidget=function(page,widget){// if (this.documentHelper.owner.enableLockAndEdit) {
//     this.renderLockRegionBorder(page, widget);
// }
if(widget instanceof ParagraphWidget){this.renderParagraphWidget(page,widget);}else{this.renderTableWidget(page,widget);}};// private renderLockRegionBorder(page: Page, widget: Widget) {
//     if (!(widget as BlockWidget).isInsideTable && widget instanceof BlockWidget && widget.locked) {
//         let settinsModel: CollaborativeEditingSettingsModel = this.documentHelper.owner.documentEditorSettings.collaborativeEditingSettings;
//         let sectionFormat: WSectionFormat = page.bodyWidgets[0].sectionFormat;
//         let leftPosition: number = HelperMethods.convertPointToPixel(sectionFormat.leftMargin) - 5;
//         let pageWidth: number = sectionFormat.pageWidth - sectionFormat.leftMargin - sectionFormat.rightMargin;
//         pageWidth = HelperMethods.convertPointToPixel(pageWidth) + 10;
//         if (this.viewer instanceof WebLayoutViewer) {
//             leftPosition = widget.x - 5
//             pageWidth = (this.documentHelper.visibleBounds.width - (this.viewer.padding.right * 5)) / this.documentHelper.zoomFactor;
//         }
//         let previousWidget: BlockWidget = widget.previousRenderedWidget as BlockWidget;
//         let nextWidget: BlockWidget = widget.nextRenderedWidget as BlockWidget;
//         let color: string = widget.lockedBy === this.documentHelper.owner.currentUser ? settinsModel.editableRegionColor : settinsModel.lockedRegionColor;
//         let topPosition: number = widget.y
//         let height: number = widget.y + widget.height;
//         //Left border
//         this.renderSingleBorder(color, leftPosition, topPosition, leftPosition, height, 1);
//         //Top border
//         if (isNullOrUndefined(previousWidget) || !previousWidget.locked || widget.lockedBy !== previousWidget.lockedBy) {
//             this.renderSingleBorder(color, leftPosition, topPosition, leftPosition + pageWidth, topPosition, 1);
//         }
//         //Right border
//         this.renderSingleBorder(color, leftPosition + pageWidth, topPosition, leftPosition + pageWidth, height, 1);
//         if (isNullOrUndefined(nextWidget) || !nextWidget.locked || widget.lockedBy !== nextWidget.lockedBy) {
//             // Bottom border
//             this.renderSingleBorder(color, leftPosition, height, leftPosition + pageWidth, height, 1);
//         }
//     }
// }
Renderer.prototype.renderHeader=function(page,widget,header){if(sf.base.isNullOrUndefined(header)){return;}//Updated client area for current page
page.viewer.updateClientArea(page.bodyWidgets[0].sectionFormat,page);var top=page.viewer.clientArea.y;var parentTable=header.ownerTable.getSplitWidgets()[0];for(var i=0;i<=header.rowIndex;i++){if(parentTable.childWidgets.length===0){return;}var row=parentTable.childWidgets[i];var headerWidget=row.clone();headerWidget.containerWidget=row.containerWidget;page.viewer.updateClientAreaLocation(headerWidget,new Rect(page.viewer.clientArea.x,top,headerWidget.width,headerWidget.height));page.documentHelper.layout.updateChildLocationForRow(top,headerWidget);var cell=undefined;//Renders table cell outline rectangle - Border and background color.
for(var j=0;j<headerWidget.childWidgets.length;j++){cell=headerWidget.childWidgets[j];this.renderTableCellWidget(page,cell);}top+=headerWidget.height;}if(widget.y!==top){//this.Location.Y = top;
page.documentHelper.layout.updateChildLocationForTable(top,widget);}};Renderer.prototype.renderParagraphWidget=function(page,paraWidget){var top=paraWidget.y;var left=paraWidget.x;for(var i=0;i<paraWidget.childWidgets.length;i++){var widget=paraWidget.childWidgets[i];top+=widget.marginTop;this.renderLine(widget,page,left,top);top+=widget.height;}};Renderer.prototype.renderfootNoteWidget=function(page,paraWidget){for(var i=0;i<paraWidget.childWidgets.length;i++){var widget=paraWidget.childWidgets[i];if(i===0){var ctx=this.pageContext;this.renderSolidLine(ctx,this.getScaledValue(widget.x,1),this.getScaledValue(widget.y+widget.height/2,2),300*this.documentHelper.zoomFactor,'#000000');continue;}if(!sf.base.isNullOrUndefined(widget.footNoteReference)&&widget.childWidgets[0].children[0]instanceof TextElementBox){if(i<2||i>1&&widget.footNoteReference!==paraWidget.childWidgets[i-1].footNoteReference){widget.childWidgets[0].children[0].text=widget.childWidgets[0].children[0].text.replace(widget.childWidgets[0].children[0].text,widget.footNoteReference.text);}}this.renderWidget(page,widget);}};Renderer.prototype.renderTableWidget=function(page,tableWidget){if(this.isFieldCode){return;}for(var i=0;i<tableWidget.childWidgets.length;i++){var widget=tableWidget.childWidgets[i];this.renderTableRowWidget(page,widget);if(tableWidget.tableFormat.cellSpacing>0){this.renderTableOutline(tableWidget);}}};Renderer.prototype.renderTableRowWidget=function(page,rowWidget){for(var i=0;i<rowWidget.childWidgets.length;i++){var widget=rowWidget.childWidgets[i];this.renderTableCellWidget(page,widget);}};Renderer.prototype.renderTableCellWidget=function(page,cellWidget){if(!this.isPrinting){if(this.getScaledValue(cellWidget.y,2)+cellWidget.height*this.documentHelper.zoomFactor<0||this.getScaledValue(cellWidget.y,2)>this.documentHelper.visibleBounds.height){return;}}if(!this.isPrinting&&page.documentHelper.owner.selection&&page.documentHelper.owner.selection.selectedWidgets.length>0){page.documentHelper.owner.selection.addSelectionHighlightTable(this.selectionContext,cellWidget);}this.renderTableCellOutline(page.documentHelper,cellWidget);for(var i=0;i<cellWidget.childWidgets.length;i++){var widget=cellWidget.childWidgets[i];// MS word render the content in right margin also.
// So, we need to add right margin value while cliping the content
var width=cellWidget.width+cellWidget.margin.left+cellWidget.margin.right-cellWidget.leftBorderWidth;if(!this.isPrinting){this.clipRect(cellWidget.x-cellWidget.margin.left,cellWidget.y,this.getScaledValue(width),this.getScaledValue(this.height));}this.renderWidget(page,widget);this.pageContext.restore();}};Renderer.prototype.renderLine=function(lineWidget,page,left,top){if(!this.isPrinting&&page.documentHelper.owner.selection&&!this.documentHelper.isScrollToSpellCheck&&page.documentHelper.owner.selection.selectedWidgets.length>0){page.documentHelper.owner.selection.addSelectionHighlight(this.selectionContext,lineWidget,top);}var paraFormat=lineWidget.paragraph.paragraphFormat;if(lineWidget.isFirstLine()&&!paraFormat.bidi){left+=HelperMethods.convertPointToPixel(paraFormat.firstLineIndent);}if(this.documentHelper&&this.documentHelper.selection&&!sf.base.isNullOrUndefined(this.documentHelper.selection.formFieldHighlighters)&&this.documentHelper.selection.formFieldHighlighters.containsKey(lineWidget)){if(this.documentHelper.owner.documentEditorSettings&&this.documentHelper.owner.documentEditorSettings.formFieldSettings.applyShading){var widgetInfo=page.documentHelper.selection.formFieldHighlighters.get(lineWidget);for(var i=0;i<widgetInfo.length;i++){this.pageContext.fillStyle=this.documentHelper.owner.documentEditorSettings.formFieldSettings.shadingColor;var height=lineWidget.height;var isLastLine=lineWidget.isLastLine();if(isLastLine){height=height-HelperMethods.convertPointToPixel(this.documentHelper.layout.getAfterSpacing(lineWidget.paragraph));if(lineWidget.paragraph.paragraphFormat.lineSpacing>1){var formField=this.getFormfieldInLine(lineWidget);var sizeInfo=this.documentHelper.textHelper.getHeight(formField.characterFormat);var maxHeight=sizeInfo.Height;height=height-HelperMethods.convertPointToPixel(this.documentHelper.layout.getLineSpacing(lineWidget.paragraph,maxHeight,true));}}this.pageContext.fillRect(this.getScaledValue(widgetInfo[i].left,1),this.getScaledValue(top,2),this.getScaledValue(widgetInfo[i].width),this.getScaledValue(height));}}}if(this.documentHelper.owner.searchModule){if(!sf.base.isNullOrUndefined(page.documentHelper.owner.searchModule.searchHighlighters)&&page.documentHelper.owner.searchModule.searchHighlighters.containsKey(lineWidget)){var widgetInfo=page.documentHelper.owner.searchModule.searchHighlighters.get(lineWidget);for(var i=0;i<widgetInfo.length;i++){this.pageContext.fillStyle=this.viewer.owner.documentEditorSettings.searchHighlightColor;this.pageContext.fillRect(this.getScaledValue(widgetInfo[i].left,1),this.getScaledValue(top,2),this.getScaledValue(widgetInfo[i].width),this.getScaledValue(lineWidget.height));}}}// EditRegion highlight 
if(page.documentHelper.selection&&!sf.base.isNullOrUndefined(page.documentHelper.selection.editRegionHighlighters)&&page.documentHelper.selection.editRegionHighlighters.containsKey(lineWidget)){var widgetInfo=page.documentHelper.selection.editRegionHighlighters.get(lineWidget);for(var i=0;i<widgetInfo.length;i++){this.pageContext.fillStyle=widgetInfo[i].color!==''?widgetInfo[i].color:'#add8e6';this.pageContext.fillRect(this.getScaledValue(widgetInfo[i].left,1),this.getScaledValue(top,2),this.getScaledValue(widgetInfo[i].width),this.getScaledValue(lineWidget.height));}}var isCommentMark=false;for(var i=0;i<lineWidget.children.length;i++){var elementBox=lineWidget.children[i];if(elementBox instanceof ShapeBase&&elementBox.textWrappingStyle!=='Inline'){continue;}if(elementBox instanceof CommentCharacterElementBox||elementBox instanceof EditRangeStartElementBox){var pageGap=0;if(this.viewer instanceof PageLayoutViewer){pageGap=this.viewer.pageGap;}var style='display:block;position:absolute;';if(elementBox instanceof CommentCharacterElementBox&&elementBox.commentType===0&&this.documentHelper.owner.selectionModule){if(this.documentHelper.owner.enableComment&&!isCommentMark){isCommentMark=true;elementBox.renderCommentMark();var rightMargin=HelperMethods.convertPointToPixel(page.bodyWidgets[0].sectionFormat.rightMargin);var pageWidth=HelperMethods.convertPointToPixel(page.bodyWidgets[0].sectionFormat.pageWidth);var leftPosition=page.boundingRectangle.x+this.getScaledValue(pageWidth-rightMargin+rightMargin/4)+'px;';if(this.viewer instanceof WebLayoutViewer){leftPosition=page.boundingRectangle.width-this.viewer.padding.right*2-this.viewer.padding.left*2+'px;';}var topPosition=this.getScaledValue(top-10+(page.boundingRectangle.y-pageGap*(page.index+1)))+pageGap*(page.index+1)+'px;';style=style+'left:'+leftPosition+'top:'+topPosition;elementBox.commentMark.setAttribute('style',style);}else{if(elementBox.commentMark){elementBox.commentMark.setAttribute('style','display:none');}}}}if(elementBox instanceof FieldElementBox||this.isFieldCode||elementBox.width===0&&elementBox.height===0){if(this.isFieldCode){elementBox.width=0;}left+=elementBox.width+elementBox.margin.left;this.toSkipFieldCode(elementBox);continue;}var underlineY=this.getUnderlineYPosition(lineWidget);if(!this.isPrinting){if(this.getScaledValue(top+elementBox.margin.top,2)+elementBox.height*this.documentHelper.zoomFactor<0||this.getScaledValue(top+elementBox.margin.top,2)>this.documentHelper.visibleBounds.height){left+=elementBox.width+elementBox.margin.left;if(elementBox instanceof TextElementBox){elementBox.canTrigger=true;elementBox.isVisible=false;if(!elementBox.isSpellChecked||elementBox.line.paragraph.isChangeDetected){elementBox.ischangeDetected=true;}}continue;}}if(elementBox instanceof ListTextElementBox){this.renderListTextElementBox(elementBox,left,top,underlineY);}else if(elementBox instanceof ImageElementBox){this.renderImageElementBox(elementBox,left,top,underlineY);}else if(elementBox instanceof ShapeElementBox){var shapeLeft=this.getScaledValue(left,1);var shapeTop=this.getScaledValue(top,2);this.renderShapeElementBox(elementBox,shapeLeft,shapeTop,page);}else{elementBox.isVisible=true;left+=elementBox.padding.left;this.renderTextElementBox(elementBox,left,top,underlineY);}left+=elementBox.width+elementBox.margin.left;}};Renderer.prototype.toSkipFieldCode=function(element){if(element instanceof FieldElementBox){if(element.fieldType===0){if(!sf.base.isNullOrUndefined(element.fieldEnd)||element.hasFieldEnd){this.isFieldCode=true;}}else if(element.fieldType===2||element.fieldType===1){this.isFieldCode=false;}}};Renderer.prototype.getUnderlineYPosition=function(lineWidget){var height=0;var lineHeight=0;for(var i=0;i<lineWidget.children.length;i++){if(lineWidget.children[i]instanceof FieldElementBox||lineWidget.children[i].width===0&&lineWidget.children[i].height===0){continue;}if(lineWidget.children[i]instanceof ShapeElementBox){continue;}else{if(height<lineWidget.children[i].height+lineWidget.children[i].margin.top){height=lineWidget.children[i].margin.top+lineWidget.children[i].height;lineHeight=lineWidget.children[i]instanceof ImageElementBox?0.9:lineWidget.children[i].height/20;}}}return height-2*lineHeight;};Renderer.prototype.renderListTextElementBox=function(elementBox,left,top,underlineY){var topMargin=elementBox.margin.top;var leftMargin=elementBox.margin.left;var format=elementBox.listLevel.characterFormat;var breakCharacterFormat=elementBox.line.paragraph.characterFormat;var color=format.hasValue('fontColor')?format.fontColor:breakCharacterFormat.fontColor;this.pageContext.textBaseline='alphabetic';var bold='';var italic='';var fontFamily=format.hasValue('fontFamily')?format.fontFamily:breakCharacterFormat.fontFamily;if(this.documentHelper.isIosDevice&&(elementBox.text==="\u25CF"||elementBox.text==="\u25CB")){fontFamily='';}var fontSize=format.hasValue('fontSize')?format.fontSize:breakCharacterFormat.fontSize;var baselineAlignment=format.hasValue('baselineAlignment')?format.baselineAlignment:breakCharacterFormat.baselineAlignment;bold=format.hasValue('bold')?format.bold?'bold':'':breakCharacterFormat.bold?'bold':'';italic=format.hasValue('italic')?format.italic?'italic':'':breakCharacterFormat.italic?'italic':'';fontSize=fontSize===0?0.5:fontSize/(baselineAlignment==='Normal'?1:1.5);fontSize=this.isPrinting?fontSize:fontSize*this.documentHelper.zoomFactor;var strikethrough=format.hasValue('strikethrough')?format.strikethrough:breakCharacterFormat.strikethrough;var highlightColor=format.hasValue('highlightColor')?format.highlightColor:breakCharacterFormat.highlightColor;if(highlightColor!=='NoColor'){if(highlightColor.substring(0,1)!=='#'){this.pageContext.fillStyle=HelperMethods.getHighlightColorCode(highlightColor);}else{this.pageContext.fillStyle=HelperMethods.getColor(highlightColor);}this.pageContext.fillRect(this.getScaledValue(left+leftMargin,1),this.getScaledValue(top+topMargin,2),this.getScaledValue(elementBox.width),this.getScaledValue(elementBox.height));}this.pageContext.font=bold+' '+italic+' '+fontSize+'pt'+' '+fontFamily;if(baselineAlignment==='Subscript'){topMargin+=elementBox.height-elementBox.height/1.5;}var baselineOffset=elementBox.baselineOffset;topMargin=format.baselineAlignment==='Normal'?topMargin+baselineOffset:topMargin+baselineOffset/1.5;var text=elementBox.text;var followCharacter=text==='\t'||text===' ';if(!followCharacter&&(format.bidi||elementBox.line.paragraph.paragraphFormat.bidi)){var index=text.indexOf('.');text=text.substr(index)+text.substring(0,index);}// "empty" is old value used for auto color till v19.2.49. It is maintained for backward compatibility.
if(color==="empty"||color==='#00000000'){var bgColor=this.getBackgroundColorHeirachy(elementBox);this.pageContext.fillStyle=this.getDefaultFontColor(bgColor);}else{this.pageContext.fillStyle=HelperMethods.getColor(color);}this.pageContext.fillText(text,this.getScaledValue(left+leftMargin,1),this.getScaledValue(top+topMargin,2),this.getScaledValue(elementBox.width));if(format.underline!=='None'&&!sf.base.isNullOrUndefined(format.underline)){this.renderUnderline(elementBox,left,top,underlineY,color,format.underline,baselineAlignment);}if(strikethrough!=='None'){this.renderStrikeThrough(elementBox,left,top,format.strikethrough,color,baselineAlignment);}};Renderer.prototype.getDefaultFontColor=function(backColor){if(HelperMethods.isVeryDark(backColor)){return"#FFFFFF";}else{return"#000000";}};Renderer.prototype.renderTextElementBox=function(elementBox,left,top,underlineY){var isHeightType=false;var containerWidget=elementBox.line.paragraph.containerWidget;if(containerWidget instanceof TableCellWidget){isHeightType=containerWidget.ownerRow.rowFormat.heightType==='Exactly';}var topMargin=elementBox.margin.top;var leftMargin=elementBox.margin.left;if(isHeightType&&containerWidget instanceof TableCellWidget){var width=containerWidget.width+containerWidget.margin.left+containerWidget.margin.right-containerWidget.leftBorderWidth;this.clipRect(containerWidget.x-containerWidget.margin.left,containerWidget.y,this.getScaledValue(width),this.getScaledValue(containerWidget.height));}var format=elementBox.characterFormat;if(format.highlightColor!=='NoColor'){if(format.highlightColor.substring(0,1)!=='#'){this.pageContext.fillStyle=HelperMethods.getHighlightColorCode(format.highlightColor);}else{this.pageContext.fillStyle=HelperMethods.getColor(format.highlightColor);}this.pageContext.fillRect(this.getScaledValue(left+leftMargin,1),this.getScaledValue(top+topMargin,2),this.getScaledValue(elementBox.width),this.getScaledValue(elementBox.height));}var revisionInfo=this.checkRevisionType(elementBox);var color=revisionInfo.length>0?this.getRevisionColor(revisionInfo):format.fontColor;this.pageContext.textBaseline='alphabetic';var bold='';var italic='';var fontSize=11;bold=format.bold?'bold':'';italic=format.italic?'italic':'';fontSize=format.fontSize===0?0.5:format.fontSize/(format.baselineAlignment==='Normal'?1:1.5);fontSize=this.isPrinting?fontSize:fontSize*this.documentHelper.zoomFactor;this.pageContext.font=bold+' '+italic+' '+fontSize+'pt'+' '+format.fontFamily;if(format.baselineAlignment==='Subscript'){topMargin+=elementBox.height-elementBox.height/1.5;}var baselineOffset=elementBox.baselineOffset;topMargin=format.baselineAlignment==='Normal'?topMargin+baselineOffset:topMargin+baselineOffset/1.5;if(color==="empty"||color==='#00000000'){var bgColor=this.getBackgroundColorHeirachy(elementBox);this.pageContext.fillStyle=this.getDefaultFontColor(bgColor);}else{this.pageContext.fillStyle=HelperMethods.getColor(color);}var scaledWidth=this.getScaledValue(elementBox.width);var text=elementBox.text;if(elementBox instanceof TabElementBox){var tabElement=elementBox;if(tabElement.tabText===''&&!sf.base.isNullOrUndefined(tabElement.tabLeader)&&tabElement.tabLeader!=='None'){text=this.getTabLeader(elementBox);tabElement.tabText=text;}else if(tabElement.tabText!==''){text=tabElement.tabText;}}var isRTL=format.bidi||this.documentHelper.textHelper.isRTLText(elementBox.text);text=this.documentHelper.textHelper.setText(text,isRTL,format.bdo,true);if(format.allCaps){text=text.toUpperCase();}this.pageContext.fillText(text,this.getScaledValue(left+leftMargin,1),this.getScaledValue(top+topMargin,2),scaledWidth);if(this.documentHelper.owner.isSpellCheck&&!this.spellChecker.removeUnderline&&(this.documentHelper.triggerSpellCheck||elementBox.canTrigger)&&elementBox.text!==' '&&!this.documentHelper.isScrollHandler&&(sf.base.isNullOrUndefined(elementBox.previousNode)||!(elementBox.previousNode instanceof FieldElementBox))){elementBox.canTrigger=true;this.leftPosition=this.pageLeft;this.topPosition=this.pageTop;var errorDetails=this.spellChecker.checktextElementHasErrors(elementBox.text,elementBox,left);if(errorDetails.errorFound){color='#FF0000';for(var i=0;i<errorDetails.elements.length;i++){var currentElement=errorDetails.elements[i];if(elementBox.ignoreOnceItems.indexOf(this.spellChecker.manageSpecialCharacters(currentElement.text,undefined,true))===-1){var backgroundColor=containerWidget instanceof TableCellWidget?containerWidget.cellFormat.shading.backgroundColor:this.documentHelper.backgroundColor;this.renderWavyLine(currentElement,sf.base.isNullOrUndefined(currentElement.start)?left:currentElement.start.location.x,sf.base.isNullOrUndefined(currentElement.start)?top:currentElement.start.location.y-elementBox.margin.top,underlineY,color,'Single',format.baselineAlignment,backgroundColor);}}}else if(elementBox.ischangeDetected||this.documentHelper.triggerElementsOnLoading){elementBox.ischangeDetected=false;this.handleChangeDetectedElements(elementBox,underlineY,left,top,format.baselineAlignment);}}var currentInfo=this.getRevisionType(revisionInfo,true);if(format.underline!=='None'&&!sf.base.isNullOrUndefined(format.underline)||!sf.base.isNullOrUndefined(currentInfo)&&(currentInfo.type==='Insertion'||currentInfo.type==='MoveTo')){this.renderUnderline(elementBox,left,top,underlineY,color,format.underline,format.baselineAlignment,currentInfo);}currentInfo=this.getRevisionType(revisionInfo,false);if(format.strikethrough!=='None'&&!sf.base.isNullOrUndefined(format.strikethrough)||!sf.base.isNullOrUndefined(currentInfo)&&(currentInfo.type==='Deletion'||currentInfo.type==='MoveFrom')){this.renderStrikeThrough(elementBox,left,top,format.strikethrough,color,format.baselineAlignment,currentInfo);}if(isHeightType){this.pageContext.restore();}};Renderer.prototype.getBackgroundColorHeirachy=function(element){var bgColor;// "empty" is old value used for auto color till v19.2.49. It is maintained for backward compatibility.
if(element.paragraph.isInsideTable){var cell=element.paragraph.containerWidget;bgColor=cell.cellFormat.shading.backgroundColor;if(bgColor!=="empty"&&bgColor!=='#00000000'){return bgColor;}else{bgColor=cell.ownerTable.tableFormat.shading.backgroundColor;if(bgColor!=="empty"&&bgColor!=='#00000000'){return bgColor;}}}return this.documentHelper.backgroundColor;};Renderer.prototype.handleChangeDetectedElements=function(elementBox,underlineY,left,top,baselineAlignment){var _this=this;var checkText=elementBox.text.trim();var beforeIndex=this.pageIndex;if(elementBox.text==='\v'){return;}if(!this.spellChecker.checkElementCanBeCombined(elementBox,underlineY,beforeIndex,true)){/* eslint-disable @typescript-eslint/no-explicit-any */var splittedText=checkText.split(/[\s]+/);var markindex=elementBox.line.getOffset(elementBox,0);var spaceValue=1;if(splittedText.length>1){for(var i=0;i<splittedText.length;i++){var currentText=splittedText[i];var retrievedText=this.spellChecker.manageSpecialCharacters(currentText,undefined,true);if(this.spellChecker.ignoreAllItems.indexOf(retrievedText)===-1&&elementBox.ignoreOnceItems.indexOf(retrievedText)===-1){this.handleUnorderedElements(retrievedText,elementBox,underlineY,i,markindex,i===splittedText.length-1,beforeIndex);markindex+=currentText.length+spaceValue;}}}else{var retrievedText=this.spellChecker.manageSpecialCharacters(checkText,undefined,true);if(checkText.length>0){if(this.spellChecker.ignoreAllItems.indexOf(retrievedText)===-1&&elementBox.ignoreOnceItems.indexOf(retrievedText)===-1){var indexInLine_1=elementBox.indexInOwner;var indexinParagraph_1=elementBox.line.paragraph.indexInOwner;var spellInfo=this.spellChecker.checkSpellingInPageInfo(retrievedText);if(spellInfo.isElementPresent&&this.spellChecker.enableOptimizedSpellCheck){var jsonObject=JSON.parse('{\"HasSpellingError\":'+spellInfo.hasSpellError+'}');this.spellChecker.handleWordByWordSpellCheck(jsonObject,elementBox,left,top,underlineY,baselineAlignment,true);}else{if(!this.documentHelper.owner.editor.triggerPageSpellCheck){/* eslint-disable @typescript-eslint/no-explicit-any */this.spellChecker.callSpellChecker(this.spellChecker.languageID,checkText,true,this.spellChecker.allowSpellCheckAndSuggestion).then(function(data){/* eslint-disable @typescript-eslint/no-explicit-any */var jsonObject=JSON.parse(data);var canUpdate=(beforeIndex===_this.pageIndex||elementBox.isVisible)&&indexInLine_1===elementBox.indexInOwner&&indexinParagraph_1===elementBox.line.paragraph.indexInOwner;_this.spellChecker.handleWordByWordSpellCheck(jsonObject,elementBox,left,top,underlineY,baselineAlignment,canUpdate);});}}}}}}};Renderer.prototype.handleUnorderedElements=function(currentText,elementBox,underlineY,iteration,markIndex,isLastItem,beforeIndex){var _this=this;var indexInLine=elementBox.indexInOwner;var indexinParagraph=elementBox.line.paragraph.indexInOwner;if(currentText.length>0){var spellInfo=this.spellChecker.checkSpellingInPageInfo(currentText);if(spellInfo.isElementPresent&&this.spellChecker.enableOptimizedSpellCheck){var jsonObject=JSON.parse('{\"HasSpellingError\":'+spellInfo.hasSpellError+'}');this.spellChecker.handleSplitWordSpellCheck(jsonObject,currentText,elementBox,true,underlineY,iteration,markIndex,isLastItem);}else{if(!this.documentHelper.owner.editor.triggerPageSpellCheck){/* eslint-disable @typescript-eslint/no-explicit-any */this.spellChecker.callSpellChecker(this.spellChecker.languageID,currentText,true,this.spellChecker.allowSpellCheckAndSuggestion).then(function(data){/* eslint-disable @typescript-eslint/no-explicit-any */var jsonObject=JSON.parse(data);var canUpdate=elementBox.isVisible&&indexInLine===elementBox.indexInOwner&&indexinParagraph===elementBox.line.paragraph.indexInOwner;_this.spellChecker.handleSplitWordSpellCheck(jsonObject,currentText,elementBox,canUpdate,underlineY,iteration,markIndex,isLastItem);});}}}};Renderer.prototype.renderWavyLine=function(elementBox,left,top,underlineY,color,underline,baselineAlignment,backgroundColor){if(elementBox.text.length>1){var renderedHeight=elementBox.height/(baselineAlignment==='Normal'?1:1.5);var topMargin=elementBox.margin.top;var underlineHeight=renderedHeight/20;var frequencyRange=0.5;var amplitudeRange=1.0;var stepToCover=.7;var y=0;if(baselineAlignment==='Subscript'||elementBox instanceof ListTextElementBox){y=renderedHeight-2*underlineHeight+top;topMargin+=elementBox.height-renderedHeight;y+=topMargin>0?topMargin:0;}else{y=underlineY+top;}var specialCharacter=this.spellChecker.getSpecialCharactersInfo(elementBox.text,elementBox.characterFormat);var whiteSpaceData=this.spellChecker.getWhiteSpaceCharacterInfo(elementBox.text,elementBox.characterFormat);var x=left+specialCharacter.beginningWidth+(whiteSpaceData.isBeginning?whiteSpaceData.width:0)+elementBox.margin.left;var x1=x*this.documentHelper.zoomFactor+this.leftPosition;var y1=y*this.documentHelper.zoomFactor+this.topPosition;var x2=x1+this.getScaledValue(elementBox.width-(specialCharacter.beginningWidth+specialCharacter.endWidth)-whiteSpaceData.width);var startingPoint=new Point(x1,y1);var endingPoint=new Point(x2,y1);this.drawWavy(startingPoint,endingPoint,(x2-x1)*frequencyRange,amplitudeRange,stepToCover,color,elementBox.height,backgroundColor);}};Renderer.prototype.drawWavy=function(from,to,frequency,amplitude,step,color,height,backColor,negative){this.pageContext.save();this.pageContext.fillStyle=!sf.base.isNullOrUndefined(backColor)?backColor:this.documentHelper.backgroundColor;this.pageContext.fillRect(from.x,from.y-amplitude,to.x-from.x,amplitude*3);this.pageContext.restore();this.pageContext.lineWidth=1;this.pageContext.lineCap='round';this.pageContext.strokeStyle=color;this.pageContext.beginPath();//this.pageContext.save();
var cx=0;var cy=0;var fx=from.x;var fy=from.y;var tx=to.x;var ty=to.y;var i=0;var waveOffsetLength=0;var ang=Math.atan2(ty-fy,tx-fx);var distance=Math.sqrt((fx-tx)*(fx-tx)+(fy-ty)*(fy-ty));var a=amplitude*1;var f=Math.PI*frequency;for(i;i<=distance;i+=step){waveOffsetLength=Math.sin(i/distance*f)*a;cx=from.x+Math.cos(ang)*i+Math.cos(ang-Math.PI/2)*waveOffsetLength;cy=from.y+Math.sin(ang)*i+Math.sin(ang-Math.PI/2)*waveOffsetLength;i>0?this.pageContext.lineTo(cx,cy):this.pageContext.moveTo(cx,cy);}this.pageContext.stroke();this.pageContext.restore();};Renderer.prototype.getTabLeader=function(elementBox){var textWidth=0;var tabString=this.getTabLeaderString(elementBox.tabLeader);var tabText=tabString;textWidth=this.documentHelper.textHelper.getWidth(tabText,elementBox.characterFormat);var count=Math.floor(elementBox.width/textWidth);for(var i=0;i<=count;i++){tabText+=tabString;}return tabText.slice(0,-1);};Renderer.prototype.getTabLeaderString=function(tabLeader){var tabString='';switch(tabLeader){case'Dot':tabString='.';break;case'Hyphen':tabString='-';break;case'Underscore':tabString='_';break;}return tabString;};Renderer.prototype.clipRect=function(xPos,yPos,width,height){this.pageContext.beginPath();this.pageContext.save();this.pageContext.rect(this.getScaledValue(xPos,1),this.getScaledValue(yPos,2),width,height);this.pageContext.clip();};Renderer.prototype.renderUnderline=function(elementBox,left,top,underlineY,color,underline,baselineAlignment,revisionInfo){var renderedHeight=elementBox.height/(baselineAlignment==='Normal'?1:1.5);var topMargin=elementBox.margin.top;var underlineHeight=renderedHeight/20;var y=0;var lineHeight=renderedHeight/20;if(baselineAlignment==='Subscript'||elementBox instanceof ListTextElementBox){y=renderedHeight-2*underlineHeight+top;topMargin+=elementBox.height-renderedHeight;y+=topMargin>0?topMargin:0;}else{y=underlineY+top;}var lineCount=0;if(!sf.base.isNullOrUndefined(revisionInfo)){underline=revisionInfo.type==='MoveTo'?'Double':'Single';}if(underline==='Double'){y-=lineHeight;}if(elementBox instanceof ImageElementBox){underlineHeight=0.9;}while(lineCount<(underline==='Double'?2:1)){lineCount++;var width=elementBox.width;if(elementBox instanceof TextElementBox&&!(elementBox instanceof TabElementBox)&&sf.base.isNullOrUndefined(elementBox.nextNode)){width=this.documentHelper.textHelper.getWidth(HelperMethods.trimEnd(elementBox.text),elementBox.characterFormat);}this.pageContext.fillRect(this.getScaledValue(left+elementBox.margin.left,1),this.getScaledValue(y,2),this.getScaledValue(width),this.getScaledValue(underlineHeight));y+=2*lineHeight;}};Renderer.prototype.renderStrikeThrough=function(elementBox,left,top,strikethrough,color,baselineAlignment,revisionInfo){var renderedHeight=elementBox.height/(baselineAlignment==='Normal'?1:1.5);var topMargin=elementBox.margin.top;if(baselineAlignment==='Subscript'){topMargin+=elementBox.height-renderedHeight;}top+=topMargin>0?topMargin:0;var lineHeight=renderedHeight/20;var y=renderedHeight/2+0.5*lineHeight;var lineCount=0;if(!sf.base.isNullOrUndefined(revisionInfo)){strikethrough=revisionInfo.type==='Deletion'?'SingleStrike':'DoubleStrike';}if(elementBox instanceof ImageElementBox){lineHeight=0.9;}if(strikethrough==='DoubleStrike'){y-=lineHeight;}while(lineCount<(strikethrough==='DoubleStrike'?2:1)){lineCount++;this.pageContext.fillRect(this.getScaledValue(left+elementBox.margin.left,1),this.getScaledValue(y+top,2),this.getScaledValue(elementBox.width),this.getScaledValue(lineHeight));y+=2*lineHeight;}};Renderer.prototype.renderImageElementBox=function(elementBox,left,top,underlineY){var topMargin=elementBox.margin.top;var leftMargin=elementBox.margin.left;var revisionInfo=this.checkRevisionType(elementBox);var color=revisionInfo.length>0?this.getRevisionColor(revisionInfo):'black';this.pageContext.textBaseline='top';var widgetWidth=0;var isClipped=false;var containerWid=elementBox.line.paragraph.containerWidget;var isHeightType=false;if(containerWid instanceof TableCellWidget){isHeightType=containerWid.ownerRow.rowFormat.heightType==='Exactly';}if(elementBox.textWrappingStyle==='Inline'){if(topMargin<0||elementBox.line.paragraph.width<elementBox.width){// if (containerWid instanceof BodyWidget) {
//     widgetWidth = containerWid.width + containerWid.x;
// } else 
if(containerWid instanceof TableCellWidget){var leftIndent=0;if(containerWid.childWidgets[0]instanceof ParagraphWidget){var paraAdv=containerWid.childWidgets[0];leftIndent=paraAdv.paragraphFormat.leftIndent;}widgetWidth=containerWid.width+containerWid.margin.left-containerWid.leftBorderWidth-leftIndent;isClipped=true;this.clipRect(left+leftMargin,top+topMargin,this.getScaledValue(widgetWidth),this.getScaledValue(containerWid.height));}}else if(isHeightType){var width=containerWid.width+containerWid.margin.left-containerWid.leftBorderWidth;isClipped=true;this.clipRect(containerWid.x,containerWid.y,this.getScaledValue(width),this.getScaledValue(containerWid.height));}}if(elementBox.isMetaFile&&!sf.base.isNullOrUndefined(elementBox.metaFileImageString)){this.pageContext.drawImage(elementBox.element,this.getScaledValue(left+leftMargin,1),this.getScaledValue(top+topMargin,2),this.getScaledValue(elementBox.width),this.getScaledValue(elementBox.height));}else{try{if(!elementBox.isCrop){this.pageContext.drawImage(elementBox.element,this.getScaledValue(left+leftMargin,1),this.getScaledValue(top+topMargin,2),this.getScaledValue(elementBox.width),this.getScaledValue(elementBox.height));}else{this.pageContext.drawImage(elementBox.element,this.getScaledValue(elementBox.x),this.getScaledValue(elementBox.y),elementBox.cropWidth,elementBox.cropHeight,this.getScaledValue(left+leftMargin,1),this.getScaledValue(top+topMargin,2),this.getScaledValue(elementBox.width),this.getScaledValue(elementBox.height));}}catch(e){elementBox.imageString='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAgVBMVEX///8AAADgAADY2Njl5eVcXFxjY2NZWVl/f3+wsLCmpqb4+PiioqKpqam7u7vV1dX2uLj2wsLhFRXzpKT3vb30sbHhCwv74+P40dH+9vbkIyO2trbBwcHLy8tsbGycnJz529v4zMzrbGzlLS3qZmblNzfrdXXoRkbvi4vvgYHlHh7CZsBOAAADpUlEQVR4nO3da1faQBSF4ekAUQlUEFs14AXxVv7/D6yaQiZx5mSEYXF2ut+PNKzyyK5diYDmR9czx34AB49C/CjE759w3jvvWr15Tdgz3atXE54f++EcIArxoxA/CvGjED8K8aMQPwrxoxA/CvGLEeZ9jPJdhfk4GyCUjb3ECGE/Q6m/q3DwfudjP0ERZYN9hKdn2hvd3+0jHJz5/kBVuTk96bbQUEjhYR9ckiikUH8UUqg/CinUH4UU6o9CCvVHIYX6o5BC/VFIof4opFB/FFKoPwop1B+FFOqPQgrjyxfjVC38Lxk9tnAxGqZqdKtSOE4GHA5/fuNJpDCtcNHbv4VqYYqPLjgfUViPQgrjozA2CptRSGF8/59w+Wrt+rr1btNna1cPzg0wwuXavncxabnX7PfHYYXzlYARvlobQZyUR9mXm+1NMEK7SSLONgcVV9vb8IQXv4J3KSeKKlxXxNCzONkeYp8AV3p9UT1+P3FWHVAsq5thhGZSEb1DrSZq7dS5HUdoLiuBZ6jORG3tCwAkNJfCUJ2Jrqe1P0ESCkMNTdSACYNDDU7UoAkDQw1P1MAJvUMVJmrwhJ6hShM1gMIvQxUnahCFjaHKEzWQQneoxR95ogZTWBuqPFEDKnSHKk/UoArdoYoTNbDC5lBDEzW4QjMpYiZqgIXG/S76JhwHK5zVVipcnkIVuv/RW/HyFKhwYhuFr6NiCmdNoDBUSGFjovJQEYXuRN9ahwoorJ8uSZenPsMTNk+X2q6jwgm/ntHL11HhhL4zenmoYEL/Gb04VCxh6KKTNFQoYfiikzBUJKF00Sk8VCChfF00OFQcYdt10dBQYYRT5xn0n9G7Q0X8GfCzNNEyZ6iPgD/HlydaVg11DfhajJaJlm2HugIUrlomWrYZKuJKHz6vHhbSM/hROdRnxNe1meuXYvW0DB6+aflYrB7dlzDiCM3N1dVN6GDhMCDhjlHYjEIK46MwNgqbUUhhfJ/vA07wO8N1vw94ONo/3e/lTpVOYfc/UyG//ZmqW52fi/FuTNW3/lZ+eguF+qOQQv1RSKH+KKRQfxRSqD8KKdQfhRTqj0IK9UchhfqjkEL9UUih/iikUH8UUqg/CmXh6Hsv3jlK+wnvD/vgkrSHMMuyu1P9ZdmuwnycDQYn+svG3n9KEUKT9zHyf6+IEWJHIX4U4kchfhTiRyF+FOJHIX4U4kchfnVhijeZa6sunCf4ZdPamteEHY5C/CjEr/vCv0ec0g+AtS1QAAAAAElFTkSuQmCC';this.pageContext.drawImage(elementBox.element,this.getScaledValue(left+leftMargin,1),this.getScaledValue(top+topMargin,2),this.getScaledValue(elementBox.width),this.getScaledValue(elementBox.height));}}this.pageContext.fillStyle=HelperMethods.getColor(color);var currentRevision=this.getRevisionType(revisionInfo,false);if(!sf.base.isNullOrUndefined(currentRevision)&&(currentRevision.type==='Deletion'||currentRevision.type==='MoveFrom')){this.renderStrikeThrough(elementBox,left,top,'SingleStrike',color,'Normal',currentRevision);}currentRevision=this.getRevisionType(revisionInfo,true);if(!sf.base.isNullOrUndefined(currentRevision)&&(currentRevision.type==='Insertion'||currentRevision.type==='MoveTo')){var y=this.getUnderlineYPosition(elementBox.line);this.renderUnderline(elementBox,left,top,y,color,'Single','Normal');}if(isClipped){this.pageContext.restore();}};Renderer.prototype.renderTableOutline=function(tableWidget){var layout=new Layout(this.documentHelper);var table=tableWidget;tableWidget.width=this.documentHelper.layout.getTableWidth(table);var border=!table.isBidiTable?layout.getTableLeftBorder(table.tableFormat.borders):layout.getTableRightBorder(table.tableFormat.borders);var lineWidth=0;//ToDo: Need to draw the borders based on the line style.
// if (!isNullOrUndefined(border )) {
lineWidth=HelperMethods.convertPointToPixel(border.getLineWidth());this.renderSingleBorder(border.color,tableWidget.x-tableWidget.margin.left-lineWidth/2,tableWidget.y,tableWidget.x-tableWidget.margin.left-lineWidth/2,tableWidget.y+tableWidget.height,lineWidth);// }
border=layout.getTableTopBorder(table.tableFormat.borders);lineWidth=0;// if (!isNullOrUndefined(border )) {
lineWidth=HelperMethods.convertPointToPixel(border.getLineWidth());this.renderSingleBorder(border.color,tableWidget.x-tableWidget.margin.left-lineWidth,tableWidget.y-lineWidth/2,tableWidget.x+tableWidget.width+lineWidth+tableWidget.margin.right,tableWidget.y-lineWidth/2,lineWidth);// }
border=!table.isBidiTable?layout.getTableRightBorder(table.tableFormat.borders):layout.getTableLeftBorder(table.tableFormat.borders);lineWidth=0;// if (!isNullOrUndefined(border )) {
lineWidth=HelperMethods.convertPointToPixel(border.getLineWidth());this.renderSingleBorder(border.color,tableWidget.x+tableWidget.width+tableWidget.margin.right+lineWidth/2,tableWidget.y,tableWidget.x+tableWidget.width+tableWidget.margin.right+lineWidth/2,tableWidget.y+tableWidget.height,lineWidth);// }
border=layout.getTableBottomBorder(table.tableFormat.borders);lineWidth=0;// if (!isNullOrUndefined(border )) {
lineWidth=HelperMethods.convertPointToPixel(border.getLineWidth());this.renderSingleBorder(border.color,tableWidget.x-tableWidget.margin.left-lineWidth,tableWidget.y+tableWidget.height-lineWidth/2,tableWidget.x+tableWidget.width+lineWidth+tableWidget.margin.right,tableWidget.y+tableWidget.height-lineWidth/2,lineWidth);// }
};/* eslint-disable  */Renderer.prototype.renderTableCellOutline=function(documentHelper,cellWidget){var layout=documentHelper.layout;var borders=undefined;var tableCell=cellWidget;var cellTopMargin=0;var cellBottomMargin=0;var cellLeftMargin=0;var cellRightMargin=0;var height=0;var isBidiTable=cellWidget.ownerTable.isBidiTable;borders=tableCell.cellFormat.borders;if(cellWidget.containerWidget instanceof TableRowWidget){cellBottomMargin=cellWidget.margin.bottom-cellWidget.containerWidget.bottomBorderWidth;cellTopMargin=cellWidget.margin.top-cellWidget.containerWidget.topBorderWidth;}cellLeftMargin=cellWidget.margin.left-cellWidget.leftBorderWidth;cellRightMargin=cellWidget.margin.right-cellWidget.rightBorderWidth;if(!sf.base.isNullOrUndefined(tableCell.ownerRow)&&tableCell.ownerRow.rowFormat.heightType==='Exactly'){height=HelperMethods.convertPointToPixel(tableCell.ownerRow.rowFormat.height)+cellTopMargin+cellBottomMargin;}else{if(!sf.base.isNullOrUndefined(tableCell.ownerRow)&&[tableCell.ownerRow].length<=1){height=Math.max(HelperMethods.convertPointToPixel(tableCell.ownerRow.rowFormat.height),cellWidget.height)+cellTopMargin+cellBottomMargin;}else{height=cellWidget.height+cellTopMargin+cellBottomMargin;}}var border=!isBidiTable?TableCellWidget.getCellLeftBorder(tableCell):TableCellWidget.getCellRightBorder(tableCell);var lineWidth=0;// if (!isNullOrUndefined(border )) {
lineWidth=HelperMethods.convertPointToPixel(border.getLineWidth());//Renders the cell left border.
this.renderCellBackground(height,cellWidget,cellLeftMargin,lineWidth);var leftBorderWidth=lineWidth;if(tableCell.index===0||tableCell.cellFormat.rowSpan===1||tableCell.cellFormat.rowSpan>1&&tableCell.columnIndex===0){this.renderSingleBorder(border.color,cellWidget.x-cellLeftMargin-lineWidth,cellWidget.y-cellTopMargin,cellWidget.x-cellLeftMargin-lineWidth,cellWidget.y+cellWidget.height+cellBottomMargin,lineWidth);}else{for(var i=0;i<tableCell.ownerTable.childWidgets.length;i++){var row=tableCell.ownerTable.childWidgets[i];var cell=void 0;for(var j=0;j<row.childWidgets.length;j++){var currentCell=row.childWidgets[j];if(currentCell.columnIndex+currentCell.cellFormat.columnSpan-1===tableCell.columnIndex-1){cell=currentCell;break;}else if(row.childWidgets[j].columnIndex>=tableCell.columnIndex&&row.childWidgets[j].previousWidget){cell=row.childWidgets[j].previousWidget;break;}}if(cell&&cell.columnIndex+cell.cellFormat.columnSpan-1===tableCell.columnIndex-1){var border_1=!isBidiTable?TableCellWidget.getCellRightBorder(cell):TableCellWidget.getCellLeftBorder(cell);var lineWidthInt=border_1.lineWidth;if(cell.y+cell.height<tableCell.y){continue;}else if(cell.y<tableCell.y&&cell.y+cell.height>tableCell.y){this.renderSingleBorder(border_1.color,tableCell.x-cellLeftMargin-lineWidthInt,tableCell.y-cellTopMargin,tableCell.x-cellLeftMargin-lineWidthInt,cell.y+cell.height+cell.margin.bottom,lineWidthInt);}else if(cell.y===tableCell.y||cell.y>tableCell.y&&cell.y+cell.height<tableCell.y+tableCell.height){this.renderSingleBorder(border_1.color,tableCell.x-cellLeftMargin-lineWidthInt,cell.y-cell.margin.top,tableCell.x-cellLeftMargin-lineWidthInt,cell.y+cell.height+cell.margin.bottom,lineWidthInt);}else if(cell.y<tableCell.y+tableCell.height&&cell.y+cell.height>=tableCell.y+tableCell.height){this.renderSingleBorder(border_1.color,tableCell.x-cellLeftMargin-lineWidthInt,cell.y-cell.margin.top,tableCell.x-cellLeftMargin-lineWidthInt,cell.y+tableCell.height+cellBottomMargin,lineWidthInt);}else if(cell.y>tableCell.y+tableCell.height){break;}}}}// }
if(tableCell.updatedTopBorders&&tableCell.updatedTopBorders.length>1){var cellX=cellWidget.x-cellWidget.margin.left-leftBorderWidth/2;var cellY=cellWidget.y-cellWidget.margin.top;for(var a=0;a<tableCell.updatedTopBorders.length;a++){var borderInfo=tableCell.updatedTopBorders[a];border=borderInfo.border;if(border.lineStyle!=='None'&&border.lineWidth<TableCellWidget.getCellTopBorder(tableCell).lineWidth){border.lineWidth=TableCellWidget.getCellTopBorder(tableCell).lineWidth;}if(!sf.base.isNullOrUndefined(border)){lineWidth=HelperMethods.convertPointToPixel(border.getLineWidth());this.renderSingleBorder(border.color,cellX,cellY+lineWidth/2,cellX+borderInfo.width,cellY+lineWidth/2,lineWidth);cellX=cellX+borderInfo.width;}}}else{border=TableCellWidget.getCellTopBorder(tableCell);// if (!isNullOrUndefined(border )) { //Renders the cell top border.        
lineWidth=HelperMethods.convertPointToPixel(border.getLineWidth());var width=0;this.renderSingleBorder(border.color,cellWidget.x-cellWidget.margin.left-leftBorderWidth/2,cellWidget.y-cellWidget.margin.top+lineWidth/2,cellWidget.x+cellWidget.width+cellWidget.margin.right+width,cellWidget.y-cellWidget.margin.top+lineWidth/2,lineWidth);// }
}var isLastCell=false;if(!isBidiTable){isLastCell=tableCell.cellIndex===tableCell.ownerRow.childWidgets.length-1;}else{isLastCell=tableCell.cellIndex===0;}var prevRowSpannedCells=tableCell.containerWidget.getPreviousRowSpannedCells();var isAffectedByRowSpan=false;for(var k=0;k<prevRowSpannedCells.length;k++){var spannedCell=prevRowSpannedCells[k];if(tableCell.rowIndex<spannedCell.rowIndex+spannedCell.cellFormat.rowSpan&&tableCell.columnIndex<spannedCell.columnIndex){isAffectedByRowSpan=true;break;}}if((tableCell.ownerTable.tableFormat.cellSpacing>0||isLastCell)&&(isBidiTable||tableCell.columnIndex+tableCell.cellFormat.columnSpan===tableCell.ownerTable.tableHolder.columns.length||!isAffectedByRowSpan)){border=isBidiTable?TableCellWidget.getCellLeftBorder(tableCell):TableCellWidget.getCellRightBorder(tableCell);// if (!isNullOrUndefined(border )) { //Renders the cell right border.           
lineWidth=HelperMethods.convertPointToPixel(border.getLineWidth());this.renderSingleBorder(border.color,cellWidget.x+cellWidget.width+cellWidget.margin.right-lineWidth/2,cellWidget.y-cellTopMargin,cellWidget.x+cellWidget.width+cellWidget.margin.right-lineWidth/2,cellWidget.y+cellWidget.height+cellBottomMargin,lineWidth);// }
}var nextRow=tableCell.ownerRow.nextWidget;//Specifies the next row is within the current table widget.
//True means current row is not rendered at page end; Otherwise False.
var nextRowIsInCurrentTableWidget=false;var previousCellIndex=undefined;if(!sf.base.isNullOrUndefined(nextRow)){if(nextRow.lastChild){var lastCellWidget=nextRow.lastChild;previousCellIndex=lastCellWidget.columnIndex+lastCellWidget.cellFormat.columnSpan;}var nextRowWidget=undefined;// if (viewer.renderedElements.containsKey(nextRow) && viewer.renderedElements.get(nextRow).length > 0) {
nextRowWidget=nextRow;// }
if(nextRowWidget instanceof TableRowWidget){if(cellWidget.containerWidget instanceof TableRowWidget&&cellWidget.containerWidget.containerWidget instanceof TableWidget){nextRowIsInCurrentTableWidget=cellWidget.containerWidget.containerWidget.childWidgets.indexOf(nextRowWidget)!==-1;}}}if(tableCell.ownerTable.tableFormat.cellSpacing>0||tableCell.ownerRow.rowIndex===tableCell.ownerTable.childWidgets.length-1||tableCell.cellFormat.rowSpan>1&&tableCell.ownerRow.rowIndex+tableCell.cellFormat.rowSpan>=tableCell.ownerTable.childWidgets.length||!nextRowIsInCurrentTableWidget||previousCellIndex&&nextRow.childWidgets.length<tableCell.ownerRow.childWidgets.length&&previousCellIndex<tableCell.columnIndex+tableCell.cellFormat.columnSpan){border=tableCell.cellFormat.rowSpan>1&&tableCell.ownerRow.rowIndex+tableCell.cellFormat.rowSpan===tableCell.ownerTable.childWidgets.length?//true part for vertically merged cells specifically.
tableCell.getBorderBasedOnPriority(tableCell.getBorderBasedOnPriority(tableCell.cellFormat.borders.bottom,tableCell.ownerRow.rowFormat.borders.bottom),tableCell.ownerTable.tableFormat.borders.bottom)//false part for remaining cases that has been handled inside method. 
:TableCellWidget.getCellBottomBorder(tableCell);// if (!isNullOrUndefined(border )) {
//Renders the cell bottom border.
if(tableCell.cellFormat.borders.top.lineStyle==='Cleared'&&tableCell.cellFormat.borders.bottom.lineStyle==='None'&&!sf.base.isNullOrUndefined(tableCell.nextWidget)){border=tableCell.cellFormat.borders.bottom;}lineWidth=HelperMethods.convertPointToPixel(border.getLineWidth());this.renderSingleBorder(border.color,cellWidget.x-cellWidget.margin.left-leftBorderWidth/2,cellWidget.y+cellWidget.height+cellBottomMargin+lineWidth/2,cellWidget.x+cellWidget.width+cellWidget.margin.right,cellWidget.y+cellWidget.height+cellBottomMargin+lineWidth/2,lineWidth);// }
}border=layout.getCellDiagonalUpBorder(tableCell);// if (!isNullOrUndefined(border )) {
//Renders the cell diagonal up border.
lineWidth=HelperMethods.convertPointToPixel(border.getLineWidth());if(lineWidth>0){this.renderSingleBorder(border.color,cellWidget.x-cellLeftMargin,cellWidget.y+cellWidget.height+cellBottomMargin,cellWidget.x+cellWidget.width+cellRightMargin,cellWidget.y-cellTopMargin,lineWidth);// }
}border=layout.getCellDiagonalDownBorder(tableCell);// if (!isNullOrUndefined(border )) {
//Renders the cell diagonal down border.
lineWidth=HelperMethods.convertPointToPixel(border.getLineWidth());if(lineWidth>0){this.renderSingleBorder(border.color,cellWidget.x-cellLeftMargin,cellWidget.y-cellTopMargin,cellWidget.x+cellWidget.width+cellRightMargin,cellWidget.y+cellWidget.height+cellBottomMargin,lineWidth);}// }
};Renderer.prototype.renderCellBackground=function(height,cellWidget,leftMargin,lineWidth){var cellFormat=cellWidget.cellFormat;var bgColor=cellFormat.shading.backgroundColor==='#ffffff'?cellWidget.ownerTable.tableFormat.shading.backgroundColor:cellFormat.shading.backgroundColor;var left=cellWidget.x-leftMargin-lineWidth;var topMargin=cellWidget.topMargin?HelperMethods.convertPointToPixel(cellWidget.topMargin):0;var top=cellWidget.y-topMargin;var width=cellWidget.width+leftMargin+cellWidget.margin.right-lineWidth;if(cellWidget.ownerRow.rowFormat.revisions.length>0){var revision=cellWidget.ownerRow.rowFormat.revisions[cellWidget.ownerRow.rowFormat.revisions.length-1];bgColor=revision.revisionType==='Insertion'?'#e1f2fa':'#fce6f4';}this.pageContext.beginPath();if(bgColor!=='empty'){this.pageContext.fillStyle=HelperMethods.getColor(bgColor);this.pageContext.fillRect(this.getScaledValue(left,1),this.getScaledValue(top,2),this.getScaledValue(width),this.getScaledValue(height));this.pageContext.closePath();}//Render foreground color
if(cellFormat.shading.hasValue('foregroundColor')&&cellFormat.shading.textureStyle!=='TextureNone'){this.pageContext.beginPath();if(cellFormat.shading.foregroundColor!=='empty'){this.pageContext.fillStyle=HelperMethods.getColor(cellFormat.shading.foregroundColor);this.pageContext.fillRect(this.getScaledValue(left,1),this.getScaledValue(top,2),this.getScaledValue(width),this.getScaledValue(height));this.pageContext.closePath();}}};Renderer.prototype.renderSingleBorder=function(color,startX,startY,endX,endY,lineWidth){this.pageContext.beginPath();this.pageContext.moveTo(this.getScaledValue(startX,1),this.getScaledValue(startY,2));this.pageContext.lineTo(this.getScaledValue(endX,1),this.getScaledValue(endY,2));this.pageContext.lineWidth=this.getScaledValue(lineWidth);// set line color
this.pageContext.strokeStyle=HelperMethods.getColor(color);if(lineWidth>0){this.pageContext.stroke();}this.pageContext.closePath();};Renderer.prototype.getScaledValue=function(value,type){if(this.isPrinting){return value;}if(sf.base.isNullOrUndefined(type)){type=0;}var x=value*this.documentHelper.zoomFactor;return x+(type===1?this.pageLeft:type===2?this.pageTop:0);};Renderer.prototype.checkRevisionType=function(elementBox){var revisions=[];var count=elementBox.revisions.length;for(var i=0;i<count;i++){var currentRevision=elementBox.revisions[i];var color=this.documentHelper.authors.get(currentRevision.author);revisions.push({'type':currentRevision.revisionType,'color':color});}return revisions;};Renderer.prototype.getRevisionColor=function(revisionInfo){if(revisionInfo.length===1){return revisionInfo[0].color;}for(var i=0;i<revisionInfo.length;i++){if(revisionInfo[i].type==='Deletion'||revisionInfo[i].type==='MoveFrom'){return revisionInfo[i].color;}}return undefined;};Renderer.prototype.getRevisionType=function(revisionInfo,checkInsert){if(revisionInfo.length===0){return undefined;}for(var i=0;i<revisionInfo.length;i++){var type=undefined;if(checkInsert&&(revisionInfo[i].type==='Insertion'||revisionInfo[i].type==='MoveTo')){type=revisionInfo[i];this.pageContext.fillStyle=HelperMethods.getColor(type.color);revisionInfo.splice(i,1);return type;}if(!checkInsert&&(revisionInfo[i].type==='Deletion'||revisionInfo[i].type==='MoveFrom')){type=revisionInfo[i];this.pageContext.fillStyle=HelperMethods.getColor(type.color);revisionInfo.splice(i,1);return type;}}return undefined;};Renderer.prototype.getFormfieldInLine=function(line){for(var i=0;i<line.children.length;i++){if(line.children[i]instanceof FieldElementBox&&!sf.base.isNullOrUndefined(line.children[i].formFieldData)){return line.children[i];}}return undefined;};/**
     * Destroys the internal objects which is maintained.
     *
     * @returns {void}
     */Renderer.prototype.destroy=function(){this.documentHelper=undefined;if(!sf.base.isNullOrUndefined(this.pageCanvasIn)){this.pageCanvasIn.innerHTML='';}this.pageCanvasIn=undefined;};return Renderer;}();/**
 * @private
 */var TextHelper=/** @class */function(){function TextHelper(documentHelper){this.paragraphMarkInfo={};this.documentHelper=documentHelper;if(!sf.base.isNullOrUndefined(documentHelper)){this.context=documentHelper.containerContext;}}Object.defineProperty(TextHelper.prototype,"paragraphMark",{get:function get(){return'';},enumerable:true,configurable:true});Object.defineProperty(TextHelper.prototype,"lineBreakMark",{get:function get(){return'';},enumerable:true,configurable:true});TextHelper.prototype.getEnSpaceCharacter=function(){return String.fromCharCode(8194);};TextHelper.prototype.repeatChar=function(_char2,count){var text='';for(var i=0;i<count;i++){text+=_char2;}return text;};TextHelper.prototype.getParagraphMarkWidth=function(characterFormat){return this.getParagraphMarkSize(characterFormat).Width;};TextHelper.prototype.getParagraphMarkSize=function(characterFormat){var format=this.getFormatText(characterFormat);if(this.paragraphMarkInfo[format]){return this.paragraphMarkInfo[format];}// Gets the text element's width;
var width=this.getWidth(this.paragraphMark,characterFormat);// Calculate the text element's height and baseline offset.
var textHelper=this.getHeight(characterFormat);var textSizeInfo={// eslint-disable-next-line @typescript-eslint/naming-convention
'Width':width,'Height':textHelper.Height,'BaselineOffset':textHelper.BaselineOffset};return this.paragraphMarkInfo[format]=textSizeInfo;};TextHelper.prototype.getTextSize=function(elementBox,characterFormat){// Gets the text element's width;
var textTrimEndWidth=0;var isRTL=characterFormat.bidi||this.isRTLText(elementBox.text);var text=this.setText(elementBox.text,isRTL,characterFormat.bdo);textTrimEndWidth=this.getWidth(text,characterFormat);elementBox.width=textTrimEndWidth;// Calculate the text element's height and baseline offset.
var textHelper=this.getHeight(characterFormat);elementBox.height=textHelper.Height;elementBox.baselineOffset=textHelper.BaselineOffset;if(elementBox.text[elementBox.text.length-1]===' '){textTrimEndWidth=this.getWidth(HelperMethods.trimEnd(elementBox.text),characterFormat);}elementBox.trimEndWidth=textTrimEndWidth;return textTrimEndWidth;};TextHelper.prototype.getHeight=function(characterFormat){// Get character format property as  below predefined structure to make it easy to check and retrieve
// Predefined static structure `[FontName];[FontSize];bold;italic` to maintain as key in the collection
var key=this.getFormatText(characterFormat);if(!sf.base.isNullOrUndefined(this.documentHelper.heightInfoCollection[key])){return this.documentHelper.heightInfoCollection[key];}var sizeInfo=this.documentHelper.owner.textMeasureHelper.getHeightInternal(characterFormat);this.documentHelper.heightInfoCollection[key]=sizeInfo;return sizeInfo;};TextHelper.prototype.getFormatText=function(characterFormat){var formatText=characterFormat.fontFamily.toLocaleLowerCase();formatText+=';'+characterFormat.fontSize;if(characterFormat.bold){formatText+=';'+'bold';}if(characterFormat.italic){formatText+=';'+'italic';}return formatText;};TextHelper.prototype.getHeightInternal=function(characterFormat){var textHeight=0;var baselineOffset=0;var spanElement=document.createElement('span');spanElement.innerText='m';this.applyStyle(spanElement,characterFormat);var parentDiv=document.createElement('div');parentDiv.setAttribute('style','display:inline-block;position:absolute;');var tempDiv=document.createElement('div');tempDiv.setAttribute('style','display:inline-block;width: 1px; height: 0px;vertical-align: baseline;');parentDiv.appendChild(spanElement);parentDiv.appendChild(tempDiv);document.body.appendChild(parentDiv);// Sets the text element's height.
textHeight=spanElement.offsetHeight;// Calculate the text element's baseline offset.
var textTopVal=spanElement.offsetTop;var tempDivTopVal=tempDiv.offsetTop;// let width: number = (parentDiv.offsetWidth - spanElement.offsetWidth);
// if ((textTopVal - width) === 1) {
//     tempDivTopVal += width;
// }
baselineOffset=tempDivTopVal-textTopVal;document.body.removeChild(parentDiv);// eslint-disable-next-line @typescript-eslint/naming-convention
return{'Height':textHeight,'BaselineOffset':baselineOffset};};TextHelper.prototype.measureTextExcludingSpaceAtEnd=function(text,characterFormat){return this.getWidth(HelperMethods.trimEnd(text),characterFormat);};TextHelper.prototype.getWidth=function(text,characterFormat){if(text.match('\v')){text.replace('\v',this.lineBreakMark);}var bold='';var italic='';var fontFamily='';var fontSize=characterFormat.fontSize;bold=characterFormat.bold?'bold':'';italic=characterFormat.italic?'italic':'';fontFamily=characterFormat.fontFamily;fontSize=fontSize===0?0.5:fontSize/(characterFormat.baselineAlignment==='Normal'?1:1.5);this.context.font=bold+' '+italic+' '+fontSize+'pt'+' '+fontFamily;if(characterFormat.allCaps){text=text.toUpperCase();}return this.context.measureText(text).width;};TextHelper.prototype.setText=function(textToRender,isBidi,bdo,isRender){if(sf.base.isNullOrUndefined(isRender)){isRender=false;}if(textToRender.length===0){return'';}var isRtlText=isBidi;if(!isRtlText&&bdo==='RTL'||isRtlText&&bdo==='LTR'){textToRender=HelperMethods.reverseString(textToRender);}else if(isRender&&isRtlText&&HelperMethods.endsWith(textToRender)){var spaceCount=textToRender.length-HelperMethods.trimEnd(textToRender).length;textToRender=HelperMethods.addSpace(spaceCount)+HelperMethods.trimEnd(textToRender);}return textToRender;};TextHelper.prototype.applyStyle=function(spanElement,characterFormat){if(!sf.base.isNullOrUndefined(spanElement)&&!sf.base.isNullOrUndefined(characterFormat)){var style='white-space:nowrap;';if(characterFormat.fontFamily!==''){style+='font-family:'+characterFormat.fontFamily+';';}var fontSize=characterFormat.fontSize;if(fontSize<=0.5){fontSize=0.5;}style+='font-size:'+fontSize.toString()+'pt;';if(characterFormat.bold){style+='font-weight:bold;';}if(characterFormat.italic){style+='font-style:italic;';}spanElement.setAttribute('style',style);}};TextHelper.prototype.measureText=function(text,characterFormat){// Gets the text element's width;
var width=this.getWidth(text,characterFormat);// Calculate the text element's height and baseline offset.
var textHelper=this.getHeight(characterFormat);return{// eslint-disable-next-line @typescript-eslint/naming-convention
'Width':width,'Height':textHelper.Height,'BaselineOffset':textHelper.BaselineOffset};};TextHelper.prototype.updateTextSize=function(elementBox,paragraph){var format=new WCharacterFormat(undefined);var listCharacterFormat=elementBox.listLevel.characterFormat;var breakCharacterFormat=paragraph.characterFormat;format.fontSize=listCharacterFormat.hasValue('fontSize')?listCharacterFormat.fontSize:breakCharacterFormat.fontSize;format.fontFamily=listCharacterFormat.hasValue('fontFamily')?listCharacterFormat.fontFamily:breakCharacterFormat.fontFamily;var bold='';var italic='';var baselineAlignment=listCharacterFormat.baselineAlignment==='Normal'?breakCharacterFormat.baselineAlignment:listCharacterFormat.baselineAlignment;bold=listCharacterFormat.hasValue('bold')?listCharacterFormat.bold?'bold':'':breakCharacterFormat.bold?'bold':'';italic=listCharacterFormat.hasValue('italic')?listCharacterFormat.italic?'italic':'':breakCharacterFormat.italic?'italic':'';format.baselineAlignment=baselineAlignment;if(bold){format.bold=true;}if(italic){format.italic=true;}var isRTL=format.bidi||this.isRTLText(elementBox.text);var text=this.setText(elementBox.text,isRTL,format.bdo);elementBox.width=this.getWidth(text,format);// Calculate the text element's height and baseline offset.
var textHelper=this.getHeight(format);elementBox.height=textHelper.Height;elementBox.baselineOffset=textHelper.BaselineOffset;};TextHelper.prototype.containsSpecialCharAlone=function(text){/* eslint-disable */var specialChars='*|.\:[]{}-`\;()@&$#%!~?'+' '+"'";for(var i=0;i<text.length;i++){if(specialChars.indexOf(text.charAt(i))===-1){return false;}}return true;};TextHelper.prototype.containsNumberAlone=function(text){/* eslint-disable */var number='0123456789';if(text===''){return false;}for(var i=0;i<text.length;i++){if(number.indexOf(text.charAt(i))===-1){return false;}}return true;};TextHelper.prototype.inverseCharacter=function(ch){switch(ch){//Specify the '('
case'('://Specify the ')'
return')';//Specify the ')'
case')'://Specify the '('
return'(';//Specify the '<'
case'<'://Specify the '>'
return'>';//Specify the '>'
case'>'://Specify the '<'
return'<';//Specify the '{'
case'{'://Specify the '}'
return'}';//Specify the '}'
case'}'://Specify the '{'
return'{';//Specify the '['
case'['://Specify the ']'
return']';//Specify the ']'
case']'://Specify the '['
return'[';default:return ch;}};TextHelper.prototype.containsSpecialChar=function(text){var specialChars='*|.\:[]{}-`\;()@&$#%!~?'+' ';for(var i=0;i<text.length;i++){if(specialChars.indexOf(text.charAt(i))!==-1){return true;}}return false;};/**
     * @private
     * @param {string} text - Specifies the text
     * @returns {boolean} - Returns true if given text it right to left.
     */TextHelper.prototype.isRTLText=function(text){var isRTL=false;if(!sf.base.isNullOrUndefined(text)){for(var i=0;i<text.length;i++){var temp=text[i];if(temp>="\u0590"&&temp<="\u05FF"||//Hebrew characters
temp>="\u0600"&&temp<="\u06FF"//Arabic - Urdu characters
||temp>="\u0750"&&temp<="\u077F"//Arabic - Urdu characters
||temp>="\u08A0"&&temp<="\u08FF"//Arabic characters
||temp>="\uFB50"&&temp<="\uFDFF"//Arabic - Urdu characters
||temp>="\uFE70"&&temp<="\uFEFF"//Arabic - Urdu characters
||temp>="\uA980"&&temp<="\uA9DF"//Javanese characters
||temp>="\u0700"&&temp<="\u074F"//Syriac characters
||temp>="\u0780"&&temp<="\u07BF"//Thaana characters
||temp>="\u0840"&&temp<="\u085F"//Mandiac characters
||temp>="\u07C0"&&temp<="\u07FF"//N'Ko characters
||temp>="\u0800"&&temp<="\u083F"//Samaritan characters
//Tifinag characters 
||temp>="\u2D30"&&temp<="\u2D7F"){isRTL=true;break;}}}return isRTL;};/**
     * @private
     * @param {string} text - Specifies the text
     * @returns {RtlInfo} - Returns the text info.
     */TextHelper.prototype.getRtlLanguage=function(text){if(sf.base.isNullOrUndefined(text)||text===''){return{isRtl:false,id:0};}if(text>="\u0590"&&text<="\u05FF"){return{isRtl:true,id:1};//Arabic - Urdu characters
}else if(text>="\u0600"&&text<="\u06FF"||text>="\u0750"&&text<="\u077F"||text>="\u08A0"&&text<="\u08FF"||text>="\uFB50"&&text<="\uFDFF"||text>="\uFE70"&&text<="\uFEFF"){return{isRtl:true,id:2};}else if(text>="\uA980"&&text<="\uA9DF"){return{isRtl:true,id:3};}else if(text>="\u0700"&&text<="\u074F"){return{isRtl:true,id:4};}else if(text>="\u0780"&&text<="\u07BF"){return{isRtl:true,id:5};}else if(text>="\u0840"&&text<="\u085F"){return{isRtl:true,id:6};}else if(text>="\u07C0"&&text<="\u07FF"){return{isRtl:true,id:7};}else if(text>="\u0800"&&text<="\u083F"){return{isRtl:true,id:8};}else if(text>="\u2D30"&&text<="\u2D7F"){return{isRtl:true,id:9};}return{isRtl:false,id:0};};TextHelper.prototype.destroy=function(){this.documentHelper=undefined;this.context=undefined;this.paragraphMarkInfo={};this.paragraphMarkInfo=undefined;};return TextHelper;}();/**
 * @private
 */var Zoom=/** @class */function(){function Zoom(documentHelper){var _this=this;/**
         * @private
         * @param {WheelEvent} event Specifies the mouse wheen event
         * @returns {void}
         */this.onMouseWheelInternal=function(event){if(event.ctrlKey===true){event.preventDefault();var pageX=event.pageX-_this.documentHelper.viewerContainer.offsetLeft;if(pageX<_this.documentHelper.pageContainer.offsetWidth){var isFirefFox=navigator.userAgent.match('Firefox');/* eslint-disable */var wheel=isFirefFox?event.detail<0:sf.base.Browser.isIE?event.wheelDelta>0:event.deltaY<0;/* eslint-enable */var zoomFactor=_this.documentHelper.zoomFactor;if(wheel){if(zoomFactor<=4.90){zoomFactor+=.10;}else{zoomFactor=5.00;}}else{if(zoomFactor>=.20){zoomFactor-=.10;}else{zoomFactor=0.10;}}_this.documentHelper.zoomFactor=zoomFactor;}}};this.documentHelper=documentHelper;}Zoom.prototype.setZoomFactor=function(){this.onZoomFactorChanged();if(!sf.base.isNullOrUndefined(this.documentHelper.selection)){this.documentHelper.selection.updateCaretPosition();}this.documentHelper.updateTouchMarkPosition();if(!sf.base.isNullOrUndefined(this.documentHelper.owner.imageResizerModule)){this.documentHelper.owner.imageResizerModule.updateImageResizerPosition();}this.documentHelper.owner.fireZoomFactorChange();};Object.defineProperty(Zoom.prototype,"viewer",{get:function get(){return this.documentHelper.owner.viewer;},enumerable:true,configurable:true});//Zoom Implementation Starts
Zoom.prototype.onZoomFactorChanged=function(){if(this.documentHelper.zoomFactor>5){this.documentHelper.zoomFactor=5;}else if(this.documentHelper.zoomFactor<0.1){this.documentHelper.zoomFactor=0.1;}this.zoom();};Zoom.prototype.zoom=function(){var viewer=this.viewer;this.documentHelper.clearContent();viewer.handleZoom();this.documentHelper.updateFocus();};return Zoom;}();/* eslint-disable */ /**
 * @private
 */var XmlHttpRequestHandler=/** @class */function(){function XmlHttpRequestHandler(){/**
         * A boolean value indicating whether the request should be sent asynchronous or not.
         *
         * @default true
         */this.mode=true;}/**
     * Send the request to server
     *
     * @param  {object} jsonObject - To send to service
     */XmlHttpRequestHandler.prototype.send=function(jsonObject){var _this=this;this.xmlHttpRequest=new XMLHttpRequest();this.xmlHttpRequest.onreadystatechange=function(){_this.stateChange(_this);};this.xmlHttpRequest.onerror=function(){_this.error(_this);};if(!this.mode){setTimeout(function(){_this.sendRequest(jsonObject);});}else{this.sendRequest(jsonObject);}};XmlHttpRequestHandler.prototype.sendRequest=function(jsonObj){this.xmlHttpRequest.open('POST',this.url,true);if(this.contentType){this.xmlHttpRequest.setRequestHeader('Content-Type',this.contentType);}this.setCustomAjaxHeaders();if(this.responseType){this.xmlHttpRequest.responseType=this.responseType;}var data=jsonObj instanceof FormData?jsonObj:JSON.stringify(jsonObj);this.xmlHttpRequest.send(data);// jshint ignore:line
};XmlHttpRequestHandler.prototype.stateChange=function(proxyReq){if(proxyReq.xmlHttpRequest.readyState===4&&proxyReq.xmlHttpRequest.status===200){var data=void 0;if(this.responseType){data=proxyReq.xmlHttpRequest.response;}else{data=proxyReq.xmlHttpRequest.responseText;}var result={name:'onSuccess',data:data,readyState:proxyReq.xmlHttpRequest.readyState,status:proxyReq.xmlHttpRequest.status};proxyReq.successHandler(result);}else if(proxyReq.xmlHttpRequest.readyState===4&&!(proxyReq.xmlHttpRequest.status===200)){// jshint ignore:line)
var result={name:'onFailure',status:proxyReq.xmlHttpRequest.status,statusText:proxyReq.xmlHttpRequest.statusText,url:proxyReq.url};proxyReq.failureHandler(result);}};XmlHttpRequestHandler.prototype.error=function(proxyReq){var result={name:'onError',status:this.xmlHttpRequest.status,statusText:this.xmlHttpRequest.statusText};proxyReq.errorHandler(result);};XmlHttpRequestHandler.prototype.successHandler=function(response){if(this.onSuccess){this.onSuccess(response);}return response;};XmlHttpRequestHandler.prototype.failureHandler=function(response){if(this.onFailure){this.onFailure(response);}return response;};XmlHttpRequestHandler.prototype.errorHandler=function(response){if(this.onError){this.onError(response);}return response;};XmlHttpRequestHandler.prototype.setCustomAjaxHeaders=function(){for(var i=0;i<this.customHeaders.length;i++){var header=this.customHeaders[i];for(var _i=0,_a=Object.keys(header);_i<_a.length;_i++){var key=_a[_i];this.xmlHttpRequest.setRequestHeader(key,header[key]);}}};return XmlHttpRequestHandler;}();//tslint:disable-next-line:max-line-length
/**
 * Track changes pane
 */var TrackChangesPane=/** @class */function(){function TrackChangesPane(owner){this.users=[];// private menuoptionEle: HTMLElement;
this.enableButtons=true;this.sortedRevisions=[];this.noChangesVisibleInternal=true;this.isTrackingPageBreak=false;this.owner=owner;this.selectedUser='All';this.selectedType='All';}Object.defineProperty(TrackChangesPane.prototype,"setNoChangesVisibility",{get:function get(){return this.noChangesVisibleInternal;},set:function set(visible){this.noChangeDivElement.style.display=visible?'block':'none';this.noChangesVisibleInternal=visible;this.enableDisableToolbarItem(!visible);},enumerable:true,configurable:true});Object.defineProperty(TrackChangesPane.prototype,"currentSelectedRevision",{get:function get(){return this.currentSelectedRevisionInternal;},set:function set(value){if(!sf.base.isNullOrUndefined(this.changesInfoDiv)){var selectedElement=sf.base.select('.e-de-trckchanges-inner-select',this.changesInfoDiv);if(sf.base.isNullOrUndefined(value)){if(!sf.base.isNullOrUndefined(selectedElement)){selectedElement.classList.remove('e-de-trckchanges-inner-select');}}else if(value!==this.currentSelectedRevisionInternal||sf.base.isNullOrUndefined(selectedElement)){if(selectedElement){selectedElement.classList.remove('e-de-trckchanges-inner-select');}if(this.changes.length>0&&this.changes.containsKey(value)){var currentChangeView=this.changes.get(value);currentChangeView.singleInnerDiv.classList.add('e-de-trckchanges-inner-select');}}this.currentSelectedRevisionInternal=value;selectedElement=sf.base.select('.e-de-trckchanges-inner-select',this.changesInfoDiv);if(!sf.base.isNullOrUndefined(selectedElement)){selectedElement.parentElement.scrollIntoView({block:'nearest'});}}},enumerable:true,configurable:true});/**
     * @private
     */TrackChangesPane.prototype.initTrackChangePane=function(){this.changes=new Dictionary();this.changesInfoDiv=this.owner.element.getElementsByClassName('e-de-tc-pane-revision')[0];if(!this.changesInfoDiv){this.changesInfoDiv=sf.base.createElement('div',{id:'e-de-tc-pane-revision',styles:'overflow:auto'});}this.noChangeDivElement=sf.base.createElement('div',{styles:'display:none;',className:'e-de-tc-no-chng'});this.noChangeDivElement.textContent='No changes';this.changesInfoDiv.appendChild(this.noChangeDivElement);this.updateTrackChanges();};TrackChangesPane.prototype.enableDisableToolbarItem=function(enable){// const elements: NodeListOf<Element> = this.toolbar.element.querySelectorAll('.e-de-tc-tbr');
// if (this.owner && this.owner.viewer) {
//     this.toolbar.enableItems(elements[0].parentElement.parentElement, enable);
//     this.toolbar.enableItems(elements[1].parentElement.parentElement, enable);
//     this.toolbar.enableItems(elements[2] as HTMLElement, enable);
// }
};TrackChangesPane.prototype.getSpanView=function(value,type){return(type===0?'<span class="e-de-track-span-user">':'<span class="e-de-track-span-view">')+value+'</span>';};TrackChangesPane.prototype.onSelection=function(revision){this.currentSelectedRevision=revision;};/**
     * @private
     */TrackChangesPane.prototype.onUserSelect=function(selectedText){this.selectedUser=selectedText;//this.userDropDownButton.content = this.getSpanView(selectedText, 0);
this.sortCollectionToDisplay();};TrackChangesPane.prototype.onMenuSelect=function(selectedText){var _this=this;if(selectedText==='Accept all'){setTimeout(function(){_this.owner.revisionsInternal.handleRevisionCollection(true,_this.sortedRevisions);});}else if(selectedText==='Reject all'){setTimeout(function(){_this.owner.revisionsInternal.handleRevisionCollection(false,_this.sortedRevisions);});}this.updateUsers();};/**
     * @private
     */TrackChangesPane.prototype.onTypeSelect=function(selectedText){this.selectedType=selectedText;//this.viewTypeDropDownButton.content = this.getSpanView(selectedText, 1);
this.sortCollectionToDisplay();};TrackChangesPane.prototype.updateMenuOptions=function(){var revisionType;if(this.selectedType!=='All'){revisionType=this.selectedType==='Inserted'?'Insertion':'Deletion';}// if (this.selectedUser === this.locale.getConstant('All') && this.selectedType === this.locale.getConstant('All')) {
//     this.menuDropDownButton.items[0].text = this.locale.getConstant('Accept all') + ' ' + this.locale.getConstant('Changes');
//     this.menuDropDownButton.items[1].text = this.locale.getConstant('Reject all') + ' ' + this.locale.getConstant('Changes');
// } else if (this.selectedUser === this.locale.getConstant('All') && this.selectedType !== this.locale.getConstant('All')) {
//     this.menuDropDownButton.items[0].text = this.locale.getConstant('Accept all') + ' ' + revisionType;
//     this.menuDropDownButton.items[1].text = this.locale.getConstant('Reject all') + ' ' + revisionType;
// } else if (this.selectedUser !== this.locale.getConstant('All') && this.selectedType === this.locale.getConstant('All')) {
//     this.menuDropDownButton.items[0].text = this.locale.getConstant('Accept all') + ' ' + this.locale.getConstant('Changes') +
//         ' ' + this.locale.getConstant('By').toLowerCase() + ' ' + this.selectedUser;
//     this.menuDropDownButton.items[1].text = this.locale.getConstant('Reject all') + ' ' + this.locale.getConstant('Changes') +
//         ' ' + this.locale.getConstant('By').toLowerCase() + ' ' + this.selectedUser;
// } else {
//     this.menuDropDownButton.items[0].text = this.locale.getConstant('Accept all') + ' ' + revisionType +
//         ' ' + this.locale.getConstant('By').toLowerCase() + ' ' + this.selectedUser;
//     this.menuDropDownButton.items[1].text = this.locale.getConstant('Reject all') + ' ' + revisionType +
//         ' ' + this.locale.getConstant('By').toLowerCase() + ' ' + this.selectedUser;
// }
};TrackChangesPane.prototype.sortCollectionToDisplay=function(){var isRevisionVisible=false;this.sortedRevisions=[];this.updateMenuOptions();for(var i=0;i<this.changes.length;i++){var changes=this.changes.get(this.revisions[i]);var singleChangesDiv=changes.outerSingleDiv;if(this.selectedUser==='All'&&this.selectedType==='All'){singleChangesDiv.style.display='block';isRevisionVisible=true;}else if(this.selectedUser==='All'&&this.selectedType!=='All'){if(changes.revisionType===this.selectedType){singleChangesDiv.style.display='block';isRevisionVisible=true;}else{singleChangesDiv.style.display='none';}}else if(this.selectedUser!=='All'&&this.selectedType==='All'){if(changes.user===this.selectedUser){singleChangesDiv.style.display='block';isRevisionVisible=true;}else{singleChangesDiv.style.display='none';}}else{if(changes.user===this.selectedUser&&changes.revisionType===this.selectedType){singleChangesDiv.style.display='block';isRevisionVisible=true;}else{singleChangesDiv.style.display='none';}}if(singleChangesDiv.style.display==='block'){this.sortedRevisions.push(this.revisions[i]);}}this.setNoChangesVisibility=!isRevisionVisible;};TrackChangesPane.prototype.enableDisableButton=function(enableButton){this.enableButtons=enableButton;this.updateTrackChanges();};TrackChangesPane.prototype.updateTrackChanges=function(show){if(show||sf.base.isNullOrUndefined(show)){if(sf.base.isNullOrUndefined(this.changesInfoDiv)){return;}this.removeAllChanges();// if (!this.enableButtons && !this.menuoptionEle.classList.contains('e-de-overlay')) {
//     this.menuoptionEle.classList.add('e-de-overlay');
//     this.menuDropDownButton.disabled = true;
// } else if (this.menuoptionEle.classList.contains('e-de-overlay')) {
//     this.menuoptionEle.classList.remove('e-de-overlay');
//     this.menuDropDownButton.disabled = false;
// }
for(var i=0;i<this.owner.revisions.changes.length;i++){var revision=this.owner.revisions.changes[i];this.addChanges(revision);}this.sortCollectionToDisplay();this.updateUsers();//if (show) {
this.currentSelectedRevision=this.currentSelectedRevisionInternal;this.updateHeight();this.owner.resize();//}
}else{this.currentSelectedRevision=undefined;}};TrackChangesPane.prototype.updateUsers=function(){if(this.users.length>0){//this.userDropDownButton.removeItems(this.users);
this.users=[];}for(var i=0;i<this.revisions.length;i++){if(this.users.indexOf(this.revisions[i].author)===-1){this.users.push(this.revisions[i].author);//this.userDropDownButton.items.push({ text: this.revisions[i].author });
}}this.owner.dotNetRef.invokeMethodAsync("UpdateRevisionUsers",this.users);};TrackChangesPane.prototype.updateHeight=function(){//tslint:disable-next-line:max-line-length
var tabElement=this.owner.element.getElementsByClassName('e-de-review-pane')[0];if(tabElement){var tabHeaderHeight=tabElement.getElementsByClassName('e-tab-header')[0].getBoundingClientRect().height;var toolbarElement=tabElement.getElementsByClassName('e-de-track-toolbar')[0];if(toolbarElement){this.changesInfoDiv.style.height=tabElement.clientHeight-toolbarElement.clientHeight-tabHeaderHeight-2+'px';}}};TrackChangesPane.prototype.removeAllChanges=function(){if(sf.base.isNullOrUndefined(this.changesInfoDiv)){return;}while(this.changesInfoDiv.childNodes.length>1){this.changesInfoDiv.removeChild(this.changesInfoDiv.lastChild);}this.revisions=[];this.changes.clear();};/**
     * @private
     */TrackChangesPane.prototype.clear=function(){this.removeAllChanges();this.selectedUser='All';//this.userDropDownButton.content = this.getSpanView(this.selectedUser, 0);
this.selectedType='All';//this.viewTypeDropDownButton.content = this.getSpanView(this.selectedType, 1);
this.currentSelectedRevision=undefined;};/**
     * @private
     * @returns {void}
     */TrackChangesPane.prototype.destroy=function(){this.removeAllChanges();// if (this.toolbar) {
//     this.toolbar.destroy();
// }
// if (this.userDropDownButton) {
//     this.userDropDownButton.destroy();
// }
// if (this.viewTypeDropDownButton) {
//     this.viewTypeDropDownButton.destroy();
// }
// if (this.userDropDown) {
//     this.userDropDown = undefined;
// }
if(this.users.length>0){this.users=[];}};TrackChangesPane.prototype.addChanges=function(revision){if(!sf.base.isNullOrUndefined(this.changesInfoDiv)){var currentChangeView=new ChangesSingleView(this.owner,this);this.changesInfoDiv.appendChild(currentChangeView.createSingleChangesDiv(revision));if(!this.enableButtons){if(!currentChangeView.acceptButtonElement.classList.contains('e-de-overlay')){currentChangeView.acceptButtonElement.classList.add('e-de-overlay');currentChangeView.rejectButtonElement.classList.add('e-de-overlay');}}else if(currentChangeView.acceptButtonElement.classList.contains('e-de-overlay')){currentChangeView.acceptButtonElement.classList.remove('e-de-overlay');currentChangeView.rejectButtonElement.classList.remove('e-de-overlay');}this.revisions.push(revision);this.changes.add(revision,currentChangeView);}};TrackChangesPane.prototype.navigatePreviousChanges=function(){this.owner.selection.navigatePreviousRevision();};TrackChangesPane.prototype.navigateNextChanges=function(){this.owner.selection.navigateNextRevision();};return TrackChangesPane;}();var ChangesSingleView=/** @class */function(){function ChangesSingleView(owner,trackChangesPane){this.owner=owner;// this.locale = new L10n('documenteditor', this.owner.defaultLocale);
// this.locale.setLocale(this.owner.locale);
this.trackChangesPane=trackChangesPane;}ChangesSingleView.prototype.createSingleChangesDiv=function(revision){this.revision=revision;this.user=revision.author;this.outerSingleDiv=sf.base.createElement('div',{className:'e-de-tc-outer'});this.singleInnerDiv=sf.base.createElement('div',{className:'e-de-trckchanges-inner'});this.singleInnerDiv.addEventListener('click',this.selectRevision.bind(this));this.outerSingleDiv.appendChild(this.singleInnerDiv);var userNameTotalDiv=sf.base.createElement('div',{className:'e-de-track-usernme-div'});var userNameLabel=sf.base.createElement('div',{innerHTML:revision.author,className:'e-de-track-user-nme'});if(!sf.base.isNullOrUndefined(revision.author)){userNameTotalDiv.style.display='flex';this.owner.documentHelper.getAvatar(userNameTotalDiv,userNameLabel,undefined,revision);}var revisionTypeLabel=sf.base.createElement('div');if(revision.revisionType==='Insertion'){this.revisionType='Inserted';revisionTypeLabel.innerHTML='Inserted'.toUpperCase();revisionTypeLabel.classList.add('e-de-track-insert');}else if(revision.revisionType==='Deletion'){this.revisionType='Deleted';revisionTypeLabel.innerHTML='Deleted'.toUpperCase();revisionTypeLabel.classList.add('e-de-track-delete');}else if(revision.revisionType==='MoveFrom'){this.revisionType='MoveFrom';revisionTypeLabel.innerHTML='Move From'.toUpperCase();revisionTypeLabel.classList.add('e-de-track-delete');revisionTypeLabel.style.whiteSpace='nowrap';}else if(revision.revisionType==='MoveTo'){this.revisionType='MoveTo';revisionTypeLabel.innerHTML='Move To'.toUpperCase();revisionTypeLabel.classList.add('e-de-track-insert');revisionTypeLabel.style.whiteSpace='nowrap';}userNameTotalDiv.appendChild(revisionTypeLabel);this.singleInnerDiv.appendChild(userNameTotalDiv);var dateView=sf.base.createElement('div',{className:'e-de-track-date',innerHTML:HelperMethods.getModifiedDate(revision.date)});this.singleInnerDiv.appendChild(dateView);var changesTextDiv=sf.base.createElement('div',{className:'e-de-track-chngs-text'});this.layoutElementText(revision.range,changesTextDiv);this.singleInnerDiv.appendChild(changesTextDiv);var buttonTotalDiv=sf.base.createElement('div',{styles:'display:inline-block;width:100%'});this.singleInnerDiv.appendChild(buttonTotalDiv);var buttonDiv=sf.base.createElement('div',{styles:'float:left;'});this.acceptButtonElement=sf.base.createElement('button',{className:'e-de-track-accept-button e-btn e-lib e-control e-outline'});this.acceptButtonElement.textContent='Accept';// let acceptButton: Button = new Button({ cssClass: 'e-outline', content:  });
buttonDiv.appendChild(this.acceptButtonElement);buttonTotalDiv.appendChild(buttonDiv);// acceptButton.appendTo(this.acceptButtonElement);
this.acceptButtonElement.addEventListener('click',this.acceptButtonClick.bind(this));buttonDiv=sf.base.createElement('div',{styles:'float:left;'});this.rejectButtonElement=sf.base.createElement('button',{className:'e-de-track-reject-button e-btn e-lib e-control e-outline'});this.rejectButtonElement.textContent='Reject';// let rejectButton: Button = new Button({ cssClass: 'e-outline', content: this.locale.getConstant('Reject') });
buttonDiv.appendChild(this.rejectButtonElement);buttonTotalDiv.appendChild(buttonDiv);//rejectButton.appendTo(this.rejectButtonElement);
this.rejectButtonElement.addEventListener('click',this.rejectButtonClick.bind(this));var changesCount=sf.base.createElement('div',{className:'e-de-track-chngs-count',styles:'float:right;'});var currentCount=this.owner.revisions.changes.indexOf(revision)+1;var totalCount=this.owner.revisions.changes.length;changesCount.innerHTML='Changes'+' '+currentCount.toString()+' '+'of'+' '+totalCount.toString();buttonTotalDiv.appendChild(changesCount);return this.outerSingleDiv;};ChangesSingleView.prototype.selectRevision=function(){this.owner.selection.selectRevision(this.revision);this.trackChangesPane.onSelection(this.revision);};ChangesSingleView.prototype.layoutElementText=function(range,changesText){changesText.style.width='100%';var text='';var toSkip=false;for(var i=0;i<range.length;i++){var element=range[i];if(element instanceof FieldElementBox&&element.fieldType===1){toSkip=false;continue;}if(toSkip){continue;}if(element instanceof FieldElementBox&&element.fieldType===0){toSkip=true;}if(element instanceof TextElementBox){text+=element.text;}else if(element instanceof FieldElementBox&&element.fieldType===0){var fieldCode=this.owner.selection.getFieldCode(element);if(fieldCode.match('TOC ')||fieldCode.match('Toc')){text+='<Table of Content>';changesText.appendChild(this.addSpan(text));return;}else if(fieldCode.match('HYPERLINK ')||fieldCode.match('MERGEFIELD')||fieldCode.match('FORMTEXT')||fieldCode.match('PAGE ')){text+=this.owner.editor.retrieveFieldResultantText(element.fieldEnd);}else if(element.formFieldData){var emptyChar=this.owner.documentHelper.textHelper.repeatChar(this.owner.documentHelper.textHelper.getEnSpaceCharacter(),5);if(text!==''){changesText.appendChild(this.addSpan(text));text='';}if(element.formFieldData instanceof TextFormField){changesText.appendChild(this.addSpan(element.formFieldData.defaultValue===''?emptyChar:element.formFieldData.defaultValue,'e-de-tc-field'));}else if(element.formFieldData instanceof DropDownFormField){changesText.appendChild(this.addSpan(element.formFieldData.dropdownItems.length>0?element.formFieldData.dropdownItems[0]:emptyChar,'e-de-tc-field'));}else{changesText.appendChild(this.addSpan(element.formFieldData.checked?String.fromCharCode(9745):String.fromCharCode(9744),'e-de-tc-field'));}}}else if(element instanceof ImageElementBox){if(text!==''){changesText.appendChild(this.addSpan(text));text='';}var imageEle=sf.base.createElement('img');imageEle.setAttribute('src',element.imageString);imageEle.classList.add('e-de-tc-shrink-img');changesText.appendChild(imageEle);}else if(element instanceof WRowFormat){var tableEle=sf.base.createElement('table');tableEle.classList.add('e-de-track-chng-table');tableEle.insertRow();for(var i_1=0;i_1<element.ownerBase.childWidgets.length;i_1++){tableEle.rows[0].insertCell();tableEle.rows[0].cells[i_1].classList.add('e-de-tc-tble-cell');}changesText.appendChild(tableEle);return;}else if(element instanceof WCharacterFormat){if(text!==''){changesText.appendChild(this.addSpan(text));text='';}var paraMark='';if(element.ownerBase instanceof ParagraphWidget&&element.ownerBase.isEndsWithPageBreak){paraMark='............Page Break............'+paraMark;}changesText.appendChild(this.addSpan(paraMark,'e-de-tc-pmark'));changesText.appendChild(sf.base.createElement('br'));}}changesText.appendChild(this.addSpan(text));};ChangesSingleView.prototype.addSpan=function(text,cssClass){var span=sf.base.createElement('span');span.textContent=text;if(cssClass){span.classList.add(cssClass);}return span;};ChangesSingleView.prototype.acceptButtonClick=function(){this.trackChangesPane.changesInfoDiv.removeChild(this.outerSingleDiv);this.removeFromParentCollec();this.revision.accept();if(this.owner.enableHeaderAndFooter){this.owner.editor.updateHeaderFooterWidget();}};ChangesSingleView.prototype.rejectButtonClick=function(){this.trackChangesPane.changesInfoDiv.removeChild(this.outerSingleDiv);this.removeFromParentCollec();this.revision.reject();if(this.owner.enableHeaderAndFooter){this.owner.editor.updateHeaderFooterWidget();}};ChangesSingleView.prototype.removeFromParentCollec=function(){this.trackChangesPane.changes.remove(this.revision);this.trackChangesPane.revisions.splice(this.trackChangesPane.revisions.indexOf(this.revision),1);if(this.trackChangesPane.changes.length===0){this.trackChangesPane.setNoChangesVisibility=true;}this.trackChangesPane.updateUsers();};return ChangesSingleView;}();/**
 * Track changes
 */ /* eslint-disable */ /**
 * The spell checker module
 */var SpellChecker=/** @class */function(){function SpellChecker(documentHelper){this.langIDInternal=0;/**
         * Specifies whether spell check has to be performed or not.
         */this.enableSpellCheckInternal=true;/**
         * @private
         */ /* eslint-disable @typescript-eslint/no-explicit-any */this.uniqueSpelledWords={};this.spellSuggestionInternal=true;/**
         * @private
         */this.uniqueKey='';this.removeUnderlineInternal=false;/**
         * @default 1000
         */this.uniqueWordsCountInternal=15000;this.performOptimizedCheck=false;this.documentHelper=documentHelper;this.errorWordCollection=new Dictionary();this.errorSuggestions=new Dictionary();this.ignoreAllItems=[];this.uniqueSpelledWords={};this.textSearchResults=new TextSearchResults(this.documentHelper.owner);this.uniqueKey=this.documentHelper.owner.element.id+'_'+this.createGuid();}/**
     * Gets module name.
     */SpellChecker.prototype.getModuleName=function(){return'SpellChecker';};Object.defineProperty(SpellChecker.prototype,"enableOptimizedSpellCheck",{/**
         * Gets the boolean indicating whether optimized spell check to be performed.
         *
         * @aspType bool
         * @blazorType bool
         * @returns {boolean} Returns enableOptimizedSpellCheck
         */get:function get(){return this.performOptimizedCheck;},/**
         * Sets the boolean indicating whether optimized spell check to be performed.
         *
         * @aspType bool
         * @blazorType bool
         */set:function set(value){this.performOptimizedCheck=value;},enumerable:true,configurable:true});Object.defineProperty(SpellChecker.prototype,"uniqueWordsCount",{/**
         * Gets the spell checked Unique words.
         *
         * @aspType int
         * @blazorType int
         */get:function get(){return sf.base.isNullOrUndefined(this.uniqueWordsCountInternal)?0:this.uniqueWordsCountInternal;},/**
         * Sets the spell checked Unique words.
         *
         * @aspType int
         * @blazorType int
         */set:function set(value){this.uniqueWordsCountInternal=value;},enumerable:true,configurable:true});Object.defineProperty(SpellChecker.prototype,"languageID",{/**
         * Gets the languageID.
         *
         * @aspType int
         * @blazorType int
         */get:function get(){return sf.base.isNullOrUndefined(this.langIDInternal)?0:this.langIDInternal;},/**
         * Sets the languageID.
         *
         * @aspType int
         * @blazorType int
         */set:function set(value){this.langIDInternal=value;},enumerable:true,configurable:true});Object.defineProperty(SpellChecker.prototype,"allowSpellCheckAndSuggestion",{/**
         * Getter indicates whether suggestion enabled.
         *
         * @aspType bool
         * @blazorType bool
         */get:function get(){return this.spellSuggestionInternal;},/**
         * Setter to enable or disable suggestion
         *
         * @aspType bool
         * @blazorType bool
         */set:function set(value){this.spellSuggestionInternal=value;},enumerable:true,configurable:true});Object.defineProperty(SpellChecker.prototype,"removeUnderline",{/**
         * Getter indicates whether underline removed for mis-spelled word.
         *
         * @aspType bool
         * @blazorType bool
         */get:function get(){return this.removeUnderlineInternal;},/**
         * Setter to enable or disable underline for mis-spelled word
         *
         * @aspType bool
         * @blazorType bool
         */set:function set(value){this.removeUnderlineInternal=value;this.documentHelper.owner.editor.reLayout(this.documentHelper.selection);},enumerable:true,configurable:true});Object.defineProperty(SpellChecker.prototype,"enableSpellCheck",{/**
         * Getter indicates whether spell check has to be performed or not.
         *
         * @aspType bool
         * @blazorType bool
         */get:function get(){return this.enableSpellCheckInternal;},/**
         * Setter to enable or disable spell check has to be performed or not
         *
         * @aspType bool
         * @blazorType bool
         */set:function set(value){this.enableSpellCheckInternal=value;this.documentHelper.owner.editor.reLayout(this.documentHelper.selection);},enumerable:true,configurable:true});Object.defineProperty(SpellChecker.prototype,"viewer",{get:function get(){return this.documentHelper.owner.viewer;},enumerable:true,configurable:true});/**
     * Method to manage replace logic
     *
     * @private
     */SpellChecker.prototype.manageReplace=function(content,dialogElement){this.documentHelper.triggerSpellCheck=true;var exactText='';if(!sf.base.isNullOrUndefined(dialogElement)&&dialogElement instanceof ErrorTextElementBox){var exactText_1=dialogElement.text;this.documentHelper.selection.start=dialogElement.start;this.documentHelper.selection.end=dialogElement.end;if(content!=='Ignore Once'){content=this.manageSpecialCharacters(exactText_1,content);this.documentHelper.owner.editor.insertTextInternal(content,true);this.documentHelper.selection.start.setPositionInternal(this.documentHelper.selection.end);this.documentHelper.clearSelectionHighlight();return;}else{this.currentContextInfo={'text':exactText_1,'element':dialogElement};}}if(!sf.base.isNullOrUndefined(this.currentContextInfo)&&this.currentContextInfo.element&&content!=='Ignore Once'){var elementBox=this.currentContextInfo.element;exactText=this.currentContextInfo.element.text;this.documentHelper.selection.start=elementBox.start;this.documentHelper.selection.end=elementBox.end;}else{this.handleReplace(content);}if(content!=='Ignore Once'){this.documentHelper.owner.editor.insertTextInternal(content,true);if(!sf.base.isNullOrUndefined(this.currentContextInfo)){this.removeErrorsFromCollection(this.currentContextInfo);}this.documentHelper.selection.start.setPositionInternal(this.documentHelper.selection.end);this.documentHelper.clearSelectionHighlight();}//this.documentHelper.owner.errorWordCollection.remove(content);
this.documentHelper.triggerSpellCheck=false;};/**
     * Method to handle replace logic
     *
     * @private
     */SpellChecker.prototype.handleReplace=function(content){var startPosition=this.documentHelper.selection.start;var offset=startPosition.offset;var startIndex=0;var startInlineObj=startPosition.currentWidget.getInline(offset,startIndex,false,true);var startOffset=startInlineObj.element.line.getOffset(startInlineObj.element,0)+startInlineObj.element.length;if(startOffset===offset){this.retrieveExactElementInfo(startInlineObj);}var exactText=startInlineObj.element.text;var startPattern=new RegExp('^[#\\@\\!\\~\\$\\%\\^\\&\\*\\(\\)\\-\\_\\+\\=\\{\\}\\[\\]\\:\\;\\"\'\\,\\<\\.\\>\\/\\?\\`\\s]+','g');var matches=[];var matchInfo;// eslint-disable  no-cond-assign
while(!sf.base.isNullOrUndefined(matchInfo=startPattern.exec(exactText))){matches.push(matchInfo);}if(content==='Ignore Once'){this.handleIgnoreOnce(startInlineObj);return;}startPosition.offset=offset-startInlineObj.index;if(!sf.base.isNullOrUndefined(matches)&&matches.length>0){startPosition.offset+=matches[0].toString().length;}startPosition.location=this.documentHelper.owner.selection.getPhysicalPositionInternal(startPosition.currentWidget,startPosition.offset,true);startPosition=this.documentHelper.owner.searchModule.textSearch.getTextPosition(startPosition.currentWidget,startPosition.offset.toString());//startPosition.location = this.owner.selection.getPhysicalPositionInternal(span.line, offset, true);
startPosition.setPositionParagraph(startPosition.currentWidget,startPosition.offset);var index=startPosition.offset+startInlineObj.element.length-startPosition.offset;var endOffset=startPosition.currentWidget.getOffset(startInlineObj.element,index);var lineWidget=startPosition.currentWidget;var endPattern=new RegExp('[#\\@\\!\\~\\$\\%\\^\\&\\*\\(\\)\\-\\_\\+\\=\\{\\}\\[\\]\\:\\;\\"\'\\,\\<\\.\\>\\/\\?\\s\\`]+$','g');matches=[];// eslint-disable  no-cond-assign
while(!sf.base.isNullOrUndefined(matchInfo=endPattern.exec(exactText))){matches.push(matchInfo);}if(!sf.base.isNullOrUndefined(matches)&&matches.length>0){endOffset-=matches[0].toString().length;}this.documentHelper.selection.end=this.documentHelper.owner.searchModule.textSearch.getTextPosition(lineWidget,endOffset.toString());this.documentHelper.selection.end.location=this.documentHelper.owner.selection.getPhysicalPositionInternal(startPosition.currentWidget,endOffset,true);this.documentHelper.selection.end.setPositionParagraph(lineWidget,endOffset);this.currentContextInfo={'element':startInlineObj.element,'text':startInlineObj.element.text};};/**
     * Method to retrieve exact element info
     *
     * @private
     */SpellChecker.prototype.retrieveExactElementInfo=function(startInlineObj){var nextElement=startInlineObj.element.nextElement;startInlineObj.element=!sf.base.isNullOrUndefined(nextElement)&&nextElement instanceof TextElementBox?startInlineObj.element.nextElement:startInlineObj.element;};/**
     * Method to handle to ignore error Once
     *
     * @private
     */SpellChecker.prototype.handleIgnoreOnce=function(startInlineObj){var textElement=startInlineObj.element;var exactText='';if(!sf.base.isNullOrUndefined(this.currentContextInfo)&&this.currentContextInfo.element){exactText=this.currentContextInfo.element.text;}else{exactText=textElement.text;}exactText=this.manageSpecialCharacters(exactText,undefined,true);if(textElement.ignoreOnceItems.indexOf(exactText)===-1){textElement.ignoreOnceItems.push(exactText);}this.documentHelper.owner.editor.reLayout(this.documentHelper.selection);};/**
     * Method to handle ignore all items
     *
     * @private
     */SpellChecker.prototype.handleIgnoreAllItems=function(contextElement){var contextItem=!sf.base.isNullOrUndefined(contextElement)?contextElement:this.retriveText();var retrievedText=this.manageSpecialCharacters(contextItem.text,undefined,true);if(this.ignoreAllItems.indexOf(retrievedText)===-1){this.ignoreAllItems.push(retrievedText);this.removeErrorsFromCollection(contextItem);this.documentHelper.triggerSpellCheck=true;this.documentHelper.owner.editor.reLayout(this.documentHelper.selection);this.documentHelper.triggerSpellCheck=false;this.documentHelper.clearSelectionHighlight();}};/**
     * Method to handle dictionary
     *
     * @private
     */SpellChecker.prototype.handleAddToDictionary=function(contextElement){var _this=this;var contextItem=!sf.base.isNullOrUndefined(contextElement)?contextElement:this.retriveText();var retrievedText=this.manageSpecialCharacters(contextItem.text,undefined,true);/* eslint-disable @typescript-eslint/no-explicit-any */this.callSpellChecker(this.languageID,retrievedText,false,false,true).then(function(data){_this.documentHelper.triggerSpellCheck=true;_this.removeErrorsFromCollection(contextItem);_this.ignoreAllItems.push(retrievedText);_this.documentHelper.owner.editor.reLayout(_this.documentHelper.selection,true);_this.documentHelper.triggerSpellCheck=false;});};/**
     * Method to append/remove special characters
     *
     * @private
     */SpellChecker.prototype.manageSpecialCharacters=function(exactText,replaceText,isRemove){if(!sf.base.isNullOrUndefined(exactText)){if(sf.base.isNullOrUndefined(replaceText)){replaceText=exactText;}var pattern=new RegExp('^[#\\@\\!\\~\\$\\%\\^\\&\\*\\(\\)\\-\\_\\+\\=\\{\\}\\[\\]\\:\\;\\"\\\'\\,\\<\\.\\>\\/\\?\\`\\s]+','g');var matches=[];var matchInfo=void 0;// eslint-disable  no-cond-assign
while(!sf.base.isNullOrUndefined(matchInfo=pattern.exec(exactText))){matches.push(matchInfo);}if(matches.length>0){for(var i=0;i<matches.length;i++){/* eslint-disable @typescript-eslint/no-explicit-any */var match=matches[i];replaceText=!isRemove?match[0]+replaceText:replaceText.replace(match[0],'');}}var endPattern=new RegExp('[#\\@\\!\\~\\$\\%\\^\\&\\*\\(\\)\\-\\_\\+\\=\\{\\}\\[\\]\\:\\;\\"\\\'\\,\\<\\.\\>\\/\\?\\s\\`]+$','g');matches=[];// eslint-disable  no-cond-assign
while(!sf.base.isNullOrUndefined(matchInfo=endPattern.exec(replaceText))){matches.push(matchInfo);}if(matches.length>0){for(var i=0;i<matches.length;i++){/* eslint-disable @typescript-eslint/no-explicit-any */var match=matches[i];replaceText=!isRemove?replaceText+match[0]:replaceText.slice(0,match.index);}}}return replaceText;};/**
     * Method to remove errors
     *
     * @private
     */SpellChecker.prototype.removeErrorsFromCollection=function(contextItem){if(this.errorWordCollection.containsKey(contextItem.text)){var textElement=this.errorWordCollection.get(contextItem.text);if(textElement.indexOf(contextItem.element)>=0){textElement.splice(0,1);}if(textElement.length===0){this.errorWordCollection.remove(contextItem.text);}}};/**
     * Method to retrieve exact text
     *
     * @private
     */SpellChecker.prototype.retriveText=function(){var exactText;var currentElement;if(!sf.base.isNullOrUndefined(this.currentContextInfo)&&this.currentContextInfo.element){currentElement=this.currentContextInfo.element;exactText=this.currentContextInfo.element.text;this.documentHelper.selection.start=currentElement.start;this.documentHelper.selection.end=currentElement.end;}else{var startPosition=this.documentHelper.selection.start;var offset=startPosition.offset;var startIndex=0;var startInlineObj=startPosition.currentWidget.getInline(offset,startIndex);currentElement=startInlineObj.element;exactText=startInlineObj.element.text;}return{'text':exactText,'element':currentElement};};/**
     * Method to handle suggestions
     *
     * @private
     */ /* eslint-disable @typescript-eslint/no-explicit-any */SpellChecker.prototype.handleSuggestions=function(allsuggestions){this.spellCheckSuggestion=[];if(allsuggestions.length===0){this.spellCheckSuggestion.push('Add to Dictionary');}else{allsuggestions=allsuggestions.length===5?this.constructInlineMenu(allsuggestions):allsuggestions;this.spellCheckSuggestion.push('Add to Dictionary');}/* eslint-disable @typescript-eslint/no-explicit-any */var spellSuggestion=[];if(this.spellCheckSuggestion.length>0){for(var _i=0,_a=this.spellCheckSuggestion;_i<_a.length;_i++){var str=_a[_i];spellSuggestion.push({text:str,id:this.documentHelper.owner.element.id+'_contextmenu_otherSuggestions_spellcheck_'+str,iconCss:''});}}return spellSuggestion;};/**
     * Method to check whether text element has errors
     *
     * @private
     */SpellChecker.prototype.checktextElementHasErrors=function(text,element,left){var hasError=false;var erroElements=[];text=text.replace(/[\s]+/g,'');if(!sf.base.isNullOrUndefined(element.errorCollection)&&element.errorCollection.length>0){if(!this.documentHelper.isScrollHandler&&(element.ischangeDetected||element.paragraph.isChangeDetected)){this.updateStatusForGlobalErrors(element.errorCollection,element);element.errorCollection=[];element.ischangeDetected=true;return{'errorFound':hasError,'elements':erroElements};}for(var i=0;i<element.errorCollection.length;i++){if(this.handleErrorCollection(element.errorCollection[i])){hasError=true;erroElements.push(element.errorCollection[i]);}}}else if(!this.documentHelper.isScrollHandler&&element.paragraph.isChangeDetected){element.ischangeDetected=true;}else if(!element.ischangeDetected&&this.handleErrorCollection(element)){hasError=true;erroElements.push(element);}return{'errorFound':hasError,'elements':erroElements};};SpellChecker.prototype.updateStatusForGlobalErrors=function(erroElements,parentElement){if(erroElements.length>0){for(var i=0;i<erroElements.length;i++){var exactText=this.manageSpecialCharacters(erroElements[i].text,undefined,true);if(this.errorWordCollection.containsKey(exactText)){var elements=this.errorWordCollection.get(exactText);for(var j=0;j<elements.length;j++){if(elements[j]instanceof ErrorTextElementBox&&elements[j]===erroElements[i]){elements[j].ischangeDetected=true;elements[j].start.offset=parentElement.line.getOffset(parentElement.istextCombined?this.getCombinedElement(parentElement):parentElement,0);elements[j].line=parentElement.line;break;}}}}}};/**
     * Method to handle document error collection.
     *
     * @param {string} errorInElement
     * @private
     */SpellChecker.prototype.handleErrorCollection=function(errorInElement){var errors=this.errorWordCollection;var exactText=this.manageSpecialCharacters(errorInElement.text,undefined,true);if(errors.containsKey(exactText)&&errorInElement.length>1){var ignoreAllIndex=this.ignoreAllItems.indexOf(exactText);if(ignoreAllIndex>-1){if(errors.containsKey(exactText)){errors.remove(exactText);}return false;}return true;}return false;};/* eslint-disable @typescript-eslint/no-explicit-any */SpellChecker.prototype.constructInlineMenu=function(inlineSuggestion){for(var i=inlineSuggestion.length-1;i>0;i--){if(inlineSuggestion.length>3){this.spellCheckSuggestion.push(inlineSuggestion[i]);inlineSuggestion.pop();}}return inlineSuggestion;};/**
     * Method to retrieve error element text
     *
     * @private
     */SpellChecker.prototype.findCurretText=function(){var insertPosition=this.documentHelper.selection.start;/* eslint-disable @typescript-eslint/no-explicit-any */var element;/* eslint-disable @typescript-eslint/no-explicit-any */var inlineObj=insertPosition.currentWidget.getInline(this.documentHelper.selection.start.offset,0);var text;if(!sf.base.isNullOrUndefined(inlineObj.element)){if(!sf.base.isNullOrUndefined(inlineObj.element.errorCollection)&&inlineObj.element.errorCollection.length>0){for(var i=0;i<inlineObj.element.errorCollection.length;i++){var errorElement=inlineObj.element.errorCollection[i];if(errorElement.start.location.x<=insertPosition.location.x&&errorElement.end.location.x>=insertPosition.location.x){text=errorElement.text;element=errorElement;break;}}}else{text=inlineObj.element.text;}if(text===' '){inlineObj=insertPosition.currentWidget.getInline(this.documentHelper.selection.start.offset+1,0);text=inlineObj.element.text;}}return{'text':text,'element':element};};SpellChecker.prototype.addErrorCollection=function(text,elementToCompare,suggestions){text=this.manageSpecialCharacters(text,undefined,true);if(this.errorWordCollection.containsKey(text)){var errorElements=this.errorWordCollection.get(text);if(elementToCompare instanceof ErrorTextElementBox){if(!this.compareErrorTextElement(elementToCompare,errorElements)){errorElements.push(elementToCompare);}}else if(elementToCompare instanceof TextElementBox){if(!this.compareTextElement(elementToCompare,errorElements)){errorElements.push(elementToCompare);}}}else{if(!sf.base.isNullOrUndefined(suggestions)&&suggestions.length>0){this.errorSuggestions.add(text,suggestions);}this.errorWordCollection.add(text,[elementToCompare]);}};SpellChecker.prototype.compareErrorTextElement=function(errorElement,errorCollection){var copyElement=[];var isChanged=false;for(var i=0;i<errorCollection.length;i++){copyElement.push(errorCollection[i]);}var length=errorCollection.length;for(var i=0;i<length;i++){if(copyElement[i]instanceof ErrorTextElementBox){if(copyElement[i].ischangeDetected){var exactText=this.manageSpecialCharacters(copyElement[i].text,undefined,true);isChanged=true;this.removeErrorsFromCollection({'element':copyElement[i],'text':exactText});}else{var currentElement=copyElement[i];if(errorElement.start.offset===currentElement.start.offset&&errorElement.end.offset===currentElement.end.offset){return true;}}}}if(isChanged){this.errorWordCollection.add(this.manageSpecialCharacters(errorElement.text,undefined,true),[errorElement]);}return false;};/**
     * Method to compare text elements
     *
     * @private
     */SpellChecker.prototype.compareTextElement=function(errorElement,errorCollection){for(var i=0;i<errorCollection.length;i++){if(errorCollection[i]instanceof TextElementBox){var currentElement=errorCollection[i];if(currentElement===errorElement){return true;}}}return false;};/**
     * Method to handle Word by word spell check
     *
     * @private
     */SpellChecker.prototype.handleWordByWordSpellCheck=function(jsonObject,elementBox,left,top,underlineY,baselineAlignment,isSamePage){if(jsonObject.HasSpellingError&&isSamePage){this.addErrorCollection(elementBox.text,elementBox,jsonObject.Suggestions);var backgroundColor=elementBox.line.paragraph.containerWidget instanceof TableCellWidget?elementBox.line.paragraph.containerWidget.cellFormat.shading.backgroundColor:this.documentHelper.backgroundColor;this.documentHelper.render.renderWavyLine(elementBox,left,top,underlineY,'#FF0000','Single',baselineAlignment,backgroundColor);elementBox.isSpellChecked=true;}else{elementBox.isSpellChecked=true;}};/**
     * Method to check errors for combined elements
     *
     * @private
     */SpellChecker.prototype.checkElementCanBeCombined=function(elementBox,underlineY,beforeIndex,callSpellChecker,textToCombine,isNext,isPrevious,canCombine){var currentText=sf.base.isNullOrUndefined(textToCombine)?'':textToCombine;var isCombined=sf.base.isNullOrUndefined(canCombine)?false:canCombine;var checkPrevious=!sf.base.isNullOrUndefined(isPrevious)?isPrevious:true;var checkNext=!sf.base.isNullOrUndefined(isNext)?isNext:true;var combinedElements=[];var line=this.documentHelper.selection.getLineWidget(elementBox,0);var index=line.children.indexOf(elementBox);var prevText=elementBox.text;combinedElements.push(elementBox);var difference=isPrevious?0:1;var prevCombined=false;var isPrevField=false;if(elementBox.text!=='\v'){if(checkPrevious){var textElement=undefined;for(var i=index-difference;i>=0;i--){textElement=line.children[i];if(textElement instanceof TextElementBox&&!isPrevField){if(prevText.indexOf(' ')!==0&&textElement.text.lastIndexOf(' ')!==textElement.text.length-1){prevCombined=!sf.base.isNullOrUndefined(textToCombine)?true:false;currentText=textElement.text+currentText;prevText=textElement.text;isPrevField=false;combinedElements.push(textElement);isCombined=true;}else if(!sf.base.isNullOrUndefined(textElement)){textElement=textElement.nextElement;break;}}else if(textElement instanceof FieldElementBox&&textElement.fieldType!==1){isPrevField=true;}}var currentElement=isCombined?textElement:elementBox;if(this.lookThroughPreviousLine(currentText,prevText,currentElement,underlineY,beforeIndex)){return true;}}if(isPrevious){currentText=prevCombined?currentText:elementBox.text+currentText;}else{currentText+=elementBox.text;}isPrevField=false;var nextText=elementBox.text;if(checkNext){var canCombine_1=false;var element=undefined;for(var i=index+1;i<line.children.length;i++){element=line.children[i];if(element instanceof TextElementBox&&!isPrevField){if(nextText.lastIndexOf(' ')!==nextText.length-1&&element.text.indexOf(' ')!==0){currentText+=element.text;nextText=element.text;isPrevField=false;combinedElements.push(element);canCombine_1=true;isCombined=true;}else if(!sf.base.isNullOrUndefined(element)){element=element.previousElement;break;}}else if(element instanceof FieldElementBox&&element.fieldType!==2){isPrevField=true;}}var currentElement=canCombine_1?element:elementBox;if(currentElement.text!=='\f'&&this.lookThroughNextLine(currentText,prevText,currentElement,underlineY,beforeIndex)){return true;}}}if(isCombined&&callSpellChecker&&!this.checkCombinedElementsBeIgnored(combinedElements,currentText)){this.handleCombinedElements(elementBox,currentText,underlineY,beforeIndex);}return isCombined;};SpellChecker.prototype.lookThroughPreviousLine=function(currentText,prevText,currentElement,underlineY,beforeIndex){if(!sf.base.isNullOrUndefined(currentElement)&&currentElement.indexInOwner===0&&!sf.base.isNullOrUndefined(currentElement.line.previousLine)){var previousLine=currentElement.line.previousLine;var index=previousLine.children.length-1;if(!sf.base.isNullOrUndefined(previousLine.children[index])&&previousLine.children[index]instanceof TextElementBox){var firstElement=previousLine.children[index];if(!sf.base.isNullOrUndefined(currentElement.text)){if(currentElement.text.indexOf(' ')!==0&&firstElement.text.lastIndexOf(' ')!==firstElement.text.length-1){currentText=currentText.length>0?currentText:prevText;this.checkElementCanBeCombined(firstElement,underlineY,beforeIndex,true,currentText,false,true,true);return true;}}}}return false;};SpellChecker.prototype.lookThroughNextLine=function(currentText,prevText,elementBox,underlineY,beforeIndex){if(!sf.base.isNullOrUndefined(elementBox)&&elementBox.indexInOwner===elementBox.line.children.length-1&&!sf.base.isNullOrUndefined(elementBox.line.nextLine)){var nextLine=elementBox.line.nextLine;if(!sf.base.isNullOrUndefined(nextLine.children[0])&&nextLine.children[0]instanceof TextElementBox){var firstElement=nextLine.children[0];if(elementBox.text.lastIndexOf(' ')!==elementBox.text.length-1&&firstElement.text.indexOf(' ')!==0){currentText=currentText.length>0?currentText:prevText;this.checkElementCanBeCombined(firstElement,underlineY,beforeIndex,true,currentText,true,false,true);return true;}}}return false;};/**
     * Method to handle combined elements
     *
     * @param {TextElementBox} elementBox
     * @param {string} currentText
     * @param {number} underlineY
     * @param {number} beforeIndex
     * @private
     */SpellChecker.prototype.handleCombinedElements=function(elementBox,currentText,underlineY,beforeIndex){elementBox.istextCombined=true;var splittedText=currentText.split(/[\s]+/);if(this.ignoreAllItems.indexOf(currentText)===-1&&elementBox instanceof TextElementBox&&elementBox.ignoreOnceItems.indexOf(currentText)===-1){if(splittedText.length>1){for(var i=0;i<splittedText.length;i++){var currentText_1=splittedText[i];currentText_1=this.manageSpecialCharacters(currentText_1,undefined,true);this.documentHelper.render.handleUnorderedElements(currentText_1,elementBox,underlineY,i,0,i===splittedText.length-1,beforeIndex);}}else{currentText=this.manageSpecialCharacters(currentText,undefined,true);this.documentHelper.render.handleUnorderedElements(currentText,elementBox,underlineY,0,0,true,beforeIndex);}}};/**
     * Method to check error element collection has unique element
     *
     * @param {ErrorTextElementBox[]} errorCollection
     * @param {ErrorTextElementBox} elementToCheck
     * @private
     */SpellChecker.prototype.checkArrayHasSameElement=function(errorCollection,elementToCheck){for(var i=0;i<errorCollection.length;i++){var errorText=errorCollection[i];if(errorText.start.location.x===elementToCheck.start.location.x&&errorText.start.location.y===elementToCheck.start.location.y){return true;}}return false;};/**
     * @private
     */SpellChecker.prototype.handleSplitWordSpellCheck=function(jsonObject,currentText,elementBox,isSamePage,underlineY,iteration,markIndex,isLastItem){if(jsonObject.HasSpellingError&&elementBox.text!==' '&&isSamePage){var matchResults=this.getMatchedResultsFromElement(elementBox,currentText);markIndex=elementBox.istextCombined?elementBox.line.getOffset(this.getCombinedElement(elementBox),0):markIndex;this.documentHelper.owner.searchModule.textSearch.updateMatchedTextLocation(matchResults.matches,matchResults.textResults,matchResults.elementInfo,0,elementBox,false,null,markIndex);this.handleMatchedResults(matchResults.textResults,elementBox,underlineY,iteration,jsonObject.Suggestions,isLastItem);}else if(isLastItem){elementBox.isSpellChecked=true;}this.updateUniqueWords([{Text:currentText,HasSpellError:jsonObject.HasSpellingError}]);};SpellChecker.prototype.handleMatchedResults=function(results,elementBox,wavyLineY,index,suggestions,isLastItem){if(results.length===0&&isLastItem){elementBox.isSpellChecked=true;return;}for(var i=0;i<results.length;i++){var span=this.createErrorElementWithInfo(results.innerList[i],elementBox);var color='#FF0000';if(!sf.base.isNullOrUndefined(elementBox.errorCollection)&&!this.checkArrayHasSameElement(elementBox.errorCollection,span)){elementBox.errorCollection.splice(index,0,span);}this.addErrorCollection(span.text,span,suggestions);var backgroundColor=elementBox.line.paragraph.containerWidget instanceof TableCellWidget?elementBox.paragraph.containerWidget.cellFormat.shading.backgroundColor:this.documentHelper.backgroundColor;this.documentHelper.render.renderWavyLine(span,span.start.location.x,span.start.location.y-elementBox.margin.top,wavyLineY,color,'Single',elementBox.characterFormat.baselineAlignment,backgroundColor);if(isLastItem){elementBox.isSpellChecked=true;}}};/**
     * Calls the spell checker service
     * @private
     */ /* eslint-disable @typescript-eslint/no-explicit-any */SpellChecker.prototype.callSpellChecker=function(languageID,word,checkSpelling,checkSuggestion,addWord,isByPage){var _this=this;var spellchecker=this;return new Promise(function(resolve,reject){if(!sf.base.isNullOrUndefined(_this)){var httpRequest_1=new XMLHttpRequest();var service_1=_this.documentHelper.owner.serviceUrl+_this.documentHelper.owner.serverActionSettings.spellCheck;service_1=isByPage?service_1+'ByPage':service_1;httpRequest_1.open('POST',service_1,true);httpRequest_1.setRequestHeader('Content-Type','application/json');_this.setCustomHeaders(httpRequest_1);/* eslint-disable @typescript-eslint/no-explicit-any */var spellCheckData={LanguageID:languageID,TexttoCheck:word,CheckSpelling:checkSpelling,CheckSuggestion:checkSuggestion,AddWord:addWord};httpRequest_1.send(JSON.stringify(spellCheckData));httpRequest_1.onreadystatechange=function(){if(httpRequest_1.readyState===4){if(httpRequest_1.status===200||httpRequest_1.status===304){resolve(httpRequest_1.response);}else{var result={name:'onFailure',status:httpRequest_1.status,statusText:httpRequest_1.responseText,url:service_1};spellchecker.documentHelper.owner.fireServiceFailure(result);reject(httpRequest_1.response);}}};}});};SpellChecker.prototype.setCustomHeaders=function(httpRequest){for(var i=0;i<this.documentHelper.owner.headers.length;i++){var header=this.documentHelper.owner.headers[i];for(var _i=0,_a=Object.keys(header);_i<_a.length;_i++){var key=_a[_i];httpRequest.setRequestHeader(key,header[key]);}}};/**
     * Method to check for next error
     *
     * @private
     * @returns {void}
     */SpellChecker.prototype.checkForNextError=function(){if(!sf.base.isNullOrUndefined(this.viewer)){var errorWords=this.errorWordCollection;if(errorWords.length>0){for(var i=0;i<errorWords.length;i++){var errorElements=errorWords.get(errorWords.keys[i]);for(var j=0;j<errorElements.length;j++){if(errorElements[j]instanceof ErrorTextElementBox&&!errorElements[j].ischangeDetected){this.updateErrorElementTextBox(errorWords.keys[i],errorElements[j]);}else if(errorElements[j]instanceof TextElementBox){var matchResults=this.getMatchedResultsFromElement(errorElements[j]);var results=matchResults.textResults;var markIndex=errorElements[j].ischangeDetected?errorElements[j].start.offset:errorElements[j].line.getOffset(errorElements[j],0);this.documentHelper.owner.searchModule.textSearch.updateMatchedTextLocation(matchResults.matches,results,matchResults.elementInfo,0,errorElements[j],false,null,markIndex);for(var i_1=0;i_1<results.length;i_1++){var element=this.createErrorElementWithInfo(results.innerList[i_1],errorElements[j]);this.updateErrorElementTextBox(element.text,element);break;}}break;}break;}}else{this.documentHelper.clearSelectionHighlight();}}};/**
     * Method to create error element with matched results
     *
     * @param {TextSearchResult} result
     * @param {ElementBox} errorElement
     * @private
     */SpellChecker.prototype.createErrorElementWithInfo=function(result,errorElement){var element=new ErrorTextElementBox();element.text=result.text;element.start=result.start;element.end=result.end;element.height=errorElement.height;element.canTrigger=errorElement.canTrigger;element.characterFormat.copyFormat(errorElement.characterFormat);element.width=this.documentHelper.textHelper.getWidth(element.text,errorElement.characterFormat);return element;};/**
     * Method to get matched results from element box
     *
     * @private
     * @param {ElementBox} errorElement - Specifies the error element box.
     * @param {string} currentText - Specifies the current text
     * @returns {MatchResults} - Returns match results info.
     */SpellChecker.prototype.getMatchedResultsFromElement=function(errorElement,currentText){var line=errorElement.line;var pattern=this.documentHelper.owner.searchModule.textSearch.stringToRegex(sf.base.isNullOrUndefined(currentText)?errorElement.text:currentText,'CaseSensitive');this.textSearchResults.clearResults();var results=this.textSearchResults;var textLineInfo=this.documentHelper.owner.searchModule.textSearch.getElementInfo(line.children[0],0,false);var text=textLineInfo.fullText;var matches=[];var spans=textLineInfo.elementsWithOffset;var matchObject;// eslint-disable  no-cond-assign
while(!sf.base.isNullOrUndefined(matchObject=pattern.exec(text))){matches.push(matchObject);}return{'matches':matches,'elementInfo':spans,'textResults':results};};/**
     * Method to update error element information
     *
     * @private
     * @param {string} error - Specifies the error word.
     * @param {ErrorTextElementBox} errorElement - Specifies the error element box.
     * @returns {void}
     */SpellChecker.prototype.updateErrorElementTextBox=function(error,errorElement){var element=errorElement;this.documentHelper.clearSelectionHighlight();this.documentHelper.selection.start=element.start;this.documentHelper.selection.end=element.end;this.documentHelper.selection.highlight(errorElement.start.paragraph,errorElement.start,errorElement.end);//this.documentHelper.owner.spellCheckDialog.updateSuggestionDialog(error, element);
};/**
     * Method to retrieve space information in a text
     *
     * @private
     * @param {string} text - Specifies the text
     * @param {WCharacterFormat} characterFormat - Specifies the character format.
     * @returns {SpecialCharacterInfo} - Returs special character info.
     */SpellChecker.prototype.getWhiteSpaceCharacterInfo=function(text,characterFormat){/* eslint-disable @typescript-eslint/no-explicit-any */var matchedText=[];var width=0;var length=0;matchedText=text.match(/[\s]+/);if(!sf.base.isNullOrUndefined(matchedText)&&matchedText.length>0){for(var i=0;i<matchedText.length;i++){width+=this.documentHelper.textHelper.getWidth(matchedText[i],characterFormat);length+=matchedText[i].length;}}return{'width':width,'wordLength':length,'isBeginning':!sf.base.isNullOrUndefined(matchedText)&&matchedText.index===0};};/**
     * Retrieve Special character info
     *
     * @private
     * @param {string} text - Specifies the text
     * @param {WCharacterFormat} characterFormat - Specifies the character format.
     * @returns {SpecialCharacterInfo} - Returs special character info.
     */SpellChecker.prototype.getSpecialCharactersInfo=function(text,characterFormat){/* eslint-disable @typescript-eslint/no-explicit-any */var matchedText=[];var beginingwidth=0;var endWidth=0;var length=0;matchedText=text.match(/^[\#\@\!\~\$\%\^\&\*\(\)\-\_\+\=\{\}\[\]\:\;\"\'\,\<\.\>\/\?\`]*/);for(var i=0;i<matchedText.length;i++){if(!sf.base.isNullOrUndefined(matchedText[i])&&matchedText[i].length>0){beginingwidth=this.documentHelper.textHelper.getWidth(matchedText[i],characterFormat);}length=matchedText.length;}matchedText=text.match(/[\#\@\!\~\$\%\^\&\*\(\)\-\_\+\=\{\}\[\]\:\;\"\'\,\<\.\>\/\?\`]*$/);for(var i=0;i<matchedText.length;i++){if(!sf.base.isNullOrUndefined(matchedText[i])&&matchedText[i].length>0){endWidth=this.documentHelper.textHelper.getWidth(matchedText[i],characterFormat);}length=matchedText.length;}return{'beginningWidth':beginingwidth,'endWidth':endWidth,'wordLength':length};};/**
     * Method to retrieve next available combined element
     *
     * @private
     * @param {ElementBox} element - Specified the element.
     * @returns {ElementBox} - Returns combined element.
     */SpellChecker.prototype.getCombinedElement=function(element){var prevElement=element;while(!sf.base.isNullOrUndefined(element)&&element instanceof TextElementBox&&element.istextCombined){prevElement=element;element=element.previousElement;}return prevElement;};SpellChecker.prototype.checkCombinedElementsBeIgnored=function(elements,exactText){exactText=this.manageSpecialCharacters(exactText,undefined,true);for(var i=0;i<elements.length;i++){if(elements[i].ignoreOnceItems.indexOf(exactText)!==-1){return true;}}return false;};/**
     * Method to update error collection
     *
     * @private
     * @param {TextElementBox} currentElement - Specifies current element.
     * @param {TextElementBox} splittedElement - Specifies splitted element.
     * @returns {void}
     */SpellChecker.prototype.updateSplittedElementError=function(currentElement,splittedElement){var errorCount=currentElement.errorCollection.length;if(errorCount>0){var errorCollection=[];for(var i=0;i<errorCount;i++){errorCollection.push(currentElement.errorCollection[i]);}for(var i=0;i<errorCount;i++){if(currentElement.text.indexOf(errorCollection[i].text)===-1){splittedElement.ischangeDetected=true;currentElement.errorCollection.splice(0,1);}}}};/**
     * @private
     * @param {Page} page - Specifies the page.
     * @returns {string} - Returns page content.
     */SpellChecker.prototype.getPageContent=function(page){var content='';if(this.documentHelper.owner.sfdtExportModule){var sfdtExport=this.documentHelper.owner.sfdtExportModule;sfdtExport.Initialize();var document_1=sfdtExport.writePage(page);if(this.documentHelper.owner.textExportModule){var textExport=this.documentHelper.owner.textExportModule;textExport.pageContent='';textExport.setDocument(document_1);textExport.writeInternal();content=textExport.pageContent;}}return content;};/**
     * @private
     * @param {any[]} spelledWords - Specifies spelledWords
     * @returns {void}
     */SpellChecker.prototype.updateUniqueWords=function(spelledWords){if(!sf.base.isNullOrUndefined(localStorage.getItem(this.uniqueKey))){this.uniqueSpelledWords=JSON.parse(localStorage.getItem(this.uniqueKey));}this.uniqueSpelledWords=this.uniqueSpelledWords||{};var totalCount=spelledWords.length+Object.keys(this.uniqueSpelledWords).length;if(totalCount<=this.uniqueWordsCount){for(var i=0;i<spelledWords.length;i++){this.checkForUniqueWords(spelledWords[i]);}}localStorage.setItem(this.uniqueKey,JSON.stringify(this.uniqueSpelledWords));this.uniqueSpelledWords={};};SpellChecker.prototype.checkForUniqueWords=function(spellData){var identityMatched=this.uniqueSpelledWords[spellData.Text];if(!identityMatched){this.uniqueSpelledWords[spellData.Text]=spellData.HasSpellError;}};/**
     * Method to clear cached words for spell check
     *
     * @returns {void}
     */SpellChecker.prototype.clearCache=function(){if(!sf.base.isNullOrUndefined(localStorage.getItem(this.uniqueKey))){localStorage.removeItem(this.uniqueKey);}};SpellChecker.prototype.createGuid=function(){var dateTime=new Date().getTime();var uuid='xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(_char3){var randNo=(dateTime+Math.random()*16)%16|0;dateTime=Math.floor(dateTime/16);return(_char3==='x'?randNo:randNo&0x3|0x8).toString(16);});return uuid;};/**
     * Check spelling in page data
     *
     * @private
     * @param {string} wordToCheck - Specifies wordToCheck
     * @returns {WordSpellInfo} - Retruns WordSpellInfo
     */SpellChecker.prototype.checkSpellingInPageInfo=function(wordToCheck){var hasError=false;var elementPresent=false;/* eslint-disable @typescript-eslint/no-explicit-any */var uniqueWords=JSON.parse(localStorage.getItem(this.uniqueKey));if(!sf.base.isNullOrUndefined(uniqueWords)){if(!sf.base.isNullOrUndefined(uniqueWords[wordToCheck])){return{hasSpellError:uniqueWords[wordToCheck],isElementPresent:true};}}return{hasSpellError:hasError,isElementPresent:elementPresent};};/**
     * @private
     * @returns {void}
     */SpellChecker.prototype.destroy=function(){this.errorWordCollection=undefined;this.ignoreAllItems=undefined;this.errorSuggestions=undefined;this.uniqueSpelledWords={};this.textSearchResults=undefined;if(!sf.base.isNullOrUndefined(localStorage.getItem(this.uniqueKey))){localStorage.removeItem(this.uniqueKey);}};return SpellChecker;}();var __extends$2=undefined&&undefined.__extends||function(){var _extendStatics=function extendStatics(d,b){_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;}||function(d,b){for(var p in b){if(b.hasOwnProperty(p))d[p]=b[p];}};return _extendStatics(d,b);};return function(d,b){_extendStatics(d,b);function __(){this.constructor=d;}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};}();/**
 * @private
 */var DocumentHelper=/** @class */function(){//#endregion
function DocumentHelper(owner){var _this=this;/**
         * @private
         */this.scrollbarWidth=0;/**
         * @private
         */this.isWebPrinting=false;/**
         * @private
         */this.isHeaderFooter=false;/**
         * @private
         */this.currentPage=undefined;this.selectionStartPageIn=undefined;this.selectionEndPageIn=undefined;/**
         * @private
         */this.fieldStacks=[];/**
         * @private
         */this.showRevision=false;/**
         * @private
         */this.splittedCellWidgets=[];/**
         * @private
         */this.tableLefts=[];/**
         * @private
         */this.tapCount=0;this.timer=-1;this.isTimerStarted=false;/**
         * @private
         */this.isFirstLineFitInShiftWidgets=false;/**
         * @private
         */this.preZoomFactor=0;/**
         * @private
         */this.preDifference=-1;/**
         * @private
         */this.fieldEndParagraph=undefined;/**
         * @private
         */this.fieldToLayout=undefined;/**
         * @private
         */this.backgroundColor='#FFFFFF';// Event
/**
         * @private
         */this.isMouseDown=false;this.isMouseEntered=false;// eslint-disable-next-line
this.scrollMoveTimer=0;/**
         * @private
         */this.isSelectionChangedOnMouseMoved=false;/**
         * @private
         */this.isControlPressed=false;/**
         * @private
         */this.isTouchInput=false;/**
         * @private
         */this.isTouchMoved=false;/**
         * @private
         */this.useTouchSelectionMark=false;/**
         * @private
         */this.touchDownOnSelectionMark=0;/**
         * @private
         */this.isComposingIME=false;/**
         * @private
         */this.lastComposedText='';/**
         * @private
         */this.isCompositionStart=false;/**
         * @private
         */this.isCompositionUpdated=false;/**
         * @private
         */this.isCompositionCanceled=false;/**
         * @private
         */this.isCompositionEnd=false;/**
         * @private
         */this.prefix='';/**
         * @private
         */this.suffix='';/**
         * @private
         */this.fields=[];/**
         * @private
         */this.heightInfoCollection={};/**
         * @private
         */this.defaultTabWidth=36;/**
         * @private
         */this.dontUseHtmlParagraphAutoSpacing=false;/**
         * @private
         */this.alignTablesRowByRow=false;/**
         * @private
         */this.compatibilityMode="Word2013";/**
         * @private
         */this.lists=[];/**
         * @private
         */this.comments=[];/**
         * @private
         */this.authors=new Dictionary();/**
         * @private
         */this.revisionsInternal=new Dictionary();/**
         * @private
         */this.commentUserOptionId=1;/**
         * @private
         */this.abstractLists=[];/**
         * @private
         */this.styles=new WStyles();/**
         * @private
         */this.preDefinedStyles=undefined;/**
         * @private
         */this.isRowOrCellResizing=false;/**
         * @private
         */this.formFields=[];this.isMouseDownInFooterRegion=false;this.pageFitTypeIn='None';/**
         * @private
         */this.fieldCollection=[];/**
         * @private
         */this.isPageField=false;/**
         * @private
         */this.mouseDownOffset=new Point(0,0);this.zoomFactorInternal=1;/**
         * If movecaretposition is 1, Home key is pressed
         * If moveCaretPosition is 2, End key is pressed
         *
         * @private
         */this.moveCaretPosition=0;/**
         * @private
         */this.isTextInput=false;/**
         * @private
         */this.isScrollHandler=false;/**
         * @private
         */this.triggerElementsOnLoading=false;/**
         * @private
         */this.triggerSpellCheck=false;//Document Protection Properties Starts
/**
         * preserve the format
         *
         * @private
         */this.restrictFormatting=false;/**
         * preserve the document protection type either readonly or no protection
         *
         * @private
         */this.protectionType='NoProtection';/**
         * Preserve the password protection is enforced or not
         *
         * @private
         */this.isDocumentProtected=false;/**
         * preserve the hash value of password
         *
         * @private
         */this.hashValue='';/**
         * @private
         */this.saltValue='';/**
         * @private
         */this.userCollection=[];// public formFillPopup: FormFieldPopUp;
/**
         * @private
         */this.cachedPages=[];/**
         * @private
         */this.skipScrollToPosition=false;/**
         * @private
         */this.isIosDevice=false;/**
         * @private
         */this.isMobileDevice=false;/**
         * @private
         */this.isFormFilling=false;/**
         * @private
         */this.footnotes=new Footnote();/**
         * @private
         */this.endnotes=new Footnote();/**
         * @private
         */this.isFootnoteWidget=false;/**
         * @private
         * @param {TextEvent} event - Specifies text event.
         * @returns {void}
         */this.onTextInput=function(event){if(!_this.isComposingIME){event.preventDefault();var text=event.data;_this.owner.editor.handleTextInput(text);}};//#region Composition Event
/**
         * Fires when composition starts.
         *
         * @private
         * @returns {void}
         */this.compositionStart=function(){if(!sf.base.Browser.isDevice&&!_this.owner.isReadOnlyMode){_this.isComposingIME=true;_this.positionEditableTarget();if(_this.owner.editorHistory){_this.owner.editor.initComplexHistory('IMEInput');}}_this.isCompositionStart=true;};/**
         * Fires on every input during composition.
         *
         * @private
         * @returns {void}
         */this.compositionUpdated=function(){if(_this.isComposingIME&&!_this.owner.isReadOnlyMode){setTimeout(function(){_this.owner.editor.insertIMEText(_this.getEditableDivTextContent(),true);},0);}_this.isCompositionUpdated=true;};/**
         * Fires when user selects a character/word and finalizes the input.
         *
         * @private
         * @param {CompositionEvent} event - Specifies text compisition event.
         * @returns {void}
         */this.compositionEnd=function(event){if(_this.isComposingIME&&!_this.owner.isReadOnlyMode){var text=_this.getEditableDivTextContent();if(text!==''){_this.owner.editor.insertIMEText(text,false);}_this.isComposingIME=false;_this.lastComposedText='';_this.iframe.setAttribute('style','pointer-events:none;position:absolute;left:'+_this.owner.viewer.containerLeft+'px;top:'+_this.owner.viewer.containerTop+'px;outline:none;background-color:transparent;width:0px;height:0px;overflow:hidden');_this.editableDiv.innerHTML='';if(_this.owner.editorHistory){_this.owner.editorHistory.updateComplexHistory();if(text===''){//When the composition in live. The Undo operation will terminate the composition and empty text will be return from text box.
//At that time the the history should be updated. Undo the operation and clear the redo stack. This undo operation will not be saved for redo operation.
_this.owner.editorHistory.undo();_this.owner.editorHistory.redoStack.pop();}}}event.preventDefault();_this.isCompositionUpdated=false;_this.isCompositionEnd=true;};/* eslint-enable @typescript-eslint/no-explicit-any */ /**
         * @private
         * @param {KeyboardEvent} event - Specifies keyboard event
         * @returns {void}
         */this.onKeyPressInternal=function(event){var key=event.which||event.keyCode;_this.triggerElementsOnLoading=false;var ctrl=event.ctrlKey||event.metaKey?true:key===17?true:false;// ctrl detection
var alt=event.altKey?event.altKey:key===18?true:false;// alt key detection
if(sf.base.Browser.isIE&&alt&&ctrl){ctrl=false;}// tslint:disable-next-line:max-line-length
if(ctrl&&event.key==='v'||ctrl&&event.key==='a'||(ctrl||_this.isControlPressed&&sf.base.Browser.isIE)&&event.key==='p'){if(sf.base.Browser.isIE){_this.isControlPressed=false;}return;}if(!_this.owner.isReadOnlyMode||_this.selection&&_this.selection.isInlineFormFillMode()){var key_1=event.keyCode||event.charCode;var _char4='';if(key_1){_char4=String.fromCharCode(key_1);}else if(event.key){_char4=event.key;}if(_char4!==' '&&_char4!=='\r'&&_char4!=='\b'&&_char4!=="\x1B"&&!ctrl){_this.owner.editorModule.handleTextInput(_char4);}else if(_char4===' '){_this.triggerSpellCheck=true;_this.owner.editorModule.handleTextInput(' ');_this.triggerSpellCheck=false;}event.preventDefault();}};/**
         * @private
         * @param {KeyboardEvent} event - Specifies keyboard event
         * @returns {void}
         */this.onTextInputInternal=function(event){if(!_this.owner.isReadOnlyMode){_this.owner.editorModule.onTextInputInternal();}else{_this.editableDiv.innerText='';}};/**
         * Fired on paste.
         *
         * @private
         * @param {ClipboardEvent} event - Specifies clipboard event.
         * @returns {void}
         */this.onPaste=function(event){if(!_this.owner.isReadOnlyMode&&_this.owner.editor.canEditContentControl||_this.selection.isInlineFormFillMode()){_this.owner.editorModule.pasteInternal(event);}_this.editableDiv.innerText='';event.preventDefault();};/**
         * Fires when editable div loses focus.
         *
         * @private
         * @returns {void}
         */this.onFocusOut=function(){if(!sf.base.isNullOrUndefined(_this.selection)){// if (this.owner.contextMenuModule && this.owner.contextMenuModule.contextMenuInstance &&
//     this.owner.contextMenuModule.contextMenuInstance.element.style.display === 'block') {
//     return;
// }
_this.selection.hideCaret();}};/**
         * Updates focus to editor area.
         *
         * @private
         * @returns {void}
         */this.updateFocus=function(){if(_this.selection&&!(_this.isMobileDevice&&_this.owner.isReadOnly)){if(!sf.base.Browser.isDevice&&!sf.base.Browser.isIE&&!navigator.userAgent.match('Edge')){_this.iframe.focus();}_this.editableDiv.focus();_this.selection.showCaret();}};/**
         * Fires on scrolling.
         *
         * @returns {void}
         */this.scrollHandler=function(){if(_this.scrollTimer){clearTimeout(_this.scrollTimer);}_this.clearContent();_this.isScrollHandler=true;if(!sf.base.Browser.isDevice&&!_this.isComposingIME){_this.iframe.style.top=_this.owner.viewer.containerTop+'px';_this.iframe.style.left=_this.owner.viewer.containerLeft+'px';}_this.owner.viewer.updateScrollBars();// eslint-disable-next-line max-len
var vtHeight=_this.owner.viewer.containerTop+_this.visibleBounds.height-(_this.owner.viewer.padding.top+_this.owner.viewer.padding.bottom);if(vtHeight>_this.pageContainer.offsetHeight){_this.viewerContainer.scrollTop=_this.owner.viewer.containerTop-(vtHeight-_this.pageContainer.offsetHeight);}if(_this.owner.viewer instanceof PageLayoutViewer&&!sf.base.isNullOrUndefined(_this.owner)){_this.owner.fireViewChange();}_this.isScrollHandler=false;_this.scrollTimer=setTimeout(function(){if(!_this.isScrollHandler&&!sf.base.isNullOrUndefined(_this.owner)&&_this.owner.isSpellCheck){_this.isScrollToSpellCheck=true;_this.owner.viewer.updateScrollBars();}},200);};/**
         * Fires when the window gets resized.
         *
         * @private
         * @returns {void}
         */this.onWindowResize=function(){if(_this.resizeTimer){clearTimeout(_this.resizeTimer);}_this.resizeTimer=setTimeout(function(){if(!sf.base.isNullOrUndefined(_this.owner)&&!sf.base.isNullOrUndefined(_this.owner.element)){_this.updateViewerSize();_this.clearContent();_this.owner.viewer.updateScrollBars();if(!sf.base.isNullOrUndefined(_this.selection)){_this.selection.updateCaretPosition();}_this.updateTouchMarkPosition();// if (this.owner.contextMenuModule && this.owner.contextMenuModule.contextMenuInstance) {
//     this.owner.contextMenuModule.contextMenuInstance.close();
// }
if(_this.resizeTimer){clearTimeout(_this.resizeTimer);}}},200);};/**
         * @private
         * @param {MouseEvent} event - Specified mouse event.
         * @returns {void}
         */this.onContextMenu=function(event){// if (this.owner.contextMenuModule) {
//     if (this.isMouseDown) {
//         this.isMouseDown = false;
//     }
//     this.owner.contextMenuModule.onContextMenuInternal(event);
// }
};/**
         * Called on mouse down.
         *
         * @private
         * @param {MouseEvent} event - Specifies mouse event.
         * @returns {void}
         */this.onMouseDownInternal=function(event){var target=event.target;if(!sf.base.isNullOrUndefined(target)&&target!==_this.viewerContainer||_this.isTouchInput||event.offsetX>_this.visibleBounds.width-(_this.visibleBounds.width-_this.viewerContainer.clientWidth)||event.offsetY>_this.visibleBounds.height-(_this.visibleBounds.height-_this.viewerContainer.clientHeight)){return;}_this.isFootnoteWidget=false;if(!sf.base.isNullOrUndefined(_this.selection)){_this.updateCursor(event);_this.owner.hideFormFieldPopup();// if (this.formFillPopup) {
//     this.formFillPopup.hidePopup();
// }
// eslint-disable-next-line max-len
if(_this.isLeftButtonPressed(event)&&!_this.owner.isReadOnlyMode&&_this.owner.enableImageResizerMode&&!sf.base.isNullOrUndefined(_this.owner.imageResizerModule.selectedResizeElement)){if(_this.selection.isInShape){var textFram=_this.owner.selection.getCurrentTextFrame();var shape=textFram.containerShape;_this.selection.selectShape(shape);}_this.owner.imageResizerModule.isImageResizing=true;}event.preventDefault();if(!_this.isTouchInput){_this.selection.hideCaret();}var cursorPoint=new Point(event.offsetX,event.offsetY);var touchPoint=_this.owner.viewer.findFocusedPage(cursorPoint,true);_this.mouseDownOffset.x=touchPoint.x;_this.mouseDownOffset.y=touchPoint.y;// eslint-disable-next-line max-len
_this.isMouseDownInFooterRegion=_this.selection.isCursorInsidePageRect(cursorPoint,_this.currentPage)&&_this.selection.isCursorInFooterRegion(cursorPoint,_this.currentPage);_this.isSelectionChangedOnMouseMoved=false;if(!_this.owner.isReadOnlyMode&&(_this.owner.editorModule.tableResize.isInCellResizerArea(touchPoint)||_this.owner.editorModule.tableResize.isInRowResizerArea(touchPoint))){_this.selection.hideCaret();_this.isMouseDown=true;_this.isSelectionChangedOnMouseMoved=false;if(_this.isLeftButtonPressed(event)){_this.owner.editorModule.tableResize.startingPoint.x=touchPoint.x;_this.owner.editorModule.tableResize.startingPoint.y=touchPoint.y;_this.owner.editorModule.tableResize.handleResize(touchPoint);}return;}if(event.ctrlKey){_this.isControlPressed=true;}if(_this.owner.selection.isEmpty){_this.useTouchSelectionMark=false;}if(event.which===3&&!_this.owner.selection.isEmpty&&_this.selection.checkCursorIsInSelection(_this.getLineWidget(touchPoint),touchPoint)){event.preventDefault();return;}_this.isTouchInput=false;_this.isMouseDown=true;_this.updateFocus();/* eslint-disable @typescript-eslint/indent */_this.timer=setTimeout(function(){_this.tapCount++;if(_this.tapCount>1){_this.tapCount=1;}},100);}};/**
         * Called on mouse move.
         *
         * @private
         * @param {MouseEvent} event - Specified mouse event.
         * @returns {void}
         */this.onMouseMoveInternal=function(event){if(!sf.base.isNullOrUndefined(event.target)&&event.target!==_this.viewerContainer){return;}event.preventDefault();if(!sf.base.isNullOrUndefined(_this.selection)){//For image Resizing
if(!_this.owner.isReadOnlyMode&&_this.owner.enableImageResizerMode&&_this.owner.imageResizerModule.isImageResizing){if(!_this.owner.imageResizerModule.isImageMoveToNextPage){_this.owner.imageResizerModule.handleImageResizingOnMouse(event);}return;}var cursorPoint=new Point(event.offsetX,event.offsetY);var touchPoint=_this.owner.viewer.findFocusedPage(cursorPoint,!_this.owner.enableHeaderAndFooter);if(_this.isMouseDown){if(!sf.base.isNullOrUndefined(_this.currentPage)){var xPosition=touchPoint.x;var yPosition=touchPoint.y;if(!_this.owner.isReadOnlyMode&&_this.isRowOrCellResizing){var table=_this.owner.editorModule.tableResize.currentResizingTable;var startPosition=_this.selection.setPositionForBlock(table,true);var endPosition=_this.selection.setPositionForBlock(table,false);// eslint-disable-next-line max-len
if(!_this.owner.documentHelper.isDocumentProtected||_this.selection.checkSelectionIsAtEditRegion(startPosition,endPosition)){_this.owner.editorModule.tableResize.handleResizing(touchPoint);}}else{if(!(_this.isTouchInput||_this.isSelectionChangedOnMouseMoved||_this.touchDownOnSelectionMark>0)){_this.updateTextPositionForSelection(touchPoint,1);}if(_this.isLeftButtonPressed(event)){event.preventDefault();var touchY=yPosition;var textPosition=_this.owner.selection.end;var touchPoint_1=new Point(xPosition,touchY);if(!_this.owner.enableImageResizerMode||!_this.owner.imageResizerModule.isImageResizerVisible||_this.owner.imageResizerModule.isShapeResize){_this.owner.selection.moveTextPosition(touchPoint_1,textPosition);}_this.isSelectionChangedOnMouseMoved=true;}}}_this.selection.checkForCursorVisibility();}if(!_this.isRowOrCellResizing&&!_this.isSelectionChangedOnMouseMoved){_this.updateCursor(event);}if(_this.isRowOrCellResizing){_this.selection.hideCaret();}}};/**
         * @private
         * @param {MouseEvent} event - Specifies mouse event
         * @returns {void}
         */this.onMouseLeaveInternal=function(event){event.preventDefault();var cursorPoint=new Point(event.offsetX,event.offsetY);if(_this.isMouseDown){var viewerTop=_this.viewerContainer.scrollTop;if(event.offsetY+viewerTop>viewerTop){_this.scrollMoveTimer=setInterval(function(){_this.scrollForwardOnSelection(cursorPoint);clearInterval(_this.scrollMoveTimer);},500);}else{_this.scrollMoveTimer=setInterval(function(){_this.scrollBackwardOnSelection(cursorPoint);clearInterval(_this.scrollMoveTimer);},500);}if(_this.isMouseEntered){_this.isMouseEntered=false;}}};/**
         * @private
         * @returns {void}
         */this.onMouseEnterInternal=function(){if(!_this.isMouseEntered){_this.owner.viewer.updateScrollBars();}_this.isMouseEntered=true;if(_this.scrollMoveTimer){clearInterval(_this.scrollMoveTimer);}};/**
         * Fired on double tap.
         *
         * @private
         * @param {MouseEvent} event - Specifies mouse event.
         * @returns {void}
         */this.onDoubleTap=function(event){if(!sf.base.isNullOrUndefined(event.target)&&event.target!==_this.viewerContainer){return;}if(!sf.base.isNullOrUndefined(_this.selection)){_this.isTouchInput=false;var cursorPoint=new Point(event.offsetX,event.offsetY);var touchPoint=_this.owner.viewer.findFocusedPage(cursorPoint,true);if(_this.selection.checkAndEnableHeaderFooter(cursorPoint,_this.owner.viewer.findFocusedPage(cursorPoint,true))){return;}var widget=_this.getLineWidget(touchPoint);var formField=_this.selection.getHyperLinkFieldInCurrentSelection(widget,touchPoint,true);if(sf.base.isNullOrUndefined(formField)){formField=_this.selection.getCurrentFormField();}if(!_this.isDocumentProtected&&_this.owner.enableFormField){var formatType=_this.selection.getFormFieldType(formField);if(formatType){if(formatType.toString()!==''){_this.selection.selectField(formField);}_this.owner.showDialog(formatType);}}else if(_this.isDocumentProtected&&formField&&formField.formFieldData instanceof TextFormField&&formField.formFieldData.type==='Text'){_this.selection.selectField();}else{_this.tapCount=2;return;}var startPosition=_this.selection.start.clone();var endPosition=_this.selection.end.clone();var inlineObj=startPosition.currentWidget.getInline(startPosition.offset,0);var inline=inlineObj.element;if(_this.owner.layoutType==='Pages'){if(inline instanceof FootnoteElementBox){if(inline.footnoteType==='Footnote'){var footnotes=_this.currentPage.footnoteWidget;var i=void 0;for(i=1;i<=footnotes.childWidgets.length;i++){var footnoteText=footnotes.childWidgets[i].footNoteReference;if(inline.text===footnoteText.text){break;}}startPosition.setPositionParagraph(footnotes.childWidgets[i].childWidgets[0],0);endPosition.setPositionParagraph(footnotes.childWidgets[i].childWidgets[0],0);_this.selection.selectRange(startPosition,endPosition);}else{var endnotes=_this.pages[_this.pages.length-1].endnoteWidget;var i=void 0;if(!sf.base.isNullOrUndefined(endnotes)){for(i=1;i<=endnotes.childWidgets.length;i++){var endnoteText=endnotes.childWidgets[i].footNoteReference;if(inline.text===endnoteText.text){break;}}}startPosition.setPositionParagraph(endnotes.childWidgets[i].childWidgets[0],0);endPosition.setPositionParagraph(endnotes.childWidgets[i].childWidgets[0],0);_this.selection.selectRange(startPosition,endPosition);}}else{if(inline instanceof TextElementBox&&(_this.selection.isinEndnote||_this.selection.isinFootnote)){_this.selection.footnoteReferenceElement(startPosition,endPosition,inline);}}}if(_this.selection.isEmpty&&!sf.base.isNullOrUndefined(_this.currentPage)&&!sf.base.isNullOrUndefined(_this.owner.selection.start)){_this.owner.selection.selectCurrentWord();_this.selection.checkForCursorVisibility();_this.tapCount=2;}}};/**
         * Called on mouse up.
         *
         * @private
         * @param {MouseEvent} event - Specifies mouse event.
         * @return {void}
         */ /* eslint-disable  */this.onMouseUpInternal=function(event){if(!sf.base.isNullOrUndefined(event.target)&&event.target!==_this.viewerContainer){return;}event.preventDefault();_this.isListTextSelected=false;var cursorPoint=new Point(event.offsetX,event.offsetY);var touchPoint=_this.owner.viewer.findFocusedPage(cursorPoint,true);if(!sf.base.isNullOrUndefined(_this.selection)){var tapCount=1;if(!sf.base.Browser.isIE){if(event.detail>2){tapCount=event.detail;}}else{tapCount=_this.tapCount;}if(_this.isRowOrCellResizing){_this.owner.editorModule.tableResize.updateResizingHistory(touchPoint);}if(_this.isMouseDown&&!_this.isSelectionChangedOnMouseMoved&&!sf.base.isNullOrUndefined(_this.currentPage)&&!sf.base.isNullOrUndefined(_this.owner.selection.start)&&(!_this.owner.enableImageResizerMode||!_this.owner.imageResizerModule.isImageResizing)){if(_this.touchDownOnSelectionMark===0&&!_this.isRowOrCellResizing){_this.updateTextPositionForSelection(touchPoint,tapCount);// Update selection change immediately to blazor
if(!_this.isLeftButtonPressed(event)){_this.owner.fireSelectionChangeInternal();}if(sf.base.Browser.isIE&&tapCount===2){_this.selection.checkAndEnableHeaderFooter(cursorPoint,touchPoint);}}_this.selection.checkForCursorVisibility();// if (!isNullOrUndefined(this.currentSelectedComment) && this.owner.commentReviewPane
//     && !this.owner.commentReviewPane.commentPane.isEditMode) {
//     this.currentSelectedComment = undefined;
// }
if(!sf.base.isNullOrUndefined(_this.currentSelectedComment)){_this.currentSelectedComment=undefined;_this.owner.dotNetRef.invokeMethodAsync('SetSelectedComment',"");}}var isCtrlkeyPressed=_this.isIosDevice?event.metaKey:event.ctrlKey;if(!sf.base.isNullOrUndefined(_this.currentPage)&&!sf.base.isNullOrUndefined(_this.owner.selection.start)&&(_this.owner.selection.isEmpty||_this.owner.selection.isImageSelected)&&(isCtrlkeyPressed&&_this.owner.useCtrlClickToFollowHyperlink||!_this.owner.useCtrlClickToFollowHyperlink)&&_this.isLeftButtonPressed(event)===true){_this.selection.navigateHyperLinkOnEvent(touchPoint,false);}if(_this.isMouseDown&&_this.isLeftButtonPressed(event)&&_this.isDocumentProtected&&_this.protectionType==='FormFieldsOnly'&&_this.selection){var widget=_this.getLineWidget(touchPoint);var formField=_this.selection.getHyperLinkFieldInCurrentSelection(widget,touchPoint,true);if(sf.base.isNullOrUndefined(formField)){formField=_this.selection.getCurrentFormField(true);}if(formField&&formField.formFieldData&&formField.formFieldData.enabled&&!_this.selection.isInlineFormFillMode(formField)){var data={'fieldName':formField.formFieldData.name};if(formField.formFieldData instanceof TextFormField){data.value=formField.resultText;}else if(formField.formFieldData instanceof CheckBoxFormField){data.value=formField.formFieldData.checked;}else{data.value=formField.formFieldData.selectedIndex;}// this.owner.trigger('beforeFormFieldFill', data);
if(!(formField.formFieldData instanceof CheckBoxFormField)){var formFieldInfo={};if(formField.formFieldData instanceof DropDownFormField){formFieldInfo.type='DropDown';formFieldInfo.defaultValue=formField.formFieldData.dropdownItems;formFieldInfo.value=formField.formFieldData.selectedIndex;}else{var formData=formField.formFieldData;if(formData instanceof TextFormField){formFieldInfo.type="Text";var resultText=formField.resultText;var rex=new RegExp(_this.owner.documentHelper.textHelper.getEnSpaceCharacter(),'gi');if(resultText.replace(rex,'')===''){resultText='';}formFieldInfo.maxLength=formField.formFieldData.maxLength;formFieldInfo.textFormType=formField.formFieldData.type;formFieldInfo.defaultValue=formField.formFieldData.defaultValue;formFieldInfo.value=resultText?resultText:'';formFieldInfo.textFormType="Text";if(formData.type=='Number'){formFieldInfo.textFormType="Number";formFieldInfo.format=formData.format;formFieldInfo.value=parseFloat(resultText.replace(/,/gi,''));}else if(formData.type=='Date'){formFieldInfo.textFormType="Date";var format=formData.format;if(format.indexOf('am/pm')!==-1){format=format.replace(/am\/pm/gi,'a');}formFieldInfo.format=format;formFieldInfo.value=resultText;}}}var left=_this.owner.selection.getLeftInternal(formField.line,formField,0);var lineHeight=formField.line.height*_this.owner.documentHelper.zoomFactor;var position=_this.owner.selection.getTooltipPosition(formField.line,left,370,100,true);position.y=position.y+lineHeight;formFieldInfo.position=position;_this.owner.showFormFieldPopup(formFieldInfo);}else{//TODO: After form field event
_this.owner.editor.toggleCheckBoxFormField(formField);}}if(!formField&&_this.isFormFillProtectedMode){_this.selection.navigateToNextFormField();}}else if(_this.isMouseDown){if(_this.formFields.length>0){var formField=_this.selection.getCurrentFormField(true);if(formField&&formField.formFieldData instanceof TextFormField){_this.selection.selectField();}else if(_this.isLeftButtonPressed(event)&&formField&&formField.formFieldData instanceof DropDownFormField){var offset=formField.line.getOffset(formField,0);var point=_this.selection.getPhysicalPositionInternal(formField.line,offset,false);_this.selection.selectInternal(formField.line,formField,0,point);}}}if(!_this.owner.isReadOnlyMode&&_this.isSelectionInListText(touchPoint)){_this.selection.selectListText();}if(!_this.owner.isReadOnlyMode&&_this.owner.enableImageResizerMode&&_this.owner.imageResizerModule.isImageResizing){_this.owner.imageResizerModule.mouseUpInternal();_this.scrollToPosition(_this.owner.selection.start,_this.owner.selection.end);_this.owner.imageResizerModule.isImageResizing=false;}if(_this.owner.enableImageResizerMode&&_this.owner.imageResizerModule.isImageResizerVisible&&!sf.base.isNullOrUndefined(_this.selection.caret)){_this.selection.caret.style.display='none';}_this.isMouseDown=false;_this.isFootnoteWidget=false;_this.isSelectionChangedOnMouseMoved=false;_this.isTouchInput=false;_this.useTouchSelectionMark=true;_this.isControlPressed=false;_this.updateFocus();if(_this.isListTextSelected){_this.selection.hideCaret();}if(_this.owner.enableImageResizerMode){var imageResizer=_this.owner.imageResizerModule;imageResizer.isImageResizing=false;imageResizer.isImageMoveToNextPage=false;imageResizer.leftValue=undefined;imageResizer.topValue=undefined;}_this.isMouseDownInFooterRegion=false;}};/**
         * Fired on touch start.
         *
         * @private
         * @param {TouchEvent} event - Specifies touch event.
         * @returns {void}
         */this.onTouchStartInternal=function(event){if(_this.selection){_this.isTouchMoved=false;_this.isCompositionStart=false;_this.isCompositionEnd=false;_this.isCompositionUpdated=false;_this.isCompositionCanceled=true;_this.isTouchInput=true;if(_this.isTimerStarted){if(_this.tapCount===1){_this.tapCount=2;}else{_this.tapCount=3;_this.isTimerStarted=false;}}else{_this.isTimerStarted=true;_this.tapCount=1;}if(event.touches.length===1){_this.zoomX=event.touches[0].clientX;_this.zoomY=event.touches[0].clientY;if(_this.owner.selection.isEmpty){_this.useTouchSelectionMark=false;}_this.isMouseDown=true;_this.isSelectionChangedOnMouseMoved=false;var point=void 0;if(_this.isMouseDown){point=_this.getTouchOffsetValue(event);}point=_this.owner.viewer.findFocusedPage(point,true);if(_this.owner.enableImageResizerMode){var resizeObj=_this.owner.imageResizerModule.getImagePointOnTouch(point);_this.owner.imageResizerModule.selectedResizeElement=resizeObj.selectedElement;}if(_this.owner.enableImageResizerMode&&!sf.base.isNullOrUndefined(_this.owner.imageResizerModule.selectedResizeElement)){_this.owner.imageResizerModule.isImageResizing=true;}var x=_this.owner.selection.end.location.x;var y=_this.selection.getCaretBottom(_this.owner.selection.end,_this.owner.selection.isEmpty)+9;//TouchDownOnSelectionMark will be 2 when touch end is pressed
_this.touchDownOnSelectionMark=(point.y<=y&&point.y>=y-20||point.y>=y&&point.y<=y+20)&&(point.x<=x&&point.x>=x-20||point.x>=x&&point.x<=x+20)?1:0;if(!_this.owner.selection.isEmpty&&_this.touchDownOnSelectionMark===0){x=_this.owner.selection.start.location.x;y=_this.selection.getCaretBottom(_this.owner.selection.start,false)+9;//TouchDownOnSelectionMark will be 1 when touch start is pressed
_this.touchDownOnSelectionMark=(point.y<=y&&point.y>=y-20||point.y>=y&&point.y<=y+20)&&(point.x<=x&&point.x>=x-20||point.x>=x&&point.x<=x+20)?2:0;}}// if (!isNullOrUndefined(this.owner.contextMenuModule) && this.owner.contextMenuModule.contextMenuInstance) {
//     this.owner.contextMenuModule.contextMenuInstance.close();
// }
if(_this.touchDownOnSelectionMark||event.touches.length>1){event.preventDefault();}_this.longTouchTimer=setTimeout(_this.onLongTouch,500,event);_this.timer=setTimeout(function(){_this.isTimerStarted=false;},200);}};/**
         * Fired on long touch
         *
         * @private
         * @param {TouchEvent} event - Specifies touch event.
         * @returns {void}
         */this.onLongTouch=function(event){if(sf.base.isNullOrUndefined(_this.owner)||sf.base.isNullOrUndefined(_this.viewerContainer)||_this.isTouchMoved||event.touches.length!==1){return;}var point=_this.getTouchOffsetValue(event);var pointRelToPage=_this.owner.viewer.findFocusedPage(point,true);var selStart=_this.selection.start;var selEnd=_this.selection.end;var updateSel=false;if(!_this.selection.isForward){selStart=_this.selection.end;selEnd=_this.selection.start;}var selStartPt=selStart.location;var selEndPt=selEnd.location;if(selStart.currentWidget!==selEnd.currentWidget){updateSel=!(pointRelToPage.x>=selStartPt.x&&pointRelToPage.x<=selEndPt.x)&&!(pointRelToPage.y>=selStartPt.y&&pointRelToPage.y<=selEndPt.y);}else{updateSel=!(pointRelToPage.x>=selStartPt.x&&pointRelToPage.x<=selEndPt.x)||!(pointRelToPage.y>=selStartPt.y&&pointRelToPage.y<=selEndPt.y);}if(event.changedTouches.length===1&&updateSel){_this.updateSelectionOnTouch(point,pointRelToPage);_this.isMouseDown=false;_this.touchDownOnSelectionMark=0;_this.useTouchSelectionMark=true;_this.isSelectionChangedOnMouseMoved=false;}if(_this.selection.isEmpty){_this.selection.selectCurrentWord();}// if (!isNullOrUndefined(this.owner.contextMenuModule) && this.owner.contextMenuModule.contextMenuInstance) {
//     this.owner.contextMenuModule.onContextMenuInternal(event);
// }
};/**
         *
         * @private
         * @param {TouchEvent} event - Specifies touch event.
         * @returns {void}
         */this.onTouchMoveInternal=function(event){_this.isTouchMoved=true;var touch=event.touches;var cursorPoint;if(!sf.base.isNullOrUndefined(_this.selection)){if(_this.owner.editorModule&&_this.owner.enableImageResizerMode&&_this.owner.imageResizerModule.isImageResizing){event.preventDefault();if(!_this.owner.imageResizerModule.isImageMoveToNextPage){_this.owner.imageResizerModule.handleImageResizingOnTouch(event);_this.selection.caret.style.display='none';}return;}if(_this.isMouseDown){cursorPoint=_this.getTouchOffsetValue(event);var touchPoint=_this.owner.viewer.findFocusedPage(cursorPoint,true);if(_this.touchDownOnSelectionMark>0/*|| !this.useTouchSelectionMark*/){event.preventDefault();var touchY=touchPoint.y;var textPosition=_this.owner.selection.end;if(touchPoint.y<=26){touchY-=touchPoint.y<0?0:touchPoint.y+0.5;}else{touchY-=36.5;}textPosition=_this.touchDownOnSelectionMark===2?_this.selection.start:_this.selection.end;touchPoint=new Point(touchPoint.x,touchY);_this.owner.selection.moveTextPosition(touchPoint,textPosition);_this.isSelectionChangedOnMouseMoved=true;}_this.selection.checkForCursorVisibility();_this.updateTouchMarkPosition();}}if(touch.length>1){event.preventDefault();_this.isMouseDown=false;_this.zoomX=(touch[0].clientX+touch[1].clientX)/2;_this.zoomY=(touch[0].clientY+touch[1].clientY)/2;var currentDiff=Math.sqrt(Math.pow(touch[0].clientX-touch[1].clientX,2)+Math.pow(touch[0].clientY-touch[1].clientY,2));if(_this.preDifference>-1){if(currentDiff>_this.preDifference){_this.onPinchOutInternal(event);}else if(currentDiff<_this.preDifference){_this.onPinchInInternal(event);}}else if(_this.zoomFactor<2){if(_this.preDifference!==-1){if(currentDiff>_this.preDifference){_this.onPinchInInternal(event);}}}else if(_this.preDifference===-1){if(_this.zoomFactor>2){if(currentDiff>_this.preDifference){_this.onPinchInInternal(event);}}}_this.preDifference=currentDiff;}if(_this.longTouchTimer){clearTimeout(_this.longTouchTimer);_this.longTouchTimer=undefined;}};/**
         * Fired on touch up.
         *
         * @private
         * @param {TouchEvent} event - Specifies touch event.
         * @returns {void}
         */this.onTouchUpInternal=function(event){if(!sf.base.isNullOrUndefined(_this.selection)){var point=_this.getTouchOffsetValue(event);var touchPoint=_this.owner.viewer.findFocusedPage(point,true);if(event.changedTouches.length===1){if(!_this.isTouchMoved||_this.owner.enableImageResizerMode&&_this.owner.imageResizerModule.isImageResizing){_this.updateSelectionOnTouch(point,touchPoint);if(!sf.base.isNullOrUndefined(_this.currentPage)&&!sf.base.isNullOrUndefined(_this.selection.start)&&!_this.isSelectionChangedOnMouseMoved&&(_this.selection.isEmpty||_this.selection.isImageField()&&(!_this.owner.enableImageResizerMode||_this.owner.enableImageResizerMode&&!_this.owner.imageResizerModule.isImageResizing))){_this.selection.navigateHyperLinkOnEvent(touchPoint,true);}}_this.isMouseDown=false;_this.touchDownOnSelectionMark=0;_this.useTouchSelectionMark=true;_this.isSelectionChangedOnMouseMoved=false;}if(_this.owner.enableImageResizerMode&&_this.owner.imageResizerModule.isImageResizing){_this.owner.imageResizerModule.mouseUpInternal();_this.owner.imageResizerModule.isImageResizing=false;_this.owner.imageResizerModule.isImageMoveToNextPage=false;_this.scrollToPosition(_this.owner.selection.start,_this.owner.selection.end);}if(_this.owner.enableImageResizerMode&&_this.owner.imageResizerModule.isImageResizerVisible&&_this.isTouchInput){_this.touchStart.style.display='none';_this.touchEnd.style.display='none';}// if (!this.owner.isReadOnlyMode && this.isSelectionInListText(touchPoint)) {
//     this.selection.selectListText();
// }
event.preventDefault();}_this.preDifference=-1;_this.isTouchInput=false;if(_this.longTouchTimer){clearTimeout(_this.longTouchTimer);_this.longTouchTimer=undefined;}if(!_this.isTimerStarted){_this.tapCount=1;}if(_this.isListTextSelected){_this.selection.hideCaret();}};/**
         * Fired on keyup event.
         *
         * @private
         * @param {KeyboardEvent} event - Specifies keyboard event.
         * @returns {void}
         */this.onKeyUpInternal=function(event){if(sf.base.Browser.isDevice&&event.target===_this.editableDiv){if(window.getSelection().anchorOffset!==_this.prefix.length){_this.selection.setEditableDivCaretPosition(_this.editableDiv.innerText.length);}}if(event.ctrlKey||event.keyCode===17||event.which===17){_this.isControlPressed=false;}};/**
         * Fired on keydown.
         *
         * @private
         * @param {KeyboardEvent} event - Specifies keyboard event.
         * @returns {void}
         */this.onKeyDownInternal=function(event){if(!sf.base.isNullOrUndefined(event.target)&&event.target!==_this.editableDiv){return;}var isHandled=false;var keyEventArgs={'event':event,'isHandled':false};_this.owner.dotNetRef.invokeMethodAsync('KeyDown',keyEventArgs);if(keyEventArgs.isHandled){return;}var key=event.which||event.keyCode;var ctrl=event.ctrlKey||event.metaKey?true:key===17?true:false;// ctrl detection       
var shift=event.shiftKey?event.shiftKey:key===16?true:false;// Shift Key detection        
var alt=event.altKey?event.altKey:key===18?true:false;// alt key detection
if(ctrl&&!shift&&!alt){switch(key){case 80:event.preventDefault();_this.owner.print();isHandled=true;break;case 83:event.preventDefault();_this.owner.save(_this.owner.documentName===''?'sample':_this.owner.documentName,'Sfdt');isHandled=true;break;}}if(!isHandled&&!sf.base.isNullOrUndefined(_this.selection)){_this.selection.onKeyDownInternal(event,ctrl,shift,alt);}if(isHandled){event.preventDefault();}};this.owner=owner;this.pages=[];this.lists=[];this.abstractLists=[];this.render=new Renderer(this);this.characterFormat=new WCharacterFormat(this);this.paragraphFormat=new WParagraphFormat(this);this.renderedLists=new Dictionary();this.renderedLevelOverrides=[];this.headersFooters=[];this.styles=new WStyles();this.preDefinedStyles=new Dictionary();this.initalizeStyles();this.bookmarks=new Dictionary();this.editRanges=new Dictionary();this.isIosDevice=/Mac|iPad|iPod/i.test(navigator.userAgent);this.isMobileDevice=/Android|Windows Phone|webOS/i.test(navigator.userAgent);// this.formFillPopup = new FormFieldPopUp(this.owner);
this.customXmlData=new Dictionary();this.contentControlCollection=[];this.footnoteCollection=[];this.endnoteCollection=[];}Object.defineProperty(DocumentHelper.prototype,"visibleBounds",{/**
         * Gets visible bounds.
         *
         * @private
         * @returns {Rect} - Returns visible bounds.
         */get:function get(){return this.visibleBoundsIn;},enumerable:true,configurable:true});Object.defineProperty(DocumentHelper.prototype,"viewer",{/**
         * @private
         */get:function get(){return this.owner.viewer;},enumerable:true,configurable:true});Object.defineProperty(DocumentHelper.prototype,"containerCanvas",{//Document Protection Properties Ends
//#region Properties
/**
         * Gets container canvas.
         *
         * @private
         * @returns {HTMLCanvasElement} - Returns page canvas.
         */get:function get(){if(sf.base.isNullOrUndefined(this.containerCanvasIn)){this.containerCanvasIn=document.createElement('canvas');this.containerCanvasIn.getContext('2d').save();}if(!sf.base.isNullOrUndefined(this.pageContainer)&&this.containerCanvasIn.parentElement!==this.pageContainer){this.pageContainer.appendChild(this.containerCanvasIn);}return this.containerCanvasIn;},enumerable:true,configurable:true});Object.defineProperty(DocumentHelper.prototype,"selectionCanvas",{/**
         * Gets selection canvas.
         *
         * @private
         * @returns {HTMLCanvasElement} - Returns selection canvas.
         */get:function get(){if(sf.base.isNullOrUndefined(this.selectionCanvasIn)){this.selectionCanvasIn=document.createElement('canvas');this.selectionCanvas.getContext('2d').save();}if(!sf.base.isNullOrUndefined(this.pageContainer)&&this.selectionCanvasIn.parentElement!==this.pageContainer){this.pageContainer.appendChild(this.selectionCanvasIn);}return this.selectionCanvasIn;},enumerable:true,configurable:true});Object.defineProperty(DocumentHelper.prototype,"containerContext",{/**
         * Gets container context.
         *
         * @private
         * @returns {CanvasRenderingContext2D} - Returns page canvas context.
         */get:function get(){return this.containerCanvas.getContext('2d');},enumerable:true,configurable:true});Object.defineProperty(DocumentHelper.prototype,"selectionContext",{/**
         * Gets selection context.
         *
         * @private
         * @returns {CanvasRenderingContext2D} - Returns selection canvas context.
         */get:function get(){return this.selectionCanvas.getContext('2d');},enumerable:true,configurable:true});Object.defineProperty(DocumentHelper.prototype,"currentRenderingPage",{/**
         * Gets the current rendering page.
         *
         * @returns {Page} - Returns current rendering page.
         */get:function get(){if(this.pages.length===0){return undefined;}return this.pages[this.pages.length-1];},enumerable:true,configurable:true});Object.defineProperty(DocumentHelper.prototype,"zoomFactor",{/**
         * Gets or sets zoom factor.
         *
         * @private
         * @returns {number} - Returns zoom factor value.
         */get:function get(){return this.zoomFactorInternal;},set:function set(value){if(this.zoomFactorInternal!==value){this.preZoomFactor=this.zoomFactor;this.zoomFactorInternal=value;this.zoomModule.setZoomFactor();this.owner.zoomFactor=value;}},enumerable:true,configurable:true});Object.defineProperty(DocumentHelper.prototype,"selection",{/**
         * Gets the selection.
         *
         * @private
         * @returns {Selection} - Returns selection module.
         */get:function get(){return this.owner.selection;},enumerable:true,configurable:true});Object.defineProperty(DocumentHelper.prototype,"selectionStartPage",{/**
         * Gets or sets selection start page.
         *
         * @private
         * @returns {Page} - Return selection start page.
         */get:function get(){return this.selectionStartPageIn;},set:function set(value){this.selectionStartPageIn=value;},enumerable:true,configurable:true});Object.defineProperty(DocumentHelper.prototype,"selectionEndPage",{/**
         * Gets or sets selection end page.
         *
         * @private
         * @returns {Page} - Return selection end page.
         */get:function get(){return this.selectionEndPageIn;},set:function set(value){this.selectionEndPageIn=value;},enumerable:true,configurable:true});Object.defineProperty(DocumentHelper.prototype,"currentSelectedComment",{// /**
//  * Gets the initialized default dialog.
//  *
//  * @private
//  * @returns {Dialog} - Returns dialog instance.
//  */
// public get dialog(): Dialog {
//     if (!this.dialogInternal) {
//         this.initDialog(this.owner.enableRtl);
//     }
//     return this.dialogInternal;
// }
// /**
//  * Gets the initialized default dialog.
//  *
//  * @private
//  * @returns {Dialog} - Returns dialog instance.
//  */
// public get dialog2(): Dialog {
//     if (!this.dialogInternal2) {
//         this.initDialog2(this.owner.enableRtl);
//     }
//     return this.dialogInternal2;
// }
// /**
//  * Gets the initialized default dialog.
//  *
//  * @private
//  * @returns {Dialog} - Returns dialog instance.
//  */
// public get dialog3(): Dialog {
//     if (!this.dialogInternal3) {
//         this.initDialog3(this.owner.enableRtl);
//     }
//     return this.dialogInternal3;
// }
/**
         * @private
         * @returns {void}
         */get:function get(){return this.currentSelectedCommentInternal;},set:function set(value){// if (this.owner && this.owner.commentReviewPane) {
//     this.owner.commentReviewPane.previousSelectedComment = this.currentSelectedCommentInternal;
// }
if(this.selection){this.selection.updatePreviousCommentMark(value);this.selection.hightlightCommentSelectionMark();}this.currentSelectedCommentInternal=value;},enumerable:true,configurable:true});Object.defineProperty(DocumentHelper.prototype,"currentSelectedRevision",{/**
         * @private
         * @returns {void}
         */get:function get(){return this.currentSelectedRevisionInternal;},set:function set(value){// if (this.owner && this.owner.commentReviewPane) {
//     this.owner.commentReviewPane.previousSelectedComment = this.currentSelectedCommentInternal;
// }
this.currentSelectedRevisionInternal=value;},enumerable:true,configurable:true});Object.defineProperty(DocumentHelper.prototype,"isInlineFormFillProtectedMode",{/**
         * @private
         * @returns {void}
         */get:function get(){return this.isFormFillProtectedMode&&this.owner.documentEditorSettings.formFieldSettings.formFillingMode==='Inline';},enumerable:true,configurable:true});Object.defineProperty(DocumentHelper.prototype,"isFormFillProtectedMode",{/**
         * @private
         * @returns {void}
         */get:function get(){return this.isDocumentProtected&&this.protectionType==='FormFieldsOnly';},enumerable:true,configurable:true});DocumentHelper.prototype.initalizeStyles=function(){this.preDefinedStyles.add('Normal','{"type":"Paragraph","name":"Normal","next":"Normal"}');this.preDefinedStyles.add('Heading 1','{"type":"Paragraph","name":"Heading 1","basedOn":"Normal","next":"Normal","link":"Heading 1 Char","characterFormat":{"fontSize":16.0,"fontFamily":"Calibri Light","fontColor":"#2F5496"},"paragraphFormat":{"leftIndent":0.0,"rightIndent":0.0,"firstLineIndent":0.0,"beforeSpacing":12.0,"afterSpacing":0.0,"lineSpacing":1.0791666507720947,"lineSpacingType":"Multiple","textAlignment":"Left","outlineLevel":"Level1"}}');this.preDefinedStyles.add('Heading 2','{"type":"Paragraph","name":"Heading 2","basedOn":"Normal","next":"Normal","link":"Heading 2 Char","characterFormat":{"fontSize":13.0,"fontFamily":"Calibri Light","fontColor":"#2F5496"},"paragraphFormat":{"leftIndent":0.0,"rightIndent":0.0,"firstLineIndent":0.0,"beforeSpacing":2.0,"afterSpacing":0.0,"lineSpacing":1.0791666507720947,"lineSpacingType":"Multiple","textAlignment":"Left","outlineLevel":"Level2"}}');this.preDefinedStyles.add('Heading 3','{"type":"Paragraph","name":"Heading 3","basedOn":"Normal","next":"Normal","link":"Heading 3 Char","characterFormat":{"fontSize":12.0,"fontFamily":"Calibri Light","fontColor":"#1F3763"},"paragraphFormat":{"leftIndent":0.0,"rightIndent":0.0,"firstLineIndent":0.0,"beforeSpacing":2.0,"afterSpacing":0.0,"lineSpacing":1.0791666507720947,"lineSpacingType":"Multiple","textAlignment":"Left","outlineLevel":"Level3"}}');this.preDefinedStyles.add('Heading 4','{"type":"Paragraph","name":"Heading 4","basedOn":"Normal","next":"Normal","link":"Heading 4 Char","characterFormat":{"italic":true,"fontFamily":"Calibri Light","fontColor":"#2F5496"},"paragraphFormat":{"leftIndent":0.0,"rightIndent":0.0,"firstLineIndent":0.0,"beforeSpacing":2.0,"afterSpacing":0.0,"lineSpacing":1.0791666507720947,"lineSpacingType":"Multiple","textAlignment":"Left","outlineLevel":"Level4"}}');this.preDefinedStyles.add('Heading 5','{"type":"Paragraph","name":"Heading 5","basedOn":"Normal","next":"Normal","link":"Heading 5 Char","characterFormat":{"fontFamily":"Calibri Light","fontColor":"#2F5496"},"paragraphFormat":{"leftIndent":0.0,"rightIndent":0.0,"firstLineIndent":0.0,"beforeSpacing":2.0,"afterSpacing":0.0,"lineSpacing":1.0791666507720947,"lineSpacingType":"Multiple","textAlignment":"Left","outlineLevel":"Level5"}}');this.preDefinedStyles.add('Heading 6','{"type":"Paragraph","name":"Heading 6","basedOn":"Normal","next":"Normal","link":"Heading 6 Char","characterFormat":{"fontFamily":"Calibri Light","fontColor":"#1F3763"},"paragraphFormat":{"leftIndent":0.0,"rightIndent":0.0,"firstLineIndent":0.0,"beforeSpacing":2.0,"afterSpacing":0.0,"lineSpacing":1.0791666507720947,"lineSpacingType":"Multiple","textAlignment":"Left","outlineLevel":"Level6"}}');this.preDefinedStyles.add('Default Paragraph Font','{"type":"Character","name":"Default Paragraph Font"}');this.preDefinedStyles.add('Heading 1 Char','{"type":"Character","name":"Heading 1 Char","basedOn":"Default Paragraph Font","characterFormat":{"fontSize":16.0,"fontFamily":"Calibri Light","fontColor":"#2F5496"}}');this.preDefinedStyles.add('Heading 2 Char','{"type":"Character","name":"Heading 2 Char","basedOn":"Default Paragraph Font","characterFormat":{"fontSize":13.0,"fontFamily":"Calibri Light","fontColor":"#2F5496"}}');this.preDefinedStyles.add('Heading 3 Char','{"type":"Character","name":"Heading 3 Char","basedOn":"Default Paragraph Font","characterFormat":{"fontSize":12.0,"fontFamily":"Calibri Light","fontColor": "#1F3763"}}');this.preDefinedStyles.add('Heading 4 Char','{"type":"Character","name":"Heading 4 Char","basedOn":"Default Paragraph Font","characterFormat":{"italic":true,"fontFamily":"Calibri Light","fontColor":"#2F5496"}}');this.preDefinedStyles.add('Heading 5 Char','{"type":"Character","name":"Heading 5 Char","basedOn":"Default Paragraph Font","characterFormat":{"fontFamily":"Calibri Light","fontColor":"#2F5496"}}');this.preDefinedStyles.add('Heading 6 Char','{"type":"Character","name":"Heading 6 Char","basedOn":"Default Paragraph Font","characterFormat":{"fontFamily":"Calibri Light","fontColor":"#1F3763"}}');this.preDefinedStyles.add('Hyperlink','{"type":"Character","name":"Hyperlink","basedOn":"Default Paragraph Font","next":"Normal","characterFormat":{"fontColor":"#0563C1","underline": "Single"}}');this.preDefinedStyles.add('Toc1','{"type":"Paragraph","name":"Toc1","basedOn":"Normal","next":"Normal","paragraphFormat":{"afterSpacing":5.0}}');this.preDefinedStyles.add('Toc2','{"type":"Paragraph","name":"Toc2","basedOn":"Normal","next":"Normal","paragraphFormat":{"leftIndent" :11.0,"afterSpacing":5.0}}');this.preDefinedStyles.add('Toc3','{"type":"Paragraph","name":"Toc3","basedOn":"Normal","next":"Normal","paragraphFormat":{"leftIndent" :22.0,"afterSpacing":5.0}}');this.preDefinedStyles.add('Toc4','{"type":"Paragraph","name":"Toc4","basedOn":"Normal","next":"Normal","paragraphFormat":{"leftIndent" :33.0,"afterSpacing":5.0}}');this.preDefinedStyles.add('Toc5','{"type":"Paragraph","name":"Toc5","basedOn":"Normal","next":"Normal","paragraphFormat":{"leftIndent" :44.0,"afterSpacing":5.0}}');this.preDefinedStyles.add('Toc6','{"type":"Paragraph","name":"Toc6","basedOn":"Normal","next":"Normal","paragraphFormat":{"leftIndent" :55.0,"afterSpacing":5.0}}');this.preDefinedStyles.add('Toc7','{"type":"Paragraph","name":"Toc7","basedOn":"Normal","next":"Normal","paragraphFormat":{"leftIndent" :66.0,"afterSpacing":5.0}}');this.preDefinedStyles.add('Toc8','{"type":"Paragraph","name":"Toc8","basedOn":"Normal","next":"Normal","paragraphFormat":{"leftIndent" :77.0,"afterSpacing":5.0}}');this.preDefinedStyles.add('Toc9','{"type":"Paragraph","name":"Toc9","basedOn":"Normal","next":"Normal","paragraphFormat":{"leftIndent" :88.0,"afterSpacing":5.0}}');};/**
     * @private
     * @returns {void}
     */DocumentHelper.prototype.clearDocumentItems=function(){this.editRanges.clear();this.headersFooters=[];this.fields=[];this.formFields=[];this.currentSelectedComment=undefined;this.currentSelectedRevision=undefined;for(var i=0;i<this.comments.length;i++){var commentStart=this.comments[i].commentStart;if(commentStart){commentStart.destroy();}}this.comments=[];this.bookmarks.clear();this.styles.clear();this.authors.clear();this.revisionsInternal.clear();this.owner.revisions.destroy();this.characterFormat.clearFormat();this.paragraphFormat.clearFormat();if(this.owner.trackChangesPane){this.owner.trackChangesPane.clear();}this.setDefaultCharacterValue(this.characterFormat);this.setDefaultParagraphValue(this.paragraphFormat);// if (this.owner.commentReviewPane) {
//     this.owner.commentReviewPane.clear();
// }
this.isHeaderFooter=false;this.defaultTabWidth=36;this.isDocumentProtected=false;this.protectionType='NoProtection';this.restrictFormatting=false;this.hashValue='';this.saltValue='';this.userCollection=[];// if (this.formFillPopup) {
//     this.formFillPopup.hidePopup();
// }
this.customXmlData.clear();this.contentControlCollection=[];this.endnotes.clear();this.footnotes.clear();this.footnoteCollection=[];this.endnoteCollection=[];};/**
     * @private
     * @returns {void}
     */DocumentHelper.prototype.setDefaultDocumentFormat=function(){this.owner.parser.parseCharacterFormat(this.owner.characterFormat,this.characterFormat);this.owner.parser.parseParagraphFormat(this.owner.paragraphFormat,this.paragraphFormat);};DocumentHelper.prototype.setDefaultCharacterValue=function(characterFormat){characterFormat.bold=false;characterFormat.italic=false;characterFormat.fontFamily='Calibri';characterFormat.fontSize=11;characterFormat.underline='None';characterFormat.strikethrough='None';characterFormat.fontSizeBidi=11;characterFormat.fontFamilyBidi='Calibri';characterFormat.baselineAlignment='Normal';characterFormat.highlightColor='NoColor';characterFormat.fontColor='#00000000';characterFormat.allCaps=false;};DocumentHelper.prototype.setDefaultParagraphValue=function(paragraphFormat){paragraphFormat.leftIndent=0;paragraphFormat.rightIndent=0;paragraphFormat.firstLineIndent=0;paragraphFormat.textAlignment='Left';paragraphFormat.beforeSpacing=0;paragraphFormat.afterSpacing=0;paragraphFormat.lineSpacing=1;paragraphFormat.lineSpacingType='Multiple';paragraphFormat.bidi=false;paragraphFormat.keepWithNext=false;paragraphFormat.keepLinesTogether=false;paragraphFormat.widowControl=true;};/**
     * @private
     * @param {number} id - Specfies abstract list id.
     * @returns {WAbstractList} - Returns abstract list.
     */DocumentHelper.prototype.getAbstractListById=function(id){if(sf.base.isNullOrUndefined(this.abstractLists)){return undefined;}for(var i=0;i<this.abstractLists.length;i++){var abstractList=this.abstractLists[i];if(abstractList instanceof WAbstractList&&abstractList.abstractListId===id){return abstractList;}}return undefined;};/**
     * @private
     * @param {number} id - Specfies list id.
     * @returns {WAbstractList} - Returns list.
     */DocumentHelper.prototype.getListById=function(id){if(sf.base.isNullOrUndefined(this.lists)){return undefined;}for(var i=0;i<this.lists.length;i++){if(!sf.base.isNullOrUndefined(this.lists[i])&&this.lists[i].listId===id){return this.lists[i];}}return undefined;};/**
     * @private
     * @param {WListLevel} listLevel - Specfies list level.
     * @returns {number} - Returns list level number.
     */DocumentHelper.getListLevelNumber=function(listLevel){if(listLevel.ownerBase instanceof WLevelOverride){return listLevel.ownerBase.levelNumber;}else if(listLevel.ownerBase instanceof WAbstractList&&!sf.base.isNullOrUndefined(listLevel.ownerBase.levels)){return listLevel.ownerBase.levels.indexOf(listLevel);}else{return-1;}};/**
     * Gets the bookmarks.
     *
     * @private
     * @param {boolean} includeHidden - Include hidden bookmark.
     * @returns {string[]} - Returns bookmars present in current document.
     */DocumentHelper.prototype.getBookmarks=function(includeHidden){var bookmarks=[];for(var i=0;i<this.bookmarks.keys.length;i++){var bookmark=this.bookmarks.keys[i];if(includeHidden||bookmark.indexOf('_')!==0){bookmarks.push(bookmark);}}return bookmarks;};DocumentHelper.prototype.selectComment=function(comment){// if (this.owner.selection && this.owner.commentReviewPane) {
//     this.owner.showComments = true;
//     setTimeout(() => {
//         if (this.owner && this.owner.selection) {
//             this.owner.selection.selectComment(comment);
//         }
//     });
// }
var _this=this;if(this.owner.selection){setTimeout(function(){if(_this.owner&&_this.owner.selection){_this.owner.selection.selectComment(comment);}});}};DocumentHelper.prototype.showComments=function(show){if(this.owner&&show&&this.owner.enableComment){// this.owner.trigger('beforePaneSwitch', eventArgs);
}// this.owner.commentReviewPane.reviewTab.hideTab(0, false);
// this.owner.commentReviewPane.reviewTab.hideTab(1, false);
// this.owner.commentReviewPane.showHidePane(show && this.owner.enableComment, 'Comments');
};DocumentHelper.prototype.showRevisions=function(show){if(this.owner&&show){// this.owner.trigger('beforePaneSwitch', eventArgs);
}if(!show&&this.owner.showComments){// this.owner.commentReviewPane.reviewTab.hideTab(0, false);
// this.owner.commentReviewPane.showHidePane(true, 'Comments');
}else if(!this.showRevision&&!this.owner.enableTrackChanges&&this.owner.showRevisions){this.owner.dotNetRef.invokeMethodAsync('ShowRevisions',!show);// this.owner.commentReviewPane.showHidePane(!show, 'Changes');
this.owner.showRevisions=false;}else{this.owner.dotNetRef.invokeMethodAsync('ShowRevisions',show);// this.owner.commentReviewPane.showHidePane(show, 'Changes');
if(!this.owner.enableComment){// isCommentTabVisible = true;
}// this.owner.commentReviewPane.reviewTab.hideTab(0, isCommentTabVisible);
this.showRevision=false;}if(show){this.owner.trackChangesPane.enableDisableButton(!this.owner.isReadOnly);}};/**
     * Initializes components.
     *
     * @private
     * @returns {void}
     */DocumentHelper.prototype.initializeComponents=function(){var element=this.owner.element;if(sf.base.isNullOrUndefined(element)){return;}this.optionsPaneContainer=this.owner.element.getElementsByClassName('e-documenteditor-optionspane')[0];if(sf.base.isNullOrUndefined(this.optionsPaneContainer)){this.optionsPaneContainer=sf.base.createElement('div',{className:'e-documenteditor-optionspane'});element.appendChild(this.optionsPaneContainer);}this.restrictEditingElement=this.owner.element.getElementsByClassName('e-de-restrict-pane')[0];this.optionsPaneElement=this.owner.element.getElementsByClassName('e-de-op')[0];this.commentPaneElement=this.owner.element.getElementsByClassName('e-de-review-pane')[0];this.viewerContainer=this.owner.element.getElementsByClassName('e-de-viewercontainer')[0];if(sf.base.isNullOrUndefined(this.viewerContainer)){this.viewerContainer=sf.base.createElement('div',{id:this.owner.containerId+'_viewerContainer'});this.optionsPaneContainer.appendChild(this.viewerContainer);}this.viewerContainer.style.cssText='position:relative;backgroundColor:#FBFBFB;overflow:auto;direction:ltr;';this.viewerContainer.tabIndex=0;this.viewerContainer.style.outline='none';this.pageContainer=sf.base.createElement('div',{id:this.owner.containerId+'_pageContainer',className:'e-de-background'});this.viewerContainer.appendChild(this.pageContainer);this.pageContainer.style.top='0px';this.pageContainer.style.left='0px';this.pageContainer.style.position='relative';this.pageContainer.style.pointerEvents='none';if(sf.base.Browser.isDevice){this.createEditableDiv(element);}else{this.createEditableIFrame();}if(this.owner.enableImageResizerMode){this.owner.imageResizerModule.initializeImageResizer();}this.updateViewerSizeInternal(element);this.layout=new Layout(this);this.textHelper=new TextHelper(this);this.zoomModule=new Zoom(this);this.initTouchEllipse();this.wireEvent();// this.restrictEditingPane = new RestrictEditing(this);
// this.owner.commentReviewPane = new CommentReviewPane(this.owner);
this.owner.trackChangesPane=new TrackChangesPane(this.owner);this.owner.spellCheckerModule=new SpellChecker(this.owner.documentHelper);// createSpinner({ target: this.owner.element, cssClass: 'e-spin-overlay' });
};DocumentHelper.prototype.measureScrollbarWidth=function(element){var parentDiv=document.createElement('div');parentDiv.setAttribute('style','visibility:hidden;overflow:scroll');element.appendChild(parentDiv);var childDiv=document.createElement('div');parentDiv.appendChild(childDiv);this.scrollbarWidth=parentDiv.getBoundingClientRect().width-childDiv.getBoundingClientRect().width;parentDiv.parentNode.removeChild(parentDiv);};DocumentHelper.prototype.createEditableDiv=function(element){this.editableDiv=document.createElement('div');this.editableDiv.contentEditable='true';this.editableDiv.style.position='fixed';this.editableDiv.style.left='-150em';this.editableDiv.style.width='100%';this.editableDiv.style.height='100%';this.editableDiv.id=element.id+'_editableDiv';document.body.appendChild(this.editableDiv);};DocumentHelper.prototype.createEditableIFrame=function(){this.iframe=sf.base.createElement('iframe',{attrs:{'scrolling':'no','style':'pointer-events:none;position:absolute;left:0px;top:0px;outline:none;background-color:transparent;width:0px;height:0px;overflow:hidden'},className:'e-de-text-target'});this.viewerContainer.appendChild(this.iframe);this.initIframeContent();};DocumentHelper.prototype.initIframeContent=function(){var style='background-color:transparent;width:100%;height:100%;padding: 0px; margin: 0px;';var innerHtml='<!DOCTYPE html>'+'<html><head></head>'+'<body spellcheck="false" style='+style+' >'+'<div contenteditable="true" style='+style+'></div>'+'</body>'+'</html>';this.iframe.contentDocument.open();this.iframe.contentDocument.write(innerHtml);this.iframe.contentDocument.close();this.editableDiv=this.iframe.contentDocument.body.children[0];};/**
     * Wires events and methods.
     *
     * @returns {void}
     */DocumentHelper.prototype.wireEvent=function(){if(!sf.base.isNullOrUndefined(this.selection)){this.selection.initCaret();}this.wireInputEvents();if(!sf.base.isNullOrUndefined(this.iframe)){this.iframe.addEventListener('load',this.onIframeLoad.bind(this));}this.viewerContainer.addEventListener('scroll',this.scrollHandler);this.viewerContainer.addEventListener('mousedown',this.onMouseDownInternal);this.viewerContainer.addEventListener('keydown',this.onKeyDownInternal);this.viewerContainer.addEventListener('mousemove',this.onMouseMoveInternal);this.viewerContainer.addEventListener('mouseleave',this.onMouseLeaveInternal);this.viewerContainer.addEventListener('mouseenter',this.onMouseEnterInternal);this.viewerContainer.addEventListener('contextmenu',this.onContextMenu);this.viewerContainer.addEventListener('dblclick',this.onDoubleTap);this.viewerContainer.addEventListener('mouseup',this.onMouseUpInternal);window.addEventListener('resize',this.onWindowResize);window.addEventListener('keyup',this.onKeyUpInternal);window.addEventListener('mouseup',this.onImageResizer.bind(this));window.addEventListener('touchend',this.onImageResizer.bind(this));this.viewerContainer.addEventListener('touchstart',this.onTouchStartInternal);this.viewerContainer.addEventListener('touchmove',this.onTouchMoveInternal);this.viewerContainer.addEventListener('touchend',this.onTouchUpInternal);if(navigator.userAgent.match('Firefox')){this.viewerContainer.addEventListener('DOMMouseScroll',this.zoomModule.onMouseWheelInternal.bind(this));}this.viewerContainer.addEventListener('mousewheel',this.zoomModule.onMouseWheelInternal.bind(this));};DocumentHelper.prototype.wireInputEvents=function(){if(sf.base.isNullOrUndefined(this.editableDiv)){return;}this.editableDiv.addEventListener('paste',this.onPaste);if(!sf.base.Browser.isDevice){this.editableDiv.addEventListener('keypress',this.onKeyPressInternal);if(sf.base.Browser.info.name==='chrome'){this.editableDiv.addEventListener('textInput',this.onTextInput);}}else{this.editableDiv.addEventListener('input',this.onTextInputInternal);}this.editableDiv.addEventListener('blur',this.onFocusOut);this.editableDiv.addEventListener('keydown',this.onKeyDownInternal);this.editableDiv.addEventListener('compositionstart',this.compositionStart);this.editableDiv.addEventListener('compositionupdate',this.compositionUpdated);this.editableDiv.addEventListener('compositionend',this.compositionEnd);};DocumentHelper.prototype.onIframeLoad=function(){if(!sf.base.isNullOrUndefined(this.iframe)&&this.iframe.contentDocument.body.children.length===0){this.initIframeContent();this.wireInputEvents();}};DocumentHelper.prototype.getEditableDivTextContent=function(){return this.editableDiv.textContent;};DocumentHelper.prototype.updateAuthorIdentity=function(){var revisions=this.owner.revisions.changes;for(var i=0;i<revisions.length;i++){this.getAuthorColor(revisions[i].author);}};DocumentHelper.prototype.getAvatar=function(userInfo,userName,comment,revision){var author;var userinitial;if(!sf.base.isNullOrUndefined(comment)){author=comment.author;userinitial=comment.initial;}else{author=revision.author;}if(!sf.base.isNullOrUndefined(author)){var avatarDiv=sf.base.createElement('div',{className:'e-de-cmt-avatar'});var avatar=sf.base.createElement('div',{className:'e-de-ff-cmt-avatar'});avatar.style.backgroundColor=this.owner.documentHelper.getAuthorColor(author);if(userinitial===''||sf.base.isNullOrUndefined(userinitial)){var authorName=author.split(' ');var initial=authorName[0].charAt(0);if(authorName.length>1){initial+=authorName[authorName.length-1][0];}avatar.innerText=initial.toUpperCase();}else{if(userinitial.length>2){avatar.innerText=userinitial.substring(0,2);}else{avatar.innerText=userinitial;}}avatarDiv.appendChild(avatar);avatarDiv.appendChild(userName);userInfo.appendChild(avatarDiv);}};/**
     * @private
     * @param {string} author - Specifies author name.
     * @returns {string} - Return autor color.
     */DocumentHelper.prototype.getAuthorColor=function(author){if(this.authors.containsKey(author)){return this.authors.get(author);}var color=this.owner.userColor;if(author!==this.owner.currentUser){if(this.authors.length===0&&color!=='#b5082e'){color='#b5082e';//dark red
}else{color=this.generateRandomColor();}}this.authors.add(author,color);return color;};DocumentHelper.prototype.generateRandomColor=function(){var userColors=['#b5082e','#2e97d3','#bb00ff','#f37e43','#03a60b','#881824','#e09a2b','#50565e'];//dark grey
return userColors[this.authors.length%8];};/**
     * @private
     * @returns {void}
     */DocumentHelper.prototype.positionEditableTarget=function(){var point=this.selection.getRect(this.selection.start);var page=this.selection.getSelectionPage(this.selection.start);// const caretInfo: CaretHeightInfo = this.selection.updateCaretSize(this.owner.selection.start);
var sectionFormat=page.bodyWidgets[0].sectionFormat;var left=page.boundingRectangle.x+HelperMethods.convertPointToPixel(sectionFormat.leftMargin)*this.zoomFactor;var top=point.y;var pageWidth=sectionFormat.pageWidth-sectionFormat.leftMargin-sectionFormat.rightMargin;var iframeStyle='left:'+left+'px;';iframeStyle+='top:'+top+'px;';iframeStyle+='width:'+HelperMethods.convertPointToPixel(pageWidth)*this.zoomFactor+'px;';iframeStyle+='height:250px;outline-style:none;position:absolute';this.iframe.setAttribute('style',iframeStyle);var style='background-color:transparent;width:100%;height:250px;padding: 0px; margin: 0px;';style+='text-indent:'+(point.x-left)+'px;';style+='color:transparent;pointer-events:none;outline-style:none;';style+='font-size:'+HelperMethods.convertPointToPixel(this.selection.characterFormat.fontSize)*this.zoomFactor+'px;';style+='font-family'+this.selection.characterFormat.fontFamily+';';style+='overflow:hidden;text-decoration:none;white-space:normal;';this.editableDiv.setAttribute('style',style);};/* eslint-disable @typescript-eslint/no-explicit-any */DocumentHelper.prototype.onImageResizer=function(args){if(!sf.base.isNullOrUndefined(this.owner)&&!sf.base.isNullOrUndefined(this.owner.imageResizerModule)&&this.owner.imageResizerModule.isImageResizerVisible&&this.owner.imageResizerModule.isImageResizing){if(args instanceof MouseEvent){this.onMouseUpInternal(args);}else if(args instanceof TouchEvent){this.onTouchUpInternal(args);}}if(this.scrollMoveTimer){this.isMouseEntered=true;clearInterval(this.scrollMoveTimer);}};DocumentHelper.prototype.initDialog=function(isRtl){// if (!this.dialogInternal) {
//     this.dialogTarget1 = createElement('div', { className: 'e-de-dlg-target' });
//     document.body.appendChild(this.dialogTarget1);
//     if (isRtl) {
//         this.dialogTarget1.classList.add('e-de-rtl');
//     }
//     this.dialogInternal = new Dialog({
//         target: document.body, showCloseIcon: true,
//         allowDragging: true, enableRtl: isRtl, visible: false,
//         // eslint-disable-next-line @typescript-eslint/naming-convention
//         width: '1px', isModal: true, position: { X: 'center', Y: 'center' }, zIndex: this.owner.zIndex + 20,
//         animationSettings: { effect: 'None' }
//     });
//     this.dialogInternal.isStringTemplate = true;
//     this.dialogInternal.open = this.selection.hideCaret;
//     this.dialogInternal.beforeClose = this.updateFocus;
//     this.dialogInternal.appendTo(this.dialogTarget1);
// }
};DocumentHelper.prototype.initDialog3=function(isRtl){// if (!this.dialogInternal3) {
//     this.dialogTarget3 = createElement('div', { className: 'e-de-dlg-target' });
//     document.body.appendChild(this.dialogTarget3);
//     if (isRtl) {
//         this.dialogTarget3.classList.add('e-de-rtl');
//     }
//     this.dialogInternal3 = new Dialog({
//         target: document.body, showCloseIcon: true,
//         allowDragging: true, enableRtl: isRtl, visible: false,
//         // eslint-disable-next-line @typescript-eslint/naming-convention
//         width: '1px', isModal: true, position: { X: 'center', Y: 'center' }, zIndex: this.owner.zIndex,
//         animationSettings: { effect: 'None' }
//     });
//     this.dialogInternal3.isStringTemplate = true;
//     this.dialogInternal3.open = this.selection.hideCaret;
//     this.dialogInternal3.beforeClose = this.updateFocus;
//     this.dialogInternal3.appendTo(this.dialogTarget3);
// }
};DocumentHelper.prototype.hideDialog=function(){// this.dialog.hide();
this.updateFocus();};DocumentHelper.prototype.initDialog2=function(isRtl){// if (!this.dialogInternal2) {
//     this.dialogTarget2 = createElement('div', { className: 'e-de-dlg-target' });
//     document.body.appendChild(this.dialogTarget2);
//     if (isRtl) {
//         this.dialogTarget2.classList.add('e-de-rtl');
//     }
//     this.dialogInternal2 = new Dialog({
//         target: document.body, showCloseIcon: true,
//         allowDragging: true, enableRtl: isRtl, visible: false,
//         // eslint-disable-next-line @typescript-eslint/naming-convention
//         width: '1px', isModal: true, position: { X: 'center', Y: 'Top' }, zIndex: this.owner.zIndex + 10
//     });
//     this.dialogInternal2.isStringTemplate = true;
//     this.dialogInternal2.appendTo(this.dialogTarget2);
// }
};/**
     * Clears the context.
     *
     * @private
     * @returns {void}
     */DocumentHelper.prototype.clearContent=function(){this.containerContext.clearRect(0,0,this.containerCanvas.width,this.containerCanvas.height);this.selectionContext.clearRect(0,0,this.selectionCanvas.width,this.selectionCanvas.height);// Hide comment mark
if(this.pageContainer){var commentMarkElement=this.pageContainer.getElementsByClassName('e-de-cmt-mark');for(var i=0;i<commentMarkElement.length;i++){commentMarkElement[i].style.display='none';}}// if (this.pageContainer) {
//     const editRangeStart: HTMLCollectionOf<Element> = this.pageContainer.getElementsByClassName('e-de-lock-mark');
//     for (let i: number = 0; i < editRangeStart.length; i++) {
//         (editRangeStart[i] as HTMLElement).style.display = 'none';
//     }
// }
};/**
     * Fired when the document gets changed.
     *
     * @private
     * @param {BodyWidget[]} sections - Specified document content.
     * @returns {void}
     */DocumentHelper.prototype.onDocumentChanged=function(sections){this.clearContent();if(this.owner.editorModule){this.owner.editorModule.tocStyles={};this.owner.editorModule.tocBookmarkId=0;}this.heightInfoCollection={};this.owner.isDocumentLoaded=false;this.updateAuthorIdentity();for(var i=0;i<this.pages.length;i++){this.pages[i].bodyWidgets[0].destroy();}this.pages=[];if(!sf.base.isNullOrUndefined(this.renderedLists)){this.renderedLists.clear();}if(!sf.base.isNullOrUndefined(this.renderedLevelOverrides)){this.renderedLevelOverrides=[];}if(!sf.base.isNullOrUndefined(this.owner.editorHistory)){this.owner.editorHistory.destroy();}this.owner.isDocumentLoaded=true;this.layout.isInitialLoad=true;this.layout.footHeight=0;this.layout.footnoteHeight=0;this.layout.layoutItems(sections,false);if(this.owner.selection){this.selection.previousSelectedFormField=undefined;if(this.formFields.length>0){this.owner.selection.highlightFormFields();}this.owner.selection.editRangeCollection=[];this.owner.selection.selectRange(this.owner.documentStart,this.owner.documentStart);if(this.isDocumentProtected){this.owner.selection.isHighlightEditRegion=true;// this.restrictEditingPane.showHideRestrictPane(true);
}}if(this.owner.optionsPaneModule){// this.owner.optionsPaneModule.showHideOptionsPane(false);
}// if (this.restrictEditingPane.restrictPane && !this.isDocumentProtected) {
//     this.restrictEditingPane.showHideRestrictPane(false);
// }
if(this.owner.showRevisions){this.owner.trackChangesPane.updateTrackChanges(true);}if(!sf.base.isNullOrUndefined(this.owner.selection)&&this.owner.selection.isViewPasteOptions){this.owner.selection.isViewPasteOptions=false;this.owner.selection.showHidePasteOptions(undefined,undefined);}this.owner.fireDocumentChange();};/**
     * Initialize touch ellipse.
     *
     * @returns {void}
     */DocumentHelper.prototype.initTouchEllipse=function(){var style='height: 30px;width: 30px;position: absolute;background-color: transparent;margin: 0px;padding: 0px;z-index:5';var ellipse=' height: 12px;width: 12px;border-radius: 50%;background-color: white;position: absolute;margin: 0px 6px 0px 6px;border-width: 2px;border-style: solid;border-color: #000000;box-sizing: unset;';this.touchStart=sf.base.createElement('div',{className:'e-touch-ellipse',styles:style});var start=sf.base.createElement('div',{styles:ellipse});this.touchEnd=sf.base.createElement('div',{className:'e-touch-ellipse',styles:style});this.touchStart.style.display='none';var end=sf.base.createElement('div',{styles:ellipse});this.touchStart.appendChild(start);this.touchEnd.appendChild(end);this.touchEnd.style.display='none';this.viewerContainer.appendChild(this.touchStart);this.viewerContainer.appendChild(this.touchEnd);};/**
     * Updates touch mark position.
     *
     * @private
     * @returns {void}
     */DocumentHelper.prototype.updateTouchMarkPosition=function(){if(this.touchStart.style.display!=='none'&&!sf.base.isNullOrUndefined(this.selection)){if(!this.selection.isEmpty){var y=this.selection.getCaretBottom(this.selection.start,false);var page=this.selection.getPage(this.selection.start.paragraph);// eslint-disable-next-line max-len
var pageTop=page.boundingRectangle.y-this.owner.viewer.pageGap*(this.pages.indexOf(page)+1)*this.zoomFactor+this.owner.viewer.pageGap*(this.pages.indexOf(page)+1);this.touchStart.style.left=page.boundingRectangle.x+(Math.round(this.selection.start.location.x)*this.zoomFactor-14)+'px';this.touchStart.style.top=pageTop+y*this.zoomFactor+'px';if(!this.selection.isEmpty){y=this.selection.getCaretBottom(this.selection.end,false);page=this.selection.getPage(this.selection.end.paragraph);}this.touchEnd.style.left=page.boundingRectangle.x+(Math.round(this.selection.end.location.x)*this.zoomFactor-14)+'px';this.touchEnd.style.top=pageTop+y*this.zoomFactor+'px';}else{this.selection.updateCaretPosition();}}};DocumentHelper.prototype.scrollForwardOnSelection=function(cursorPoint){if(this.viewerContainer){this.viewerContainer.scrollTop=this.viewerContainer.scrollTop+200;var touchPoint=this.owner.viewer.findFocusedPage(cursorPoint,!this.owner.enableHeaderAndFooter);var textPosition=this.owner.selection.end;if(!this.owner.enableImageResizerMode||!this.owner.imageResizerModule.isImageResizerVisible||this.owner.imageResizerModule.isShapeResize){this.owner.selection.moveTextPosition(touchPoint,textPosition);}}};DocumentHelper.prototype.scrollBackwardOnSelection=function(cursorPoint){this.viewerContainer.scrollTop=this.viewerContainer.scrollTop-200;var touchPoint=this.owner.viewer.findFocusedPage(cursorPoint,!this.owner.enableHeaderAndFooter);var textPosition=this.owner.selection.end;if(!this.owner.enableImageResizerMode||!this.owner.imageResizerModule.isImageResizerVisible||this.owner.imageResizerModule.isShapeResize){this.owner.selection.moveTextPosition(touchPoint,textPosition);}};DocumentHelper.prototype.isSelectionInListText=function(cursorPoint){var widget=this.getLineWidget(cursorPoint);if(!sf.base.isNullOrUndefined(widget)&&widget.children[0]instanceof ListTextElementBox){var left=this.getLeftValue(widget);var width=widget.children[0].width;var height=widget.children[0].height;if(this.isInsideRect(left,widget.paragraph.y,width,height,cursorPoint)){this.selectionLineWidget=widget;return true;}}return false;};DocumentHelper.prototype.isInShapeBorder=function(floatElement,cursorPoint){if(!sf.base.isNullOrUndefined(floatElement)){var width=floatElement.width;var height=floatElement.height;if(this.isInsideRect(floatElement.x-floatElement.margin.left,floatElement.y-floatElement.margin.top,width,height,cursorPoint)){// this.selectionLineWidget = this.getLineWidget(cursorPoint);
if(floatElement instanceof ImageElementBox){return true;}else if(floatElement instanceof ShapeElementBox){var lineWidth=floatElement.lineFormat.weight;if(!this.isInsideRect(floatElement.x+lineWidth,floatElement.y+lineWidth+floatElement.textFrame.marginTop,width-lineWidth*2,height-(lineWidth*2+floatElement.textFrame.marginTop+floatElement.textFrame.marginBottom),cursorPoint)){return true;}}}}return false;};/**
     * Check whether touch point is inside the rectangle or not.
     *
     * @private
     * @param {number} x - Specifies left position.
     * @param {number} y - Specifies top position.
     * @param {number} width - Specifies width.
     * @param {number} height - Specifies height
     * @param {Point} touchPoint - Specifies the point to check.
     * @returns {boolean} - Return true if points intersect.
     */DocumentHelper.prototype.isInsideRect=function(x,y,width,height,touchPoint){if(touchPoint.x>x&&touchPoint.x<=x+width&&touchPoint.y>y&&touchPoint.y<=y+height){return true;}return false;};DocumentHelper.prototype.getLeftValue=function(widget){var left=widget.paragraph.x;var paragraphFormat=widget.paragraph.paragraphFormat;if(this.selection.isParagraphFirstLine(widget)){if(paragraphFormat.textAlignment==='Right'){left-=HelperMethods.convertPointToPixel(paragraphFormat.firstLineIndent);left-=HelperMethods.convertPointToPixel(paragraphFormat.leftIndent);}else{left+=HelperMethods.convertPointToPixel(paragraphFormat.firstLineIndent);}}var element=widget.children[0];if(element instanceof ListTextElementBox){left+=element.margin.left;}return left;};/**
     * Checks whether left mouse button is pressed or not.
     *
     * @param {MouseEvent} event - Specifies mouse event.
     * @returns {boolean} - Returns true if left mouse button is clicked.
     */DocumentHelper.prototype.isLeftButtonPressed=function(event){this.isTouchInput=false;var button=event.which||event.button;return button===1;};DocumentHelper.prototype.updateSelectionOnTouch=function(point,touchPoint){this.zoomX=undefined;this.zoomY=undefined;if(this.isMouseDown&&!this.isSelectionChangedOnMouseMoved&&!sf.base.isNullOrUndefined(this.currentPage)&&!sf.base.isNullOrUndefined(this.owner.selection.start)){if(this.touchDownOnSelectionMark===0){this.updateTextPositionForSelection(new Point(touchPoint.x,touchPoint.y),this.tapCount);if(this.tapCount===2){this.selection.checkAndEnableHeaderFooter(point,touchPoint);}}if(this.owner.selection.isEmpty){this.selection.updateCaretPosition();}this.selection.checkForCursorVisibility();// if (!isNullOrUndefined(this.currentSelectedComment) && this.owner.commentReviewPane
//     && !this.owner.commentReviewPane.commentPane.isEditMode) {
//     this.currentSelectedComment = undefined;
// }
}};/**
     * Gets touch offset value.
     *
     * @private
     * @param {TouchEvent} event - Specifies touch event
     * @returns {Point}  - Returns modified touch offset
     */DocumentHelper.prototype.getTouchOffsetValue=function(event){var targetElement=this.viewerContainer;var offset=targetElement.getBoundingClientRect();var touchOffsetValues=event.touches[0];if(sf.base.isNullOrUndefined(touchOffsetValues)){touchOffsetValues=event.changedTouches[0];}var offsetX=touchOffsetValues.pageX-offset.left;var offsetY=touchOffsetValues.pageY-offset.top;return new Point(offsetX,offsetY);};/**
     * Fired on pinch zoom in.
     *
     * @private
     * @param {TouchEvent} event - Specifies touch event
     * @returns {void}
     */DocumentHelper.prototype.onPinchInInternal=function(event){this.preZoomFactor=this.zoomFactor;var updatedZoomFactor=this.zoomFactor-0.01;if(updatedZoomFactor<5&&updatedZoomFactor>2){updatedZoomFactor=updatedZoomFactor-0.01;}if(updatedZoomFactor<0.1){updatedZoomFactor=0.1;}this.zoomFactor=updatedZoomFactor;};DocumentHelper.prototype.onPinchOutInternal=function(event){this.preZoomFactor=this.zoomFactor;var updatedZoomFactor=this.zoomFactor+0.01;if(updatedZoomFactor>2){updatedZoomFactor=updatedZoomFactor+0.01;}if(updatedZoomFactor>5){updatedZoomFactor=5;}this.zoomFactor=updatedZoomFactor;};DocumentHelper.prototype.getPageWidth=function(page){var width=page.boundingRectangle.width;return width;};/**
     * Removes specified page.
     * @private
     * @param {Page} page - Specifies page to remove
     * @returns {void}
     */DocumentHelper.prototype.removePage=function(page){if(this.currentPage===page){this.currentPage=undefined;}var index=this.pages.indexOf(page);// if (index > -1) {
this.pages.splice(index,1);// }        
//this.removeRenderedPages();
if(!sf.base.isNullOrUndefined(this.owner.viewer.visiblePages)){if(this.owner.viewer.visiblePages.indexOf(page)>-1){var pageIndex=this.owner.viewer.visiblePages.indexOf(page);this.owner.viewer.visiblePages.splice(pageIndex,1);}}//(viewer as PageLayoutViewer).visiblePages.remove(page);
var height=0;for(var i=0;i<this.pages.length;i++){height=height+this.pages[i].boundingRectangle.height;}//Updates the vertical height.
height-=page.boundingRectangle.height+20;//ToDo:Update horizontal width, if removed page has max width.
var top=20;if(index>0){top+=this.pages[index-1].boundingRectangle.bottom;}if(index!==-1){for(var i=index;i<this.pages.length;i++){//Update bounding rectangle of next pages in collection.
page=this.pages[i];page.boundingRectangle=new Rect(page.boundingRectangle.x,top,page.boundingRectangle.width,page.boundingRectangle.height);top=page.boundingRectangle.bottom+20;page.repeatHeaderRowTableWidget=false;}}};// private removeRenderedPages(): void {
//     for (let i: number = 0; i < this.pages.length; i++) {
//         this.clearContainer(this.pages[i]);
//     }
// }
/**
     * Updates viewer size on window resize.
     *
     * @private
     * @returns {void}
     */DocumentHelper.prototype.updateViewerSize=function(){var _this=this;var element=this.owner.getDocumentEditorElement();this.updateViewerSizeInternal(element);this.owner.viewer.updateScrollBars();if(this.owner.viewer instanceof WebLayoutViewer&&!sf.base.isNullOrUndefined(this.owner)&&!sf.base.isNullOrUndefined(element)){if(this.resizerTimer){clearTimeout(this.resizerTimer);}/* eslint-disable @typescript-eslint/indent */this.resizerTimer=setTimeout(function(){if(!sf.base.isNullOrUndefined(_this.owner)){var currentVisibleWidth=void 0;if(!sf.base.isNullOrUndefined(_this.visibleBounds)){currentVisibleWidth=_this.visibleBounds.width;}else{currentVisibleWidth=0;}if(sf.base.isNullOrUndefined(_this.owner.viewer.preVisibleWidth)){_this.owner.viewer.preVisibleWidth=0;}if(!sf.base.isNullOrUndefined(_this.visibleBounds)&&currentVisibleWidth!==_this.owner.viewer.preVisibleWidth){_this.owner.editorModule.layoutWholeDocument();_this.owner.viewer.preVisibleWidth=currentVisibleWidth;}if(_this.resizerTimer){clearTimeout(_this.resizerTimer);}}},50);}if(!sf.base.isNullOrUndefined(this.selection)){this.selection.updateCaretPosition();}};DocumentHelper.prototype.updateViewerSizeInternal=function(element){if(!sf.base.isNullOrUndefined(element)){var rect=element.getBoundingClientRect();var width=0;var height=0;height=rect.height>0?rect.height:200;var restrictPaneRect=void 0;var optionsRect=void 0;var commentPane=void 0;if(this.restrictEditingElement){restrictPaneRect=this.restrictEditingElement.style.display!=='none'?this.restrictEditingElement.getBoundingClientRect():undefined;}if(this.optionsPaneElement){optionsRect=this.optionsPaneElement.style.display!=='none'?this.optionsPaneElement.getBoundingClientRect():undefined;}if(this.commentPaneElement){commentPane=this.commentPaneElement.style.display!=='none'?this.commentPaneElement.getBoundingClientRect():undefined;}if(restrictPaneRect||optionsRect||commentPane){var paneWidth=restrictPaneRect?restrictPaneRect.width:0;paneWidth+=optionsRect?optionsRect.width:0;paneWidth+=commentPane?commentPane.width:0;width=rect.width-paneWidth>0?rect.width-paneWidth:200;}else{width=rect.width>0?rect.width:200;}this.viewerContainer.style.height=height.toString()+'px';this.viewerContainer.style.width=Math.ceil(width)+'px';this.visibleBoundsIn=new Rect(0,0,width,height);this.containerCanvas.width=width;this.containerCanvas.height=height;this.selectionCanvas.width=width;this.selectionCanvas.height=height;this.measureScrollbarWidth(element);}};/**
     * Inserts page in specified index.
     *
     * @private
     * @param {number} index - Specifes index to insert page
     * @param {Page} page - Page to insert.
     * @returns {void}
     */DocumentHelper.prototype.insertPage=function(index,page){if(this.pages.indexOf(page)>-1){this.pages.splice(this.pages.indexOf(page),1);}this.pages.splice(index,0,page);var top=20;if(index>0){top+=this.pages[index-1].boundingRectangle.bottom;}for(var i=index;i<this.pages.length;i++){//Update bounding rectangle of next pages in collection.
page=this.pages[i];page.boundingRectangle=new Rect(page.boundingRectangle.x,top,page.boundingRectangle.width,page.boundingRectangle.height);top=page.boundingRectangle.bottom+20;}};DocumentHelper.prototype.updateTextPositionForSelection=function(cursorPoint,tapCount){var widget=this.getLineWidget(cursorPoint);if(!sf.base.isNullOrUndefined(widget)){this.selection.updateTextPosition(widget,cursorPoint);}if(tapCount>1){this.isMouseDown=false;this.useTouchSelectionMark=false;if(this.pages.length===0){return;}//Double tap/triple tap selection
if(!sf.base.isNullOrUndefined(this.currentPage)&&!sf.base.isNullOrUndefined(this.owner.selection.start)){if(tapCount%2===0){this.owner.selection.selectCurrentWord();}else{this.owner.selection.selectParagraph();}}}};DocumentHelper.prototype.scrollToPosition=function(startPosition,endPosition,skipCursorUpdate){if(this.skipScrollToPosition||this.isWebPrinting){this.skipScrollToPosition=false;return;}if(this.owner.enableImageResizerMode&&this.owner.imageResizerModule.isImageResizing||this.isMouseDownInFooterRegion||this.isRowOrCellResizing){return;}var lineWidget=this.selection.getLineWidgetInternal(endPosition.currentWidget,endPosition.offset,true);if(sf.base.isNullOrUndefined(lineWidget)){return;}var top=this.selection.getTop(lineWidget);if(this.isMouseDown){var prevLineWidget=this.selection.getLineWidgetInternal(endPosition.currentWidget,endPosition.offset,false);var prevTop=this.selection.getTop(prevLineWidget);if(prevLineWidget!==lineWidget&&endPosition.location.y>=prevTop){lineWidget=prevLineWidget;}}var height=lineWidget.height;//Gets current page.
var endPage=this.selection.getPage(lineWidget.paragraph);this.currentPage=endPage;var x=0;var y=0;var isPageLayout=this.owner.viewer instanceof PageLayoutViewer;var pageLayout=this.owner.viewer;if(sf.base.isNullOrUndefined(endPage)){return;}var pageWidth=endPage.boundingRectangle.width;x=(this.visibleBounds.width-pageWidth*this.zoomFactor)/2;if(x<30){x=30;}y=endPage.boundingRectangle.y*this.zoomFactor+(this.pages.indexOf(endPage)+1)*this.owner.viewer.pageGap*(1-this.zoomFactor);var scrollTop=this.owner.viewer.containerTop;var scrollLeft=this.owner.viewer.containerLeft;var pageHeight=this.visibleBounds.height;var caretInfo=this.selection.updateCaretSize(this.owner.selection.end,true);var topMargin=caretInfo.topMargin;var caretHeight=caretInfo.height;x+=endPosition.location.x*this.zoomFactor;y+=(endPosition.location.y+topMargin)*this.zoomFactor;//vertical scroll bar update
if(scrollTop+20>y){this.viewerContainer.scrollTop=y-10;}else if(scrollTop+pageHeight<y+caretHeight){this.viewerContainer.scrollTop=y+caretHeight-pageHeight+10;}if(!skipCursorUpdate){this.selection.updateCaretToPage(startPosition,endPage);}var scrollBarWidth=this.viewerContainer.offsetWidth-this.viewerContainer.clientWidth;if(scrollLeft>x){this.viewerContainer.scrollLeft=x-this.pageContainer.offsetWidth/100*20;}else if(scrollLeft+this.visibleBounds.width<x+scrollBarWidth){this.viewerContainer.scrollLeft=scrollLeft+this.pageContainer.offsetWidth/100*15+scrollBarWidth;}};DocumentHelper.prototype.getLineWidget=function(cursorPoint){return this.getLineWidgetInternal(cursorPoint,false);};DocumentHelper.prototype.getLineWidgetInternal=function(cursorPoint,isMouseDragged){var widget=undefined;if(!sf.base.isNullOrUndefined(this.currentPage)){var childWidgets=void 0;if(this.owner.enableHeaderAndFooter){var page=this.currentPage;var pageBottom=page.boundingRectangle.height;var headerHeight=Math.max(page.headerWidget.y+page.headerWidget.height,HelperMethods.convertPointToPixel(page.bodyWidgets[0].sectionFormat.topMargin))*this.zoomFactor;var footerDistance=HelperMethods.convertPointToPixel(page.bodyWidgets[0].sectionFormat.footerDistance);var footerHeight=page.boundingRectangle.height-Math.max(page.footerWidget.height+footerDistance,footerDistance*2);if(isMouseDragged){if(this.isBlockInHeader(this.selection.start.paragraph)){childWidgets=this.currentPage.headerWidget;}else{childWidgets=this.currentPage.footerWidget;}}else{if(cursorPoint.y<=pageBottom&&cursorPoint.y>=footerHeight){childWidgets=this.currentPage.footerWidget;}else if(cursorPoint.y>=0&&cursorPoint.y<=headerHeight){childWidgets=this.currentPage.headerWidget;}}if(sf.base.isNullOrUndefined(childWidgets)){return undefined;}var shapeElementInfo=this.checkFloatingItems(childWidgets,cursorPoint,isMouseDragged);if(shapeElementInfo.isShapeSelected){if(shapeElementInfo.isInShapeBorder){return shapeElementInfo.element.line;}return this.selection.getLineWidgetBodyWidget(shapeElementInfo.element.textFrame,cursorPoint);}else{return this.selection.getLineWidgetBodyWidget(childWidgets,cursorPoint);}}else{var shapeInfo=this.checkFloatingItems(this.currentPage.bodyWidgets[0],cursorPoint,isMouseDragged,false);var behindShapeInfo=this.checkFloatingItems(this.currentPage.bodyWidgets[0],cursorPoint,isMouseDragged,true);if(shapeInfo.isShapeSelected){if(shapeInfo.isInShapeBorder){return shapeInfo.element.line;}if(shapeInfo.element instanceof ShapeElementBox){widget=this.selection.getLineWidgetBodyWidget(shapeInfo.element.textFrame,cursorPoint);}}else if(isMouseDragged&&this.isFootnoteWidget){if(this.selection.start.paragraph.footNoteReference!==undefined&&this.selection.start.paragraph.containerWidget instanceof FootNoteWidget&&this.selection.start.paragraph.containerWidget.footNoteType==='Footnote'){return this.selection.getLineWidgetBodyWidget(this.currentPage.footnoteWidget,cursorPoint);}else if(this.selection.start.paragraph.footNoteReference!==undefined&&this.selection.start.paragraph.containerWidget instanceof FootNoteWidget&&this.selection.start.paragraph.containerWidget.footNoteType==='Endnote'){return this.selection.getLineWidgetBodyWidget(this.currentPage.endnoteWidget,cursorPoint);}}else{if(!isMouseDragged&&this.currentPage.footnoteWidget&&this.isInFootnoteWidget(this.currentPage.footnoteWidget,cursorPoint)){widget=this.selection.getLineWidgetBodyWidget(this.currentPage.footnoteWidget,cursorPoint);if(widget){this.isFootnoteWidget=true;}}else if(!isMouseDragged&&this.currentPage.endnoteWidget&&this.isInFootnoteWidget(this.currentPage.endnoteWidget,cursorPoint)){widget=this.selection.getLineWidgetBodyWidget(this.currentPage.endnoteWidget,cursorPoint);if(widget){this.isFootnoteWidget=true;}}else{for(var i=0;i<this.currentPage.bodyWidgets.length;i++){var bodyWidgets=this.currentPage.bodyWidgets[i];widget=this.selection.getLineWidgetBodyWidget(bodyWidgets,cursorPoint);if(!sf.base.isNullOrUndefined(widget)){this.isFootnoteWidget=false;break;}}}}var inlineShapeInfo=this.checkInlineShapeItems(widget,cursorPoint,isMouseDragged);if(inlineShapeInfo.isShapeSelected){if(inlineShapeInfo.isInShapeBorder){return inlineShapeInfo.element.line;}if(inlineShapeInfo.element instanceof ShapeElementBox){widget=this.selection.getLineWidgetBodyWidget(inlineShapeInfo.element.textFrame,cursorPoint);}}else if(!this.checkPointIsInLine(widget,cursorPoint)&&behindShapeInfo.isShapeSelected){if(behindShapeInfo.isInShapeBorder){return behindShapeInfo.element.line;}if(behindShapeInfo.element instanceof ShapeElementBox){widget=this.selection.getLineWidgetBodyWidget(behindShapeInfo.element.textFrame,cursorPoint);}}}}return widget;};DocumentHelper.prototype.checkInlineShapeItems=function(widget,cursorPoint,isMouseDragged){var isInShape=false;var isInShapeBorder=false;var floatElement;var selectionInShape=this.selection.isInShape;var isMouseDraggedInShape=isMouseDragged&&selectionInShape;if(!sf.base.isNullOrUndefined(widget)&&widget.children.length>0){if(isMouseDraggedInShape){var textFrame=this.owner.selection.getCurrentTextFrame();if(textFrame){floatElement=textFrame.containerShape;isInShape=true;}}else{for(var i=0;i<widget.children.length;i++){if(!(widget.children[i]instanceof ShapeElementBox&&widget.children[i].textWrappingStyle==='Inline')){continue;}floatElement=widget.children[i];if(cursorPoint.x<floatElement.x+floatElement.margin.left+floatElement.width&&cursorPoint.x>floatElement.x&&cursorPoint.y<floatElement.y+floatElement.margin.top+floatElement.height&&cursorPoint.y>floatElement.y){isInShape=true;if(this.isInShapeBorder(floatElement,cursorPoint)){isInShapeBorder=true;}break;}}if(isMouseDragged&&!selectionInShape){isInShape=false;}}}return{'element':floatElement,'caretPosition':cursorPoint,'isShapeSelected':isInShape,'isInShapeBorder':isInShapeBorder};};/**
     * @private
     */DocumentHelper.prototype.checkPointIsInLine=function(widget,cursorPoint){if(!sf.base.isNullOrUndefined(widget)&&widget.children.length>0){var element=void 0;var left=widget.paragraph.x;var top_1=this.selection.getTop(widget);for(var i=widget.children.indexOf(widget.children[0]);i<widget.children.length;i++){element=widget.children[i];if(element instanceof ShapeBase&&element.textWrappingStyle!=='Inline'){continue;}if(cursorPoint.x<left+element.margin.left+element.width+element.padding.left&&cursorPoint.x>left&&cursorPoint.y<top_1+widget.height&&cursorPoint.y>top_1){return true;}left+=element.margin.left+element.width+element.padding.left;}}return false;};DocumentHelper.prototype.isInFootnoteWidget=function(footnoteWidget,point){for(var i=0;i<footnoteWidget.childWidgets.length;i++){var childWidget=footnoteWidget.childWidgets[i];if(childWidget instanceof Widget&&childWidget.y<=point.y&&childWidget.y+childWidget.height>=point.y){return true;}}return false;};DocumentHelper.prototype.checkFloatingItems=function(blockContainer,cursorPoint,isMouseDragged,isBehind){var isInShape=false;var isInShapeBorder=false;var floatElement;var selectionInShape=this.selection.isInShape;var isMouseDraggedInShape=isMouseDragged&&selectionInShape;if(blockContainer.floatingElements.length>0){var page=this.currentPage;/* eslint-disable */blockContainer.floatingElements.sort(function(a,b){if(a instanceof TableWidget||b instanceof TableWidget){return 0;}else{return a.zOrderPosition-b.zOrderPosition;}});if(isMouseDraggedInShape){var textFrame=this.owner.selection.getCurrentTextFrame();if(textFrame){floatElement=textFrame.containerShape;isInShape=true;}}else{for(var i=0;i<blockContainer.floatingElements.length;i++){if(blockContainer.floatingElements[i]instanceof TableWidget||(!sf.base.isNullOrUndefined(isBehind)&&isBehind?blockContainer.floatingElements[i].textWrappingStyle!=='Behind':blockContainer.floatingElements[i].textWrappingStyle==='Behind')){continue;}floatElement=blockContainer.floatingElements[i];if(cursorPoint.x<floatElement.x+floatElement.margin.left+floatElement.width&&cursorPoint.x>floatElement.x&&cursorPoint.y<floatElement.y+floatElement.margin.top+floatElement.height&&cursorPoint.y>floatElement.y){isInShape=true;if(this.isInShapeBorder(floatElement,cursorPoint)){isInShapeBorder=true;}break;}}if(isMouseDragged&&!selectionInShape){isInShape=false;}}}return{'element':floatElement,'caretPosition':cursorPoint,'isShapeSelected':isInShape,'isInShapeBorder':isInShapeBorder};};DocumentHelper.prototype.isBlockInHeader=function(block){while(!(block.containerWidget instanceof HeaderFooterWidget)){if(!block.containerWidget){return false;}block=block.containerWidget;if(block instanceof TextFrame){block=block.containerShape.paragraph;}}return block.containerWidget.headerFooterType.indexOf('Header')!==-1;};DocumentHelper.prototype.clearSelectionHighlight=function(){var canClear=true;canClear=!this.isControlPressed||!this.isMouseDown;// if (this.owner.selection.selectionRanges.length > 0 && canClear) {
if(this.owner.selection.clearSelectionHighlightInSelectedWidgets()){this.selectionContext.clearRect(0,0,this.selectionCanvas.width,this.selectionCanvas.height);}// } else if (!isNullOrUndefined(this.owner.selection.currentSelectionRange) && this.isMouseDown) {
//     this.owner.selection.currentSelectionRange.clearSelectionHighlight();
// }
//this.renderVisiblePages();
};/**
     * @private
     * @returns {void}
     */DocumentHelper.prototype.removeEmptyPages=function(){var scrollToLastPage=false;for(var j=0;j<this.pages.length;j++){var page=this.pages[j];if(page.bodyWidgets.length===0||page.bodyWidgets[0].childWidgets.length===0){if(j===this.pages.length-1&&this.owner.viewer instanceof PageLayoutViewer&&this.owner.viewer.visiblePages.indexOf(this.pages[j])!==-1){scrollToLastPage=true;}this.removePage(this.pages[j]);j--;}}if(scrollToLastPage){this.scrollToBottom();}};/**
     * @private
     * @returns {void}
     */DocumentHelper.prototype.scrollToBottom=function(){if(this.selection.start.paragraph&&this.selection.start.paragraph.bodyWidget){var page=this.selection.start.paragraph.bodyWidget.page;var containerHeight=this.visibleBounds.height;this.viewerContainer.scrollTop=page.boundingRectangle.bottom-containerHeight;}};DocumentHelper.prototype.getFieldResult=function(fieldBegin,page){if(!sf.base.isNullOrUndefined(page)&&!sf.base.isNullOrUndefined(this.selection)){var fieldCode=this.selection.getFieldCode(fieldBegin);var fieldCodes=fieldCode.split('\*');var fieldCategory=fieldCodes[0].replace(/[^\w\s]/gi,'').trim().toLowerCase();var fieldPattern='';if(fieldCodes.length>1){fieldPattern=fieldCodes[1].replace(/[^\w\s]/gi,'').trim();}fieldCategory=!fieldCategory.match('numpages')&&!fieldCategory.match('sectionpages')&&fieldCategory.match('page')?'page':fieldCategory;switch(fieldCategory){case'page':if(page.bodyWidgets[0].sectionFormat.restartPageNumbering&&page.sectionIndex!==0){var currentSectionIndex_1=page.sectionIndex;var previousPage=page.previousPage;if(currentSectionIndex_1!==previousPage.sectionIndex){page.currentPageNum=page.bodyWidgets[0].sectionFormat.pageStartingNumber;return this.getFieldText(fieldPattern,page.currentPageNum);}if(previousPage.currentPageNum===1){previousPage.currentPageNum=page.bodyWidgets[0].sectionFormat.pageStartingNumber;}page.currentPageNum=previousPage.currentPageNum+1;return this.getFieldText(fieldPattern,page.currentPageNum);}else if(page.bodyWidgets[0].sectionFormat.restartPageNumbering&&page.sectionIndex===0){page.currentPageNum=page.bodyWidgets[0].sectionFormat.pageStartingNumber+page.index;return this.getFieldText(fieldPattern,page.currentPageNum);}page.currentPageNum=!sf.base.isNullOrUndefined(page.previousPage)?page.previousPage.currentPageNum+1:page.index+1;page.currentPageNum=page.index+1;return this.getFieldText(fieldPattern,page.currentPageNum);case'numpages':return this.getFieldText(fieldPattern,page.documentHelper.pages.length);case'sectionpages':var currentSectionIndex=page.sectionIndex;var currentPageCount=0;for(var i=0;i<page.documentHelper.pages.length;i++){if(page.documentHelper.pages[i].sectionIndex===currentSectionIndex){currentPageCount++;}else if(currentPageCount!==0){break;}}return this.getFieldText(fieldPattern,currentPageCount);default:break;}}return'';};DocumentHelper.prototype.getFieldText=function(pattern,value){switch(pattern){case'ALPHABETIC':return this.layout.getAsLetter(value).toUpperCase();case'alphabetic':return this.layout.getAsLetter(value).toLowerCase();case'roman':return this.layout.getAsRoman(value).toLowerCase();case'ROMAN':return this.layout.getAsRoman(value).toUpperCase();default:return value.toString();}};/**
     * Destroys the internal objects maintained for control.
     *
     * @returns {void}
     */DocumentHelper.prototype.destroy=function(){if(!sf.base.isNullOrUndefined(this.owner)){this.unWireEvent();}this.pages=[];this.pages=undefined;this.fieldStacks=[];this.fieldStacks=undefined;this.splittedCellWidgets=[];this.splittedCellWidgets=undefined;this.fields=[];this.fields=undefined;if(this.layout){this.layout.destroy();}this.layout=undefined;if(!sf.base.isNullOrUndefined(this.render)){this.render.destroy();}this.render=undefined;// if (this.dialogInternal) {
//     this.dialogInternal.destroy();
// }
// this.dialogInternal = undefined;
// if (this.dialogInternal2) {
//     this.dialogInternal2.destroy();
//     this.dialogInternal2 = undefined;
// }
// if (this.dialogInternal3) {
//     this.dialogInternal3.destroy();
//     this.dialogInternal3 = undefined;
// }
if(this.dialogTarget1&&this.dialogTarget1.parentElement){this.dialogTarget1.parentElement.removeChild(this.dialogTarget1);}this.dialogTarget1=undefined;if(this.dialogTarget2&&this.dialogTarget2.parentElement){this.dialogTarget2.parentElement.removeChild(this.dialogTarget2);}this.dialogTarget2=undefined;if(this.dialogTarget3&&this.dialogTarget3.parentElement){this.dialogTarget3.parentElement.removeChild(this.dialogTarget3);}this.dialogTarget3=undefined;if(!sf.base.isNullOrUndefined(this.touchStart)){this.touchStart.innerHTML='';}if(this.textHelper){this.textHelper.destroy();}this.textHelper=undefined;this.touchStart=undefined;if(!sf.base.isNullOrUndefined(this.touchEnd)){this.touchEnd.innerHTML='';}this.touchEnd=undefined;if(!sf.base.isNullOrUndefined(this.containerCanvasIn)){this.containerCanvasIn.innerHTML='';}this.containerCanvasIn=undefined;if(!sf.base.isNullOrUndefined(this.selectionCanvasIn)){this.selectionCanvasIn.innerHTML='';}this.selectionCanvasIn=undefined;if(!sf.base.isNullOrUndefined(this.editableDiv)){this.editableDiv.innerHTML='';this.editableDiv.parentElement.removeChild(this.editableDiv);}this.editableDiv=undefined;if(!sf.base.isNullOrUndefined(this.pageContainer)){this.pageContainer.innerHTML='';}this.pageContainer=undefined;if(!sf.base.isNullOrUndefined(this.viewerContainer)){this.viewerContainer.innerHTML='';}this.viewerContainer=undefined;this.owner=undefined;this.heightInfoCollection=undefined;};/**
     * Un-Wires events and methods
     *
     * @returns {void}
     */DocumentHelper.prototype.unWireEvent=function(){this.viewerContainer.removeEventListener('scroll',this.scrollHandler);this.viewerContainer.removeEventListener('mousedown',this.onMouseDownInternal);this.viewerContainer.removeEventListener('mousemove',this.onMouseMoveInternal);if(!sf.base.Browser.isDevice){this.editableDiv.removeEventListener('keypress',this.onKeyPressInternal);if(sf.base.Browser.info.name==='chrome'){this.editableDiv.removeEventListener('textInput',this.onTextInput);}}else{this.editableDiv.removeEventListener('input',this.onTextInputInternal);}this.editableDiv.removeEventListener('paste',this.onPaste);this.viewerContainer.removeEventListener('contextmenu',this.onContextMenu);this.editableDiv.removeEventListener('blur',this.onFocusOut);this.editableDiv.removeEventListener('keydown',this.onKeyDownInternal);this.editableDiv.removeEventListener('compositionstart',this.compositionStart);this.editableDiv.removeEventListener('compositionupdate',this.compositionUpdated);this.editableDiv.removeEventListener('compositionend',this.compositionEnd);this.viewerContainer.removeEventListener('mouseup',this.onMouseUpInternal);if(!sf.base.isNullOrUndefined(this.iframe)){this.iframe.removeEventListener('load',this.onIframeLoad);}this.viewerContainer.removeEventListener('dblclick',this.onDoubleTap);window.removeEventListener('resize',this.onWindowResize);window.removeEventListener('keyup',this.onKeyUpInternal);window.removeEventListener('mouseup',this.onImageResizer.bind(this));window.removeEventListener('touchend',this.onImageResizer.bind(this));};DocumentHelper.prototype.updateCursor=function(event){var hyperlinkField=undefined;var footnoteElement=undefined;var div=this.viewerContainer;var point=new Point(event.offsetX,event.offsetY);var touchPoint=this.owner.viewer.findFocusedPage(point,true);var widget=this.getLineWidget(touchPoint);var widgetInfo;var left;var top;var editor=!this.owner.isReadOnlyMode?this.owner.editorModule:undefined;var isRowResize=editor?editor.tableResize.isInRowResizerArea(touchPoint):false;var isCellResize=editor?editor.tableResize.isInCellResizerArea(touchPoint):false;var floatItemInfo=this.selection.checkAllFloatingElements(widget,touchPoint);var resizePosition='';if(this.owner.enableImageResizerMode){var resizeObj=this.owner.imageResizerModule.getImagePoint(touchPoint);this.owner.imageResizerModule.selectedResizeElement=resizeObj.selectedElement;resizePosition=resizeObj.resizePosition;}var lineLeft=0;var formField=undefined;var isInInline=this.checkPointIsInLine(widget,touchPoint);if(!sf.base.isNullOrUndefined(widget)){lineLeft=this.selection.getLineStartLeft(widget);hyperlinkField=this.selection.getHyperLinkFieldInCurrentSelection(widget,touchPoint);if(sf.base.isNullOrUndefined(hyperlinkField)){formField=this.selection.getHyperLinkFieldInCurrentSelection(widget,touchPoint,true);}if(!sf.base.isNullOrUndefined(hyperlinkField)){var code=this.selection.getFieldCode(hyperlinkField);if(code.toLowerCase().indexOf('ref ')===0&&!code.match('\\h')){hyperlinkField=undefined;}}widgetInfo=this.selection.updateTextPositionIn(widget,undefined,0,touchPoint,true);left=this.selection.getLeft(widget);top=this.selection.getTop(widget);if(sf.base.isNullOrUndefined(hyperlinkField)&&!sf.base.isNullOrUndefined(formField)&&this.isDocumentProtected&&this.protectionType==='FormFieldsOnly'&&!this.isFormFilling){this.selection.setHyperlinkContentToToolTip(formField,widget,touchPoint.x,true);}else{this.selection.setHyperlinkContentToToolTip(hyperlinkField,widget,touchPoint.x,false);}if(formField){var isInlineFormFillMode=formField.formFieldData instanceof TextFormField&&formField.formFieldData.type==='Text';if(this.owner.documentEditorSettings.formFieldSettings.formFillingMode==='Inline'&&isInlineFormFillMode){//Update text cursor in text form field.
formField=undefined;}}// if (this.owner.enableLockAndEdit) {
//     let isLocked: boolean = false;
//     let block: BlockWidget = widget.paragraph;
//     if (block.isInsideTable) {
//         block = this.layout.getParentTable(block);
//     }
//     if (block.locked && block.lockedBy !== this.owner.currentUser) {
//         isLocked = true;
//     }
//     let sectionFormat: WSectionFormat = widget.paragraph.bodyWidget.sectionFormat;
//     let pageWidth: number = sectionFormat.pageWidth - sectionFormat.rightMargin - sectionFormat.leftMargin;
//     pageWidth = HelperMethods.convertPointToPixel(pageWidth) * this.zoomFactor;
//     if (this.viewer instanceof WebLayoutViewer) {
//         pageWidth = (this.visibleBounds.width - (this.viewer.padding.right * 5)) / this.zoomFactor;
//     }
//     if (isLocked && touchPoint.x >= lineLeft && touchPoint.x < lineLeft + pageWidth) {
//         this.selection.setLockInfoTooptip(widget, touchPoint.x, block.lockedBy);
//     } else {
//         this.selection.setLockInfoTooptip(undefined, touchPoint.x, '');
//     }
// }
}if(!sf.base.isNullOrUndefined(widget)){if(sf.base.isNullOrUndefined(footnoteElement)&&this.owner.layoutType=='Pages'){footnoteElement=this.selection.getFootNoteElementInCurrentSelection(widget,touchPoint);if(footnoteElement instanceof FootnoteElementBox){this.selection.setFootnoteContentToToolTip(footnoteElement,widget,touchPoint.x);}}}var isCtrlkeyPressed=this.isIosDevice?event.metaKey:event.ctrlKey;if(!sf.base.isNullOrUndefined(hyperlinkField)&&(isCtrlkeyPressed&&this.owner.useCtrlClickToFollowHyperlink||!this.owner.useCtrlClickToFollowHyperlink)||formField){if(!sf.base.isNullOrUndefined(formField)){if(this.isFormFillProtectedMode){div.style.cursor='default';}}else{div.style.cursor='pointer';}return;}else if(touchPoint.x>=lineLeft&&event.offsetX<this.visibleBounds.width-(this.visibleBounds.width-this.viewerContainer.clientWidth)&&event.offsetY<this.visibleBounds.height-(this.visibleBounds.height-this.viewerContainer.clientHeight)){if(this.selection.isEmpty){div.style.cursor='text';}else{div.style.cursor=this.selection.checkCursorIsInSelection(widget,touchPoint)?'default':'text';}}else{div.style.cursor='default';}if(!sf.base.isNullOrUndefined(resizePosition)&&resizePosition!==''){if(!this.owner.imageResizerModule.isShapeResize||this.owner.imageResizerModule.isShapeResize&&resizePosition!=='move'){div.style.cursor=resizePosition;}}else if(!sf.base.isNullOrUndefined(widgetInfo)&&widgetInfo.isImageSelected&&left<touchPoint.x&&top<touchPoint.y&&left+widget.width>touchPoint.x&&top+widget.height>touchPoint.y){div.style.cursor='move';}if(isRowResize){div.style.cursor='row-resize';}else if(isCellResize){div.style.cursor='col-resize';}if(floatItemInfo.isInShapeBorder&&!isInInline){div.style.cursor='all-scroll';}};return DocumentHelper;}();/**
 * @private
 */var LayoutViewer=/** @class */function(){function LayoutViewer(owner){/**
         * @private
         */this.visiblePages=[];/**
         * @private
         */this.padding=new Padding(10,10,10,10);/**
         * @private
         */this.textWrap=true;/**
         * @private
         */this.pageFitTypeIn='None';/**
         * @private
         */this.containerTop=0;/**
         * @private
         */this.containerLeft=0;this.owner=owner;}Object.defineProperty(LayoutViewer.prototype,"documentHelper",{get:function get(){return this.owner.documentHelper;},enumerable:true,configurable:true});Object.defineProperty(LayoutViewer.prototype,"pageFitType",{/**
         * Gets or sets page fit type.
         * @private
         */get:function get(){return this.pageFitTypeIn;},set:function set(value){this.pageFitTypeIn=value;this.onPageFitTypeChanged(this.pageFitTypeIn);},enumerable:true,configurable:true});LayoutViewer.prototype.updateClientArea=function(sectionFormat,page,isReLayout){var width=0;var height=0;if(this instanceof WebLayoutViewer){var top_2=0;width=(this.documentHelper.visibleBounds.width-this.padding.right*4-this.padding.left*2)/this.documentHelper.zoomFactor;if(width<0){width=0;}height=Number.POSITIVE_INFINITY;this.clientArea=new Rect(this.padding.left/this.documentHelper.zoomFactor,top_2,width,height);this.clientActiveArea=new Rect(this.clientArea.x,this.clientArea.y,this.clientArea.width,this.clientArea.height);}else{var top_3=0;var headerDistance=48;var footerDistance=48;var pageHeight=HelperMethods.convertPointToPixel(sectionFormat.pageHeight);var bottomMargin=HelperMethods.convertPointToPixel(sectionFormat.bottomMargin);if(!sf.base.isNullOrUndefined(sectionFormat)){top_3=HelperMethods.convertPointToPixel(sectionFormat.topMargin);headerDistance=HelperMethods.convertPointToPixel(sectionFormat.headerDistance);footerDistance=HelperMethods.convertPointToPixel(sectionFormat.footerDistance);}var isEmptyWidget=false;if(!sf.base.isNullOrUndefined(page.headerWidget)){isEmptyWidget=page.headerWidget.isEmpty;if(!isEmptyWidget||isEmptyWidget&&this.owner.enableHeaderAndFooter){top_3=Math.min(Math.max(headerDistance+page.headerWidget.height,top_3),pageHeight/100*40);}}var bottom=0.667+bottomMargin;if(!sf.base.isNullOrUndefined(page.footerWidget)){isEmptyWidget=page.footerWidget.isEmpty;var footnoteHeight=!sf.base.isNullOrUndefined(page.footnoteWidget)?page.footnoteWidget.height:0;if(footnoteHeight===0){var num=this.owner.documentHelper.pages.indexOf(page);if(num>0){var footNote=this.owner.documentHelper.pages[num-1].footnoteWidget;footnoteHeight=!sf.base.isNullOrUndefined(footNote)?footNote.height:0;this.clientArea.height-=footnoteHeight;}}if(!isEmptyWidget||isEmptyWidget&&this.owner.enableHeaderAndFooter){// eslint-disable-next-line max-len
bottom=0.667+Math.min(pageHeight/100*40,Math.max(footerDistance+page.footerWidget.height+footnoteHeight,bottomMargin));}}if(!sf.base.isNullOrUndefined(sectionFormat)){width=HelperMethods.convertPointToPixel(sectionFormat.pageWidth-sectionFormat.leftMargin-sectionFormat.rightMargin);height=pageHeight-top_3-bottom;}if(width<0){width=0;}this.clientArea=new Rect(HelperMethods.convertPointToPixel(sectionFormat.leftMargin),top_3,width,pageHeight-top_3-bottom);if(isReLayout&&page.footnoteWidget){this.clientArea.height-=page.footnoteWidget.height;}this.clientActiveArea=new Rect(this.clientArea.x,this.clientArea.y,this.clientArea.width,this.clientArea.height);}};LayoutViewer.prototype.updateClientAreaTopOrLeft=function(tableWidget,beforeLayout){if(beforeLayout){this.clientActiveArea.y=this.clientActiveArea.y+tableWidget.topBorderWidth;this.clientActiveArea.x=this.clientActiveArea.x+tableWidget.leftBorderWidth;}};LayoutViewer.prototype.updateClientAreaForTable=function(tableWidget){this.clientActiveArea.x=this.clientArea.x=tableWidget.x;this.clientActiveArea.width=this.clientArea.width=tableWidget.width;};LayoutViewer.prototype.updateClientAreaForRow=function(row,beforeLayout){var tableWidget=row.ownerTable;if(beforeLayout){}else{this.clientActiveArea.x=this.clientArea.x=tableWidget.x;this.clientActiveArea.width=this.clientArea.width=tableWidget.width;this.clientArea=new Rect(this.clientArea.x,this.clientArea.y,this.clientArea.width,this.clientArea.height);this.clientActiveArea=new Rect(this.clientActiveArea.x,this.clientActiveArea.y,this.clientActiveArea.width,this.clientActiveArea.height-this.documentHelper.layout.footnoteHeight);}};LayoutViewer.prototype.updateClientAreaForCell=function(cell,beforeLayout){var rowWidget=cell.ownerRow;var cellWidget=cell;if(beforeLayout){this.clientActiveArea.x=this.clientArea.x=cellWidget.x;this.clientActiveArea.y=cellWidget.y;this.clientActiveArea.width=this.clientArea.width=cellWidget.width>0?cellWidget.width:0;if(this instanceof PageLayoutViewer){this.clientActiveArea.height=Number.POSITIVE_INFINITY;}this.clientArea=new Rect(this.clientArea.x,this.clientArea.y,this.clientArea.width,this.clientArea.height);this.clientActiveArea=new Rect(this.clientActiveArea.x,this.clientActiveArea.y,this.clientActiveArea.width,this.clientActiveArea.height);}else{this.clientActiveArea.x=this.clientArea.x=cellWidget.x+cellWidget.width+cellWidget.margin.right;if(rowWidget.x+rowWidget.width-this.clientArea.x<0){this.clientActiveArea.width=this.clientArea.width=0;}else{this.clientActiveArea.width=this.clientArea.width=rowWidget.x+rowWidget.width-this.clientArea.x;}this.clientActiveArea.y=cellWidget.y-cellWidget.margin.top-HelperMethods.convertPointToPixel(cell.ownerTable.tableFormat.cellSpacing);if(!cell.ownerTable.isInsideTable){this.clientActiveArea.height=this.clientArea.bottom-rowWidget.y>0?this.clientArea.bottom-rowWidget.y:0;}this.clientArea=new Rect(this.clientArea.x,this.clientArea.y,this.clientArea.width,this.clientArea.height);this.clientActiveArea=new Rect(this.clientActiveArea.x,this.clientActiveArea.y,this.clientActiveArea.width,this.clientActiveArea.height);}};LayoutViewer.prototype.updateClientAreaForTextBoxShape=function(textBox,beforeLayout){if(textBox.textWrappingStyle==='Inline'){textBox.y=this.clientActiveArea.y;textBox.x=this.clientActiveArea.x;}if(beforeLayout){var marginLeft=HelperMethods.convertPointToPixel(textBox.textFrame.marginLeft);var marginRight=HelperMethods.convertPointToPixel(textBox.textFrame.marginRight);var marginTop=HelperMethods.convertPointToPixel(textBox.textFrame.marginTop);var marginBottom=HelperMethods.convertPointToPixel(textBox.textFrame.marginBottom);var width=textBox.width;var height=Number.POSITIVE_INFINITY;this.clientArea=new Rect(textBox.x+marginLeft,textBox.y+marginTop,width-marginLeft-marginRight,height-marginTop-marginBottom);this.clientActiveArea=new Rect(this.clientArea.x,this.clientArea.y,this.clientArea.width,this.clientArea.height);}};LayoutViewer.prototype.updateClientAreaByWidgetFootNote=function(widget){this.clientArea.x=widget.x;this.clientArea.y=widget.y;this.clientActiveArea.x=widget.x;this.clientActiveArea.y=widget.y;};/**
     * @private
     */LayoutViewer.prototype.updateClientAreaForTextWrap=function(area){this.clientActiveArea=new Rect(area.x,area.y,area.width,area.height);};LayoutViewer.prototype.updateClientAreaByWidget=function(widget){this.clientArea.x=widget.x;this.clientArea.y=widget.y;this.clientActiveArea.x=widget.x;this.clientActiveArea.y=widget.y;};LayoutViewer.prototype.updateClientAreaLocation=function(widget,area){widget.x=area.x;widget.y=area.y;widget.width=area.width;};LayoutViewer.prototype.updateClientAreaForBlock=function(block,beforeLayout,tableCollection){var leftIndent=HelperMethods.convertPointToPixel(block.leftIndent);var rightIndent=HelperMethods.convertPointToPixel(block.rightIndent);var bidi=block.bidi;var width=0;if(beforeLayout){if(block instanceof TableWidget&&tableCollection){var tableWidget=tableCollection[0];this.clientActiveArea.x=this.clientArea.x=tableWidget.x;this.clientActiveArea.width=this.clientArea.width=tableWidget.width;//Updates the location of last item.
tableWidget=tableCollection[tableCollection.length-1];tableWidget.x=this.clientActiveArea.x;tableWidget.y=this.clientActiveArea.y;}else{if(block instanceof TableWidget&&!sf.base.isNullOrUndefined(block.tableFormat)){if(!block.isGridUpdated){block.buildTableColumns();block.isGridUpdated=true;}var tableAlignment=this.tableAlignmentForBidi(block,bidi);if(tableAlignment!=='Left'){var tableWidth=0;// If the grid is calculated, we can direclty get the width from the grid.
// Otherwise, calculate the width.
tableWidth=HelperMethods.convertPointToPixel(block.tableHolder.getTotalWidth(0));tableWidth=tableWidth===0?block.tableHolder.tableWidth===0?block.getTableClientWidth(block.getOwnerWidth(false)):block.tableHolder.tableWidth:tableWidth;// Fore resizing table, the tableholder table width taken for updated width. 
// Since, the columns will be cleared if we performed resizing.
if(this.owner.editor&&this.owner.editor.tableResize.currentResizingTable===block&&this.owner.editor.tableResize.resizerPosition===0){tableWidth=HelperMethods.convertPointToPixel(block.tableHolder.tableWidth);}if(tableAlignment==='Center'){tableWidth=block.getTableCellWidth();leftIndent=(this.clientArea.width-tableWidth)/2;}else{leftIndent=this.clientArea.width-tableWidth;}if(bidi){leftIndent=leftIndent-HelperMethods.convertPointToPixel(block.leftIndent);rightIndent=leftIndent;}if(!block.isInsideTable){//leftIndent = (block.tableFormat.horizontalPositionAbs === 'Left') ? block.tableFormat.horizontalPosition : leftIndent;
}this.documentHelper.tableLefts.push(leftIndent);}}width=this.clientArea.width-(leftIndent+HelperMethods.convertPointToPixel(block.rightIndent));this.clientActiveArea.x=this.clientArea.x=this.clientArea.x+(bidi?rightIndent:leftIndent);this.clientActiveArea.width=this.clientArea.width=width>0?width:0;}}else{// Clears table left for table with right or center alignment.
if(block instanceof TableWidget&&!sf.base.isNullOrUndefined(block.tableFormat)){var tableAlignment=this.tableAlignmentForBidi(block,bidi);if(!block.isGridUpdated){block.buildTableColumns();block.isGridUpdated=true;}if(tableAlignment!=='Left'&&this.documentHelper.tableLefts.length>0){leftIndent=this.documentHelper.tableLefts.pop();if(bidi){rightIndent=leftIndent;}}}width=this.clientArea.width+leftIndent+HelperMethods.convertPointToPixel(block.rightIndent);this.clientActiveArea.width=this.clientArea.width=width>0?width:0;this.clientActiveArea.x=this.clientArea.x=this.clientArea.x-(bidi?rightIndent:leftIndent);}this.clientArea=new Rect(this.clientArea.x,this.clientArea.y,this.clientArea.width,this.clientArea.height);this.clientActiveArea=new Rect(this.clientActiveArea.x,this.clientActiveArea.y,this.clientActiveArea.width,this.clientActiveArea.height);};LayoutViewer.prototype.tableAlignmentForBidi=function(block,bidi){var tableAlignment=block.tableFormat.tableAlignment;if(bidi){if(tableAlignment==='Left'){tableAlignment='Right';}else if(tableAlignment==='Right'){tableAlignment='Left';}}return tableAlignment;};LayoutViewer.prototype.cutFromLeft=function(x){if(x<this.clientActiveArea.x){x=this.clientActiveArea.x;}if(x>this.clientActiveArea.right&&this.textWrap){x=this.clientActiveArea.right;}this.clientActiveArea.width=this.clientActiveArea.right>x?this.clientActiveArea.right-x:0;this.clientActiveArea.x=x;};LayoutViewer.prototype.cutFromTop=function(y){if(y<this.clientActiveArea.y){y=this.clientActiveArea.y;}if(y>this.clientActiveArea.bottom){y=this.clientActiveArea.bottom;}this.clientActiveArea.height=this.clientActiveArea.bottom-y;this.clientActiveArea.x=this.clientArea.x;this.clientActiveArea.width=this.clientArea.width;this.clientActiveArea.y=y;};LayoutViewer.prototype.updateClientWidth=function(width){this.clientActiveArea.x-=width;if(this.clientActiveArea.width+width>0){this.clientActiveArea.width+=width;}else{this.clientActiveArea.width=0;}};LayoutViewer.prototype.findFocusedPage=function(currentPoint,updateCurrentPage){var point=new Point(currentPoint.x,currentPoint.y);point.x+=this.documentHelper.viewerContainer.scrollLeft;point.y+=this.documentHelper.viewerContainer.scrollTop;for(var i=0;i<this.documentHelper.pages.length;i++){var page=this.documentHelper.pages[i];var pageTop=(page.boundingRectangle.y-this.pageGap*(i+1))*this.documentHelper.zoomFactor+this.pageGap*(i+1);var pageHeight=page.boundingRectangle.height*this.documentHelper.zoomFactor+this.pageGap;var pageLeft=page.boundingRectangle.x;var pageRight=void 0;if(this instanceof PageLayoutViewer){pageRight=(page.boundingRectangle.right-pageLeft)*this.documentHelper.zoomFactor+pageLeft;}else{pageRight=page.boundingRectangle.right+pageLeft;}if(pageTop<=point.y&&pageTop+pageHeight>=point.y){if(updateCurrentPage){this.documentHelper.currentPage=page;}point.y=(point.y-pageTop)/this.documentHelper.zoomFactor;if(point.x>pageRight){point.x=page.boundingRectangle.right;}else if(point.x<pageLeft){point.x=0;}else{point.x=(point.x-pageLeft)/this.documentHelper.zoomFactor;}return point;}}return point;};LayoutViewer.prototype.getPageHeightAndWidth=function(height,width,viewerWidth,viewerHeight){height=0;for(var i=0;i<this.documentHelper.pages.length;i++){height=height+this.documentHelper.pages[i].boundingRectangle.height;}width=0;for(var i=0;i<this.documentHelper.pages.length;i++){if(width<this.documentHelper.pages[i].boundingRectangle.width){width=this.documentHelper.pages[i].boundingRectangle.width;}}//this.documentHelper.visibleBoundsIn = new Rect(0, 0, width, height);
viewerWidth=this.documentHelper.visibleBounds.width;viewerHeight=this.documentHelper.visibleBounds.height;return{'height':height,'width':width,'viewerWidth':viewerWidth,'viewerHeight':viewerHeight};};LayoutViewer.prototype.renderVisiblePages=function(){if(sf.base.isNullOrUndefined(this.visiblePages)||this.visiblePages.length<1){return;}this.documentHelper.clearContent();for(var i=0;i<this.visiblePages.length;i++){var page=this.visiblePages[i];var width=page.boundingRectangle.width*this.documentHelper.zoomFactor;var height=page.boundingRectangle.height*this.documentHelper.zoomFactor;var x=page.boundingRectangle.x;var y=(page.boundingRectangle.y-this.pageGap*(i+1))*this.documentHelper.zoomFactor+this.pageGap*(i+1);this.owner.viewer.renderPage(page,x,y,width,height);}};/* eslint-disable  */LayoutViewer.prototype.handleZoom=function(){var prevScaleFactor=this.documentHelper.preZoomFactor;var page=null;var verticalHeight=0;var scrollToPosition=false;if(this.documentHelper.selection&&sf.base.isNullOrUndefined(this.documentHelper.zoomX&&sf.base.isNullOrUndefined(this.documentHelper.zoomY))){var x=0;var y=0;var endPage=this.documentHelper.selection.getPage(this.documentHelper.selection.end.currentWidget.paragraph);x=(this.documentHelper.visibleBounds.width-endPage.boundingRectangle.width*prevScaleFactor)/2;if(x<30){x=30;}y=endPage.boundingRectangle.y*prevScaleFactor+(this.documentHelper.pages.indexOf(endPage)+1)*this.pageGap*(1-prevScaleFactor);var caretInfo=this.documentHelper.selection.updateCaretSize(this.owner.selection.end,true);var topMargin=caretInfo.topMargin;var caretHeight=caretInfo.height;x+=this.documentHelper.selection.end.location.x*prevScaleFactor;y+=(this.documentHelper.selection.end.location.y+topMargin)*prevScaleFactor;if(x>=this.containerLeft&&x<=this.documentHelper.visibleBounds.width&&y>=this.containerTop&&y<=this.containerTop+this.documentHelper.visibleBounds.height){scrollToPosition=true;}}for(var i=0;i<this.documentHelper.pages.length;i++){verticalHeight=verticalHeight+this.documentHelper.pages[i].boundingRectangle.height;}var horizontalWidth=0;for(var i=0;i<this.documentHelper.pages.length;i++){if(horizontalWidth<this.documentHelper.pages[i].boundingRectangle.width){horizontalWidth=this.documentHelper.pages[i].boundingRectangle.width;}}var height=verticalHeight*this.documentHelper.zoomFactor+(this.documentHelper.pages.length+1)*this.pageGap*(1-this.documentHelper.zoomFactor)-this.documentHelper.visibleBounds.height;var horWidth=horizontalWidth*this.documentHelper.zoomFactor-this.documentHelper.visibleBounds.width;if(this.documentHelper.visibleBounds.width-horizontalWidth*this.documentHelper.zoomFactor<60){horWidth+=60;}//Update Vertical Scroll bar
if(height>0){var value=this.containerTop;if(this.visiblePages.length>0){page=this.visiblePages[0];var prevPageTop=(page.boundingRectangle.y-(page.index+1)*this.pageGap)*prevScaleFactor+(page.index+1)*this.pageGap;var zoomY=this.documentHelper.zoomY;if(sf.base.isNullOrUndefined){zoomY=this.documentHelper.visibleBounds.height/2;}var prevY=value+zoomY;while(prevY>prevPageTop+page.boundingRectangle.height*prevScaleFactor){var pageIndex=page.index+1;if(pageIndex===this.documentHelper.pages.length){break;}page=this.documentHelper.pages[pageIndex];prevPageTop=(page.boundingRectangle.y-(page.index+1)*this.pageGap)*prevScaleFactor+(page.index+1)*this.pageGap;}var currentY=(page.boundingRectangle.y-(page.index+1)*this.pageGap)*this.documentHelper.zoomFactor+(page.index+1)*this.pageGap+(prevY-prevPageTop<0?prevY-prevPageTop:(prevY-prevPageTop)*(this.documentHelper.zoomFactor/prevScaleFactor));value=currentY-zoomY;zoomY=this.documentHelper.visibleBounds.height/2;}this.documentHelper.viewerContainer.scrollTop=value;}else{this.documentHelper.viewerContainer.scrollTop=0;}// update Horizontal Scroll Bar
if(horWidth>0){var value=this.containerLeft;if(this.visiblePages.length>0){if(page===null){page=this.visiblePages[0];}var zoomX=this.documentHelper.zoomX;if(sf.base.isNullOrUndefined(zoomX)){zoomX=this.documentHelper.visibleBounds.width/2;}var prevValue=page.boundingRectangle.width*prevScaleFactor/page.boundingRectangle.width;var prevX=value+zoomX;var currentX=page.boundingRectangle.x+(prevX-page.boundingRectangle.x<0?prevX-page.boundingRectangle.x:(prevX-page.boundingRectangle.x)*(this.documentHelper.zoomFactor/prevValue));value=currentX-zoomX;zoomX=this.documentHelper.visibleBounds.width/2;}this.documentHelper.viewerContainer.scrollLeft=value;}else{this.documentHelper.viewerContainer.scrollLeft=0;}this.updateScrollBars();if(scrollToPosition){this.documentHelper.scrollToPosition(this.documentHelper.selection.start,this.documentHelper.selection.end);}if(this instanceof WebLayoutViewer){this.owner.editorModule.layoutWholeDocument();}};LayoutViewer.prototype.updateCanvasWidthAndHeight=function(viewerWidth,viewerHeight,containerHeight,containerWidth,width,height){if(this instanceof PageLayoutViewer){if(this.documentHelper.visibleBounds.width!==this.documentHelper.viewerContainer.clientWidth){viewerWidth-=this.documentHelper.visibleBounds.width-this.documentHelper.viewerContainer.clientWidth;}else if(containerHeight>viewerHeight){viewerWidth-=this.documentHelper.viewerContainer.offsetWidth-this.documentHelper.viewerContainer.clientWidth;}}else{if(containerHeight>viewerHeight){viewerWidth-=this.documentHelper.scrollbarWidth;containerWidth-=this.documentHelper.scrollbarWidth;}}if(containerWidth>viewerWidth){viewerHeight-=this.documentHelper.scrollbarWidth;}width=containerWidth>viewerWidth?containerWidth:viewerWidth;height=containerHeight>viewerHeight?containerHeight:viewerHeight;if(parseInt(this.documentHelper.pageContainer.style.width.replace('px',''),10)!==width||parseInt(this.documentHelper.pageContainer.style.height.replace('px',''),10)!==width){this.documentHelper.pageContainer.style.width=width.toString()+'px';this.documentHelper.pageContainer.style.height=height.toString()+'px';}// if (!isNullOrUndefined(this.selection) && !this.selection.isEmpty) {
//     this.selectionContext.clearRect(0, 0, this.selectionCanvas.width, this.selectionCanvas.height);
var displayPixelRatio=Math.max(1,window.devicePixelRatio||1);if(this.documentHelper.containerCanvas.width!==Math.floor(viewerWidth*displayPixelRatio)||this.documentHelper.containerCanvas.height!==Math.floor(viewerHeight*displayPixelRatio)){this.documentHelper.containerCanvas.width=viewerWidth*displayPixelRatio;this.documentHelper.containerCanvas.height=viewerHeight*displayPixelRatio;this.documentHelper.containerCanvas.style.width=viewerWidth+'px';this.documentHelper.containerCanvas.style.height=viewerHeight+'px';this.documentHelper.containerContext.scale(displayPixelRatio,displayPixelRatio);this.documentHelper.selectionCanvas.width=viewerWidth*displayPixelRatio;this.documentHelper.selectionCanvas.height=viewerHeight*displayPixelRatio;this.documentHelper.selectionCanvas.style.width=viewerWidth+'px';this.documentHelper.selectionCanvas.style.height=viewerHeight+'px';this.documentHelper.selectionContext.scale(displayPixelRatio,displayPixelRatio);}return{'height':height,'width':width,'viewerWidth':viewerWidth,'viewerHeight':viewerHeight,'containerHeight':containerHeight,'containerWidth':containerWidth};};LayoutViewer.prototype.updateScrollBarPosition=function(containerWidth,containerHeight,viewerWidth,viewerHeight,width,height){this.owner.viewer.containerTop=this.documentHelper.viewerContainer.scrollTop;this.documentHelper.containerCanvas.style.position='absolute';this.documentHelper.containerCanvas.style.top=this.owner.viewer.containerTop.toString()+'px';this.documentHelper.selectionCanvas.style.position='absolute';this.documentHelper.selectionCanvas.style.top=this.owner.viewer.containerTop.toString()+'px';this.owner.viewer.containerLeft=this.documentHelper.viewerContainer.scrollLeft;this.documentHelper.containerCanvas.style.left=this.owner.viewer.containerLeft+'px';this.documentHelper.selectionCanvas.style.left=this.owner.viewer.containerLeft+'px';};LayoutViewer.prototype.destroy=function(){this.clientArea=undefined;this.clientActiveArea=undefined;};return LayoutViewer;}();/**
 * @private
 */var PageLayoutViewer=/** @class */function(_super){__extends$2(PageLayoutViewer,_super);/**
     * Initialize the constructor of PageLayoutViewer
     */function PageLayoutViewer(owner){var _this=_super.call(this,owner)||this;_this.pageLeft=30;// if (isNullOrUndefined(owner) || isNullOrUndefined(owner.element)) {
//     return;
// }
_this.owner=owner;return _this;}Object.defineProperty(PageLayoutViewer.prototype,"pageGap",{/**
         * @private
         */get:function get(){return this.owner.pageGap;},enumerable:true,configurable:true});Object.defineProperty(PageLayoutViewer.prototype,"documentHelper",{get:function get(){return this.owner.documentHelper;},enumerable:true,configurable:true});PageLayoutViewer.prototype.createNewPage=function(section,index){var viewer=this;var yPos=this.pageGap;if(this.documentHelper.pages.length>0){yPos=this.documentHelper.pages[this.documentHelper.pages.length-1].boundingRectangle.bottom+this.pageGap;}var page=new Page(this.documentHelper);this.updatePageBoundingRectangle(section,page,yPos);if(sf.base.isNullOrUndefined(index)){this.documentHelper.pages.push(page);}else{this.documentHelper.pages.splice(index,0,page);}this.updateClientArea(section.sectionFormat,page);page.bodyWidgets.push(section);page.bodyWidgets[page.bodyWidgets.length-1].page=page;this.documentHelper.layout.layoutHeaderFooter(section,viewer,page);this.updateClientArea(section.sectionFormat,page);this.documentHelper.layout.footnoteHeight=0;return page;};PageLayoutViewer.prototype.updatePageBoundingRectangle=function(section,page,yPosition){//page.viewer = this;
var pageWidth=!sf.base.isNullOrUndefined(section.sectionFormat)?HelperMethods.convertPointToPixel(section.sectionFormat.pageWidth):816;var pageHeight=!sf.base.isNullOrUndefined(section.sectionFormat)?HelperMethods.convertPointToPixel(section.sectionFormat.pageHeight):1056;var xPos=(this.documentHelper.visibleBounds.width-pageWidth*this.documentHelper.zoomFactor)/2;if(xPos<this.pageLeft){xPos=this.pageLeft;}page.boundingRectangle=new Rect(xPos,yPosition,pageWidth,pageHeight);};PageLayoutViewer.prototype.onPageFitTypeChanged=function(pageFitType){var width=this.documentHelper.visibleBounds.width;var height=this.documentHelper.visibleBounds.height;var section=this.visiblePages[0].bodyWidgets[0];var pageWidth=HelperMethods.convertPointToPixel(section.sectionFormat.pageWidth);var pageHeight=HelperMethods.convertPointToPixel(section.sectionFormat.pageHeight);switch(pageFitType){case'FitOnePage':if(height>0&&pageHeight>0){var zoomFactor=(this.documentHelper.visibleBounds.height-2*this.pageGap-(this.pageGap-2))/pageHeight;if(zoomFactor===this.documentHelper.zoomFactor){if(!sf.base.isNullOrUndefined(this.owner.selection)&&!sf.base.isNullOrUndefined(this.owner.selection.start)&&!sf.base.isNullOrUndefined(this.owner.selection.end)){this.documentHelper.scrollToPosition(this.owner.selection.start,this.owner.selection.end);}}else{this.documentHelper.zoomFactor=zoomFactor;}}break;case'FitPageWidth':if(width>0&&pageWidth>0){this.documentHelper.zoomFactor=(this.documentHelper.visibleBounds.width-80)/pageWidth;}break;default:this.documentHelper.zoomFactor=100/100;break;}};PageLayoutViewer.prototype.getCurrentPageHeaderFooter=function(section,isHeader){return this.getCurrentHeaderFooter(this.getHeaderFooterType(section,isHeader),section.index);};PageLayoutViewer.prototype.getHeaderFooterType=function(section,isHeader){var type;type=isHeader?'OddHeader':'OddFooter';var page=section.page;if(section.sectionFormat.differentFirstPage&&(sf.base.isNullOrUndefined(page.previousPage)||page.sectionIndex!==page.previousPage.sectionIndex)){type=isHeader?'FirstPageHeader':'FirstPageFooter';}else if(section.sectionFormat.differentOddAndEvenPages&&this.documentHelper.pages.length%2===0){type=isHeader?'EvenHeader':'EvenFooter';}return type;};PageLayoutViewer.prototype.getCurrentHeaderFooter=function(type,sectionIndex){if(this.documentHelper.headersFooters[sectionIndex]){var index=this.getHeaderFooter(type);var headerFooter=this.documentHelper.headersFooters[sectionIndex][index];if(!headerFooter){var currentSecIndex=sectionIndex>0?sectionIndex-1:sectionIndex;while(!headerFooter&&currentSecIndex!==-1&&this.documentHelper.headersFooters[currentSecIndex][index]){headerFooter=this.documentHelper.headersFooters[currentSecIndex][index];currentSecIndex--;}if(!headerFooter){headerFooter=this.createHeaderFooterWidget(type);headerFooter.isEmpty=true;}this.documentHelper.headersFooters[sectionIndex][index]=headerFooter;}return headerFooter;}else if(sectionIndex>0){return this.getCurrentHeaderFooter(type,sectionIndex-1);}return undefined;};PageLayoutViewer.prototype.createHeaderFooterWidget=function(type){var headerFooter=new HeaderFooterWidget(type);var paragraph=new ParagraphWidget();paragraph.childWidgets.push(new LineWidget(paragraph));return headerFooter;};PageLayoutViewer.prototype.getHeaderFooter=function(type){switch(type){case'OddHeader':return 0;case'OddFooter':return 1;case'EvenHeader':return 2;case'EvenFooter':return 3;case'FirstPageHeader':return 4;case'FirstPageFooter':return 5;}};PageLayoutViewer.prototype.updateHFClientArea=function(sectionFormat,isHeader){var width=HelperMethods.convertPointToPixel(sectionFormat.pageWidth-sectionFormat.leftMargin-sectionFormat.rightMargin);if(width<0){width=0;}if(isHeader){this.clientArea=new Rect(HelperMethods.convertPointToPixel(sectionFormat.leftMargin),HelperMethods.convertPointToPixel(sectionFormat.headerDistance),width,Number.POSITIVE_INFINITY);}else{this.clientArea=new Rect(HelperMethods.convertPointToPixel(sectionFormat.leftMargin),HelperMethods.convertPointToPixel(sectionFormat.pageHeight-sectionFormat.footerDistance),width,Number.POSITIVE_INFINITY);}this.clientActiveArea=new Rect(this.clientArea.x,this.clientArea.y,this.clientArea.width,this.clientArea.height);};PageLayoutViewer.prototype.updateHeaderFooterClientAreaWithTop=function(sectionFormat,isHeader,page){this.updateHFClientArea(sectionFormat,isHeader);if(!isHeader){if(page.footerWidget.y<this.clientActiveArea.y){this.clientActiveArea.y=page.footerWidget.y;this.clientActiveArea.height=Number.POSITIVE_INFINITY;}}};PageLayoutViewer.prototype.updateFootnoteClientArea=function(sectionFormat,footnote,footNoteType,para){var width=HelperMethods.convertPointToPixel(sectionFormat.pageWidth-sectionFormat.leftMargin-sectionFormat.rightMargin);this.clientArea=new Rect(HelperMethods.convertPointToPixel(sectionFormat.leftMargin),HelperMethods.convertPointToPixel(sectionFormat.pageHeight-sectionFormat.bottomMargin)-footnote.height,width,footnote.height);this.clientActiveArea=new Rect(this.clientArea.x,this.clientArea.y,this.clientArea.width,footnote.height);};PageLayoutViewer.prototype.scrollToPage=function(pageIndex){var top=0;for(var i=0;i<this.documentHelper.pages.length;i++){top=this.documentHelper.pages[i].boundingRectangle.y-this.pageGap/2;if(i===pageIndex){break;}}this.documentHelper.viewerContainer.scrollTop=top;this.updateScrollBars();};PageLayoutViewer.prototype.updateScrollBars=function(){var updatePositionObj;updatePositionObj=this.getPageHeightAndWidth(0,0,0,0);var containerWidth=updatePositionObj.width*this.documentHelper.zoomFactor+this.pageLeft*2;var containerHeight=updatePositionObj.height*this.documentHelper.zoomFactor+(this.documentHelper.pages.length+1)*this.pageGap;var updateObj;updateObj=this.updateCanvasWidthAndHeight(updatePositionObj.viewerWidth,updatePositionObj.viewerHeight,containerHeight,containerWidth,updatePositionObj.width,updatePositionObj.height);containerHeight=updateObj.containerHeight;containerWidth=updateObj.containerWidth;this.documentHelper.containerContext.globalAlpha=1;this.documentHelper.selectionContext.globalAlpha=0.4;for(var i=0;i<this.documentHelper.pages.length;i++){var left=(updateObj.width-this.documentHelper.pages[i].boundingRectangle.width*this.documentHelper.zoomFactor)/2;if(left>this.pageLeft){this.documentHelper.pages[i].boundingRectangle=new Rect(left,this.documentHelper.pages[i].boundingRectangle.y,this.documentHelper.pages[i].boundingRectangle.width,this.documentHelper.pages[i].boundingRectangle.height);}else{this.documentHelper.pages[i].boundingRectangle=new Rect(this.pageLeft,this.documentHelper.pages[i].boundingRectangle.y,this.documentHelper.pages[i].boundingRectangle.width,this.documentHelper.pages[i].boundingRectangle.height);}}this.updateScrollBarPosition(containerWidth,containerHeight,updateObj.viewerWidth,updateObj.viewerHeight,updateObj.width,updateObj.height);this.updateVisiblePages();this.documentHelper.isScrollToSpellCheck=false;};PageLayoutViewer.prototype.updateVisiblePages=function(){// Clears the container first.
this.visiblePages=[];var height=this.documentHelper.visibleBounds.height;var vertical=this.documentHelper.viewerContainer.scrollTop;for(var i=0;i<this.documentHelper.pages.length;i++){var page=this.documentHelper.pages[i];var y=(page.boundingRectangle.y-this.pageGap*(i+1))*this.documentHelper.zoomFactor+this.pageGap*(i+1);var pageH=page.boundingRectangle.height*this.documentHelper.zoomFactor;var left=page.boundingRectangle.x;var isTopFit=y>=vertical&&y<=vertical+height;var isBottomFit=y+pageH>=vertical&&y+pageH<=vertical+height;var isMiddleFit=y<=vertical&&y+pageH>=vertical+height;//UI Virtualization
if(isTopFit||isBottomFit||isMiddleFit){this.addVisiblePage(page,left,y);}}};PageLayoutViewer.prototype.addVisiblePage=function(page,x,y){var _this=this;var width=page.boundingRectangle.width*this.documentHelper.zoomFactor;var height=page.boundingRectangle.height*this.documentHelper.zoomFactor;if(this.owner.enableImageResizerMode&&this.owner.imageResizerModule.currentPage!==undefined&&this.owner.imageResizerModule.currentPage===page&&this.owner.imageResizerModule.isImageResizerVisible){this.owner.imageResizerModule.setImageResizerPositions(x,y,width,height);}this.visiblePages.push(page);if(this.owner.isSpellCheck&&this.owner.spellChecker.enableOptimizedSpellCheck&&(this.documentHelper.triggerElementsOnLoading||this.documentHelper.isScrollHandler)&&this.documentHelper.cachedPages.indexOf(page.index)<0){page.allowNextPageRendering=false;this.documentHelper.cachedPages.push(page.index);var content=this.owner.spellChecker.getPageContent(page);if(content.trim().length>0){/* eslint-disable @typescript-eslint/no-explicit-any */this.owner.spellChecker.callSpellChecker(this.owner.spellChecker.languageID,content,true,false,false,true).then(function(data){/* eslint-disable @typescript-eslint/no-explicit-any */var jsonObject=JSON.parse(data);_this.owner.spellChecker.updateUniqueWords(jsonObject.SpellCollection);page.allowNextPageRendering=true;_this.documentHelper.triggerSpellCheck=true;_this.renderPage(page,x,y,width,height);_this.documentHelper.triggerSpellCheck=false;_this.documentHelper.triggerElementsOnLoading=false;});}else{this.renderPage(page,x,y,width,height);}}else{this.renderPage(page,x,y,width,height);}};PageLayoutViewer.prototype.renderPage=function(page,x,y,width,height){this.documentHelper.render.renderWidgets(page,x-this.owner.viewer.containerLeft,y-this.owner.viewer.containerTop,width,height);};return PageLayoutViewer;}(LayoutViewer);var WebLayoutViewer=/** @class */function(_super){__extends$2(WebLayoutViewer,_super);function WebLayoutViewer(owner){var _this=_super.call(this,owner)||this;/**
         * @private
         */_this.visiblePages=[];/* if (isNullOrUndefined(owner) || isNullOrUndefined(owner.element)) {
             return;
         }*/_this.owner=owner;return _this;}Object.defineProperty(WebLayoutViewer.prototype,"documentHelper",{get:function get(){return this.owner.documentHelper;},enumerable:true,configurable:true});Object.defineProperty(WebLayoutViewer.prototype,"pageGap",{/**
         * @private
         */get:function get(){return 0;},enumerable:true,configurable:true});/**
     * Creates new page.
     * @private
     */WebLayoutViewer.prototype.createNewPage=function(section,index){var page;var yPos=0;var x=10;if(this.documentHelper.pages.length>0){yPos=this.documentHelper.pages[this.documentHelper.pages.length-1].boundingRectangle.bottom;}page=new Page(this.documentHelper);if(this.documentHelper.pages.length===0){page.boundingRectangle=new Rect(x,yPos,this.documentHelper.visibleBounds.width,this.documentHelper.visibleBounds.height);}else{page.boundingRectangle=new Rect(x,yPos-20,this.documentHelper.visibleBounds.width,this.documentHelper.visibleBounds.height);}this.documentHelper.pages.push(page);this.updateClientArea(undefined,page);page.bodyWidgets.push(section);page.bodyWidgets[page.bodyWidgets.length-1].page=page;return page;};WebLayoutViewer.prototype.onPageFitTypeChanged=function(pageFitType){this.documentHelper.zoomFactor=1;};WebLayoutViewer.prototype.scrollToPage=function(pageIndex){this.updateScrollBars();};WebLayoutViewer.prototype.getContentHeight=function(){var height=0;for(var i=0;i<this.documentHelper.pages.length;i++){var page=this.documentHelper.pages[i];if(i===0){height+=this.padding.top;page.boundingRectangle.y=this.padding.top;}else{page.boundingRectangle.y=this.documentHelper.pages[i-1].boundingRectangle.bottom;}page.boundingRectangle.height=page.bodyWidgets[0].height;height+=page.bodyWidgets[0].height;if(i===this.documentHelper.pages.length-1){height+=this.padding.bottom;}}return height;};/**
     * @private
     */WebLayoutViewer.prototype.getContentWidth=function(){var width=this.documentHelper.visibleBounds.width;var currentWidth=width;for(var i=0;i<this.documentHelper.pages.length;i++){var page=this.documentHelper.pages[i];for(var j=0;j<page.bodyWidgets[0].childWidgets.length;j++){if(page.bodyWidgets[0].childWidgets[j]instanceof TableWidget){var tableWidget=page.bodyWidgets[0].childWidgets[j];var tableWidth=HelperMethods.convertPointToPixel(tableWidget.getTableWidth())*this.documentHelper.zoomFactor+this.padding.left*4+this.padding.right*4+page.boundingRectangle.x;if(currentWidth<tableWidth){width=tableWidth;currentWidth=tableWidth;}}}page.boundingRectangle.width=width;}return width;};WebLayoutViewer.prototype.updateScrollBars=function(){var updatePositionObj;updatePositionObj=this.getPageHeightAndWidth(0,0,0,0);var containerWidth=this.getContentWidth()*this.documentHelper.zoomFactor+this.padding.left+this.padding.right;var containerHeight=this.getContentHeight()*this.documentHelper.zoomFactor+this.padding.top+this.padding.bottom;var updateObj;updateObj=this.updateCanvasWidthAndHeight(updatePositionObj.viewerWidth,updatePositionObj.viewerHeight,containerHeight,containerWidth,updatePositionObj.width,updatePositionObj.height);this.documentHelper.containerContext.globalAlpha=1;this.documentHelper.selectionContext.globalAlpha=0.4;this.updateScrollBarPosition(containerWidth,containerHeight,updateObj.viewerWidth,updateObj.viewerHeight,updateObj.width,updateObj.height);this.updateVisiblePages();this.documentHelper.isScrollToSpellCheck=false;};WebLayoutViewer.prototype.updateVisiblePages=function(){this.visiblePages=[];var page;var y;var height=this.documentHelper.visibleBounds.height;var vertical=this.documentHelper.viewerContainer.scrollTop;for(var i=0;i<this.documentHelper.pages.length;i++){page=this.documentHelper.pages[i];y=page.boundingRectangle.y*this.documentHelper.zoomFactor;var pageH=page.boundingRectangle.height*this.documentHelper.zoomFactor;var isTopFit=y>=vertical&&y<=vertical+height;var isBottomFit=y+pageH>=vertical&&y+pageH<=vertical+height;var isMiddleFit=y<=vertical&&y+pageH>=vertical+height;//UI Virtualization
if(isTopFit||isBottomFit||isMiddleFit){this.addVisiblePage(page,this.padding.left,y);}}};WebLayoutViewer.prototype.addVisiblePage=function(page,x,y){var _this=this;var width=this.getContentWidth();var height=this.getContentHeight()*this.documentHelper.zoomFactor+this.padding.top+this.padding.bottom;if(this.owner.enableImageResizerMode&&this.owner.imageResizerModule.currentPage!==undefined&&this.owner.imageResizerModule.currentPage===page&&this.owner.imageResizerModule.isImageResizerVisible){this.owner.imageResizerModule.setImageResizerPositions(x,y,width,height);}this.visiblePages.push(page);if(this.documentHelper.owner.isSpellCheck&&this.documentHelper.owner.spellChecker.enableOptimizedSpellCheck&&(this.owner.documentHelper.triggerElementsOnLoading||this.owner.documentHelper.isScrollHandler)&&this.documentHelper.cachedPages.indexOf(page.index)<0){page.allowNextPageRendering=false;this.owner.documentHelper.cachedPages.push(page.index);var contentlen=this.documentHelper.owner.spellChecker.getPageContent(page);if(contentlen.trim().length>0){/* eslint-disable @typescript-eslint/no-explicit-any */this.owner.spellChecker.callSpellChecker(this.owner.spellChecker.languageID,contentlen,true,false,false,true).then(function(data){/* eslint-disable @typescript-eslint/no-explicit-any */var jsonObj=JSON.parse(data);_this.owner.spellChecker.updateUniqueWords(jsonObj.SpellCollection);page.allowNextPageRendering=true;_this.owner.documentHelper.triggerSpellCheck=true;_this.renderPage(page,x,y,width,height);_this.owner.documentHelper.triggerSpellCheck=false;_this.owner.documentHelper.triggerElementsOnLoading=false;});}else{this.renderPage(page,x,y,width,height);}}else{this.renderPage(page,x,y,width,height);}};/**
     * @private
     */WebLayoutViewer.prototype.renderPage=function(page,x,y,width,height){this.documentHelper.render.renderWidgets(page,x-this.owner.viewer.containerLeft,y-this.owner.viewer.containerTop,width,height);};return WebLayoutViewer;}(LayoutViewer);var __extends$1=undefined&&undefined.__extends||function(){var _extendStatics2=function extendStatics(d,b){_extendStatics2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;}||function(d,b){for(var p in b){if(b.hasOwnProperty(p))d[p]=b[p];}};return _extendStatics2(d,b);};return function(d,b){_extendStatics2(d,b);function __(){this.constructor=d;}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};}();/**
 * @private
 */var Rect=/** @class */function(){function Rect(x,y,width,height){this.x=x;this.y=y;this.width=width;this.height=height;}Object.defineProperty(Rect.prototype,"right",{get:function get(){return this.x+this.width;},enumerable:true,configurable:true});Object.defineProperty(Rect.prototype,"bottom",{get:function get(){return this.y+this.height;},enumerable:true,configurable:true});/**
     * @private
     */Rect.prototype.isIntersecting=function(currentBound){if(currentBound.y>this.bottom||this.y>currentBound.bottom||currentBound.x>this.right||this.x>currentBound.right){return false;}return true;};/**
     * @private
     */Rect.prototype.clone=function(){return new Rect(this.x,this.y,this.width,this.height);};return Rect;}();/**
 * @private
 */var Padding=/** @class */function(){function Padding(right,left,top,bottom){this.right=10;this.left=10;this.top=10;this.bottom=10;this.right=right;this.left=left;this.top=top;this.bottom=bottom;}return Padding;}();/**
 * @private
 */var Margin=/** @class */function(){function Margin(leftMargin,topMargin,rightMargin,bottomMargin){this.left=leftMargin;this.top=topMargin;this.right=rightMargin;this.bottom=bottomMargin;}Margin.prototype.clone=function(){return new Margin(this.left,this.top,this.right,this.bottom);};Margin.prototype.destroy=function(){this.left=undefined;this.right=undefined;this.top=undefined;this.bottom=undefined;};return Margin;}();/**
 * @private
 */var Widget=/** @class */function(){function Widget(){/**
         * @private
         */this.childWidgets=[];/**
         * @private
         */this.x=0;/**
         * @private
         */this.y=0;/**
         * @private
         */this.width=0;/**
         * @private
         */this.height=0;/**
         * @private
         */this.index=0;}Object.defineProperty(Widget.prototype,"indexInOwner",{get:function get(){if(this instanceof BodyWidget&&this.page){return this.page.bodyWidgets.indexOf(this);}else if(this.containerWidget&&this.containerWidget.childWidgets){return this.containerWidget.childWidgets.indexOf(this);}else if(this instanceof FootNoteWidget){return 0;}return-1;},enumerable:true,configurable:true});Object.defineProperty(Widget.prototype,"firstChild",{get:function get(){return this.childWidgets.length>0?this.childWidgets[0]:undefined;},enumerable:true,configurable:true});Object.defineProperty(Widget.prototype,"lastChild",{get:function get(){if(this.childWidgets){return this.childWidgets.length>0?this.childWidgets[this.childWidgets.length-1]:undefined;}return undefined;},enumerable:true,configurable:true});Object.defineProperty(Widget.prototype,"previousWidget",{get:function get(){var widget=this;var index=this.indexInOwner;if(widget instanceof BodyWidget){widget=index>0?widget.page.bodyWidgets[index-1]:undefined;}else{widget=index>0?widget.containerWidget.childWidgets[index-1]:undefined;}return widget;},enumerable:true,configurable:true});Object.defineProperty(Widget.prototype,"nextWidget",{get:function get(){var widget=this;var index=this.indexInOwner;if(index===-1){return undefined;}if(widget instanceof BodyWidget){widget=index<widget.page.bodyWidgets.length-1?widget.page.bodyWidgets[index+1]:undefined;}else{widget=index<widget.containerWidget.childWidgets.length-1?widget.containerWidget.childWidgets[index+1]:undefined;}return widget;},enumerable:true,configurable:true});Object.defineProperty(Widget.prototype,"previousRenderedWidget",{get:function get(){var widget=this;var index=this.indexInOwner;if(index<0){return undefined;}if(widget instanceof BodyWidget){if(index>0){widget=widget.page.bodyWidgets[index-1];}else{var page=widget.page.previousPage;widget=page&&page.bodyWidgets.length>0?page.bodyWidgets[page.bodyWidgets.length-1]:undefined;}}else if(widget instanceof FootNoteWidget){var page=widget.page;while(page.previousPage){page=page.previousPage;widget=page.footnoteWidget;if(!sf.base.isNullOrUndefined(widget)){break;}}}else{if(index>0){widget=widget.containerWidget.childWidgets[index-1];}else{var previousContainer=undefined;if(widget.containerWidget instanceof TableCellWidget){previousContainer=widget.containerWidget.getPreviousSplitWidget();}else if(!(widget.containerWidget instanceof TableRowWidget||widget.containerWidget instanceof HeaderFooterWidget)){// Since cells are lay outed left to right, we should not navigate to previous row.
previousContainer=widget.containerWidget.previousRenderedWidget;}while(previousContainer&&previousContainer.childWidgets.length===0){previousContainer=previousContainer.previousRenderedWidget;if(sf.base.isNullOrUndefined(previousContainer)){break;}}widget=previousContainer&&previousContainer.constructor===widget.containerWidget.constructor?previousContainer.lastChild:undefined;}}return widget;},enumerable:true,configurable:true});Object.defineProperty(Widget.prototype,"nextRenderedWidget",{get:function get(){var widget=this;var index=this.indexInOwner;if(index<0){return undefined;}if(widget instanceof BodyWidget){if(index<widget.page.bodyWidgets.length-1){widget=widget.page.bodyWidgets[index+1];}else if(widget.page.allowNextPageRendering){var page=widget.page.nextPage;widget=page&&page.bodyWidgets.length>0?page.bodyWidgets[0]:undefined;}else{widget=undefined;}}else if(widget instanceof FootNoteWidget){var page=widget.page;while(page.allowNextPageRendering&&page.nextPage){page=page.nextPage;widget=page.footnoteWidget;if(!sf.base.isNullOrUndefined(widget)){break;}}}else{if(index<widget.containerWidget.childWidgets.length-1){widget=widget.containerWidget.childWidgets[index+1];}else{var nextContainer=undefined;if(widget.containerWidget instanceof TableCellWidget){nextContainer=widget.containerWidget.getNextSplitWidget();}else if(!(widget.containerWidget instanceof TableRowWidget||widget.containerWidget instanceof HeaderFooterWidget||widget.containerWidget instanceof FootNoteWidget)){// Since cells are lay outed left to right, we should not navigate to next row.
nextContainer=widget.containerWidget.nextRenderedWidget;}while(nextContainer&&nextContainer.childWidgets.length===0&&!(nextContainer instanceof TableCellWidget)){nextContainer=nextContainer.nextRenderedWidget;if(sf.base.isNullOrUndefined(nextContainer)){break;}}widget=nextContainer&&nextContainer.constructor===widget.containerWidget.constructor?nextContainer.firstChild:undefined;}}return widget;},enumerable:true,configurable:true});Object.defineProperty(Widget.prototype,"previousSplitWidget",{get:function get(){var widget=this;if(widget instanceof TableCellWidget){return widget.getPreviousSplitWidget();}else{var previous=widget.previousRenderedWidget;if(widget instanceof BodyWidget&&previous instanceof BodyWidget&&widget.equals(previous)){return previous;}else if(previous instanceof BlockWidget&&widget.index===previous.index&&widget.equals(previous)){return previous;}}return undefined;},enumerable:true,configurable:true});Object.defineProperty(Widget.prototype,"nextSplitWidget",{get:function get(){var widget=this;if(widget instanceof TableCellWidget){return widget.getNextSplitWidget();}else{var next=widget.nextRenderedWidget;if(widget instanceof BodyWidget&&next instanceof BodyWidget&&widget.equals(next)){return next;}else if(next instanceof BlockWidget&&widget.index===next.index&&widget.equals(next)){return next;}}return undefined;},enumerable:true,configurable:true});Widget.prototype.getPreviousSplitWidgets=function(){var widgets=[];var widget=this.previousSplitWidget;while(widget){widgets.unshift(widget);widget=widget.previousSplitWidget;}return widgets;};Widget.prototype.getSplitWidgets=function(){var widgets=this.getPreviousSplitWidgets();var widget=this;while(widget){widgets.push(widget);widget=widget.nextSplitWidget;}return widgets;};Widget.prototype.combineWidget=function(viewer){var root=this;var widgets=this.getSplitWidgets();if(widgets.length>1){root=widgets.shift();while(widgets.length>0){var splitWidget=widgets.shift();root.combine(splitWidget,viewer);}}if(root instanceof TableWidget){root.combineRows(viewer);}return root;};Widget.prototype.combine=function(widget,viewer){if(widget.childWidgets.length>0){var lastChild=this.lastChild;if(lastChild instanceof TableWidget){lastChild.combineWidget(viewer);}else{var firstChild=widget.firstChild;if(!(widget instanceof TableWidget)&&lastChild instanceof Widget&&firstChild instanceof Widget&&lastChild.index===firstChild.index){lastChild.combine(widget.childWidgets.shift(),viewer);}}this.addWidgets(widget.childWidgets);widget.childWidgets=[];}widget.destroyInternal(viewer);};Widget.prototype.addWidgets=function(childWidgets){while(childWidgets.length>0){var widget=childWidgets.shift();if(widget instanceof LineWidget&&this instanceof ParagraphWidget){widget.paragraph=this;this.height+=widget.height;}else if(widget instanceof Widget){var lastChild=this.lastChild;widget.containerWidget=this;widget.y=lastChild instanceof Widget?lastChild.y+lastChild.height:this.y;this.height+=widget.height;}this.childWidgets.push(widget);}};Widget.prototype.removeChild=function(index){if(index>-1&&index<this.childWidgets.length){this.childWidgets.splice(index,1);}};Widget.prototype.destroy=function(){if(this.childWidgets){while(this.childWidgets.length>0){var child=this.childWidgets.pop();if(child instanceof LineWidget||child instanceof Widget){child.destroy();}}}this.childWidgets=undefined;if(this.containerWidget){this.containerWidget.removeChild(this.indexInOwner);}this.containerWidget=undefined;// if (this.margin) {
//     this.margin.destroy();
// }
this.margin=undefined;this.x=undefined;this.y=undefined;this.width=undefined;this.height=undefined;this.index=undefined;};return Widget;}();/**
 * @private
 */var BlockContainer=/** @class */function(_super){__extends$1(BlockContainer,_super);function BlockContainer(){var _this=_super!==null&&_super.apply(this,arguments)||this;/**
         * @private
         */_this.floatingElements=[];/**
         * @private
         */_this.sectionFormatIn=undefined;return _this;}Object.defineProperty(BlockContainer.prototype,"sectionFormat",{get:function get(){var container=this;if(container instanceof BodyWidget){return container.sectionFormatIn;}else if(container.page){return container.page.bodyWidgets[0].sectionFormat;}return undefined;},set:function set(value){if(this instanceof BodyWidget){this.sectionFormatIn=value;}},enumerable:true,configurable:true});Object.defineProperty(BlockContainer.prototype,"sectionIndex",{get:function get(){var container=this;var index=0;if(container instanceof BodyWidget){index=container.index;}else if(container.page){index=container.page.bodyWidgets[0].index;}return index;},enumerable:true,configurable:true});BlockContainer.prototype.getHierarchicalIndex=function(hierarchicalIndex){var documentHelper=undefined;var node=this;if(node instanceof BodyWidget){hierarchicalIndex=node.index+';'+hierarchicalIndex;}else if(node instanceof FootNoteWidget){if(node.footNoteType==='Footnote'){hierarchicalIndex='FN'+';'+hierarchicalIndex;}else{hierarchicalIndex='EN'+';'+hierarchicalIndex;}}else{if(node.headerFooterType.indexOf('Header')!==-1){hierarchicalIndex='H'+';'+hierarchicalIndex;}else{hierarchicalIndex='F'+';'+hierarchicalIndex;}}if(!sf.base.isNullOrUndefined(node.page)){documentHelper=this.page.documentHelper;var pageIndex=documentHelper.pages.indexOf(this.page);return pageIndex+';'+hierarchicalIndex;}return hierarchicalIndex;};return BlockContainer;}(Widget);/**
 * @private
 */var BodyWidget=/** @class */function(_super){__extends$1(BodyWidget,_super);/**
     * Initialize the constructor of BodyWidget
     */function BodyWidget(){return _super.call(this)||this;}BodyWidget.prototype.equals=function(widget){return widget instanceof BodyWidget&&widget.sectionFormat===this.sectionFormat;};BodyWidget.prototype.getHierarchicalIndex=function(hierarchicalIndex){var documentHelper=undefined;var node=this;hierarchicalIndex=node.index+';'+hierarchicalIndex;if(!sf.base.isNullOrUndefined(node.page)){documentHelper=this.page.documentHelper;var pageIndex=documentHelper.pages.indexOf(this.page);return pageIndex+';'+hierarchicalIndex;}return hierarchicalIndex;};BodyWidget.prototype.getTableCellWidget=function(touchPoint){for(var i=0;i<this.childWidgets.length;i++){if(this.childWidgets[i]instanceof TableWidget){var childWidget=this.childWidgets[i];var tableWidth=0;if(childWidget.wrapTextAround){tableWidth=childWidget.getTableCellWidth();}if(!childWidget.wrapTextAround&&childWidget.y<=touchPoint.y&&childWidget.y+childWidget.height>=touchPoint.y){return childWidget.getTableCellWidget(touchPoint);}if(childWidget.wrapTextAround&&childWidget.x<=touchPoint.x&&childWidget.x+tableWidth>=touchPoint.x&&childWidget.y<=touchPoint.y&&childWidget.y+childWidget.height>=touchPoint.y){return childWidget.getTableCellWidget(touchPoint);}}}var tableCellWidget=undefined;if(this.childWidgets.length>0){if(this.childWidgets[0].y<=touchPoint.y){tableCellWidget=this.childWidgets[this.childWidgets.length-1].getTableCellWidget(touchPoint);}else{tableCellWidget=this.childWidgets[0].getTableCellWidget(touchPoint);}}return tableCellWidget;};BodyWidget.prototype.destroyInternal=function(viewer){var height=this.height;if(!sf.base.isNullOrUndefined(this.childWidgets)){for(var n=0;n<this.childWidgets.length;n++){var chilgWidget=this.childWidgets[n];if(chilgWidget instanceof ParagraphWidget){chilgWidget.destroyInternal(viewer);}else{chilgWidget.destroyInternal(viewer);}if(sf.base.isNullOrUndefined(this.childWidgets)){break;}n--;}this.childWidgets=undefined;}// if (this instanceof HeaderFooterWidget && ((this as HeaderFooterWidget).currentNode ))) {
//     if (((this as HeaderFooterWidget).currentNode as WHeaderFooter).layoutedWidgets )) {
//         let index: number = ((this as HeaderFooterWidget).currentNode as WHeaderFooter).layoutedWidgets.indexOf(this);
//         ((this as HeaderFooterWidget).currentNode as WHeaderFooter).layoutedWidgets.splice(index, 1);
//     }
//     this.currentNode = undefined;
/* eslint-disable brace-style */if(!sf.base.isNullOrUndefined(this.page)){var index=this.indexInOwner;if(this.indexInOwner>-1){this.page.bodyWidgets.splice(index,1);if(this.page.bodyWidgets.length===0){this.page.destroy();// }
}else if(this instanceof HeaderFooterWidget&&this.page.headerWidget===this){this.page.headerWidget=undefined;}else if(this instanceof HeaderFooterWidget&&this.page.footerWidget===this){this.page.footerWidget=undefined;}this.page=undefined;}}this.destroy();};BodyWidget.prototype.destroy=function(){// if (this.sectionFormat) {
//     this.sectionFormat.destroy();
// }
this.sectionFormat=undefined;this.page=undefined;_super.prototype.destroy.call(this);};return BodyWidget;}(BlockContainer);/**
 * @private
 */var HeaderFooterWidget=/** @class */function(_super){__extends$1(HeaderFooterWidget,_super);function HeaderFooterWidget(type){var _this=_super.call(this)||this;/**
         * @private
         */_this.isEmpty=false;_this.headerFooterType=type;return _this;}HeaderFooterWidget.prototype.getTableCellWidget=function(point){return undefined;};HeaderFooterWidget.prototype.equals=function(widget){// Todo: Need to work
return widget instanceof HeaderFooterWidget&&widget.containerWidget===this.containerWidget;};HeaderFooterWidget.prototype.clone=function(){var headerFooter=new HeaderFooterWidget(this.headerFooterType);for(var i=0;i<this.childWidgets.length;i++){var block=this.childWidgets[i].clone();headerFooter.childWidgets.push(block);block.index=i;block.containerWidget=headerFooter;}headerFooter.isEmpty=this.isEmpty;headerFooter.x=this.x;headerFooter.y=this.y;headerFooter.height=0;headerFooter.width=0;return headerFooter;};HeaderFooterWidget.prototype.destroyInternal=function(viewer){this.page=undefined;_super.prototype.destroy.call(this);};return HeaderFooterWidget;}(BlockContainer);/**
 * @private
 */var BlockWidget=/** @class */function(_super){__extends$1(BlockWidget,_super);function BlockWidget(){var _this=_super!==null&&_super.apply(this,arguments)||this;/**
         * @private
         */_this.isLayouted=false;/**
         * @private
         */_this.locked=false;/**
         * @private
         */_this.lockedBy='';_this.footNoteReference=undefined;return _this;}Object.defineProperty(BlockWidget.prototype,"bodyWidget",{get:function get(){var widget=this;while(widget.containerWidget){if(widget.containerWidget instanceof TextFrame){var paragraph=widget.containerWidget.containerShape.line.paragraph;if(paragraph){return paragraph.bodyWidget;}}else if(widget.containerWidget instanceof BlockContainer){return widget.containerWidget;}widget=widget.containerWidget;}return undefined;},enumerable:true,configurable:true});Object.defineProperty(BlockWidget.prototype,"leftIndent",{get:function get(){var blockAdv=this;if(blockAdv instanceof ParagraphWidget&&blockAdv.paragraphFormat instanceof WParagraphFormat){return blockAdv.paragraphFormat.leftIndent;}else if(blockAdv instanceof TableWidget&&blockAdv.tableFormat instanceof WTableFormat){return blockAdv.tableFormat.leftIndent;}return 0;},enumerable:true,configurable:true});Object.defineProperty(BlockWidget.prototype,"rightIndent",{get:function get(){var blockAdv=this;if(blockAdv instanceof ParagraphWidget&&blockAdv.paragraphFormat instanceof WParagraphFormat){return blockAdv.paragraphFormat.rightIndent;}return 0;},enumerable:true,configurable:true});Object.defineProperty(BlockWidget.prototype,"isInsideTable",{get:function get(){return this.containerWidget instanceof TableCellWidget;},enumerable:true,configurable:true});Object.defineProperty(BlockWidget.prototype,"isInHeaderFooter",{get:function get(){return this.bodyWidget instanceof HeaderFooterWidget;},enumerable:true,configurable:true});Object.defineProperty(BlockWidget.prototype,"associatedCell",{get:function get(){if(this.containerWidget instanceof TableCellWidget){return this.containerWidget;}return undefined;},enumerable:true,configurable:true});/**
     * Check whether the paragraph contains only page break.
     *
     * @private
     * @returns {boolean}: Returns true if paragraph contains page break alone.
     */BlockWidget.prototype.isPageBreak=function(){var isPageBreak=false;if(this instanceof ParagraphWidget){var paragraph=this;if(paragraph!=null&&paragraph.childWidgets.length===1&&paragraph.firstChild.children.length===1){var pageBreak=paragraph.firstChild.children[0];isPageBreak=pageBreak.isPageBreak;}}return isPageBreak;};BlockWidget.prototype.getHierarchicalIndex=function(hierarchicalIndex){var node=this;hierarchicalIndex=node.containerWidget.childWidgets.indexOf(node)+';'+hierarchicalIndex;if(!sf.base.isNullOrUndefined(node.containerWidget)){if(node.containerWidget instanceof TextFrame){return node.containerWidget.getHierarchicalIndex(hierarchicalIndex);}else if(node.containerWidget instanceof BlockWidget){return node.containerWidget.getHierarchicalIndex(hierarchicalIndex);}else if(node.containerWidget instanceof BlockContainer){hierarchicalIndex=node.containerWidget.getHierarchicalIndex(hierarchicalIndex);}}return hierarchicalIndex;};BlockWidget.prototype.getIndex=function(){if(this instanceof ParagraphWidget||this instanceof TableWidget){return this.containerWidget.childWidgets.indexOf(this);}else if(this instanceof TableRowWidget){return this.ownerTable.childWidgets.indexOf(this);}else if(this instanceof TableCellWidget){return this.ownerRow.childWidgets.indexOf(this);}return 0;};BlockWidget.prototype.getContainerWidth=function(){if(this.isInsideTable){return this.associatedCell.getCellWidth(this);}if(this.containerWidget instanceof TextFrame){var shape=this.containerWidget.containerShape;return HelperMethods.convertPixelToPoint(shape.width)-HelperMethods.convertPixelToPoint(shape.textFrame.marginLeft)-HelperMethods.convertPixelToPoint(shape.textFrame.marginRight);}else{var bodyWidget=this.bodyWidget;var sectionFormat=bodyWidget.sectionFormat;return sectionFormat.pageWidth-(sectionFormat.leftMargin+sectionFormat.rightMargin);}};Object.defineProperty(BlockWidget.prototype,"bidi",{get:function get(){if(this instanceof ParagraphWidget&&this.paragraphFormat instanceof WParagraphFormat){return this.paragraphFormat.bidi;}if(this instanceof TableWidget&&this.tableFormat instanceof WTableFormat){return this.tableFormat.bidi;}return false;},enumerable:true,configurable:true});return BlockWidget;}(Widget);/**
 * @private
 */var FootNoteWidget=/** @class */function(_super){__extends$1(FootNoteWidget,_super);function FootNoteWidget(){return _super!==null&&_super.apply(this,arguments)||this;}FootNoteWidget.prototype.getMinimumAndMaximumWordWidth=function(minimumWordWidth,maximumWordWidth){throw new Error('Method not implemented.');};FootNoteWidget.prototype.getTableCellWidget=function(point){return undefined;};FootNoteWidget.prototype.equals=function(widget){// Todo: Need to work
return widget instanceof FootNoteWidget&&widget.containerWidget===this.containerWidget;};FootNoteWidget.prototype.clone=function(){var footNote=new FootNoteWidget();for(var i=0;i<this.childWidgets.length;i++){var block=this.childWidgets[i].clone();footNote.childWidgets.push(block);block.index=i;block.containerWidget=footNote;}footNote.block=this.block;return footNote;};FootNoteWidget.prototype.destroyInternal=function(viewer){this.block=undefined;_super.prototype.destroy.call(this);};return FootNoteWidget;}(BlockContainer);/**
 * @private
 */var ParagraphWidget=/** @class */function(_super){__extends$1(ParagraphWidget,_super);/**
     * Initialize the constructor of ParagraphWidget
     */function ParagraphWidget(){var _this=_super.call(this)||this;/**
         * @private
         */_this.isChangeDetected=false;/**
         * @private
         */_this.floatingElements=[];_this.paragraphFormat=new WParagraphFormat(_this);_this.characterFormat=new WCharacterFormat(_this);return _this;}Object.defineProperty(ParagraphWidget.prototype,"isEndsWithPageBreak",{get:function get(){if(this.childWidgets.length>0){return this.lastChild.isEndsWithPageBreak;}return false;},enumerable:true,configurable:true});ParagraphWidget.prototype.equals=function(widget){return widget instanceof ParagraphWidget&&widget.paragraphFormat===this.paragraphFormat;};ParagraphWidget.prototype.isContainsShapeAlone=function(){var containsShape=false;for(var i=0;i<this.childWidgets.length;i++){var lineWidget=this.childWidgets[i];for(var j=0;j<lineWidget.children.length;j++){var inline=lineWidget.children[j];if(!(inline instanceof ShapeElementBox)){return false;}else{containsShape=true;}}}return containsShape?true:false;};ParagraphWidget.prototype.isEmpty=function(){if(sf.base.isNullOrUndefined(this.childWidgets)||this.childWidgets.length===0){return true;}for(var j=0;j<this.childWidgets.length;j++){var inlineElement=this.childWidgets[j];for(var i=0;i<inlineElement.children.length;i++){var inline=inlineElement.children[i];if(inline.length===0){continue;}if(inline instanceof TextElementBox||inline instanceof ImageElementBox||inline instanceof BookmarkElementBox||inline instanceof EditRangeEndElementBox||inline instanceof EditRangeStartElementBox||inline instanceof ChartElementBox||inline instanceof ShapeElementBox||inline instanceof ContentControl||inline instanceof FieldElementBox&&HelperMethods.isLinkedFieldCharacter(inline)){return false;}}}return true;};ParagraphWidget.prototype.getInline=function(offset,indexInInline){var inline=undefined;var count=0;var isStarted=false;var splittedWidget=this.getSplitWidgets();for(var k=0;k<splittedWidget.length;k++){var widget=splittedWidget[k];for(var j=0;j<widget.childWidgets.length;j++){var line=widget.childWidgets[j];for(var i=0;i<line.children.length;i++){inline=line.children[i];if(inline instanceof ListTextElementBox){continue;}if(!isStarted&&(inline instanceof TextElementBox||inline instanceof ImageElementBox||inline instanceof ShapeElementBox||inline instanceof BookmarkElementBox||inline instanceof FieldElementBox&&HelperMethods.isLinkedFieldCharacter(inline))||inline instanceof ChartElementBox){isStarted=true;}if(isStarted&&offset<=count+inline.length){indexInInline=offset-count;return{'element':inline,'index':indexInInline};}count+=inline.length;}}}if(offset>count){indexInInline=sf.base.isNullOrUndefined(inline)?offset:inline.length;}return{'element':inline,'index':indexInInline};};ParagraphWidget.prototype.getLength=function(){var length=0;for(var j=0;j<this.childWidgets.length;j++){var line=this.childWidgets[j];for(var i=0;i<line.children.length;i++){var element=line.children[i];if(element instanceof ListTextElementBox){continue;}length+=element.length;}}return length;};ParagraphWidget.prototype.getTableCellWidget=function(point){return undefined;};ParagraphWidget.prototype.getMinimumAndMaximumWordWidth=function(minimumWordWidth,maximumWordWidth){minimumWordWidth=HelperMethods.convertPointToPixel(minimumWordWidth);maximumWordWidth=HelperMethods.convertPointToPixel(maximumWordWidth);if(this.childWidgets.length>0){var element=this.childWidgets[0].children[0];var text='';var elements=new Dictionary();var imageWidths=[];do{if(element instanceof TextElementBox&&element.text!==''){elements.add(element,text.length);text+=element.text;}else if(element instanceof FieldElementBox&&element.fieldType===0){var fieldBegin=element;if(!sf.base.isNullOrUndefined(fieldBegin.fieldEnd)){element=sf.base.isNullOrUndefined(fieldBegin.fieldSeparator)?fieldBegin.fieldEnd:fieldBegin.fieldSeparator;}}else if(element instanceof ImageElementBox){imageWidths.push(element.width);}if(sf.base.isNullOrUndefined(element)||sf.base.isNullOrUndefined(element.nextNode)){break;}element=element.nextNode;}while(true);var pattern=new RegExp('\\b\\w+\\b','g');var matches=[];var matchInfo=void 0;// eslint-disable  no-cond-assign
while(!sf.base.isNullOrUndefined(matchInfo=pattern.exec(text))){matches.push(matchInfo);}for(var i=0;i<matches.length;i++){var match=matches[i];var width=0;text='';var matchedValue='';var wordStartIndex=0;var wordEndIndex=match.index;var index=match.index;for(var j=0;j<elements.keys.length;j++){var span=elements.keys[j];var startIndex=elements.get(span);var spanLength=span.length;if(index<=startIndex+spanLength){wordStartIndex=index-startIndex;if(match.index+match[0].length<=startIndex+spanLength){wordEndIndex=match.index+match[0].length-(startIndex+wordStartIndex);}else{wordEndIndex=spanLength-wordStartIndex;index+=wordEndIndex;}text=span.text.substring(wordStartIndex,wordStartIndex+wordEndIndex);matchedValue=matchedValue+text;}if(text!==''){width+=this.bodyWidget.page.documentHelper.textHelper.getWidth(text,span.characterFormat);}if(matchedValue===match[0]){break;}}if(width!==0){if(minimumWordWidth===0||width>minimumWordWidth){minimumWordWidth=width;}}}// Check the image widths present in the paragraph. Consider the maximum image width as minimum word width.
var imageWidth=0;if(imageWidths.length>0){imageWidth=Math.max.apply(null,imageWidths);}if(minimumWordWidth===0||imageWidth>minimumWordWidth){minimumWordWidth=imageWidth;}var maximum=this.measureParagraph();if(maximumWordWidth===0||maximum>maximumWordWidth){maximumWordWidth=maximum;}}return{'maximumWordWidth':HelperMethods.convertPixelToPoint(maximumWordWidth),'minimumWordWidth':HelperMethods.convertPixelToPoint(minimumWordWidth)};};ParagraphWidget.prototype.measureParagraph=function(){var width=0;var element=this.childWidgets[0].children[0];do{if(element instanceof TextElementBox&&element.text!==''){width+=this.bodyWidget.page.documentHelper.textHelper.getWidth(element.text,element.characterFormat);}else if(element instanceof FieldElementBox&&element.fieldType===0){var fieldBegin=element;if(fieldBegin.fieldEnd!=null){element=sf.base.isNullOrUndefined(fieldBegin.fieldSeparator)?fieldBegin.fieldEnd:fieldBegin.fieldSeparator;}}else if(element instanceof ImageElementBox){width+=element.width;}if(sf.base.isNullOrUndefined(element)||sf.base.isNullOrUndefined(element.nextNode)){break;}element=element.nextNode;}while(true);// Considered the left and right indent.
if(this.leftIndent>0){width+=this.leftIndent;}if(this.rightIndent>0){width+=this.rightIndent;}return width;};ParagraphWidget.prototype.clone=function(){var paragraph=new ParagraphWidget();paragraph.paragraphFormat.copyFormat(this.paragraphFormat);paragraph.characterFormat.copyFormat(this.characterFormat);for(var i=0;i<this.childWidgets.length;i++){var line=this.childWidgets[i];var cloneLine=line.clone();paragraph.childWidgets.push(cloneLine);for(var j=0;j<cloneLine.children.length;j++){var element=cloneLine.children[j];if(element instanceof ShapeBase&&element.textWrappingStyle!=='Inline'){paragraph.floatingElements.push(element);}}cloneLine.paragraph=paragraph;}paragraph.x=this.x;paragraph.y=this.y;paragraph.height=this.height;paragraph.width=this.width;if(this.contentControlProperties){paragraph.contentControlProperties=this.contentControlProperties;}return paragraph;};ParagraphWidget.prototype.destroyInternal=function(viewer){var height=this.height;if(!sf.base.isNullOrUndefined(this.childWidgets)){for(var i=0;i<this.childWidgets.length;i++){var widget=this.childWidgets[i];widget.destroy();if(this.childWidgets.length===1&&sf.base.isNullOrUndefined(this.childWidgets[0].children)){this.childWidgets=undefined;}if(sf.base.isNullOrUndefined(this.childWidgets)){break;}i--;}this.childWidgets=undefined;}if(!sf.base.isNullOrUndefined(this.containerWidget)&&!sf.base.isNullOrUndefined(this.containerWidget.childWidgets)&&this.containerWidget.childWidgets.indexOf(this)!==-1){this.containerWidget.childWidgets.splice(this.containerWidget.childWidgets.indexOf(this),1);this.containerWidget.height-=height;// if ((isNullOrUndefined(this.containerWidget.childWidgets) || this.containerWidget.childWidgets.length === 0)
//     && this.containerWidget instanceof BodyWidget) {
//     // (this.containerWidget as BodyWidget).destroyInternal(viewer);
// }
this.containerWidget=undefined;}this.destroy();};ParagraphWidget.prototype.destroy=function(){// if (this.paragraphFormat) {
//     this.paragraphFormat.destroy();
// }
this.paragraphFormat=undefined;// if (this.characterFormat) {
//     this.characterFormat.destroy();
// }
this.characterFormat=undefined;_super.prototype.destroy.call(this);};return ParagraphWidget;}(BlockWidget);/**
 * @private
 */var TablePosition=/** @class */function(){function TablePosition(){}/**
     * @private
     */TablePosition.prototype.clone=function(){var positioning=new TablePosition();positioning.allowOverlap=this.allowOverlap;positioning.distanceTop=this.distanceTop;positioning.distanceRight=this.distanceRight;positioning.distanceLeft=this.distanceLeft;positioning.distanceBottom=this.distanceBottom;positioning.verticalAlignment=this.verticalAlignment;positioning.verticalOrigin=this.verticalOrigin;positioning.verticalPosition=this.verticalPosition;positioning.horizontalAlignment=this.horizontalAlignment;positioning.horizontalOrigin=this.horizontalOrigin;positioning.horizontalPosition=this.horizontalPosition;return positioning;};return TablePosition;}();/**
 * @private
 */var TableWidget=/** @class */function(_super){__extends$1(TableWidget,_super);function TableWidget(){var _this=_super.call(this)||this;_this.flags=0;/**
         * @private
         */_this.leftMargin=0;/**
         * @private
         */_this.topMargin=0;/**
         * @private
         */_this.rightMargin=0;/**
         * @private
         */_this.bottomMargin=0;/**
         * @private
         */_this.isDefaultFormatUpdated=false;/**
         * @private
         */_this.isContainInsideTable=false;_this.margin=new Margin(_this.leftMargin,_this.topMargin,_this.rightMargin,_this.bottomMargin);_this.leftBorderWidth=0;_this.rightBorderWidth=0;_this.topBorderWidth=0;_this.bottomBorderWidth=0;_this.tableFormat=new WTableFormat(_this);_this.tableHolder=new WTableHolder();_this.spannedRowCollection=new Dictionary();return _this;}Object.defineProperty(TableWidget.prototype,"isGridUpdated",{/**
         * @private
         */get:function get(){return(this.flags&0x4)>>2!==0;},/**
         * @private
         */set:function set(value){this.flags=this.flags&0xFB|(value?1:0)<<2;},enumerable:true,configurable:true});Object.defineProperty(TableWidget.prototype,"continueHeader",{/**
         * @private
         */get:function get(){return(this.flags&0x2)>>1!==0;},/**
         * @private
         */set:function set(value){this.flags=this.flags&0xFD|(value?1:0)<<1;},enumerable:true,configurable:true});Object.defineProperty(TableWidget.prototype,"header",{/**
         * @private
         */get:function get(){return(this.flags&0x1)!==0;},/**
         * @private
         */set:function set(value){this.flags=this.flags&0xFE|(value?1:0);},enumerable:true,configurable:true});Object.defineProperty(TableWidget.prototype,"isBidiTable",{get:function get(){return(this.flags&0x10)>>4!==0;},set:function set(value){this.flags=this.flags&0xEF|(value?1:0)<<4;},enumerable:true,configurable:true});/**
     * @private
     */TableWidget.prototype.equals=function(widget){return widget instanceof TableWidget&&widget.tableFormat===this.tableFormat;};/**
     * @private
     */TableWidget.prototype.combineRows=function(viewer){for(var i=0;i<this.childWidgets.length;i++){var row=this.childWidgets[i];if(row.childWidgets.length===0){row.destroy();i--;}else{row.combineCells(viewer);}}};/**
     * @private
     */TableWidget.prototype.contains=function(tableCell){if(this.equals(tableCell.ownerTable)){return true;}while(tableCell.ownerTable.isInsideTable){if(this.equals(tableCell.ownerTable)){return true;}tableCell=tableCell.ownerTable.associatedCell;}return this.equals(tableCell.ownerTable);};/**
     * @private
     */TableWidget.prototype.getOwnerWidth=function(isBasedOnViewer){var width=this.getContainerWidth();// Left and right indents should be neglected.
width=width-this.leftIndent-this.rightIndent;return width>=0?width:0;};/**
     * @private
     */TableWidget.prototype.getTableWidth=function(){var width=0;for(var i=0;i<this.childWidgets.length;i++){var rowWidth=0;var row=this.childWidgets[i];for(var j=0;j<row.childWidgets.length;j++){rowWidth+=row.childWidgets[j].cellFormat.cellWidth;}if(width<rowWidth){width=rowWidth;}}return width;};/**
     * @private
     */TableWidget.prototype.getTableCellWidth=function(){var width=0;for(var k=0;k<this.childWidgets.length;k++){var rowWidth=0;var rowWidget=this.childWidgets[k];for(var m=0;m<rowWidget.childWidgets.length;m++){var cellWidget=rowWidget.childWidgets[m];var cellWidth=cellWidget.width;if(cellWidth===0){cellWidth=cellWidget.cellFormat.cellWidth;if(cellWidth>cellWidget.cellFormat.preferredWidth&&cellWidget.cellFormat.preferredWidth!==0&&cellWidget.cellFormat.preferredWidthType!=='Percent'){cellWidth=cellWidget.cellFormat.preferredWidth;}cellWidth=HelperMethods.convertPointToPixel(cellWidth-(cellWidget.margin.left+cellWidget.margin.right));}rowWidth+=cellWidth+cellWidget.margin.left+cellWidget.margin.right;}if(width<rowWidth){width=rowWidth;}}return width;};/**
     * @private
     */TableWidget.prototype.getTableClientWidth=function(clientWidth){var tableWidth=clientWidth;if(this.tableFormat.preferredWidthType==='Point'&&this.tableFormat.preferredWidth>0){tableWidth=this.tableFormat.preferredWidth;}else{if(this.tableFormat.preferredWidthType==='Percent'&&this.tableFormat.preferredWidth>0){tableWidth=tableWidth*this.tableFormat.preferredWidth/100;}}return tableWidth;};/**
     * @private
     */TableWidget.prototype.getCellWidth=function(preferredWidth,preferredWidthType,containerWidth,cell){var cellWidth=preferredWidth;if(preferredWidthType==='Percent'){cellWidth=preferredWidth*containerWidth/100;}else if(preferredWidthType==='Point'){cellWidth=preferredWidth;}// For grid before and grid after with auto width, no need to calculate minimum preferred width.
else if(!sf.base.isNullOrUndefined(cell)){cellWidth=cell.getMinimumPreferredWidth();}return cellWidth;};/**
     * @private
     */TableWidget.prototype.fitCellsToClientArea=function(clientWidth){var tableWidth=this.getTableWidth();var factor=clientWidth/tableWidth;for(var i=0;i<this.childWidgets.length;i++){var row=this.childWidgets[i];row.rowFormat.gridAfterWidth*=factor;row.rowFormat.gridBeforeWidth*=factor;for(var j=0;j<row.childWidgets.length;j++){row.childWidgets[j].cellFormat.cellWidth*=factor;row.childWidgets[j].cellFormat.preferredWidth*=factor;}}};/**
     * @private
     */TableWidget.prototype.getTableCellWidget=function(point){var tableCellWidget=undefined;for(var i=0;i<this.childWidgets.length;i++){if(this.childWidgets[i].y<=point.y&&this.childWidgets[i].y+this.childWidgets[i].height>=point.y){tableCellWidget=this.childWidgets[i].getTableCellWidget(point);break;}}return tableCellWidget;};/**
     * @private
     */ /* eslint-disable  */TableWidget.prototype.calculateGrid=function(){var tempGrid=[];var spannedCells=[];var containerWidth=this.getOwnerWidth(true);var tableWidth=this.getTableClientWidth(containerWidth);this.tableCellInfo=new Dictionary();for(var i=0;i<this.childWidgets.length;i++){var row=this.childWidgets[i];var rowCellInfo=new Dictionary();var rowFormat=row.rowFormat;var cellWidth=0;var columnSpan=row.rowFormat.gridBefore;var currOffset=0;if(tempGrid.indexOf(currOffset)<0){tempGrid.push(currOffset);}//Converts the row grid before width from point to twips point by 15 factor.
cellWidth=this.getCellWidth(rowFormat.gridBeforeWidth,rowFormat.gridBeforeWidthType,tableWidth,null);currOffset+=cellWidth;var startOffset=parseFloat(currOffset.toFixed(2));if(tempGrid.indexOf(startOffset)<0){tempGrid.push(startOffset);}for(var j=0;j<row.childWidgets.length;j++){var cell=row.childWidgets[j];for(var k=0;k<spannedCells.length;k++){if(spannedCells[k].columnIndex<columnSpan){continue;}var rowSpan=spannedCells[k].cellFormat.rowSpan;var removeSpannedCell=true;if(spannedCells[k].columnIndex>columnSpan){{removeSpannedCell=false;// If the cell is the last cell in the row and the row has grid after value..
if(j===row.childWidgets.length-1&&row.rowFormat.gridAfter>0){cellWidth=this.getCellWidth(spannedCells[k].cellFormat.preferredWidth,spannedCells[k].cellFormat.preferredWidthType,tableWidth,null);currOffset+=cellWidth;}}}else{// If the table gird alone calculted then column index of the rowspanned cell will be directly taken. 
// If the gird calculation is done from the UI level opearations such as resizing then table holder 
// will have the columns at that time we can get the column index from the table holder.
//Converts the cell width from point to twips point by 15 factor.
cellWidth=this.getCellWidth(spannedCells[k].cellFormat.preferredWidth,spannedCells[k].cellFormat.preferredWidthType,tableWidth,null);currOffset+=cellWidth;columnSpan=spannedCells[k].columnIndex+spannedCells[k].cellFormat.columnSpan;}if(!removeSpannedCell&&j===row.childWidgets.length-1){removeSpannedCell=true;}if(removeSpannedCell&&i-spannedCells[k].ownerRow.rowIndex===rowSpan-1){spannedCells.splice(k,1);k--;}}// At the start of each row, we will process the row spanned cells to get the start column index.
// To calculate grid properly, we need the items in the spanned cells collection in the order of their column index
if(cell.cellFormat.rowSpan>1){if(spannedCells.length===0||spannedCells[spannedCells.length-1].columnIndex<=columnSpan){spannedCells.push(cell);}else{for(var m=spannedCells.length;m>0;m--){if(spannedCells[m-1].columnIndex>columnSpan){spannedCells.splice(m-1,0,cell);}}}}// Add start offset of each cell based on its index
if(!rowCellInfo.containsKey(cell.cellIndex)){rowCellInfo.add(cell.cellIndex,parseFloat((currOffset-startOffset).toFixed(2)));}columnSpan+=cell.cellFormat.columnSpan;//Converts the cell width from pixel to twips point by 15 factor.
cellWidth=this.getCellWidth(cell.cellFormat.preferredWidth,cell.cellFormat.preferredWidthType,tableWidth,null);currOffset+=cellWidth;var offset=parseFloat(currOffset.toFixed(2));if(tempGrid.indexOf(offset)<0){tempGrid.push(offset);}if(j===row.childWidgets.length-1&&rowFormat.gridAfter>0){cellWidth=this.getCellWidth(rowFormat.gridAfterWidth,'Point',tableWidth,null);currOffset+=cellWidth;if(tempGrid.indexOf(parseFloat(currOffset.toFixed(2)))<0){tempGrid.push(parseFloat(currOffset.toFixed(2)));}columnSpan+=rowFormat.gridAfter;}// Add rowindex and its cells info for each row
if(!this.tableCellInfo.containsKey(row.rowIndex)){this.tableCellInfo.add(row.rowIndex,rowCellInfo);}}}tempGrid.sort(function(a,b){return a-b;});if(this.tableHolder.columns.length>0&&tempGrid.length-1!==this.tableHolder.columns.length){this.updateColumnSpans(tempGrid,tableWidth);}this.tableCellInfo.clear();this.tableCellInfo=undefined;};TableWidget.prototype.updateColumnSpans=function(tempGrid,containerWidth){for(var i=0;i<this.childWidgets.length;i++){var row=this.childWidgets[i];if(row.rowFormat.gridBeforeWidth>=0){row.rowFormat.gridBefore=row.getGridCount(tempGrid,undefined,-1,containerWidth);}for(var j=0;j<row.childWidgets.length;j++){var cell=row.childWidgets[j];var columnSpan=row.getGridCount(tempGrid,cell,cell.getIndex(),containerWidth);if(columnSpan>0&&cell.cellFormat.columnSpan!==columnSpan){cell.cellFormat.columnSpan=columnSpan;}}if(row.rowFormat.gridAfterWidth>=0){row.rowFormat.gridAfter=row.getGridCount(tempGrid,undefined,row.childWidgets.length,containerWidth);}}};/**
     * @private
     */TableWidget.prototype.getMinimumAndMaximumWordWidth=function(minimumWordWidth,maximumWordWidth){this.checkTableColumns();var tableWidth=this.tableHolder.getTotalWidth(0);if(tableWidth>minimumWordWidth){minimumWordWidth=tableWidth;}if(tableWidth>maximumWordWidth){maximumWordWidth=tableWidth;}return{'minimumWordWidth':minimumWordWidth,'maximumWordWidth':maximumWordWidth};};/**
     * @private
     */TableWidget.prototype.checkTableColumns=function(){if(this.isGridUpdated){return;}var isAutoFit=this.isAutoFit();if(isAutoFit||this.tableHolder.columns.length===0){this.buildTableColumns();}this.isGridUpdated=true;};/**
     * @private
     */TableWidget.prototype.isAutoFit=function(){var bodyWidget=this.bodyWidget;if(!sf.base.isNullOrUndefined(bodyWidget)&&!sf.base.isNullOrUndefined(bodyWidget.page)){return bodyWidget.page.documentHelper.layout.getParentTable(this).tableFormat.allowAutoFit;}return false;};/**
     * @private
     */TableWidget.prototype.buildTableColumns=function(){if(this.isGridUpdated){return;}// Clear existing columns in order to start creating columns freshly.
this.tableHolder.resetColumns();var containerWidth=0;var tableWidth=0;var rowSpannedCells=[];var isAutoWidth=this.tableFormat.preferredWidthType==='Auto';var isAutoFit=this.tableFormat.allowAutoFit;// For continuous layout, window width should be considered. 
// If preferred width exceeds this limit, it can take upto maximum of 2112 pixels (1584 points will be assigned by Microsoft Word).
if(!sf.base.isNullOrUndefined(this.bodyWidget.page)&&this.bodyWidget.page.viewer instanceof WebLayoutViewer&&isAutoFit&&!this.isInsideTable&&!(this.containerWidget instanceof TextFrame)){containerWidth=HelperMethods.convertPixelToPoint(this.bodyWidget.page.viewer.clientArea.width-this.bodyWidget.page.viewer.padding.right*3);}else{containerWidth=this.getOwnerWidth(true);}containerWidth=this.tableFormat.preferredWidth>containerWidth?this.tableFormat.preferredWidth:containerWidth;var isZeroWidth=isAutoWidth&&this.tableFormat.preferredWidth===0&&!isAutoFit;tableWidth=this.getTableClientWidth(containerWidth);if(isZeroWidth&&!this.isDefaultFormatUpdated&&isAutoFit){this.splitWidthToTableCells(tableWidth,isZeroWidth);}for(var i=0;i<this.childWidgets.length;i++){var row=this.childWidgets[i];var rowFormat=row.rowFormat;var columnSpan=0;var cellWidth=0;var sizeInfo=new ColumnSizeInfo();var offset=0;if(rowFormat.gridBefore>0&&(row.rowFormat.beforeWidth!==0||row.rowFormat.gridBeforeWidth!==0)&&(this.bodyWidget.page.documentHelper.alignTablesRowByRow?row.ownerTable.tableFormat.tableAlignment==='Left':true)){cellWidth=this.getCellWidth(rowFormat.gridBeforeWidth,row.rowFormat.gridAfterWidthType,tableWidth,null);sizeInfo.minimumWidth=cellWidth;this.tableHolder.addColumns(columnSpan,columnSpan=rowFormat.gridBefore,cellWidth,sizeInfo,offset=cellWidth);}for(var j=0;j<row.childWidgets.length;j++){var cell=row.childWidgets[j];if(rowSpannedCells.length===0){cell.columnIndex=columnSpan;}for(var k=0;k<rowSpannedCells.length;k++){var rowSpannedCell=rowSpannedCells[k];if(rowSpannedCell.columnIndex<columnSpan){cell.columnIndex=columnSpan;continue;}var rowSpan=1;var removeSpannedCell=true;rowSpan=rowSpannedCell.cellFormat.rowSpan;if(rowSpannedCell.columnIndex>columnSpan){cell.columnIndex=columnSpan;removeSpannedCell=false;}else{sizeInfo=rowSpannedCell.getCellSizeInfo(isAutoFit);cellWidth=this.getCellWidth(rowSpannedCell.cellFormat.preferredWidth,rowSpannedCell.cellFormat.preferredWidthType,tableWidth,rowSpannedCell);// If the table gird alone calculated then column index of the rowspanned cell will be directly taken. 
// If the gird calculation is done from the UI level operations such as resizing then table holder will have the columns at that time we can get the column index from the table holder.
if(this.tableHolder.columns.length>0){this.tableHolder.addColumns(columnSpan,columnSpan=this.tableHolder.columns.indexOf(rowSpannedCell.ownerColumn)+rowSpannedCell.cellFormat.columnSpan,cellWidth,sizeInfo,offset+=cellWidth);cell.columnIndex=columnSpan;}else{this.tableHolder.addColumns(columnSpan,columnSpan=rowSpannedCell.columnIndex+rowSpannedCell.cellFormat.columnSpan,cellWidth,sizeInfo,offset+=cellWidth);cell.columnIndex=columnSpan;}}if(!removeSpannedCell&&j===row.childWidgets.length-1){removeSpannedCell=true;}if(removeSpannedCell&&i-rowSpannedCell.ownerRow.rowIndex===rowSpan-1){rowSpannedCells.splice(k,1);k--;}}// At the start of each row, we will process the row spanned cells to get the start column index.
// To calculate grid properly, we need the items in the spanned cells collection in the order of their column index
if(cell.cellFormat.rowSpan>1){if(rowSpannedCells.length===0||rowSpannedCells[rowSpannedCells.length-1].columnIndex<=columnSpan){rowSpannedCells.push(cell);}else{var insertIndex=0;for(var m=rowSpannedCells.length;m>0;m--){if(rowSpannedCells[m-1].columnIndex>columnSpan){insertIndex=m-1;}}rowSpannedCells.splice(insertIndex,0,cell);}}sizeInfo=cell.getCellSizeInfo(isAutoFit);cellWidth=this.getCellWidth(cell.cellFormat.preferredWidth,cell.cellFormat.preferredWidthType,tableWidth,cell);this.tableHolder.addColumns(columnSpan,columnSpan+=cell.cellFormat.columnSpan,cellWidth,sizeInfo,offset+=cellWidth);if(j===row.childWidgets.length-1&&rowFormat.gridAfterWidth>0){cellWidth=this.getCellWidth(rowFormat.gridAfterWidth,'Point',tableWidth,null);this.tableHolder.addColumns(columnSpan,columnSpan+=rowFormat.gridAfter,cellWidth,sizeInfo,offset+=cellWidth);}}}if(isZeroWidth&&!this.isDefaultFormatUpdated){this.isDefaultFormatUpdated=true;}this.tableHolder.validateColumnWidths();if(isAutoFit){// Fits the column width automatically based on contents.
this.tableHolder.autoFitColumn(containerWidth,tableWidth,isAutoWidth,this.isInsideTable);}else{// Fits the column width based on preferred width. i.e. Fixed layout.
// eslint-disable-next-line max-len
this.tableHolder.fitColumns(containerWidth,tableWidth,isAutoWidth,this.leftIndent+this.rightIndent);}// if (!isAutoFit && isAutoWidth) {
//     tableWidth = this.tableHolder.tableWidth;
// }
//Sets the width to cells
this.setWidthToCells(tableWidth,isAutoWidth);};/**
     * @private
     */TableWidget.prototype.setWidthToCells=function(tableWidth,isAutoWidth){for(var i=0;i<this.childWidgets.length;i++){var rw=this.childWidgets[i];var rowFormat=rw.rowFormat;if(rowFormat.gridBefore>0){rowFormat.beforeWidth=this.tableHolder.getCellWidth(0,rowFormat.gridBefore,tableWidth);}for(var j=0;j<rw.childWidgets.length;j++){var cell=rw.childWidgets[j];if(cell.cellFormat.preferredWidthType==='Auto'||cell.cellFormat.cellWidth===0){cell.cellFormat.cellWidth=this.tableHolder.getCellWidth(cell.columnIndex,cell.cellFormat.columnSpan,tableWidth);}//By default, if cell preferred widthType is auto , width set based on table width and type is changed to 'Point'
}if(rowFormat.gridAfter>0){rowFormat.afterWidth=this.tableHolder.getCellWidth(0,rowFormat.gridAfter,tableWidth);}}};/**
     * @private
     */TableWidget.prototype.updateProperties=function(updateAllowAutoFit,currentSelectedTable,autoFitBehavior){if(updateAllowAutoFit){this.tableFormat.allowAutoFit=autoFitBehavior!=='FixedColumnWidth';}if(this!==currentSelectedTable){currentSelectedTable.updateProperties(false,currentSelectedTable,autoFitBehavior);return;}if(autoFitBehavior==='FixedColumnWidth'){// Clear the table widths and set the preferred width for cells.
this.tableFormat.preferredWidth=0;this.tableFormat.preferredWidthType='Auto';for(var i=0;i<this.childWidgets.length;i++){var rowWidget=this.childWidgets[i];for(var j=0;j<rowWidget.childWidgets.length;j++){var cellWidget=rowWidget.childWidgets[j];cellWidget.cellFormat.preferredWidthType='Point';cellWidget.cellFormat.preferredWidth=cellWidget.cellFormat.cellWidth;}}}else if(autoFitBehavior==='FitToWindow'){// Set the preferred width for table and cells in percentage.
var tableWidth=this.tableHolder.getTotalWidth(0);this.tableFormat.leftIndent=0;this.tableFormat.preferredWidth=100;this.tableFormat.preferredWidthType='Percent';for(var i=0;i<this.childWidgets.length;i++){var row=this.childWidgets[i];for(var z=0;z<row.childWidgets.length;z++){var cell=row.childWidgets[z];if(cell.cellFormat.preferredWidthType!=='Percent'){cell.cellFormat.preferredWidthType='Percent';cell.cellFormat.preferredWidth=cell.cellFormat.cellWidth/tableWidth*100;}}}}else{// Clear the preferred width for table and cells.
this.tableFormat.preferredWidth=0;this.tableFormat.preferredWidthType='Auto';for(var i=0;i<this.childWidgets.length;i++){var row=this.childWidgets[i];row.rowFormat.beforeWidth=0;row.rowFormat.gridBefore=0;row.rowFormat.gridBeforeWidth=0;row.rowFormat.gridBeforeWidthType='Auto';row.rowFormat.afterWidth=0;row.rowFormat.gridAfter=0;row.rowFormat.gridAfterWidth=0;row.rowFormat.gridAfterWidthType='Auto';for(var j=0;j<row.childWidgets.length;j++){var cell=row.childWidgets[j];cell.cellFormat.preferredWidth=0;cell.cellFormat.preferredWidthType='Auto';}}}};/**
     * @private
     */TableWidget.prototype.getMaxRowWidth=function(clientWidth){var width=0;for(var i=0;i<this.childWidgets.length;i++){var row=this.childWidgets[i];var rowWidth=0;for(var j=0;j<row.childWidgets.length;j++){var cell=row.childWidgets[j];rowWidth+=this.getCellWidth(cell.cellFormat.preferredWidth,cell.cellFormat.preferredWidthType,clientWidth,cell);}if(width<rowWidth){width=rowWidth;}}return width;};/**
     * @private
     */TableWidget.prototype.updateWidth=function(dragValue){var totalPreferredWidth=this.tableHolder.getTotalWidth(0);var ownerWidth=this.getOwnerWidth(true);var containerWidth=this.getTableClientWidth(ownerWidth);if(containerWidth<=totalPreferredWidth){if(this.tableFormat.preferredWidthType==='Auto'){this.tableFormat.preferredWidthType='Point';}}if(this.tableFormat.preferredWidthType!=='Auto'){if(this.tableFormat.preferredWidthType==='Point'){this.tableFormat.preferredWidth=this.getMaxRowWidth(containerWidth);}else{//ToDo:Need to analyze more the Percentage calculation for table width.
var value=totalPreferredWidth/ownerWidth*100;this.tableFormat.preferredWidth=value;}}};/**
     * @private
     */TableWidget.prototype.convertPointToPercent=function(tablePreferredWidth,ownerWidth){var value=0;value=tablePreferredWidth/ownerWidth*100;value=Math.round(value);return value<100?value:100;// The value should be lesser than or equal to 100%;
};TableWidget.prototype.updateChildWidgetLeft=function(left){for(var i=0;i<this.childWidgets.length;i++){var rowWidget=this.childWidgets[i];rowWidget.x=left;rowWidget.updateChildWidgetLeft(left);}};/**
     * Shift the widgets for right to left aligned table.
     * @private
     */TableWidget.prototype.shiftWidgetsForRtlTable=function(clientArea,tableWidget){var clientAreaX=tableWidget.x;var clientAreaRight=clientArea.right;var cellSpace=0;if(tableWidget.tableFormat&&tableWidget.tableFormat.cellSpacing>0){cellSpace=tableWidget.tableFormat.cellSpacing;}for(var i=0;i<tableWidget.childWidgets.length;i++){var rowWidget=tableWidget.childWidgets[i];var rowX=rowWidget.x;var left=clientAreaRight-(rowX-clientAreaX);for(var j=0;j<rowWidget.childWidgets.length;j++){var cellWidget=rowWidget.childWidgets[j];left=left-(cellWidget.width+cellWidget.margin.left+cellWidget.margin.right-cellWidget.rightBorderWidth+cellSpace);cellWidget.updateWidgetLeft(left+cellWidget.margin.left);}}};/**
     * @private
     */TableWidget.prototype.clone=function(){var table=new TableWidget();table.tableHolder=this.tableHolder.clone();table.tableFormat.copyFormat(this.tableFormat);if(this.wrapTextAround){table.wrapTextAround=this.wrapTextAround;table.positioning=this.positioning.clone();}for(var i=0;i<this.childWidgets.length;i++){var row=this.childWidgets[i].clone();table.childWidgets.push(row);row.containerWidget=table;row.index=i;}table.x=this.x;table.y=this.y;table.height=this.height;table.width=this.width;table.containerWidget=this.containerWidget;if(this.contentControlProperties){table.contentControlProperties=this.contentControlProperties;}return table;};/**
     * @private
     */TableWidget.getTableOf=function(node){if(node instanceof WBorders){var row=TableRowWidget.getRowOf(node);if(!sf.base.isNullOrUndefined(row)){return row.ownerTable;}else if(node.ownerBase instanceof WTableFormat&&node.ownerBase.ownerBase instanceof TableWidget){return node.ownerBase.ownerBase;}else{return undefined;}}return undefined;};/**
     * @private
     */TableWidget.prototype.fitChildToClientArea=function(){var clientWidth=this.getContainerWidth();if(Math.round(clientWidth)<Math.round(this.getTableWidth())){this.fitCellsToClientArea(clientWidth);}for(var i=0;i<this.childWidgets.length;i++){var row=this.childWidgets[i];for(var j=0;j<row.childWidgets.length;j++){var cell=row.childWidgets[j];for(var k=0;k<cell.childWidgets.length;k++){if(cell.childWidgets[k]instanceof TableWidget){cell.childWidgets[k].fitChildToClientArea();}}}}};/**
     * @private
     */TableWidget.prototype.getColumnCellsForSelection=function(startCell,endCell){var cells=[];var start=startCell.columnIndex;var end=endCell.columnIndex+endCell.cellFormat.columnSpan;for(var i=0;i<this.childWidgets.length;i++){var row=this.childWidgets[i];for(var j=0;j<row.childWidgets.length;j++){var cell=row.childWidgets[j];var columnIndex=cell.columnIndex;var columnSpan=cell.cellFormat.columnSpan;if(columnIndex+columnSpan>start&&columnIndex+columnSpan<end||columnIndex>start&&columnIndex<end){if(cells.indexOf(cell)<0){cells.push(cell);}}else if(columnIndex>start&&columnIndex<end&&columnIndex+columnSpan<end||columnIndex<start&&columnIndex+columnSpan>end){if(cells.indexOf(cell)<0){cells.push(cell);}}else if(columnIndex===start||columnIndex+columnSpan===end){if(cells.indexOf(cell)<0){cells.push(cell);}}}}return cells;};/**
     * Splits width equally for all the cells.
     * @param tableClientWidth
     * @private
     */TableWidget.prototype.splitWidthToTableCells=function(tableClientWidth,isZeroWidth){for(var row=0;row<this.childWidgets.length;row++){this.childWidgets[row].splitWidthToRowCells(tableClientWidth,isZeroWidth);}};/**
     * @private
     */TableWidget.prototype.insertTableRowsInternal=function(tableRows,startIndex){for(var i=tableRows.length-1;i>=0;i--){var row=tableRows.splice(i,1)[0];row.containerWidget=this;this.childWidgets.splice(startIndex,0,row);}this.updateRowIndex(startIndex);this.isGridUpdated=false;this.buildTableColumns();this.isGridUpdated=true;};/**
     * @private
     */TableWidget.prototype.updateRowIndex=function(startIndex){for(var i=startIndex;i<this.childWidgets.length;i++){var row=this.childWidgets[i];row.index=i;for(var j=0;j<row.childWidgets.length;j++){row.childWidgets[j].index=j;row.childWidgets[j].rowIndex=row.rowIndex;}startIndex++;}};/**
     * @private
     */TableWidget.prototype.getCellStartOffset=function(cell){var offset=0;if(cell&&this.tableCellInfo){if(this.tableCellInfo.containsKey(cell.ownerRow.rowIndex)){var rowCellInfo=this.tableCellInfo.get(cell.ownerRow.rowIndex);if(rowCellInfo.containsKey(cell.cellIndex)){offset=rowCellInfo.get(cell.cellIndex);}}}return offset;};/**
     * @private
     */TableWidget.prototype.destroyInternal=function(viewer){var height=this.height;if(!sf.base.isNullOrUndefined(this.childWidgets)){for(var j=0;j<this.childWidgets.length;j++){var widget=undefined;var childWidget=this.childWidgets[j];widget=childWidget;if(!sf.base.isNullOrUndefined(widget)){widget.destroyInternal(viewer);}if(sf.base.isNullOrUndefined(this.childWidgets)){break;}j--;}this.childWidgets=undefined;}if(!sf.base.isNullOrUndefined(this.containerWidget)){if(this.containerWidget instanceof BodyWidget){if(this.containerWidget.floatingElements.indexOf(this)!==-1){this.containerWidget.floatingElements.splice(this.containerWidget.floatingElements.indexOf(this),1);}}if(!sf.base.isNullOrUndefined(this.containerWidget.childWidgets)){if(this.containerWidget.childWidgets.indexOf(this)!==-1){this.containerWidget.childWidgets.splice(this.containerWidget.childWidgets.indexOf(this),1);}this.containerWidget.height-=height;// if ((isNullOrUndefined(this.containerWidget.childWidgets) || this.containerWidget.childWidgets.length === 0)
//     && this.containerWidget instanceof BodyWidget) {
//     // (this.containerWidget as BodyWidget).destroyInternal(viewer);
// }
}this.containerWidget=undefined;}this.destroy();};/**
     * @private
     */TableWidget.prototype.destroy=function(){// if (this.tableFormat) {
//     this.tableFormat.destroy();
// }
this.tableFormat=undefined;if(this.spannedRowCollection){this.spannedRowCollection.destroy();}this.spannedRowCollection=undefined;// if (this.tableHolder) {
//     this.tableHolder.destroy();
// }
this.tableHolder=undefined;this.flags=undefined;this.leftMargin=undefined;this.topMargin=undefined;this.rightMargin=undefined;this.bottomMargin=undefined;this.headerHeight=undefined;this.description=undefined;this.title=undefined;this.isDefaultFormatUpdated=undefined;_super.prototype.destroy.call(this);};return TableWidget;}(BlockWidget);/**
 * @private
 */var TableRowWidget=/** @class */function(_super){__extends$1(TableRowWidget,_super);function TableRowWidget(){var _this=_super.call(this)||this;_this.topBorderWidth=0;_this.bottomBorderWidth=0;_this.rowFormat=new WRowFormat(_this);return _this;}Object.defineProperty(TableRowWidget.prototype,"rowIndex",{/**
         * @private
         */get:function get(){if(this.containerWidget){return this.containerWidget.childWidgets.indexOf(this);}return-1;},enumerable:true,configurable:true});Object.defineProperty(TableRowWidget.prototype,"ownerTable",{/**
         * @private
         */get:function get(){if(this.containerWidget instanceof TableWidget){return this.containerWidget;}return undefined;},enumerable:true,configurable:true});Object.defineProperty(TableRowWidget.prototype,"nextRow",{/**
         * @private
         */get:function get(){var index=this.indexInOwner;if(index>-1&&index<this.ownerTable.childWidgets.length-1){return this.ownerTable.childWidgets[index+1];}return undefined;},enumerable:true,configurable:true});/**
     * @private
     */TableRowWidget.prototype.equals=function(widget){return widget instanceof TableRowWidget&&widget.rowFormat===this.rowFormat;};/**
     * @private
     */TableRowWidget.prototype.combineCells=function(viewer){for(var i=0;i<this.childWidgets.length;i++){var cell=this.childWidgets[i];cell.combineWidget(viewer);if(cell.cellFormat.rowSpan===1){var cellHeight=cell.height+cell.margin.top+cell.margin.bottom;if(this.height-this.ownerTable.tableFormat.cellSpacing<cell.height){this.height=this.ownerTable.tableFormat.cellSpacing+cell.height;}}}};/**
     * @private
     */TableRowWidget.getRowOf=function(node){if(node instanceof WBorders){var cell=TableCellWidget.getCellOf(node);if(!sf.base.isNullOrUndefined(cell)){return cell.ownerRow;}else if(node.ownerBase instanceof WRowFormat&&node.ownerBase.ownerBase instanceof TableRowWidget){return node.ownerBase.ownerBase;}else{return undefined;}}return undefined;};/**
     * @private
     */TableRowWidget.prototype.getCell=function(rowIndex,cellIndex){for(var i=0;i<this.childWidgets.length;i++){var cell=this.childWidgets[i];if(cell.rowIndex===rowIndex&&cell.index===cellIndex){return cell;}}return undefined;};/**
     * @private
     */TableRowWidget.prototype.splitWidthToRowCells=function(tableClientWidth,isZeroWidth){var cells=this.childWidgets;var cellWidth=tableClientWidth/cells.length;for(var cell=0;cell<cells.length;cell++){if(isZeroWidth&&cells[cell].cellFormat.preferredWidth===0){cells[cell].cellFormat.preferredWidth=cellWidth;this.ownerTable.isDefaultFormatUpdated=false;}else if(isZeroWidth){this.ownerTable.isDefaultFormatUpdated=true;break;}else{cells[cell].cellFormat.preferredWidth=cellWidth;}}};/**
     * @private
     */TableRowWidget.prototype.getGridCount=function(tableGrid,cell,index,containerWidth){var prevOffset=0;var width=0;var ownerTable=this.ownerTable;var rowFormat=this.rowFormat;if(index===-1){width=ownerTable.getCellWidth(rowFormat.gridBeforeWidth,rowFormat.gridBeforeWidthType,containerWidth,null);}else{prevOffset+=ownerTable.getCellWidth(rowFormat.gridBeforeWidth,rowFormat.gridBeforeWidthType,containerWidth,null);if(index>=0){prevOffset+=ownerTable.getCellStartOffset(cell);}if(index<this.childWidgets.length){width=ownerTable.getCellWidth(cell.cellFormat.preferredWidth,cell.cellFormat.preferredWidthType,containerWidth,null);}else{width=ownerTable.getCellWidth(rowFormat.gridAfterWidth,rowFormat.gridAfterWidthType,containerWidth,null);}}var gridStartIndex=this.getOffsetIndex(tableGrid,prevOffset);var gridEndIndex=this.getOffsetIndex(tableGrid,prevOffset+width);return gridEndIndex-gridStartIndex;};TableRowWidget.prototype.getOffsetIndex=function(tableGrid,offset){offset=parseFloat(offset.toFixed(2));var index=0;if(tableGrid.indexOf(offset)>=0){index=tableGrid.indexOf(offset);}else{for(var i=0;i<tableGrid.length;i++){if(tableGrid[i]>offset){return i;}}index=tableGrid.length-1;}return index;};TableRowWidget.prototype.getCellOffset=function(index,containerWidth){var prevOffset=0;var ownerTable=this.ownerTable;for(var i=0;i<this.childWidgets.length;i++){var cellFormat=this.childWidgets[i].cellFormat;if(i===index){break;}prevOffset+=ownerTable.getCellWidth(cellFormat.preferredWidth,cellFormat.preferredWidthType,containerWidth,null);}return prevOffset;};/**
     * @private
     */TableRowWidget.prototype.updateRowBySpannedCells=function(){var rowSpannedCells=this.getPreviousRowSpannedCells();var currentRowIndex=this.rowIndex;for(var i=0;i<rowSpannedCells.length;i++){var spannedCell=rowSpannedCells[i];var rowSpanEnd=spannedCell.ownerRow.rowIndex+spannedCell.cellFormat.rowSpan-1;// If current row is row span end or includes spanned cells. then, decrease the rowspan
if(rowSpanEnd>=currentRowIndex){spannedCell.cellFormat.rowSpan-=1;}}};/**
     * @private
     */TableRowWidget.prototype.getPreviousRowSpannedCells=function(include){var rowSpannedCells=[];var row=include?this:this.previousWidget;while(!sf.base.isNullOrUndefined(row)){for(var i=0;i<row.childWidgets.length;i++){var cell=row.childWidgets[i];if(cell.cellFormat.rowSpan>1){rowSpannedCells.splice(0,0,cell);}}row=row.previousWidget;}return rowSpannedCells;};/**
     * @private
     */TableRowWidget.prototype.getTableCellWidget=function(point){for(var i=0;i<this.childWidgets.length;i++){var x=Math.round(this.childWidgets[i].x);if(x-this.childWidgets[i].margin.left-1<=point.x&&x+this.childWidgets[i].width>=point.x){return this.childWidgets[i];}else if(i===this.childWidgets.length-1&&this.childWidgets[i].x+this.childWidgets[i].width+1<=point.x){return this.childWidgets[i];}}var cellWidget=undefined;if(this.childWidgets.length>0){if(this.childWidgets[0].x<=point.x){cellWidget=this.childWidgets[this.childWidgets.length-1].getTableCellWidget(point);}else{cellWidget=this.childWidgets[0].getTableCellWidget(point);}}return cellWidget;};/**
     * @private
     */TableRowWidget.prototype.getMinimumAndMaximumWordWidth=function(minimumWordWidth,maximumWordWidth){return{'minimumWordWidth':minimumWordWidth,'maximumWordWidth':maximumWordWidth};};/**
     * @private
     */TableRowWidget.prototype.destroyInternal=function(viewer){var height=this.height;if(!sf.base.isNullOrUndefined(this.childWidgets)){for(var i=0;i<this.childWidgets.length;i++){var widget=this.childWidgets[i];widget.destroyInternal(viewer);if(sf.base.isNullOrUndefined(this.childWidgets)){break;}i--;}this.childWidgets=undefined;}if(!sf.base.isNullOrUndefined(this.containerWidget)){if(!sf.base.isNullOrUndefined(this.containerWidget.childWidgets)){this.containerWidget.childWidgets.splice(this.containerWidget.childWidgets.indexOf(this),1);if((sf.base.isNullOrUndefined(this.containerWidget.childWidgets)||this.containerWidget.childWidgets.length===0)&&this.containerWidget instanceof TableWidget){this.containerWidget.destroyInternal(viewer);}else if(this.containerWidget.containerWidget instanceof BodyWidget){this.containerWidget.containerWidget.height-=height;}this.containerWidget.height-=height;}}this.destroy();};/**
     * @private
     */TableRowWidget.prototype.clone=function(){var row=new TableRowWidget();row.rowFormat.copyFormat(this.rowFormat);row.topBorderWidth=this.topBorderWidth;row.bottomBorderWidth=this.bottomBorderWidth;for(var i=0;i<this.childWidgets.length;i++){var cell=this.childWidgets[i].clone();row.childWidgets.push(cell);cell.containerWidget=row;cell.index=i;cell.rowIndex=this.rowIndex;}row.x=this.x;row.y=this.y;row.height=this.height;row.width=this.width;if(this.contentControlProperties){row.contentControlProperties=this.contentControlProperties;}return row;};/**
     * Updates the child widgets left.
     * @param left
     * @private
     */TableRowWidget.prototype.updateChildWidgetLeft=function(left){// TODO: Cell spacing calculation.
var spacing=0;if(this.ownerTable.tableFormat.cellSpacing>0){spacing=this.ownerTable.tableFormat.cellSpacing;}for(var i=0;i<this.childWidgets.length;i++){var cellWidget=this.childWidgets[i];left+=spacing+cellWidget.margin.left;cellWidget.x=left;cellWidget.updateChildWidgetLeft(cellWidget.x);left+=cellWidget.width+cellWidget.margin.right;}};/**
     * Shift the widgets for RTL table.
     * @param clientArea
     * @param tableWidget
     * @param rowWidget
     * @private
     */TableRowWidget.prototype.shiftWidgetForRtlTable=function(clientArea,tableWidget,rowWidget){var clientAreaX=tableWidget.x;var cellSpace=0;var tableWidth=0;if(tableWidget.tableFormat!=null&&tableWidget.tableFormat.cellSpacing>0){cellSpace=tableWidget.tableFormat.cellSpacing;}tableWidth=HelperMethods.convertPointToPixel(tableWidget.getTableWidth());var rowX=rowWidget.x;var clientAreaRight=clientAreaX+tableWidth;var left=clientAreaRight-(rowX-clientAreaX);for(var j=0;j<rowWidget.childWidgets.length;j++){var cellWidget=rowWidget.childWidgets[j];left=left-(cellWidget.width+cellWidget.margin.left+cellWidget.margin.right-cellWidget.rightBorderWidth+cellSpace);cellWidget.updateWidgetLeft(left+cellWidget.margin.left);}};/**
     * @private
     */TableRowWidget.prototype.destroy=function(){// if (this.rowFormat) {
//     this.rowFormat.destroy();
// }
this.rowFormat=undefined;this.rowFormat=undefined;this.topBorderWidth=undefined;this.bottomBorderWidth=undefined;_super.prototype.destroy.call(this);};return TableRowWidget;}(BlockWidget);/**
 * @private
 */var TableCellWidget=/** @class */function(_super){__extends$1(TableCellWidget,_super);function TableCellWidget(){var _this=_super.call(this)||this;/**
         * @private
         */_this.rowIndex=-1;_this.sizeInfoInternal=new ColumnSizeInfo();/**
         * @private
         */_this.updatedTopBorders=[];_this.margin=new Margin(_this.leftMargin,_this.topMargin,_this.rightMargin,_this.bottomMargin);_this.leftBorderWidth=0;_this.rightBorderWidth=0;_this.cellFormat=new WCellFormat(_this);return _this;}Object.defineProperty(TableCellWidget.prototype,"ownerColumn",{/**
         * @private
         */get:function get(){return this.ownerTable.tableHolder.columns[this.columnIndex];},enumerable:true,configurable:true});Object.defineProperty(TableCellWidget.prototype,"leftMargin",{/**
         * @private
         */get:function get(){if(this.cellFormat&&this.cellFormat.containsMargins()){return this.cellFormat.leftMargin;}else if(!sf.base.isNullOrUndefined(this.ownerRow)&&this.ownerRow.rowFormat.hasValue('leftMargin')){return this.ownerRow.rowFormat.leftMargin;}else if(!sf.base.isNullOrUndefined(this.ownerTable)&&!sf.base.isNullOrUndefined(this.ownerTable.tableFormat)){return this.ownerTable.tableFormat.leftMargin;}else{return 0;}},enumerable:true,configurable:true});Object.defineProperty(TableCellWidget.prototype,"topMargin",{/**
         * @private
         */get:function get(){if(this.cellFormat&&this.cellFormat.containsMargins()){return this.cellFormat.topMargin;}else if(!sf.base.isNullOrUndefined(this.ownerRow)&&this.ownerRow.rowFormat.hasValue('topMargin')){return this.ownerRow.rowFormat.topMargin;}else if(!sf.base.isNullOrUndefined(this.ownerTable)&&!sf.base.isNullOrUndefined(this.ownerTable.tableFormat)){return this.ownerTable.tableFormat.topMargin;}else{return 0;}},enumerable:true,configurable:true});Object.defineProperty(TableCellWidget.prototype,"rightMargin",{/**
         * @private
         */get:function get(){if(this.cellFormat&&this.cellFormat.containsMargins()){return this.cellFormat.rightMargin;}else if(!sf.base.isNullOrUndefined(this.ownerRow)&&this.ownerRow.rowFormat.hasValue('rightMargin')){return this.ownerRow.rowFormat.rightMargin;}else if(!sf.base.isNullOrUndefined(this.ownerTable)&&!sf.base.isNullOrUndefined(this.ownerTable.tableFormat)){return this.ownerTable.tableFormat.rightMargin;}else{return 0;}},enumerable:true,configurable:true});Object.defineProperty(TableCellWidget.prototype,"bottomMargin",{/**
         * @private
         */get:function get(){if(this.cellFormat&&this.cellFormat.containsMargins()){return this.cellFormat.bottomMargin;}else if(!sf.base.isNullOrUndefined(this.ownerRow)&&this.ownerRow.rowFormat.hasValue('bottomMargin')){return this.ownerRow.rowFormat.bottomMargin;}else if(!sf.base.isNullOrUndefined(this.ownerTable)&&!sf.base.isNullOrUndefined(this.ownerTable.tableFormat)){return this.ownerTable.tableFormat.bottomMargin;}else{return 0;}},enumerable:true,configurable:true});Object.defineProperty(TableCellWidget.prototype,"cellIndex",{/**
         * @private
         */get:function get(){if(this.ownerRow){return this.ownerRow.childWidgets.indexOf(this);}return-1;},enumerable:true,configurable:true});Object.defineProperty(TableCellWidget.prototype,"ownerTable",{/**
         * @private
         */get:function get(){if(this.containerWidget instanceof TableRowWidget){return this.containerWidget.ownerTable;}return undefined;},enumerable:true,configurable:true});Object.defineProperty(TableCellWidget.prototype,"ownerRow",{/**
         * @private
         */get:function get(){return this.containerWidget;},enumerable:true,configurable:true});Object.defineProperty(TableCellWidget.prototype,"sizeInfo",{/**
         * @private
         */get:function get(){return this.sizeInfoInternal;},enumerable:true,configurable:true});/**
     * @private
     */TableCellWidget.prototype.equals=function(widget){return widget instanceof TableCellWidget&&widget.cellFormat===this.cellFormat;};/**
     * @private
     */TableCellWidget.prototype.getContainerTable=function(){var table=this.ownerTable;while(table instanceof TableWidget&&table.associatedCell instanceof TableCellWidget){table=table.associatedCell.getContainerTable();}return table;};/**
     * @private
     */TableCellWidget.prototype.getPreviousSplitWidget=function(){if(this.containerWidget instanceof TableRowWidget){var row=this.containerWidget;do{row=row.previousRenderedWidget;if(sf.base.isNullOrUndefined(row)||row.index<this.rowIndex){break;}var previousCell=row.getCell(this.rowIndex,this.index);if(previousCell&&this.equals(previousCell)){return previousCell;}}while(row);}return undefined;};/**
     * @private
     */TableCellWidget.prototype.getNextSplitWidget=function(){var rowSpan=this.cellFormat.rowSpan;if(this.containerWidget instanceof TableRowWidget){var row=this.containerWidget;do{row=row.nextRenderedWidget;if(sf.base.isNullOrUndefined(row)||row.index>this.rowIndex+rowSpan){break;}var nextCell=row.getCell(this.rowIndex,this.index);if(nextCell&&this.equals(nextCell)){return nextCell;}}while(row);}return undefined;};/**
     * @private
     */TableCellWidget.prototype.getTableCellWidget=function(point){for(var i=0;i<this.childWidgets.length;i++){if(this.childWidgets[i].y<=point.y&&this.childWidgets[i].y+this.childWidgets[i].height>=point.y){return this.childWidgets[i].getTableCellWidget(point);}}var tableCellWidget=undefined;if(this.childWidgets.length>0){if(this.childWidgets[0].y<=point.y){tableCellWidget=this.childWidgets[this.childWidgets.length-1].getTableCellWidget(point);}else{tableCellWidget=this.childWidgets[0].getTableCellWidget(point);}}return tableCellWidget;};/**
     * @private
     */TableCellWidget.prototype.updateWidth=function(preferredWidth){if(this.cellFormat.preferredWidthType==='Point'){this.cellFormat.preferredWidth=preferredWidth;}else if(this.cellFormat.preferredWidthType==='Percent'){this.cellFormat.preferredWidth=this.convertPointToPercent(preferredWidth);}this.cellFormat.cellWidth=preferredWidth;};/**
     * @private
     */TableCellWidget.prototype.getCellWidth=function(block){var ownerTable=this.ownerTable;var containerWidth=ownerTable?ownerTable.getTableClientWidth(ownerTable.getOwnerWidth(true)):0;var cellWidth=containerWidth;var leftMargin=!sf.base.isNullOrUndefined(this.leftMargin)?this.leftMargin:0;var rightMargin=!sf.base.isNullOrUndefined(this.rightMargin)?this.rightMargin:0;if(ownerTable&&ownerTable.tableFormat.preferredWidthType==='Auto'&&ownerTable.tableFormat.allowAutoFit){if(this.cellFormat.preferredWidth===0){cellWidth=containerWidth;}else{// If cell has prefferd width, we need to consider prefferd width.
cellWidth=this.cellFormat.preferredWidth;}}else if(this.cellFormat.preferredWidthType==='Percent'){cellWidth=this.cellFormat.preferredWidth*containerWidth/100-leftMargin-rightMargin;}else if(this.cellFormat.preferredWidthType==='Point'){if(block instanceof TableWidget&&block.tableFormat.preferredWidthType==='Percent'){cellWidth=this.cellFormat.cellWidth-leftMargin-rightMargin;}else{cellWidth=this.cellFormat.preferredWidth-leftMargin-rightMargin;}}// For grid before and grid after with auto width, no need to calculate minimum preferred width.
return cellWidth;};/**
     * @private
     */TableCellWidget.prototype.convertPointToPercent=function(cellPreferredWidth){var value=0;var clientWidth=this.ownerTable.getOwnerWidth(true);var tableWidth=this.ownerTable.getTableClientWidth(clientWidth);value=cellPreferredWidth/tableWidth*100;value=Math.round(value);return value<100?value:100;// The value should be lesser than or equal to 100%;
};/**
     * @private
     */TableCellWidget.getCellLeftBorder=function(tableCell){var leftBorder=undefined;var cellBorder=tableCell.cellFormat.borders;var rowBorders=!sf.base.isNullOrUndefined(tableCell.ownerRow)?tableCell.ownerRow.rowFormat.borders:undefined;var tableBorders=!sf.base.isNullOrUndefined(tableCell.ownerTable)?tableCell.ownerTable.tableFormat.borders:undefined;if(!sf.base.isNullOrUndefined(cellBorder.left)){leftBorder=cellBorder.left;}if(sf.base.isNullOrUndefined(leftBorder)){leftBorder=tableCell.getLeftBorderToRenderByHierarchy(leftBorder,rowBorders,tableBorders);}if(tableCell.ownerTable.tableFormat.cellSpacing>0){leftBorder=tableCell.getLeftBorderToRenderByHierarchy(leftBorder,rowBorders,tableBorders);}else{var prevCell=undefined;if(!sf.base.isNullOrUndefined(tableCell.previousWidget)){// if the border is shared then choose the border based on Conflict Resolution algorithm.
prevCell=tableCell.previousWidget;}else if((tableCell.cellFormat.columnSpan>1||tableCell.columnIndex>1)&&tableCell.ownerRow.rowIndex>0){var previousRow=tableCell.ownerRow.previousWidget;while(!sf.base.isNullOrUndefined(previousRow)&&previousRow.childWidgets.length>0){for(var i=0;i<previousRow.childWidgets.length;i++){var prevRowCell=previousRow.childWidgets[i];if(prevRowCell.columnIndex+prevRowCell.cellFormat.columnSpan===tableCell.columnIndex){prevCell=previousRow.childWidgets[i];break;}}if(!sf.base.isNullOrUndefined(prevCell)){break;}previousRow=previousRow.previousWidget;}}leftBorder=tableCell.getPreviousCellLeftBorder(leftBorder,prevCell);}if(sf.base.isNullOrUndefined(leftBorder)){leftBorder=new WBorder(tableCell.cellFormat.borders);}return leftBorder;};/**
     * @private
     */TableCellWidget.prototype.getLeftBorderWidth=function(){var borderWidth=0;// Added null condition check for asynchronous loading.
if(this.cellFormat!==null&&this.cellFormat.borders!==null){// update the margins values respect to layouting of borders.
// For normal table cells only left border is rendered. for last cell left and right border is rendered.
// this border widths are not included in margins.
borderWidth=TableCellWidget.getCellLeftBorder(this).getLineWidth();// need to render rightBorder specifically for all the cells when the cellSpacing is greater than zero or for last cell of each row.
}return borderWidth;};/**
     * @private
     */TableCellWidget.prototype.getRightBorderWidth=function(){var borderWidth=0;var ownerTable=this.ownerTable;//Added null condition check for asynchronous loading.
if(this.cellFormat!==null&&this.cellFormat.borders!==null){borderWidth=TableCellWidget.getCellRightBorder(this).getLineWidth();}return borderWidth;};/**
     * @private
     */TableCellWidget.prototype.getCellSpacing=function(){var actualCellSpacing=this.ownerTable&&this.ownerTable.tableFormat?this.ownerTable.tableFormat.cellSpacing:0;var cellSpacingToLayout=actualCellSpacing;// Considers the left, right margins and border widths(only available for Layouted table) for Minimum width.
if(this.ownerRow.childWidgets.length===1){cellSpacingToLayout=actualCellSpacing*2;}else if(this.cellIndex===0||this.cellIndex===this.ownerRow.childWidgets.length-1){cellSpacingToLayout=actualCellSpacing+actualCellSpacing/2;}else{cellSpacingToLayout=actualCellSpacing;}return cellSpacingToLayout;};/**
     * @private
     */TableCellWidget.prototype.getCellSizeInfo=function(isAutoFit){var isSetWidth=true;var layout=undefined;if(!sf.base.isNullOrUndefined(this.bodyWidget)&&!sf.base.isNullOrUndefined(this.bodyWidget.page)){if(!sf.base.isNullOrUndefined(this.bodyWidget.page.documentHelper)){layout=this.bodyWidget.page.documentHelper.layout;}}if(!sf.base.isNullOrUndefined(layout)&&!sf.base.isNullOrUndefined(layout.currentCell)){isSetWidth=false;if(this===layout.currentCell){isSetWidth=true;}}// Gets the minimum preferred width for the table cell.
if(isSetWidth&&!this.sizeInfo.hasMinimumWidth){this.sizeInfo.minimumWidth=this.getMinimumPreferredWidth();}// Gets the minimum and maximum word widths.
if(isAutoFit){if(isSetWidth&&!this.sizeInfo.hasMinimumWordWidth){var size=this.getMinimumAndMaximumWordWidth(0,0);this.sizeInfo.minimumWordWidth=size.minimumWordWidth+this.sizeInfo.minimumWidth;this.sizeInfo.maximumWordWidth=size.maximumWordWidth+this.sizeInfo.minimumWidth;// if minimum and maximum width values are equal, set value as zero.
// later, preferred width value is considered for all width values.
// if (this.sizeInfo.minimumWidth === this.sizeInfo.minimumWordWidth
//     && this.sizeInfo.minimumWordWidth === this.sizeInfo.maximumWordWidth) {
//     this.sizeInfo.minimumWordWidth = 0;
//     this.sizeInfo.maximumWordWidth = 0;
//     this.sizeInfo.minimumWidth = 0;
// }
}}var sizeInfo=new ColumnSizeInfo();sizeInfo.minimumWidth=this.sizeInfo.minimumWidth;sizeInfo.minimumWordWidth=this.sizeInfo.minimumWordWidth;sizeInfo.maximumWordWidth=this.sizeInfo.maximumWordWidth;return sizeInfo;};/**
     * @private
     */TableCellWidget.prototype.getMinimumPreferredWidth=function(){var defaultWidth=0;if(this.cellFormat.preferredWidth>0&&!this.ownerTable.tableFormat.allowAutoFit||this.cellFormat.preferredWidth>0&&this.cellFormat.preferredWidthType!=='Auto'){return this.cellFormat.preferredWidth;}else if(this.cellFormat.preferredWidth===0&&this.cellFormat.preferredWidthType==='Auto'&&this.cellFormat.cellWidth!==0&&this.ownerTable&&this.ownerTable.tableFormat.preferredWidthType!=='Auto'){// Get preferred Width from cell width.
return this.cellFormat.cellWidth;}else if(this.cellFormat.preferredWidth===0&&this.cellFormat.preferredWidthType==='Auto'&&this.cellFormat.cellWidth===0&&this.previousWidget&&this.previousWidget.cellFormat.preferredWidth>0){return this.previousWidget.cellFormat.preferredWidth;}defaultWidth=this.leftMargin+this.rightMargin+this.getLeftBorderWidth()+this.getRightBorderWidth()+this.getCellSpacing();return defaultWidth;};/**
     * @private
     */TableCellWidget.prototype.getPreviousCellLeftBorder=function(leftBorder,previousCell){if(sf.base.isNullOrUndefined(previousCell)||!sf.base.isNullOrUndefined(leftBorder)&&leftBorder.lineStyle==='None'&&!leftBorder.hasNoneStyle){if(!sf.base.isNullOrUndefined(leftBorder)&&!(leftBorder.ownerBase.ownerBase instanceof WTableFormat)){leftBorder=this.getLeftBorderToRenderByHierarchy(leftBorder,TableRowWidget.getRowOf(leftBorder.ownerBase).rowFormat.borders,TableWidget.getTableOf(leftBorder.ownerBase).tableFormat.borders);}}if(sf.base.isNullOrUndefined(previousCell)){return leftBorder;}else{var prevCellRightBorder=undefined;if(!sf.base.isNullOrUndefined(previousCell.cellFormat.borders)&&!sf.base.isNullOrUndefined(previousCell.cellFormat.borders.right)&&previousCell.cellFormat.borders.right.lineStyle!=='None'){prevCellRightBorder=previousCell.cellFormat.borders.right;}if(!sf.base.isNullOrUndefined(prevCellRightBorder)&&prevCellRightBorder.lineStyle!=='None'){return this.getBorderBasedOnPriority(prevCellRightBorder,leftBorder);}else if(!sf.base.isNullOrUndefined(leftBorder)&&!(leftBorder.ownerBase.ownerBase instanceof WTableFormat)){return this.getLeftBorderToRenderByHierarchy(leftBorder,TableRowWidget.getRowOf(leftBorder.ownerBase).rowFormat.borders,TableWidget.getTableOf(leftBorder.ownerBase).tableFormat.borders);}}return leftBorder;};/**
     * @private
     */TableCellWidget.prototype.getBorderBasedOnPriority=function(border,adjacentBorder){// If the cell and its adjacent cell defined different borders then based on this algorithm the border choose to render.
// Reference link :https://msdn.microsoft.com/en-us/library/office/documentformat.openxml.wordprocessing.tablecellborders.aspx
if(sf.base.isNullOrUndefined(border)){return adjacentBorder;}else if(sf.base.isNullOrUndefined(adjacentBorder)){return border;}var borderWeight=border.getBorderWeight();var adjacentBorderWeight=adjacentBorder.getBorderWeight();//the border with higher wight  shall be displayed.
if(borderWeight===adjacentBorderWeight){//if the border is equal weight the based on the priority the border will be choosen to render.
var borderPriority=border.getPrecedence();var adjacentBorderPriority=adjacentBorder.getPrecedence();if(borderPriority===adjacentBorderPriority){//The color with the smaller brightness value shall be displayed.
var borderColInRGB=this.convertHexToRGB(border.color);var R1=borderColInRGB.r;var G1=borderColInRGB.g;var B1=borderColInRGB.b;var adjacentBorderColInRGB=this.convertHexToRGB(adjacentBorder.color);var R2=adjacentBorderColInRGB.r;var G2=adjacentBorderColInRGB.g;var B2=adjacentBorderColInRGB.b;var borderBrightness=R1+B1+2*G1;var adjacentBorderBrightness=R2+B2+2*G2;if(borderBrightness===adjacentBorderBrightness){borderBrightness=B1+2*G1;adjacentBorderBrightness=B2+2*G2;if(borderBrightness===adjacentBorderBrightness){if(G1===G2){return border;}else if(G1>G2){return adjacentBorder;}else{return border;}}else if(borderBrightness>adjacentBorderBrightness){return adjacentBorder;}else{return border;}}else if(borderBrightness>adjacentBorderBrightness){return adjacentBorder;}else{return border;}}else if(borderPriority>adjacentBorderPriority){return border;}else{return adjacentBorder;}}else if(borderWeight>adjacentBorderWeight){return border;}else{return adjacentBorder;}};/**
     * @private
     */TableCellWidget.prototype.getLeftBorderToRenderByHierarchy=function(leftBorder,rowBorders,tableBorders){if(!sf.base.isNullOrUndefined(leftBorder)&&(leftBorder.lineStyle!=='None'||leftBorder.hasNoneStyle&&//If border defined with default values then border drawn based on hierarchy. 
!(leftBorder.lineStyle==='None'&&leftBorder.lineWidth===0&&leftBorder.color==='#000000'))){return leftBorder;// tslint:disable-next-line:max-line-length
}else if(!sf.base.isNullOrUndefined(leftBorder)&&leftBorder.ownerBase instanceof WBorders&&(TableCellWidget.getCellOf(leftBorder.ownerBase).columnIndex===0||TableCellWidget.getCellOf(leftBorder.ownerBase).cellIndex===0&&TableCellWidget.getCellOf(leftBorder.ownerBase).ownerRow.rowFormat.gridBefore>0)){if(TableCellWidget.getCellOf(leftBorder.ownerBase).columnIndex!==0&&TableCellWidget.getCellOf(leftBorder.ownerBase).ownerRow.rowFormat.gridBefore<1&&!sf.base.isNullOrUndefined(rowBorders)&&!sf.base.isNullOrUndefined(rowBorders.vertical)&&rowBorders.vertical.lineStyle!=='None'){return leftBorder=rowBorders.vertical;}if(!sf.base.isNullOrUndefined(tableBorders)&&!sf.base.isNullOrUndefined(tableBorders.left)){leftBorder=tableBorders.left;}return leftBorder;}else if(!sf.base.isNullOrUndefined(rowBorders)&&!sf.base.isNullOrUndefined(rowBorders.vertical)&&rowBorders.vertical.lineStyle!=='None'){return leftBorder=rowBorders.vertical;}else if(!sf.base.isNullOrUndefined(tableBorders)&&!sf.base.isNullOrUndefined(tableBorders.vertical)&&tableBorders.vertical.lineStyle!=='None'){return leftBorder=tableBorders.vertical;}else{return leftBorder;}};/**
     * @private
     */TableCellWidget.getCellRightBorder=function(tableCell){var rightBorder=undefined;var cellBorder=tableCell.cellFormat.borders;var rowBorders=!sf.base.isNullOrUndefined(tableCell.ownerRow)?tableCell.ownerRow.rowFormat.borders:undefined;var tableBorders=!sf.base.isNullOrUndefined(tableCell.ownerTable)?tableCell.ownerTable.tableFormat.borders:undefined;if(!sf.base.isNullOrUndefined(cellBorder.right)){rightBorder=cellBorder.right;}if(sf.base.isNullOrUndefined(rightBorder)){rightBorder=tableCell.getRightBorderToRenderByHierarchy(rightBorder,rowBorders,tableBorders);}if(tableCell.ownerTable.tableFormat.cellSpacing>0){rightBorder=tableCell.getRightBorderToRenderByHierarchy(rightBorder,rowBorders,tableBorders);}else{var nextCell=undefined;if(!sf.base.isNullOrUndefined(tableCell.nextWidget)){nextCell=tableCell.nextWidget;}// if the border is shared then choose the border based on Conflict Resolution algorithm.
rightBorder=tableCell.getAdjacentCellRightBorder(rightBorder,nextCell);}if(sf.base.isNullOrUndefined(rightBorder)){rightBorder=new WBorder(tableCell.cellFormat.borders);}return rightBorder;};/**
     * @private
     */TableCellWidget.prototype.getAdjacentCellRightBorder=function(rightBorder,nextCell){if(sf.base.isNullOrUndefined(nextCell)||!sf.base.isNullOrUndefined(rightBorder)&&rightBorder.lineStyle==='None'&&!rightBorder.hasNoneStyle){if(!sf.base.isNullOrUndefined(rightBorder)&&!(rightBorder.ownerBase.ownerBase instanceof WTableFormat)){rightBorder=this.getRightBorderToRenderByHierarchy(rightBorder,TableRowWidget.getRowOf(rightBorder.ownerBase).rowFormat.borders,TableWidget.getTableOf(rightBorder.ownerBase).tableFormat.borders);}}if(sf.base.isNullOrUndefined(nextCell)){return rightBorder;}else{var nextCellLeftBorder=undefined;if(!sf.base.isNullOrUndefined(nextCell.cellFormat.borders)&&!sf.base.isNullOrUndefined(nextCell.cellFormat.borders.left)&&nextCell.cellFormat.borders.left.lineStyle!=='None'){nextCellLeftBorder=nextCell.cellFormat.borders.left;}if(!sf.base.isNullOrUndefined(nextCellLeftBorder)&&nextCellLeftBorder.lineStyle!=='None'){return this.getBorderBasedOnPriority(rightBorder,nextCellLeftBorder);}else if(!sf.base.isNullOrUndefined(rightBorder)&&!(rightBorder.ownerBase.ownerBase instanceof WTableFormat)){return this.getRightBorderToRenderByHierarchy(rightBorder,TableRowWidget.getRowOf(rightBorder.ownerBase).rowFormat.borders,TableWidget.getTableOf(rightBorder.ownerBase).tableFormat.borders);}}return rightBorder;};/**
     * @private
     */TableCellWidget.prototype.getRightBorderToRenderByHierarchy=function(rightBorder,rowBorders,tableBorders){if(!sf.base.isNullOrUndefined(rightBorder)&&(rightBorder.lineStyle!=='None'||rightBorder.hasNoneStyle&&//If border defined with default values then border drawn based on hierarchy. 
!(rightBorder.lineStyle==='None'&&rightBorder.lineWidth===0&&rightBorder.color==='#000000'))){return rightBorder;// tslint:disable-next-line:max-line-length
}else if(!sf.base.isNullOrUndefined(rightBorder)&&rightBorder.ownerBase instanceof WBorders&&TableCellWidget.getCellOf(rightBorder.ownerBase).cellIndex===TableCellWidget.getCellOf(rightBorder.ownerBase).ownerRow.childWidgets.length-1){if(!sf.base.isNullOrUndefined(tableBorders)&&!sf.base.isNullOrUndefined(tableBorders.right)){rightBorder=tableBorders.right;}return rightBorder;}else if(!sf.base.isNullOrUndefined(rowBorders)&&!sf.base.isNullOrUndefined(rowBorders.vertical)&&rowBorders.vertical.lineStyle!=='None'){return rightBorder=rowBorders.vertical;}else if(!sf.base.isNullOrUndefined(tableBorders)&&!sf.base.isNullOrUndefined(tableBorders.vertical)&&tableBorders.vertical.lineStyle!=='None'){return rightBorder=tableBorders.vertical;}else{return rightBorder;}};/**
     * @private
     */TableCellWidget.getCellTopBorder=function(tableCell){var topBorder=undefined;var cellBorder=tableCell.cellFormat.borders;var rowBorders=!sf.base.isNullOrUndefined(tableCell.ownerRow)?tableCell.ownerRow.rowFormat.borders:undefined;var tableBorders=!sf.base.isNullOrUndefined(tableCell.ownerTable)?tableCell.ownerTable.tableFormat.borders:undefined;if(!sf.base.isNullOrUndefined(cellBorder.top)){topBorder=cellBorder.top;}if(sf.base.isNullOrUndefined(topBorder)){topBorder=tableCell.getTopBorderToRenderByHierarchy(topBorder,rowBorders,tableBorders);}if(tableCell.ownerTable.tableFormat.cellSpacing>0){topBorder=tableCell.getTopBorderToRenderByHierarchy(topBorder,rowBorders,tableBorders);}else{var prevTopCell=undefined;//ToDo: Need to analyze more to get the previous cell.
var prevRow=tableCell.ownerRow.previousWidget;while(!sf.base.isNullOrUndefined(prevRow)&&prevRow.childWidgets.length>0){for(var i=0;i<prevRow.childWidgets.length;i++){var prevRowCell=prevRow.childWidgets[i];if(prevRowCell.columnIndex+prevRowCell.cellFormat.columnSpan-1>=tableCell.columnIndex){prevTopCell=prevRow.childWidgets[i];break;}}if(!sf.base.isNullOrUndefined(prevTopCell)){break;}prevRow=prevRow.previousWidget;//If all the previous rows checked and the previous top cell is null
// then TableCell previus row matched column index cell is taken for border calculation.
if(sf.base.isNullOrUndefined(prevRow)&&sf.base.isNullOrUndefined(prevTopCell)){prevRow=tableCell.ownerRow.previousWidget;if(tableCell.columnIndex<prevRow.childWidgets.length){for(var i=0;i<prevRow.childWidgets.length;i++){var prevRowCell=prevRow.childWidgets[i];if(prevRowCell.columnIndex===tableCell.columnIndex){prevTopCell=prevRow.childWidgets[i];break;}}//If table cell Column index is greater than previous row cells count then last cell is taken as previous top cell.
}else{prevTopCell=tableCell.ownerRow.previousWidget.childWidgets[tableCell.ownerRow.previousWidget.childWidgets.length-1];}}}//If the border is shared then choose the border based on Conflict Resolution algorithm.
topBorder=tableCell.getPreviousCellTopBorder(topBorder,prevTopCell);}if(sf.base.isNullOrUndefined(topBorder)){topBorder=new WBorder(tableCell.cellFormat.borders);}return topBorder;};/**
     * @private
     */TableCellWidget.prototype.getPreviousCellTopBorder=function(topBorder,previousTopCell){if(sf.base.isNullOrUndefined(previousTopCell)||!sf.base.isNullOrUndefined(topBorder)&&topBorder.lineStyle==='None'&&!topBorder.hasNoneStyle){if(!sf.base.isNullOrUndefined(topBorder)&&!(topBorder.ownerBase.ownerBase instanceof WTableFormat)){topBorder=this.getTopBorderToRenderByHierarchy(topBorder,TableRowWidget.getRowOf(topBorder.ownerBase).rowFormat.borders,TableWidget.getTableOf(topBorder.ownerBase).tableFormat.borders);}}if(sf.base.isNullOrUndefined(previousTopCell)){return topBorder;}else{var prevTopCellBottomBorder=undefined;if(!sf.base.isNullOrUndefined(previousTopCell.cellFormat.borders)&&!sf.base.isNullOrUndefined(previousTopCell.cellFormat.borders.bottom)&&previousTopCell.cellFormat.borders.bottom.lineStyle!=='None'){prevTopCellBottomBorder=previousTopCell.cellFormat.borders.bottom;}if(!sf.base.isNullOrUndefined(prevTopCellBottomBorder)&&prevTopCellBottomBorder.lineStyle!=='None'){return this.getBorderBasedOnPriority(topBorder,prevTopCellBottomBorder);}else if(!sf.base.isNullOrUndefined(topBorder)&&!(topBorder.ownerBase.ownerBase instanceof WTableFormat)){return this.getTopBorderToRenderByHierarchy(topBorder,TableRowWidget.getRowOf(topBorder.ownerBase).rowFormat.borders,TableWidget.getTableOf(topBorder.ownerBase).tableFormat.borders);}}return topBorder;};/**
     * @private
     */TableCellWidget.prototype.getTopBorderToRenderByHierarchy=function(topBorder,rowBorders,tableBorders){if(!sf.base.isNullOrUndefined(topBorder)&&(topBorder.lineStyle!=='None'||topBorder.hasNoneStyle&&//If border defined with default values then border drawn based on hierarchy. 
!(topBorder.lineStyle==='None'&&topBorder.lineWidth===0&&topBorder.color==='#000000'))){return topBorder;}else if(!sf.base.isNullOrUndefined(topBorder)&&topBorder.ownerBase instanceof WBorders&&TableCellWidget.getCellOf(topBorder.ownerBase).ownerRow.rowIndex===0){if(!sf.base.isNullOrUndefined(tableBorders)&&!sf.base.isNullOrUndefined(tableBorders.top)){topBorder=tableBorders.top;}return topBorder;}else if(!sf.base.isNullOrUndefined(rowBorders)&&!sf.base.isNullOrUndefined(rowBorders.horizontal)&&rowBorders.horizontal.lineStyle!=='None'){return topBorder=rowBorders.horizontal;}else if(!sf.base.isNullOrUndefined(tableBorders)&&!sf.base.isNullOrUndefined(tableBorders.horizontal)&&tableBorders.horizontal.lineStyle!=='None'){return topBorder=tableBorders.horizontal;}else{return topBorder;}};/**
     * @private
     */TableCellWidget.getCellBottomBorder=function(tableCell){var bottomBorder=undefined;var cellBorder=tableCell.cellFormat.borders;var rowBorders=!sf.base.isNullOrUndefined(tableCell.ownerRow)?tableCell.ownerRow.rowFormat.borders:undefined;var tableBorders=!sf.base.isNullOrUndefined(tableCell.ownerTable)?tableCell.ownerTable.tableFormat.borders:undefined;if(!sf.base.isNullOrUndefined(cellBorder.bottom)){bottomBorder=cellBorder.bottom;}if(sf.base.isNullOrUndefined(bottomBorder)){bottomBorder=tableCell.getBottomBorderToRenderByHierarchy(bottomBorder,rowBorders,tableBorders);// select the left border based on heirarchy.
}if(tableCell.ownerTable.tableFormat.cellSpacing>0){bottomBorder=tableCell.getBottomBorderToRenderByHierarchy(bottomBorder,rowBorders,tableBorders);}else{var nextBottomCell=undefined;var nextRow=tableCell.ownerRow.nextWidget;if(!sf.base.isNullOrUndefined(nextRow)&&tableCell.columnIndex<nextRow.childWidgets.length){nextBottomCell=nextRow.childWidgets[tableCell.columnIndex];}//If the border is shared then choose the border based on Conflict Resolution algorithm.
bottomBorder=tableCell.getAdjacentCellBottomBorder(bottomBorder,nextBottomCell);}if(sf.base.isNullOrUndefined(bottomBorder)){bottomBorder=new WBorder(tableCell.cellFormat.borders);}return bottomBorder;};/**
     * @private
     */TableCellWidget.prototype.getAdjacentCellBottomBorder=function(bottomBorder,nextBottomCell){if(sf.base.isNullOrUndefined(nextBottomCell)||!sf.base.isNullOrUndefined(bottomBorder)&&bottomBorder.lineStyle==='None'&&!bottomBorder.hasNoneStyle){if(!sf.base.isNullOrUndefined(bottomBorder)&&!(bottomBorder.ownerBase.ownerBase instanceof WTableFormat)){bottomBorder=this.getBottomBorderToRenderByHierarchy(bottomBorder,TableRowWidget.getRowOf(bottomBorder.ownerBase).rowFormat.borders,TableWidget.getTableOf(bottomBorder.ownerBase).tableFormat.borders);}}if(sf.base.isNullOrUndefined(nextBottomCell)){return bottomBorder;}else{var prevBottomCellTopBorder=undefined;if(!sf.base.isNullOrUndefined(nextBottomCell.cellFormat.borders)&&!sf.base.isNullOrUndefined(nextBottomCell.cellFormat.borders.top)&&nextBottomCell.cellFormat.borders.top.lineStyle!=='None'){prevBottomCellTopBorder=nextBottomCell.cellFormat.borders.top;}if(!sf.base.isNullOrUndefined(prevBottomCellTopBorder)&&prevBottomCellTopBorder.lineStyle!=='None'){return this.getBorderBasedOnPriority(bottomBorder,prevBottomCellTopBorder);}else if(!sf.base.isNullOrUndefined(bottomBorder)&&!(bottomBorder.ownerBase.ownerBase instanceof WTableFormat)){return this.getBottomBorderToRenderByHierarchy(bottomBorder,TableRowWidget.getRowOf(bottomBorder.ownerBase).rowFormat.borders,TableWidget.getTableOf(bottomBorder.ownerBase).tableFormat.borders);}}return bottomBorder;};/**
     * @private
     */TableCellWidget.prototype.getBottomBorderToRenderByHierarchy=function(bottomBorder,rowBorders,tableBorders){if(!sf.base.isNullOrUndefined(bottomBorder)&&(bottomBorder.lineStyle!=='None'||bottomBorder.hasNoneStyle&&//If border defined with default values then border drawn based on hierarchy. 
!(bottomBorder.lineStyle==='None'&&bottomBorder.lineWidth===0&&bottomBorder.color==='#000000'))){return bottomBorder;}else if(!sf.base.isNullOrUndefined(bottomBorder)&&bottomBorder.ownerBase instanceof WBorders&&TableCellWidget.getCellOf(bottomBorder.ownerBase).ownerRow.rowIndex+TableCellWidget.getCellOf(bottomBorder.ownerBase).cellFormat.rowSpan===TableCellWidget.getCellOf(bottomBorder.ownerBase).ownerTable.childWidgets.length){if(!sf.base.isNullOrUndefined(tableBorders)&&!sf.base.isNullOrUndefined(tableBorders.bottom)){bottomBorder=tableBorders.bottom;}return bottomBorder;}else if(!sf.base.isNullOrUndefined(rowBorders)&&!sf.base.isNullOrUndefined(rowBorders.horizontal)&&rowBorders.horizontal.lineStyle!=='None'){return bottomBorder=rowBorders.horizontal;}else if(!sf.base.isNullOrUndefined(tableBorders)&&!sf.base.isNullOrUndefined(tableBorders.horizontal)&&tableBorders.horizontal.lineStyle!=='None'){return bottomBorder=tableBorders.horizontal;}else{return bottomBorder;}};TableCellWidget.prototype.convertHexToRGB=function(colorCode){if(colorCode){colorCode=colorCode.replace(/[^0-9A-F]/gi,'');// To remove # from color code string.
var colCodeNo=parseInt(colorCode,16);var r=colCodeNo>>16&255;var g=colCodeNo>>8&255;var b=colCodeNo&255;return{'r':r,'g':g,'b':b};}return undefined;};/**
     * @private
     */TableCellWidget.getCellOf=function(node){if(node instanceof WBorders){if(node.ownerBase instanceof WCellFormat&&node.ownerBase.ownerBase instanceof TableCellWidget){return node.ownerBase.ownerBase;}else{return undefined;}}return undefined;};/**
     * Updates the Widget left.
     * @private
     */TableCellWidget.prototype.updateWidgetLeft=function(x){this.x=x;this.updateChildWidgetLeft(x);};/**
     * @private
     */TableCellWidget.prototype.updateChildWidgetLeft=function(left){for(var i=0;i<this.childWidgets.length;i++){this.childWidgets[i].x=left;if(this.childWidgets[i]instanceof TableWidget){var tableWidget=this.childWidgets[i];tableWidget.updateChildWidgetLeft(left);if(tableWidget.isBidiTable){var clientArea=new Rect(tableWidget.x,tableWidget.y,tableWidget.width,tableWidget.height);tableWidget.shiftWidgetsForRtlTable(clientArea,tableWidget);}}}};/**
     * @private
     */TableCellWidget.prototype.getMinimumAndMaximumWordWidth=function(minimumWordWidth,maximumWordWidth){for(var i=0;i<this.childWidgets.length;i++){var block=this.childWidgets[i];var widthInfo=block.getMinimumAndMaximumWordWidth(minimumWordWidth,maximumWordWidth);minimumWordWidth=widthInfo.minimumWordWidth;maximumWordWidth=widthInfo.maximumWordWidth;}return{'minimumWordWidth':minimumWordWidth,'maximumWordWidth':maximumWordWidth};};/**
     * @private
     */TableCellWidget.prototype.destroyInternal=function(viewer){// let viewer: LayoutViewer = undefined;
// let page: Page = this.getPage();
// if (!isNullOrUndefined(page ))
//     viewer = page.viewer;
if(!sf.base.isNullOrUndefined(this.childWidgets)){for(var i=0;i<this.childWidgets.length;i++){var widget=this.childWidgets[i];if(widget instanceof ParagraphWidget){widget.destroyInternal(viewer);}else{widget.destroyInternal(viewer);}i--;}this.childWidgets=undefined;}this.destroy();};/**
     * @private
     */TableCellWidget.prototype.clone=function(){var cell=new TableCellWidget();cell.cellFormat.copyFormat(this.cellFormat);for(var i=0;i<this.childWidgets.length;i++){var block=this.childWidgets[i].clone();cell.childWidgets.push(block);block.containerWidget=cell;block.index=i;}cell.leftBorderWidth=this.leftBorderWidth;cell.rightBorderWidth=this.rightBorderWidth;if(this.margin){cell.margin=this.margin.clone();}cell.columnIndex=this.columnIndex;cell.x=this.x;cell.y=this.y;cell.height=this.height;cell.width=this.width;if(this.contentControlProperties){cell.contentControlProperties=this.contentControlProperties;}return cell;};/**
     * @private
     */TableCellWidget.prototype.destroy=function(){// if (this.cellFormat) {
//     this.cellFormat.destroy();
// }
this.cellFormat=undefined;this.rowIndex=undefined;this.columnIndex=undefined;_super.prototype.destroy.call(this);};return TableCellWidget;}(BlockWidget);/**
 * @private
 */var LineWidget=/** @class */function(){/**
     * Initialize the constructor of LineWidget
     */function LineWidget(paragraphWidget){/**
         * @private
         */this.children=[];/**
         * @private
         */this.x=0;/**
         * @private
         */this.y=0;/**
         * @private
         */this.width=0;/**
         * @private
         */this.height=0;/**
         * @private
         */this.marginTop=0;this.paragraph=paragraphWidget;}Object.defineProperty(LineWidget.prototype,"indexInOwner",{/**
         * @private
         */get:function get(){if(this.paragraph&&this.paragraph.childWidgets){return this.paragraph.childWidgets.indexOf(this);}return-1;},enumerable:true,configurable:true});Object.defineProperty(LineWidget.prototype,"nextLine",{/**
         * @private
         */get:function get(){var paragraph=this.paragraph;var lineIndex=this.indexInOwner;if(lineIndex<=paragraph.childWidgets.length-2){return paragraph.childWidgets[lineIndex+1];}else if(paragraph.nextSplitWidget){var line=paragraph.nextSplitWidget.firstChild;if(line instanceof LineWidget&&line.paragraph.equals(this.paragraph)){return line;}}return undefined;},enumerable:true,configurable:true});Object.defineProperty(LineWidget.prototype,"previousLine",{/**
         * @private
         */get:function get(){var paragraph=this.paragraph;var lineIndex=this.indexInOwner;var splitParagraph=paragraph.previousSplitWidget;if(lineIndex>0){return paragraph.childWidgets[lineIndex-1];}else if(splitParagraph instanceof ParagraphWidget){var line=splitParagraph.lastChild;if(line instanceof LineWidget&&line.paragraph.equals(this.paragraph)){return line;}}return undefined;},enumerable:true,configurable:true});Object.defineProperty(LineWidget.prototype,"isEndsWithPageBreak",{/**
         * @private
         */get:function get(){if(this.children.length>0){var lastElement=this.children[this.children.length-1];if(lastElement instanceof TextElementBox){return lastElement.isPageBreak;}}return false;},enumerable:true,configurable:true});/**
     * @private
     */LineWidget.prototype.isFirstLine=function(){var index=this.indexInOwner;if(index>-1&&(this.paragraph.previousSplitWidget===undefined||this.paragraph.previousSplitWidget instanceof ParagraphWidget&&this.paragraph.previousSplitWidget.isEndsWithPageBreak)){return index===0;}return false;};/**
     * @private
     */LineWidget.prototype.isLastLine=function(){var index=this.indexInOwner;if(index>-1&&this.paragraph.nextSplitWidget===undefined){return index===this.paragraph.childWidgets.length-1;}return false;};/**
     * @private
     */LineWidget.prototype.getOffset=function(inline,index){if(sf.base.isNullOrUndefined(inline)){return index;}var textIndex=index;var line=inline.line;var lineIndex=inline.line.paragraph.childWidgets.indexOf(inline.line);var bidi=line.paragraph.bidi;var isContainsRtl=this.paragraph.bodyWidget.page.documentHelper.layout.isContainsRtl(this);if(!bidi&&!isContainsRtl){for(var i=0;i<line.children.length;i++){var inlineElement=line.children[i];if(inline===inlineElement){break;}if(inlineElement instanceof ListTextElementBox){continue;}textIndex+=inlineElement.length;}}else if(bidi){var elementInfo=this.getInlineForOffset(textIndex,true,inline);textIndex=elementInfo.index;}else{var elementInfo=this.getInlineForRtlLine(textIndex,true,inline);textIndex=elementInfo.index;}return textIndex;};/**
     * @private
     */LineWidget.prototype.getEndOffset=function(){var startOffset=0;var count=0;// let line: LineWidget = this.line as LineWidget;
// let lineIndex: number = thtis.line.paragraph.childWidgets.indexOf(inline.line);
var bidi=this.paragraph.bidi||this.paragraph.bodyWidget.page.documentHelper.layout.isContainsRtl(this);if(!bidi){for(var i=0;i<this.children.length;i++){var inlineElement=this.children[i];if(inlineElement.length===0){continue;}if(inlineElement instanceof ListTextElementBox){continue;}if(inlineElement instanceof TextElementBox||inlineElement instanceof EditRangeStartElementBox||inlineElement instanceof ImageElementBox||inlineElement instanceof EditRangeEndElementBox||inlineElement instanceof BookmarkElementBox||inlineElement instanceof ContentControl||inlineElement instanceof FieldElementBox&&HelperMethods.isLinkedFieldCharacter(inlineElement)){startOffset=count+inlineElement.length;}count+=inlineElement.length;}}else{var elementInfo=this.getInlineForOffset(startOffset,false,this.children[0],true);startOffset=elementInfo.index;}return startOffset;};/**
     * @private
     * @param offset
     * @param isOffset
     * @param inline
     * @param isEndOffset
     */LineWidget.prototype.getInlineForOffset=function(offset,isOffset,inline,isEndOffset,isPrevOffset,isNxtOffset){var startElement=this.children[this.children.length-1];var endElement;var element=startElement;var documentHelper=this.paragraph.bodyWidget.page.documentHelper;var textHelper=documentHelper.textHelper;var isApplied=false;var count=0;var lineLength=documentHelper.selection.getLineLength(this);var validOffset=0;while(element){if(!endElement&&!(element instanceof TabElementBox&&element.text==='\t')&&(element instanceof TextElementBox&&!textHelper.isRTLText(element.text)&&!((textHelper.containsSpecialCharAlone(element.text)||/^[0-9]+$/.test(element.text))&&element.characterFormat.bidi)||!(element instanceof TextElementBox))){while(element.previousElement&&(element.previousElement instanceof TextElementBox&&!textHelper.isRTLText(element.previousElement.text)&&!((textHelper.containsSpecialCharAlone(element.previousElement.text)||/^[0-9]+$/.test(element.previousElement.text))&&element.previousElement.characterFormat.bidi)||element.previousElement instanceof FieldElementBox||element.previousElement instanceof BookmarkElementBox||element.previousElement instanceof CommentCharacterElementBox&&!sf.base.isNullOrUndefined(element.previousElement.previousElement)&&!(element.previousElement.previousElement instanceof BookmarkElementBox)||element.previousElement instanceof BookmarkElementBox||element.previousElement instanceof CommentCharacterElementBox&&element.previousElement.previousElement instanceof BookmarkElementBox&&!sf.base.isNullOrUndefined(element.previousElement.previousElement.previousElement)||element instanceof BookmarkElementBox&&element.previousElement instanceof BookmarkElementBox&&!sf.base.isNullOrUndefined(element.previousElement.previousElement)||element.previousElement instanceof ListTextElementBox||element.previousElement instanceof EditRangeEndElementBox||element.previousElement instanceof EditRangeStartElementBox||element.previousElement instanceof CommentCharacterElementBox||element.previousElement instanceof ImageElementBox)){isApplied=true;element=element.previousElement;continue;}if(element.previousElement&&(isApplied||element.previousElement instanceof TextElementBox&&(textHelper.isRTLText(element.previousElement.text)||(textHelper.containsSpecialCharAlone(element.previousElement.text)||/^[0-9]+$/.test(element.previousElement.text))&&element.previousElement.characterFormat.bidi))){endElement=element.previousElement;}else if(!element.previousElement){if(element instanceof ListTextElementBox||element instanceof CommentCharacterElementBox){break;}endElement=element;}if(element instanceof ListTextElementBox&&endElement){element=endElement;endElement=undefined;}}if(isOffset&&!sf.base.isNullOrUndefined(inline)){if(inline===element){return{'element':element,'index':offset};}offset+=element.length;}else if(isEndOffset){offset+=element.length;if(offset===lineLength){return{'element':element,'index':offset};}else if(offset>lineLength){return{'element':element,'index':lineLength};}}else if(isNxtOffset){if(offset<count+element.length){if(element instanceof TextElementBox||element instanceof ImageElementBox||element instanceof FieldElementBox&&HelperMethods.isLinkedFieldCharacter(element)){return{'element':element,'index':(offset>count?offset:count)+1};}}count+=element.length;}else{if(offset<=count+element.length){return{'element':element,'index':isPrevOffset?offset-1===count?validOffset:offset-1:offset-count};}if(isPrevOffset&&(element instanceof TextElementBox||element instanceof ImageElementBox||element instanceof FieldElementBox&&HelperMethods.isLinkedFieldCharacter(element))){validOffset=count+element.length;}count+=element.length;}if(element.previousElement&&(element instanceof TextElementBox&&(textHelper.isRTLText(element.text)||(textHelper.containsSpecialCharAlone(element.text)||/^[0-9]+$/.test(element.text))&&element.characterFormat.bidi)||element instanceof TabElementBox&&element.text==='\t'||element instanceof BookmarkElementBox&&(element instanceof BookmarkElementBox&&element.previousElement instanceof BookmarkElementBox&&!element.previousElement.previousElement||element.bookmarkType===1&&!element.previousElement))){if((offset===count+1||offset>count+1)&&count===lineLength&&!element.previousElement){break;}element=element.previousElement;}else{if(endElement&&(!element.nextElement||element===startElement||element.nextElement instanceof TextElementBox&&(textHelper.isRTLText(element.nextElement.text)||(textHelper.containsSpecialCharAlone(element.nextElement.text)||/^[0-9]+$/.test(element.nextElement.text))&&element.nextElement.characterFormat.bidi)||element.nextElement instanceof ListTextElementBox)){if(offset===count+1&&count===lineLength){break;}element=endElement;endElement=undefined;isApplied=false;}else{if((endElement===element||offset===count+1)&&!element.previousElement&&count===lineLength){break;}element=element.nextElement;}}}if(isNxtOffset){return{'element':element,'index':offset};}else if(isPrevOffset){return{'element':element,'index':-1};}else{return{'element':element,'index':isEndOffset?offset:0};}};LineWidget.prototype.getInlineForRtlLine=function(offset,isOffset,inline){var startElement=this.children[0];var endElement;var element=startElement;var documentHelper=this.paragraph.bodyWidget.page.documentHelper;var textHelper=documentHelper.textHelper;var isUpdated=false;var count=0;var lineLength=documentHelper.selection.getLineLength(this);var lastRtlIndex=-1;var indexInInline=-1;var isStarted=false;while(element){if(element instanceof ListTextElementBox){element=element.nextElement;continue;}if(!isStarted&&(element instanceof TextElementBox||element instanceof ImageElementBox||element instanceof BookmarkElementBox||element instanceof EditRangeEndElementBox||element instanceof EditRangeStartElementBox||element instanceof FieldElementBox&&HelperMethods.isLinkedFieldCharacter(element))){isStarted=true;}if(!endElement){while(element&&element instanceof TextElementBox&&(textHelper.isRTLText(element.text)||textHelper.containsSpecialCharAlone(element.text))){if(!endElement){endElement=element;}lastRtlIndex=this.children.indexOf(element);element=element.nextElement;isUpdated=true;}}if(lastRtlIndex!==-1&&isUpdated){element=this.children[lastRtlIndex];}if(isOffset&&!sf.base.isNullOrUndefined(inline)){if(inline===element){return{'element':element,'index':offset};}offset+=element.length;}else{if(isStarted&&offset<=count+element.length){indexInInline=offset-count;return{'element':element,'index':indexInInline};}count+=element.length;}if(endElement===element){endElement=undefined;if(lastRtlIndex!==-1){element=this.children[lastRtlIndex];}lastRtlIndex=-1;}if(endElement&&element.previousElement){element=element.previousElement;}else if(element.nextElement){element=element.nextElement;}else{if(offset>count){indexInInline=sf.base.isNullOrUndefined(element)?offset:element.length;}return{'element':element,'index':indexInInline};}isUpdated=false;}return{'element':element,'index':indexInInline};};/**
     * @private
     */LineWidget.prototype.getInline=function(offset,indexInInline,bidi,isInsert){bidi=sf.base.isNullOrUndefined(bidi)?this.paragraph.bidi:bidi;var inlineElement=undefined;var count=0;var isStarted=false;if(this.children.length===0){if(this.previousLine){var elementBox=this.previousLine.children[this.previousLine.children.length-1];if(elementBox instanceof TextElementBox&&elementBox.text==='\v'){inlineElement=this.previousLine.children[this.previousLine.children.length-1];indexInInline=1;return{'element':inlineElement,'index':indexInInline};}}}var isContainsRtl=this.paragraph.bodyWidget.page.documentHelper.layout.isContainsRtl(this);if(!bidi&&!isContainsRtl){for(var i=0;i<this.children.length;i++){inlineElement=this.children[i];if(inlineElement instanceof ListTextElementBox){continue;}if(!isStarted&&(inlineElement instanceof TextElementBox||inlineElement instanceof ImageElementBox||inlineElement instanceof ShapeElementBox||inlineElement instanceof ContentControl||inlineElement instanceof BookmarkElementBox||inlineElement instanceof EditRangeEndElementBox||inlineElement instanceof EditRangeStartElementBox||inlineElement instanceof CommentCharacterElementBox||inlineElement instanceof FieldElementBox&&HelperMethods.isLinkedFieldCharacter(inlineElement))){isStarted=true;}if(isStarted&&offset<=count+inlineElement.length){//if (inlineElement instanceof BookmarkElementBox) {
//    offset += inlineElement.length;
//    count += inlineElement.length;
//    continue;
//}
if(inlineElement instanceof TextElementBox&&inlineElement.text===' '&&inlineElement.revisions.length===0&&isInsert){var currentElement=this.getNextTextElement(this,i+1);inlineElement=!sf.base.isNullOrUndefined(currentElement)?currentElement:inlineElement;indexInInline=sf.base.isNullOrUndefined(currentElement)?offset-count:0;return{'element':inlineElement,'index':indexInInline};}else if(offset===count+inlineElement.length&&this.children[i+1]instanceof FootnoteElementBox){return{'element':this.children[i+1],'index':indexInInline};}else{indexInInline=offset-count;}return{'element':inlineElement,'index':indexInInline};}count+=inlineElement.length;}if(offset>count){indexInInline=sf.base.isNullOrUndefined(inlineElement)?offset:inlineElement.length;}}else if(bidi){var elementInfo=this.getInlineForOffset(offset);inlineElement=elementInfo.element;indexInInline=elementInfo.index;}else{var elementInfo=this.getInlineForRtlLine(offset);inlineElement=elementInfo.element;indexInInline=elementInfo.index;}return{'element':inlineElement,'index':indexInInline};};/**
     * Method to retrieve next element
     * @param line
     * @param index
     */LineWidget.prototype.getNextTextElement=function(line,index){if(index<line.children.length-1&&line.children[index]){return line.children[index];}return null;};/**
     * @private
     */LineWidget.prototype.getHierarchicalIndex=function(hierarchicalIndex){var node=this;hierarchicalIndex=node.paragraph.childWidgets.indexOf(node)+';'+hierarchicalIndex;if(node.paragraph instanceof BlockWidget){return node.paragraph.getHierarchicalIndex(hierarchicalIndex);}return hierarchicalIndex;};/**
     * @private
     */LineWidget.prototype.clone=function(){var line=new LineWidget(undefined);for(var j=0;j<this.children.length;j++){var element=this.children[j];var clone=element.clone();line.children.push(clone);clone.line=line;}line.width=this.width;line.height=this.height;return line;};/**
     * @private
     */LineWidget.prototype.destroy=function(){if(!sf.base.isNullOrUndefined(this.children)){for(var i=0;i<this.children.length;i++){this.children[i].destroy();}this.children=[];}this.children=undefined;if(this.paragraph){this.paragraph.removeChild(this.indexInOwner);}this.paragraph=undefined;this.x=undefined;this.y=undefined;this.width=undefined;this.height=undefined;};return LineWidget;}();/**
 * @private
 */var ElementBox=/** @class */function(){/**
     * Initialize the constructor of ElementBox
     */function ElementBox(){/**
         * @private
         */this.x=0;/**
         * @private
         */this.y=0;/**
         * @private
         */this.width=0;/**
         * @private
         */this.height=0;/**
         * @private
         */this.margin=new Margin(0,0,0,0);/**
         * @private
         */this.padding=new Margin(0,0,0,0);/**
         * @private
         */this.characterFormat=undefined;/**
         * @private
         */this.isRightToLeft=false;/**
         * @private
         */this.canTrigger=false;/**
         * @private
         */this.ischangeDetected=false;/**
         * @private
         */this.isVisible=false;/**
         * @private
         */this.isSpellChecked=false;/**
         * @private
         */this.revisions=[];/**
         * @private
         */this.canTrack=false;/**
         * @private
         */this.removedIds=[];/**
         * @private
         */this.isMarkedForRevision=false;this.characterFormat=new WCharacterFormat(this);this.margin=new Margin(0,0,0,0);}Object.defineProperty(ElementBox.prototype,"isPageBreak",{/**
         * @private
         */get:function get(){if(this instanceof TextElementBox){return this.text==='\f';}return false;},enumerable:true,configurable:true});Object.defineProperty(ElementBox.prototype,"isValidNodeForTracking",{/**
         * @private
         * Method to indicate whether current element is trackable.
         */get:function get(){if(this instanceof BookmarkElementBox||this instanceof CommentCharacterElementBox||this instanceof EditRangeStartElementBox||this instanceof EditRangeEndElementBox||this instanceof ContentControl){return false;}return true;},enumerable:true,configurable:true});/**
     * @private
     */ElementBox.prototype.linkFieldCharacter=function(documentHelper){if(!(this instanceof FieldElementBox)){return;}if(this.fieldType===0){var fieldBegin=this;if(sf.base.isNullOrUndefined(fieldBegin.fieldEnd)){this.linkFieldTraversingForward(this.line,fieldBegin,fieldBegin);if(documentHelper.fields.indexOf(fieldBegin)===-1){documentHelper.fields.push(fieldBegin);}if(!sf.base.isNullOrUndefined(fieldBegin.formFieldData)&&documentHelper.formFields.indexOf(fieldBegin)===-1){documentHelper.formFields.push(fieldBegin);}}}else if(this.fieldType===2){var fieldSeparator=this;//Links the field begin for the current separator.
if(sf.base.isNullOrUndefined(fieldSeparator.fieldBegin)){this.linkFieldTraversingBackwardSeparator(this.line,fieldSeparator,fieldSeparator);}if(!sf.base.isNullOrUndefined(fieldSeparator.fieldBegin)){fieldSeparator.fieldBegin.fieldSeparator=fieldSeparator;//Links to field end traversing from field separator.
var isFieldEnd=this.linkFieldTraversingForward(this.line,fieldSeparator.fieldBegin,fieldSeparator);if(sf.base.isNullOrUndefined(fieldSeparator.fieldEnd)&&isFieldEnd){fieldSeparator.fieldEnd=fieldSeparator.fieldBegin.fieldEnd;}if(fieldSeparator.fieldEnd){fieldSeparator.fieldEnd.fieldSeparator=fieldSeparator;}}}else{var fieldEnd=this;//Links the field begin and separator for the current end.
if(sf.base.isNullOrUndefined(fieldEnd.fieldBegin)){this.linkFieldTraversingBackward(this.line,fieldEnd,fieldEnd);}}};/**
     * @private
     */ElementBox.prototype.linkFieldTraversingBackward=function(line,fieldEnd,previousNode){var k=line.children.length-1;if(line.children.indexOf(previousNode)>-1){k=line.children.indexOf(previousNode)-1;}for(var j=k;j>=0;j--){var childNode=line.children[j];if(childNode instanceof FieldElementBox){if(childNode.fieldType===0){if(sf.base.isNullOrUndefined(childNode.fieldEnd)){fieldEnd.fieldBegin=childNode;if(sf.base.isNullOrUndefined(childNode.fieldEnd)){childNode.fieldEnd=fieldEnd;}if(fieldEnd.fieldSeparator&&sf.base.isNullOrUndefined(fieldEnd.fieldSeparator.fieldBegin)){fieldEnd.fieldSeparator.fieldBegin=childNode;if(sf.base.isNullOrUndefined(childNode.fieldSeparator)){childNode.fieldSeparator=fieldEnd.fieldSeparator;}}return!sf.base.isNullOrUndefined(fieldEnd.fieldBegin);}}else if(childNode.fieldType===2&&sf.base.isNullOrUndefined(childNode.fieldEnd)){fieldEnd.fieldSeparator=childNode;childNode.fieldEnd=fieldEnd;if(!sf.base.isNullOrUndefined(childNode.fieldBegin)){fieldEnd.fieldBegin=childNode.fieldBegin;}}}}if(line.previousLine){this.linkFieldTraversingBackward(line.previousLine,fieldEnd,this);}else if(line.paragraph.previousRenderedWidget instanceof ParagraphWidget&&line.paragraph.previousRenderedWidget.childWidgets.length>0){var prevParagraph=line.paragraph.previousRenderedWidget;this.linkFieldTraversingBackward(prevParagraph.childWidgets[prevParagraph.childWidgets.length-1],fieldEnd,this);}return true;};/**
     * @private
     */ElementBox.prototype.linkFieldTraversingForward=function(line,fieldBegin,previousNode){var i=0;if(line.children.indexOf(previousNode)>-1){i=line.children.indexOf(previousNode)+1;}for(var j=i;j<line.children.length;j++){var node=line.children[j];if(node instanceof FieldElementBox){if(node.fieldType===1){if(sf.base.isNullOrUndefined(node.fieldBegin)){fieldBegin.fieldEnd=node;}if(fieldBegin.fieldEnd&&sf.base.isNullOrUndefined(fieldBegin.fieldEnd.fieldBegin)){fieldBegin.fieldEnd.fieldBegin=fieldBegin;}return true;}else if(sf.base.isNullOrUndefined(fieldBegin.fieldSeparator)){if(node.fieldType===2&&sf.base.isNullOrUndefined(node.fieldBegin)){fieldBegin.fieldSeparator=node;if(fieldBegin.fieldSeparator&&sf.base.isNullOrUndefined(fieldBegin.fieldSeparator.fieldBegin)){fieldBegin.fieldSeparator.fieldBegin=fieldBegin;}if(!sf.base.isNullOrUndefined(node.fieldEnd)){fieldBegin.fieldEnd=node.fieldEnd;fieldBegin.fieldSeparator.fieldEnd=fieldBegin.fieldEnd;return true;}}else{return false;}}}}if(line.nextLine){this.linkFieldTraversingForward(line.nextLine,fieldBegin,this);}else if(line.paragraph.nextRenderedWidget instanceof ParagraphWidget&&line.paragraph.nextRenderedWidget.childWidgets.length>0){this.linkFieldTraversingForward(line.paragraph.nextRenderedWidget.childWidgets[0],fieldBegin,this);}return true;};/**
     * @private
     */ElementBox.prototype.linkFieldTraversingBackwardSeparator=function(line,fieldSeparator,previousNode){var index=line.children.length-1;if(line.children.indexOf(previousNode)>-1){index=line.children.indexOf(previousNode)-1;}for(var i=index;i>=0;i--){var childElement=line.children[i];if(childElement instanceof FieldElementBox){if(childElement instanceof FieldElementBox&&childElement.fieldType===0){if(sf.base.isNullOrUndefined(childElement.fieldSeparator)){fieldSeparator.fieldBegin=childElement;}return!sf.base.isNullOrUndefined(fieldSeparator.fieldBegin);}}}if(line.previousLine){this.linkFieldTraversingBackwardSeparator(line.previousLine,fieldSeparator,this);}else if(line.paragraph.previousRenderedWidget instanceof ParagraphWidget&&line.paragraph.previousRenderedWidget.childWidgets.length>0){line=line.paragraph.previousRenderedWidget.childWidgets[line.paragraph.previousRenderedWidget.childWidgets.length-1];this.linkFieldTraversingBackwardSeparator(line,fieldSeparator,this);}else{return true;}return true;};Object.defineProperty(ElementBox.prototype,"length",{/**
         * @private
         */get:function get(){return this.getLength();},enumerable:true,configurable:true});Object.defineProperty(ElementBox.prototype,"indexInOwner",{/**
         * @private
         */get:function get(){return this.line instanceof LineWidget&&this.line.children?this.line.children.indexOf(this):-1;},enumerable:true,configurable:true});Object.defineProperty(ElementBox.prototype,"previousElement",{/**
         * @private
         */get:function get(){var index=this.indexInOwner;if(index>0&&index<this.line.children.length){return this.line.children[index-1];}return undefined;},enumerable:true,configurable:true});Object.defineProperty(ElementBox.prototype,"nextElement",{/**
         * @private
         */get:function get(){var index=this.indexInOwner;if(index>-1&&index<this.line.children.length-1){return this.line.children[index+1];}return undefined;},enumerable:true,configurable:true});Object.defineProperty(ElementBox.prototype,"nextNode",{/**
         * @private
         */get:function get(){var index=this.line.children.indexOf(this);var lineIndex=this.line.paragraph.childWidgets.indexOf(this.line);if(index<this.line.children.length-1){return this.line.children[index+1];}else if(lineIndex<this.line.paragraph.childWidgets.length-1){return this.line.paragraph.childWidgets[lineIndex+1].children[0];}return undefined;},enumerable:true,configurable:true});Object.defineProperty(ElementBox.prototype,"nextValidNodeForTracking",{/**
         * @private
         */get:function get(){var elementBox=this;while(!sf.base.isNullOrUndefined(elementBox)&&(elementBox instanceof BookmarkElementBox||elementBox instanceof CommentCharacterElementBox||elementBox instanceof EditRangeStartElementBox||elementBox instanceof EditRangeEndElementBox||elementBox instanceof ContentControl)){elementBox=elementBox.nextNode;}return elementBox;},enumerable:true,configurable:true});Object.defineProperty(ElementBox.prototype,"previousValidNodeForTracking",{/**
         * @private
         */get:function get(){var elementBox=this;while(!sf.base.isNullOrUndefined(elementBox)&&(elementBox instanceof BookmarkElementBox||elementBox instanceof CommentCharacterElementBox||elementBox instanceof EditRangeStartElementBox||elementBox instanceof EditRangeEndElementBox||elementBox instanceof ContentControl)){elementBox=elementBox.previousNode;}return elementBox;},enumerable:true,configurable:true});Object.defineProperty(ElementBox.prototype,"previousNode",{/**
         * @private
         */get:function get(){var index=this.line.children.indexOf(this);var lineIndex=this.line.paragraph.childWidgets.indexOf(this.line);if(index>0){return this.line.children[index-1];}else if(lineIndex>0){var lineWidget=this.line.paragraph.childWidgets[lineIndex-1];return lineWidget.children[lineWidget.children.length-1];}return undefined;},enumerable:true,configurable:true});Object.defineProperty(ElementBox.prototype,"paragraph",{/**
         * @private
         */get:function get(){if(this.line){return this.line.paragraph;}return undefined;},enumerable:true,configurable:true});/**
     * @private
     */ElementBox.prototype.destroy=function(){if(!sf.base.isNullOrUndefined(this.line)&&this.line.children&&this.line.children.indexOf(this)>-1){var index=this.line.children.indexOf(this);this.line.children.splice(index,1);}this.line=undefined;if(this.characterFormat){this.characterFormat.destroy();}this.characterFormat=undefined;if(this.margin){this.margin.destroy();}this.margin=undefined;this.x=undefined;this.y=undefined;this.width=undefined;this.height=undefined;};/**
     * @private
     */ElementBox.objectCharacter=String.fromCharCode(65532);return ElementBox;}();/**
 * @private
 */var FieldElementBox=/** @class */function(_super){__extends$1(FieldElementBox,_super);function FieldElementBox(type){var _this=_super.call(this)||this;/**
         * @private
         */_this.fieldType=0;/**
         * @private
         */_this.fieldCodeType='';/**
         * @private
         */_this.hasFieldEnd=false;_this.fieldBeginInternal=undefined;_this.fieldSeparatorInternal=undefined;_this.fieldEndInternal=undefined;_this.fieldType=type;return _this;}Object.defineProperty(FieldElementBox.prototype,"fieldBegin",{get:function get(){return this.fieldBeginInternal;},set:function set(field){this.fieldBeginInternal=field;},enumerable:true,configurable:true});Object.defineProperty(FieldElementBox.prototype,"fieldSeparator",{get:function get(){return this.fieldSeparatorInternal;},set:function set(field){this.fieldSeparatorInternal=field;},enumerable:true,configurable:true});Object.defineProperty(FieldElementBox.prototype,"fieldEnd",{get:function get(){return this.fieldEndInternal;},set:function set(field){this.fieldEndInternal=field;},enumerable:true,configurable:true});Object.defineProperty(FieldElementBox.prototype,"resultText",{/**
         * @private
         */get:function get(){if(!sf.base.isNullOrUndefined(this.formFieldData)&&this.fieldType===0&&!sf.base.isNullOrUndefined(this.fieldSeparator)&&!sf.base.isNullOrUndefined(this.fieldEnd)){var textElement=this.fieldSeparator.nextElement;var text='';do{if(textElement instanceof TextElementBox){text+=textElement.text;}textElement=textElement.nextNode;if(textElement===this.fieldEnd){break;}}while(textElement);return text;}return undefined;},enumerable:true,configurable:true});/**
     * @private
     */FieldElementBox.prototype.getLength=function(){return 1;};/**
     * @private
     */FieldElementBox.prototype.clone=function(){var field=new FieldElementBox(this.fieldType);if(this.fieldType===0&&!sf.base.isNullOrUndefined(this.formFieldData)){field.formFieldData=this.formFieldData.clone();}field.characterFormat.copyFormat(this.characterFormat);if(this.margin){field.margin=this.margin.clone();}field.width=this.width;field.height=this.height;if(!sf.base.isNullOrUndefined(this.paragraph)&&this.paragraph.isInHeaderFooter){if(this.revisions.length>0){for(var i=0;i<this.revisions.length;i++){var revision=this.revisions[i];field.revisions.push(revision.clone());}}}else{if(this.revisions.length>0){field.removedIds=Revision.cloneRevisions(this.revisions);}else{field.removedIds=this.removedIds.slice();}}field.fieldCodeType=this.fieldCodeType;return field;};/**
     * @private
     */FieldElementBox.prototype.destroy=function(){this.fieldType=undefined;this.hasFieldEnd=undefined;this.fieldBeginInternal=undefined;this.fieldEndInternal=undefined;this.fieldSeparatorInternal=undefined;_super.prototype.destroy.call(this);};return FieldElementBox;}(ElementBox);/**
 * @private
 */var FormField=/** @class */function(){function FormField(){/*
         * @private
         */this.name='';/**
         * @private
         */this.enabled=true;/**
         * @private
         */this.helpText='';/**
         * @private
         */this.statusText='';}return FormField;}();/**
 * @private
 */var TextFormField=/** @class */function(_super){__extends$1(TextFormField,_super);function TextFormField(){var _this=_super!==null&&_super.apply(this,arguments)||this;/**
         * @private
         */_this.type='Text';/**
         * @private
         */_this.maxLength=0;/**
         * @private
         */_this.defaultValue='';/**
         * @private
         */_this.format='';return _this;}/**
     * @private
     */TextFormField.prototype.clone=function(){var textForm=new TextFormField();textForm.type=this.type;textForm.name=this.name;textForm.enabled=this.enabled;textForm.helpText=this.helpText;textForm.statusText=this.statusText;textForm.maxLength=this.maxLength;textForm.defaultValue=this.defaultValue;textForm.format=this.format;return textForm;};/**
     * @private
     */TextFormField.prototype.getFormFieldInfo=function(){var textFormField={defaultValue:this.defaultValue,enabled:this.enabled,format:this.format,helpText:this.helpText,maxLength:this.maxLength,type:this.type};return textFormField;};/**
     * @private
     */TextFormField.prototype.copyFieldInfo=function(info){if(!sf.base.isNullOrUndefined(info.defaultValue)){this.defaultValue=info.defaultValue;}if(!sf.base.isNullOrUndefined(info.enabled)){this.enabled=info.enabled;}if(!sf.base.isNullOrUndefined(info.format)){this.format=info.format;}if(!sf.base.isNullOrUndefined(info.helpText)){this.helpText=info.helpText;}if(!sf.base.isNullOrUndefined(info.maxLength)){this.maxLength=info.maxLength;}if(!sf.base.isNullOrUndefined(info.type)){this.type=info.type;}};return TextFormField;}(FormField);/**
 * @private
 */var CheckBoxFormField=/** @class */function(_super){__extends$1(CheckBoxFormField,_super);function CheckBoxFormField(){var _this=_super!==null&&_super.apply(this,arguments)||this;/**
         * @private
         */_this.sizeType='Auto';/**
         * @private
         */_this.size=11;/**
         * @private
         */_this.defaultValue=false;/**
         * @private
         */_this.checked=false;return _this;}/**
     * @private
     */CheckBoxFormField.prototype.clone=function(){var checkBoxForm=new CheckBoxFormField();checkBoxForm.name=this.name;checkBoxForm.enabled=this.enabled;checkBoxForm.helpText=this.helpText;checkBoxForm.statusText=this.statusText;checkBoxForm.sizeType=this.sizeType;checkBoxForm.size=this.size;checkBoxForm.defaultValue=this.defaultValue;checkBoxForm.checked=this.checked;return checkBoxForm;};/**
     * @private
     */CheckBoxFormField.prototype.getFormFieldInfo=function(){var checkBoxFormField={defaultValue:this.defaultValue,enabled:this.enabled,helpText:this.helpText,size:this.size,sizeType:this.sizeType};return checkBoxFormField;};/**
     * @private
     */CheckBoxFormField.prototype.copyFieldInfo=function(info){if(!sf.base.isNullOrUndefined(info.defaultValue)){this.defaultValue=info.defaultValue;this.checked=info.defaultValue;}if(!sf.base.isNullOrUndefined(info.enabled)){this.enabled=info.enabled;}if(!sf.base.isNullOrUndefined(info.size)){this.size=info.size;}if(!sf.base.isNullOrUndefined(info.helpText)){this.helpText=info.helpText;}if(!sf.base.isNullOrUndefined(info.sizeType)){this.sizeType=info.sizeType;}};return CheckBoxFormField;}(FormField);/**
 * @private
 */var DropDownFormField=/** @class */function(_super){__extends$1(DropDownFormField,_super);function DropDownFormField(){var _this=_super!==null&&_super.apply(this,arguments)||this;/**
         * @private
         */_this.dropdownItems=[];/**
         * @private
         */_this.selectedIndex=0;return _this;}/**
     * @private
     */DropDownFormField.prototype.clone=function(){var dropDown=new DropDownFormField();dropDown.name=this.name;dropDown.enabled=this.enabled;dropDown.helpText=this.helpText;dropDown.statusText=this.statusText;dropDown.dropdownItems=this.dropdownItems.slice();dropDown.selectedIndex=this.selectedIndex;return dropDown;};/**
     * @private
     */DropDownFormField.prototype.getFormFieldInfo=function(){var dropDownFormField={dropdownItems:this.dropdownItems.slice(),enabled:this.enabled,helpText:this.helpText};return dropDownFormField;};/**
     * @private
     */DropDownFormField.prototype.copyFieldInfo=function(info){if(!sf.base.isNullOrUndefined(info.dropdownItems)){this.dropdownItems=info.dropdownItems;}if(!sf.base.isNullOrUndefined(info.enabled)){this.enabled=info.enabled;}if(!sf.base.isNullOrUndefined(info.helpText)){this.helpText=info.helpText;}};return DropDownFormField;}(FormField);/**
 * @private
 */var TextElementBox=/** @class */function(_super){__extends$1(TextElementBox,_super);function TextElementBox(){var _this=_super.call(this)||this;/**
         * @private
         */_this.baselineOffset=0;/**
         * @private
         */_this.text='';/**
         * @private
         */_this.trimEndWidth=0;/**
         * @private
         */_this.ignoreOnceItems=[];/**
         * @private
         */_this.istextCombined=false;_this.errorCollection=[];return _this;}/**
     * @private
     */TextElementBox.prototype.getLength=function(){return this.text?this.text.length:0;};/**
     * @private
     */TextElementBox.prototype.clone=function(){var span=new TextElementBox();span.characterFormat.copyFormat(this.characterFormat);span.text=this.text;if(this.margin){span.margin=this.margin.clone();}span.baselineOffset=this.baselineOffset;if(!sf.base.isNullOrUndefined(this.paragraph)&&this.paragraph.isInHeaderFooter){if(this.revisions.length>0){for(var i=0;i<this.revisions.length;i++){var revision=this.revisions[i];span.revisions.push(revision.clone());}}}else{if(this.revisions.length>0){span.removedIds=Revision.cloneRevisions(this.revisions);}else{span.removedIds=this.removedIds.slice();}}span.width=this.width;span.height=this.height;if(this.contentControlProperties){span.contentControlProperties=this.contentControlProperties;}return span;};/**
     * @private
     */TextElementBox.prototype.destroy=function(){this.text=undefined;_super.prototype.destroy.call(this);};return TextElementBox;}(ElementBox);/**
 * @private
 */var Footnote=/** @class */function(){function Footnote(){this.separator=[];this.continuationNotice=[];this.continuationSeparator=[];}/**
     * @private
     */Footnote.prototype.clear=function(){this.separator=[];this.continuationSeparator=[];this.continuationNotice=[];};Footnote.prototype.destroy=function(){this.separator=[];this.continuationSeparator=[];this.continuationNotice=[];};return Footnote;}();/**
 * @private
 */var FootnoteElementBox=/** @class */function(_super){__extends$1(FootnoteElementBox,_super);function FootnoteElementBox(){var _this=_super.call(this)||this;_this.isLayout=false;_this.blocks=[];return _this;}FootnoteElementBox.prototype.clone=function(){var span=new FootnoteElementBox();span.text=this.text;span.characterFormat.copyFormat(this.characterFormat);span.height=this.height;span.footnoteType=this.footnoteType;span.width=this.width;span.symbolCode=this.symbolCode;span.blocks=this.blocks;if(this.margin){span.margin=this.margin.clone();}return span;};FootnoteElementBox.prototype.getLength=function(){return 1;};FootnoteElementBox.prototype.destroy=function(){this.symbolCode='';this.symbolFontName='';this.customMarker='';};return FootnoteElementBox;}(TextElementBox);/**
 * @private
 */var ErrorTextElementBox=/** @class */function(_super){__extends$1(ErrorTextElementBox,_super);function ErrorTextElementBox(){var _this=_super.call(this)||this;_this.startIn=undefined;_this.endIn=undefined;return _this;}Object.defineProperty(ErrorTextElementBox.prototype,"start",{get:function get(){return this.startIn;},set:function set(value){this.startIn=value;},enumerable:true,configurable:true});Object.defineProperty(ErrorTextElementBox.prototype,"end",{get:function get(){return this.endIn;},set:function set(value){this.endIn=value;},enumerable:true,configurable:true});ErrorTextElementBox.prototype.destroy=function(){this.start=undefined;this.end=undefined;};return ErrorTextElementBox;}(TextElementBox);/**
 * @private
 */var FieldTextElementBox=/** @class */function(_super){__extends$1(FieldTextElementBox,_super);function FieldTextElementBox(){var _this=_super.call(this)||this;_this.fieldText='';return _this;}Object.defineProperty(FieldTextElementBox.prototype,"text",{get:function get(){return this.fieldText;},set:function set(value){this.fieldText=value;},enumerable:true,configurable:true});/**
     * @private
     */FieldTextElementBox.prototype.clone=function(){var span=new FieldTextElementBox();span.characterFormat.copyFormat(this.characterFormat);span.fieldBegin=this.fieldBegin;span.text=this.text;if(this.margin){span.margin=this.margin.clone();}if(!sf.base.isNullOrUndefined(this.paragraph)&&this.paragraph.isInHeaderFooter){if(this.revisions.length>0){for(var i=0;i<this.revisions.length;i++){var revision=this.revisions[i];span.revisions.push(revision.clone());}}}else{if(this.revisions.length>0){span.removedIds=Revision.cloneRevisions(this.revisions);}else{span.removedIds=this.removedIds.slice();}}span.width=this.width;span.height=this.height;return span;};return FieldTextElementBox;}(TextElementBox);/**
 * @private
 */var TabElementBox=/** @class */function(_super){__extends$1(TabElementBox,_super);function TabElementBox(){var _this=_super.call(this)||this;/**
         * @private
         */_this.tabText='';/**
         * @private
         */_this.tabLeader='None';return _this;}/**
     * @private
     */TabElementBox.prototype.destroy=function(){this.tabText=undefined;this.tabLeader=undefined;};/**
     * @private
     */TabElementBox.prototype.clone=function(){var span=new TabElementBox();span.characterFormat.copyFormat(this.characterFormat);span.tabText=this.tabText;span.tabLeader=this.tabLeader;span.text=this.text;if(this.margin){span.margin=this.margin.clone();}span.width=this.width;span.height=this.height;if(!sf.base.isNullOrUndefined(this.paragraph)&&this.paragraph.isInHeaderFooter){if(this.revisions.length>0){for(var i=0;i<this.revisions.length;i++){var revision=this.revisions[i];span.revisions.push(revision.clone());}}}else{if(this.revisions.length>0){span.removedIds=Revision.cloneRevisions(this.revisions);}else{span.removedIds=this.removedIds.slice();}}return span;};return TabElementBox;}(TextElementBox);/**
 * @private
 */var BookmarkElementBox=/** @class */function(_super){__extends$1(BookmarkElementBox,_super);function BookmarkElementBox(type){var _this=_super.call(this)||this;_this.bookmarkTypeIn=0;_this.refereneceIn=undefined;_this.nameIn='';_this.bookmarkTypeIn=type;return _this;}Object.defineProperty(BookmarkElementBox.prototype,"bookmarkType",{/**
         * @private
         */get:function get(){return this.bookmarkTypeIn;},enumerable:true,configurable:true});Object.defineProperty(BookmarkElementBox.prototype,"name",{/**
         * @private
         */get:function get(){return this.nameIn;},/**
         * @private
         */set:function set(name){this.nameIn=name;},enumerable:true,configurable:true});Object.defineProperty(BookmarkElementBox.prototype,"reference",{/**
         * @private
         */get:function get(){return this.refereneceIn;},/**
         * @private
         */set:function set(reference){this.refereneceIn=reference;},enumerable:true,configurable:true});/**
     * @private
     */BookmarkElementBox.prototype.getLength=function(){return 1;};/**
     * @private
     */BookmarkElementBox.prototype.destroy=function(){this.name=undefined;this.reference=undefined;this.bookmarkTypeIn=undefined;};/**
     * Clones the bookmark element box.
     * @param element - book mark element
     */ /**
     * @private
     */BookmarkElementBox.prototype.clone=function(){var span=new BookmarkElementBox(this.bookmarkType);span.name=this.name;span.reference=this.reference;if(this.margin){span.margin=this.margin.clone();}span.width=this.width;span.height=this.height;if(this.contentControlProperties){span.contentControlProperties=this.contentControlProperties;}return span;};return BookmarkElementBox;}(ElementBox);/**
 * @private
 */var ContentControl=/** @class */function(_super){__extends$1(ContentControl,_super);function ContentControl(widgetType){var _this=_super.call(this)||this;_this.contentControlWidgetType=widgetType;_this.contentControlProperties=new ContentControlProperties(widgetType);return _this;}/**
     * @private
     */ContentControl.prototype.getLength=function(){return 1;};/**
     * @private
     */ContentControl.prototype.clone=function(){var span=new ContentControl(this.contentControlWidgetType);span.characterFormat.copyFormat(this.characterFormat);span.contentControlProperties=this.contentControlProperties;span.contentControlWidgetType=this.contentControlWidgetType;if(this.margin){span.margin=this.margin.clone();}if(!sf.base.isNullOrUndefined(this.paragraph)&&this.paragraph.isInHeaderFooter){if(this.revisions.length>0){for(var i=0;i<this.revisions.length;i++){var revision=this.revisions[i];span.revisions.push(revision.clone());}}}else{if(this.revisions.length>0){span.removedIds=Revision.cloneRevisions(this.revisions);}else{span.removedIds=this.removedIds.slice();}}span.type=this.type;span.width=this.width;span.height=this.height;span.reference=this.reference;return span;};/**
     * @private
     */ContentControl.prototype.destroy=function(){this.contentControlProperties=undefined;this.contentControlWidgetType=undefined;_super.prototype.destroy.call(this);};return ContentControl;}(ElementBox);/**
 * @private
 */ /**
 * @private
 */var ContentControlProperties=/** @class */function(){function ContentControlProperties(widgetType){/**
         * @private
         */this.contentControlListItems=[];this.contentControlWidgetType=widgetType;this.characterFormat=new WCharacterFormat();}/**
     * @private
     */ContentControlProperties.prototype.destroy=function(){this.lockContentControl=undefined;this.lockContents=undefined;this.tag=undefined;this.color=undefined;this.title=undefined;this.appearance=undefined;this.type=undefined;this.hasPlaceHolderText=undefined;this.multiline=undefined;this.isTemporary=undefined;this.isChecked=undefined;this.dateCalendarType=undefined;this.dateStorageFormat=undefined;this.dateDisplayLocale=undefined;this.dateDisplayFormat=undefined;};/**
     * @private
     */ContentControlProperties.prototype.clone=function(){var span=new ContentControlProperties(this.contentControlWidgetType);span.lockContentControl=this.lockContentControl;span.lockContents=this.lockContents;span.tag=this.tag;span.color=this.color;span.title=this.title;span.appearance=this.appearance;span.type=this.type;span.hasPlaceHolderText=this.hasPlaceHolderText;span.multiline=this.multiline;span.isTemporary=this.isTemporary;span.isChecked=this.isChecked;span.dateCalendarType=this.dateCalendarType;span.dateStorageFormat=this.dateStorageFormat;span.dateDisplayLocale=this.dateDisplayLocale;span.dateDisplayFormat=this.dateDisplayFormat;if(this.contentControlListItems.length>0){for(var i=0;i<this.contentControlListItems.length;i++){span.contentControlListItems.push(this.contentControlListItems[i].clone());}}if(this.checkedState){span.checkedState=this.checkedState.clone();}if(this.uncheckedState){span.uncheckedState=this.uncheckedState.clone();}if(this.xmlMapping){span.xmlMapping=this.xmlMapping.clone();}return span;};return ContentControlProperties;}();/**
 * @private
 */var ContentControlListItems=/** @class */function(){function ContentControlListItems(){}/**
     * @private
     */ContentControlListItems.prototype.destroy=function(){this.displayText=undefined;this.value=undefined;};/**
     * @private
     */ContentControlListItems.prototype.clone=function(){var span=new ContentControlListItems();span.displayText=this.displayText;span.value=this.value;return span;};return ContentControlListItems;}();/**
 * @private
 */var CheckBoxState=/** @class */function(){function CheckBoxState(){}/**
     * @private
     */CheckBoxState.prototype.destroy=function(){this.font=undefined;this.value=undefined;};/**
     * @private
     */CheckBoxState.prototype.clone=function(){var span=new CheckBoxState();span.font=this.font;span.value=this.value;return span;};return CheckBoxState;}();/**
 * @private
 */var XmlMapping=/** @class */function(){function XmlMapping(){}/**
     * @private
     */XmlMapping.prototype.destroy=function(){this.isMapped=undefined;this.isWordMl=undefined;this.prefixMapping=undefined;this.xPath=undefined;this.storeItemId=undefined;this.customXmlPart=undefined;};/**
     * @private
     */XmlMapping.prototype.clone=function(){var span=new XmlMapping();span.isMapped=this.isMapped;span.isWordMl=this.isWordMl;span.prefixMapping=this.prefixMapping;span.xPath=this.xPath;span.storeItemId=this.storeItemId;if(this.customXmlPart){span.customXmlPart=this.customXmlPart.clone();}return span;};return XmlMapping;}();/**
 * @private
 */var CustomXmlPart=/** @class */function(){function CustomXmlPart(){}/**
     * @private
     */CustomXmlPart.prototype.destroy=function(){this.id=undefined;this.xml=undefined;};/**
     * @private
     */CustomXmlPart.prototype.clone=function(){var span=new CustomXmlPart();span.id=this.id;span.xml=this.xml;return span;};return CustomXmlPart;}();/**
 * @private
 */var ShapeCommon=/** @class */function(_super){__extends$1(ShapeCommon,_super);function ShapeCommon(){var _this=_super!==null&&_super.apply(this,arguments)||this;/**
         * @private
         */_this.name='';/**
         * @private
         */_this.alternativeText='';/**
         * @private
         */_this.title='';return _this;}/**
     *
     * @private
     */ShapeCommon.prototype.getLength=function(){return 1;};/**
     * @private
     */ShapeCommon.prototype.clone=function(){var shape=new ShapeElementBox();return shape;};return ShapeCommon;}(ElementBox);/**
 * @private
 */var ShapeBase=/** @class */function(_super){__extends$1(ShapeBase,_super);function ShapeBase(){var _this=_super!==null&&_super.apply(this,arguments)||this;/**
         * @private
         */_this.verticalPosition=0;/**
         * @private
         */_this.horizontalPosition=0;/**
         * @private
         */_this.textWrappingStyle='Inline';/**
         * @private
         */_this.distanceBottom=0;/**
         * @private
         */_this.distanceLeft=0;/**
         * @private
         */_this.distanceRight=0;/**
         * @private
         */_this.distanceTop=0;return _this;}return ShapeBase;}(ShapeCommon);/**
 * @private
 */var ShapeElementBox=/** @class */function(_super){__extends$1(ShapeElementBox,_super);function ShapeElementBox(){return _super!==null&&_super.apply(this,arguments)||this;}/**
     * @private
     */ShapeElementBox.prototype.clone=function(){var shape=new ShapeElementBox();shape.characterFormat.copyFormat(this.characterFormat);shape.x=this.x;shape.y=this.y;shape.width=this.width;shape.height=this.height;shape.shapeId=this.shapeId;shape.name=this.name;shape.alternativeText=this.alternativeText;shape.title=this.title;shape.widthScale=this.widthScale;shape.heightScale=this.heightScale;shape.visible=this.visible;shape.verticalPosition=this.verticalPosition;shape.verticalAlignment=this.verticalAlignment;shape.verticalOrigin=this.verticalOrigin;shape.verticalRelativePercent=this.verticalRelativePercent;shape.horizontalPosition=this.horizontalPosition;shape.horizontalAlignment=this.horizontalAlignment;shape.horizontalRelativePercent=this.horizontalRelativePercent;shape.horizontalOrigin=this.horizontalOrigin;shape.zOrderPosition=this.zOrderPosition;shape.allowOverlap=this.allowOverlap;shape.textWrappingStyle=this.textWrappingStyle;shape.textWrappingType=this.textWrappingType;shape.distanceBottom=this.distanceBottom;shape.distanceLeft=this.distanceLeft;shape.distanceRight=this.distanceRight;shape.distanceTop=this.distanceTop;shape.layoutInCell=this.layoutInCell;shape.lockAnchor=this.lockAnchor;shape.autoShapeType=this.autoShapeType;if(this.lineFormat){shape.lineFormat=this.lineFormat.clone();}if(this.fillFormat){shape.fillFormat=this.fillFormat.clone();}if(this.textFrame){shape.textFrame=this.textFrame.clone();shape.textFrame.containerShape=shape;}if(this.margin){shape.margin=this.margin.clone();}return shape;};return ShapeElementBox;}(ShapeBase);/**
 * @private
 */var TextFrame=/** @class */function(_super){__extends$1(TextFrame,_super);function TextFrame(){var _this=_super!==null&&_super.apply(this,arguments)||this;/**
         * @private
         */_this.marginLeft=0;/**
         * @private
         */_this.marginRight=0;/**
         * @private
         */_this.marginTop=0;/**
         * @private
         */_this.marginBottom=0;return _this;}TextFrame.prototype.equals=function(){return false;};TextFrame.prototype.destroyInternal=function(){//return;
};TextFrame.prototype.getHierarchicalIndex=function(index){var line=this.containerShape.line;var offset=line.getOffset(this.containerShape,0).toString();return line.getHierarchicalIndex(offset);};TextFrame.prototype.getTableCellWidget=function(){return undefined;};/**
     * @private
     */TextFrame.prototype.clone=function(){var textFrame=new TextFrame();textFrame.textVerticalAlignment=this.textVerticalAlignment;textFrame.marginBottom=this.marginBottom;textFrame.marginLeft=this.marginLeft;textFrame.marginRight=this.marginRight;textFrame.marginTop=this.marginTop;for(var i=0;i<this.childWidgets.length;i++){var block=this.childWidgets[i].clone();textFrame.childWidgets.push(block);block.index=i;block.containerWidget=textFrame;}return textFrame;};return TextFrame;}(Widget);/**
 * @private
 */var LineFormat=/** @class */function(){function LineFormat(){}/**
     * @private
     */LineFormat.prototype.clone=function(){var lineFormat=new LineFormat();lineFormat.lineFormatType=this.lineFormatType;lineFormat.color=this.color;lineFormat.weight=this.weight;lineFormat.dashStyle=this.dashStyle;lineFormat.line=this.line;return lineFormat;};return LineFormat;}();/**
 * @private
 */var FillFormat=/** @class */function(){function FillFormat(){}/**
     * @private
     */FillFormat.prototype.clone=function(){var fillFormat=new FillFormat();fillFormat.color=this.color;fillFormat.fill=this.fill;return fillFormat;};return FillFormat;}();/**
 * @private
 */var ImageElementBox=/** @class */function(_super){__extends$1(ImageElementBox,_super);function ImageElementBox(isInlineImage){var _this=_super.call(this)||this;_this.imageStr='';_this.imgElement=undefined;_this.isInlineImageIn=true;/**
         * @private
         */_this.isCrop=false;/**
         * @private
         */_this.left=0;/**
         * @private
         */_this.top=0;/**
         * @private
         */_this.right=0;/**
         * @private
         */_this.bottom=0;/**
         * @private
         */_this.isMetaFile=false;/**
         * @private
         */_this.isCompressed=false;_this.isInlineImageIn=isInlineImage;return _this;}Object.defineProperty(ImageElementBox.prototype,"isInlineImage",{/**
         * @private
         */get:function get(){return this.isInlineImageIn;},enumerable:true,configurable:true});Object.defineProperty(ImageElementBox.prototype,"element",{/**
         * @private
         */get:function get(){if(sf.base.isNullOrUndefined(this.imgElement)){this.imgElement=document.createElement('img');}return this.imgElement;},enumerable:true,configurable:true});Object.defineProperty(ImageElementBox.prototype,"length",{/**
         * @private
         */get:function get(){return 1;},enumerable:true,configurable:true});Object.defineProperty(ImageElementBox.prototype,"imageString",{/**
         * @private
         */get:function get(){return this.imageStr;},/**
         * @private
         */set:function set(value){this.imageStr=value;if(!sf.base.isNullOrUndefined(value)){this.element.src=this.imageStr;}},enumerable:true,configurable:true});/**
     * @private
     */ImageElementBox.prototype.getLength=function(){return 1;};/**
     * @private
     */ImageElementBox.prototype.clone=function(){var image=new ImageElementBox(this.isInlineImage);image.characterFormat.copyFormat(this.characterFormat);image.imageString=this.imageString;image.isMetaFile=this.isMetaFile;image.isCompressed=this.isCompressed;image.metaFileImageString=this.metaFileImageString;image.width=this.width;image.height=this.height;if(this.isCrop){image.top=this.top;image.left=this.left;image.bottom=this.bottom;image.right=this.right;image.isCrop=this.isCrop;image.cropHeightScale=this.cropHeightScale;image.cropWidthScale=this.cropWidthScale;}if(this.margin){image.margin=this.margin.clone();}if(!sf.base.isNullOrUndefined(this.paragraph)&&this.paragraph.isInHeaderFooter){if(this.revisions.length>0){for(var i=0;i<this.revisions.length;i++){var revision=this.revisions[i];image.revisions.push(revision.clone());}}}else{if(this.revisions.length>0){image.removedIds=Revision.cloneRevisions(this.revisions);}else{image.removedIds=this.removedIds.slice();}}image.name=this.name;image.alternativeText=this.alternativeText;image.title=this.title;image.visible=this.visible;image.widthScale=this.widthScale;image.heightScale=this.heightScale;image.verticalPosition=this.verticalPosition;image.verticalOrigin=this.verticalOrigin;image.verticalAlignment=this.verticalAlignment;image.horizontalPosition=this.horizontalPosition;image.horizontalOrigin=this.horizontalOrigin;image.horizontalAlignment=this.horizontalAlignment;image.allowOverlap=this.allowOverlap;image.textWrappingStyle=this.textWrappingStyle;image.textWrappingType=this.textWrappingType;image.layoutInCell=this.layoutInCell;image.zOrderPosition=this.zOrderPosition;return image;};/**
     * @private
     */ImageElementBox.prototype.destroy=function(){this.imgElement=undefined;this.imageString=undefined;this.isInlineImageIn=undefined;_super.prototype.destroy.call(this);};return ImageElementBox;}(ShapeBase);/**
 * @private
 */var ListTextElementBox=/** @class */function(_super){__extends$1(ListTextElementBox,_super);function ListTextElementBox(listLevel,isListFollowCharacter){var _this=_super.call(this)||this;/**
         * @private
         */_this.baselineOffset=0;/**
         * @private
         */_this.trimEndWidth=0;/**
         * @private
         */_this.isFollowCharacter=false;_this.listLevel=listLevel;_this.isFollowCharacter=isListFollowCharacter;return _this;}/**
     * @private
     */ListTextElementBox.prototype.getLength=function(){return this.text?this.text.length:0;};/**
     * @private
     */ListTextElementBox.prototype.clone=function(){var list=new ListTextElementBox(this.listLevel,this.isFollowCharacter);list.text=this.text;list.baselineOffset=this.baselineOffset;if(this.margin){list.margin=this.margin.clone();}list.width=this.width;list.height=this.height;return list;};/**
     * @private
     */ListTextElementBox.prototype.destroy=function(){this.text=undefined;_super.prototype.destroy.call(this);};return ListTextElementBox;}(ElementBox);/**
 * @private
 */var EditRangeEndElementBox=/** @class */function(_super){__extends$1(EditRangeEndElementBox,_super);function EditRangeEndElementBox(){var _this=_super.call(this)||this;/**
         * @private
         */_this.editRangeStart=undefined;_this.editRangeId=-1;return _this;}/**
     * @private
     */EditRangeEndElementBox.prototype.getLength=function(){return 1;};/**
     * @private
     */EditRangeEndElementBox.prototype.destroy=function(){this.editRangeStart=undefined;};/**
     * @private
     */EditRangeEndElementBox.prototype.clone=function(){var end=new EditRangeEndElementBox();end.editRangeStart=this.editRangeStart;end.editRangeId=this.editRangeId;return end;};return EditRangeEndElementBox;}(ElementBox);/**
 * @private
 */var EditRangeStartElementBox=/** @class */function(_super){__extends$1(EditRangeStartElementBox,_super);function EditRangeStartElementBox(){var _this=_super.call(this)||this;/**
         * @private
         */_this.columnFirst=-1;/**
         * @private
         */_this.columnLast=-1;/**
         * @private
         */_this.user='';/**
         * @private
         */_this.group='';_this.editRangeId=-1;return _this;}/**
     * @private
     */EditRangeStartElementBox.prototype.getLength=function(){return 1;};/**
     * @private
     */EditRangeStartElementBox.prototype.renderLockMark=function(currentUser,locale){if(sf.base.isNullOrUndefined(this.editRangeMark)){var user=currentUser===this.user?'you':this.user;this.editRangeMark=document.createElement('div');this.editRangeMark.style.display='none';this.editRangeMark.classList.add('e-de-lock-mark');var span=document.createElement('span');span.className='e-icons e-de-ctnr-lock';this.editRangeMark.appendChild(span);this.editRangeMark.title=locale.getConstant('This region is locked by')+' '+user;}if(this.line&&sf.base.isNullOrUndefined(this.editRangeMark.parentElement)){var documentHelper=this.line.paragraph.bodyWidget.page.documentHelper;documentHelper.pageContainer.appendChild(this.editRangeMark);}};/**
     * @private
     */EditRangeStartElementBox.prototype.removeEditRangeMark=function(){if(this.editRangeMark){this.editRangeMark.parentElement.removeChild(this.editRangeMark);this.editRangeMark=undefined;}};/**
     * @private
     */EditRangeStartElementBox.prototype.destroy=function(){this.user=undefined;this.columnFirst=undefined;this.columnLast=undefined;};/**
     * @private
     */EditRangeStartElementBox.prototype.clone=function(){var start=new EditRangeStartElementBox();start.columnFirst=this.columnFirst;start.columnLast=this.columnLast;start.user=this.user;start.group=this.group;start.editRangeEnd=this.editRangeEnd;start.editRangeId=this.editRangeId;return start;};return EditRangeStartElementBox;}(ElementBox);/**
 * @private
 */var ChartElementBox=/** @class */function(_super){__extends$1(ChartElementBox,_super);/**
     * @private
     */function ChartElementBox(){var _this=_super.call(this)||this;/**
         * @private
         */_this.chartTitle='';/**
         * @private
         */_this.chartType='';/**
         * @private
         */_this.chartElement=undefined;/**
         * @private
         */_this.chartCategory=[];/**
         * @private
         */_this.chartSeries=[];_this.chartArea=new ChartArea();_this.chartPlotArea=new ChartArea();_this.chartTitleArea=new ChartTitleArea();_this.chartLegend=new ChartLegend();_this.chartPrimaryCategoryAxis=new ChartCategoryAxis();_this.chartPrimaryValueAxis=new ChartCategoryAxis();_this.chartDataTable=new ChartDataTable();return _this;}/**
     * @private
     */ChartElementBox.prototype.getLength=function(){return 1;};Object.defineProperty(ChartElementBox.prototype,"title",{/**
         * @private
         */get:function get(){return this.chartTitle;},/**
         * @private
         */set:function set(value){this.chartTitle=value;},enumerable:true,configurable:true});Object.defineProperty(ChartElementBox.prototype,"type",{/**
         * @private
         */get:function get(){return this.chartType;},/**
         * @private
         */set:function set(value){this.chartType=value;},enumerable:true,configurable:true});Object.defineProperty(ChartElementBox.prototype,"chartGapWidth",{/**
         * @private
         */get:function get(){return this.gapWidth;},/**
         * @private
         */set:function set(value){this.gapWidth=value;},enumerable:true,configurable:true});Object.defineProperty(ChartElementBox.prototype,"chartOverlap",{/**
         * @private
         */get:function get(){return this.overlap;},/**
         * @private
         */set:function set(value){this.overlap=value;},enumerable:true,configurable:true});Object.defineProperty(ChartElementBox.prototype,"targetElement",{/**
         * @private
         */get:function get(){if(sf.base.isNullOrUndefined(this.div)){this.div=sf.base.createElement('div');}return this.div;},enumerable:true,configurable:true});Object.defineProperty(ChartElementBox.prototype,"officeChart",{/**
         * @private
         */get:function get(){return this.officeChartInternal;},/**
         * @private
         */set:function set(value){if(value){this.officeChartInternal=value;this.officeChartInternal.chart.loaded=this.onChartLoaded.bind(this);}},enumerable:true,configurable:true});ChartElementBox.prototype.onChartLoaded=function(){var _this=this;this.officeChart.convertChartToImage(this.officeChart.chart,this.width,this.height).then(function(dataURL){_this.imageString=dataURL;});};/**
     * @private
     */ChartElementBox.prototype.clone=function(){var chart=new ChartElementBox();chart.chartTitle=this.chartTitle;chart.chartType=this.chartType;chart.height=this.height;chart.width=this.width;chart.gapWidth=this.gapWidth;chart.overlap=this.overlap;for(var i=0;i<this.chartCategory.length;i++){var chartCategory=this.chartCategory[i].clone();chart.chartCategory.push(chartCategory);}for(var i=0;i<this.chartSeries.length;i++){var series=this.chartSeries[i].clone();chart.chartSeries.push(series);}chart.chartArea=this.chartArea.clone();chart.chartPlotArea=this.chartPlotArea.clone();chart.chartLegend=this.chartLegend.clone();chart.chartTitleArea=this.chartTitleArea.clone();chart.chartPrimaryCategoryAxis=this.chartPrimaryCategoryAxis.clone();chart.chartPrimaryValueAxis=this.chartPrimaryValueAxis.clone();chart.chartDataTable=this.chartDataTable.clone();return chart;};/**
     * @private
     */ChartElementBox.prototype.destroy=function(){_super.prototype.destroy.call(this);if(this.officeChartInternal){this.officeChartInternal.chart.loaded=undefined;this.officeChartInternal.destroy();this.officeChartInternal=undefined;}if(this.div){this.div=undefined;}this.chartTitle=undefined;this.chartType=undefined;this.chartArea=undefined;this.chartPlotArea=undefined;this.chartCategory=[];this.chartSeries=[];this.chartTitleArea=undefined;this.chartLegend=undefined;this.chartPrimaryCategoryAxis=undefined;this.chartPrimaryValueAxis=undefined;this.chartDataTable=undefined;this.chartElement=undefined;};return ChartElementBox;}(ImageElementBox);/**
 * @private
 */var ChartArea=/** @class */function(){function ChartArea(){}Object.defineProperty(ChartArea.prototype,"chartForeColor",{/**
         * @private
         */get:function get(){return this.foreColor;},/**
         * @private
         */set:function set(value){this.foreColor=value;},enumerable:true,configurable:true});/**
     * @private
     */ChartArea.prototype.clone=function(){var chart=new ChartArea();chart.foreColor=this.foreColor;return chart;};/**
     * @private
     */ChartArea.prototype.destroy=function(){this.foreColor=undefined;};return ChartArea;}();/**
 * @private
 */var ChartCategory=/** @class */function(){function ChartCategory(){/**
         * @private
         */this.categoryXName='';/**
         * @private
         */this.chartData=[];}Object.defineProperty(ChartCategory.prototype,"xName",{/**
         * @private
         */get:function get(){return this.categoryXName;},/**
         * @private
         */set:function set(value){this.categoryXName=value;},enumerable:true,configurable:true});/**
     * @private
     */ChartCategory.prototype.clone=function(){var chart=new ChartCategory();chart.categoryXName=this.categoryXName;for(var i=0;i<this.chartData.length;i++){var chartData=this.chartData[i].clone();chart.chartData.push(chartData);}return chart;};/**
     * @private
     */ChartCategory.prototype.destroy=function(){this.categoryXName=undefined;this.chartData=[];};return ChartCategory;}();/**
 * @private
 */var ChartData=/** @class */function(){function ChartData(){}Object.defineProperty(ChartData.prototype,"yAxisValue",{/**
         * @private
         */get:function get(){return this.yValue;},/**
         * @private
         */set:function set(value){this.yValue=value;},enumerable:true,configurable:true});Object.defineProperty(ChartData.prototype,"xAxisValue",{/**
         * @private
         */get:function get(){return this.xValue;},/**
         * @private
         */set:function set(value){this.xValue=value;},enumerable:true,configurable:true});Object.defineProperty(ChartData.prototype,"bubbleSize",{/**
         * @private
         */get:function get(){return this.size;},/**
         * @private
         */set:function set(value){this.size=value;},enumerable:true,configurable:true});/**
     * @private
     */ChartData.prototype.clone=function(){var chart=new ChartData();chart.yValue=this.yValue;chart.xValue=this.xValue;chart.size=this.size;return chart;};/**
     * @private
     */ChartData.prototype.destroy=function(){this.xValue=undefined;this.yValue=undefined;this.size=undefined;};return ChartData;}();/**
 * @private
 */var ChartLegend=/** @class */function(){/**
     * @private
     */function ChartLegend(){this.chartTitleArea=new ChartTitleArea();}Object.defineProperty(ChartLegend.prototype,"chartLegendPostion",{/**
         * @private
         */get:function get(){return this.legendPostion;},/**
         * @private
         */set:function set(value){this.legendPostion=value;},enumerable:true,configurable:true});/**
     * @private
     */ChartLegend.prototype.clone=function(){var chart=new ChartLegend();chart.legendPostion=this.legendPostion;chart.chartTitleArea=this.chartTitleArea.clone();return chart;};/**
     * @private
     */ChartLegend.prototype.destroy=function(){this.legendPostion=undefined;this.chartTitleArea=undefined;};return ChartLegend;}();/**
 * @private
 */var ChartSeries=/** @class */function(){function ChartSeries(){/**
         * @private
         */this.chartDataFormat=[];/**
         * @private
         */this.trendLines=[];this.errorBar=new ChartErrorBar();this.dataLabels=new ChartDataLabels();this.seriesFormat=new ChartSeriesFormat();}Object.defineProperty(ChartSeries.prototype,"seriesName",{/**
         * @private
         */get:function get(){return this.name;},/**
         * @private
         */set:function set(value){this.name=value;},enumerable:true,configurable:true});Object.defineProperty(ChartSeries.prototype,"firstSliceAngle",{/**
         * @private
         */get:function get(){return this.sliceAngle;},/**
         * @private
         */set:function set(value){this.sliceAngle=value;},enumerable:true,configurable:true});Object.defineProperty(ChartSeries.prototype,"doughnutHoleSize",{/**
         * @private
         */get:function get(){return this.holeSize;},/**
         * @private
         */set:function set(value){this.holeSize=value;},enumerable:true,configurable:true});/**
     * @private
     */ChartSeries.prototype.clone=function(){var chart=new ChartSeries();chart.name=this.name;chart.sliceAngle=this.sliceAngle;chart.holeSize=this.holeSize;chart.errorBar=this.errorBar.clone();chart.dataLabels=this.dataLabels.clone();chart.seriesFormat=this.seriesFormat.clone();for(var i=0;i<this.chartDataFormat.length;i++){var format=this.chartDataFormat[i].clone();chart.chartDataFormat.push(format);}for(var i=0;i<this.trendLines.length;i++){var trendLine=this.trendLines[i].clone();chart.trendLines.push(trendLine);}return chart;};/**
     * @private
     */ChartSeries.prototype.destroy=function(){this.name=undefined;this.errorBar=undefined;this.trendLines=undefined;this.chartDataFormat=[];};return ChartSeries;}();/**
 * @private
 */var ChartErrorBar=/** @class */function(){function ChartErrorBar(){}Object.defineProperty(ChartErrorBar.prototype,"errorType",{/**
         * @private
         */get:function get(){return this.type;},/**
         * @private
         */set:function set(value){this.type=value;},enumerable:true,configurable:true});Object.defineProperty(ChartErrorBar.prototype,"errorDirection",{/**
         * @private
         */get:function get(){return this.direction;},/**
         * @private
         */set:function set(value){this.direction=value;},enumerable:true,configurable:true});Object.defineProperty(ChartErrorBar.prototype,"errorEndStyle",{/**
         * @private
         */get:function get(){return this.endStyle;},/**
         * @private
         */set:function set(value){this.endStyle=value;},enumerable:true,configurable:true});Object.defineProperty(ChartErrorBar.prototype,"numberValue",{get:function get(){return this.errorValue;},/**
         * @private
         */set:function set(value){this.errorValue=value;},enumerable:true,configurable:true});/**
     * @private
     */ChartErrorBar.prototype.clone=function(){var chart=new ChartErrorBar();chart.type=this.type;chart.errorDirection=this.errorDirection;chart.endStyle=this.endStyle;chart.errorValue=this.errorValue;return chart;};/**
     * @private
     */ChartErrorBar.prototype.destroy=function(){this.type=undefined;this.errorDirection=undefined;this.endStyle=undefined;};return ChartErrorBar;}();/**
 * @private
 */var ChartSeriesFormat=/** @class */function(){function ChartSeriesFormat(){}Object.defineProperty(ChartSeriesFormat.prototype,"markerStyle",{/**
         * @private
         */get:function get(){return this.style;},/**
         * @private
         */set:function set(value){this.style=value;},enumerable:true,configurable:true});Object.defineProperty(ChartSeriesFormat.prototype,"markerColor",{/**
         * @private
         */get:function get(){return this.color;},/**
         * @private
         */set:function set(value){this.color=value;},enumerable:true,configurable:true});Object.defineProperty(ChartSeriesFormat.prototype,"numberValue",{/**
         * @private
         */get:function get(){return this.size;},/**
         * @private
         */set:function set(value){this.size=value;},enumerable:true,configurable:true});/**
     * @private
     */ChartSeriesFormat.prototype.clone=function(){var chart=new ChartSeriesFormat();chart.style=this.style;chart.color=this.color;chart.size=this.size;return chart;};/**
     * @private
     */ChartSeriesFormat.prototype.destroy=function(){this.style=undefined;this.color=undefined;this.size=undefined;};return ChartSeriesFormat;}();/**
 * @private
 */var ChartDataLabels=/** @class */function(){function ChartDataLabels(){}Object.defineProperty(ChartDataLabels.prototype,"labelPosition",{/**
         * @private
         */get:function get(){return this.position;},/**
         * @private
         */set:function set(value){this.position=value;},enumerable:true,configurable:true});Object.defineProperty(ChartDataLabels.prototype,"fontName",{/**
         * @private
         */get:function get(){return this.name;},/**
         * @private
         */set:function set(value){this.name=value;},enumerable:true,configurable:true});Object.defineProperty(ChartDataLabels.prototype,"fontColor",{/**
         * @private
         */get:function get(){return this.color;},/**
         * @private
         */set:function set(value){this.color=value;},enumerable:true,configurable:true});Object.defineProperty(ChartDataLabels.prototype,"fontSize",{/**
         * @private
         */get:function get(){return this.size;},/**
         * @private
         */set:function set(value){this.size=value;},enumerable:true,configurable:true});Object.defineProperty(ChartDataLabels.prototype,"isLegendKey",{/**
         * @private
         */get:function get(){return this.isLegend;},/**
         * @private
         */set:function set(value){this.isLegend=value;},enumerable:true,configurable:true});Object.defineProperty(ChartDataLabels.prototype,"isBubbleSize",{/**
         * @private
         */get:function get(){return this.isBubble;},/**
         * @private
         */set:function set(value){this.isBubble=value;},enumerable:true,configurable:true});Object.defineProperty(ChartDataLabels.prototype,"isCategoryName",{/**
         * @private
         */get:function get(){return this.isCategory;},/**
         * @private
         */set:function set(value){this.isCategory=value;},enumerable:true,configurable:true});Object.defineProperty(ChartDataLabels.prototype,"isSeriesName",{/**
         * @private
         */get:function get(){return this.isSeries;},/**
         * @private
         */set:function set(value){this.isSeries=value;},enumerable:true,configurable:true});Object.defineProperty(ChartDataLabels.prototype,"isValue",{/**
         * @private
         */get:function get(){return this.isValueEnabled;},/**
         * @private
         */set:function set(value){this.isValueEnabled=value;},enumerable:true,configurable:true});Object.defineProperty(ChartDataLabels.prototype,"isPercentage",{/**
         * @private
         */get:function get(){return this.isPercentageEnabled;},/**
         * @private
         */set:function set(value){this.isPercentageEnabled=value;},enumerable:true,configurable:true});Object.defineProperty(ChartDataLabels.prototype,"isLeaderLines",{/**
         * @private
         */get:function get(){return this.showLeaderLines;},/**
         * @private
         */set:function set(value){this.showLeaderLines=value;},enumerable:true,configurable:true});/**
     * @private
     */ChartDataLabels.prototype.clone=function(){var chart=new ChartDataLabels();chart.position=this.position;chart.name=this.name;chart.color=this.color;chart.size=this.size;chart.isBubble=this.isBubble;chart.isLegend=this.isLegend;chart.isCategory=this.isCategory;chart.isSeries=this.isSeries;chart.isValueEnabled=this.isValueEnabled;chart.isPercentageEnabled=this.isPercentageEnabled;chart.showLeaderLines=this.showLeaderLines;return chart;};/**
     * @private
     */ChartDataLabels.prototype.destroy=function(){this.position=undefined;};return ChartDataLabels;}();/**
 * @private
 */var ChartTrendLines=/** @class */function(){function ChartTrendLines(){}Object.defineProperty(ChartTrendLines.prototype,"trendLineType",{/**
         * @private
         */get:function get(){return this.type;},/**
         * @private
         */set:function set(value){this.type=value;},enumerable:true,configurable:true});Object.defineProperty(ChartTrendLines.prototype,"trendLineName",{/**
         * @private
         */get:function get(){return this.name;},/**
         * @private
         */set:function set(value){this.name=value;},enumerable:true,configurable:true});Object.defineProperty(ChartTrendLines.prototype,"interceptValue",{/**
         * @private
         */get:function get(){return this.intercept;},/**
         * @private
         */set:function set(value){this.intercept=value;},enumerable:true,configurable:true});Object.defineProperty(ChartTrendLines.prototype,"forwardValue",{/**
         * @private
         */get:function get(){return this.forward;},/**
         * @private
         */set:function set(value){this.forward=value;},enumerable:true,configurable:true});Object.defineProperty(ChartTrendLines.prototype,"backwardValue",{/**
         * @private
         */get:function get(){return this.backward;},/**
         * @private
         */set:function set(value){this.backward=value;},enumerable:true,configurable:true});Object.defineProperty(ChartTrendLines.prototype,"isDisplayRSquared",{/**
         * @private
         */get:function get(){return this.displayRSquared;},/**
         * @private
         */set:function set(value){this.displayRSquared=value;},enumerable:true,configurable:true});Object.defineProperty(ChartTrendLines.prototype,"isDisplayEquation",{/**
         * @private
         */get:function get(){return this.displayEquation;},/**
         * @private
         */set:function set(value){this.displayEquation=value;},enumerable:true,configurable:true});/**
     * @private
     */ChartTrendLines.prototype.clone=function(){var chart=new ChartTrendLines();chart.type=this.type;chart.name=this.name;chart.forward=this.forward;chart.backward=this.backward;chart.intercept=this.intercept;chart.displayEquation=this.displayEquation;chart.displayRSquared=this.displayRSquared;return chart;};/**
     * @private
     */ChartTrendLines.prototype.destroy=function(){this.type=undefined;this.name=undefined;this.forward=undefined;this.backward=undefined;};return ChartTrendLines;}();/**
 * @private
 */var ChartTitleArea=/** @class */function(){/**
     * @private
     */function ChartTitleArea(){this.dataFormat=new ChartDataFormat();this.layout=new ChartLayout();}Object.defineProperty(ChartTitleArea.prototype,"chartfontName",{/**
         * @private
         */get:function get(){return this.fontName;},/**
         * @private
         */set:function set(value){this.fontName=value;},enumerable:true,configurable:true});Object.defineProperty(ChartTitleArea.prototype,"chartFontSize",{/**
         * @private
         */get:function get(){return this.fontSize;},/**
         * @private
         */set:function set(value){this.fontSize=value;},enumerable:true,configurable:true});/**
     * @private
     */ChartTitleArea.prototype.clone=function(){var chart=new ChartTitleArea();chart.fontName=this.fontName;chart.fontSize=this.fontSize;chart.dataFormat=this.dataFormat.clone();chart.layout=this.layout.clone();return chart;};/**
     * @private
     */ChartTitleArea.prototype.destroy=function(){this.fontName=undefined;this.fontSize=undefined;this.dataFormat=undefined;this.layout=undefined;};return ChartTitleArea;}();/**
 * @private
 */var ChartDataFormat=/** @class */function(){/**
     * @private
     */function ChartDataFormat(){this.fill=new ChartFill();this.line=new ChartFill();}/**
     * @private
     */ChartDataFormat.prototype.clone=function(){var chart=new ChartDataFormat();chart.fill=this.fill.clone();chart.line=this.line.clone();return chart;};/**
     * @private
     */ChartDataFormat.prototype.destroy=function(){this.fill=undefined;this.line=undefined;};return ChartDataFormat;}();/**
 * @private
 */var ChartFill=/** @class */function(){function ChartFill(){}Object.defineProperty(ChartFill.prototype,"color",{/**
         * @private
         */get:function get(){return this.fillColor;},/**
         * @private
         */set:function set(value){this.fillColor=value;},enumerable:true,configurable:true});Object.defineProperty(ChartFill.prototype,"rgb",{/**
         * @private
         */get:function get(){return this.fillRGB;},/**
         * @private
         */set:function set(value){this.fillRGB=value;},enumerable:true,configurable:true});/**
     * @private
     */ChartFill.prototype.clone=function(){var chart=new ChartFill();chart.fillColor=this.fillColor;chart.fillRGB=this.fillRGB;return chart;};/**
     * @private
     */ChartFill.prototype.destroy=function(){this.fillColor=undefined;this.fillRGB=undefined;};return ChartFill;}();/**
 * @private
 */var ChartLayout=/** @class */function(){function ChartLayout(){}Object.defineProperty(ChartLayout.prototype,"chartLayoutLeft",{/**
         * @private
         */get:function get(){return this.layoutX;},/**
         * @private
         */set:function set(value){this.layoutX=value;},enumerable:true,configurable:true});Object.defineProperty(ChartLayout.prototype,"chartLayoutTop",{/**
         * @private
         */get:function get(){return this.layoutY;},/**
         * @private
         */set:function set(value){this.layoutY=value;},enumerable:true,configurable:true});/**
     * @private
     */ChartLayout.prototype.clone=function(){var chart=new ChartLayout();chart.layoutX=this.layoutX;chart.layoutY=this.layoutY;return chart;};/**
     * @private
     */ChartLayout.prototype.destroy=function(){this.layoutX=undefined;this.layoutY=undefined;};return ChartLayout;}();/**
 * @private
 */var ChartCategoryAxis=/** @class */function(){function ChartCategoryAxis(){this.chartTitleArea=new ChartTitleArea();}Object.defineProperty(ChartCategoryAxis.prototype,"majorTick",{/**
         * @private
         */get:function get(){return this.majorTickMark;},/**
         * @private
         */set:function set(value){this.majorTickMark=value;},enumerable:true,configurable:true});Object.defineProperty(ChartCategoryAxis.prototype,"minorTick",{/**
         * @private
         */get:function get(){return this.minorTickMark;},/**
         * @private
         */set:function set(value){this.minorTickMark=value;},enumerable:true,configurable:true});Object.defineProperty(ChartCategoryAxis.prototype,"tickPosition",{/**
         * @private
         */get:function get(){return this.tickLabelPostion;},/**
         * @private
         */set:function set(value){this.tickLabelPostion=value;},enumerable:true,configurable:true});Object.defineProperty(ChartCategoryAxis.prototype,"minorGridLines",{/**
         * @private
         */get:function get(){return this.hasMinorGridLines;},/**
         * @private
         */set:function set(value){this.hasMinorGridLines=value;},enumerable:true,configurable:true});Object.defineProperty(ChartCategoryAxis.prototype,"majorGridLines",{/**
         * @private
         */get:function get(){return this.hasMajorGridLines;},/**
         * @private
         */set:function set(value){this.hasMajorGridLines=value;},enumerable:true,configurable:true});Object.defineProperty(ChartCategoryAxis.prototype,"interval",{/**
         * @private
         */get:function get(){return this.majorUnit;},/**
         * @private
         */set:function set(value){this.majorUnit=value;},enumerable:true,configurable:true});Object.defineProperty(ChartCategoryAxis.prototype,"max",{/**
         * @private
         */get:function get(){return this.maximumValue;},/**
         * @private
         */set:function set(value){this.maximumValue=value;},enumerable:true,configurable:true});Object.defineProperty(ChartCategoryAxis.prototype,"min",{/**
         * @private
         */get:function get(){return this.minimumValue;},/**
         * @private
         */set:function set(value){this.minimumValue=value;},enumerable:true,configurable:true});Object.defineProperty(ChartCategoryAxis.prototype,"categoryAxisTitle",{/**
         * @private
         */get:function get(){return this.title;},/**
         * @private
         */set:function set(value){this.title=value;},enumerable:true,configurable:true});Object.defineProperty(ChartCategoryAxis.prototype,"categoryAxisType",{/**
         * @private
         */get:function get(){return this.categoryType;},/**
         * @private
         */set:function set(value){this.categoryType=value;},enumerable:true,configurable:true});Object.defineProperty(ChartCategoryAxis.prototype,"categoryNumberFormat",{/**
         * @private
         */get:function get(){return this.numberFormat;},/**
         * @private
         */set:function set(value){this.numberFormat=value;},enumerable:true,configurable:true});Object.defineProperty(ChartCategoryAxis.prototype,"axisFontSize",{/**
         * @private
         */get:function get(){return this.fontSize;},/**
         * @private
         */set:function set(value){this.fontSize=value;},enumerable:true,configurable:true});Object.defineProperty(ChartCategoryAxis.prototype,"axisFontName",{/**
         * @private
         */get:function get(){return this.fontName;},/**
         * @private
         */set:function set(value){this.fontName=value;},enumerable:true,configurable:true});/**
     * @private
     */ChartCategoryAxis.prototype.clone=function(){var chart=new ChartCategoryAxis();chart.title=this.title;chart.categoryType=this.categoryType;chart.numberFormat=this.numberFormat;chart.fontSize=this.fontSize;chart.fontName=this.fontName;chart.hasMajorGridLines=this.hasMajorGridLines;chart.hasMinorGridLines=this.hasMinorGridLines;chart.minimumValue=this.minimumValue;chart.maximumValue=this.maximumValue;chart.majorUnit=this.majorUnit;chart.majorTickMark=this.majorTickMark;chart.minorTickMark=this.minorTickMark;chart.tickLabelPostion=this.tickLabelPostion;chart.chartTitleArea=this.chartTitleArea.clone();return chart;};/**
     * @private
     */ChartCategoryAxis.prototype.destroy=function(){this.title=undefined;this.categoryType=undefined;this.numberFormat=undefined;this.chartTitleArea=undefined;this.minimumValue=undefined;this.maximumValue=undefined;this.fontSize=undefined;this.fontName=undefined;this.majorUnit=undefined;this.majorTickMark=undefined;this.minorTickMark=undefined;this.tickLabelPostion=undefined;};return ChartCategoryAxis;}();/**
 * @private
 */var ChartDataTable=/** @class */function(){function ChartDataTable(){}Object.defineProperty(ChartDataTable.prototype,"showSeriesKeys",{/**
         * @private
         */get:function get(){return this.isSeriesKeys;},/**
         * @private
         */set:function set(value){this.isSeriesKeys=value;},enumerable:true,configurable:true});Object.defineProperty(ChartDataTable.prototype,"hasHorzBorder",{/**
         * @private
         */get:function get(){return this.isHorzBorder;},/**
         * @private
         */set:function set(value){this.isHorzBorder=value;},enumerable:true,configurable:true});Object.defineProperty(ChartDataTable.prototype,"hasVertBorder",{/**
         * @private
         */get:function get(){return this.isVertBorder;},/**
         * @private
         */set:function set(value){this.isVertBorder=value;},enumerable:true,configurable:true});Object.defineProperty(ChartDataTable.prototype,"hasBorders",{/**
         * @private
         */get:function get(){return this.isBorders;},/**
         * @private
         */set:function set(value){this.isBorders=value;},enumerable:true,configurable:true});/**
     * @private
     */ChartDataTable.prototype.clone=function(){var chart=new ChartDataTable();chart.isSeriesKeys=this.isSeriesKeys;chart.isHorzBorder=this.isHorzBorder;chart.isVertBorder=this.isVertBorder;chart.isBorders=this.isBorders;return chart;};/**
     * @private
     */ChartDataTable.prototype.destroy=function(){this.isSeriesKeys=undefined;this.isHorzBorder=undefined;this.isVertBorder=undefined;this.isBorders=undefined;};return ChartDataTable;}();/**
 * @private
 */var CommentCharacterElementBox=/** @class */function(_super){__extends$1(CommentCharacterElementBox,_super);function CommentCharacterElementBox(type){var _this=_super.call(this)||this;_this.commentType=0;_this.commentId='';_this.commentType=type;return _this;}Object.defineProperty(CommentCharacterElementBox.prototype,"comment",{get:function get(){return this.commentInternal;},set:function set(value){this.commentInternal=value;},enumerable:true,configurable:true});CommentCharacterElementBox.prototype.getLength=function(){return 1;};CommentCharacterElementBox.prototype.clone=function(){var comment=new CommentCharacterElementBox(this.commentType);comment.commentId=this.commentId;comment.commentType=this.commentType;return comment;};CommentCharacterElementBox.prototype.renderCommentMark=function(){if(this.commentType===0&&sf.base.isNullOrUndefined(this.commentMark)){this.commentMark=document.createElement('div');this.commentMark.style.display='none';this.commentMark.classList.add('e-de-cmt-mark');var span=document.createElement('span');span.classList.add('e-icons');span.classList.add('e-de-cmt-mark-icon');this.commentMark.appendChild(span);}if(this.line&&sf.base.isNullOrUndefined(this.commentMark.parentElement)){var documentHelper=this.line.paragraph.bodyWidget.page.documentHelper;documentHelper.pageContainer.appendChild(this.commentMark);this.commentMark.addEventListener('click',this.selectComment.bind(this));}};CommentCharacterElementBox.prototype.selectComment=function(){var documentHelper=this.line.paragraph.bodyWidget.page.documentHelper;if(documentHelper.owner){// if (!documentHelper.owner.commentReviewPane.commentPane.isEditMode) {
//     documentHelper.selectComment(this.comment);
// } else {
//     documentHelper.owner.showComments = true;
// }
documentHelper.selectComment(this.comment);}};CommentCharacterElementBox.prototype.removeCommentMark=function(){if(this.commentMark&&this.commentMark.parentElement){this.commentMark.removeEventListener('click',this.selectComment.bind(this));this.commentMark.parentElement.removeChild(this.commentMark);}};CommentCharacterElementBox.prototype.destroy=function(){if(this.commentMark){this.removeCommentMark();}};return CommentCharacterElementBox;}(ElementBox);/**
 * @private
 */var CommentElementBox=/** @class */function(_super){__extends$1(CommentElementBox,_super);function CommentElementBox(date){var _this=_super.call(this,0)||this;_this.authorIn='';_this.initialIn='';_this.done=false;_this.textIn='';_this.isReply=false;_this.ownerComment=undefined;_this.createdDate=date;_this.replyComments=[];return _this;}Object.defineProperty(CommentElementBox.prototype,"commentStart",{get:function get(){return this.commentStartIn;},set:function set(value){this.commentStartIn=value;},enumerable:true,configurable:true});Object.defineProperty(CommentElementBox.prototype,"commentEnd",{get:function get(){return this.commentEndIn;},set:function set(value){this.commentEndIn=value;},enumerable:true,configurable:true});Object.defineProperty(CommentElementBox.prototype,"author",{get:function get(){return this.authorIn;},set:function set(value){this.authorIn=value;},enumerable:true,configurable:true});Object.defineProperty(CommentElementBox.prototype,"initial",{get:function get(){return this.initialIn;},set:function set(value){this.initialIn=value;},enumerable:true,configurable:true});Object.defineProperty(CommentElementBox.prototype,"isResolved",{get:function get(){return this.done;},set:function set(value){this.done=value;},enumerable:true,configurable:true});Object.defineProperty(CommentElementBox.prototype,"date",{get:function get(){return this.createdDate;},enumerable:true,configurable:true});Object.defineProperty(CommentElementBox.prototype,"text",{get:function get(){return this.textIn;},set:function set(value){this.textIn=value;},enumerable:true,configurable:true});CommentElementBox.prototype.getLength=function(){return 1;};CommentElementBox.prototype.clone=function(){var comment=new CommentElementBox(this.date);comment.author=this.author;comment.initial=this.initial;comment.commentId=this.commentId;comment.replyComments=this.replyComments;comment.isResolved=this.isResolved;comment.text=this.text;return comment;};CommentElementBox.prototype.destroy=function(){this.ownerComment=undefined;};return CommentElementBox;}(CommentCharacterElementBox);/**
 * @private
 */var Page=/** @class */function(){/**
     * Initialize the constructor of Page
     */function Page(documentHelper){/**
         * Specifies the Bonding Rectangle
         * @private
         */this.boundingRectangle=new Rect(96,96,816,1056);/**
         * @private
         */this.repeatHeaderRowTableWidget=false;/**
         * Specifies the bodyWidgets
         * @default []
         * @private
         */this.bodyWidgets=[];/**
         * @private
         */this.headerWidget=undefined;/**
         * @private
         */this.footerWidget=undefined;/**
         * @private
         */this.footnoteWidget=undefined;/**
         * @private
         */this.endnoteWidget=undefined;/**
         * @private
         */this.currentPageNum=1;/**
         *
         */this.allowNextPageRendering=true;this.documentHelper=documentHelper;// let text: string = 'DocumentEditor';
}Object.defineProperty(Page.prototype,"index",{/**
         * @private
         */get:function get(){if(this.documentHelper){return this.documentHelper.pages.indexOf(this);}return-1;},enumerable:true,configurable:true});Object.defineProperty(Page.prototype,"previousPage",{/**
         * @private
         */get:function get(){var index=this.index;if(index>0){return this.documentHelper.pages[index-1];}return undefined;},enumerable:true,configurable:true});Object.defineProperty(Page.prototype,"nextPage",{/**
         * @private
         */get:function get(){var index=this.index;if(index<this.documentHelper.pages.length-1){return this.documentHelper.pages[index+1];}return undefined;},enumerable:true,configurable:true});Object.defineProperty(Page.prototype,"sectionIndex",{/**
         * @private
         */get:function get(){if(this.bodyWidgets.length>0){return this.bodyWidgets[0].index;}return-1;},enumerable:true,configurable:true});Object.defineProperty(Page.prototype,"viewer",{get:function get(){return this.documentHelper.owner.viewer;},enumerable:true,configurable:true});Page.prototype.destroy=function(){if(this.headerWidget){if(this.viewer&&this.documentHelper.owner.editor){this.documentHelper.owner.editor.removeFieldInWidget(this.headerWidget);// Remove content control
this.documentHelper.owner.editor.removeFieldInWidget(this.headerWidget,false,true);}this.headerWidget.destroy();}this.headerWidget=undefined;if(this.footerWidget){if(this.viewer&&this.documentHelper.owner.editor){this.documentHelper.owner.editor.removeFieldInWidget(this.footerWidget);// Remove content control
this.documentHelper.owner.editor.removeFieldInWidget(this.footerWidget,false,true);}this.footerWidget.destroy();}this.footerWidget=undefined;this.bodyWidgets=[];this.bodyWidgets=undefined;if(!sf.base.isNullOrUndefined(this.documentHelper)){if(!sf.base.isNullOrUndefined(this.documentHelper.pages)){this.documentHelper.removePage(this);}}this.documentHelper=undefined;};return Page;}();/**
 * @private
 */var WTableHolder=/** @class */function(){function WTableHolder(){this.tableColumns=[];/**
         * @private
         */this.tableWidth=0;}Object.defineProperty(WTableHolder.prototype,"columns",{get:function get(){return this.tableColumns;},enumerable:true,configurable:true});/**
     * @private
     */WTableHolder.prototype.resetColumns=function(){for(var i=0;i<this.tableColumns.length;i++){this.tableColumns[i].destroy();}this.tableColumns=[];};/**
     * @private
     */WTableHolder.prototype.getPreviousSpannedCellWidth=function(previousColumnIndex,curColumnIndex){var width=0;for(var i=previousColumnIndex;i<curColumnIndex;i++){width+=this.tableColumns[i].preferredWidth;}return width;};/**
     * @private
     */WTableHolder.prototype.addColumns=function(currentColumnIndex,columnSpan,width,sizeInfo,offset){for(var i=this.columns.length;i<columnSpan;i++){this.columns.push(new WColumn());}var availableWidth=0;for(var j=currentColumnIndex;j<columnSpan;j++){availableWidth+=this.columns[j].preferredWidth;}// If width to add is greater than preferred width, then preferred width will be increased.
// In case of Grid span > 1, only last grid column width will be updated.
var gridSpan=columnSpan-currentColumnIndex;if(!(gridSpan>1)&&availableWidth<width){this.columns[columnSpan-1].preferredWidth+=width-availableWidth;}if(sizeInfo.minimumWordWidth>this.columns[columnSpan-1].minimumWordWidth){this.columns[columnSpan-1].minimumWordWidth=sizeInfo.minimumWordWidth;}if(sizeInfo.maximumWordWidth>this.columns[columnSpan-1].maximumWordWidth){this.columns[columnSpan-1].maximumWordWidth=sizeInfo.maximumWordWidth;}if(sizeInfo.minimumWidth>this.columns[columnSpan-1].minimumWidth){this.columns[columnSpan-1].minimumWidth=sizeInfo.minimumWidth;}if(offset>this.columns[columnSpan-1].endOffset){this.columns[columnSpan-1].endOffset=offset;}};/**
     * @private
     */WTableHolder.prototype.getTotalWidth=function(type){var width=0;for(var i=0;i<this.columns.length;i++){var column=this.columns[i];width+=type===0?column.preferredWidth:type===1?column.minimumWordWidth:type===2?column.maximumWordWidth:column.minimumWidth;}return width;};/**
     * @private
     */WTableHolder.prototype.isFitColumns=function(containerWidth,preferredTableWidth,isAutoWidth){// Gets total preferred width.
var totalColumnWidth=this.getTotalWidth(0);// If auto table width, based on total column widths, minimum value will be updated.
if(isAutoWidth){this.tableWidth=preferredTableWidth>totalColumnWidth?totalColumnWidth:preferredTableWidth;}else{this.tableWidth=preferredTableWidth;}// If total columns width doesn't match table width, then all grid column widths will be updated by even factor.
// If totalColumnWidth < TableWidth, all grid columns are enlarged. Otherwise shrinked.
if(totalColumnWidth!==this.tableWidth){var factor=this.tableWidth/totalColumnWidth;factor=isNaN(factor)||factor===Infinity?1:factor;for(var i=0;i<this.columns.length;i++){var column=this.columns[i];//column.PreferredWidth = factor * column.PreferredWidth;
if(factor*column.preferredWidth<column.minWidth){return false;}}return true;}else{return true;}};/**
     * @private
     */WTableHolder.prototype.autoFitColumn=function(containerWidth,preferredTableWidth,isAuto,isNestedTable){// Cell's preferred width should be considered until the table width fits to the container width.
var maxTotal=0;var minTotal=0;// For preferred width set as 0 pixels (not auto), then minimum word width only need to be considered.
// But currently there is no way to find any one of cell in particular column has 0 px preferred width set.
// If all columns are set as 0 pixels, then this will work.
var remainingWidthTotal=0;for(var i=0;i<this.columns.length;i++){var column=this.columns[i];// If preferred width of column is less than column minimum width and also column is empty, considered column preferred width
if(column.minimumWordWidth===0&&column.maximumWordWidth===0&&column.minWidth===0){column.minimumWordWidth=column.preferredWidth;column.maximumWordWidth=column.preferredWidth;column.minWidth=column.preferredWidth;}maxTotal+=column.preferredWidth>column.maximumWordWidth?column.preferredWidth:column.maximumWordWidth;minTotal+=column.preferredWidth>column.minimumWordWidth?column.preferredWidth:column.minimumWordWidth;var preferred=column.preferredWidth===0?column.minimumWordWidth:column.preferredWidth>column.minimumWordWidth?column.preferredWidth:column.minimumWordWidth;var difference=column.maximumWordWidth-preferred;remainingWidthTotal+=difference>0?difference:0;}// Try to fit maximum word width to match preferredTableWidth.
if(maxTotal<=preferredTableWidth){for(var i=0;i<this.columns.length;i++){var column=this.columns[i];if(column.preferredWidth<column.maximumWordWidth){if(isNestedTable){column.preferredWidth=column.minimumWidth+column.minimumWordWidth;}else{column.preferredWidth=column.maximumWordWidth;}}}// If the width is defined for table(cells undefined) then fit the columns to preferred table width using FitColumns.
if(!isAuto){this.fitColumns(containerWidth,preferredTableWidth,isAuto);}}else{// If the table preferred table width is set, then check its greater than total minimum word width. 
// If yes then set table preferred table width as container width. Else, check whether the total minimum word width is less than container width.
// If yes, then set total minimum word width as container width. Else, set the container width to container width.
if(!isAuto){//let totalMinimumWordWidth: number = this.getTotalWidth(1);
//if (preferredTableWidth > totalMinimumWordWidth && totalMinimumWordWidth < containerWidth) {
this.fitColumns(containerWidth,preferredTableWidth,isAuto);return;//}
//containerWidth = preferredTableWidth < totalMinimumWordWidth ? totalMinimumWordWidth < containerWidth ? totalMinimumWordWidth : containerWidth : preferredTableWidth;
}// Try to fit minimum word width to match preferredTableWidth or containerWidth.
if(minTotal<=preferredTableWidth||minTotal<=containerWidth){var availableWidth=containerWidth>preferredTableWidth?containerWidth:preferredTableWidth;availableWidth=availableWidth-minTotal;for(var i=0;i<this.columns.length;i++){var column=this.columns[i];if(column.preferredWidth===0){column.preferredWidth=column.minimumWordWidth;}else{if(column.preferredWidth<column.minimumWordWidth){column.preferredWidth=column.minimumWordWidth;}if(!isNestedTable){var difference=column.maximumWordWidth-column.preferredWidth;difference=difference>0?difference:0;var factor=availableWidth*(difference/remainingWidthTotal);column.preferredWidth+=isNaN(factor)?0:factor;}}}}else{// Try to fit minimum width for each column and allot remaining space to columns based on their minimum word width.
var totalMinimumWordWidth=this.getTotalWidth(1);var totalMinWidth=this.getTotalWidth(3);var totalPreferredWidth=this.getTotalWidth(0);if(totalMinWidth>2112){var cellWidth=2112/this.columns.length;for(var i=0;i<this.columns.length;i++){this.columns[i].preferredWidth=cellWidth;}}else{var availableWidth=0;if(totalMinWidth<containerWidth){availableWidth=containerWidth-totalMinWidth;for(var i=0;i<this.columns.length;i++){var column=this.columns[i];// The factor depends of current column's minimum word width and total minimum word width.
var factor=availableWidth*column.minimumWordWidth/totalMinimumWordWidth;factor=isNaN(factor)?0:factor;if(column.preferredWidth<=column.minimumWidth){continue;}column.preferredWidth=column.minimumWidth+factor;}// table width exceeds container width
}else if(totalPreferredWidth>containerWidth){var factor=containerWidth/totalPreferredWidth;for(var i=0;i<this.columns.length;i++){var column=this.columns[i];column.preferredWidth=column.preferredWidth*factor;}}}}}this.tableWidth=this.getTotalWidth(0);};/**
     * @private
     */ // eslint-disable-next-line max-len
WTableHolder.prototype.fitColumns=function(containerWidth,preferredTableWidth,isAutoWidth,indent){if(sf.base.isNullOrUndefined(indent)){indent=0;}// Gets total preferred width.
var totalColumnWidth=this.getTotalWidth(0);// Neglected left indent value, because in preferred table width left indent value is neglected
if(isAutoWidth){totalColumnWidth-=indent;}// If auto table width, based on total column widths, minimum value will be updated.
if(isAutoWidth){this.tableWidth=totalColumnWidth;}else{this.tableWidth=preferredTableWidth;}// If total columns width doesn't match table width, then all grid column widths will be updated by even factor.
// If totalColumnWidth < TableWidth, all grid columns are enlarged. Otherwise shrinked.
if(totalColumnWidth!==this.tableWidth){var factor=this.tableWidth/totalColumnWidth;factor=isNaN(factor)||factor===Infinity?1:factor;for(var i=0;i<this.columns.length;i++){var column=this.columns[i];column.preferredWidth=factor*column.preferredWidth;}}};/**
     * @private
     */WTableHolder.prototype.getCellWidth=function(columnIndex,columnSpan,preferredTableWidth){var width=0;for(var i=0;i<columnSpan;i++){width+=this.tableColumns[i+columnIndex].preferredWidth;}return width;};/**
     * @private
     */WTableHolder.prototype.validateColumnWidths=function(){for(var i=0;i<this.columns.length;i++){if(i===0){if(this.columns[i].preferredWidth!==this.columns[i].endOffset){this.columns[i].preferredWidth=this.columns[i].endOffset;}}else{// If Previous column offset + current column preferred width is less than current column offset, 
// Then current column preferred width is set to current column offset - previous column offset.
if(this.columns[i-1].endOffset+this.columns[i].preferredWidth<this.columns[i].endOffset){this.columns[i].preferredWidth=this.columns[i].endOffset-this.columns[i-1].endOffset;}}}};/**
     * @private
     */WTableHolder.prototype.clone=function(){var tableHolder=new WTableHolder();tableHolder.tableWidth=this.tableWidth;for(var i=0;i<this.columns.length;i++){tableHolder.columns.push(this.columns[i].clone());}return tableHolder;};/**
     * @private
     */WTableHolder.prototype.destroy=function(){if(!sf.base.isNullOrUndefined(this.tableColumns)){for(var i=0;i<this.tableColumns.length;i++){var column=this.tableColumns[i];column.destroy();}}this.tableColumns=[];this.tableColumns=undefined;this.tableWidth=undefined;};return WTableHolder;}();/**
 * @private
 */var WColumn=/** @class */function(){function WColumn(){/**
         * @private
         */this.preferredWidth=0;/**
         * @private
         */this.minWidth=0;/**
         * @private
         */this.maxWidth=0;/**
         * @private
         */this.endOffset=0;/**
         * @private
         */this.minimumWordWidth=0;/**
         * @private
         */this.maximumWordWidth=0;/**
         * @private
         */this.minimumWidth=0;}/**
     * @private
     */WColumn.prototype.clone=function(){var column=new WColumn();column.preferredWidth=this.preferredWidth;column.minWidth=this.minWidth;column.maxWidth=this.maxWidth;return column;};/**
     * @private
     */WColumn.prototype.destroy=function(){this.preferredWidth=undefined;this.minWidth=undefined;this.maxWidth=undefined;};return WColumn;}();/**
 * @private
 */var ColumnSizeInfo=/** @class */function(){function ColumnSizeInfo(){/**
         * @private
         */this.minimumWordWidth=0;/**
         * @private
         */this.maximumWordWidth=0;/**
         * @private
         */this.minimumWidth=0;/**
         * @private
         */this.hasMinimumWidth=false;/**
         * @private
         */this.hasMinimumWordWidth=false;/**
         * @private
         */this.hasMaximumWordWidth=false;}return ColumnSizeInfo;}();/* eslint-disable */ /**
 * @private
 */var WTabStop=/** @class */function(){function WTabStop(){}Object.defineProperty(WTabStop.prototype,"position",{get:function get(){return this.positionIn;},set:function set(value){this.positionIn=value;},enumerable:true,configurable:true});Object.defineProperty(WTabStop.prototype,"deletePosition",{get:function get(){return this.deletePositionIn;},set:function set(value){this.deletePositionIn=value;},enumerable:true,configurable:true});Object.defineProperty(WTabStop.prototype,"tabJustification",{get:function get(){return this.justification;},set:function set(value){this.justification=value;},enumerable:true,configurable:true});Object.defineProperty(WTabStop.prototype,"tabLeader",{get:function get(){return this.leader;},set:function set(value){this.leader=value;},enumerable:true,configurable:true});WTabStop.prototype.destroy=function(){this.position=undefined;this.deletePosition=undefined;this.tabJustification=undefined;this.leader=undefined;};return WTabStop;}();/**
 * @private
 */var WParagraphFormat=/** @class */function(){function WParagraphFormat(node){this.uniqueParagraphFormat=undefined;this.ownerBase=undefined;this.baseStyle=undefined;this.tabs=undefined;this.ownerBase=node;this.listFormat=new WListFormat(this);this.tabs=[];}WParagraphFormat.prototype.getUpdatedTabs=function(){var inTabs=[];if(!sf.base.isNullOrUndefined(this.baseStyle)){var baseStyle=this.baseStyle;var tabStops=new Dictionary();while(!sf.base.isNullOrUndefined(baseStyle)){for(var _i=0,_a=baseStyle.paragraphFormat.tabs;_i<_a.length;_i++){var tab=_a[_i];if(!tabStops.containsKey(tab.position)){tabStops.add(tab.position,tab);}}baseStyle=baseStyle.basedOn;}for(var _b=0,_c=tabStops.keys;_b<_c.length;_b++){var key=_c[_b];if(!this.hasTabStop(parseFloat(key.toFixed(4)))){inTabs.push(tabStops.get(key));}}inTabs=inTabs.concat(this.tabs.filter(function(a){return a.position!==0&&a.deletePosition===0;}));inTabs=inTabs.sort(function(a,b){return a.position-b.position;});}return inTabs;};WParagraphFormat.prototype.hasTabStop=function(position){for(var i=0;i<this.tabs.length;i++){if(parseFloat(this.tabs[i].position.toFixed(4))===position||parseFloat(this.tabs[i].deletePosition.toFixed(4))===position){return true;}}return false;};Object.defineProperty(WParagraphFormat.prototype,"leftIndent",{get:function get(){return this.getPropertyValue('leftIndent');},set:function set(value){this.setPropertyValue('leftIndent',value);},enumerable:true,configurable:true});Object.defineProperty(WParagraphFormat.prototype,"rightIndent",{get:function get(){return this.getPropertyValue('rightIndent');},set:function set(value){this.setPropertyValue('rightIndent',value);},enumerable:true,configurable:true});Object.defineProperty(WParagraphFormat.prototype,"firstLineIndent",{get:function get(){return this.getPropertyValue('firstLineIndent');},set:function set(value){this.setPropertyValue('firstLineIndent',value);},enumerable:true,configurable:true});Object.defineProperty(WParagraphFormat.prototype,"beforeSpacing",{get:function get(){return this.getPropertyValue('beforeSpacing');},set:function set(value){this.setPropertyValue('beforeSpacing',value);},enumerable:true,configurable:true});Object.defineProperty(WParagraphFormat.prototype,"afterSpacing",{get:function get(){return this.getPropertyValue('afterSpacing');},set:function set(value){this.setPropertyValue('afterSpacing',value);},enumerable:true,configurable:true});Object.defineProperty(WParagraphFormat.prototype,"lineSpacing",{get:function get(){return this.getPropertyValue('lineSpacing');},set:function set(value){this.setPropertyValue('lineSpacing',value);},enumerable:true,configurable:true});Object.defineProperty(WParagraphFormat.prototype,"lineSpacingType",{get:function get(){return this.getPropertyValue('lineSpacingType');},set:function set(value){this.setPropertyValue('lineSpacingType',value);},enumerable:true,configurable:true});Object.defineProperty(WParagraphFormat.prototype,"textAlignment",{get:function get(){return this.getPropertyValue('textAlignment');},set:function set(value){this.setPropertyValue('textAlignment',value);},enumerable:true,configurable:true});Object.defineProperty(WParagraphFormat.prototype,"keepWithNext",{get:function get(){return this.getPropertyValue('keepWithNext');},set:function set(value){this.setPropertyValue('keepWithNext',value);},enumerable:true,configurable:true});Object.defineProperty(WParagraphFormat.prototype,"keepLinesTogether",{get:function get(){return this.getPropertyValue('keepLinesTogether');},set:function set(value){this.setPropertyValue('keepLinesTogether',value);},enumerable:true,configurable:true});Object.defineProperty(WParagraphFormat.prototype,"widowControl",{get:function get(){return this.getPropertyValue('widowControl');},set:function set(value){this.setPropertyValue('widowControl',value);},enumerable:true,configurable:true});Object.defineProperty(WParagraphFormat.prototype,"outlineLevel",{get:function get(){return this.getPropertyValue('outlineLevel');},set:function set(value){this.setPropertyValue('outlineLevel',value);},enumerable:true,configurable:true});Object.defineProperty(WParagraphFormat.prototype,"bidi",{get:function get(){return this.getPropertyValue('bidi');},set:function set(value){if(this.bidi!==value){if(this.textAlignment==='Left'){this.textAlignment='Right';}else if(this.textAlignment==='Right'){this.textAlignment='Left';}}this.setPropertyValue('bidi',value);},enumerable:true,configurable:true});Object.defineProperty(WParagraphFormat.prototype,"contextualSpacing",{get:function get(){return this.getPropertyValue('contextualSpacing');},set:function set(value){this.setPropertyValue('contextualSpacing',value);},enumerable:true,configurable:true});WParagraphFormat.prototype.getListFormatParagraphFormat=function(property){var paragraphFormat=this.getListPargaraphFormat(property);if(!sf.base.isNullOrUndefined(paragraphFormat)){return paragraphFormat.uniqueParagraphFormat.propertiesHash.get(WUniqueFormat.getPropertyType(WParagraphFormat.uniqueFormatType,property));}return undefined;};WParagraphFormat.prototype.getListPargaraphFormat=function(property){if(this.listFormat.listId>-1&&this.listFormat.listLevelNumber>-1){var level=this.listFormat.listLevel;var propertyType=WUniqueFormat.getPropertyType(WParagraphFormat.uniqueFormatType,property);if(!sf.base.isNullOrUndefined(level)&&!sf.base.isNullOrUndefined(level.paragraphFormat.uniqueParagraphFormat)&&level.paragraphFormat.uniqueParagraphFormat.propertiesHash.containsKey(propertyType)){return level.paragraphFormat;}else{return undefined;}}return undefined;};WParagraphFormat.prototype.getPropertyValue=function(property){if(!this.hasValue(property)){var formatInList=this.getListFormatParagraphFormat(property);if(this.baseStyle instanceof WParagraphStyle){var currentFormat=this;var baseStyle=this.baseStyle;while(!sf.base.isNullOrUndefined(baseStyle)){var listParaFormat=void 0;if(!this.listFormat.hasValue('listId')){listParaFormat=baseStyle.paragraphFormat.getListPargaraphFormat(property);}if(baseStyle.paragraphFormat.hasValue(property)){currentFormat=baseStyle.paragraphFormat;break;}else if(!sf.base.isNullOrUndefined(listParaFormat)&&listParaFormat.hasValue(property)){currentFormat=listParaFormat;break;}else{baseStyle=baseStyle.basedOn;}}if(!sf.base.isNullOrUndefined(baseStyle)){if(!sf.base.isNullOrUndefined(formatInList)&&this.listFormat.listId!==-1&&currentFormat.listFormat.listId===-1||!sf.base.isNullOrUndefined(formatInList)&&this.listFormat.listId!==currentFormat.listFormat.listId){return formatInList;}var propertyType=WUniqueFormat.getPropertyType(WParagraphFormat.uniqueFormatType,property);return currentFormat.uniqueParagraphFormat.propertiesHash.get(propertyType);}}if(!sf.base.isNullOrUndefined(formatInList)){return formatInList;}}else{var propertyType=WUniqueFormat.getPropertyType(WParagraphFormat.uniqueFormatType,property);if(!sf.base.isNullOrUndefined(this.uniqueParagraphFormat)&&this.uniqueParagraphFormat.propertiesHash.containsKey(propertyType)){return this.uniqueParagraphFormat.propertiesHash.get(propertyType);}}return this.getDefaultValue(property);};WParagraphFormat.prototype.getDefaultValue=function(property){var propertyType=WUniqueFormat.getPropertyType(WParagraphFormat.uniqueFormatType,property);var docParagraphFormat=this.documentParagraphFormat();var isInsideBodyWidget=true;if(this.ownerBase&&this.ownerBase instanceof ParagraphWidget){isInsideBodyWidget=this.ownerBase.containerWidget instanceof BodyWidget||this.ownerBase.containerWidget instanceof TableCellWidget;}var isPaste=!sf.base.isNullOrUndefined(this.ownerBase)&&!sf.base.isNullOrUndefined(this.ownerBase.bodyWidget)&&this.ownerBase.bodyWidget.page&&this.ownerBase.bodyWidget.page.documentHelper.owner.editor&&this.ownerBase.bodyWidget.page.documentHelper.owner.editor.isPaste;if(isInsideBodyWidget&&!isPaste&&!sf.base.isNullOrUndefined(docParagraphFormat)&&!sf.base.isNullOrUndefined(docParagraphFormat.uniqueParagraphFormat)){var propValue=docParagraphFormat.uniqueParagraphFormat.propertiesHash.get(propertyType);if(!sf.base.isNullOrUndefined(propValue)){return propValue;}}return WParagraphFormat.getPropertyDefaultValue(property);};WParagraphFormat.prototype.documentParagraphFormat=function(){var docParagraphFormat;if(!sf.base.isNullOrUndefined(this.ownerBase)){var bodyWidget=this.ownerBase.bodyWidget;if(!sf.base.isNullOrUndefined(bodyWidget)&&!sf.base.isNullOrUndefined(bodyWidget.page)){docParagraphFormat=bodyWidget.page.documentHelper.paragraphFormat;}}return docParagraphFormat;};WParagraphFormat.prototype.setPropertyValue=function(property,value){if(sf.base.isNullOrUndefined(value)||value===''){value=WParagraphFormat.getPropertyDefaultValue(property);}if(sf.base.isNullOrUndefined(this.uniqueParagraphFormat)){this.initializeUniqueParagraphFormat(property,value);}else{var propertyType=WUniqueFormat.getPropertyType(this.uniqueParagraphFormat.uniqueFormatType,property);if(this.uniqueParagraphFormat.propertiesHash.containsKey(propertyType)&&this.uniqueParagraphFormat.propertiesHash.get(propertyType)===value){//Do nothing, since no change in property value and return
return;}this.uniqueParagraphFormat=WParagraphFormat.uniqueParagraphFormats.updateUniqueFormat(this.uniqueParagraphFormat,property,value);}};WParagraphFormat.prototype.initializeUniqueParagraphFormat=function(property,propValue){var uniqueParaFormatTemp=new Dictionary();this.addUniqueParaFormat('leftIndent',property,propValue,uniqueParaFormatTemp);this.addUniqueParaFormat('rightIndent',property,propValue,uniqueParaFormatTemp);this.addUniqueParaFormat('firstLineIndent',property,propValue,uniqueParaFormatTemp);this.addUniqueParaFormat('textAlignment',property,propValue,uniqueParaFormatTemp);this.addUniqueParaFormat('beforeSpacing',property,propValue,uniqueParaFormatTemp);this.addUniqueParaFormat('afterSpacing',property,propValue,uniqueParaFormatTemp);this.addUniqueParaFormat('lineSpacing',property,propValue,uniqueParaFormatTemp);this.addUniqueParaFormat('lineSpacingType',property,propValue,uniqueParaFormatTemp);this.addUniqueParaFormat('outlineLevel',property,propValue,uniqueParaFormatTemp);this.addUniqueParaFormat('bidi',property,propValue,uniqueParaFormatTemp);this.addUniqueParaFormat('contextualSpacing',property,propValue,uniqueParaFormatTemp);this.addUniqueParaFormat('keepWithNext',property,propValue,uniqueParaFormatTemp);this.addUniqueParaFormat('keepLinesTogether',property,propValue,uniqueParaFormatTemp);this.addUniqueParaFormat('widowControl',property,propValue,uniqueParaFormatTemp);this.uniqueParagraphFormat=WParagraphFormat.uniqueParagraphFormats.addUniqueFormat(uniqueParaFormatTemp,WParagraphFormat.uniqueFormatType);};WParagraphFormat.prototype.addUniqueParaFormat=function(property,modifiedProperty,propValue,uniqueParaFormatTemp){var propertyType=WUniqueFormat.getPropertyType(WParagraphFormat.uniqueFormatType,property);if(property===modifiedProperty){uniqueParaFormatTemp.add(propertyType,propValue);}};WParagraphFormat.getPropertyDefaultValue=function(property){var value=undefined;switch(property){case'leftIndent':value=0;break;case'rightIndent':value=0;break;case'firstLineIndent':value=0;break;case'textAlignment':value='Left';break;case'beforeSpacing':value=0;break;case'afterSpacing':value=0;break;case'lineSpacing':value=1;break;case'lineSpacingType':value='Multiple';break;case'styleName':value='Normal';break;case'outlineLevel':value='BodyText';break;case'bidi':value=false;break;case'contextualSpacing':value=false;break;case'keepWithNext':value=false;break;case'keepLinesTogether':value=false;break;case'widowControl':value=true;break;}return value;};WParagraphFormat.prototype.clearFormat=function(){if(!sf.base.isNullOrUndefined(this.listFormat)){this.listFormat.clearFormat();}if(!sf.base.isNullOrUndefined(this.uniqueParagraphFormat)&&this.uniqueParagraphFormat.referenceCount===0){WParagraphFormat.uniqueParagraphFormats.remove(this.uniqueParagraphFormat);}this.uniqueParagraphFormat=undefined;this.baseStyle=undefined;};WParagraphFormat.prototype.destroy=function(){this.clearFormat();if(!sf.base.isNullOrUndefined(this.listFormat)){this.listFormat.destroy();}this.listFormat=undefined;if(this.tabs!==undefined){for(var i=0;i<this.tabs.length;i++){this.tabs[i].destroy();}this.tabs=undefined;}};WParagraphFormat.prototype.copyFormat=function(format){if(!sf.base.isNullOrUndefined(format)){if(!sf.base.isNullOrUndefined(format.uniqueParagraphFormat)){this.updateUniqueParagraphFormat(format);}if(!sf.base.isNullOrUndefined(format.listFormat)){this.listFormat.copyFormat(format.listFormat);}if(!sf.base.isNullOrUndefined(format.baseStyle)){this.baseStyle=format.baseStyle;}if(!sf.base.isNullOrUndefined(format.tabs)){for(var i=0;i<format.tabs.length;i++){this.tabs[i]=format.tabs[i];}}}};WParagraphFormat.prototype.updateUniqueParagraphFormat=function(format){var hash=undefined;if(this.uniqueParagraphFormat){hash=this.uniqueParagraphFormat.mergeProperties(format.uniqueParagraphFormat);if(this.uniqueParagraphFormat.referenceCount===0){WParagraphFormat.uniqueParagraphFormats.remove(this.uniqueParagraphFormat);this.uniqueParagraphFormat=undefined;}}this.uniqueParagraphFormat=new WUniqueFormat(WParagraphFormat.uniqueFormatType);if(sf.base.isNullOrUndefined(hash)){hash=this.uniqueParagraphFormat.mergeProperties(format.uniqueParagraphFormat);}this.uniqueParagraphFormat=WParagraphFormat.uniqueParagraphFormats.addUniqueFormat(hash,WParagraphFormat.uniqueFormatType);};WParagraphFormat.prototype.cloneFormat=function(){var format=new WParagraphFormat(undefined);format.uniqueParagraphFormat=this.uniqueParagraphFormat;format.baseStyle=this.baseStyle;if(sf.base.isNullOrUndefined(this.listFormat)){format.listFormat=undefined;}else{format.listFormat=this.listFormat.cloneListFormat();}return format;};WParagraphFormat.prototype.hasValue=function(property){if(!sf.base.isNullOrUndefined(this.uniqueParagraphFormat)&&!sf.base.isNullOrUndefined(this.uniqueParagraphFormat.propertiesHash)){var propertyType=WUniqueFormat.getPropertyType(this.uniqueParagraphFormat.uniqueFormatType,property);return this.uniqueParagraphFormat.propertiesHash.containsKey(propertyType);}return false;};WParagraphFormat.clear=function(){this.uniqueParagraphFormats.clear();};WParagraphFormat.prototype.applyStyle=function(baseStyle){this.baseStyle=baseStyle;this.listFormat.applyStyle(this.baseStyle);};WParagraphFormat.prototype.getValue=function(property){return this.hasValue(property)?this.getPropertyValue(property):undefined;};WParagraphFormat.prototype.mergeFormat=function(format,isStyle){isStyle=sf.base.isNullOrUndefined(isStyle)?false:isStyle;if(sf.base.isNullOrUndefined(this.getValue('leftIndent'))){this.leftIndent=format.getValue('leftIndent');}if(sf.base.isNullOrUndefined(this.getValue('rightIndent'))){this.rightIndent=format.getValue('rightIndent');}if(sf.base.isNullOrUndefined(this.getValue('firstLineIndent'))){this.firstLineIndent=format.getValue('firstLineIndent');}if(sf.base.isNullOrUndefined(this.getValue('beforeSpacing'))){this.beforeSpacing=format.getValue('beforeSpacing');}if(sf.base.isNullOrUndefined(this.getValue('afterSpacing'))){this.afterSpacing=format.getValue('afterSpacing');}if(sf.base.isNullOrUndefined(this.getValue('lineSpacing'))){this.lineSpacing=format.getValue('lineSpacing');}if(sf.base.isNullOrUndefined(this.getValue('lineSpacingType'))){this.lineSpacingType=format.getValue('lineSpacingType');}if(sf.base.isNullOrUndefined(this.getValue('textAlignment'))){this.textAlignment=format.getValue('textAlignment');}if(sf.base.isNullOrUndefined(this.getValue('outlineLevel'))){this.outlineLevel=format.getValue('outlineLevel');}if(!isStyle&&sf.base.isNullOrUndefined(this.getValue('bidi'))){this.bidi=format.getValue('bidi');}if(sf.base.isNullOrUndefined(this.getValue('contextualSpacing'))){this.contextualSpacing=format.getValue('contextualSpacing');}if(sf.base.isNullOrUndefined(this.getValue('keepWithNext'))){this.keepWithNext=format.getValue('keepWithNext');}if(sf.base.isNullOrUndefined(this.getValue('keepLinesTogether'))){this.keepLinesTogether=format.getValue('keepLinesTogether');}if(sf.base.isNullOrUndefined(this.getValue('widowControl'))){this.widowControl=format.getValue('widowControl');}if(sf.base.isNullOrUndefined(this.listFormat)){this.listFormat.mergeFormat(format.listFormat);}};WParagraphFormat.uniqueParagraphFormats=new WUniqueFormats();WParagraphFormat.uniqueFormatType=3;return WParagraphFormat;}();var __extends=undefined&&undefined.__extends||function(){var _extendStatics3=function extendStatics(d,b){_extendStatics3=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;}||function(d,b){for(var p in b){if(b.hasOwnProperty(p))d[p]=b[p];}};return _extendStatics3(d,b);};return function(d,b){_extendStatics3(d,b);function __(){this.constructor=d;}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};}();/* eslint-disable */ /**
 * @private
 */var WStyle=/** @class */function(){function WStyle(){}return WStyle;}();/**
 * @private
 */var WParagraphStyle=/** @class */function(_super){__extends(WParagraphStyle,_super);function WParagraphStyle(node){var _this=_super.call(this)||this;_this.ownerBase=node;_this.paragraphFormat=new WParagraphFormat(_this);_this.characterFormat=new WCharacterFormat(_this);return _this;}WParagraphStyle.prototype.destroy=function(){this.characterFormat.destroy();this.paragraphFormat.destroy();};WParagraphStyle.prototype.copyStyle=function(paraStyle){this.name=paraStyle.name;this.ownerBase=paraStyle.ownerBase;this.type=paraStyle.type;this.next=paraStyle.next;this.basedOn=paraStyle.basedOn;this.link=paraStyle.link;this.characterFormat.copyFormat(paraStyle.characterFormat);this.paragraphFormat.copyFormat(paraStyle.paragraphFormat);};return WParagraphStyle;}(WStyle);/**
 * @private
 */var WCharacterStyle=/** @class */function(_super){__extends(WCharacterStyle,_super);function WCharacterStyle(node){var _this=_super.call(this)||this;_this.ownerBase=node;_this.characterFormat=new WCharacterFormat(_this);return _this;}WCharacterStyle.prototype.destroy=function(){this.characterFormat.destroy();};WCharacterStyle.prototype.copyStyle=function(charStyle){this.name=charStyle.name;this.ownerBase=charStyle.ownerBase;this.type=charStyle.type;this.next=charStyle.next;this.basedOn=charStyle.basedOn;this.characterFormat.copyFormat(charStyle.characterFormat);};return WCharacterStyle;}(WStyle);/**
 * @private
 */var WStyles=/** @class */function(){function WStyles(){this.collection=[];/* eslint-enable @typescript-eslint/no-explicit-any */}Object.defineProperty(WStyles.prototype,"length",{get:function get(){return this.collection.length;},enumerable:true,configurable:true});WStyles.prototype.remove=function(item){this.collection=this.collection.filter(function(a){return a.name!==item.name;});};WStyles.prototype.push=function(item){if(item!=null&&item!==undefined){this.collection.push(item);}return 1;};WStyles.prototype.getItem=function(index){if(this.collection.length>index){return this.collection[index];}return null;};WStyles.prototype.indexOf=function(item){return this.collection.indexOf(item);};WStyles.prototype.contains=function(item){var index=this.collection.indexOf(item);return index>-1&&index<this.collection.length;};WStyles.prototype.clear=function(){while(this.collection.length>0){this.collection.pop();}};WStyles.prototype.findByName=function(name,type){var returnStyle;for(var _i=0,_a=this.collection;_i<_a.length;_i++){var value=_a[_i];if(value.name===name){returnStyle=value;if(!sf.base.isNullOrUndefined(type)&&value.type===type){returnStyle=value;}}}return returnStyle;};WStyles.prototype.getStyleNames=function(type){return this.collection.filter(function(a){return a.type===type;}).map(function(a){return a.name;});};/* eslint-disable @typescript-eslint/no-explicit-any */WStyles.prototype.getStyles=function(type){var styles=this.collection.filter(function(a){return a.type===type;}).map(function(a){return a;});var styleObjects=[];for(var _i=0,styles_1=styles;_i<styles_1.length;_i++){var style=styles_1[_i];var returnStyle={};var returnStyleObject={};returnStyleObject.characterFormat={};HelperMethods.writeCharacterFormat(returnStyleObject.characterFormat,true,style.characterFormat);returnStyle.name=style.name;returnStyle.style=JSON.stringify(returnStyleObject);styleObjects.push(returnStyle);}return styleObjects;};return WStyles;}();/* eslint-disable */ /**
 * @private
 */var WShading=/** @class */function(){function WShading(node){this.uniqueShadingFormat=undefined;this.ownerBase=undefined;this.ownerBase=node;}Object.defineProperty(WShading.prototype,"backgroundColor",{get:function get(){return this.getPropertyValue('backgroundColor');},set:function set(value){this.setPropertyValue('backgroundColor',value);},enumerable:true,configurable:true});Object.defineProperty(WShading.prototype,"foregroundColor",{get:function get(){return this.getPropertyValue('foregroundColor');},set:function set(value){this.setPropertyValue('foregroundColor',value);},enumerable:true,configurable:true});Object.defineProperty(WShading.prototype,"textureStyle",{get:function get(){return this.getPropertyValue('textureStyle');},set:function set(value){this.setPropertyValue('textureStyle',value);},enumerable:true,configurable:true});WShading.prototype.getPropertyValue=function(property){var hasValue=this.hasValue(property);if(hasValue){var propertyType=WUniqueFormat.getPropertyType(WShading.uniqueFormatType,property);if(!sf.base.isNullOrUndefined(this.uniqueShadingFormat)&&this.uniqueShadingFormat.propertiesHash.containsKey(propertyType)){return this.uniqueShadingFormat.propertiesHash.get(propertyType);}}return WShading.getPropertyDefaultValue(property);};WShading.prototype.setPropertyValue=function(property,value){if(sf.base.isNullOrUndefined(value)||value===''){value=WShading.getPropertyDefaultValue(property);}if(sf.base.isNullOrUndefined(this.uniqueShadingFormat)){this.initializeUniqueShading(property,value);}else{var propertyType=WUniqueFormat.getPropertyType(this.uniqueShadingFormat.uniqueFormatType,property);if(this.uniqueShadingFormat.propertiesHash.containsKey(propertyType)&&this.uniqueShadingFormat.propertiesHash.get(propertyType)===value){//Do nothing, since no change in property value and return
return;}this.uniqueShadingFormat=WShading.uniqueShadingFormats.updateUniqueFormat(this.uniqueShadingFormat,property,value);}};WShading.getPropertyDefaultValue=function(property){var value=undefined;switch(property){case'backgroundColor':value='empty';break;case'foregroundColor':value='empty';break;case'textureStyle':value='TextureNone';break;}return value;};WShading.prototype.initializeUniqueShading=function(property,propValue){var uniqueShadingTemp=new Dictionary();this.addUniqueShading('backgroundColor',property,propValue,uniqueShadingTemp);this.addUniqueShading('foregroundColor',property,propValue,uniqueShadingTemp);this.addUniqueShading('textureStyle',property,propValue,uniqueShadingTemp);this.uniqueShadingFormat=WShading.uniqueShadingFormats.addUniqueFormat(uniqueShadingTemp,WShading.uniqueFormatType);};WShading.prototype.addUniqueShading=function(property,modifiedProperty,propValue,uniqueShadingTemp){var propertyType=WUniqueFormat.getPropertyType(WShading.uniqueFormatType,property);if(property===modifiedProperty){uniqueShadingTemp.add(propertyType,propValue);}else{uniqueShadingTemp.add(propertyType,WShading.getPropertyDefaultValue(property));}};WShading.prototype.destroy=function(){if(!sf.base.isNullOrUndefined(this.uniqueShadingFormat)){WShading.uniqueShadingFormats.remove(this.uniqueShadingFormat);}this.uniqueShadingFormat=undefined;};WShading.prototype.cloneFormat=function(){var shading=new WShading(undefined);shading.backgroundColor=this.backgroundColor;shading.foregroundColor=this.foregroundColor;shading.textureStyle=this.textureStyle;return shading;};WShading.prototype.copyFormat=function(shading){if(!sf.base.isNullOrUndefined(shading)&&!sf.base.isNullOrUndefined(shading.uniqueShadingFormat)){this.backgroundColor=shading.backgroundColor;this.foregroundColor=shading.foregroundColor;this.textureStyle=shading.textureStyle;}};WShading.prototype.hasValue=function(property){if(!sf.base.isNullOrUndefined(this.uniqueShadingFormat)){var propertyType=WUniqueFormat.getPropertyType(this.uniqueShadingFormat.uniqueFormatType,property);return this.uniqueShadingFormat.propertiesHash.containsKey(propertyType);}return false;};WShading.clear=function(){this.uniqueShadingFormats.clear();};WShading.uniqueShadingFormats=new WUniqueFormats();WShading.uniqueFormatType=5;return WShading;}();/**
 * @private
 */var WTableFormat=/** @class */function(){function WTableFormat(owner){this.uniqueTableFormat=undefined;this.borders=new WBorders(this);this.shading=new WShading(this);this.ownerBase=undefined;this.ownerBase=owner;this.assignTableMarginValue(5.4,0,5.4,0);}Object.defineProperty(WTableFormat.prototype,"allowAutoFit",{get:function get(){return this.getPropertyValue('allowAutoFit');},set:function set(value){this.setPropertyValue('allowAutoFit',value);},enumerable:true,configurable:true});Object.defineProperty(WTableFormat.prototype,"cellSpacing",{get:function get(){return this.getPropertyValue('cellSpacing');},set:function set(value){if(value<0||value>264.6){throw new RangeError('The measurement must be between 0 px and 264.6 px.');}this.setPropertyValue('cellSpacing',value);},enumerable:true,configurable:true});Object.defineProperty(WTableFormat.prototype,"bottomMargin",{get:function get(){return this.getPropertyValue('bottomMargin');},set:function set(value){this.setPropertyValue('bottomMargin',value);},enumerable:true,configurable:true});Object.defineProperty(WTableFormat.prototype,"tableAlignment",{get:function get(){return this.getPropertyValue('tableAlignment');},set:function set(value){this.setPropertyValue('tableAlignment',value);},enumerable:true,configurable:true});Object.defineProperty(WTableFormat.prototype,"leftMargin",{get:function get(){return this.getPropertyValue('leftMargin');},set:function set(value){this.setPropertyValue('leftMargin',value);},enumerable:true,configurable:true});Object.defineProperty(WTableFormat.prototype,"topMargin",{get:function get(){return this.getPropertyValue('topMargin');},set:function set(value){this.setPropertyValue('topMargin',value);},enumerable:true,configurable:true});Object.defineProperty(WTableFormat.prototype,"rightMargin",{get:function get(){return this.getPropertyValue('rightMargin');},set:function set(value){this.setPropertyValue('rightMargin',value);},enumerable:true,configurable:true});Object.defineProperty(WTableFormat.prototype,"leftIndent",{get:function get(){return this.getPropertyValue('leftIndent');},set:function set(value){if(value<-1440||value>1440){throw new RangeError('The measurement must be between -1440 px and 1440 px.');}this.setPropertyValue('leftIndent',value);},enumerable:true,configurable:true});Object.defineProperty(WTableFormat.prototype,"preferredWidth",{get:function get(){return this.getPropertyValue('preferredWidth');},set:function set(value){this.setPropertyValue('preferredWidth',value);},enumerable:true,configurable:true});Object.defineProperty(WTableFormat.prototype,"preferredWidthType",{get:function get(){return this.getPropertyValue('preferredWidthType');},set:function set(value){this.setPropertyValue('preferredWidthType',value);},enumerable:true,configurable:true});Object.defineProperty(WTableFormat.prototype,"bidi",{get:function get(){return this.getPropertyValue('bidi');},set:function set(value){this.setPropertyValue('bidi',value);},enumerable:true,configurable:true});Object.defineProperty(WTableFormat.prototype,"horizontalPositionAbs",{get:function get(){return this.getPropertyValue('horizontalPositionAbs');},set:function set(value){this.setPropertyValue('horizontalPositionAbs',value);},enumerable:true,configurable:true});Object.defineProperty(WTableFormat.prototype,"horizontalPosition",{get:function get(){return this.getPropertyValue('horizontalPosition');},set:function set(value){this.setPropertyValue('horizontalPosition',value);},enumerable:true,configurable:true});/* eslint-disable */WTableFormat.prototype.getPropertyValue=function(property){var hasValue=this.hasValue(property);if(hasValue){var propertyType=WUniqueFormat.getPropertyType(WTableFormat.uniqueFormatType,property);if(!sf.base.isNullOrUndefined(this.uniqueTableFormat)&&this.uniqueTableFormat.propertiesHash.containsKey(propertyType)){return this.uniqueTableFormat.propertiesHash.get(propertyType);}}return WTableFormat.getPropertyDefaultValue(property);};WTableFormat.prototype.setPropertyValue=function(property,value){if(sf.base.isNullOrUndefined(value)||value===''){value=WTableFormat.getPropertyDefaultValue(property);}if(sf.base.isNullOrUndefined(this.uniqueTableFormat)){this.initializeUniqueTableFormat(property,value);}else{var propertyType=WUniqueFormat.getPropertyType(this.uniqueTableFormat.uniqueFormatType,property);if(this.uniqueTableFormat.propertiesHash.containsKey(propertyType)&&this.uniqueTableFormat.propertiesHash.get(propertyType)===value){//Do nothing, since no change in property value and return
return;}this.uniqueTableFormat=WTableFormat.uniqueTableFormats.updateUniqueFormat(this.uniqueTableFormat,property,value);}};WTableFormat.prototype.initializeUniqueTableFormat=function(property,propValue){var uniqueTableFormatTemp=new Dictionary();this.addUniqueTableFormat('allowAutoFit',property,propValue,uniqueTableFormatTemp);this.addUniqueTableFormat('cellSpacing',property,propValue,uniqueTableFormatTemp);this.addUniqueTableFormat('leftMargin',property,propValue,uniqueTableFormatTemp);this.addUniqueTableFormat('topMargin',property,propValue,uniqueTableFormatTemp);this.addUniqueTableFormat('bottomMargin',property,propValue,uniqueTableFormatTemp);this.addUniqueTableFormat('rightMargin',property,propValue,uniqueTableFormatTemp);this.addUniqueTableFormat('leftIndent',property,propValue,uniqueTableFormatTemp);this.addUniqueTableFormat('tableAlignment',property,propValue,uniqueTableFormatTemp);this.addUniqueTableFormat('preferredWidth',property,propValue,uniqueTableFormatTemp);this.addUniqueTableFormat('preferredWidthType',property,propValue,uniqueTableFormatTemp);this.addUniqueTableFormat('bidi',property,propValue,uniqueTableFormatTemp);this.addUniqueTableFormat('horizontalPositionAbs',property,propValue,uniqueTableFormatTemp);this.addUniqueTableFormat('horizontalPosition',property,propValue,uniqueTableFormatTemp);this.uniqueTableFormat=WTableFormat.uniqueTableFormats.addUniqueFormat(uniqueTableFormatTemp,WTableFormat.uniqueFormatType);};WTableFormat.prototype.addUniqueTableFormat=function(property,modifiedProperty,propValue,uniqueTableFormatTemp){var propertyType;propertyType=WUniqueFormat.getPropertyType(WTableFormat.uniqueFormatType,property);if(property===modifiedProperty){uniqueTableFormatTemp.add(propertyType,propValue);}};WTableFormat.getPropertyDefaultValue=function(property){var value=undefined;switch(property){case'allowAutoFit':value=false;break;case'cellSpacing':value=0;break;case'leftMargin':value=5.4;break;case'topMargin':value=0;break;case'bottomMargin':value=0;break;case'rightMargin':value=5.4;break;case'leftIndent':value=0;break;case'tableAlignment':value='Left';break;case'preferredWidth':value=0;break;case'preferredWidthType':value='Point';break;case'bidi':value=false;break;case'horizontalPositionAbs':value=null;break;case'horizontalPosition':value=0;break;}return value;};WTableFormat.prototype.assignTableMarginValue=function(left,top,right,bottom){this.leftMargin=left;this.topMargin=top;this.rightMargin=right;this.bottomMargin=bottom;};WTableFormat.prototype.initializeTableBorders=function(){this.borders.left.lineStyle='Single';this.borders.left.lineWidth=0.5;this.borders.right.lineStyle='Single';this.borders.right.lineWidth=0.5;this.borders.top.lineStyle='Single';this.borders.top.lineWidth=0.5;this.borders.bottom.lineStyle='Single';this.borders.bottom.lineWidth=0.5;this.borders.horizontal.lineStyle='Single';this.borders.horizontal.lineWidth=0.5;this.borders.vertical.lineStyle='Single';this.borders.vertical.lineWidth=0.5;};WTableFormat.prototype.destroy=function(){if(!sf.base.isNullOrUndefined(this.borders)){this.borders.destroy();}if(!sf.base.isNullOrUndefined(this.shading)){this.shading.destroy();}if(!sf.base.isNullOrUndefined(this.uniqueTableFormat)){WTableFormat.uniqueTableFormats.remove(this.uniqueTableFormat);}this.uniqueTableFormat=undefined;this.borders=undefined;this.shading=undefined;};WTableFormat.prototype.cloneFormat=function(){var tableFormat=new WTableFormat(undefined);tableFormat.leftIndent=this.leftIndent;tableFormat.tableAlignment=this.tableAlignment;tableFormat.cellSpacing=this.cellSpacing;tableFormat.leftMargin=this.leftMargin;tableFormat.rightMargin=this.rightMargin;tableFormat.topMargin=this.topMargin;tableFormat.bottomMargin=this.bottomMargin;tableFormat.preferredWidth=this.preferredWidth;tableFormat.preferredWidthType=this.preferredWidthType;tableFormat.horizontalPositionAbs=this.horizontalPositionAbs;tableFormat.horizontalPosition=this.horizontalPosition;tableFormat.borders=sf.base.isNullOrUndefined(this.borders)?undefined:this.borders.cloneFormat();tableFormat.shading=sf.base.isNullOrUndefined(this.shading)?undefined:this.shading.cloneFormat();tableFormat.bidi=this.bidi;tableFormat.allowAutoFit=this.allowAutoFit;return tableFormat;};WTableFormat.prototype.hasValue=function(property){if(!sf.base.isNullOrUndefined(this.uniqueTableFormat)){var propertyType=WUniqueFormat.getPropertyType(this.uniqueTableFormat.uniqueFormatType,property);return this.uniqueTableFormat.propertiesHash.containsKey(propertyType);}return false;};WTableFormat.prototype.copyFormat=function(format){if(!sf.base.isNullOrUndefined(format)){if(!sf.base.isNullOrUndefined(format.uniqueTableFormat)){this.cellSpacing=format.cellSpacing;this.leftMargin=format.leftMargin;this.topMargin=format.topMargin;this.rightMargin=format.rightMargin;this.bottomMargin=format.bottomMargin;this.leftIndent=format.leftIndent;this.tableAlignment=format.tableAlignment;this.preferredWidth=format.preferredWidth;this.preferredWidthType=format.preferredWidthType;this.bidi=format.bidi;this.allowAutoFit=format.allowAutoFit;this.horizontalPosition=format.horizontalPosition;this.horizontalPositionAbs=format.horizontalPositionAbs;}if(!sf.base.isNullOrUndefined(format.borders)){this.borders=new WBorders(this);this.borders.copyFormat(format.borders);}if(!sf.base.isNullOrUndefined(format.shading)){this.shading=new WShading(this);this.shading.copyFormat(format.shading);}}};WTableFormat.clear=function(){this.uniqueTableFormats.clear();};WTableFormat.uniqueTableFormats=new WUniqueFormats();WTableFormat.uniqueFormatType=8;return WTableFormat;}();/* eslint-disable */ /**
 * @private
 */var WCellFormat=/** @class */function(){function WCellFormat(node){this.uniqueCellFormat=undefined;this.borders=new WBorders(this);this.shading=new WShading(this);this.ownerBase=node;this.borders=new WBorders(this);this.shading=new WShading(this);}Object.defineProperty(WCellFormat.prototype,"leftMargin",{get:function get(){return this.getPropertyValue('leftMargin');},set:function set(value){this.setPropertyValue('leftMargin',value);},enumerable:true,configurable:true});Object.defineProperty(WCellFormat.prototype,"rightMargin",{get:function get(){return this.getPropertyValue('rightMargin');},set:function set(value){this.setPropertyValue('rightMargin',value);},enumerable:true,configurable:true});Object.defineProperty(WCellFormat.prototype,"topMargin",{get:function get(){return this.getPropertyValue('topMargin');},set:function set(value){this.setPropertyValue('topMargin',value);},enumerable:true,configurable:true});Object.defineProperty(WCellFormat.prototype,"bottomMargin",{get:function get(){return this.getPropertyValue('bottomMargin');},set:function set(value){this.setPropertyValue('bottomMargin',value);},enumerable:true,configurable:true});Object.defineProperty(WCellFormat.prototype,"cellWidth",{get:function get(){return this.getPropertyValue('cellWidth');},set:function set(value){this.setPropertyValue('cellWidth',value);},enumerable:true,configurable:true});Object.defineProperty(WCellFormat.prototype,"columnSpan",{get:function get(){return this.getPropertyValue('columnSpan');},set:function set(value){this.setPropertyValue('columnSpan',value);},enumerable:true,configurable:true});Object.defineProperty(WCellFormat.prototype,"rowSpan",{get:function get(){return this.getPropertyValue('rowSpan');},set:function set(value){this.setPropertyValue('rowSpan',value);},enumerable:true,configurable:true});Object.defineProperty(WCellFormat.prototype,"preferredWidth",{get:function get(){return this.getPropertyValue('preferredWidth');},set:function set(value){this.setPropertyValue('preferredWidth',value);},enumerable:true,configurable:true});Object.defineProperty(WCellFormat.prototype,"verticalAlignment",{get:function get(){return this.getPropertyValue('verticalAlignment');},set:function set(value){this.setPropertyValue('verticalAlignment',value);},enumerable:true,configurable:true});Object.defineProperty(WCellFormat.prototype,"preferredWidthType",{get:function get(){return this.getPropertyValue('preferredWidthType');},set:function set(value){this.setPropertyValue('preferredWidthType',value);},enumerable:true,configurable:true});WCellFormat.prototype.getPropertyValue=function(property){var hasValue=this.hasValue(property);if(hasValue){var propertyType=WUniqueFormat.getPropertyType(WCellFormat.uniqueFormatType,property);if(!sf.base.isNullOrUndefined(this.uniqueCellFormat)&&this.uniqueCellFormat.propertiesHash.containsKey(propertyType)){return this.uniqueCellFormat.propertiesHash.get(propertyType);}}return WCellFormat.getPropertyDefaultValue(property);};WCellFormat.prototype.setPropertyValue=function(property,value){if(sf.base.isNullOrUndefined(value)||value===''){value=WCellFormat.getPropertyDefaultValue(property);}if(sf.base.isNullOrUndefined(this.uniqueCellFormat)){this.initializeUniqueCellFormat(property,value);}else{var propertyType=WUniqueFormat.getPropertyType(this.uniqueCellFormat.uniqueFormatType,property);if(this.uniqueCellFormat.propertiesHash.containsKey(propertyType)&&this.uniqueCellFormat.propertiesHash.get(propertyType)===value){//Do nothing, since no change in property value and return
return;}this.uniqueCellFormat=WCellFormat.uniqueCellFormats.updateUniqueFormat(this.uniqueCellFormat,property,value);}};WCellFormat.prototype.initializeUniqueCellFormat=function(property,propValue){var uniqueCellFormatTemp=new Dictionary();this.addUniqueCellFormat('leftMargin',property,propValue,uniqueCellFormatTemp);this.addUniqueCellFormat('topMargin',property,propValue,uniqueCellFormatTemp);this.addUniqueCellFormat('bottomMargin',property,propValue,uniqueCellFormatTemp);this.addUniqueCellFormat('rightMargin',property,propValue,uniqueCellFormatTemp);this.addUniqueCellFormat('cellWidth',property,propValue,uniqueCellFormatTemp);this.addUniqueCellFormat('columnSpan',property,propValue,uniqueCellFormatTemp);this.addUniqueCellFormat('rowSpan',property,propValue,uniqueCellFormatTemp);this.addUniqueCellFormat('preferredWidth',property,propValue,uniqueCellFormatTemp);this.addUniqueCellFormat('verticalAlignment',property,propValue,uniqueCellFormatTemp);this.addUniqueCellFormat('preferredWidthType',property,propValue,uniqueCellFormatTemp);this.uniqueCellFormat=WCellFormat.uniqueCellFormats.addUniqueFormat(uniqueCellFormatTemp,WCellFormat.uniqueFormatType);};WCellFormat.prototype.addUniqueCellFormat=function(property,modifiedProperty,propValue,uniqueCellFormatTemp){var propertyType=WUniqueFormat.getPropertyType(WCellFormat.uniqueFormatType,property);if(property===modifiedProperty){uniqueCellFormatTemp.add(propertyType,propValue);}};WCellFormat.getPropertyDefaultValue=function(property){var value=undefined;switch(property){case'leftMargin':value=undefined;break;case'topMargin':value=undefined;break;case'bottomMargin':value=undefined;break;case'rightMargin':value=undefined;break;case'cellWidth':value=0;break;case'columnSpan':value=1;break;case'rowSpan':value=1;break;case'preferredWidth':value=0;break;case'verticalAlignment':value='Top';break;case'preferredWidthType':value='Point';break;}return value;};WCellFormat.prototype.containsMargins=function(){return!sf.base.isNullOrUndefined(this.leftMargin)||!sf.base.isNullOrUndefined(this.rightMargin)||!sf.base.isNullOrUndefined(this.bottomMargin)||!sf.base.isNullOrUndefined(this.topMargin);};WCellFormat.prototype.destroy=function(){if(!sf.base.isNullOrUndefined(this.borders)){this.borders.destroy();}if(!sf.base.isNullOrUndefined(this.shading)){this.shading.destroy();}if(!sf.base.isNullOrUndefined(this.uniqueCellFormat)){WCellFormat.uniqueCellFormats.remove(this.uniqueCellFormat);}this.uniqueCellFormat=undefined;this.borders=undefined;this.shading=undefined;};WCellFormat.prototype.cloneFormat=function(){var format=new WCellFormat(undefined);format.verticalAlignment=this.verticalAlignment;format.leftMargin=this.leftMargin;format.rightMargin=this.rightMargin;format.topMargin=this.topMargin;format.bottomMargin=this.bottomMargin;format.preferredWidth=this.preferredWidth;format.preferredWidthType=this.preferredWidthType;format.cellWidth=this.cellWidth;format.borders=sf.base.isNullOrUndefined(this.borders)?undefined:this.borders.cloneFormat();format.shading=sf.base.isNullOrUndefined(this.shading)?undefined:this.shading.cloneFormat();return format;};WCellFormat.prototype.hasValue=function(property){if(!sf.base.isNullOrUndefined(this.uniqueCellFormat)){var propertyType=WUniqueFormat.getPropertyType(this.uniqueCellFormat.uniqueFormatType,property);return this.uniqueCellFormat.propertiesHash.containsKey(propertyType);}return false;};WCellFormat.prototype.copyFormat=function(format){if(!sf.base.isNullOrUndefined(format)){if(!sf.base.isNullOrUndefined(format.uniqueCellFormat)){this.cellWidth=format.cellWidth;this.leftMargin=format.leftMargin;this.topMargin=format.topMargin;this.rightMargin=format.rightMargin;this.bottomMargin=format.bottomMargin;this.preferredWidth=format.preferredWidth;this.columnSpan=format.columnSpan;this.rowSpan=format.rowSpan;this.preferredWidthType=format.preferredWidthType;this.verticalAlignment=format.verticalAlignment;}if(!sf.base.isNullOrUndefined(format.shading)){this.shading=new WShading(this);this.shading.copyFormat(format.shading);}if(!sf.base.isNullOrUndefined(format.borders)){this.borders=new WBorders(this);this.borders.copyFormat(format.borders);}}};WCellFormat.clear=function(){this.uniqueCellFormats.clear();};WCellFormat.uniqueCellFormats=new WUniqueFormats();WCellFormat.uniqueFormatType=4;return WCellFormat;}();/**
 * Formats Modules
 */ /**
 * List implementation
 */ /* eslint-disable */ /**
 * @private
 */var SfdtReader=/** @class */function(){function SfdtReader(documentHelper){/* eslint-disable @typescript-eslint/no-explicit-any */this.documentHelper=undefined;this.commentStarts=undefined;this.commentEnds=undefined;/**
         * @private
         */this.commentsCollection=undefined;/**
         * @private
         */this.revisionCollection=undefined;this.isPageBreakInsideTable=false;this.isParseHeader=false;this.footnotes=undefined;this.endnotes=undefined;/**
         * @private
         */this.isCutPerformed=false;/**
         * @private
         */this.isPaste=false;this.documentHelper=documentHelper;this.editableRanges=new Dictionary();}Object.defineProperty(SfdtReader.prototype,"isPasting",{get:function get(){return this.viewer&&this.viewer.owner.isPastingContent;},enumerable:true,configurable:true});Object.defineProperty(SfdtReader.prototype,"viewer",{get:function get(){return this.documentHelper.owner.viewer;},enumerable:true,configurable:true});SfdtReader.prototype.convertJsonToDocument=function(json){this.commentStarts=new Dictionary();this.commentEnds=new Dictionary();this.commentsCollection=new Dictionary();this.revisionCollection=new Dictionary();this.footnotes=new Footnote();this.endnotes=new Footnote();var sections=[];var jsonObject=json;jsonObject=jsonObject instanceof Object?jsonObject:JSON.parse(jsonObject);var characterFormat=sf.base.isNullOrUndefined(jsonObject.characterFormat)?this.viewer.owner.characterFormat:jsonObject.characterFormat;this.parseCharacterFormat(characterFormat,this.documentHelper.characterFormat);var paragraphFormat=sf.base.isNullOrUndefined(jsonObject.paragraphFormat)?this.viewer.owner.paragraphFormat:jsonObject.paragraphFormat;this.parseParagraphFormat(paragraphFormat,this.documentHelper.paragraphFormat);this.parseDocumentProtection(jsonObject);if(!sf.base.isNullOrUndefined(jsonObject.defaultTabWidth)){this.documentHelper.defaultTabWidth=jsonObject.defaultTabWidth;}if(!sf.base.isNullOrUndefined(jsonObject.trackChanges)){this.documentHelper.owner.showRevisions=jsonObject.trackChanges;this.documentHelper.owner.enableTrackChanges=jsonObject.trackChanges;}if(!sf.base.isNullOrUndefined(jsonObject.dontUseHTMLParagraphAutoSpacing)){this.documentHelper.dontUseHtmlParagraphAutoSpacing=jsonObject.dontUseHTMLParagraphAutoSpacing;}if(!sf.base.isNullOrUndefined(jsonObject.alignTablesRowByRow)){this.documentHelper.alignTablesRowByRow=jsonObject.alignTablesRowByRow;}if(!sf.base.isNullOrUndefined(jsonObject.background)){this.documentHelper.backgroundColor=this.getColor(jsonObject.background.color);}if(!sf.base.isNullOrUndefined(jsonObject.compatibilityMode)){this.documentHelper.compatibilityMode=jsonObject.compatibilityMode;}if(!sf.base.isNullOrUndefined(jsonObject.abstractLists)){this.parseAbstractList(jsonObject,this.documentHelper.abstractLists);}if(!sf.base.isNullOrUndefined(jsonObject.lists)){this.parseList(jsonObject,this.documentHelper.lists);}if(!sf.base.isNullOrUndefined(jsonObject.styles)){this.parseStyles(jsonObject,this.documentHelper.styles);}if(!sf.base.isNullOrUndefined(jsonObject.comments)){this.parseComments(jsonObject,this.documentHelper.comments);}if(!sf.base.isNullOrUndefined(jsonObject.revisions)){this.parseRevisions(jsonObject,this.viewer.owner.revisionsInternal.changes);}if(!sf.base.isNullOrUndefined(jsonObject.sections)){this.parseSections(jsonObject.sections,sections);}if(!sf.base.isNullOrUndefined(jsonObject.customXml)){this.parseCustomXml(jsonObject);}if(!sf.base.isNullOrUndefined(jsonObject.formFieldShading)){this.documentHelper.owner.documentEditorSettings.formFieldSettings.applyShading=jsonObject.formFieldShading;}if(!sf.base.isNullOrUndefined(jsonObject.footnotes)){this.parseFootnotes(jsonObject.footnotes,this.documentHelper.footnotes);}if(!sf.base.isNullOrUndefined(jsonObject.endnotes)){this.parseEndtnotes(jsonObject.endnotes,this.documentHelper.endnotes);}return sections;};SfdtReader.prototype.parseFootnotes=function(data,footnote){if(!sf.base.isNullOrUndefined(data.separator)){this.parseBody(data.separator,footnote.separator);}if(!sf.base.isNullOrUndefined(data.continuationNotice)){this.parseBody(data.continuationNotice,footnote.continuationNotice);}if(!sf.base.isNullOrUndefined(data.continuationSeparator)){this.parseBody(data.continuationSeparator,footnote.continuationSeparator);}};SfdtReader.prototype.parseEndtnotes=function(data,endnote){if(!sf.base.isNullOrUndefined(data.separator)){this.parseBody(data.separator,endnote.separator);}if(!sf.base.isNullOrUndefined(data.continuationNotice)){this.parseBody(data.continuationNotice,endnote.continuationNotice);}if(!sf.base.isNullOrUndefined(data.continuationSeparator)){this.parseBody(data.continuationSeparator,endnote.continuationSeparator);}};SfdtReader.prototype.parseCustomXml=function(data){for(var i=0;i<data.customXml.length;i++){var xmlData=data.customXml[i];if(!this.revisionCollection.containsKey(xmlData.itemID)){this.documentHelper.customXmlData.add(xmlData.itemID,xmlData.xml);}}};SfdtReader.prototype.parseDocumentProtection=function(data){if(!sf.base.isNullOrUndefined(data.formatting)){this.documentHelper.restrictFormatting=data.formatting;}if(!sf.base.isNullOrUndefined(data.enforcement)){this.documentHelper.isDocumentProtected=data.enforcement;}if(!sf.base.isNullOrUndefined(data.protectionType)){this.documentHelper.protectionType=data.protectionType;}if(!sf.base.isNullOrUndefined(data.hashValue)){this.documentHelper.hashValue=data.hashValue;}if(!sf.base.isNullOrUndefined(data.saltValue)){this.documentHelper.saltValue=data.saltValue;}};SfdtReader.prototype.parseStyles=function(data,styles){for(var i=0;i<data.styles.length;i++){if(sf.base.isNullOrUndefined(this.documentHelper.styles.findByName(data.styles[i].name))){this.parseStyle(data,data.styles[i],styles);}}};SfdtReader.prototype.parseRevisions=function(data,revisions){for(var i=0;i<data.revisions.length;i++){var revisionData=data.revisions[i];if(!sf.base.isNullOrUndefined(revisionData.revisionId)&&!sf.base.isNullOrUndefined(revisionData.revisionType)){var revision=this.parseRevision(revisionData);var revisionCheck=true;if(!this.documentHelper.owner.sfdtExportModule.copyWithTrackChange&&this.isPaste){if(revisionData.revisionType==='Insertion'&&this.isPaste&&this.documentHelper.owner.enableTrackChanges){continue;}else{if(!this.revisionCollection.containsKey(revisionData.revisionId)){this.revisionCollection.add(revisionData.revisionId,revision);}}}else{this.revisionCollection.add(revisionData.revisionId,revision);}for(var j=0;j<revisions.length;j++){if(revisions[j].revisionID===revision.revisionID){revisionCheck=false;}}if(revisionCheck){revisions.push(revision);}}}this.documentHelper.revisionsInternal=this.revisionCollection;if(this.documentHelper.owner.sfdtExportModule){this.documentHelper.owner.sfdtExportModule.copyWithTrackChange=false;}};SfdtReader.prototype.parseRevision=function(data){if(!sf.base.isNullOrUndefined(data)){var revision=new Revision(this.viewer.owner,data.author,data.date);revision.revisionID=data.revisionId;revision.revisionType=data.revisionType;return revision;}else{return undefined;}};SfdtReader.prototype.checkAndApplyRevision=function(inline,item){if(!sf.base.isNullOrUndefined(inline.revisionIds)&&inline.revisionIds.length>0){for(var i=0;i<inline.revisionIds.length;i++){var id=inline.revisionIds[i];if(this.revisionCollection.containsKey(id)){var revision=this.revisionCollection.get(id);if(!(item instanceof WParagraphFormat)){revision.range.push(item);}item.revisions.push(revision);}}}};SfdtReader.prototype.parseComments=function(data,comments){var count=0;for(var i=0;i<data.comments.length;i++){var commentData=data.comments[i];var commentElement=undefined;commentElement=this.parseComment(commentData,commentElement);while(count<commentData.replyComments.length){var replyComment=undefined;replyComment=this.parseComment(commentData.replyComments[count],replyComment);replyComment.ownerComment=commentElement;replyComment.isReply=true;commentElement.replyComments.push(replyComment);this.commentsCollection.add(replyComment.commentId,replyComment);count++;}this.commentsCollection.add(commentElement.commentId,commentElement);comments.push(commentElement);count=0;}};SfdtReader.prototype.parseComment=function(commentData,commentElement){commentElement=new CommentElementBox(commentData.date);commentElement.author=commentData.author;commentElement.initial=commentData.initial;commentElement.commentId=commentData.commentId;commentElement.isResolved=commentData.done;commentElement.text=this.parseCommentText(commentData.blocks);return commentElement;};SfdtReader.prototype.parseCommentText=function(blocks){var text='';for(var i=0;i<blocks.length;i++){if(i!==0){text+='\n';}for(var j=0;j<blocks[i].inlines.length;j++){text=text+blocks[i].inlines[j].text;}}return text;};SfdtReader.prototype.parseStyle=function(data,style,styles){var wStyle;if(!sf.base.isNullOrUndefined(style.type)){if(style.type==='Paragraph'){wStyle=new WParagraphStyle();wStyle.type='Paragraph';}if(style.type==='Character'){wStyle=new WCharacterStyle();wStyle.type='Character';}if(!sf.base.isNullOrUndefined(style.name)){wStyle.name=style.name;}styles.push(wStyle);if(!sf.base.isNullOrUndefined(style.basedOn)){var basedOn=styles.findByName(style.basedOn);if(!sf.base.isNullOrUndefined(basedOn)){if(basedOn.type===wStyle.type){wStyle.basedOn=basedOn;}}else{var basedStyle=this.getStyle(style.basedOn,data);var styleString=void 0;if(!sf.base.isNullOrUndefined(basedStyle)&&basedStyle.type===wStyle.type){styleString=basedStyle;}else{if(wStyle.type==='Paragraph'){styleString=JSON.parse('{"type":"Paragraph","name":"Normal","next":"Normal"}');}else{styleString=JSON.parse('{"type": "Character","name": "Default Paragraph Font"}');}}this.parseStyle(data,styleString,styles);wStyle.basedOn=styles.findByName(styleString.name);}}if(!sf.base.isNullOrUndefined(style.link)){var link=styles.findByName(style.link);var linkStyle=this.getStyle(style.link,data);var styleString=void 0;if(sf.base.isNullOrUndefined(link)){if(sf.base.isNullOrUndefined(linkStyle)){//Construct the CharacterStyle string
var charaStyle={};charaStyle.characterFormat=style.characterFormat;charaStyle.name=style.name+' Char';charaStyle.type='Character';//TODO: Implement basedOn
charaStyle.basedOn=style.basedOn==='Normal'?'Default Paragraph Font':style.basedOn+' Char';styleString=charaStyle;}else{styleString=linkStyle;}this.parseStyle(data,styleString,styles);wStyle.link=sf.base.isNullOrUndefined(styles.findByName(styleString.name))?style.link:styles.findByName(styleString.name);}else{wStyle.link=link;}}if(!sf.base.isNullOrUndefined(style.characterFormat)){this.parseCharacterFormat(style.characterFormat,wStyle.characterFormat);}if(!sf.base.isNullOrUndefined(style.paragraphFormat)){this.parseParagraphFormat(style.paragraphFormat,wStyle.paragraphFormat);}if(!sf.base.isNullOrUndefined(style.next)){if(style.next===style.name){wStyle.next=wStyle;}else{var next=styles.findByName(style.next);if(!sf.base.isNullOrUndefined(next)&&next.type===wStyle.type){wStyle.next=next;}else{var nextStyleString=this.getStyle(style.next,data);if(!sf.base.isNullOrUndefined(nextStyleString)){this.parseStyle(data,nextStyleString,styles);wStyle.next=styles.findByName(nextStyleString.name);}else{wStyle.next=wStyle;}}}}}};SfdtReader.prototype.getStyle=function(name,data){for(var i=0;i<data.styles.length;i++){if(data.styles[i].name===name){return data.styles[i];}}return undefined;};SfdtReader.prototype.parseAbstractList=function(data,abstractLists){for(var i=0;i<data.abstractLists.length;i++){var abstractList=new WAbstractList();var _abstract=data.abstractLists[i];abstractLists.push(abstractList);if(!sf.base.isNullOrUndefined(_abstract)){if(!sf.base.isNullOrUndefined(_abstract.abstractListId)){abstractList.abstractListId=_abstract.abstractListId;}if(!sf.base.isNullOrUndefined(_abstract.levels)){for(var j=0;j<_abstract.levels.length;j++){var level=_abstract.levels[j];if(!sf.base.isNullOrUndefined(level)){var listLevel=this.parseListLevel(level,abstractList);abstractList.levels.push(listLevel);}}}}}};SfdtReader.prototype.parseListLevel=function(data,owner){var listLevel=new WListLevel(owner);if(data.listLevelPattern==='Bullet'){listLevel.listLevelPattern='Bullet';listLevel.numberFormat=!sf.base.isNullOrUndefined(data.numberFormat)?data.numberFormat:'';}else{listLevel.listLevelPattern=data.listLevelPattern;listLevel.startAt=data.startAt;listLevel.numberFormat=!sf.base.isNullOrUndefined(data.numberFormat)?data.numberFormat:'';if(data.restartLevel>=0){listLevel.restartLevel=data.restartLevel;}else{listLevel.restartLevel=data.levelNumber;}}listLevel.followCharacter=data.followCharacter;this.parseCharacterFormat(data.characterFormat,listLevel.characterFormat);this.parseParagraphFormat(data.paragraphFormat,listLevel.paragraphFormat);return listLevel;};SfdtReader.prototype.parseList=function(data,listCollection){for(var i=0;i<data.lists.length;i++){var list=new WList();var lists=data.lists[i];if(!sf.base.isNullOrUndefined(lists.abstractListId)){list.abstractListId=lists.abstractListId;list.abstractList=this.documentHelper.getAbstractListById(lists.abstractListId);}listCollection.push(list);if(!sf.base.isNullOrUndefined(lists.listId)){list.listId=lists.listId;}if(lists.hasOwnProperty('levelOverrides')){this.parseLevelOverride(lists.levelOverrides,list);}}};SfdtReader.prototype.parseLevelOverride=function(data,list){if(sf.base.isNullOrUndefined(data)){return;}for(var i=0;i<data.length;i++){var levelOverrides=new WLevelOverride();var levelOverride=data[i];levelOverrides.startAt=levelOverride.startAt;levelOverrides.levelNumber=levelOverride.levelNumber;if(!sf.base.isNullOrUndefined(levelOverride.overrideListLevel)){levelOverrides.overrideListLevel=this.parseListLevel(levelOverride.overrideListLevel,levelOverrides);}list.levelOverrides.push(levelOverrides);}};SfdtReader.prototype.parseSections=function(data,sections){for(var i=0;i<data.length;i++){var section=new BodyWidget();section.sectionFormat=new WSectionFormat(section);section.index=i;var item=data[i];if(!sf.base.isNullOrUndefined(item.sectionFormat)){this.parseSectionFormat(item.sectionFormat,section.sectionFormat);}if(sf.base.isNullOrUndefined(item.headersFooters)){item.headersFooters={};}this.documentHelper.headersFooters.push(this.parseHeaderFooter(item.headersFooters,this.documentHelper.headersFooters));this.isParseHeader=false;this.parseTextBody(item.blocks,section,i+1<data.length);for(var i_1=0;i_1<section.childWidgets.length;i_1++){section.childWidgets[i_1].containerWidget=section;}sections.push(section);}};SfdtReader.prototype.parseHeaderFooter=function(data,headersFooters){this.isParseHeader=true;var hfs={};if(!sf.base.isNullOrUndefined(data.header)){var oddHeader=new HeaderFooterWidget('OddHeader');hfs[0]=oddHeader;this.parseTextBody(data.header.blocks,oddHeader);}if(!sf.base.isNullOrUndefined(data.footer)){var oddFooter=new HeaderFooterWidget('OddFooter');hfs[1]=oddFooter;this.parseTextBody(data.footer.blocks,oddFooter);}if(!sf.base.isNullOrUndefined(data.evenHeader)){var evenHeader=new HeaderFooterWidget('EvenHeader');hfs[2]=evenHeader;this.parseTextBody(data.evenHeader.blocks,evenHeader);}if(!sf.base.isNullOrUndefined(data.evenFooter)){var evenFooter=new HeaderFooterWidget('EvenFooter');hfs[3]=evenFooter;this.parseTextBody(data.evenFooter.blocks,evenFooter);}if(!sf.base.isNullOrUndefined(data.firstPageHeader)){var firstPageHeader=new HeaderFooterWidget('FirstPageHeader');hfs[4]=firstPageHeader;this.parseTextBody(data.firstPageHeader.blocks,firstPageHeader);}if(!sf.base.isNullOrUndefined(data.firstPageFooter)){var firstPageFooter=new HeaderFooterWidget('FirstPageFooter');hfs[5]=firstPageFooter;this.parseTextBody(data.firstPageFooter.blocks,firstPageFooter);}return hfs;};SfdtReader.prototype.parseTextBody=function(data,section,isSectionBreak){this.parseBody(data,section.childWidgets,section,isSectionBreak);};SfdtReader.prototype.addCustomStyles=function(data){if(!sf.base.isNullOrUndefined(data.styles)){for(var i=0;i<data.styles.length;i++){var style=this.documentHelper.styles.findByName(data.styles[i].name);if(style===undefined){this.parseStyle(data,data.styles[i],this.documentHelper.styles);}}}};SfdtReader.prototype.parseBody=function(data,blocks,container,isSectionBreak,contentControlProperties){if(!sf.base.isNullOrUndefined(data)){for(var i=0;i<data.length;i++){var block=data[i];var hasValidElmts=false;if(block.hasOwnProperty('inlines')){var writeInlineFormat=false;//writeInlineFormat = this.isPasting && i === data.length - 1;
var paragraph=new ParagraphWidget();paragraph.characterFormat=new WCharacterFormat(paragraph);paragraph.paragraphFormat=new WParagraphFormat(paragraph);if(block.inlines.length>0){hasValidElmts=this.parseParagraph(block.inlines,paragraph,writeInlineFormat);}if(!(isSectionBreak&&block===data[data.length-1]&&!hasValidElmts)){this.parseCharacterFormat(block.characterFormat,paragraph.characterFormat);this.parseParagraphFormat(block.paragraphFormat,paragraph.paragraphFormat);var styleObj=void 0;if(!sf.base.isNullOrUndefined(block.paragraphFormat)&&!sf.base.isNullOrUndefined(block.paragraphFormat.styleName)){styleObj=this.documentHelper.styles.findByName(block.paragraphFormat.styleName,'Paragraph');if(!sf.base.isNullOrUndefined(styleObj)){paragraph.paragraphFormat.applyStyle(styleObj);}}blocks.push(paragraph);}else if(isSectionBreak&&data.length===1){blocks.push(paragraph);}paragraph.index=blocks.length-1;paragraph.containerWidget=container;}else if(block.hasOwnProperty('rows')){this.parseTable(block,blocks,blocks.length,container);}else if(block.hasOwnProperty('contentControlProperties')){var blockStartContentControl=new ContentControl('Block');var blockEndContentControl=new ContentControl('Block');this.parseContentControlProperties(block.contentControlProperties,blockStartContentControl.contentControlProperties);blockEndContentControl.contentControlProperties=blockStartContentControl.contentControlProperties;blockStartContentControl.type=0;blockEndContentControl.type=1;this.parseBody(block.blocks,blocks,container,isSectionBreak,blockStartContentControl.contentControlProperties);for(var j=0;j<2;j++){var para=blocks.length<block.blocks.length?blocks[0]:j===0?blocks[blocks.length-block.blocks.length]:blocks[blocks.length-1];var blockWidget=void 0;if(para instanceof ParagraphWidget){blockWidget=para;}else if(para instanceof TableWidget){if(j===0){blockWidget=para.firstChild.firstChild.firstChild;}else{var cell=para.lastChild.lastChild;blockWidget=cell.lastChild;}}if(!sf.base.isNullOrUndefined(blockWidget)&&blockWidget.childWidgets.length===0){var lineWidget=new LineWidget(blockWidget);blockWidget.childWidgets.push(lineWidget);}if(j===0){blockWidget.firstChild.children.splice(0,0,blockStartContentControl);blockStartContentControl.line=blockWidget.firstChild;}else{blockWidget.lastChild.children.push(blockEndContentControl);blockEndContentControl.line=blockWidget.lastChild;}}}if(!sf.base.isNullOrUndefined(contentControlProperties)){blocks[blocks.length-1].contentControlProperties=contentControlProperties;}}}};SfdtReader.prototype.parseTable=function(block,blocks,index,section){var table=new TableWidget();table.index=index;table.tableFormat=new WTableFormat(table);if(!sf.base.isNullOrUndefined(block.tableFormat)){this.parseTableFormat(block.tableFormat,table.tableFormat);}table.title=block.title;table.description=block.description;this.parseTablePositioning(block,table);for(var i=0;i<block.rows.length;i++){var row=new TableRowWidget();row.rowFormat=new WRowFormat(row);var tableRow=block.rows[i];if(!sf.base.isNullOrUndefined(tableRow.contentControlProperties)){row.contentControlProperties=new ContentControlProperties('Row');this.parseContentControlProperties(tableRow.contentControlProperties,row.contentControlProperties);}if(tableRow.hasOwnProperty('rowFormat')){this.parseRowFormat(tableRow.rowFormat,row.rowFormat);this.parseRowGridValues(tableRow,row.rowFormat);this.parseRowGridValues(tableRow.rowFormat,row.rowFormat);row.index=i;for(var j=0;j<block.rows[i].cells.length;j++){var cell=new TableCellWidget();cell.cellFormat=new WCellFormat(cell);if(!sf.base.isNullOrUndefined(block.rows[i].cells[j].contentControlProperties)){cell.contentControlProperties=new ContentControlProperties('Cell');this.parseContentControlProperties(block.rows[i].cells[j].contentControlProperties,cell.contentControlProperties);}row.childWidgets.push(cell);cell.containerWidget=row;cell.index=j;cell.rowIndex=i;cell.columnIndex=j;if(block.rows[i].cells[j].hasOwnProperty('cellFormat')){this.parseCellFormat(block.rows[i].cells[j].cellFormat,cell.cellFormat);}var item=block.rows[i].cells[j].blocks;for(var k=0;k<item.length;k++){if(item[k].hasOwnProperty('rows')){table.isContainInsideTable=true;}}this.isPageBreakInsideTable=true;this.parseTextBody(block.rows[i].cells[j].blocks,cell,false);if(!sf.base.isNullOrUndefined(cell.contentControlProperties)){var cellStartContentControl=new ContentControl('Cell');var cellEndContentControl=new ContentControl('Cell');cellStartContentControl.contentControlProperties=cell.contentControlProperties;cellEndContentControl.contentControlProperties=cell.contentControlProperties;cellStartContentControl.type=0;cellEndContentControl.type=1;if(cell.firstChild.childWidgets.length===0){var lineWidget=new LineWidget(cell.firstChild);cell.firstChild.childWidgets.push(lineWidget);}cellStartContentControl.line=cell.firstChild.firstChild;cell.firstChild.firstChild.children.splice(0,0,cellStartContentControl);cellEndContentControl.line=cell.lastChild.lastChild;cell.lastChild.lastChild.children.push(cellEndContentControl);}if(!sf.base.isNullOrUndefined(row.contentControlProperties)){if(row.firstChild===cell){var rowStartContentControl=new ContentControl('Row');rowStartContentControl.contentControlProperties=row.contentControlProperties;rowStartContentControl.type=0;if(cell.firstChild.childWidgets.length===0){var lineWidget=new LineWidget(cell.firstChild);cell.firstChild.childWidgets.push(lineWidget);}rowStartContentControl.line=cell.firstChild.firstChild;cell.firstChild.firstChild.children.splice(0,0,rowStartContentControl);}else if(row.lastChild===cell){var rowEndContentControl=new ContentControl('Row');rowEndContentControl.contentControlProperties=row.contentControlProperties;rowEndContentControl.type=1;if(cell.lastChild.childWidgets.length===0){var lineWidget=new LineWidget(cell.lastChild);cell.lastChild.childWidgets.push(lineWidget);}rowEndContentControl.line=cell.lastChild.lastChild;cell.lastChild.lastChild.children.push(rowEndContentControl);}}this.isPageBreakInsideTable=false;}}table.childWidgets.push(row);row.containerWidget=table;}table.containerWidget=section;blocks.push(table);table.isGridUpdated=false;};SfdtReader.prototype.parseTablePositioning=function(block,table){table.wrapTextAround=!sf.base.isNullOrUndefined(block.wrapTextAround)?block.wrapTextAround:false;if(table.wrapTextAround){table.positioning=new TablePosition();table.positioning.allowOverlap=block.positioning.allowOverlap;table.positioning.distanceBottom=HelperMethods.convertPointToPixel(block.positioning.distanceBottom);table.positioning.distanceLeft=HelperMethods.convertPointToPixel(block.positioning.distanceLeft);table.positioning.distanceRight=HelperMethods.convertPointToPixel(block.positioning.distanceRight);table.positioning.distanceTop=HelperMethods.convertPointToPixel(block.positioning.distanceTop);if(!sf.base.isNullOrUndefined(block.positioning.verticalAlignment)){table.positioning.verticalAlignment=block.positioning.verticalAlignment;}if(!sf.base.isNullOrUndefined(block.positioning.verticalOrigin)){table.positioning.verticalOrigin=block.positioning.verticalOrigin;}table.positioning.verticalPosition=block.positioning.verticalPosition;if(!sf.base.isNullOrUndefined(block.positioning.horizontalAlignment)){table.positioning.horizontalAlignment=block.positioning.horizontalAlignment;}if(!sf.base.isNullOrUndefined(block.positioning.horizontalOrigin)){table.positioning.horizontalOrigin=block.positioning.horizontalOrigin;}table.positioning.horizontalPosition=block.positioning.horizontalPosition;}};SfdtReader.prototype.parseRowGridValues=function(data,rowFormat){if(!sf.base.isNullOrUndefined(data.gridBefore)){rowFormat.gridBefore=data.gridBefore;}if(!sf.base.isNullOrUndefined(data.gridBeforeWidth)){rowFormat.gridBeforeWidth=data.gridBeforeWidth;}if(!sf.base.isNullOrUndefined(data.gridBeforeWidthType)){rowFormat.gridBeforeWidthType=data.gridBeforeWidthType;}if(!sf.base.isNullOrUndefined(data.gridAfter)){rowFormat.gridAfter=data.gridAfter;}if(!sf.base.isNullOrUndefined(data.gridAfterWidth)){rowFormat.gridAfterWidth=data.gridAfterWidth;}if(!sf.base.isNullOrUndefined(data.gridAfterWidthType)){rowFormat.gridAfterWidthType=data.gridAfterWidthType;}};SfdtReader.prototype.parseContentControlProperties=function(wContentControlProperties,contentControlProperties){if(!sf.base.isNullOrUndefined(wContentControlProperties.lockContentControl)){contentControlProperties.lockContentControl=wContentControlProperties.lockContentControl;}if(!sf.base.isNullOrUndefined(wContentControlProperties.lockContents)){contentControlProperties.lockContents=wContentControlProperties.lockContents;}if(!sf.base.isNullOrUndefined(wContentControlProperties.tag)){contentControlProperties.tag=wContentControlProperties.tag;}if(!sf.base.isNullOrUndefined(wContentControlProperties.color)){contentControlProperties.color=wContentControlProperties.color;}if(!sf.base.isNullOrUndefined(wContentControlProperties.title)){contentControlProperties.title=wContentControlProperties.title;}if(!sf.base.isNullOrUndefined(wContentControlProperties.appearance)){contentControlProperties.appearance=wContentControlProperties.appearance;}if(!sf.base.isNullOrUndefined(wContentControlProperties.type)){contentControlProperties.type=wContentControlProperties.type;}if(!sf.base.isNullOrUndefined(wContentControlProperties.hasPlaceHolderText)){contentControlProperties.hasPlaceHolderText=wContentControlProperties.hasPlaceHolderText;}if(!sf.base.isNullOrUndefined(wContentControlProperties.multiline)){contentControlProperties.multiline=wContentControlProperties.multiline;}if(!sf.base.isNullOrUndefined(wContentControlProperties.isTemporary)){contentControlProperties.isTemporary=wContentControlProperties.isTemporary;}if(!sf.base.isNullOrUndefined(wContentControlProperties.characterFormat)){this.parseCharacterFormat(wContentControlProperties.characterFormat,contentControlProperties.characterFormat);}if(contentControlProperties.type==='CheckBox'){if(!sf.base.isNullOrUndefined(wContentControlProperties.isChecked)){contentControlProperties.isChecked=wContentControlProperties.isChecked;}if(!sf.base.isNullOrUndefined(wContentControlProperties.uncheckedState)){contentControlProperties.uncheckedState=new CheckBoxState();contentControlProperties.uncheckedState.font=wContentControlProperties.uncheckedState.font;contentControlProperties.uncheckedState.value=wContentControlProperties.uncheckedState.value;}if(!sf.base.isNullOrUndefined(wContentControlProperties.checkedState)){contentControlProperties.checkedState=new CheckBoxState();contentControlProperties.checkedState.font=wContentControlProperties.checkedState.font;contentControlProperties.checkedState.value=wContentControlProperties.checkedState.value;}}else if(contentControlProperties.type==='Date'){if(!sf.base.isNullOrUndefined(wContentControlProperties.dateCalendarType)){contentControlProperties.dateCalendarType=wContentControlProperties.dateCalendarType;}if(!sf.base.isNullOrUndefined(wContentControlProperties.dateStorageFormat)){contentControlProperties.dateStorageFormat=wContentControlProperties.dateStorageFormat;}if(!sf.base.isNullOrUndefined(wContentControlProperties.dateDisplayLocale)){contentControlProperties.dateDisplayLocale=wContentControlProperties.dateDisplayLocale;}if(!sf.base.isNullOrUndefined(wContentControlProperties.dateDisplayFormat)){contentControlProperties.dateDisplayFormat=wContentControlProperties.dateDisplayFormat;}}else if(contentControlProperties.type==='ComboBox'||contentControlProperties.type==='DropDownList'){if(!sf.base.isNullOrUndefined(wContentControlProperties.contentControlListItems)){for(var i=0;i<wContentControlProperties.contentControlListItems.length;i++){var contentControlListItem=new ContentControlListItems();contentControlListItem.displayText=wContentControlProperties.contentControlListItems[i].displayText;contentControlListItem.value=wContentControlProperties.contentControlListItems[i].value;contentControlProperties.contentControlListItems.push(contentControlListItem);}}}if(!sf.base.isNullOrUndefined(wContentControlProperties.xmlMapping)){contentControlProperties.xmlMapping=new XmlMapping();contentControlProperties.xmlMapping.isMapped=wContentControlProperties.xmlMapping.isMapped;contentControlProperties.xmlMapping.isWordMl=wContentControlProperties.xmlMapping.isWordMl;if(!sf.base.isNullOrUndefined(wContentControlProperties.xmlMapping.prefixMapping)){contentControlProperties.xmlMapping.prefixMapping=wContentControlProperties.xmlMapping.prefixMapping;}contentControlProperties.xmlMapping.xPath=wContentControlProperties.xmlMapping.xPath;contentControlProperties.xmlMapping.storeItemId=wContentControlProperties.xmlMapping.storeItemId;if(!sf.base.isNullOrUndefined(wContentControlProperties.xmlMapping.customXmlPart)){contentControlProperties.xmlMapping.customXmlPart=new CustomXmlPart();contentControlProperties.xmlMapping.customXmlPart.id=wContentControlProperties.xmlMapping.customXmlPart.id;contentControlProperties.xmlMapping.customXmlPart.xml=wContentControlProperties.xmlMapping.customXmlPart.xml;}}};/* eslint-disable  */SfdtReader.prototype.parseParagraph=function(data,paragraph,writeInlineFormat,lineWidget){var isContentControl=false;if(sf.base.isNullOrUndefined(lineWidget)){lineWidget=new LineWidget(paragraph);}else{isContentControl=true;}var hasValidElmts=false;var revision;var trackChange=this.viewer.owner.enableTrackChanges;for(var i=0;i<data.length;i++){var inline=data[i];if(inline.hasOwnProperty('text')){var textElement=undefined;if(this.documentHelper.isPageField){textElement=new FieldTextElementBox();textElement.fieldBegin=this.documentHelper.fieldStacks[this.documentHelper.fieldStacks.length-1];}else if(inline.text==='\t'){textElement=new TabElementBox();}else if(inline.text==='\f'&&this.isPageBreakInsideTable){continue;}else{textElement=new TextElementBox();}textElement.characterFormat=new WCharacterFormat(textElement);this.parseCharacterFormat(inline.characterFormat,textElement.characterFormat,writeInlineFormat);this.applyCharacterStyle(inline,textElement);textElement.text=inline.text;if(this.documentHelper.owner.parser.isPaste&&!this.isCutPerformed){if(!sf.base.isNullOrUndefined(inline.revisionIds)){for(var j=0;j<inline.revisionIds.length;j++){if(this.revisionCollection.containsKey(inline.revisionIds[j])){if(trackChange){revision=this.revisionCollection.get(inline.revisionIds[j]);}if(!sf.base.isNullOrUndefined(revision)&&!sf.base.isNullOrUndefined(lineWidget.children[i-1].revisions[j])&&(!trackChange||trackChange&&revision.revisionType==='Deletion')){if(revision.revisionID===inline.revisionIds[j]){inline.revisionIds[j]=lineWidget.children[i-1].revisions[j].revisionID;this.checkAndApplyRevision(inline,textElement);continue;}}if(!trackChange){revision=this.documentHelper.revisionsInternal.get(inline.revisionIds[j]);}this.documentHelper.owner.editorModule.insertRevision(textElement,revision.revisionType,revision.author);inline.revisionIds[j]=textElement.revisions[j].revisionID;}}}}else{this.checkAndApplyRevision(inline,textElement);}textElement.line=lineWidget;lineWidget.children.push(textElement);hasValidElmts=true;}else if(inline.hasOwnProperty('footnoteType')){var footnoteElement=new FootnoteElementBox();footnoteElement.line=lineWidget;footnoteElement.footnoteType=inline.footnoteType;if(footnoteElement.footnoteType==='Footnote'){this.documentHelper.footnoteCollection.push(footnoteElement);}else{this.documentHelper.endnoteCollection.push(footnoteElement);}footnoteElement.symbolCode=inline.symbolCode;footnoteElement.symbolFontName=inline.symbolFontName;footnoteElement.customMarker=inline.customMarker;footnoteElement.characterFormat=new WCharacterFormat(footnoteElement);this.parseCharacterFormat(inline.characterFormat,footnoteElement.characterFormat,writeInlineFormat);this.applyCharacterStyle(inline,footnoteElement);this.parseBody(inline.blocks,footnoteElement.blocks,undefined,false);lineWidget.children.push(footnoteElement);for(var j=0;j<footnoteElement.blocks.length;j++){footnoteElement.blocks[j].footNoteReference=footnoteElement;}hasValidElmts=true;}else if(inline.hasOwnProperty('chartType')){// chartPreservation
if(this.documentHelper.owner.editor){this.documentHelper.owner.editor.chartType=true;}var chartElement=new ChartElementBox();chartElement.title=inline.chartTitle;chartElement.type=inline.chartType;chartElement.chartGapWidth=inline.gapWidth;chartElement.chartOverlap=inline.overlap;this.parseChartTitleArea(inline.chartTitleArea,chartElement.chartTitleArea);this.parseChartArea(inline.chartArea,chartElement.chartArea);this.parseChartArea(inline.plotArea,chartElement.chartPlotArea);this.parseChartLegend(inline.chartLegend,chartElement.chartLegend);this.parseChartData(inline,chartElement);this.parseChartCategoryAxis(inline.chartPrimaryCategoryAxis,chartElement.chartPrimaryCategoryAxis);this.parseChartCategoryAxis(inline.chartPrimaryValueAxis,chartElement.chartPrimaryValueAxis);if(inline.chartDataTable!=null){this.parseChartDataTable(inline.chartDataTable,chartElement.chartDataTable);}chartElement.line=lineWidget;lineWidget.children.push(chartElement);chartElement.height=HelperMethods.convertPointToPixel(inline.height);chartElement.width=HelperMethods.convertPointToPixel(inline.width);var officeChart=new sf.officechart.ChartComponent();officeChart.chartRender(inline);chartElement.officeChart=officeChart;officeChart.chart.appendTo(chartElement.targetElement);hasValidElmts=true;}else if(inline.hasOwnProperty('imageString')){var image=new ImageElementBox(data[i].isInlineImage);image.isMetaFile=data[i].isMetaFile;image.isCompressed=data[i].isCompressed;image.metaFileImageString=data[i].metaFileImageString;image.characterFormat=new WCharacterFormat(image);image.line=lineWidget;this.checkAndApplyRevision(inline,image);lineWidget.children.push(image);var imageString=HelperMethods.formatClippedString(inline.imageString).formatClippedString;var isValidImage=this.validateImageUrl(imageString);if(!isValidImage){image.imageString='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAgVBMVEX///8AAADgAADY2Njl5eVcXFxjY2NZWVl/f3+wsLCmpqb4+PiioqKpqam7u7vV1dX2uLj2wsLhFRXzpKT3vb30sbHhCwv74+P40dH+9vbkIyO2trbBwcHLy8tsbGycnJz529v4zMzrbGzlLS3qZmblNzfrdXXoRkbvi4vvgYHlHh7CZsBOAAADpUlEQVR4nO3da1faQBSF4ekAUQlUEFs14AXxVv7/D6yaQiZx5mSEYXF2ut+PNKzyyK5diYDmR9czx34AB49C/CjE759w3jvvWr15Tdgz3atXE54f++EcIArxoxA/CvGjED8K8aMQPwrxoxA/CvGLEeZ9jPJdhfk4GyCUjb3ECGE/Q6m/q3DwfudjP0ERZYN9hKdn2hvd3+0jHJz5/kBVuTk96bbQUEjhYR9ckiikUH8UUqg/CinUH4UU6o9CCvVHIYX6o5BC/VFIof4opFB/FFKoPwop1B+FFOqPQgrjyxfjVC38Lxk9tnAxGqZqdKtSOE4GHA5/fuNJpDCtcNHbv4VqYYqPLjgfUViPQgrjozA2CptRSGF8/59w+Wrt+rr1btNna1cPzg0wwuXavncxabnX7PfHYYXzlYARvlobQZyUR9mXm+1NMEK7SSLONgcVV9vb8IQXv4J3KSeKKlxXxNCzONkeYp8AV3p9UT1+P3FWHVAsq5thhGZSEb1DrSZq7dS5HUdoLiuBZ6jORG3tCwAkNJfCUJ2Jrqe1P0ESCkMNTdSACYNDDU7UoAkDQw1P1MAJvUMVJmrwhJ6hShM1gMIvQxUnahCFjaHKEzWQQneoxR95ogZTWBuqPFEDKnSHKk/UoArdoYoTNbDC5lBDEzW4QjMpYiZqgIXG/S76JhwHK5zVVipcnkIVuv/RW/HyFKhwYhuFr6NiCmdNoDBUSGFjovJQEYXuRN9ahwoorJ8uSZenPsMTNk+X2q6jwgm/ntHL11HhhL4zenmoYEL/Gb04VCxh6KKTNFQoYfiikzBUJKF00Sk8VCChfF00OFQcYdt10dBQYYRT5xn0n9G7Q0X8GfCzNNEyZ6iPgD/HlydaVg11DfhajJaJlm2HugIUrlomWrYZKuJKHz6vHhbSM/hROdRnxNe1meuXYvW0DB6+aflYrB7dlzDiCM3N1dVN6GDhMCDhjlHYjEIK46MwNgqbUUhhfJ/vA07wO8N1vw94ONo/3e/lTpVOYfc/UyG//ZmqW52fi/FuTNW3/lZ+eguF+qOQQv1RSKH+KKRQfxRSqD8KKdQfhRTqj0IK9UchhfqjkEL9UUih/iikUH8UUqg/CmXh6Hsv3jlK+wnvD/vgkrSHMMuyu1P9ZdmuwnycDQYn+svG3n9KEUKT9zHyf6+IEWJHIX4U4kchfhTiRyF+FOJHIX4U4kchfnVhijeZa6sunCf4ZdPamteEHY5C/CjEr/vCv0ec0g+AtS1QAAAAAElFTkSuQmCC';}else{image.imageString=inline.imageString;}image.width=HelperMethods.convertPointToPixel(inline.width);image.height=HelperMethods.convertPointToPixel(inline.height);image.top=inline.top;image.left=inline.left;image.bottom=inline.bottom;image.right=inline.right;image.cropHeightScale=inline.getimageheight;image.cropWidthScale=inline.getimagewidth;image.name=inline.name;image.alternativeText=inline.alternativeText;image.title=inline.title;image.visible=inline.visible;image.widthScale=inline.widthScale;image.heightScale=inline.heightScale;image.verticalPosition=HelperMethods.convertPointToPixel(inline.verticalPosition);image.verticalOrigin=inline.verticalOrigin;image.verticalAlignment=inline.verticalAlignment;image.horizontalPosition=HelperMethods.convertPointToPixel(inline.horizontalPosition);image.horizontalOrigin=inline.horizontalOrigin;image.horizontalAlignment=inline.horizontalAlignment;image.allowOverlap=inline.allowOverlap;image.textWrappingStyle=sf.base.isNullOrUndefined(inline.textWrappingStyle)?'Inline':inline.textWrappingStyle;image.textWrappingType=inline.textWrappingType;image.zOrderPosition=inline.zOrderPosition;image.layoutInCell=inline.layoutInCell;if(image.textWrappingStyle!=='Inline'){paragraph.floatingElements.push(image);}this.parseCharacterFormat(inline.characterFormat,image.characterFormat);hasValidElmts=true;}else if(inline.hasOwnProperty('hasFieldEnd')||inline.hasOwnProperty('fieldType')&&inline.fieldType===0){var fieldBegin=new FieldElementBox(0);this.parseCharacterFormat(inline.characterFormat,fieldBegin.characterFormat,writeInlineFormat);this.applyCharacterStyle(inline,fieldBegin);fieldBegin.fieldCodeType=inline.fieldCodeType;fieldBegin.hasFieldEnd=inline.hasFieldEnd;if(inline.hasOwnProperty('formFieldData')){var formFieldData=void 0;if(inline.formFieldData.hasOwnProperty('textInput')){formFieldData=new TextFormField();formFieldData.type=inline.formFieldData.textInput.type;formFieldData.maxLength=inline.formFieldData.textInput.maxLength;formFieldData.defaultValue=inline.formFieldData.textInput.defaultValue;formFieldData.format=inline.formFieldData.textInput.format;}else if(inline.formFieldData.hasOwnProperty('checkBox')){formFieldData=new CheckBoxFormField();formFieldData.sizeType=inline.formFieldData.checkBox.sizeType;formFieldData.size=inline.formFieldData.checkBox.size;formFieldData.defaultValue=inline.formFieldData.checkBox.defaultValue;formFieldData.checked=inline.formFieldData.checkBox.checked;}else{formFieldData=new DropDownFormField();formFieldData.dropdownItems=inline.formFieldData.dropDownList.dropDownItems;formFieldData.selectedIndex=inline.formFieldData.dropDownList.selectedIndex;}formFieldData.name=inline.formFieldData.name;formFieldData.enabled=inline.formFieldData.enabled;formFieldData.helpText=inline.formFieldData.helpText;formFieldData.statusText=inline.formFieldData.statusText;fieldBegin.formFieldData=formFieldData;this.documentHelper.formFields.push(fieldBegin);}this.documentHelper.fieldStacks.push(fieldBegin);this.checkAndApplyRevision(inline,fieldBegin);fieldBegin.line=lineWidget;this.documentHelper.fields.push(fieldBegin);lineWidget.children.push(fieldBegin);}else if(inline.hasOwnProperty('fieldType')){var field=undefined;if(inline.fieldType===2){field=new FieldElementBox(2);this.fieldSeparator=field;if(this.documentHelper.fieldStacks.length>0){field.fieldBegin=this.documentHelper.fieldStacks[this.documentHelper.fieldStacks.length-1];field.fieldBegin.fieldSeparator=field;//finds the whether the field is page filed or not
var lineWidgetCount=lineWidget.children.length;if(lineWidgetCount>=2){var fieldTextElement=this.containsFieldBegin(lineWidget);if(!sf.base.isNullOrUndefined(fieldTextElement)&&fieldTextElement instanceof TextElementBox&&(fieldTextElement.text.match('PAGE')||fieldTextElement.text.match('page'))){this.documentHelper.isPageField=true;}}}}else if(inline.fieldType===1){field=new FieldElementBox(1);this.parseCharacterFormat(inline.characterFormat,field.characterFormat,writeInlineFormat);this.applyCharacterStyle(inline,field);this.checkAndApplyRevision(inline,field);//For Field End Updated begin and separator.                                      
if(this.documentHelper.fieldStacks.length>0){field.fieldBegin=this.documentHelper.fieldStacks[this.documentHelper.fieldStacks.length-1];field.fieldBegin.fieldEnd=field;}if(!sf.base.isNullOrUndefined(field.fieldBegin)&&field.fieldBegin.fieldSeparator){field.fieldSeparator=field.fieldBegin.fieldSeparator;field.fieldBegin.fieldSeparator.fieldEnd=field;hasValidElmts=true;}//After setting all the property clear the field values
this.documentHelper.fieldStacks.splice(this.documentHelper.fieldStacks.length-1,1);this.fieldSeparator=undefined;this.documentHelper.isPageField=false;this.documentHelper.fieldCollection.push(field.fieldBegin);}field.line=lineWidget;lineWidget.children.push(field);}else if(inline.hasOwnProperty('bookmarkType')){var bookmark=undefined;bookmark=new BookmarkElementBox(inline.bookmarkType);bookmark.name=inline.name;lineWidget.children.push(bookmark);bookmark.line=lineWidget;if(!this.isParseHeader||this.isPaste){if(inline.bookmarkType===0){var isAdd=this.isPaste&&!this.documentHelper.bookmarks.containsKey(bookmark.name);if(!this.isPaste||isAdd){this.documentHelper.bookmarks.add(bookmark.name,bookmark);}else if(!isAdd){lineWidget.children.splice(lineWidget.children.indexOf(bookmark),1);}}else if(inline.bookmarkType===1){if(this.documentHelper.bookmarks.containsKey(bookmark.name)){var bookmarkStart=this.documentHelper.bookmarks.get(bookmark.name);var isConsider=this.isPaste&&sf.base.isNullOrUndefined(bookmarkStart.reference);if(!this.isPaste||isConsider){bookmarkStart.reference=bookmark;bookmark.reference=bookmarkStart;}else if(!isConsider){lineWidget.children.splice(lineWidget.children.indexOf(bookmark),1);}}}}if(bookmark.name.indexOf('_')!==0){hasValidElmts=true;}}else if(inline.hasOwnProperty('editRangeId')){if(inline.hasOwnProperty('editableRangeStart')){var permEnd=new EditRangeEndElementBox();if(this.editableRanges.containsKey(inline.editRangeId)){var start=this.editableRanges.get(inline.editRangeId);permEnd.editRangeStart=start;start.editRangeEnd=permEnd;this.editableRanges.remove(inline.editRangeId);}lineWidget.children.push(permEnd);permEnd.line=lineWidget;}else{var permStart=this.parseEditableRangeStart(inline);lineWidget.children.push(permStart);permStart.line=lineWidget;if(!this.editableRanges.containsKey(inline.editRangeId)){this.editableRanges.add(inline.editRangeId,permStart);}}hasValidElmts=true;}else if(inline.hasOwnProperty('commentId')&&!this.isPaste){var commentID=inline.commentId;var commentStart=undefined;var comment=void 0;if(this.commentStarts.containsKey(commentID)){commentStart=this.commentStarts.get(commentID);}var commentEnd=undefined;if(this.commentEnds.containsKey(commentID)){commentEnd=this.commentEnds.get(commentID);}if(inline.hasOwnProperty('commentCharacterType')){if(inline.commentCharacterType===0){var commentStartElement=new CommentCharacterElementBox(0);commentStartElement.commentId=commentID;if(!this.commentStarts.containsKey(commentID)){this.commentStarts.add(commentID,commentStartElement);}commentStartElement.line=lineWidget;lineWidget.children.push(commentStartElement);comment=this.commentsCollection.get(commentID);if(!sf.base.isNullOrUndefined(comment)){comment.commentStart=commentStartElement;commentStartElement.comment=comment;}}else{var commentEndElement=new CommentCharacterElementBox(1);commentEndElement.commentId=commentID;if(!this.commentEnds.containsKey(commentID)){this.commentEnds.add(commentID,commentEndElement);}commentEndElement.line=lineWidget;lineWidget.children.push(commentEndElement);comment=this.commentsCollection.get(commentID);if(!sf.base.isNullOrUndefined(comment)){comment.commentEnd=commentEndElement;commentEndElement.comment=comment;}}if(!sf.base.isNullOrUndefined(comment)&&comment.isReply){if(sf.base.isNullOrUndefined(comment.ownerComment.commentStart)){comment.ownerComment.commentStart=comment.commentStart;}if(sf.base.isNullOrUndefined(comment.ownerComment.commentEnd)){comment.ownerComment.commentEnd=comment.commentEnd;}}}}else if(inline.hasOwnProperty('shapeId')){var shape=new ShapeElementBox();shape.shapeId=inline.shapeId;shape.name=inline.name;shape.alternativeText=inline.alternativeText;shape.title=inline.title;shape.visible=inline.visible;shape.width=HelperMethods.convertPointToPixel(inline.width);shape.height=HelperMethods.convertPointToPixel(inline.height);shape.widthScale=inline.widthScale;shape.heightScale=inline.heightScale;shape.verticalPosition=HelperMethods.convertPointToPixel(inline.verticalPosition);shape.verticalOrigin=inline.verticalOrigin;shape.verticalAlignment=inline.verticalAlignment;shape.verticalRelativePercent=inline.verticalRelativePercent;shape.horizontalPosition=HelperMethods.convertPointToPixel(inline.horizontalPosition);shape.horizontalOrigin=inline.horizontalOrigin;shape.horizontalAlignment=inline.horizontalAlignment;shape.horizontalRelativePercent=inline.horizontalRelativePercent;shape.zOrderPosition=inline.zOrderPosition;shape.allowOverlap=inline.allowOverlap;shape.textWrappingStyle=sf.base.isNullOrUndefined(inline.textWrappingStyle)?'InFrontOfText':inline.textWrappingStyle;shape.textWrappingType=inline.textWrappingType;shape.distanceBottom=HelperMethods.convertPointToPixel(inline.distanceBottom);shape.distanceLeft=HelperMethods.convertPointToPixel(inline.distanceLeft);shape.distanceRight=HelperMethods.convertPointToPixel(inline.distanceRight);shape.distanceTop=HelperMethods.convertPointToPixel(inline.distanceTop);shape.layoutInCell=inline.layoutInCell;shape.lockAnchor=inline.lockAnchor;shape.autoShapeType=inline.autoShapeType;if(inline.hasOwnProperty('lineFormat')){var lineFormat=new LineFormat();lineFormat.line=inline.lineFormat.line;lineFormat.lineFormatType=inline.lineFormat.lineFormatType;lineFormat.color=inline.lineFormat.color;lineFormat.weight=inline.lineFormat.weight;lineFormat.dashStyle=inline.lineFormat.lineStyle;shape.lineFormat=lineFormat;}if(inline.hasOwnProperty('fillFormat')){var fillFormat=new FillFormat();fillFormat.color=inline.fillFormat.color;fillFormat.fill=inline.fillFormat.fill;shape.fillFormat=fillFormat;}if(inline.hasOwnProperty('textFrame')){var textFrame=new TextFrame();textFrame.textVerticalAlignment=inline.textFrame.textVerticalAlignment;textFrame.marginLeft=inline.textFrame.leftMargin;textFrame.marginRight=inline.textFrame.rightMargin;textFrame.marginTop=inline.textFrame.topMargin;textFrame.marginBottom=inline.textFrame.bottomMargin;this.parseBody(inline.textFrame.blocks,textFrame.childWidgets,textFrame);shape.textFrame=textFrame;textFrame.containerShape=shape;}shape.line=lineWidget;lineWidget.children.push(shape);if(shape.textWrappingStyle!=='Inline'){paragraph.floatingElements.push(shape);}}else if(inline.hasOwnProperty('contentControlProperties')){var inlineStartContentControl=new ContentControl('Inline');var inlineEndContentControl=new ContentControl('Inline');this.parseContentControlProperties(inline.contentControlProperties,inlineStartContentControl.contentControlProperties);inlineEndContentControl.contentControlProperties=inlineStartContentControl.contentControlProperties;inlineStartContentControl.line=lineWidget;inlineEndContentControl.line=lineWidget;inlineStartContentControl.type=0;inlineEndContentControl.type=1;lineWidget.children.push(inlineStartContentControl);this.parseParagraph(inline.inlines,paragraph,writeInlineFormat,lineWidget);var element=lineWidget.children[lineWidget.children.length-1];while(!(element instanceof ContentControl)){element.contentControlProperties=inlineStartContentControl.contentControlProperties;element=element.previousElement;}lineWidget.children.push(inlineEndContentControl);hasValidElmts=true;}}this.isCutPerformed=false;if(!isContentControl){paragraph.childWidgets.push(lineWidget);}return hasValidElmts;};SfdtReader.prototype.applyCharacterStyle=function(inline,elementbox){if(!sf.base.isNullOrUndefined(inline.characterFormat)&&!sf.base.isNullOrUndefined(inline.characterFormat.styleName)){var charStyle=this.documentHelper.styles.findByName(inline.characterFormat.styleName,'Character');elementbox.characterFormat.applyStyle(charStyle);}};SfdtReader.prototype.parseEditableRangeStart=function(data){var permStart=new EditRangeStartElementBox();if(!sf.base.isNullOrUndefined(data.columnFirst)){permStart.columnFirst=data.columnFirst;}if(!sf.base.isNullOrUndefined(data.columnLast)){permStart.columnLast=data.columnLast;}if(!sf.base.isNullOrUndefined(data.user)){permStart.user=data.user;if(this.documentHelper.userCollection.indexOf(permStart.user)===-1){this.documentHelper.userCollection.push(permStart.user);}this.addEditRangeCollection(permStart.user,permStart);}if(!sf.base.isNullOrUndefined(data.group)&&data.group!==''){permStart.group=data.group;permStart.group=permStart.group==='everyone'?'Everyone':permStart.group;if(this.documentHelper.userCollection.indexOf(permStart.group)===-1){this.documentHelper.userCollection.push(permStart.group);}this.addEditRangeCollection(permStart.group,permStart);}return permStart;};SfdtReader.prototype.addEditRangeCollection=function(name,permStart){if(this.documentHelper.editRanges.containsKey(name)){var editStartCollection=this.documentHelper.editRanges.get(name);editStartCollection.push(permStart);}else{var newEditStartCollection=[];newEditStartCollection.push(permStart);this.documentHelper.editRanges.add(name,newEditStartCollection);}};SfdtReader.prototype.parseChartTitleArea=function(titleArea,chartTitleArea){chartTitleArea.chartfontName=titleArea.fontName;chartTitleArea.chartFontSize=titleArea.fontSize;this.parseChartDataFormat(titleArea.dataFormat,chartTitleArea.dataFormat);this.parseChartLayout(titleArea.layout,chartTitleArea.layout);};SfdtReader.prototype.parseChartDataFormat=function(format,dataFormat){dataFormat.fill.color=format.fill.foreColor;dataFormat.fill.rgb=format.fill.rgb;dataFormat.line.color=format.line.color;dataFormat.line.rgb=format.line.rgb;};SfdtReader.prototype.parseChartLayout=function(layout,chartLayout){chartLayout.chartLayoutLeft=layout.layoutX;chartLayout.chartLayoutTop=layout.layoutY;};SfdtReader.prototype.parseChartLegend=function(legend,chartLegend){chartLegend.chartLegendPostion=legend.position;this.parseChartTitleArea(legend.chartTitleArea,chartLegend.chartTitleArea);};SfdtReader.prototype.parseChartCategoryAxis=function(categoryAxis,primaryAxis){primaryAxis.categoryAxisType=categoryAxis.categoryType;primaryAxis.categoryNumberFormat=categoryAxis.numberFormat;primaryAxis.interval=categoryAxis.majorUnit;primaryAxis.axisFontSize=categoryAxis.fontSize;primaryAxis.axisFontName=categoryAxis.fontName;primaryAxis.max=categoryAxis.maximumValue;primaryAxis.min=categoryAxis.minimumValue;primaryAxis.majorGridLines=categoryAxis.hasMajorGridLines;primaryAxis.minorGridLines=categoryAxis.hasMinorGridLines;primaryAxis.majorTick=categoryAxis.majorTickMark;primaryAxis.minorTick=categoryAxis.minorTickMark;primaryAxis.tickPosition=categoryAxis.tickLabelPosition;primaryAxis.categoryAxisTitle=categoryAxis.chartTitle;if(categoryAxis.chartTitle!=null){this.parseChartTitleArea(categoryAxis.chartTitleArea,primaryAxis.chartTitleArea);}};SfdtReader.prototype.parseChartDataTable=function(dataTable,chartDataTable){chartDataTable.showSeriesKeys=dataTable.showSeriesKeys;chartDataTable.hasHorzBorder=dataTable.hasHorzBorder;chartDataTable.hasVertBorder=dataTable.hasVertBorder;chartDataTable.hasBorders=dataTable.hasBorders;};SfdtReader.prototype.parseChartArea=function(area,chartArea){chartArea.chartForeColor=area.foreColor;};SfdtReader.prototype.parseChartData=function(inline,chart){for(var i=0;i<inline.chartCategory.length;i++){var chartCategory=new ChartCategory();var xData=inline.chartCategory[i];if(xData.hasOwnProperty('categoryXName')){chartCategory.xName=xData.categoryXName;}for(var j=0;j<xData.chartData.length;j++){var chartData=new ChartData();var yData=xData.chartData[j];chartData.yAxisValue=yData.yValue;if(inline.chartType==='Bubble'){chartData.bubbleSize=yData.size;}chartCategory.chartData.push(chartData);}chart.chartCategory.push(chartCategory);}this.parseChartSeries(inline,chart);};SfdtReader.prototype.parseChartSeries=function(inline,chart){var chartType=inline.chartType;var isPieType=chartType==='Pie'||chartType==='Doughnut';for(var i=0;i<inline.chartSeries.length;i++){var chartSeries=new ChartSeries();var xData=inline.chartSeries[i];if(xData.hasOwnProperty('seriesName')){chartSeries.seriesName=xData.seriesName;if(isPieType){if(xData.hasOwnProperty('firstSliceAngle')){chartSeries.firstSliceAngle=xData.firstSliceAngle;}if(chartType==='Doughnut'){chartSeries.doughnutHoleSize=xData.holeSize;}}if(xData.hasOwnProperty('dataLabel')){this.parseChartDataLabels(xData.dataLabel,chartSeries);}if(xData.hasOwnProperty('seriesFormat')){var seriesFormat=new ChartSeriesFormat();var format=xData.seriesFormat;seriesFormat.markerStyle=format.markerStyle;seriesFormat.markerColor=format.markerColor;seriesFormat.numberValue=format.markerSize;chartSeries.seriesFormat=seriesFormat;}if(xData.hasOwnProperty('errorBar')){var errorBar=chartSeries.errorBar;errorBar.errorType=xData.errorBar.type;errorBar.errorDirection=xData.errorBar.direction;errorBar.errorEndStyle=xData.errorBar.endStyle;errorBar.numberValue=xData.errorBar.numberValue;}if(xData.hasOwnProperty('trendLines')){this.parseChartTrendLines(xData.trendLines,chartSeries);}this.parseChartSeriesDataPoints(xData.dataPoints,chartSeries);}chart.chartSeries.push(chartSeries);}};SfdtReader.prototype.parseChartDataLabels=function(dataLabels,series){var dataLabel=new ChartDataLabels();dataLabel.labelPosition=dataLabels.position;dataLabel.fontName=dataLabels.fontName;dataLabel.fontColor=dataLabels.fontColor;dataLabel.fontSize=dataLabels.fontSize;dataLabel.isLegendKey=dataLabels.isLegendKey;dataLabel.isBubbleSize=dataLabels.isBubbleSize;dataLabel.isCategoryName=dataLabels.isCategoryName;dataLabel.isSeriesName=dataLabels.isSeriesName;dataLabel.isValue=dataLabels.isValue;dataLabel.isPercentage=dataLabels.isPercentage;dataLabel.isLeaderLines=dataLabels.isLeaderLines;series.dataLabels=dataLabel;};SfdtReader.prototype.parseChartSeriesDataPoints=function(dataPoints,series){for(var i=0;i<dataPoints.length;i++){var chartFormat=new ChartDataFormat();this.parseChartDataFormat(dataPoints[i],chartFormat);series.chartDataFormat.push(chartFormat);}};SfdtReader.prototype.parseChartTrendLines=function(trendLines,series){for(var i=0;i<trendLines.length;i++){var data=trendLines[i];var trendLine=new ChartTrendLines();trendLine.trendLineName=data.name;trendLine.trendLineType=data.type;trendLine.forwardValue=data.forward;trendLine.backwardValue=data.backward;trendLine.interceptValue=data.intercept;trendLine.isDisplayEquation=data.isDisplayEquation;trendLine.isDisplayRSquared=data.isDisplayRSquared;series.trendLines.push(trendLine);}};SfdtReader.prototype.parseTableFormat=function(sourceFormat,tableFormat){this.parseBorders(sourceFormat.borders,tableFormat.borders);if(!sf.base.isNullOrUndefined(sourceFormat.allowAutoFit)){tableFormat.allowAutoFit=sourceFormat.allowAutoFit;}if(!sf.base.isNullOrUndefined(sourceFormat.cellSpacing)){tableFormat.cellSpacing=sourceFormat.cellSpacing;}if(!sf.base.isNullOrUndefined(sourceFormat.leftMargin)){tableFormat.leftMargin=sourceFormat.leftMargin;}if(!sf.base.isNullOrUndefined(sourceFormat.topMargin)){tableFormat.topMargin=sourceFormat.topMargin;}if(!sf.base.isNullOrUndefined(sourceFormat.rightMargin)){tableFormat.rightMargin=sourceFormat.rightMargin;}if(!sf.base.isNullOrUndefined(sourceFormat.bottomMargin)){tableFormat.bottomMargin=sourceFormat.bottomMargin;}if(!sf.base.isNullOrUndefined(sourceFormat.leftIndent)){tableFormat.leftIndent=sourceFormat.leftIndent;}this.parseShading(sourceFormat.shading,tableFormat.shading);if(!sf.base.isNullOrUndefined(sourceFormat.tableAlignment)){tableFormat.tableAlignment=sourceFormat.tableAlignment;}if(!sf.base.isNullOrUndefined(sourceFormat.preferredWidth)){tableFormat.preferredWidth=sourceFormat.preferredWidth;}if(!sf.base.isNullOrUndefined(sourceFormat.preferredWidthType)){tableFormat.preferredWidthType=sourceFormat.preferredWidthType;}if(!sf.base.isNullOrUndefined(sourceFormat.bidi)){tableFormat.bidi=sourceFormat.bidi;}if(!sf.base.isNullOrUndefined(sourceFormat.horizontalPositionAbs)){tableFormat.horizontalPositionAbs=sourceFormat.horizontalPositionAbs;}if(!sf.base.isNullOrUndefined(sourceFormat.horizontalPosition)){tableFormat.horizontalPosition=sourceFormat.horizontalPosition;}};SfdtReader.prototype.parseCellFormat=function(sourceFormat,cellFormat){if(!sf.base.isNullOrUndefined(sourceFormat)){this.parseBorders(sourceFormat.borders,cellFormat.borders);if(!sourceFormat.isSamePaddingAsTable){//    cellFormat.ClearMargins();
//else
this.parseCellMargin(sourceFormat,cellFormat);}if(!sf.base.isNullOrUndefined(sourceFormat.cellWidth)){cellFormat.cellWidth=sourceFormat.cellWidth;}if(!sf.base.isNullOrUndefined(sourceFormat.columnSpan)){cellFormat.columnSpan=sourceFormat.columnSpan;}if(!sf.base.isNullOrUndefined(sourceFormat.rowSpan)){cellFormat.rowSpan=sourceFormat.rowSpan;}this.parseShading(sourceFormat.shading,cellFormat.shading);if(!sf.base.isNullOrUndefined(sourceFormat.verticalAlignment)){cellFormat.verticalAlignment=sourceFormat.verticalAlignment;}if(!sf.base.isNullOrUndefined(sourceFormat.preferredWidthType)){cellFormat.preferredWidthType=sourceFormat.preferredWidthType;}if(!sf.base.isNullOrUndefined(sourceFormat.preferredWidth)){cellFormat.preferredWidth=sourceFormat.preferredWidth;}}};SfdtReader.prototype.parseCellMargin=function(sourceFormat,cellFormat){if(!sf.base.isNullOrUndefined(sourceFormat.leftMargin)){cellFormat.leftMargin=sourceFormat.leftMargin;}if(!sf.base.isNullOrUndefined(sourceFormat.rightMargin)){cellFormat.rightMargin=sourceFormat.rightMargin;}if(!sf.base.isNullOrUndefined(sourceFormat.topMargin)){cellFormat.topMargin=sourceFormat.topMargin;}if(!sf.base.isNullOrUndefined(sourceFormat.bottomMargin)){cellFormat.bottomMargin=sourceFormat.bottomMargin;}};SfdtReader.prototype.parseRowFormat=function(sourceFormat,rowFormat){if(!sf.base.isNullOrUndefined(sourceFormat)){if(!sf.base.isNullOrUndefined(sourceFormat.allowBreakAcrossPages)){rowFormat.allowBreakAcrossPages=sourceFormat.allowBreakAcrossPages;}if(!sf.base.isNullOrUndefined(sourceFormat.isHeader)){rowFormat.isHeader=sourceFormat.isHeader;}if(!sf.base.isNullOrUndefined(sourceFormat.heightType)){rowFormat.heightType=sourceFormat.heightType;}if(!sf.base.isNullOrUndefined(sourceFormat.height)){rowFormat.height=sourceFormat.height;}if(!sf.base.isNullOrUndefined(sourceFormat.leftMargin)){rowFormat.leftMargin=sourceFormat.leftMargin;}if(!sf.base.isNullOrUndefined(sourceFormat.topMargin)){rowFormat.topMargin=sourceFormat.topMargin;}if(!sf.base.isNullOrUndefined(sourceFormat.rightMargin)){rowFormat.rightMargin=sourceFormat.rightMargin;}if(!sf.base.isNullOrUndefined(sourceFormat.bottomMargin)){rowFormat.bottomMargin=sourceFormat.bottomMargin;}if(!sf.base.isNullOrUndefined(sourceFormat.leftIndent)){rowFormat.leftIndent=sourceFormat.leftIndent;}if(!sf.base.isNullOrUndefined(sourceFormat.revisionIds)&&sourceFormat.revisionIds.length>0){this.checkAndApplyRevision(sourceFormat,rowFormat);}this.parseBorders(sourceFormat.borders,rowFormat.borders);}};SfdtReader.prototype.parseBorders=function(sourceBorders,destBorder){if(!sf.base.isNullOrUndefined(sourceBorders)){this.parseBorder(sourceBorders.left,destBorder.left);this.parseBorder(sourceBorders.right,destBorder.right);this.parseBorder(sourceBorders.top,destBorder.top);this.parseBorder(sourceBorders.bottom,destBorder.bottom);this.parseBorder(sourceBorders.vertical,destBorder.vertical);this.parseBorder(sourceBorders.horizontal,destBorder.horizontal);this.parseBorder(sourceBorders.diagonalDown,destBorder.diagonalDown);this.parseBorder(sourceBorders.diagonalUp,destBorder.diagonalUp);}};SfdtReader.prototype.parseBorder=function(sourceBorder,destBorder){if(!sf.base.isNullOrUndefined(sourceBorder)){if(!sf.base.isNullOrUndefined(sourceBorder.color)){destBorder.color=this.getColor(sourceBorder.color);}if(!sf.base.isNullOrUndefined(sourceBorder.lineStyle)){destBorder.lineStyle=sourceBorder.lineStyle;}if(!sf.base.isNullOrUndefined(sourceBorder.lineWidth)){destBorder.lineWidth=sourceBorder.lineWidth;}if(!sf.base.isNullOrUndefined(sourceBorder.hasNoneStyle)){destBorder.hasNoneStyle=sourceBorder.hasNoneStyle;}}};SfdtReader.prototype.parseShading=function(sourceShading,destShading){if(!sf.base.isNullOrUndefined(sourceShading)){if(!sf.base.isNullOrUndefined(sourceShading.backgroundColor)){destShading.backgroundColor=this.getColor(sourceShading.backgroundColor);}if(!sf.base.isNullOrUndefined(sourceShading.foregroundColor)){destShading.foregroundColor=this.getColor(sourceShading.foregroundColor);}if(!sf.base.isNullOrUndefined(sourceShading.texture)||!sf.base.isNullOrUndefined(sourceShading.textureStyle)){destShading.textureStyle=!sf.base.isNullOrUndefined(sourceShading.texture)?sourceShading.texture:sourceShading.textureStyle;}}};/**
     * @private
     */SfdtReader.prototype.parseCharacterFormat=function(sourceFormat,characterFormat,writeInlineFormat){if(!sf.base.isNullOrUndefined(sourceFormat)){if(writeInlineFormat&&sourceFormat.hasOwnProperty('inlineFormat')){this.parseCharacterFormat(sourceFormat.inlineFormat,characterFormat);return;}if(!sf.base.isNullOrUndefined(sourceFormat.baselineAlignment)){characterFormat.baselineAlignment=sourceFormat.baselineAlignment;}if(!sf.base.isNullOrUndefined(sourceFormat.underline)){characterFormat.underline=sourceFormat.underline;}if(!sf.base.isNullOrUndefined(sourceFormat.strikethrough)){characterFormat.strikethrough=sourceFormat.strikethrough;}if(!sf.base.isNullOrUndefined(sourceFormat.fontSize)){sourceFormat.fontSize=parseFloat(sourceFormat.fontSize);var number=sourceFormat.fontSize*10;if(number%10!==0){number=sourceFormat.fontSize.toFixed(1)*10;//to check worst case scenerio like 8.2 or 8.7 like these to round off
if(number%5===0){sourceFormat.fontSize=sourceFormat.fontSize.toFixed(1);}else{sourceFormat.fontSize=Math.round(sourceFormat.fontSize);}}var fontSize=parseFloat(sourceFormat.fontSize);characterFormat.fontSize=fontSize<0?0:fontSize;}if(!sf.base.isNullOrUndefined(sourceFormat.fontFamily)){if(sourceFormat.fontFamily.indexOf('"')!==-1){sourceFormat.fontFamily=sourceFormat.fontFamily.replace('"','');}characterFormat.fontFamily=sourceFormat.fontFamily;}if(!sf.base.isNullOrUndefined(sourceFormat.bold)){characterFormat.bold=sourceFormat.bold;}if(!sf.base.isNullOrUndefined(sourceFormat.italic)){characterFormat.italic=sourceFormat.italic;}if(!sf.base.isNullOrUndefined(sourceFormat.highlightColor)){characterFormat.highlightColor=sourceFormat.highlightColor;}if(!sf.base.isNullOrUndefined(sourceFormat.fontColor)){characterFormat.fontColor=this.getColor(sourceFormat.fontColor);}if(!sf.base.isNullOrUndefined(sourceFormat.bidi)){characterFormat.bidi=sourceFormat.bidi;}if(!sf.base.isNullOrUndefined(sourceFormat.bdo)){characterFormat.bdo=sourceFormat.bdo;}if(!sf.base.isNullOrUndefined(sourceFormat.fontSizeBidi)){characterFormat.fontSizeBidi=sourceFormat.fontSizeBidi<0?0:sourceFormat.fontSizeBidi;}if(!sf.base.isNullOrUndefined(sourceFormat.fontFamilyBidi)){characterFormat.fontFamilyBidi=sourceFormat.fontFamilyBidi;}if(!sf.base.isNullOrUndefined(sourceFormat.boldBidi)){characterFormat.boldBidi=sourceFormat.boldBidi;}if(!sf.base.isNullOrUndefined(sourceFormat.italicBidi)){characterFormat.italicBidi=sourceFormat.italicBidi;}if(!sf.base.isNullOrUndefined(sourceFormat.revisionIds)&&sourceFormat.revisionIds.length>0){this.checkAndApplyRevision(sourceFormat,characterFormat);}if(!sf.base.isNullOrUndefined(sourceFormat.allCaps)){characterFormat.allCaps=sourceFormat.allCaps;}}};SfdtReader.prototype.getColor=function(color){var convertColor=color;return convertColor||'#ffffff';};SfdtReader.prototype.parseParagraphFormat=function(sourceFormat,paragraphFormat){if(!sf.base.isNullOrUndefined(sourceFormat)){if(!sf.base.isNullOrUndefined(sourceFormat.bidi)){paragraphFormat.bidi=sourceFormat.bidi;}if(!sf.base.isNullOrUndefined(sourceFormat.leftIndent)){paragraphFormat.leftIndent=sourceFormat.leftIndent;}if(!sf.base.isNullOrUndefined(sourceFormat.rightIndent)){paragraphFormat.rightIndent=sourceFormat.rightIndent;}if(!sf.base.isNullOrUndefined(sourceFormat.firstLineIndent)){paragraphFormat.firstLineIndent=sourceFormat.firstLineIndent;}if(!sf.base.isNullOrUndefined(sourceFormat.afterSpacing)){paragraphFormat.afterSpacing=sourceFormat.afterSpacing;}if(!sf.base.isNullOrUndefined(sourceFormat.beforeSpacing)){paragraphFormat.beforeSpacing=sourceFormat.beforeSpacing;}if(!sf.base.isNullOrUndefined(sourceFormat.lineSpacing)){paragraphFormat.lineSpacing=sourceFormat.lineSpacing;}if(!sf.base.isNullOrUndefined(sourceFormat.lineSpacingType)){paragraphFormat.lineSpacingType=sourceFormat.lineSpacingType;}else{if(!sf.base.isNullOrUndefined(sourceFormat.lineSpacing)){paragraphFormat.lineSpacingType='Multiple';}}if(!sf.base.isNullOrUndefined(sourceFormat.textAlignment)){paragraphFormat.textAlignment=sourceFormat.textAlignment;}if(!sf.base.isNullOrUndefined(sourceFormat.outlineLevel)){paragraphFormat.outlineLevel=sourceFormat.outlineLevel;}if(!sf.base.isNullOrUndefined(sourceFormat.contextualSpacing)){paragraphFormat.contextualSpacing=sourceFormat.contextualSpacing;}if(!sf.base.isNullOrUndefined(sourceFormat.widowControl)){paragraphFormat.widowControl=sourceFormat.widowControl;}if(!sf.base.isNullOrUndefined(sourceFormat.keepLinesTogether)){paragraphFormat.keepLinesTogether=sourceFormat.keepLinesTogether;}if(!sf.base.isNullOrUndefined(sourceFormat.keepLinesTogether)){paragraphFormat.keepLinesTogether=sourceFormat.keepLinesTogether;}paragraphFormat.listFormat=new WListFormat();if(sourceFormat.hasOwnProperty('listFormat')){this.parseListFormat(sourceFormat,paragraphFormat.listFormat);}if(sourceFormat.hasOwnProperty('tabs')){this.parseTabStop(sourceFormat.tabs,paragraphFormat.tabs);}}};SfdtReader.prototype.parseListFormat=function(block,listFormat){if(!sf.base.isNullOrUndefined(block.listFormat)){if(!sf.base.isNullOrUndefined(block.listFormat.listId)){listFormat.listId=block.listFormat.listId;listFormat.list=this.documentHelper.getListById(block.listFormat.listId);}if(!sf.base.isNullOrUndefined(block.listFormat.listLevelNumber)){listFormat.listLevelNumber=block.listFormat.listLevelNumber;}}};SfdtReader.prototype.parseSectionFormat=function(data,sectionFormat){if(!sf.base.isNullOrUndefined(data.pageWidth)){sectionFormat.pageWidth=data.pageWidth;}if(!sf.base.isNullOrUndefined(data.pageHeight)){sectionFormat.pageHeight=data.pageHeight;}if(!sf.base.isNullOrUndefined(data.leftMargin)){sectionFormat.leftMargin=data.leftMargin;}if(!sf.base.isNullOrUndefined(data.topMargin)){sectionFormat.topMargin=data.topMargin;}if(!sf.base.isNullOrUndefined(data.rightMargin)){sectionFormat.rightMargin=data.rightMargin;}if(!sf.base.isNullOrUndefined(data.bottomMargin)){sectionFormat.bottomMargin=data.bottomMargin;}if(!sf.base.isNullOrUndefined(data.headerDistance)){sectionFormat.headerDistance=data.headerDistance;}if(!sf.base.isNullOrUndefined(data.footerDistance)){sectionFormat.footerDistance=data.footerDistance;}if(!sf.base.isNullOrUndefined(data.differentFirstPage)){sectionFormat.differentFirstPage=data.differentFirstPage;}if(!sf.base.isNullOrUndefined(data.differentOddAndEvenPages)){sectionFormat.differentOddAndEvenPages=data.differentOddAndEvenPages;}if(!sf.base.isNullOrUndefined(data.bidi)){sectionFormat.bidi=data.bidi;}if(!sf.base.isNullOrUndefined(data.restartPageNumbering)){sectionFormat.restartPageNumbering=data.restartPageNumbering;}if(!sf.base.isNullOrUndefined(data.pageStartingNumber)){sectionFormat.pageStartingNumber=data.pageStartingNumber;}if(!sf.base.isNullOrUndefined(data.endnoteNumberFormat)){sectionFormat.endnoteNumberFormat=data.endnoteNumberFormat;}if(!sf.base.isNullOrUndefined(data.footNoteNumberFormat)){sectionFormat.footNoteNumberFormat=data.footNoteNumberFormat;}if(!sf.base.isNullOrUndefined(data.restartIndexForFootnotes)){sectionFormat.restartIndexForFootnotes=data.restartIndexForFootnotes;}if(!sf.base.isNullOrUndefined(data.pageStartingNumber)){sectionFormat.restartIndexForEndnotes=data.restartIndexForEndnotes;}if(!sf.base.isNullOrUndefined(data.initialFootNoteNumber)){sectionFormat.initialFootNoteNumber=data.initialFootNoteNumber;}if(!sf.base.isNullOrUndefined(data.initialEndNoteNumber)){sectionFormat.initialEndNoteNumber=data.initialEndNoteNumber;}};SfdtReader.prototype.parseTabStop=function(wTabs,tabs){if(wTabs){for(var i=0;i<wTabs.length;i++){var tabStop=new WTabStop();tabStop.position=wTabs[i].position;tabStop.tabLeader=wTabs[i].tabLeader;tabStop.deletePosition=wTabs[i].deletePosition;tabStop.tabJustification=wTabs[i].tabJustification;tabs.push(tabStop);}}};SfdtReader.prototype.validateImageUrl=function(imagestr){var keyStr='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';imagestr=imagestr.replace(/[^A-Za-z0-9\+\/\=]/g,'');var totalLength=imagestr.length*3/4;if(imagestr.charAt(imagestr.length-1)===keyStr.charAt(64)){totalLength--;}if(imagestr.charAt(imagestr.length-2)===keyStr.charAt(64)){totalLength--;}if(totalLength%1!==0){// totalLength is not an integer, the length does not match a valid
// base64 content. That can happen if:
// - the imagestr is not a base64 content
// - the imagestr is *almost* a base64 content, with a extra chars at the
// beginning or at the end
// - the imagestr uses a base64 variant (base64url for example)
return false;}return true;};SfdtReader.prototype.containsFieldBegin=function(line){var element=undefined;for(var i=line.children.length-1;i>=0;i--){element=line.children[i];if(element instanceof FieldElementBox&&element.hasFieldEnd&&element.nextElement instanceof TextElementBox){return element.nextElement;}else if(element instanceof FieldElementBox){return undefined;}}return element;};return SfdtReader;}();/**
 * Viewer Export
 */ /* eslint-disable */ /**
 * Selection character format implementation
 */var SelectionCharacterFormat=/** @class */function(){/**
     * @param selection
     * @private
     */function SelectionCharacterFormat(selection){this.boldIn=undefined;this.italicIn=undefined;this.underlineIn=undefined;this.strikeThroughIn=undefined;this.baselineAlignmentIn=undefined;this.highlightColorIn=undefined;this.fontSizeIn=0;this.fontColorIn=undefined;this.allCapsIn=undefined;/**
         * @private
         */this.boldBidi=undefined;/**
         * @private
         */this.italicBidi=undefined;/**
         * @private
         */this.fontSizeBidi=0;/**
         * @private
         */this.bidi=undefined;/**
         * @private
         */this.bdo=undefined;this.selection=selection;}Object.defineProperty(SelectionCharacterFormat.prototype,"fontSize",{/**
         * Gets the font size of selected contents.
         *
         * @aspType int
         * @blazorType int
         */get:function get(){return this.fontSizeIn;},/**
         * Sets the font size of selected contents.
         *
         * @aspType int
         * @blazorType int
         */set:function set(value){if(value===this.fontSizeIn){return;}this.fontSizeIn=value;this.notifyPropertyChanged('fontSize');},enumerable:true,configurable:true});Object.defineProperty(SelectionCharacterFormat.prototype,"fontFamily",{/**
         * Gets or sets the font family of selected contents.
         *
         * @aspType string
         * @blazorType string
         */get:function get(){return this.fontFamilyIn;},/**
         * Sets the font family of selected contents.
         *
         * @aspType string
         * @blazorType string
         */set:function set(value){if(value===this.fontFamilyIn){return;}this.fontFamilyIn=value;this.notifyPropertyChanged('fontFamily');},enumerable:true,configurable:true});Object.defineProperty(SelectionCharacterFormat.prototype,"fontColor",{/**
         * Gets or sets the font color of selected contents.
         *
         * @aspType string
         * @blazorType string
         */get:function get(){return this.fontColorIn;},/**
         * Sets the font color of selected contents.
         *
         * @aspType string
         * @blazorType string
         */set:function set(value){if(value===this.fontColorIn){return;}this.fontColorIn=value;this.notifyPropertyChanged('fontColor');},enumerable:true,configurable:true});Object.defineProperty(SelectionCharacterFormat.prototype,"bold",{/**
         * Gets or sets the bold formatting of selected contents.
         *
         * @aspType bool
         * @blazorType bool
         */get:function get(){return this.boldIn;},/**
         * Sets the bold formatting of selected contents.
         *
         * @aspType bool
         * @blazorType bool
         */set:function set(value){if(value===this.boldIn){return;}this.boldIn=value;this.notifyPropertyChanged('bold');},enumerable:true,configurable:true});Object.defineProperty(SelectionCharacterFormat.prototype,"italic",{/**
         * Gets or sets the italic formatting of selected contents.
         *
         * @aspType bool
         * @blazorType bool
         */get:function get(){return this.italicIn;},/**
         * Sets the italic formatting of selected contents.
         *
         * @aspType bool
         * @blazorType bool
         */set:function set(value){if(value===this.italic){return;}this.italicIn=value;this.notifyPropertyChanged('italic');},enumerable:true,configurable:true});Object.defineProperty(SelectionCharacterFormat.prototype,"strikethrough",{/**
         * Gets or sets the strikethrough property of selected contents.
         */get:function get(){return this.strikeThroughIn;},/**
         * Sets the strikethrough property of selected contents.
         */set:function set(value){if(value===this.strikeThroughIn){return;}this.strikeThroughIn=value;this.notifyPropertyChanged('strikethrough');},enumerable:true,configurable:true});Object.defineProperty(SelectionCharacterFormat.prototype,"baselineAlignment",{/**
         * Gets or sets the baseline alignment property of selected contents.
         */get:function get(){return this.baselineAlignmentIn;},/**
         * Sets the baseline alignment property of selected contents.
         */set:function set(value){if(value===this.baselineAlignmentIn){return;}this.baselineAlignmentIn=value;this.notifyPropertyChanged('baselineAlignment');},enumerable:true,configurable:true});Object.defineProperty(SelectionCharacterFormat.prototype,"underline",{/**
         * Gets or sets the underline style of selected contents.
         */get:function get(){return this.underlineIn;},/**
         * Sets the underline style of selected contents.
         */set:function set(value){if(value===this.underlineIn){return;}this.underlineIn=value;this.notifyPropertyChanged('underline');},enumerable:true,configurable:true});Object.defineProperty(SelectionCharacterFormat.prototype,"highlightColor",{/**
         * Gets or sets the highlight color of selected contents.
         */get:function get(){return this.highlightColorIn;},/**
         * Sets the highlight color of selected contents.
         */set:function set(value){if(value===this.highlightColorIn&&value!=="NoColor"){return;}this.highlightColorIn=value;this.notifyPropertyChanged('highlightColor');},enumerable:true,configurable:true});Object.defineProperty(SelectionCharacterFormat.prototype,"allCaps",{/**
         * Gets or sets the allCaps formatting of selected contents.
         *
         * @aspType bool
         * @blazorType bool
         */get:function get(){return this.allCapsIn;},/**
         * Sets the allCaps formatting of selected contents.
         *
         * @aspType bool
         * @blazorType bool
         */set:function set(value){if(value===this.allCapsIn){return;}this.allCapsIn=value;this.notifyPropertyChanged('allCaps');},enumerable:true,configurable:true});SelectionCharacterFormat.prototype.getPropertyValue=function(property){switch(property){case'bold':return this.bold;case'italic':return this.italic;case'fontSize':if(this.fontSize>=1){return this.fontSize;}return undefined;case'fontFamily':return this.fontFamily;case'strikethrough':return this.strikethrough;case'baselineAlignment':return this.baselineAlignment;case'highlightColor':return this.highlightColor;case'underline':return this.underline;case'fontColor':return this.fontColor;case'allCaps':return this.allCaps;default:return undefined;}};/**
     * Notifies whenever property gets changed.
     *
     * @param {string} propertyName
     */SelectionCharacterFormat.prototype.notifyPropertyChanged=function(propertyName){if(!sf.base.isNullOrUndefined(this.selection)&&(this.selection.isCleared||this.selection.owner.isReadOnlyMode&&!this.selection.isInlineFormFillMode()||!this.selection.owner.isDocumentLoaded||this.selection.owner.isPastingContent)&&!this.selection.isRetrieveFormatting){return;}if(!sf.base.isNullOrUndefined(this.selection)&&!sf.base.isNullOrUndefined(this.selection.start)&&!this.selection.isRetrieveFormatting){var propertyValue=this.getPropertyValue(propertyName);if(!sf.base.isNullOrUndefined(propertyValue)){this.selection.owner.editorModule.onApplyCharacterFormat(propertyName,propertyValue);}}};/**
     * Copies the source format.
     *
     * @param {WCharacterFormat} format
     * @returns {void}
     * @private
     */SelectionCharacterFormat.prototype.copyFormat=function(format){this.styleName=!sf.base.isNullOrUndefined(format.baseCharStyle)?format.baseCharStyle.name:'Default Paragraph Font';this.fontSize=format.fontSize;this.fontFamily=format.fontFamily;this.bold=format.bold;this.italic=format.italic;this.baselineAlignment=format.baselineAlignment;this.underline=format.underline;this.fontColor=format.fontColor;this.highlightColor=format.highlightColor;this.strikethrough=format.strikethrough;this.bidi=format.bidi;this.bdo=format.bdo;this.boldBidi=format.boldBidi;this.italicBidi=format.italicBidi;this.fontFamilyBidi=format.fontFamilyBidi;this.fontSizeBidi=format.fontSizeBidi;this.allCaps=format.allCaps;};/**
     * Combines the format.
     *
     * @param {WCharacterFormat} format
     * @private
     */SelectionCharacterFormat.prototype.combineFormat=function(format){if(!sf.base.isNullOrUndefined(this.bold)&&this.bold!==format.bold){this.bold=undefined;}if(!sf.base.isNullOrUndefined(this.italic)&&this.italic!==format.italic){this.italic=undefined;}if(this.fontSize!==0&&this.fontSize!==format.fontSize){this.fontSize=0;}if(!sf.base.isNullOrUndefined(this.fontFamily)&&this.fontFamily!==format.fontFamily){this.fontFamily=undefined;}if(!sf.base.isNullOrUndefined(this.highlightColor)&&this.highlightColor!==format.highlightColor){this.highlightColor=undefined;}if(!sf.base.isNullOrUndefined(this.baselineAlignment)&&this.baselineAlignment!==format.baselineAlignment){this.baselineAlignment=undefined;}if(!sf.base.isNullOrUndefined(this.fontColor)&&this.fontColor!==format.fontColor){this.fontColor=undefined;}if(!sf.base.isNullOrUndefined(this.underline)&&this.underline!==format.underline){this.underline=undefined;}if(!sf.base.isNullOrUndefined(this.strikethrough)&&this.strikethrough!==format.strikethrough){this.strikethrough=undefined;}if(!sf.base.isNullOrUndefined(this.boldBidi)&&this.boldBidi!==format.boldBidi){this.boldBidi=undefined;}if(!sf.base.isNullOrUndefined(this.italicBidi)&&this.italicBidi!==format.italicBidi){this.italicBidi=undefined;}if(this.fontSizeBidi!==0&&this.fontSizeBidi!==format.fontSizeBidi){this.fontSizeBidi=0;}if(!sf.base.isNullOrUndefined(this.fontFamilyBidi)&&this.fontFamilyBidi!==format.fontFamilyBidi){this.fontFamilyBidi=undefined;}if(!sf.base.isNullOrUndefined(this.bidi)&&this.bidi!==format.bidi){this.bidi=undefined;}if(!sf.base.isNullOrUndefined(this.bdo)&&this.bdo!==format.bdo){this.bdo=undefined;}if(!sf.base.isNullOrUndefined(this.allCaps)&&this.allCaps!==format.allCaps){this.allCaps=undefined;}};/**
     * Clones the format.
     *
     * @param {SelectionCharacterFormat} selectionCharacterFormat
     * @returns {void}
     * @private
     */SelectionCharacterFormat.prototype.cloneFormat=function(selectionCharacterFormat){this.bold=selectionCharacterFormat.bold;this.italic=selectionCharacterFormat.italic;this.underline=selectionCharacterFormat.underline;this.strikethrough=selectionCharacterFormat.strikethrough;this.baselineAlignment=selectionCharacterFormat.baselineAlignment;this.highlightColor=selectionCharacterFormat.highlightColor;this.fontSize=selectionCharacterFormat.fontSize;this.fontFamily=selectionCharacterFormat.fontFamily;this.fontColor=selectionCharacterFormat.fontColor;this.styleName=selectionCharacterFormat.styleName;this.bidi=selectionCharacterFormat.bidi;this.bdo=selectionCharacterFormat.bdo;this.boldBidi=selectionCharacterFormat.boldBidi;this.italicBidi=selectionCharacterFormat.italicBidi;this.fontSizeBidi=selectionCharacterFormat.fontSizeBidi;this.fontFamilyBidi=selectionCharacterFormat.fontFamilyBidi;this.allCaps=selectionCharacterFormat.allCaps;};/**
     * Checks whether current format is equal to the source format or not.
     *
     * @param {SelectionCharacterFormat} format
     * @returns boolean
     * @private
     */SelectionCharacterFormat.prototype.isEqualFormat=function(format){return this.fontSize===format.fontSize&&this.strikethrough===format.strikethrough&&this.bold===format.bold&&this.fontFamily===format.fontFamily&&this.underline===format.underline&&this.highlightColor===format.highlightColor&&this.italic===format.italic&&this.baselineAlignment===format.baselineAlignment&&this.fontColor===format.fontColor&&this.allCaps===format.allCaps;};/**
     * Clears the format.
     *
     * @returns {void}
     * @private
     */SelectionCharacterFormat.prototype.clearFormat=function(){this.fontSizeIn=0;this.boldIn=undefined;this.italicIn=undefined;this.fontFamilyIn=undefined;this.fontColorIn=undefined;this.underlineIn=undefined;this.strikeThroughIn=undefined;this.highlightColorIn=undefined;this.baselineAlignmentIn=undefined;this.styleName=undefined;this.bidi=undefined;this.bdo=undefined;this.boldBidi=undefined;this.italicBidi=undefined;this.fontFamilyBidi=undefined;this.fontSizeBidi=undefined;this.allCapsIn=undefined;};/**
     * Destroys the maintained resources.
     *
     * @returns {void}
     * @private
     */SelectionCharacterFormat.prototype.destroy=function(){this.fontSizeIn=undefined;this.boldIn=undefined;this.italicIn=undefined;this.fontFamilyIn=undefined;this.fontColorIn=undefined;this.underlineIn=undefined;this.strikeThroughIn=undefined;this.baselineAlignmentIn=undefined;this.highlightColorIn=undefined;this.selection=undefined;this.styleName=undefined;this.bidi=undefined;this.bdo=undefined;this.boldBidi=undefined;this.italicBidi=undefined;this.fontFamilyBidi=undefined;this.fontSizeBidi=undefined;this.allCapsIn=undefined;};return SelectionCharacterFormat;}();/**
 * Selection paragraph format implementation
 */var SelectionParagraphFormat=/** @class */function(){/**
     * @param selection
     * @param documentHelper
     * @private
     */function SelectionParagraphFormat(selection,documentHelper){// Declaring the character format properties.
this.leftIndentIn=0;this.rightIndentIn=0;this.beforeSpacingIn=0;this.afterSpacingIn=0;this.textAlignmentIn=undefined;this.firstLineIndentIn=0;this.lineSpacingIn=1;this.lineSpacingTypeIn=undefined;this.bidiIn=undefined;this.keepWithNextIn=undefined;this.keepLinesTogetherIn=undefined;this.widowControlIn=undefined;this.contextualSpacingIn=undefined;this.listLevelNumberIn=-1;this.selection=selection;this.documentHelper=documentHelper;}Object.defineProperty(SelectionParagraphFormat.prototype,"leftIndent",{/**
         * Gets or Sets the left indent for selected paragraphs.
         *
         * @default undefined
         * @aspType int
         * @blazorType int
         */get:function get(){return this.leftIndentIn;},/**
         * Sets the left indent for selected paragraphs.
         *
         * @default undefined
         * @aspType int
         * @blazorType int
         */set:function set(value){if(value===this.leftIndentIn){return;}this.leftIndentIn=value;this.notifyPropertyChanged('leftIndent');},enumerable:true,configurable:true});Object.defineProperty(SelectionParagraphFormat.prototype,"rightIndent",{/**
         * Gets or Sets the right indent for selected paragraphs.
         *
         * @default undefined
         * @aspType int
         * @blazorType int
         */get:function get(){return this.rightIndentIn;},/**
         * Sets the right indent for selected paragraphs.
         *
         * @default undefined
         * @aspType int
         * @blazorType int
         */set:function set(value){if(value===this.rightIndentIn){return;}this.rightIndentIn=value;this.notifyPropertyChanged('rightIndent');},enumerable:true,configurable:true});Object.defineProperty(SelectionParagraphFormat.prototype,"firstLineIndent",{/**
         * Gets or Sets the first line indent for selected paragraphs.
         *
         * @default undefined
         * @aspType int
         * @blazorType int
         */get:function get(){return this.firstLineIndentIn;},/**
         * Sets the first line indent for selected paragraphs.
         *
         * @default undefined
         * @aspType int
         * @blazorType int
         */set:function set(value){if(value===this.firstLineIndentIn){return;}this.firstLineIndentIn=value;this.notifyPropertyChanged('firstLineIndent');},enumerable:true,configurable:true});Object.defineProperty(SelectionParagraphFormat.prototype,"textAlignment",{/**
         * Gets or Sets the text alignment for selected paragraphs.
         *
         * @default undefined
         */get:function get(){return this.textAlignmentIn;},/**
         * Sets the text alignment for selected paragraphs.
         *
         * @default undefined
         */set:function set(value){if(value===this.textAlignmentIn){return;}this.textAlignmentIn=value;this.notifyPropertyChanged('textAlignment');},enumerable:true,configurable:true});Object.defineProperty(SelectionParagraphFormat.prototype,"afterSpacing",{/**
         * Sets the after spacing for selected paragraphs.
         *
         * @default undefined
         * @aspType int
         * @blazorType int
         */get:function get(){return this.afterSpacingIn;},/**
         * Gets or Sets the after spacing for selected paragraphs.
         *
         * @default undefined
         * @aspType int
         * @blazorType int
         */set:function set(value){if(value===this.afterSpacingIn){return;}this.afterSpacingIn=value;this.notifyPropertyChanged('afterSpacing');},enumerable:true,configurable:true});Object.defineProperty(SelectionParagraphFormat.prototype,"beforeSpacing",{/**
         * Gets or Sets the before spacing for selected paragraphs.
         *
         * @default undefined
         * @aspType int
         * @blazorType int
         */get:function get(){return this.beforeSpacingIn;},/**
         * Sets the before spacing for selected paragraphs.
         *
         * @default undefined
         * @aspType int
         * @blazorType int
         */set:function set(value){if(value===this.beforeSpacingIn){return;}this.beforeSpacingIn=value;this.notifyPropertyChanged('beforeSpacing');},enumerable:true,configurable:true});Object.defineProperty(SelectionParagraphFormat.prototype,"lineSpacing",{/**
         * Gets or Sets the line spacing for selected paragraphs.
         *
         * @default undefined
         * @aspType int
         * @blazorType int
         */get:function get(){return this.lineSpacingIn;},/**
         * Sets the line spacing for selected paragraphs.
         *
         * @default undefined
         * @aspType int
         * @blazorType int
         */set:function set(value){if(value===this.lineSpacingIn){return;}this.lineSpacingIn=value;this.notifyPropertyChanged('lineSpacing');},enumerable:true,configurable:true});Object.defineProperty(SelectionParagraphFormat.prototype,"lineSpacingType",{/**
         * Gets or Sets the line spacing type for selected paragraphs.
         *
         * @default undefined
         */get:function get(){return this.lineSpacingTypeIn;},/**
         * Gets or Sets the line spacing type for selected paragraphs.
         *
         * @default undefined
         */set:function set(value){if(value===this.lineSpacingTypeIn){return;}this.lineSpacingTypeIn=value;this.notifyPropertyChanged('lineSpacingType');},enumerable:true,configurable:true});Object.defineProperty(SelectionParagraphFormat.prototype,"listLevelNumber",{/**
         * Sets the list level number for selected paragraphs.
         *
         * @default undefined
         * @aspType int
         * @blazorType int
         */get:function get(){return this.listLevelNumberIn;},/**
         * Gets or Sets the list level number for selected paragraphs.
         *
         * @default undefined
         * @aspType int
         * @blazorType int
         */set:function set(value){if(value===this.listLevelNumberIn){return;}this.listLevelNumberIn=value;this.notifyPropertyChanged('listLevelNumber');},enumerable:true,configurable:true});Object.defineProperty(SelectionParagraphFormat.prototype,"bidi",{/**
         * Gets or Sets the bidirectional property for selected paragraphs
         *
         * @aspType bool
         * @blazorType bool
         */get:function get(){return this.bidiIn;},/**
         * Sets the bidirectional property for selected paragraphs
         *
         * @aspType bool
         * @blazorType bool
         */set:function set(value){this.bidiIn=value;this.notifyPropertyChanged('bidi');},enumerable:true,configurable:true});Object.defineProperty(SelectionParagraphFormat.prototype,"keepWithNext",{/**
         * Gets or sets a value indicating whether the specified paragraph remains on the same page as the paragraph that follows it while paginating the document.
         *
         * @default false
         * @aspType bool
         * @returns {boolean} - `true` if the specified paragraph remains on the same page as the paragraph that follows it; otherwise, `false`.
         */get:function get(){return this.keepWithNextIn;},/**
         * Sets a value indicating whether the specified paragraph remains on the same page as the paragraph that follows it while paginating the document.
         *
         * @aspType bool
         * @blazorType bool
         */set:function set(value){this.keepWithNextIn=value;this.notifyPropertyChanged('keepWithNext');},enumerable:true,configurable:true});Object.defineProperty(SelectionParagraphFormat.prototype,"keepLinesTogether",{/**
         * Gets or sets a value indicating whether all lines in the specified paragraphs remain on the same page while paginating the document.
         *
         * @default false
         * @aspType bool
         * @returns {boolean} - `true` if all lines in the specified paragraphs remain on the same page; otherwise, `false`.
         */get:function get(){return this.keepLinesTogetherIn;},/**
         * Sets a value indicating whether all lines in the specified paragraphs remain on the same page while paginating the document.
         *
         * @aspType bool
         * @blazorType bool
         */set:function set(value){this.keepLinesTogetherIn=value;this.notifyPropertyChanged('keepLinesTogether');},enumerable:true,configurable:true});Object.defineProperty(SelectionParagraphFormat.prototype,"widowControl",{/**
         * Gets or sets a value indicating whether the first and last lines of the paragraph are to remain on the same page as the rest of the paragraph when paginating the document.
         *
         * @default true
         * @aspType bool
         * @returns {boolean} - `true` if the first and last lines of the paragraph are to remain on the same page; otherwise, `false`.
         */get:function get(){return this.widowControlIn;},/**
         * Sets a value indicating whether the first and last lines of the paragraph are to remain on the same page as the rest of the paragraph when paginating the document.
         *
         * @default true
         * @aspType bool
         */set:function set(value){this.widowControlIn=value;this.notifyPropertyChanged('widowControl');},enumerable:true,configurable:true});Object.defineProperty(SelectionParagraphFormat.prototype,"contextualSpacing",{/**
         * Gets or sets a value indicating whether to add space between the paragraphs of same style.
         *
         * @aspType bool
         * @blazorType bool
         */get:function get(){return this.contextualSpacingIn;},/**
         * Sets a value indicating whether to add space between the paragraphs of same style.
         *
         * @aspType bool
         * @blazorType bool
         */set:function set(value){this.contextualSpacingIn=value;this.notifyPropertyChanged('contextualSpacing');},enumerable:true,configurable:true});SelectionParagraphFormat.prototype.validateLineSpacing=function(){if(this.lineSpacingType!=='Multiple'&&this.lineSpacingIn<12){return true;}return false;};Object.defineProperty(SelectionParagraphFormat.prototype,"listText",{/**
         * Gets the list text for selected paragraphs.
         *
         * @aspType string
         * @blazorType string
         */get:function get(){var listFormat=undefined;var list=this.documentHelper.getListById(this.listId);if(list instanceof WList&&this.listLevelNumberIn>-1&&this.listLevelNumberIn<9){var listLevel=list.getListLevel(this.listLevelNumber);if(listLevel instanceof WListLevel){if(listLevel.listLevelPattern==='Bullet'){listFormat=listLevel.numberFormat;}else{listFormat=listLevel.numberFormat;for(var i=0;i<9;i++){var levelPattern='%'+(i+1);if(listFormat.indexOf(levelPattern)>-1){var level=i===this.listLevelNumberIn?listLevel:list.getListLevel(i);var listTextElement=this.selection.getListTextElementBox(this.selection.start.paragraph);var listText=listTextElement?listTextElement.text:'';listFormat=listText;}}}}}return listFormat;},enumerable:true,configurable:true});SelectionParagraphFormat.prototype.getPropertyValue=function(property){switch(property){case'leftIndent':return this.leftIndent;case'rightIndent':return this.rightIndent;case'firstLineIndent':return this.firstLineIndent;case'beforeSpacing':return this.beforeSpacing;case'afterSpacing':return this.afterSpacing;case'textAlignment':return this.textAlignment;case'lineSpacing':return this.lineSpacing;case'lineSpacingType':return this.lineSpacingType;case'bidi':return this.bidi;case'keepWithNext':return this.keepWithNext;case'keepLinesTogether':return this.keepLinesTogether;case'widowControl':return this.widowControl;case'contextualSpacing':return this.contextualSpacing;default:return undefined;}};/**
     * Notifies whenever the property gets changed.
     *
     * @param {string} propertyName
     */SelectionParagraphFormat.prototype.notifyPropertyChanged=function(propertyName){if(!sf.base.isNullOrUndefined(this.selection)&&(this.selection.owner.isReadOnlyMode&&!this.selection.isInlineFormFillMode()||!this.selection.owner.isDocumentLoaded)&&!this.selection.isRetrieveFormatting){return;}if(!sf.base.isNullOrUndefined(this.selection)&&!sf.base.isNullOrUndefined(this.selection.start)&&!this.selection.isRetrieveFormatting){var editorModule=this.selection.owner.editorModule;if(propertyName==='lineSpacing'||propertyName==='lineSpacingType'){var editorHistory=this.selection.owner.editorHistory;if(!(editorHistory&&(editorHistory.isUndoing||editorHistory.isRedoing))&&this.validateLineSpacing()){this.selection.owner.editorHistory.initComplexHistory(this.selection,'LineSpacing');if(propertyName==='lineSpacing'){this.lineSpacingTypeIn='Multiple';var value_1=this.getPropertyValue('lineSpacingType');editorModule.onApplyParagraphFormat('lineSpacingType',value_1,false,false);editorModule.onApplyParagraphFormat(propertyName,this.getPropertyValue(propertyName),false,false);}else{editorModule.onApplyParagraphFormat(propertyName,this.getPropertyValue(propertyName),false,false);this.lineSpacingIn=12;editorModule.onApplyParagraphFormat('lineSpacing',this.getPropertyValue('lineSpacing'),false,false);}this.selection.owner.editorHistory.updateComplexHistory();return;}}var value=this.getPropertyValue(propertyName);if((propertyName==='leftIndent'||propertyName==='rightIndent'||propertyName==='firstLineIndent')&&!(value>=-1056&&value<1056)){return;}if(propertyName==='listLevelNumber'){editorModule.onApplyListInternal(this.documentHelper.getListById(this.listId),this.listLevelNumber);}else{editorModule.onApplyParagraphFormat(propertyName,value,propertyName==='textAlignment'?true:false,false);}}};/**
     * Copies the format.
     *
     * @param {WParagraphFormat} format
     * @returns {void}
     * @private
     */SelectionParagraphFormat.prototype.copyFormat=function(format){this.styleName=!sf.base.isNullOrUndefined(format.baseStyle)?format.baseStyle.name:'Normal';this.leftIndent=format.leftIndent;this.rightIndent=format.rightIndent;this.firstLineIndent=format.firstLineIndent;this.afterSpacing=format.afterSpacing;this.beforeSpacing=format.beforeSpacing;this.lineSpacing=format.lineSpacing;this.lineSpacingType=format.lineSpacingType;this.textAlignment=format.textAlignment;this.bidi=format.bidi;this.keepLinesTogether=format.keepLinesTogether;this.keepWithNext=format.keepWithNext;this.widowControl=format.widowControl;this.contextualSpacing=format.contextualSpacing;if(!sf.base.isNullOrUndefined(format.listFormat)&&!sf.base.isNullOrUndefined(format.listFormat.listId)){this.listId=format.listFormat.listId;this.listLevelNumber=format.listFormat.listLevelNumber;}else{this.listId=undefined;this.listLevelNumber=0;}};/**
     * Copies to format.
     *
     * @param {WParagraphFormat} format
     * @private
     */SelectionParagraphFormat.prototype.copyToFormat=function(format){if(sf.base.isNullOrUndefined(format)){return;}if(!sf.base.isNullOrUndefined(this.afterSpacing)){format.afterSpacing=this.afterSpacing;}if(!sf.base.isNullOrUndefined(this.beforeSpacing)){format.beforeSpacing=this.beforeSpacing;}if(!sf.base.isNullOrUndefined(this.leftIndent)){format.leftIndent=this.leftIndent;}if(!sf.base.isNullOrUndefined(this.rightIndent)){format.rightIndent=this.rightIndent;}if(!sf.base.isNullOrUndefined(this.textAlignment)){format.textAlignment=this.textAlignment;}if(!sf.base.isNullOrUndefined(this.lineSpacing)){format.lineSpacing=this.lineSpacing;}if(!sf.base.isNullOrUndefined(this.lineSpacingType)){format.lineSpacingType=this.lineSpacingType;}if(!sf.base.isNullOrUndefined(this.firstLineIndent)){format.firstLineIndent=this.firstLineIndent;}if(!sf.base.isNullOrUndefined(this.bidi)){format.bidi=this.bidi;}if(!sf.base.isNullOrUndefined(this.keepLinesTogether)){format.keepLinesTogether=this.keepLinesTogether;}if(!sf.base.isNullOrUndefined(this.keepWithNext)){format.keepWithNext=this.keepWithNext;}if(!sf.base.isNullOrUndefined(this.widowControl)){format.widowControl=this.widowControl;}if(!sf.base.isNullOrUndefined(this.contextualSpacing)){format.contextualSpacing=this.contextualSpacing;}};/**
     * Combines the format.
     *
     * @param {WParagraphFormat} format
     * @private
     */SelectionParagraphFormat.prototype.combineFormat=function(format){if(!sf.base.isNullOrUndefined(this.leftIndent)&&this.leftIndent!==format.leftIndent){this.leftIndent=undefined;}if(!sf.base.isNullOrUndefined(this.rightIndent)&&this.rightIndent!==format.rightIndent){this.rightIndent=undefined;}if(!sf.base.isNullOrUndefined(this.firstLineIndent)&&this.firstLineIndent!==format.firstLineIndent){this.firstLineIndent=undefined;}if(this.lineSpacing!==0&&this.lineSpacing!==format.lineSpacing){this.lineSpacing=0;}if(this.beforeSpacing!==-1&&this.beforeSpacing!==format.beforeSpacing){this.beforeSpacing=-1;}if(this.afterSpacing!==-1&&this.afterSpacing!==format.afterSpacing){this.afterSpacing=-1;}if(!sf.base.isNullOrUndefined(this.lineSpacingType)&&this.lineSpacingType!==format.lineSpacingType){this.lineSpacingType=undefined;}if(!sf.base.isNullOrUndefined(this.textAlignment)&&this.textAlignment!==format.textAlignment){this.textAlignment=undefined;}if(this.listLevelNumber>=0&&!sf.base.isNullOrUndefined(this.listId)&&(sf.base.isNullOrUndefined(format.listFormat)||format.listFormat.listLevelNumber!==this.listLevelNumber)){this.listLevelNumber=-1;}if(sf.base.isNullOrUndefined(format.listFormat)||sf.base.isNullOrUndefined(format.listFormat.listId)||!sf.base.isNullOrUndefined(this.listId)&&this.listId!==format.listFormat.listId){this.listId=undefined;}if(!sf.base.isNullOrUndefined(this.bidi)&&this.bidi!==format.bidi){this.bidi=undefined;}if(!sf.base.isNullOrUndefined(this.keepLinesTogether)&&this.keepLinesTogether!==format.keepLinesTogether){this.keepLinesTogether=undefined;}if(!sf.base.isNullOrUndefined(this.keepWithNext)&&this.keepWithNext!==format.keepWithNext){this.keepWithNext=undefined;}if(!sf.base.isNullOrUndefined(this.widowControl)&&this.widowControl!==format.widowControl){this.widowControl=undefined;}if(!sf.base.isNullOrUndefined(this.contextualSpacing)&&this.contextualSpacing!==format.contextualSpacing){this.contextualSpacing=undefined;}if(!sf.base.isNullOrUndefined(this.styleName)&&format.baseStyle&&this.styleName!==format.baseStyle.name){this.styleName=undefined;}};/**
     * Clears the format.
     *
     * @returns {void}
     * @private
     */SelectionParagraphFormat.prototype.clearFormat=function(){this.leftIndent=0;this.rightIndent=0;this.beforeSpacing=0;this.afterSpacing=0;this.firstLineIndent=0;this.lineSpacing=1;this.textAlignment=undefined;this.lineSpacingType=undefined;this.listId=undefined;this.listLevelNumber=-1;this.styleName=undefined;this.bidi=undefined;this.contextualSpacing=undefined;};/**
     * Gets the clone of list at current selection.
     *
     * @returns WList
     * @private
     */SelectionParagraphFormat.prototype.getList=function(){var list=this.documentHelper.getListById(this.listId);if(!sf.base.isNullOrUndefined(list)){var listAdv=new WList();var abstractList=new WAbstractList();var currentAbstractList=this.documentHelper.getAbstractListById(list.abstractListId);var editor=this.selection.owner.editorModule;if(!sf.base.isNullOrUndefined(currentAbstractList)){for(var i=0;i<currentAbstractList.levels.length;i++){var level=editor.cloneListLevel(currentAbstractList.levels[i]);abstractList.levels.push(level);level.ownerBase=abstractList;}}else{abstractList.levels.push(new WListLevel(abstractList));}if(!sf.base.isNullOrUndefined(list.levelOverrides)){for(var i=0;i<list.levelOverrides.length;i++){var levelOverride=editor.cloneLevelOverride(list.levelOverrides[i]);listAdv.levelOverrides.push(levelOverride);}}listAdv.abstractList=abstractList;listAdv.abstractListId=abstractList.abstractListId;listAdv.sourceListId=list.listId;return listAdv;}return undefined;};/**
     * Modifies the list at current selection.
     *
     * @param {WList} listAdv
     * @private
     */SelectionParagraphFormat.prototype.setList=function(listAdv){if(this.documentHelper.owner.isReadOnlyMode&&!this.selection.isInlineFormFillMode()||!this.documentHelper.owner.isDocumentLoaded){return;}var list=this.documentHelper.getListById(this.listId);var collection=undefined;var currentAbstractList=listAdv?this.documentHelper.getAbstractListById(listAdv.abstractListId):undefined;if(!sf.base.isNullOrUndefined(list)&&!sf.base.isNullOrUndefined(listAdv)&&!sf.base.isNullOrUndefined(currentAbstractList)&&listAdv.sourceListId===list.listId){var history_1=this.documentHelper.owner.editorHistory;var listLevel=this.documentHelper.layout.getListLevel(list,1);this.selection.owner.isLayoutEnabled=false;this.documentHelper.owner.editorModule.setOffsetValue(this.selection);if(history_1){collection=history_1.updateListChangesInHistory(currentAbstractList,list);}this.documentHelper.owner.editorModule.updateListParagraphs();if(history_1){history_1.applyListChanges(this.selection,collection);}this.selection.owner.isLayoutEnabled=true;this.documentHelper.renderedLists.clear();this.documentHelper.renderedLevelOverrides=[];// this.viewer.pages = [];
this.documentHelper.owner.editorModule.layoutWholeDocument();this.documentHelper.owner.editorModule.updateSelectionTextPosition(false);if(history_1&&history_1.currentBaseHistoryInfo){if(history_1.currentBaseHistoryInfo.modifiedProperties.length>0){history_1.currentBaseHistoryInfo.updateSelection();}history_1.updateHistory();}this.documentHelper.owner.editorModule.fireContentChange();}else if(!sf.base.isNullOrUndefined(listAdv)){this.selection.owner.isLayoutEnabled=false;if(!sf.base.isNullOrUndefined(currentAbstractList)&&this.documentHelper.abstractLists.indexOf(currentAbstractList)===-1){this.documentHelper.abstractLists.push(currentAbstractList);}if(this.documentHelper.lists.indexOf(listAdv)===-1){this.documentHelper.lists.push(listAdv);}//currentAbstractList.listType = 'Numbering';
this.selection.owner.isLayoutEnabled=true;this.selection.owner.editorModule.onApplyList(listAdv);}else{this.selection.owner.editorModule.onApplyList(undefined);}};/**
     * Destroys the managed resources.
     *
     * @returns {void}
     * @private
     */SelectionParagraphFormat.prototype.destroy=function(){this.leftIndentIn=undefined;this.rightIndentIn=undefined;this.beforeSpacingIn=undefined;this.afterSpacingIn=undefined;this.firstLineIndentIn=undefined;this.lineSpacingIn=undefined;this.textAlignmentIn=undefined;this.lineSpacingTypeIn=undefined;this.listId=undefined;this.listLevelNumberIn=undefined;this.documentHelper=undefined;this.selection=undefined;this.styleName=undefined;this.bidi=undefined;this.contextualSpacing=undefined;};return SelectionParagraphFormat;}();/**
 * Selection section format implementation
 */var SelectionSectionFormat=/** @class */function(){/**
     * @param selection
     * @private
     */function SelectionSectionFormat(selection){this.differentFirstPageIn=undefined;this.differentOddAndEvenPagesIn=undefined;/**
         * private
         */this.bidi=undefined;this.selection=selection;}Object.defineProperty(SelectionSectionFormat.prototype,"pageHeight",{/**
         * Gets or sets the page height.
         *
         * @aspType int
         * @blazorType int
         */get:function get(){return this.pageHeightIn;},/**
         * Gets or sets the page height.
         *
         * @aspType int
         * @blazorType int
         */set:function set(value){this.pageHeightIn=value;this.notifyPropertyChanged('pageHeight');},enumerable:true,configurable:true});Object.defineProperty(SelectionSectionFormat.prototype,"pageWidth",{/**
         * Gets or sets the page width.
         *
         * @aspType int
         * @blazorType int
         */get:function get(){return this.pageWidthIn;},/**
         * Gets or sets the page width.
         *
         * @aspType int
         * @blazorType int
         */set:function set(value){this.pageWidthIn=value;this.notifyPropertyChanged('pageWidth');},enumerable:true,configurable:true});Object.defineProperty(SelectionSectionFormat.prototype,"leftMargin",{/**
         * Gets or sets the page left margin.
         *
         * @aspType int
         * @blazorType int
         */get:function get(){return this.leftMarginIn;},/**
         * Gets or sets the page left margin.
         *
         * @aspType int
         * @blazorType int
         */set:function set(value){this.leftMarginIn=value;this.notifyPropertyChanged('leftMargin');},enumerable:true,configurable:true});Object.defineProperty(SelectionSectionFormat.prototype,"bottomMargin",{/**
         * Gets or sets the page bottom margin.
         *
         * @aspType int
         * @blazorType int
         */get:function get(){return this.bottomMarginIn;},/**
         * Gets or sets the page bottom margin.
         *
         * @aspType int
         * @blazorType int
         */set:function set(value){this.bottomMarginIn=value;this.notifyPropertyChanged('bottomMargin');},enumerable:true,configurable:true});Object.defineProperty(SelectionSectionFormat.prototype,"topMargin",{/**
         * Gets or sets the page top margin.
         *
         * @aspType int
         * @blazorType int
         */get:function get(){return this.topMarginIn;},/**
         * Gets or sets the page top margin.
         *
         * @aspType int
         * @blazorType int
         */set:function set(value){this.topMarginIn=value;this.notifyPropertyChanged('topMargin');},enumerable:true,configurable:true});Object.defineProperty(SelectionSectionFormat.prototype,"rightMargin",{/**
         * Gets or sets the page right margin.
         *
         * @aspType int
         * @blazorType int
         */get:function get(){return this.rightMarginIn;},/**
         * Gets or sets the page right margin.
         *
         * @aspType int
         * @blazorType int
         */set:function set(value){this.rightMarginIn=value;this.notifyPropertyChanged('rightMargin');},enumerable:true,configurable:true});Object.defineProperty(SelectionSectionFormat.prototype,"headerDistance",{/**
         * Gets or sets the header distance.
         *
         * @aspType int
         * @blazorType int
         */get:function get(){return this.headerDistanceIn;},/**
         * Gets or sets the header distance.
         *
         * @aspType int
         * @blazorType int
         */set:function set(value){this.headerDistanceIn=value;this.notifyPropertyChanged('headerDistance');},enumerable:true,configurable:true});Object.defineProperty(SelectionSectionFormat.prototype,"pageStartingNumber",{/**
         * Gets or sets the starting page number.
         *
         * @aspType int
         * @blazorType int
         */get:function get(){return this.pageStartingNumberIn;},/**
         * Gets or sets the starting page number.
         *
         * @aspType int
         * @blazorType int
         */set:function set(value){this.pageStartingNumberIn=value;this.notifyPropertyChanged('pageStartingNumber');},enumerable:true,configurable:true});Object.defineProperty(SelectionSectionFormat.prototype,"restartPageNumbering",{/**
         * Gets or sets a value indicating whether to restart page numbering.
         *
         * @aspType bool
         * @blazorType bool
         */get:function get(){return this.restartPageNumberingIn;},/**
         * Gets or sets a value indicating whether to restart page numbering.
         *
         * @aspType bool
         * @blazorType bool
         */set:function set(value){this.restartPageNumberingIn=value;this.notifyPropertyChanged('restartPageNumbering');},enumerable:true,configurable:true});Object.defineProperty(SelectionSectionFormat.prototype,"footerDistance",{/**
         * Gets or sets the footer distance.
         *
         * @aspType int
         * @blazorType int
         */get:function get(){return this.footerDistanceIn;},/**
         * Gets or sets the footer distance.
         *
         * @aspType int
         * @blazorType int
         */set:function set(value){this.footerDistanceIn=value;this.notifyPropertyChanged('footerDistance');},enumerable:true,configurable:true});Object.defineProperty(SelectionSectionFormat.prototype,"differentFirstPage",{/**
         * Gets or sets a value indicating whether the section has different first page.
         *
         * @aspType bool
         * @blazorType bool
         */get:function get(){return this.differentFirstPageIn;},/**
         * Gets or sets a value indicating whether the section has different first page.
         *
         * @aspType bool
         * @blazorType bool
         */set:function set(value){this.differentFirstPageIn=value;this.notifyPropertyChanged('differentFirstPage');},enumerable:true,configurable:true});Object.defineProperty(SelectionSectionFormat.prototype,"differentOddAndEvenPages",{/**
         * Gets or sets a value indicating whether the section has different odd and even page.
         *
         * @aspType bool
         * @blazorType bool
         */get:function get(){return this.differentOddAndEvenPagesIn;},/**
         * Gets or sets a value indicating whether the section has different odd and even page.
         *
         * @aspType bool
         * @blazorType bool
         */set:function set(value){this.differentOddAndEvenPagesIn=value;this.notifyPropertyChanged('differentOddAndEvenPages');},enumerable:true,configurable:true});Object.defineProperty(SelectionSectionFormat.prototype,"endnoteNumberFormat",{/**
         * Gets or sets the number format of endnote.
         */get:function get(){return this.endnoteNumberFormatIn;},/**
         * Gets or sets the number format of endnote.
         */set:function set(value){this.endnoteNumberFormatIn=value;this.notifyPropertyChanged('endnoteNumberFormat');},enumerable:true,configurable:true});Object.defineProperty(SelectionSectionFormat.prototype,"footNoteNumberFormat",{/**
         * Gets or sets the number format of footnote.
         */get:function get(){return this.footNoteNumberFormatIn;},/**
         * Gets or sets the number format of footnote.
         */set:function set(value){this.footNoteNumberFormatIn=value;this.notifyPropertyChanged('footNoteNumberFormat');},enumerable:true,configurable:true});Object.defineProperty(SelectionSectionFormat.prototype,"initialFootNoteNumber",{/**
         * Gets or sets the number format of footnote.
         */get:function get(){return this.initialFootNoteNumberIn;},/**
         * Gets or sets the number format of footnote.
         */set:function set(value){this.initialFootNoteNumberIn=value;this.notifyPropertyChanged('initialFootNoteNumber');},enumerable:true,configurable:true});Object.defineProperty(SelectionSectionFormat.prototype,"initialEndNoteNumber",{/**
         * Gets or sets the number format of footnote.
         */get:function get(){return this.initialEndNoteNumberIn;},/**
         * Gets or sets the number format of footnote.
         */set:function set(value){this.initialEndNoteNumberIn=value;this.notifyPropertyChanged('initialEndNoteNumber');},enumerable:true,configurable:true});Object.defineProperty(SelectionSectionFormat.prototype,"restartIndexForFootnotes",{/**
         * Gets or sets the restart index of footnote
         */get:function get(){return this.restartIndexForFootnotesIn;},/**
         * Gets or sets the restart index of footnote
         */set:function set(value){this.restartIndexForFootnotesIn=value;this.notifyPropertyChanged('restartIndexForFootnotes');},enumerable:true,configurable:true});Object.defineProperty(SelectionSectionFormat.prototype,"restartIndexForEndnotes",{/**
         * Gets or sets the restart index of endnote
         */get:function get(){return this.restartIndexForEndnotesIn;},/**
         * Gets or sets the restart index of endnote
         */set:function set(value){this.restartIndexForEndnotesIn=value;this.notifyPropertyChanged('restartIndexForEndnotes');},enumerable:true,configurable:true});/**
     * Copies the format.
     *
     * @param {WSectionFormat} format
     * @returns {void}
     * @private
     */SelectionSectionFormat.prototype.copyFormat=function(format){this.pageHeight=format.pageHeight;this.pageWidth=format.pageWidth;this.leftMargin=format.leftMargin;this.topMargin=format.topMargin;this.rightMargin=format.rightMargin;this.bottomMargin=format.bottomMargin;this.headerDistance=format.headerDistance;this.footerDistance=format.footerDistance;this.differentFirstPage=format.differentFirstPage;this.differentOddAndEvenPages=format.differentOddAndEvenPages;this.bidi=format.bidi;this.pageStartingNumber=format.pageStartingNumber;this.restartPageNumbering=format.restartPageNumbering;this.endnoteNumberFormat=format.endnoteNumberFormat;this.footNoteNumberFormat=format.footNoteNumberFormat;this.restartIndexForEndnotes=format.restartIndexForEndnotes;this.restartIndexForFootnotes=format.restartIndexForFootnotes;this.initialEndNoteNumber=format.initialEndNoteNumber;this.initialFootNoteNumber=format.initialFootNoteNumber;};SelectionSectionFormat.prototype.notifyPropertyChanged=function(propertyName){var selection=this.selection;if(!sf.base.isNullOrUndefined(selection)&&(selection.isCleared||selection.owner.isPastingContent||selection.owner.isReadOnlyMode||!selection.owner.isDocumentLoaded)&&!selection.isRetrieveFormatting){return;}if(!sf.base.isNullOrUndefined(selection)&&!sf.base.isNullOrUndefined(selection.start)&&!selection.isRetrieveFormatting){var value=this.getPropertyvalue(propertyName);if(!sf.base.isNullOrUndefined(value)){selection.owner.editorModule.onApplySectionFormat(propertyName,value);}}};SelectionSectionFormat.prototype.getPropertyvalue=function(propertyName){switch(propertyName){case'pageHeight':if(this.pageHeight>0){return this.pageHeight;}return undefined;case'pageWidth':if(this.pageWidth>0){return this.pageWidth;}return undefined;case'leftMargin':if(this.leftMargin>=0){return this.leftMargin;}return undefined;case'rightMargin':if(this.rightMargin>=0){return this.rightMargin;}return undefined;case'topMargin':if(this.topMargin>=0){return this.topMargin;}return undefined;case'bottomMargin':if(this.bottomMargin>=0){return this.bottomMargin;}return undefined;case'differentFirstPage':if(!sf.base.isNullOrUndefined(this.differentFirstPage)){return this.differentFirstPage;}return undefined;case'differentOddAndEvenPages':if(!sf.base.isNullOrUndefined(this.differentOddAndEvenPages)){return this.differentOddAndEvenPages;}return undefined;case'headerDistance':return this.headerDistanceIn;case'footerDistance':return this.footerDistance;case'pageStartingNumber':if(!sf.base.isNullOrUndefined(this.pageStartingNumber)){return this.pageStartingNumber;}return undefined;case'restartPageNumbering':if(!sf.base.isNullOrUndefined(this.restartPageNumbering)){return this.restartPageNumbering;}return undefined;case'endnoteNumberFormat':return this.endnoteNumberFormatIn;case'restartIndexForEndnotes':return this.restartIndexForEndnotesIn;case'restartIndexForFootnotes':return this.restartIndexForFootnotesIn;case'footNoteNumberFormat':return this.footNoteNumberFormatIn;case'initialFootNoteNumber':return this.initialFootNoteNumber;case'initialEndNoteNumber':return this.initialEndNoteNumber;default:return undefined;}};/**
     * Combines the format.
     *
     * @param {WSectionFormat} format
     * @private
     */SelectionSectionFormat.prototype.combineFormat=function(format){if(this.pageHeight>0&&this.pageHeight!==format.pageHeight){this.pageHeight=0;}if(this.pageWidth>0&&this.pageWidth!==format.pageWidth){this.pageWidth=0;}if(this.leftMargin>-1&&this.leftMargin!==format.leftMargin){this.leftMargin=-1;}if(this.topMargin>-1&&this.topMargin!==format.topMargin){this.topMargin=-1;}if(this.rightMargin>-1&&this.rightMargin!==format.rightMargin){this.rightMargin=-1;}if(this.bottomMargin>-1&&this.bottomMargin!==format.bottomMargin){this.bottomMargin=-1;}if(this.headerDistance!==0&&this.headerDistance!==format.headerDistance){this.headerDistance=0;}if(this.footerDistance!==0&&this.footerDistance!==format.footerDistance){this.footerDistance=0;}if(!sf.base.isNullOrUndefined(this.differentFirstPage)&&this.differentFirstPage!==format.differentFirstPage){this.differentFirstPage=undefined;}if(!sf.base.isNullOrUndefined(this.pageStartingNumber)&&this.pageStartingNumber!==format.pageStartingNumber){this.pageStartingNumber=undefined;}if(!sf.base.isNullOrUndefined(this.restartPageNumbering)&&this.restartPageNumbering!==format.restartPageNumbering){this.restartPageNumbering=undefined;}if(!sf.base.isNullOrUndefined(this.differentOddAndEvenPages)&&this.differentOddAndEvenPages!==format.differentOddAndEvenPages){this.differentOddAndEvenPages=undefined;}if(!sf.base.isNullOrUndefined(this.bidi)&&this.bidi!==format.bidi){this.bidi=undefined;}if(!sf.base.isNullOrUndefined(this.endnoteNumberFormat)&&this.endnoteNumberFormat!==format.endnoteNumberFormat){this.endnoteNumberFormat=undefined;}if(!sf.base.isNullOrUndefined(this.restartIndexForEndnotes)&&this.restartIndexForEndnotes!==format.restartIndexForEndnotes){this.restartIndexForEndnotes=undefined;}if(!sf.base.isNullOrUndefined(this.restartIndexForFootnotes)&&this.restartIndexForFootnotes!==format.restartIndexForFootnotes){this.restartIndexForFootnotes=undefined;}if(!sf.base.isNullOrUndefined(this.footNoteNumberFormat)&&this.footNoteNumberFormat!==format.footNoteNumberFormat){this.footNoteNumberFormat=undefined;}if(!sf.base.isNullOrUndefined(this.initialFootNoteNumber)&&this.initialFootNoteNumber!==format.initialFootNoteNumber){this.initialFootNoteNumber=undefined;}if(!sf.base.isNullOrUndefined(this.initialEndNoteNumber)&&this.initialEndNoteNumber!==format.initialEndNoteNumber){this.initialEndNoteNumber=undefined;}};/**
     * Clears the format.
     *
     * @returns {void}
     * @private
     */SelectionSectionFormat.prototype.clearFormat=function(){this.headerDistance=0;this.footerDistance=0;this.pageHeight=0;this.pageWidth=0;this.leftMargin=-1;this.rightMargin=-1;this.topMargin=-1;this.bottomMargin=-1;this.differentFirstPage=undefined;this.differentOddAndEvenPages=undefined;this.bidi=undefined;this.pageStartingNumber=undefined;this.restartPageNumbering=undefined;this.endnoteNumberFormat=undefined;this.footNoteNumberFormat=undefined;this.restartIndexForFootnotes=undefined;this.restartIndexForEndnotes=undefined;this.initialFootNoteNumber=1;this.initialEndNoteNumber=1;};/**
     * Destroys the managed resources.
     *
     * @returns {void}
     * @private
     */SelectionSectionFormat.prototype.destroy=function(){this.headerDistanceIn=undefined;this.footerDistanceIn=undefined;this.pageHeightIn=undefined;this.pageWidthIn=undefined;this.leftMarginIn=undefined;this.rightMarginIn=undefined;this.topMarginIn=undefined;this.bottomMarginIn=undefined;this.differentFirstPageIn=undefined;this.differentOddAndEvenPagesIn=undefined;this.selection=undefined;this.bidi=undefined;this.pageStartingNumberIn=undefined;this.restartPageNumberingIn=undefined;this.endnoteNumberFormatIn=undefined;this.footNoteNumberFormatIn=undefined;this.restartIndexForFootnotesIn=undefined;this.restartIndexForEndnotesIn=undefined;this.initialEndNoteNumber=undefined;this.initialFootNoteNumber=undefined;};return SelectionSectionFormat;}();/**
 * Selection table format implementation
 */var SelectionTableFormat=/** @class */function(){/**
     * @param selection
     * @private
     */function SelectionTableFormat(selection){this.leftIndentIn=0;this.backgroundIn=undefined;this.tableAlignmentIn=undefined;this.cellSpacingIn=0;this.leftMarginIn=0;this.rightMarginIn=0;this.topMarginIn=0;this.bottomMarginIn=0;this.preferredWidthIn=0;this.bidiIn=undefined;this.selection=selection;}Object.defineProperty(SelectionTableFormat.prototype,"table",{/**
         * Gets or sets the table.
         *
         * @private
         */get:function get(){return this.tableIn;},set:function set(value){this.tableIn=value;},enumerable:true,configurable:true});Object.defineProperty(SelectionTableFormat.prototype,"leftIndent",{/**
         * Gets or Sets the left indent for selected table.
         *
         * @aspType int
         * @blazorType int
         */get:function get(){return this.leftIndentIn;},/**
         * Gets or Sets the left indent for selected table.
         *
         * @aspType int
         * @blazorType int
         */set:function set(value){if(value===this.leftIndentIn){return;}this.leftIndentIn=value;this.notifyPropertyChanged('leftIndent');},enumerable:true,configurable:true});Object.defineProperty(SelectionTableFormat.prototype,"topMargin",{/**
         * Gets or Sets the default top margin of cell for selected table.
         *
         * @default undefined
         * @aspType int
         * @blazorType int
         */get:function get(){return this.topMarginIn;},/**
         * Gets or Sets the default top margin of cell for selected table.
         *
         * @default undefined
         * @aspType int
         * @blazorType int
         */set:function set(value){if(value===this.topMarginIn){return;}this.topMarginIn=value;this.notifyPropertyChanged('topMargin');},enumerable:true,configurable:true});Object.defineProperty(SelectionTableFormat.prototype,"background",{/**
         * Gets or Sets the background for selected table.
         *
         * @default undefined
         * @aspType string
         * @blazorType string
         */get:function get(){return this.backgroundIn;},/**
         * Gets or Sets the background for selected table.
         *
         * @default undefined
         * @aspType string
         * @blazorType string
         */set:function set(value){if(value===this.backgroundIn){return;}this.backgroundIn=value;this.notifyPropertyChanged('background');},enumerable:true,configurable:true});Object.defineProperty(SelectionTableFormat.prototype,"tableAlignment",{/**
         * Gets or Sets the table alignment for selected table.
         *
         * @default undefined
         */get:function get(){return this.tableAlignmentIn;},/**
         * Gets or Sets the table alignment for selected table.
         *
         * @default undefined
         */set:function set(value){if(value===this.tableAlignmentIn){return;}this.tableAlignmentIn=value;this.notifyPropertyChanged('tableAlignment');},enumerable:true,configurable:true});Object.defineProperty(SelectionTableFormat.prototype,"leftMargin",{/**
         * Gets or Sets the default left margin of cell for selected table.
         *
         * @default undefined
         * @aspType int
         * @blazorType int
         */get:function get(){return this.leftMarginIn;},/**
         * Gets or Sets the default left margin of cell for selected table.
         *
         * @default undefined
         * @aspType int
         * @blazorType int
         */set:function set(value){if(value===this.leftMarginIn){return;}this.leftMarginIn=value;this.notifyPropertyChanged('leftMargin');},enumerable:true,configurable:true});Object.defineProperty(SelectionTableFormat.prototype,"bottomMargin",{/**
         * Gets or Sets the default bottom margin of cell for selected table.
         *
         * @default undefined
         * @aspType int
         * @blazorType int
         */get:function get(){return this.bottomMarginIn;},/**
         * Gets or Sets the default bottom margin of cell for selected table.
         *
         * @default undefined
         * @aspType int
         * @blazorType int
         */set:function set(value){if(value===this.bottomMarginIn){return;}this.bottomMarginIn=value;this.notifyPropertyChanged('bottomMargin');},enumerable:true,configurable:true});Object.defineProperty(SelectionTableFormat.prototype,"cellSpacing",{/**
         * Gets or Sets the cell spacing for selected table.
         *
         * @default undefined
         * @aspType int
         * @blazorType int
         */get:function get(){return this.cellSpacingIn;},/**
         * Gets or Sets the cell spacing for selected table.
         *
         * @default undefined
         * @aspType int
         * @blazorType int
         */set:function set(value){if(value===this.cellSpacingIn){return;}this.cellSpacingIn=value;this.notifyPropertyChanged('cellSpacing');},enumerable:true,configurable:true});Object.defineProperty(SelectionTableFormat.prototype,"rightMargin",{/**
         * Gets or Sets the default right margin of cell for selected table.
         *
         * @default undefined
         * @aspType int
         * @blazorType int
         */get:function get(){return this.rightMarginIn;},/**
         * Gets or Sets the default right margin of cell for selected table.
         *
         * @default undefined
         * @aspType int
         * @blazorType int
         */set:function set(value){if(value===this.rightMarginIn){return;}this.rightMarginIn=value;this.notifyPropertyChanged('rightMargin');},enumerable:true,configurable:true});Object.defineProperty(SelectionTableFormat.prototype,"preferredWidth",{/**
         * Gets or Sets the preferred width for selected table.
         *
         * @default undefined
         * @aspType int
         * @blazorType int
         */get:function get(){return this.preferredWidthIn;},/**
         * Gets or Sets the preferred width for selected table.
         *
         * @default undefined
         * @aspType int
         * @blazorType int
         */set:function set(value){if(value===this.preferredWidthIn){return;}this.preferredWidthIn=value;this.notifyPropertyChanged('preferredWidth');},enumerable:true,configurable:true});Object.defineProperty(SelectionTableFormat.prototype,"preferredWidthType",{/**
         * Gets or Sets the preferred width type for selected table.
         *
         * @default undefined
         */get:function get(){return this.preferredWidthTypeIn;},/**
         * Gets or Sets the preferred width type for selected table.
         *
         * @default undefined
         */set:function set(value){if(value===this.preferredWidthTypeIn){return;}this.preferredWidthTypeIn=value;this.notifyPropertyChanged('preferredWidthType');},enumerable:true,configurable:true});Object.defineProperty(SelectionTableFormat.prototype,"bidi",{/**
         * Gets or sets the bidi property
         *
         * @aspType bool
         * @blazorType bool
         */get:function get(){return this.bidiIn;},/**
         * Gets or sets the bidi property
         *
         * @aspType bool
         * @blazorType bool
         */set:function set(value){this.bidiIn=value;this.notifyPropertyChanged('bidi');},enumerable:true,configurable:true});SelectionTableFormat.prototype.getPropertyValue=function(propertyName){switch(propertyName){case'tableAlignment':return this.tableAlignment;case'leftIndent':return this.leftIndent;case'cellSpacing':return this.cellSpacing;case'leftMargin':return this.leftMargin;case'rightMargin':return this.rightMargin;case'topMargin':return this.topMargin;case'bottomMargin':return this.bottomMargin;case'background':var shading=new WShading();shading.backgroundColor=this.background;return shading;case'preferredWidth':return this.preferredWidth;case'preferredWidthType':return this.preferredWidthType;case'bidi':return this.bidi;default:return undefined;}};SelectionTableFormat.prototype.notifyPropertyChanged=function(propertyName){if(!sf.base.isNullOrUndefined(this.selection)&&(this.selection.isCleared||!this.selection.owner.isDocumentLoaded||this.selection.owner.isReadOnlyMode||this.selection.owner.isPastingContent)&&!this.selection.isRetrieveFormatting){return;}if(!sf.base.isNullOrUndefined(this.selection)&&!sf.base.isNullOrUndefined(this.selection.start)&&!this.selection.isRetrieveFormatting){var value=this.getPropertyValue(propertyName);if(propertyName==='background'){propertyName='shading';}if(!sf.base.isNullOrUndefined(value)){this.selection.owner.editorModule.onApplyTableFormat(propertyName,value);}}};/**
     * Copies the format.
     *
     * @param {WTableFormat} format Format to copy.
     * @returns {void}
     * @private
     */SelectionTableFormat.prototype.copyFormat=function(format){this.leftIndent=format.leftIndent;this.background=format.shading.backgroundColor;this.tableAlignment=format.tableAlignment;this.leftMargin=format.leftMargin;this.rightMargin=format.rightMargin;this.topMargin=format.topMargin;this.bottomMargin=format.bottomMargin;this.cellSpacing=format.cellSpacing;this.preferredWidth=format.preferredWidth;this.preferredWidthType=format.preferredWidthType;this.bidi=format.bidi;};/**
     * Clears the format.
     *
     * @returns {void}
     * @private
     */SelectionTableFormat.prototype.clearFormat=function(){this.table=undefined;this.leftIndent=0;this.background=undefined;this.leftIndent=0;this.leftMargin=0;this.rightMargin=0;this.topMargin=0;this.bottomMargin=0;this.cellSpacing=0;this.tableAlignment=undefined;this.bidi=undefined;};/**
     * Destroys the managed resources.
     *
     * @returns {void}
     * @private
     */SelectionTableFormat.prototype.destroy=function(){this.leftIndentIn=undefined;this.backgroundIn=undefined;this.leftIndentIn=undefined;this.leftMarginIn=undefined;this.rightMarginIn=undefined;this.topMarginIn=undefined;this.bottomMarginIn=undefined;this.cellSpacingIn=undefined;this.tableAlignmentIn=undefined;this.tableIn=undefined;this.selection=undefined;this.bidi=undefined;};return SelectionTableFormat;}();/**
 * Selection cell format implementation
 */var SelectionCellFormat=/** @class */function(){/**
     * @private
     */function SelectionCellFormat(selection){this.verticalAlignmentIn=undefined;this.leftMarginIn=0;this.rightMarginIn=0;this.topMarginIn=0;this.bottomMarginIn=0;this.backgroundIn=undefined;this.preferredWidthTypeIn=undefined;this.selection=selection;}Object.defineProperty(SelectionCellFormat.prototype,"verticalAlignment",{/**
         * Gets or sets the vertical alignment of the selected cells.
         *
         * @default undefined
         */get:function get(){return this.verticalAlignmentIn;},/**
         * Gets or sets the vertical alignment of the selected cells.
         *
         * @default undefined
         */set:function set(value){if(value===this.verticalAlignmentIn){return;}this.verticalAlignmentIn=value;this.notifyPropertyChanged('verticalAlignment');},enumerable:true,configurable:true});Object.defineProperty(SelectionCellFormat.prototype,"leftMargin",{/**
         * Gets or Sets the left margin for selected cells.
         *
         * @default undefined
         * @aspType int
         * @blazorType int
         */ /* eslint-disable */get:function get(){return this.leftMarginIn;},/**
         * Gets or Sets the left margin for selected cells.
         * @default undefined
         * @aspType int
         * @blazorType int
         */set:function set(value){if(value===this.leftMarginIn){return;}this.leftMarginIn=value;this.notifyPropertyChanged('leftMargin');},enumerable:true,configurable:true});Object.defineProperty(SelectionCellFormat.prototype,"rightMargin",{/**
         * Gets or Sets the right margin for selected cells.
         * @default undefined
         * @aspType int
         * @blazorType int
         */get:function get(){return this.rightMarginIn;},/**
         * Gets or Sets the right margin for selected cells.
         * @default undefined
         * @aspType int
         * @blazorType int
         */set:function set(value){if(value===this.rightMarginIn){return;}this.rightMarginIn=value;this.notifyPropertyChanged('rightMargin');},enumerable:true,configurable:true});Object.defineProperty(SelectionCellFormat.prototype,"topMargin",{/**
         * Gets or Sets the top margin for selected cells.
         * @default undefined
         * @aspType int
         * @blazorType int
         */get:function get(){return this.topMarginIn;},/**
         * Gets or Sets the top margin for selected cells.
         * @default undefined
         * @aspType int
         * @blazorType int
         */set:function set(value){if(value===this.topMarginIn){return;}this.topMarginIn=value;this.notifyPropertyChanged('topMargin');},enumerable:true,configurable:true});Object.defineProperty(SelectionCellFormat.prototype,"bottomMargin",{/**
         * Gets or Sets the bottom margin for selected cells.
         * @default undefined
         * @aspType int
         * @blazorType int
         */get:function get(){return this.bottomMarginIn;},/**
         * Gets or Sets the bottom margin for selected cells.
         * @default undefined
         * @aspType int
         * @blazorType int
         */set:function set(value){if(value===this.bottomMarginIn){return;}this.bottomMarginIn=value;this.notifyPropertyChanged('bottomMargin');},enumerable:true,configurable:true});Object.defineProperty(SelectionCellFormat.prototype,"background",{/**
         * Gets or Sets the background for selected cells.
         * @default undefined
         * @aspType string
         * @blazorType string
         */get:function get(){return this.backgroundIn;},/**
         * Gets or Sets the background for selected cells.
         * @default undefined
         * @aspType string
         * @blazorType string
         */set:function set(value){if(value===this.backgroundIn){return;}this.backgroundIn=value;this.notifyPropertyChanged('background');},enumerable:true,configurable:true});Object.defineProperty(SelectionCellFormat.prototype,"preferredWidthType",{/**
         * Gets or Sets the preferred width type for selected cells.
         * @default undefined
         */get:function get(){return this.preferredWidthTypeIn;},/**
         * Gets or Sets the preferred width type for selected cells.
         * @default undefined
         */set:function set(value){if(value===this.preferredWidthTypeIn){return;}this.preferredWidthTypeIn=value;this.notifyPropertyChanged('preferredWidthType');},enumerable:true,configurable:true});Object.defineProperty(SelectionCellFormat.prototype,"preferredWidth",{/**
         * Gets or Sets the preferred width  for selected cells.
         * @default undefined
         * @aspType int
         * @blazorType int
         */get:function get(){return this.preferredWidthIn;},/**
         * Gets or Sets the preferred width  for selected cells.
         * @default undefined
         * @aspType int
         * @blazorType int
         */set:function set(value){if(value===this.preferredWidthIn){return;}this.preferredWidthIn=value;this.notifyPropertyChanged('preferredWidth');},enumerable:true,configurable:true});SelectionCellFormat.prototype.notifyPropertyChanged=function(propertyName){var selection=this.selection;if(!sf.base.isNullOrUndefined(selection)){if((selection.isCleared||!selection.owner.isDocumentLoaded||selection.owner.isReadOnlyMode||selection.owner.isPastingContent)&&!selection.isRetrieveFormatting){return;}if(!sf.base.isNullOrUndefined(this.selection.start)&&!this.selection.isRetrieveFormatting){var value=this.getPropertyValue(propertyName);if(propertyName==='background'){propertyName='shading';}if(!sf.base.isNullOrUndefined(value)){this.selection.owner.editorModule.onApplyTableCellFormat(propertyName,value);}}}};SelectionCellFormat.prototype.getPropertyValue=function(propertyName){switch(propertyName){case'verticalAlignment':return this.verticalAlignment;case'leftMargin':return this.leftMargin;case'rightMargin':return this.rightMargin;case'topMargin':return this.topMargin;case'bottomMargin':return this.bottomMargin;case'preferredWidth':return this.preferredWidth;case'preferredWidthType':return this.preferredWidthType;case'background':var shading=new WShading();shading.backgroundColor=this.background;return shading;default:return undefined;}};/**
     * Copies the format.
     *
     * @private
     * @param {WCellFormat} format - Source Format to copy.
     * @returns {void}
     */SelectionCellFormat.prototype.copyFormat=function(format){this.leftMargin=format.leftMargin;this.rightMargin=format.rightMargin;this.topMargin=format.topMargin;this.bottomMargin=format.bottomMargin;this.background=format.shading.backgroundColor;this.verticalAlignment=format.verticalAlignment;this.preferredWidth=format.preferredWidth;this.preferredWidthType=format.preferredWidthType;};/**
     * Clears the format.
     *
     * @private
     * @returns {void}
     */SelectionCellFormat.prototype.clearCellFormat=function(){this.leftMargin=undefined;this.rightMargin=undefined;this.topMargin=undefined;this.bottomMargin=undefined;this.background=undefined;this.verticalAlignment=undefined;};/**
     * Combines the format.
     *
     * @param {WCellFormat} format - Returns cell format
     * @private
     */SelectionCellFormat.prototype.combineFormat=function(format){if(!sf.base.isNullOrUndefined(this.leftMargin)&&this.leftMargin!==format.leftMargin){this.leftMargin=undefined;}if(!sf.base.isNullOrUndefined(this.topMargin)&&this.topMargin!==format.topMargin){this.topMargin=undefined;}if(!sf.base.isNullOrUndefined(this.rightMargin)&&this.rightMargin!==format.rightMargin){this.rightMargin=undefined;}if(!sf.base.isNullOrUndefined(this.bottomMargin)&&this.bottomMargin!==format.bottomMargin){this.bottomMargin=undefined;}if(!sf.base.isNullOrUndefined(this.background)&&this.background!==format.shading.backgroundColor){this.background=undefined;}if(!sf.base.isNullOrUndefined(this.verticalAlignment)&&this.verticalAlignment!==format.verticalAlignment){this.verticalAlignment=undefined;}if(!sf.base.isNullOrUndefined(this.preferredWidth)&&this.preferredWidth!==format.preferredWidth){this.preferredWidth=undefined;}if(!sf.base.isNullOrUndefined(this.preferredWidthType)&&this.preferredWidthType!==format.preferredWidthType){this.preferredWidthType=undefined;}};/**
     * Clears the format.
     *
     * @private
     * @returns {void}
     */SelectionCellFormat.prototype.clearFormat=function(){this.background=undefined;this.bottomMargin=0;this.leftMargin=0;this.rightMargin=0;this.topMargin=0;this.verticalAlignment=undefined;};/**
     * Destroys the manages resources.
     *
     * @private
     * @returns {void}
     */SelectionCellFormat.prototype.destroy=function(){this.backgroundIn=undefined;this.verticalAlignmentIn=undefined;this.bottomMarginIn=undefined;this.leftMarginIn=undefined;this.rightMarginIn=undefined;this.topMarginIn=undefined;this.selection=undefined;};return SelectionCellFormat;}();/**
 * Selection row format implementation
 */var SelectionRowFormat=/** @class */function(){/**
     * @param {Selection} selection - Specifies the selection
     * @private
     */function SelectionRowFormat(selection){this.heightIn=undefined;this.heightTypeIn=undefined;this.isHeaderIn=undefined;this.allowRowBreakAcrossPagesIn=undefined;this.selection=selection;}Object.defineProperty(SelectionRowFormat.prototype,"height",{/**
         * Gets or Sets the height for selected rows.
         *
         * @default undefined
         * @aspType int
         * @blazorType int
         * @returns {number} - Returns the height
         */get:function get(){return this.heightIn;},/**
         * Gets or Sets the height for selected rows.
         *
         * @default undefined
         * @aspType int
         * @blazorType int
         * @param {number} value - Specified the value
         */set:function set(value){if(value===this.heightIn){return;}this.heightIn=value;this.notifyPropertyChanged('height');},enumerable:true,configurable:true});Object.defineProperty(SelectionRowFormat.prototype,"heightType",{/**
         * Gets or Sets the height type for selected rows.
         *
         * @default undefined
         * @returns {HeightType} - Returns height type
         */get:function get(){return this.heightTypeIn;},/**
         * Gets or Sets the height type for selected rows.
         *
         * @default undefined
         * @param {HeightType} value - Specified the value
         */set:function set(value){if(value===this.heightTypeIn){return;}this.heightTypeIn=value;this.notifyPropertyChanged('heightType');},enumerable:true,configurable:true});Object.defineProperty(SelectionRowFormat.prototype,"isHeader",{/**
         * Gets or Sets a value indicating whether the selected rows are header rows or not.
         *
         * @default undefined
         * @aspType bool
         * @blazorType bool
         * @returns {boolean} - Returns the is header
         */get:function get(){return this.isHeaderIn;},/**
         * Gets or Sets a value indicating whether the selected rows are header rows or not.
         *
         * @default undefined
         * @aspType bool
         * @blazorType bool
         * @param {boolean} value - Specified the value
         */set:function set(value){if(value===this.isHeaderIn){return;}this.isHeaderIn=value;this.notifyPropertyChanged('isHeader');},enumerable:true,configurable:true});Object.defineProperty(SelectionRowFormat.prototype,"allowBreakAcrossPages",{/**
         * Gets or Sets a value indicating whether to allow break across pages for selected rows.
         *
         * @default undefined
         * @aspType bool
         * @blazorType bool
         * @returns {boolean} - Returns the allow break across page
         */get:function get(){return this.allowRowBreakAcrossPagesIn;},/**
         * Gets or Sets a value indicating whether to allow break across pages for selected rows.
         *
         * @default undefined
         * @param {boolean} value - Specified the value
         * @aspType bool
         * @blazorType bool
         */set:function set(value){if(value===this.allowRowBreakAcrossPagesIn){return;}this.allowRowBreakAcrossPagesIn=value;this.notifyPropertyChanged('allowBreakAcrossPages');},enumerable:true,configurable:true});SelectionRowFormat.prototype.notifyPropertyChanged=function(propertyName){var selection=this.selection;if(!sf.base.isNullOrUndefined(selection)&&(selection.isCleared||selection.owner.isReadOnlyMode||!selection.owner.isDocumentLoaded||selection.owner.isPastingContent)&&!selection.isRetrieveFormatting){return;}if(!sf.base.isNullOrUndefined(selection)&&!sf.base.isNullOrUndefined(selection.start)&&!selection.isRetrieveFormatting){var value=this.getPropertyValue(propertyName);if(!sf.base.isNullOrUndefined(value)){selection.owner.editorModule.onApplyTableRowFormat(propertyName,value);}}};SelectionRowFormat.prototype.getPropertyValue=function(propertyName){switch(propertyName){case'height':return this.height;case'heightType':return this.heightType;case'isHeader':return this.isHeader;case'allowBreakAcrossPages':return this.allowBreakAcrossPages;default:return undefined;}};/**
     * Copies the format.
     *
     * @param {WRowFormat} format - Specified row format
     * @private
     * @returns {void}
     */SelectionRowFormat.prototype.copyFormat=function(format){this.height=format.height;this.heightType=format.heightType;this.allowBreakAcrossPages=format.allowBreakAcrossPages;this.isHeader=format.isHeader;};/**
     * Combines the format.
     *
     * @param {WRowFormat} format - Secifies row format
     * @private
     */SelectionRowFormat.prototype.combineFormat=function(format){if(!sf.base.isNullOrUndefined(this.height)&&this.height!==format.height){this.height=undefined;}if(!sf.base.isNullOrUndefined(this.heightType)&&this.heightType!==format.heightType){this.heightType=undefined;}if(!sf.base.isNullOrUndefined(this.allowBreakAcrossPages)&&this.allowBreakAcrossPages!==format.allowBreakAcrossPages){this.allowBreakAcrossPages=undefined;}if(!sf.base.isNullOrUndefined(this.isHeader)&&this.isHeader!==format.isHeader){this.isHeader=undefined;}};/**
     * Clears the row format.
     *
     * @private
     * @returns {void}
     */SelectionRowFormat.prototype.clearRowFormat=function(){this.height=undefined;this.heightType=undefined;this.allowBreakAcrossPages=undefined;this.isHeader=undefined;};/**
     * Clears the format.
     *
     * @private
     * @returns {void}
     */SelectionRowFormat.prototype.clearFormat=function(){this.height=0;this.heightType=undefined;this.allowBreakAcrossPages=undefined;this.isHeader=undefined;};/**
     * Destroys the managed resources.
     *
     * @private
     * @returns {void}
     */SelectionRowFormat.prototype.destroy=function(){this.heightIn=undefined;this.heightTypeIn=undefined;this.allowRowBreakAcrossPagesIn=undefined;this.isHeaderIn=undefined;this.selection=undefined;};return SelectionRowFormat;}();/**
 * Selection image format implementation
 */var SelectionImageFormat=/** @class */function(){/**
     * @param {Selection} selection - Specifies selecion module
     * @private
     */function SelectionImageFormat(selection){this.selection=selection;}Object.defineProperty(SelectionImageFormat.prototype,"width",{/**
         * Gets the width of the image.
         *
         * @aspType int
         * @blazorType int
         * @returns {number} - Returns image width
         */get:function get(){if(this.image){return this.image.width;}return 0;},enumerable:true,configurable:true});Object.defineProperty(SelectionImageFormat.prototype,"height",{/**
         * Gets the height of the image.
         *
         * @aspType int
         * @blazorType int
         * @returns {number} - Returns image height
         */get:function get(){if(this.image){return this.image.height;}return 0;},enumerable:true,configurable:true});/**
     * Resizes the image based on given size.
     *
     * @param {number} width - Specified the image width
     * @param {number} height - Specifies the image height
     * @private
     * @returns {void}
     */SelectionImageFormat.prototype.resize=function(width,height){this.updateImageFormat(width,height);};/**
     * Update image width and height
     *
     * @param {number} width - Specified the image width
     * @param {number} height - Specifies the image height
     * @private
     * @returns {void}
     */SelectionImageFormat.prototype.updateImageFormat=function(width,height){if(this.image){if(this.selection.owner.editorModule){this.selection.owner.editorModule.onImageFormat(this.image,width,height);}}};/**
     * @param {ImageElementBox} image - Specifies image element box
     * @private
     * @returns {void}
     */SelectionImageFormat.prototype.copyImageFormat=function(image){this.image=image;};/**
     * @private
     * @returns {void}
     */SelectionImageFormat.prototype.clearImageFormat=function(){this.image=undefined;};return SelectionImageFormat;}();/* eslint-enable */ /* eslint-disable */ /**
 * @private
 */var HtmlExport=/** @class */function(){function HtmlExport(){this.document=undefined;this.prevListLevel=undefined;this.isOrdered=undefined;/**
         * @private
         */this.fieldCheck=0;/* eslint:enable:no-any */}HtmlExport.prototype.writeHtml=function(document){this.document=document;var html='';for(var i=0;i<document.sections.length;i++){html+=this.serializeSection(document.sections[i]);}return html;};HtmlExport.prototype.serializeSection=function(section){var string='';for(var i=0;i<section.blocks.length;i++){var block=section.blocks[i];if(block.hasOwnProperty('inlines')){string+=this.serializeParagraph(block);}else if(block.hasOwnProperty('blocks')){string+=this.serializeSection(block);}else{string+=this.closeList();string+=this.serializeTable(block);}}string+=this.closeList();this.prevListLevel=undefined;this.isOrdered=undefined;return string;};// Serialize Paragraph
HtmlExport.prototype.serializeParagraph=function(paragraph){var blockStyle='';var isList=false;var isPreviousList=false;if(!sf.base.isNullOrUndefined(this.prevListLevel)){isPreviousList=true;}var tagAttributes=[];var listLevel=undefined;if(!sf.base.isNullOrUndefined(paragraph.paragraphFormat.listFormat)){listLevel=this.getListLevel(paragraph);if(!isPreviousList){this.prevListLevel=listLevel;}if(this.prevListLevel!==listLevel){isPreviousList=false;}this.prevListLevel=listLevel;}if(!isPreviousList){blockStyle+=this.closeList();}if(!sf.base.isNullOrUndefined(listLevel)){isList=true;}if(isList&&!isPreviousList){blockStyle+=this.getHtmlList(listLevel,paragraph.paragraphFormat.listFormat.listLevelNumber);}tagAttributes.push('style="'+this.serializeParagraphStyle(paragraph,'',isList)+';'+'white-space:pre'+'"');if(isList){blockStyle+=this.createAttributesTag('li',tagAttributes);}else{this.prevListLevel=undefined;this.isOrdered=undefined;blockStyle+=this.createAttributesTag(this.getStyleName(paragraph.paragraphFormat.styleName),tagAttributes);}if(paragraph.inlines.length===0){//Handled to preserve non breaking space for empty paragraphs similar to MS Word behavior.
blockStyle+='&nbsp';}else{blockStyle=this.serializeInlines(paragraph,blockStyle);}if(isList){blockStyle+=this.endTag('li');if(blockStyle.indexOf('<ul')>-1){this.isOrdered=false;}else if(blockStyle.indexOf('<ol')>-1){this.isOrdered=true;}}else{blockStyle+=this.endTag(this.getStyleName(paragraph.paragraphFormat.styleName));}return blockStyle;};HtmlExport.prototype.closeList=function(){var blockStyle='';if(!sf.base.isNullOrUndefined(this.isOrdered)){if(this.isOrdered){blockStyle=this.endTag('ol');}else{blockStyle=this.endTag('ul');}this.isOrdered=undefined;}return blockStyle;};HtmlExport.prototype.getListLevel=function(paragraph){var listLevel=undefined;var list=undefined;for(var i=0;i<this.document.lists.length;i++){if(this.document.lists[i].listId===paragraph.paragraphFormat.listFormat.listId){list=this.document.lists[i];break;}}if(list){for(var j=0;j<this.document.abstractLists.length;j++){if(this.document.abstractLists[j].abstractListId===list.abstractListId){listLevel=this.document.abstractLists[j].levels[paragraph.paragraphFormat.listFormat.listLevelNumber];break;}}}return listLevel;};HtmlExport.prototype.getHtmlList=function(listLevel,levelNumer){//if (start == null || (start != null && start.Paragraph != this)) {
//    let block: BlockAdv = this.GetPreviousBlock();
//    if (block instanceof ParagraphAdv) {
//        let previousListLevel: ListLevelAdv = (block as ParagraphAdv).ParagraphFormat.ListFormat.ListLevel;
//        if (previousListLevel == listLevel)
//            return "";
//    }
//}
var html='';if(listLevel.listLevelPattern==='Bullet'){html+='<ul type="';switch(levelNumer){case 0:html+='disc';listLevel.characterFormat.fontFamily='Symbol';break;case 1:html+='circle';listLevel.characterFormat.fontFamily='Symbol';break;case 2:html+='square';listLevel.characterFormat.fontFamily='Wingdings';break;default:html+='disc';listLevel.characterFormat.fontFamily='Symbol';break;}html+='">';}else{html+='<ol type="';switch(listLevel.listLevelPattern){case'LowLetter':html+='a';break;case'UpLetter':html+='A';break;case'LowRoman':html+='i';break;case'UpRoman':html+='I';break;default:html+='1';break;}html+='" start="'+listLevel.startAt.toString()+'">';}return html;};//SerializeInlines
HtmlExport.prototype.serializeInlines=function(paragraph,blockStyle){var inline=undefined;var i=0;while(paragraph.inlines.length>i){inline=paragraph.inlines[i];if(inline.hasOwnProperty('inlines')){blockStyle+=this.serializeContentInlines(inline,blockStyle);i++;continue;}if(inline.hasOwnProperty('imageString')){blockStyle+=this.serializeImageContainer(inline);}else if(inline.hasOwnProperty('fieldType')){if(inline.fieldType===0){var fieldCode=paragraph.inlines[i+1];if(sf.base.isNullOrUndefined(fieldCode.text)){fieldCode=paragraph.inlines[i+2];}if(!sf.base.isNullOrUndefined(fieldCode)&&!sf.base.isNullOrUndefined(fieldCode.text)&&(fieldCode.text.indexOf('TOC')>=0||fieldCode.text.indexOf('HYPERLINK')>=0)){this.fieldCheck=1;var tagAttributes=[];tagAttributes.push('style="'+this.serializeInlineStyle(inline.characterFormat)+'"');blockStyle+=this.createAttributesTag('a',tagAttributes);}else{this.fieldCheck=undefined;}}else if(inline.fieldType===2){if(!sf.base.isNullOrUndefined(this.fieldCheck)){this.fieldCheck=2;}else{this.fieldCheck=0;}}else{if(!sf.base.isNullOrUndefined(this.fieldCheck)&&this.fieldCheck!==0){blockStyle+=this.endTag('a');}this.fieldCheck=0;}}else{var text=sf.base.isNullOrUndefined(inline.text)?'':inline.text;if(this.fieldCheck===0){blockStyle+=this.serializeSpan(text,inline.characterFormat);}if(this.fieldCheck===1){var hyperLink=text.replace(/"/g,'');blockStyle+=' href= \"'+hyperLink.replace('HYPERLINK','').trim();blockStyle+='\"';blockStyle+='>';}if(this.fieldCheck===2){blockStyle+=text;}}i++;}return blockStyle;};HtmlExport.prototype.serializeContentInlines=function(inline,inlineStyle){inlineStyle+=this.serializeInlines(inline,inlineStyle);return inlineStyle;};// Serialize Span
HtmlExport.prototype.serializeSpan=function(spanText,characterFormat){var spanClass='';if(spanText.indexOf('\v')!==-1){spanClass+='<br>';return spanClass.toString();}else if(spanText.indexOf('\f')!==-1){spanClass+='<br style = "page-break-after:always;"/>';return spanClass.toString();}var tagAttributes=[];this.serializeInlineStyle(characterFormat);tagAttributes.push('style="'+this.serializeInlineStyle(characterFormat)+'"');spanClass+=this.createAttributesTag('span',tagAttributes);// Todo: Need to handle it.
// If the text starts with white-space, need to check whether it is a continuous space.
// if (characterFormat.ownerBase instanceof WInline) {
//     let inline: WInline = (characterFormat.ownerBase as WInline);
//     if (inline instanceof WSpan && !isNullOrUndefined(inline.text) && inline.text !== '' && (inline as WSpan).text[0] === ' ') {
//         Check previous inline until, it has valid rendered text.
//         do {
//             inline = WInline.getPreviousTextInline((inline as WSpan));
//         } while (inline instanceof WSpan && !isNullOrUndefined(inline.text));
//     } else {
//         inline = undefined;
//     }
//     If current white-space is a continuation of consecutive spaces, this will be set true.
//     ignoreFirstSpace = inline instanceof WSpan && !isNullOrUndefined(inline.text)
//         && (inline as WSpan).text[(inline as WSpan).text.length - 1] === ' ';
// }
var text=this.decodeHtmlNames(spanText.toString());if(text.length===0){text='&nbsp';}spanClass+=text;spanClass+=this.endTag('span');return spanClass.toString();};/**
     * @private
     * @param {string} style - style name.
     * @returns {string} - return heading tag.
     */HtmlExport.prototype.getStyleName=function(style){switch(style){case'Heading 1':return'h1';case'Heading 2':return'h2';case'Heading 3':return'h3';case'Heading 4':return'h4';case'Heading 5':return'h5';default:return'div';}};//Serialize Image
HtmlExport.prototype.serializeImageContainer=function(image){var imageStyle='';var tagAttributes=[];this.serializeInlineStyle(image.characterFormat);var imageSource='';if(!sf.base.isNullOrUndefined(image.imageString)){imageSource=image.imageString;}var width=HelperMethods.convertPointToPixel(image.width);var height=HelperMethods.convertPointToPixel(image.height);tagAttributes.push('width="'+width.toString()+'"');tagAttributes.push('height="'+height.toString()+'"');tagAttributes.push('src="'+imageSource+'"');imageStyle+=this.createAttributesTag('img',tagAttributes);imageStyle+=this.endTag('img');return imageStyle.toString();};// Serialize Table Cell
HtmlExport.prototype.serializeCell=function(cell){var blockStyle='';var tagAttributes=[];var cellHtml='';tagAttributes=[];if(!sf.base.isNullOrUndefined(cell.cellFormat)){//if (cell.cellFormat.shading.backgroundColor !== Color.FromArgb(0, 0, 0, 0)) {
if(!sf.base.isNullOrUndefined(cell.cellFormat.shading.backgroundColor)){tagAttributes.push('bgcolor="'+HelperMethods.getColor(cell.cellFormat.shading.backgroundColor)+'"');}// }
if(!sf.base.isNullOrUndefined(cell.cellFormat.columnSpan)&&cell.cellFormat.columnSpan>1){tagAttributes.push('colspan="'+cell.cellFormat.columnSpan.toString()+'"');}if(!sf.base.isNullOrUndefined(cell.cellFormat.rowSpan)&&cell.cellFormat.rowSpan>1){tagAttributes.push('rowspan="'+cell.cellFormat.rowSpan.toString()+'"');}if(!sf.base.isNullOrUndefined(cell.cellFormat.cellWidth)&&cell.cellFormat.cellWidth!==0){var cellWidth=HelperMethods.convertPointToPixel(cell.cellFormat.cellWidth);tagAttributes.push('width="'+cellWidth.toString()+'"');}var cellAlignment=sf.base.isNullOrUndefined(cell.cellFormat.verticalAlignment)?'top':cell.cellFormat.verticalAlignment.toString().toLowerCase();tagAttributes.push('valign="'+cellAlignment+'"');if(!sf.base.isNullOrUndefined(cell.cellFormat.leftMargin)&&cell.cellFormat.leftMargin!==0){cellHtml+='padding-left:'+cell.cellFormat.leftMargin.toString()+'pt;';}if(!sf.base.isNullOrUndefined(cell.cellFormat.rightMargin)&&cell.cellFormat.rightMargin!==0){cellHtml+='padding-right:'+cell.cellFormat.rightMargin.toString()+'pt;';}if(!sf.base.isNullOrUndefined(cell.cellFormat.topMargin)&&cell.cellFormat.topMargin!==0){cellHtml+='padding-top:'+cell.cellFormat.topMargin.toString()+'pt;';}if(!sf.base.isNullOrUndefined(cell.cellFormat.bottomMargin)&&cell.cellFormat.bottomMargin!==0){cellHtml+='padding-bottom:'+cell.cellFormat.bottomMargin.toString()+'pt;';}if(!sf.base.isNullOrUndefined(cell.cellFormat.borders)){cellHtml+=this.serializeCellBordersStyle();}}if(cellHtml.length!==0){tagAttributes.push('style="'+cellHtml+'"');}blockStyle+=this.createAttributesTag('td',tagAttributes);for(var k=0;k<cell.blocks.length;k++){var block=cell.blocks[k];if(block.hasOwnProperty('rows')){blockStyle+=this.serializeTable(block);}else{blockStyle+=this.serializeParagraph(block);}}blockStyle+=this.endTag('td');return blockStyle;};// Serialize Table
HtmlExport.prototype.serializeTable=function(table){var html='';html+=this.createTableStartTag(table);for(var j=0;j<table.rows.length;j++){html+=this.serializeRow(table.rows[j]);}html+=this.createTableEndTag();return html;};// Serialize Row
HtmlExport.prototype.serializeRow=function(row){var html='';html+=this.createRowStartTag(row);for(var k=0;k<row.cells.length;k++){html+=this.serializeCell(row.cells[k]);}return html;};// Serialize Styles
HtmlExport.prototype.serializeParagraphStyle=function(paragraph,className,isList){var paragraphClass='';paragraphClass+=this.serializeCharacterFormat(paragraph.characterFormat);paragraphClass+=this.serializeParagraphFormat(paragraph.paragraphFormat,isList);return paragraphClass;};HtmlExport.prototype.serializeInlineStyle=function(characterFormat){return this.serializeCharacterFormat(characterFormat);};HtmlExport.prototype.serializeTableBorderStyle=function(borders){var borderStyle='';if(!sf.base.isNullOrUndefined(borders.left.lineStyle)){borderStyle+='border-left-style:'+this.convertBorderLineStyle(borders.left.lineStyle);borderStyle+=';';}if(borders.left.lineWidth){borderStyle+='border-left-width:'+borders.left.lineWidth.toString()+'pt';borderStyle+=';';}if(!sf.base.isNullOrUndefined(borders.left.color)){borderStyle+='border-left-color:'+HelperMethods.getColor(borders.left.color);borderStyle+=';';}if(!sf.base.isNullOrUndefined(borders.right.lineStyle)){borderStyle+='border-right-style:'+this.convertBorderLineStyle(borders.right.lineStyle);borderStyle+=';';}if(!sf.base.isNullOrUndefined(borders.right.lineWidth)){borderStyle+='border-right-width:'+borders.right.lineWidth.toString()+'pt';borderStyle+=';';}if(!sf.base.isNullOrUndefined(borders.right.color)){borderStyle+='border-right-color:'+HelperMethods.getColor(borders.right.color);borderStyle+=';';}if(!sf.base.isNullOrUndefined(borders.top.lineStyle)){borderStyle+='border-top-style:'+this.convertBorderLineStyle(borders.top.lineStyle);borderStyle+=';';}if(!sf.base.isNullOrUndefined(borders.top.lineWidth)){borderStyle+='border-top-width:'+borders.top.lineWidth.toString()+'pt';borderStyle+=';';}if(!sf.base.isNullOrUndefined(borders.top.color)){borderStyle+='border-top-color:'+HelperMethods.getColor(borders.bottom.color);borderStyle+=';';}if(!sf.base.isNullOrUndefined(borders.bottom.lineStyle)){borderStyle+='border-bottom-style:'+this.convertBorderLineStyle(borders.bottom.lineStyle);borderStyle+=';';}if(!sf.base.isNullOrUndefined(borders.bottom.lineWidth)){borderStyle+='border-bottom-width:'+borders.bottom.lineWidth.toString()+'pt';borderStyle+=';';}if(!sf.base.isNullOrUndefined(borders.bottom.color)){borderStyle+='border-bottom-color:'+HelperMethods.getColor(borders.bottom.color);borderStyle+=';';}return borderStyle;};HtmlExport.prototype.serializeCellBordersStyle=function(){var borderStyle='';borderStyle='border:solid 1px;';// if (borders.left.color) {
//     borderStyle += ('border-left-color:' + HelperMethods.getColor(borders.left.color));
//     borderStyle += ';';
// }
// borderStyle += this.serializeBorderStyle(borders.left, 'left');
// if (!isNullOrUndefined(borders.right.color)) {
//     borderStyle += ('border-right-color:' + HelperMethods.getColor(borders.right.color));
//     borderStyle += ';';
// }
// borderStyle += this.serializeBorderStyle(borders.right, 'right');
// if (!isNullOrUndefined(borders.top.color)) {
//     borderStyle += ('border-top-color:' + HelperMethods.getColor(borders.top.color));
//     borderStyle += ';';
// }
// borderStyle += this.serializeBorderStyle(borders.top, 'top');
// if (!isNullOrUndefined(borders.bottom.color)) {
//     borderStyle += ('border-bottom-color:' + HelperMethods.getColor(borders.bottom.color));
//     borderStyle += ';';
// }
// borderStyle += this.serializeBorderStyle(borders.bottom, 'bottom');
// Todo: handle
// let border: WBorder = undefined;
// //LeftBorder
// border = WCell.getCellLeftBorder(WCell.getCellOf(borders));
// if (!isNullOrUndefined(border) && border.lineStyle !== 'None') {
//     borderStyle += this.serializeBorderStyle(border, 'left');
// } else if (!isNullOrUndefined(border) && border.hasNoneStyle) {
//     borderStyle += ('border-left-style:none;');
// }
// //RightBorder
// border = WCell.getCellRightBorder(WCell.getCellOf(borders));
// if (!isNullOrUndefined(border) && border.lineStyle !== 'None') {
//     borderStyle += this.serializeBorderStyle(border, 'right');
// } else if (!isNullOrUndefined(border) && border.hasNoneStyle) {
//     borderStyle += ('border-right-style:none');
// }
// //TopBorder
// border = WCell.getCellTopBorder(WCell.getCellOf(borders));
// if (!isNullOrUndefined(border) && border.lineStyle !== 'None') {
//     borderStyle += this.serializeBorderStyle(border, 'top');
// } else if (!isNullOrUndefined(border) && border.hasNoneStyle) {
//     borderStyle += ('border-top-style:none');
// }
// //BottomBorder
// border = WCell.getCellBottomBorder(WCell.getCellOf(borders));
// if (!isNullOrUndefined(border) && border.lineStyle !== 'None') {
//     borderStyle += this.serializeBorderStyle(border, 'bottom');
// } else if (!isNullOrUndefined(border) && border.hasNoneStyle) {
//     borderStyle += ('border-bottom-style:none');
// }
return borderStyle;};HtmlExport.prototype.serializeBorderStyle=function(border,borderPosition){var borderStyle='';borderStyle+='border-'+borderPosition+'-style:'+this.convertBorderLineStyle(border.lineStyle);borderStyle+=';';if(border.lineWidth>0){borderStyle+='border-'+borderPosition+'-width:'+border.lineWidth.toString()+'pt;';}//if (border.color !== Color.FromArgb(0, 0, 0, 0))
if(!sf.base.isNullOrUndefined(border.color)){borderStyle+='border-'+borderPosition+'-color:'+HelperMethods.getColor(border.color)+';';}return borderStyle;};HtmlExport.prototype.convertBorderLineStyle=function(lineStyle){switch(lineStyle){case'None':return'none';case'Single':return'solid';case'Dot':return'dotted';case'DashSmallGap':case'DashLargeGap':case'DashDot':case'DashDotDot':return'dashed';case'Double':case'Triple':case'ThinThickSmallGap':case'ThickThinSmallGap':case'ThinThickThinSmallGap':case'ThinThickMediumGap':case'ThickThinMediumGap':case'ThinThickThinMediumGap':case'ThinThickLargeGap':case'ThickThinLargeGap':case'ThinThickThinLargeGap':return'double';case'SingleWavy':return'solid';case'DoubleWavy':return'double';case'DashDotStroked':return'solid';case'Emboss3D':return'ridge';case'Engrave3D':return'groove';case'Outset':return'outset';case'Inset':return'inset';default:return'solid';}};// Serialize Format
HtmlExport.prototype.serializeCharacterFormat=function(characterFormat){if(!sf.base.isNullOrUndefined(characterFormat.inlineFormat)){return this.serializeCharacterFormat(characterFormat.inlineFormat);}var propertyValue;var charStyle='';charStyle+='font-weight';charStyle+=':';charStyle+=characterFormat.bold?'bold':'normal';charStyle+=';';charStyle+='font-style';charStyle+=':';if(characterFormat.italic){charStyle+='italic';}else{charStyle+='normal';}charStyle+=';';charStyle+=this.serializeTextDecoration(characterFormat);//Text Baseline Alignment
if(characterFormat.baselineAlignment==='Superscript'||characterFormat.baselineAlignment==='Subscript'){charStyle+='vertical-align';charStyle+=':';charStyle+=characterFormat.baselineAlignment==='Superscript'?'super':'sub';charStyle+=';';}//Text Foreground and Background Color
if(!sf.base.isNullOrUndefined(characterFormat.highlightColor)&&characterFormat.highlightColor!=='NoColor'){charStyle+='background-color';charStyle+=':';charStyle+=HelperMethods.getColor(characterFormat.highlightColor.toString());charStyle+=';';}//Font Color
propertyValue=characterFormat.fontColor;if(!sf.base.isNullOrUndefined(propertyValue)){charStyle+='color';charStyle+=':';charStyle+=HelperMethods.getColor(propertyValue);charStyle+=';';}if(!sf.base.isNullOrUndefined(characterFormat.allCaps)&&characterFormat.allCaps){charStyle+='text-transform';charStyle+=':';charStyle+='uppercase';charStyle+=';';}propertyValue=characterFormat.fontSize;if(!sf.base.isNullOrUndefined(propertyValue)){charStyle+='font-size';charStyle+=':';charStyle+=propertyValue.toString();charStyle+='pt';charStyle+=';';}propertyValue=characterFormat.fontFamily;if(!sf.base.isNullOrUndefined(propertyValue)){charStyle+='font-family';charStyle+=':';charStyle+=propertyValue.toString();charStyle+=';';}return charStyle.toString();};HtmlExport.prototype.serializeTextDecoration=function(characterFormat){var charStyle='text-decoration:';var value='';// Double strike through will become Single strike through while saving HTML using MS Word.
if(characterFormat.strikethrough==='SingleStrike'||characterFormat.strikethrough==='DoubleStrike'){value+='line-through ';}if(!sf.base.isNullOrUndefined(characterFormat.underline)&&characterFormat.underline!=='None'){value+='underline';}if(value.length>1){value=charStyle+value+';';}return value;};/**
     * @private
     */HtmlExport.prototype.serializeParagraphFormat=function(paragraphFormat,isList){if(!sf.base.isNullOrUndefined(paragraphFormat.inlineFormat)){return this.serializeParagraphFormat(paragraphFormat.inlineFormat,isList);}var propertyValue;var paraStyle='';propertyValue=paragraphFormat.textAlignment;if(!sf.base.isNullOrUndefined(propertyValue)){paraStyle+='text-align:'+propertyValue.toLowerCase()+';';}propertyValue=paragraphFormat.beforeSpacing;if(!sf.base.isNullOrUndefined(propertyValue)){paraStyle+='margin-top:'+propertyValue.toString()+'pt; ';}propertyValue=paragraphFormat.rightIndent;if(!sf.base.isNullOrUndefined(propertyValue)){paraStyle+='margin-right:'+propertyValue.toString()+'pt; ';}propertyValue=paragraphFormat.afterSpacing;if(!sf.base.isNullOrUndefined(propertyValue)){paraStyle+='margin-bottom:'+propertyValue.toString()+'pt; ';}propertyValue=paragraphFormat.leftIndent;if(isList){// if (isNullOrUndefined(propertyValue)) {
//     propertyValue = -36;
// } else {
//     propertyValue -= 36;
// }
propertyValue=0;}if(!sf.base.isNullOrUndefined(propertyValue)){paraStyle+='margin-left:'+propertyValue.toString()+'pt; ';}propertyValue=paragraphFormat.firstLineIndent;if(isList){// if (isNullOrUndefined(propertyValue)) {
//     propertyValue = 18;
// } else {
//     propertyValue += 18;
// }
propertyValue=0;}if(!sf.base.isNullOrUndefined(propertyValue)&&propertyValue!==0){paraStyle+='text-indent:'+propertyValue.toString()+'pt;';}propertyValue=paragraphFormat.lineSpacing;if(!sf.base.isNullOrUndefined(propertyValue)){if(paragraphFormat.lineSpacingType==='Multiple'){propertyValue=Math.round(propertyValue*10)/10;}else{propertyValue=propertyValue.toString()+'pt;';}paraStyle+='line-height:'+propertyValue;}return paraStyle.toString();};HtmlExport.prototype.createAttributesTag=function(tagValue,localProperties){var sb='';sb+='<';sb+=tagValue;for(var i=0;i<localProperties.length;i++){sb+=' ';sb+=localProperties[i];}if(tagValue!=='a'){sb+='>';}return sb;};HtmlExport.prototype.createTag=function(tagValue){var s='';s+='<';s+=tagValue;s+='>';return s;};HtmlExport.prototype.endTag=function(tagValue){var sb='';sb+='<';sb+='/';sb+=tagValue;sb+='>';return sb;};HtmlExport.prototype.createTableStartTag=function(table){var blockStyle='';var tableStyle='';var tagAttributes=[];tagAttributes.push('border="'+'1"');if(!sf.base.isNullOrUndefined(table.tableFormat)){//if (table.tableFormat.shading.backgroundColor !== Color.FromArgb(0, 0, 0, 0)) {
if(!sf.base.isNullOrUndefined(table.tableFormat.shading)&&!sf.base.isNullOrUndefined(table.tableFormat.shading.backgroundColor)){tagAttributes.push('bgcolor="'+HelperMethods.getColor(table.tableFormat.shading.backgroundColor)+'"');}//}
if(!sf.base.isNullOrUndefined(table.tableFormat.leftIndent)&&table.tableFormat.leftIndent!==0){tagAttributes.push('left-indent="'+(table.tableFormat.leftIndent.toString()+'pt;')+'"');}if(!sf.base.isNullOrUndefined(table.tableFormat.cellSpacing)&&table.tableFormat.cellSpacing>0){tagAttributes.push('cellspacing="'+(table.tableFormat.cellSpacing*72/96*2).toString()+'"');}else{tableStyle+='border-collapse:collapse;';}tagAttributes.push('cellpadding="'+'0"');if(!sf.base.isNullOrUndefined(table.tableFormat.borders)){tableStyle+=this.serializeTableBorderStyle(table.tableFormat.borders);}}if(tableStyle.length!==0){tagAttributes.push('style="',tableStyle.toString()+'"');}return blockStyle+=this.createAttributesTag('table',tagAttributes);};HtmlExport.prototype.createTableEndTag=function(){var blockStyle='';blockStyle+=this.endTag('table');return blockStyle;};HtmlExport.prototype.createRowStartTag=function(row){var blockStyle='';var tagAttributes=[];if(row.rowFormat.isHeader){blockStyle+=this.createTag('thead');}if(!sf.base.isNullOrUndefined(row.rowFormat.height)&&row.rowFormat.height>0){var height=HelperMethods.convertPointToPixel(row.rowFormat.height);tagAttributes.push('height="'+height+'"');}return blockStyle+this.createAttributesTag('tr',tagAttributes);};HtmlExport.prototype.createRowEndTag=function(row){var blockStyle='';blockStyle+=this.endTag('tr');if(row.rowFormat.isHeader){blockStyle+=this.endTag('thead');}return blockStyle;};HtmlExport.prototype.decodeHtmlNames=function(text){if(text==='\t'){return'&emsp;';}text=text.replace(/</g,'&lt;').replace(/>/g,'&gt;');var splittedText=text.split(' ');var htmlText='';if(splittedText.length>0){htmlText=splittedText[0];for(var i=0;i<splittedText.length-1;i++){htmlText+=' '+splittedText[i+1];}}return htmlText;};return HtmlExport;}();/* eslint-disable */ /**
 * @private
 */var TextPosition=/** @class */function(){function TextPosition(owner){/**
         * @private
         */this.location=new Point(0,0);/**
         * @private
         */this.isUpdateLocation=true;this.owner=owner;this.documentHelper=this.owner.documentHelper;}Object.defineProperty(TextPosition.prototype,"paragraph",{/**
         * @private
         */get:function get(){return this.currentWidget.paragraph;},enumerable:true,configurable:true});Object.defineProperty(TextPosition.prototype,"isAtParagraphStart",{/**
         * @private
         */get:function get(){return this.offset===this.owner.selection.getStartOffset(this.paragraph);},enumerable:true,configurable:true});Object.defineProperty(TextPosition.prototype,"isAtParagraphEnd",{/**
         * @private
         */get:function get(){return this.owner.selection.isParagraphLastLine(this.currentWidget)&&this.offset===this.owner.selection.getLineLength(this.currentWidget);},enumerable:true,configurable:true});Object.defineProperty(TextPosition.prototype,"isCurrentParaBidi",{/**
         * @private
         */get:function get(){if(!sf.base.isNullOrUndefined(this.currentWidget.paragraph)){return this.currentWidget.paragraph.paragraphFormat.bidi;}return false;},enumerable:true,configurable:true});Object.defineProperty(TextPosition.prototype,"selection",{/**
         * @private
         */get:function get(){return this.owner.selection;},enumerable:true,configurable:true});Object.defineProperty(TextPosition.prototype,"hierarchicalPosition",{/**
         * Gets the hierarchical position of logical text position in the document
         *
         * @returns {string}
         */get:function get(){return this.getHierarchicalIndexInternal();},enumerable:true,configurable:true});Object.defineProperty(TextPosition.prototype,"viewer",{get:function get(){return this.owner.viewer;},enumerable:true,configurable:true});/**
     * Return clone of current text position
     *
     * @private
     */TextPosition.prototype.clone=function(){var textPosition=new TextPosition(this.owner);textPosition.currentWidget=this.currentWidget;textPosition.offset=this.offset;textPosition.location=this.location;return textPosition;};/**
     * @private
     */TextPosition.prototype.containsRtlText=function(widget){for(var i=0;i<widget.children.length;i++){if(widget.children[i].isRightToLeft){return true;}}return false;};/**
     * Set text position for paragraph and inline
     *
     * @private
     */TextPosition.prototype.setPositionForSelection=function(line,element,index,physicalLocation){//Set the start end position
var isParagraphEnd=false;if(sf.base.isNullOrUndefined(element)){this.currentWidget=line;}else{this.currentWidget=element.line;if(element.nextNode instanceof FieldElementBox&&index>element.length){isParagraphEnd=this.selection.isLastRenderedInline(element,element.length);}}this.location=physicalLocation;if(isParagraphEnd){this.offset=this.selection.getParagraphLength(this.currentWidget.paragraph)+1;}else{this.offset=this.currentWidget.getOffset(element,index);}};/**
     * Set text position
     *
     * @private
     */TextPosition.prototype.setPositionFromLine=function(line,offset,location){this.currentWidget=line;this.offset=offset;if(location instanceof Point){this.location.copy(location);}};/**
     * Set text position
     *
     * @private
     */TextPosition.prototype.setPosition=function(line,positionAtStart){this.currentWidget=line;this.offset=positionAtStart?this.selection.getStartOffset(line.paragraph):line.paragraph.lastChild.getEndOffset()+1;this.updatePhysicalPosition(true);};/**
     * Set position for text position
     *
     * @private
     */TextPosition.prototype.setPositionInternal=function(textPosition){this.currentWidget=textPosition.currentWidget;this.offset=textPosition.offset;this.location=textPosition.location;};/**
     * Set position for current index
     *
     * @private
     */TextPosition.prototype.setPositionForCurrentIndex=function(hierarchicalIndex){var index={index:hierarchicalIndex};var paragraph=this.getParagraphWidget(index);//ref hierarchicalIndex
this.offset=parseFloat(index.index);this.setPositionParagraph(paragraph,this.offset);};/**
     * Get Page
     *
     */TextPosition.prototype.getPage=function(position){var page;var index=position.index.indexOf(';');var newValue='0';if(index>=0){newValue=position.index.substring(0,index);position.index=position.index.substring(index).replace(';','');}index=parseInt(newValue,10);page=this.documentHelper.pages[index];return page;};/**
     * @private
     */TextPosition.prototype.getParagraphWidget=function(position){if(sf.base.isNullOrUndefined(position.index)){return undefined;}var page=this.getPage(position);var child=this.getLineWidget(undefined,position,page);return child;};/**
     * @private
     */TextPosition.prototype.getLineWidget=function(widget,position,page){if(sf.base.isNullOrUndefined(position.index)){return undefined;}var index=position.index.indexOf(';');var value='0';if(index>=0){value=position.index.substring(0,index);position.index=position.index.substring(index).replace(';','');}if(value==='H'||value==='F'){if(value==='H'){widget=page.headerWidget;}else{widget=page.footerWidget;}}else if(value==='FN'||value==='EN'){if(value==='FN'){widget=page.footnoteWidget;}else{widget=page.endnoteWidget;}}else if(!sf.base.isNullOrUndefined(page)){widget=page.bodyWidgets[0];}index=parseInt(value,10);if(widget instanceof BlockContainer){index=position.index.indexOf(';');value='0';value=position.index.substring(0,index);position.index=position.index.substring(index).replace(';','');index=parseInt(value,10);}if(widget instanceof TableRowWidget&&index>=widget.childWidgets.length){position.index='0;0';index=widget.childWidgets.length-1;}if(index>=0&&index<widget.childWidgets.length){var child=widget.childWidgets[index];if(child instanceof LineWidget){if(position.index.indexOf(';')>0){position.index='0';}return child;}if(child instanceof Widget){if(position.index.indexOf(';')>0){return this.getLineWidget(child,position);}else{//If table is shifted to previous text position then return the first paragraph within table.
if(child instanceof TableWidget){return this.getLineWidget(this.selection.getFirstParagraphInFirstCell(child),position);}else if(child instanceof TableRowWidget&&position.index.indexOf(';')===-1){return this.selection.getFirstParagraphInFirstCell(child.ownerTable).childWidgets[0];}return undefined;}}}else if(widget.nextRenderedWidget instanceof Widget){position.index='0';if(widget.nextRenderedWidget instanceof TableWidget){return this.selection.getFirstParagraphInFirstCell(widget.nextRenderedWidget).firstChild;}return this.getLineWidget(widget.nextRenderedWidget,position);}return undefined;};/**
     * Update physical location of paragraph
     *
     * @private
     */TextPosition.prototype.updatePhysicalPosition=function(moveNextLine){if(this.currentWidget&&this.owner.isLayoutEnabled&&this.isUpdateLocation){this.location=this.selection.getPhysicalPositionInternal(this.currentWidget,this.offset,moveNextLine);}};/**
     * Return true if text position are in same paragraph and offset
     *
     * @private
     */TextPosition.prototype.isAtSamePosition=function(textPosition){return this.currentWidget===textPosition.currentWidget&&this.offset===textPosition.offset;};/**
     * Return true if text position is in same paragraph index
     * @private
     */TextPosition.prototype.isInSameParagraphIndex=function(textPosition){if(sf.base.isNullOrUndefined(textPosition)){throw new Error('textPosition is undefined.');}return this.paragraph.index===textPosition.paragraph.index;};/**
     * Return true if text position is in same paragraph
     *
     * @private
     */TextPosition.prototype.isInSameParagraph=function(textPosition){if(sf.base.isNullOrUndefined(textPosition)){throw new Error('textPosition is undefined.');}return this.paragraph===textPosition.paragraph;};/**
     * Return true is current text position exist before given text position
     *
     * @private
     */TextPosition.prototype.isExistBefore=function(textPosition){if(sf.base.isNullOrUndefined(textPosition)){throw new Error('textPosition is undefined.');}if(this.currentWidget===textPosition.currentWidget){return this.offset<textPosition.offset;}var currentParagraph=this.currentWidget.paragraph;var paragraph=textPosition.currentWidget.paragraph;if(currentParagraph===paragraph){return currentParagraph.childWidgets.indexOf(this.currentWidget)<paragraph.childWidgets.indexOf(textPosition.currentWidget);}if(currentParagraph.containerWidget===paragraph.containerWidget){if(currentParagraph.isInsideTable){return currentParagraph.associatedCell.childWidgets.indexOf(currentParagraph)<paragraph.associatedCell.childWidgets.indexOf(paragraph);//handle after header footer implementation
// } else if ((this.currentParagraph).owner instanceof WHeaderFooter) {
//     return ((this.currentParagraph).owner as WHeaderFooter).blocks.indexOf((this.currentParagraph)) <
//         ((textPosition.currentParagraph).owner as WHeaderFooter).blocks.indexOf((textPosition.currentParagraph));
}else{return currentParagraph.containerWidget.childWidgets.indexOf(currentParagraph)<paragraph.containerWidget.childWidgets.indexOf(paragraph);}}return this.owner.selection.isExistBefore(currentParagraph,paragraph);};/**
     * Return true is current text position exist after given text position
     *
     * @private
     */TextPosition.prototype.isExistAfter=function(textPosition){if(sf.base.isNullOrUndefined(textPosition)){throw new Error('textPosition is undefined.');}if(this.currentWidget===textPosition.currentWidget){return this.offset>textPosition.offset;}if(this.currentWidget.paragraph===textPosition.currentWidget.paragraph){return this.currentWidget.paragraph.childWidgets.indexOf(this.currentWidget)>textPosition.currentWidget.paragraph.childWidgets.indexOf(textPosition.currentWidget);}var startParagraph=this.currentWidget.paragraph;var endParagraph=textPosition.currentWidget.paragraph;if(startParagraph.containerWidget instanceof BodyWidget&&endParagraph.containerWidget instanceof BodyWidget&&startParagraph.containerWidget===endParagraph.containerWidget){if(startParagraph.isInsideTable&&endParagraph.isInsideTable){return startParagraph.associatedCell.childWidgets.indexOf(startParagraph)>endParagraph.associatedCell.childWidgets.indexOf(endParagraph);// } else if ((this.currentParagraph).owner instanceof WHeaderFooter) {
//     return ((this.currentParagraph).owner as WHeaderFooter).blocks.indexOf((this.currentParagraph)) >
//         ((textPosition.currentParagraph).owner as WHeaderFooter).blocks.indexOf((textPosition.currentParagraph));
}else{return startParagraph.containerWidget.childWidgets.indexOf(startParagraph)>endParagraph.containerWidget.childWidgets.indexOf(endParagraph);}}return this.owner.selection.isExistAfter(startParagraph,endParagraph);};/**
     * Return hierarchical index of current text position
     *
     * @private
     */TextPosition.prototype.getHierarchicalIndexInternal=function(){return this.getHierarchicalIndex(this.currentWidget,this.offset.toString());};/**
     * @private
     */TextPosition.prototype.getHierarchicalIndex=function(line,hierarchicalIndex){var node=line;if(node){return node.getHierarchicalIndex(hierarchicalIndex);}return hierarchicalIndex;};/**
     * @private
     */TextPosition.prototype.setPositionParagraph=function(line,offsetInLine){this.currentWidget=line;this.offset=offsetInLine;this.updatePhysicalPosition(true);};/**
     * @private
     */TextPosition.prototype.setPositionForLineWidget=function(lineWidget,offset){var lineLength=this.selection.getLineLength(lineWidget);var lineIndex=lineWidget.paragraph.childWidgets.indexOf(lineWidget);if(lineWidget.isLastLine()){if(!sf.base.isNullOrUndefined(lineWidget.paragraph.footNoteReference)){lineLength=lineLength+lineWidget.paragraph.footNoteReference.text.length;}else{lineLength=lineLength+1;}}if(offset>lineLength){var nextLineWidget=void 0;if(lineIndex>=lineWidget.paragraph.childWidgets.length-1){var nextBlock=this.selection.getNextRenderedBlock(lineWidget.paragraph);if(nextBlock&&nextBlock.index===lineWidget.paragraph.index){nextLineWidget=nextBlock.firstChild;}}else{nextLineWidget=lineWidget.paragraph.childWidgets[lineIndex+1];}this.setPositionForLineWidget(nextLineWidget,offset-lineLength);return;}else if(offset<0){var prevLine=lineWidget.paragraph.childWidgets[lineIndex-1];var currentOffSet=this.selection.getLineLength(prevLine)+offset;this.setPositionForLineWidget(prevLine,currentOffSet);return;}else{this.currentWidget=lineWidget;this.offset=offset;}this.updatePhysicalPosition(true);};/**
     * move to next text position
     *
     * @private
     */TextPosition.prototype.moveNextPosition=function(isNavigate){if(sf.base.isNullOrUndefined(isNavigate)){isNavigate=true;}var inline=this.selection.getNextStartInline(this.currentWidget,this.offset);if(inline instanceof FieldElementBox&&inline.fieldType===0&&!sf.base.isNullOrUndefined(inline.fieldEnd)){if(isNavigate){this.moveNextPositionInternal(inline);this.moveNextPosition();return;}else{var line=inline.fieldEnd.line;var fieldEnd=inline.fieldEnd;var fieldEndOffset=line.getOffset(fieldEnd,1);var fieldEndIndex=this.getHierarchicalIndex(line,fieldEndOffset.toString());if(TextPosition.isForwardSelection(this.selection.end.getHierarchicalIndexInternal(),fieldEndIndex)){//If field end is after selection end, extend selection end to field end.
this.selection.end.moveToInline(inline.fieldEnd,1);return;}this.moveToInline(inline.fieldEnd,1);}}var nextOffset=this.selection.getNextValidOffset(this.currentWidget,this.offset);var lineIndex=this.paragraph.childWidgets.indexOf(this.currentWidget);var index=0;if(nextOffset>this.offset){this.offset=nextOffset;var info=this.currentWidget.getInline(this.offset,index);inline=info.element;index=info.index;if(!sf.base.isNullOrUndefined(inline)&&index===inline.length&&(inline.nextNode instanceof FieldElementBox||inline.nextNode instanceof BookmarkElementBox)){var nextValidInline=this.selection.getNextValidElement(inline.nextNode);//Moves to field end mark or Bookmark end.
if(nextValidInline instanceof FieldElementBox&&nextValidInline.fieldType===1||nextValidInline instanceof BookmarkElementBox&&nextValidInline.bookmarkType===1){inline=nextValidInline;this.currentWidget=inline.line;this.offset=this.currentWidget.getOffset(inline,this.documentHelper.isFormFillProtectedMode?0:1);}}}else if(lineIndex+1<this.paragraph.childWidgets.length){var nextLineWidget=this.paragraph.childWidgets[lineIndex+1];if(nextLineWidget){this.currentWidget=nextLineWidget;this.offset=this.selection.getStartLineOffset(this.currentWidget);}var inlineObj=this.currentWidget.getInline(this.offset,index);inline=inlineObj.element;index=inlineObj.index;if(inline instanceof FieldElementBox&&inline.fieldType===0){this.offset++;}}else{this.updateOffsetToNextParagraph(index,false);}//Gets physical position in current page.
this.updatePhysicalPosition(true);};/**
     * Move text position to previous paragraph inside table
     *
     * @private
     */TextPosition.prototype.moveToPreviousParagraphInTable=function(selection){var previousParagraph;var currentPara=this.currentWidget.paragraph;if(currentPara.isInsideTable){previousParagraph=selection.getPreviousSelectionCell(currentPara.associatedCell);}else{previousParagraph=selection.getPreviousParagraphBlock(currentPara);}if(sf.base.isNullOrUndefined(previousParagraph)){return;}this.currentWidget=previousParagraph.childWidgets[previousParagraph.childWidgets.length-1];this.offset=this.currentWidget.getEndOffset()+1;};TextPosition.prototype.updateOffsetToNextParagraph=function(indexInInline,isHighlight){//Moves to owner and get next paragraph.
var inline;var positionAtStart=false;var nextParagraph=undefined;var lineIndex=this.paragraph.childWidgets.indexOf(this.currentWidget);if(!isHighlight){nextParagraph=this.selection.getNextParagraphBlock(this.paragraph);}else if(lineIndex+1<this.paragraph.childWidgets.length){var nextLineWidget=this.paragraph.childWidgets[lineIndex+1];if(nextLineWidget){this.currentWidget=nextLineWidget;this.offset=1;}}else{nextParagraph=this.selection.getNextSelectionBlock(this.paragraph);if(!sf.base.isNullOrUndefined(nextParagraph)){if(nextParagraph.containerWidget instanceof TableCellWidget){if(this.selection.start.paragraph.isInsideTable){var containerCell=this.selection.getContainerCellOf(this.selection.start.paragraph.associatedCell,nextParagraph.associatedCell);positionAtStart=!containerCell.ownerTable.contains(nextParagraph.associatedCell);}else{positionAtStart=true;}}}}if(!sf.base.isNullOrUndefined(nextParagraph)&&nextParagraph.childWidgets.length>0){if(!positionAtStart){this.currentWidget=nextParagraph.firstChild;this.offset=isHighlight?1:this.selection.getStartLineOffset(this.currentWidget);}else{this.currentWidget=nextParagraph.childWidgets[nextParagraph.childWidgets.length-1];this.offset=this.selection.getLineLength(this.currentWidget)+1;}}var inlineObj=this.currentWidget.getInline(this.offset,indexInInline);inline=inlineObj.element;indexInInline=inlineObj.index;if(inline instanceof FieldElementBox&&inline.fieldType===0){this.offset++;}};TextPosition.prototype.updateOffsetToPrevPosition=function(index,isHighlight){var inlineInfo;var inline;var lineIndex=this.paragraph.childWidgets.indexOf(this.currentWidget);var prevOffset=this.selection.getPreviousValidOffset(this.currentWidget.paragraph,this.offset);if(this.offset>prevOffset){this.offset=prevOffset;}else if(lineIndex>0){var prevLineWidget=this.paragraph.childWidgets[lineIndex-1];if(prevLineWidget){this.currentWidget=prevLineWidget;var endOffset=this.currentWidget.getEndOffset();this.offset=endOffset>0?endOffset-1:endOffset;}}else{//Moves to owner and get previous paragraph.
var previousParagraph=undefined;var positionAtStart=false;if(!isHighlight){previousParagraph=this.selection.getPreviousParagraphBlock(this.paragraph);}else{previousParagraph=this.selection.getPreviousSelectionBlock(this.paragraph);if(!sf.base.isNullOrUndefined(previousParagraph)){if(previousParagraph.containerWidget instanceof TableCellWidget){if(this.selection.start.paragraph.isInsideTable){var containerCell=this.selection.getContainerCellOf(this.selection.start.paragraph.associatedCell,previousParagraph.associatedCell);positionAtStart=!containerCell.ownerTable.contains(previousParagraph.associatedCell);}else{positionAtStart=true;}}}}if(!sf.base.isNullOrUndefined(previousParagraph)){if(!positionAtStart){this.currentWidget=previousParagraph.childWidgets[previousParagraph.childWidgets.length-1];// line end with page break and updating offset before page break.
this.offset=this.currentWidget.isEndsWithPageBreak?this.currentWidget.getEndOffset()-1:this.currentWidget.getEndOffset();}else{this.currentWidget=previousParagraph.firstChild;this.offset=this.selection.getStartLineOffset(this.currentWidget);}}}index=0;inlineInfo=this.currentWidget.getInline(this.offset,index);inline=inlineInfo.element;index=inlineInfo.index;if(inline instanceof FieldElementBox&&inline.fieldType===0){this.offset++;}if(inline instanceof FieldElementBox){//Checks if field character is part of rendered field, otherwise moves to previous rendered content.
var previousInline=this.selection.getPreviousValidElement(inline);if(!sf.base.isNullOrUndefined(previousInline)){inline=previousInline;this.currentWidget=inline.line;this.offset=this.currentWidget.getOffset(inline,inline.length);if(inline instanceof FieldElementBox&&inline.fieldType===0){this.offset--;}}}//Gets physical position in current page.
this.updatePhysicalPosition(true);};/**
     * Moves the text position to start of the next paragraph.
     */TextPosition.prototype.moveToNextParagraphStartInternal=function(){var paragraph=this.currentWidget.paragraph;if(!sf.base.isNullOrUndefined(this.selection.getNextParagraphBlock(paragraph))){this.currentWidget=this.selection.getNextParagraphBlock(paragraph).firstChild;this.offset=this.selection.getStartOffset(paragraph);this.updatePhysicalPosition(true);}};/**
     * Move to previous position
     *
     * @private
     */TextPosition.prototype.movePreviousPosition=function(){var index=0;var inlineInfo=this.currentWidget.getInline(this.offset,index);var inline=inlineInfo.element;index=inlineInfo.index;var lineIndex=this.paragraph.childWidgets.indexOf(this.currentWidget);if(inline instanceof FieldElementBox&&inline.fieldType===1&&!sf.base.isNullOrUndefined(inline.fieldBegin)||inline instanceof BookmarkElementBox&&inline.bookmarkType===1){this.movePreviousPositionInternal(inline);}this.updateOffsetToPrevPosition(index,false);};/**
     * Move to next position
     *
     * @private
     */TextPosition.prototype.moveNextPositionInternal=function(fieldBegin){var inline;if(sf.base.isNullOrUndefined(fieldBegin.fieldSeparator)){inline=fieldBegin.fieldEnd;}else{inline=fieldBegin.fieldSeparator;this.currentWidget=inline.line;if(this.currentWidget===fieldBegin.fieldEnd.line&&!this.selection.hasValidInline(this.paragraph,inline,fieldBegin.fieldEnd)){inline=fieldBegin.fieldEnd;}}this.currentWidget=inline.line;this.offset=this.currentWidget.getOffset(inline,1);};/**
     * Move text position backward
     *
     * @private
     */TextPosition.prototype.moveBackward=function(){var indexInInline=0;var inlineObj=this.currentWidget.getInline(this.offset,indexInInline);var inline=inlineObj.element;indexInInline=inlineObj.index;if(!this.owner.selection.isEmpty&&!sf.base.isNullOrUndefined(inline)){var nextInline=this.selection.getNextRenderedElementBox(inline,indexInInline);if(nextInline instanceof FieldElementBox&&nextInline.fieldType===0){var hierarchicalIndex=this.owner.selection.start.getHierarchicalIndexInternal();var fieldEndOffset=nextInline.fieldEnd.line.getOffset(nextInline.fieldEnd,1);var fieldEndIndex=this.getHierarchicalIndex(nextInline.fieldEnd.line,fieldEndOffset.toString());if(!TextPosition.isForwardSelection(fieldEndIndex,hierarchicalIndex)){//If field end is after selection start, move selection start to field end.
this.owner.selection.start.setPositionParagraph(nextInline.fieldEnd.line,fieldEndOffset);return;}}}if(inline instanceof FieldElementBox&&inline.fieldType===1&&!sf.base.isNullOrUndefined(inline.fieldBegin)){var hierarchicalIndex=this.owner.selection.start.getHierarchicalIndexInternal();var fieldEndOffset=inline.line.getOffset(inline,1);var fieldEndIndex=this.getHierarchicalIndex(inline.line,fieldEndOffset.toString());if(!TextPosition.isForwardSelection(hierarchicalIndex,fieldEndIndex)){//If field end is after selection start, extend selection end to field begin.
var fieldBeginOffset=inline.fieldBegin.line.getOffset(inline.fieldBegin,0);this.currentWidget=inline.fieldBegin.line;this.offset=fieldBeginOffset;//Updates physical position in current page.
this.updatePhysicalPosition(true);return;}this.movePreviousPositionInternal(inline);}this.updateOffsetToPrevPosition(indexInInline,true);};/**
     * Move text position forward
     *
     * @private
     */TextPosition.prototype.moveForward=function(){var indexInInline=0;var inlineObj=this.currentWidget.getInline(this.offset,indexInInline);var inline=inlineObj.element;indexInInline=inlineObj.index;if(!sf.base.isNullOrUndefined(inline)){if(!this.owner.selection.isEmpty&&indexInInline===inline.length&&inline instanceof FieldElementBox&&inline.fieldType===1){var hierarchicalIndex=this.owner.selection.start.getHierarchicalIndexInternal();var fieldBeginOffset=inline.fieldBegin.line.getOffset(inline.fieldBegin,0);var fieldBeginIndex=this.getHierarchicalIndex(inline.fieldBegin.line,fieldBeginOffset.toString());if(!TextPosition.isForwardSelection(hierarchicalIndex,fieldBeginIndex)){//If field begin is before selection start, move selection start to field begin.
this.owner.selection.start.setPositionParagraph(inline.fieldBegin.line,fieldBeginOffset);return;}}inline=this.selection.getNextRenderedElementBox(inline,indexInInline);}if(inline instanceof FieldElementBox&&!sf.base.isNullOrUndefined(inline.fieldEnd)){var selectionStartParagraph=this.owner.selection.start.paragraph;var selectionStartIndex=0;var selectionStartInlineObj=selectionStartParagraph.getInline(this.owner.selection.start.offset,selectionStartIndex);var selectionStartInline=selectionStartInlineObj.element;selectionStartIndex=selectionStartInlineObj.index;var nextRenderInline=this.selection.getNextRenderedElementBox(selectionStartInline,selectionStartIndex);if(nextRenderInline===inline){this.moveNextPositionInternal(inline);}else{//If selection start is before field begin, extend selection end to field end.
inline=inline.fieldEnd;this.currentWidget=inline.line;this.offset=this.currentWidget.getOffset(inline,1);//Updates physical position in current page.
this.updatePhysicalPosition(true);return;}}else if(inline instanceof FieldElementBox&&(inline.fieldType===0||inline.fieldType===1)){this.currentWidget=inline.line;this.offset=this.currentWidget.getOffset(inline,1);}indexInInline=0;var nextOffset=this.selection.getNextValidOffset(this.currentWidget,this.offset);var length=this.selection.getLineLength(this.currentWidget);var isParagraphEnd=this.selection.isParagraphLastLine(this.currentWidget);if(this.offset<nextOffset){this.offset=nextOffset;var inlineObj_1=this.currentWidget.getInline(this.offset,indexInInline);inline=inlineObj_1.element;indexInInline=inlineObj_1.index;if(!sf.base.isNullOrUndefined(inline)&&indexInInline===inline.length&&inline.nextNode instanceof FieldElementBox){var nextValidInline=this.selection.getNextValidElement(inline.nextNode);//Moves to field end mark.
if(nextValidInline instanceof FieldElementBox&&nextValidInline.fieldType===1){inline=nextValidInline;this.offset=this.currentWidget.getOffset(inline,1);}}}else if(this.offset===nextOffset&&inline instanceof FieldElementBox&&inline.fieldType===1&&inline.previousNode instanceof ImageElementBox){this.offset=nextOffset;}else if(this.offset===nextOffset&&this.offset<length+1&&isParagraphEnd){this.offset=length+1;}else{this.updateOffsetToNextParagraph(indexInInline,true);}//Gets physical position in current page.
this.updatePhysicalPosition(true);};/**
     * Move to given inline
     *
     * @private
     */TextPosition.prototype.moveToInline=function(inline,index){this.currentWidget=inline.line;this.offset=this.currentWidget.getOffset(inline,index);//Updates physical position in current page.
this.updatePhysicalPosition(true);};/**
     * Return true is start element exist before end element
     *
     * @private
     */TextPosition.isForwardSelection=function(start,end){if(start===end){return true;}start=start.replace(/C;/g,'');end=end.replace(/C;/g,'');start=start.replace(/H;/g,'');end=end.replace(/H;/g,'');start=start.replace(/F;/g,'');end=end.replace(/F;/g,'');var selectionStart=start.split(';');var selectionEnd=end.split(';');var length=selectionStart.length;if(length>selectionEnd.length){length=selectionEnd.length-1;}for(var i=0;i<length;i++){var startOffset=parseFloat(selectionStart[i]);var endOffset=parseFloat(selectionEnd[i]);if(startOffset!==endOffset){return startOffset<endOffset;}}return false;};/**
     * Move to previous position offset
     *
     * @param fieldEnd
     * @private
     */TextPosition.prototype.movePreviousPositionInternal=function(fieldEnd){var inline;if(fieldEnd instanceof FieldElementBox&&sf.base.isNullOrUndefined(fieldEnd.fieldSeparator)){inline=this.selection.getPreviousValidElement(fieldEnd.fieldBegin);}else{inline=this.selection.getPreviousValidElement(fieldEnd);}this.currentWidget=inline.line;var index=inline instanceof FieldElementBox||inline instanceof BookmarkElementBox&&inline.bookmarkType===1?0:inline.length;this.offset=this.currentWidget.getOffset(inline,index);};/**
     * Moves the text position to start of the word.
     *
     * @param type
     * @private
     */TextPosition.prototype.moveToWordStartInternal=function(type){var endOffset=this.currentWidget.getEndOffset();var currentPara=this.currentWidget.paragraph;var selection=this.selection;if(type===2&&(this.offset===endOffset||this.offset===endOffset+1)){return;}if(this.offset===endOffset+1){this.offset=endOffset;}else if(this.offset===selection.getStartOffset(currentPara)&&this.currentWidget===currentPara.childWidgets[0]){var previousParagraph=selection.getPreviousParagraphBlock(currentPara);if(sf.base.isNullOrUndefined(previousParagraph)){return;}this.currentWidget=previousParagraph.childWidgets[previousParagraph.childWidgets.length-1];this.offset=this.currentWidget.getEndOffset();}else{if(this.offset===selection.getStartLineOffset(this.currentWidget)){var lineIndex=currentPara.childWidgets.indexOf(this.currentWidget);if(lineIndex-1>=0){this.currentWidget=currentPara.childWidgets[lineIndex-1];this.offset=this.currentWidget.getEndOffset();}}var isStarted=false;var endSelection=false;var indexInInline=0;var inlineObj=this.currentWidget.getInline(this.offset,indexInInline);var inline=inlineObj.element;indexInInline=inlineObj.index;this.getPreviousWordOffset(inline,selection,indexInInline,type,inline instanceof FieldElementBox&&inline.fieldType===1,isStarted,endSelection,this);}if(type===1){this.calculateOffset();}this.updatePhysicalPosition(true);};TextPosition.prototype.getNextWordOffset=function(inline,indexInInline,type,isInField,endSelection,endPosition,excludeSpace){if(inline instanceof TextElementBox){this.getNextWordOffsetSpan(inline,indexInInline,type,isInField,endSelection,endPosition,excludeSpace);}else if(inline instanceof ImageElementBox){this.getNextWordOffsetImage(inline,indexInInline,type,isInField,endSelection,endPosition,excludeSpace);}else if(inline instanceof FieldElementBox&&inline.fieldType===0){this.getNextWordOffsetFieldBegin(inline,indexInInline,type,isInField,endSelection,endPosition,excludeSpace);}else if(inline instanceof FieldElementBox&&inline.fieldType===2||inline instanceof BookmarkElementBox){this.getNextWordOffsetFieldSeparator(inline,indexInInline,type,isInField,endSelection,endPosition,excludeSpace);}else if(inline instanceof FieldElementBox&&inline.fieldType===1){this.getNextWordOffsetFieldEnd(inline,indexInInline,type,isInField,endSelection,endPosition,excludeSpace);}else if(inline instanceof CommentCharacterElementBox){this.getNextWordOffsetComment(inline,indexInInline,type,isInField,endSelection,endPosition,excludeSpace);}};TextPosition.prototype.getNextWordOffsetFieldBegin=function(fieldBegin,indexInInline,type,isInField,endSelection,endPosition,excludeSpace){var startOffset=fieldBegin.line.getOffset(fieldBegin,0);var endOffset=startOffset+fieldBegin.length;if(sf.base.isNullOrUndefined(fieldBegin.fieldSeparator)){this.getNextWordOffsetFieldEnd(fieldBegin.fieldEnd,0,type,isInField,endSelection,endPosition,excludeSpace);}else if(type===0){this.getNextWordOffsetFieldSeparator(fieldBegin.fieldSeparator,0,type,isInField,endSelection,endPosition,excludeSpace);}else if(!sf.base.isNullOrUndefined(fieldBegin.fieldEnd)){var inline=fieldBegin.fieldSeparator;if(inline.line.paragraph===fieldBegin.fieldEnd.line.paragraph&&!this.selection.hasValidInline(inline.line.paragraph,inline,fieldBegin.fieldEnd)){inline=fieldBegin.fieldEnd;}this.getNextWordOffset(inline,0,type,!(endPosition.paragraph===fieldBegin.line.paragraph&&endPosition.offset===startOffset),endSelection,endPosition,excludeSpace);if(endSelection&&!sf.base.isNullOrUndefined(fieldBegin.fieldSeparator)&&endPosition.paragraph===fieldBegin.line.paragraph&&endPosition.offset===fieldBegin.fieldSeparator.line.getOffset(fieldBegin.fieldSeparator,fieldBegin.fieldSeparator.length)){endPosition.setPositionParagraph(fieldBegin.line,startOffset);return;}if(!endSelection){endPosition.setPositionParagraph(fieldBegin.fieldEnd.line,fieldBegin.fieldEnd.line.getOffset(fieldBegin.fieldEnd,fieldBegin.fieldEnd.length));}}};TextPosition.prototype.getNextWordOffsetImage=function(image,indexInInline,type,isInField,endSelection,endPosition,excludeSpace){if(isInField){endPosition.setPositionParagraph(image.line,image.line.getOffset(image,indexInInline));endSelection=false;return;}if(indexInInline===0){var startOffset=image.line.getOffset(image,0);endSelection=true;if(endPosition.offset===startOffset){if(sf.base.isNullOrUndefined(image.nextNode)){endPosition.setPositionParagraph(image.line,startOffset+image.length);}else{this.getNextWordOffset(image.nextNode,0,type,isInField,endSelection,endPosition,excludeSpace);}}else{endPosition.setPositionParagraph(image.line,startOffset);}}else if(!sf.base.isNullOrUndefined(image.nextNode)){this.getNextWordOffset(image.nextNode,0,type,isInField,endSelection,endPosition,excludeSpace);}};TextPosition.prototype.getNextWordOffsetSpan=function(span,indexInInline,type,isInField,endSelection,endPosition,excludeSpace){if(span.text==='\t'||span.text==='\v'){if(isInField){endPosition.setPositionParagraph(span.line,span.line.getOffset(span,indexInInline));endSelection=false;return;}if(indexInInline===0){endSelection=true;var startOffset=span.line.getOffset(span,0);if(endPosition.offset===startOffset){endPosition.setPositionParagraph(span.line,startOffset+span.length);}else{endPosition.setPositionParagraph(span.line,startOffset);}}else if(!sf.base.isNullOrUndefined(span.nextNode)){this.getNextWordOffset(span.nextNode,0,type,isInField,endSelection,endPosition,excludeSpace);}}else{var wordEndIndex=0;if(indexInInline===0&&endSelection&&HelperMethods.wordSplitCharacters.indexOf(span.text[0])===-1){endPosition.setPositionParagraph(span.line,span.line.getOffset(span,indexInInline));if(isInField){return;}}else if(indexInInline<span.length){var txt=indexInInline>0&&span.text.length-1>=indexInInline?span.text.slice(indexInInline,span.length):span.text;wordEndIndex=HelperMethods.indexOfAny(txt,HelperMethods.wordSplitCharacters);if(wordEndIndex===-1&&span.nextNode instanceof CommentCharacterElementBox&&sf.base.isNullOrUndefined(span.nextNode.nextNode)){wordEndIndex=span.length;}if(wordEndIndex!==-1){if(isInField){endSelection=false;return;}var offset=span.line.getOffset(span,wordEndIndex+indexInInline);if((excludeSpace||txt[wordEndIndex]!==' ')&&!endSelection&&span.line.paragraph===endPosition.paragraph&&offset!==endPosition.offset){endSelection=true;endPosition.setPositionParagraph(span.line,offset);return;}wordEndIndex++;while(wordEndIndex<txt.length&&HelperMethods.wordSplitCharacters.indexOf(txt[wordEndIndex])!==-1){if(txt[wordEndIndex]!==' '&&txt[wordEndIndex]!==''){break;}wordEndIndex++;}endSelection=true;if(wordEndIndex<txt.length){endPosition.setPositionParagraph(span.line,span.line.getOffset(span,wordEndIndex+indexInInline));}else if(!sf.base.isNullOrUndefined(span.nextNode)){this.getNextWordOffset(span.nextNode,0,type,isInField,endSelection,endPosition,excludeSpace);}else{endPosition.setPositionParagraph(span.line,span.line.getOffset(span,wordEndIndex+indexInInline));}}else if(!sf.base.isNullOrUndefined(span.nextNode)){this.getNextWordOffset(span.nextNode,0,type,isInField,endSelection,endPosition,excludeSpace);}else{endPosition.setPositionParagraph(span.line,span.line.getEndOffset());}}else if(!sf.base.isNullOrUndefined(span.nextNode)){this.getNextWordOffset(span.nextNode,0,type,isInField,endSelection,endPosition,excludeSpace);}}};TextPosition.prototype.getNextWordOffsetFieldSeparator=function(fieldSeparator,indexInInline,type,isInField,endSelection,endPosition,excludeSpace){if(!sf.base.isNullOrUndefined(fieldSeparator.nextNode)){this.getNextWordOffset(fieldSeparator.nextNode,0,type,isInField,endSelection,endPosition,excludeSpace);}};TextPosition.prototype.getNextWordOffsetComment=function(comment,indexInInline,type,isInField,endSelection,endPosition,excludeSpace){if(!sf.base.isNullOrUndefined(comment.nextNode)){this.getNextWordOffset(comment.nextNode,0,type,isInField,endSelection,endPosition,excludeSpace);}};TextPosition.prototype.getNextWordOffsetFieldEnd=function(fieldEnd,indexInInline,type,isInField,endSelection,endPosition,excludeSpace){var startOffset=fieldEnd.line.getOffset(fieldEnd,0);var endOffset=startOffset+fieldEnd.length;if(endPosition.offset===startOffset){endPosition.setPositionParagraph(fieldEnd.line,endOffset);if(sf.base.isNullOrUndefined(fieldEnd.nextNode)){return;}}if(!sf.base.isNullOrUndefined(fieldEnd.nextNode)){this.getNextWordOffset(fieldEnd.nextNode,0,type,false,endSelection,endPosition,excludeSpace);if(endPosition.offset===endOffset){endPosition.setPositionParagraph(fieldEnd.line,startOffset);}}else{endPosition.setPositionParagraph(fieldEnd.line,startOffset);}endSelection=true;};TextPosition.prototype.getPreviousWordOffset=function(inline,selection,indexInInline,type,isInField,isStarted,endSelection,endPosition){if(inline instanceof TextElementBox){this.getPreviousWordOffsetSpan(inline,selection,indexInInline,type,isInField,isStarted,endSelection,endPosition);}else if(inline instanceof ImageElementBox){this.getPreviousWordOffsetImage(inline,selection,indexInInline,type,isInField,isStarted,endSelection,endPosition);}else if(inline instanceof FieldElementBox&&inline.fieldType===0){this.getPreviousWordOffsetFieldBegin(inline,selection,indexInInline,type,isInField,isStarted,endSelection,endPosition);}else if(inline instanceof FieldElementBox&&inline.fieldType===2){this.getPreviousWordOffsetFieldSeparator(inline,selection,indexInInline,type,isInField,isStarted,endSelection,endPosition);}else if(inline instanceof FieldElementBox&&inline.fieldType===1){this.getPreviousWordOffsetFieldEnd(inline,selection,indexInInline,type,isInField,isStarted,endSelection,endPosition);}else if(inline instanceof BookmarkElementBox){this.getPreviousWordOffsetBookMark(inline,selection,indexInInline,type,isInField,isStarted,endSelection,endPosition);}else if(inline instanceof ListTextElementBox&&inline.previousNode){this.getPreviousWordOffsetSpan(inline.previousNode,selection,indexInInline,type,isInField,isStarted,endSelection,endPosition);}else if(inline instanceof CommentCharacterElementBox){this.getPreviousWordOffsetComment(inline,selection,indexInInline,type,isInField,isStarted,endSelection,endPosition);}};TextPosition.prototype.getPreviousWordOffsetBookMark=function(bookmark,selection,indexInInline,type,isInField,isStarted,endSelection,endPosition){if(bookmark.previousNode){if(bookmark.previousNode instanceof TextElementBox){var inline=bookmark.previousNode;if(HelperMethods.lastIndexOfAny(inline.text,HelperMethods.wordSplitCharacters)!==inline.text.length-1){this.getPreviousWordOffset(inline,selection,indexInInline,type,isInField,isStarted,endSelection,endPosition);}else{endPosition.setPositionParagraph(bookmark.line,bookmark.line.getOffset(bookmark,0));}}}else{endPosition.setPositionParagraph(bookmark.line,selection.getStartLineOffset(bookmark.line));}};TextPosition.prototype.getPreviousWordOffsetFieldEnd=function(fieldEnd,selection,indexInInline,type,isInField,isStarted,endSelection,endPosition){var startOffset=fieldEnd.line.getOffset(fieldEnd,0);var endOffset=startOffset+fieldEnd.length;if(sf.base.isNullOrUndefined(fieldEnd.fieldSeparator)){this.getPreviousWordOffsetFieldBegin(fieldEnd.fieldBegin,selection,0,type,isInField,isStarted,endSelection,endPosition);}else if(type===0&&!sf.base.isNullOrUndefined(fieldEnd.previousNode)){var inline=fieldEnd.previousNode;this.getPreviousWordOffset(inline,selection,inline.length,type,inline instanceof FieldElementBox&&inline.fieldType===1,isStarted,endSelection,endPosition);}else if(!sf.base.isNullOrUndefined(fieldEnd.fieldBegin)&&type!==0){var inline=fieldEnd.previousNode;if(sf.base.isNullOrUndefined(inline)||inline.line.paragraph===fieldEnd.fieldBegin.line.paragraph&&!selection.hasValidInline(inline.line.paragraph,inline,fieldEnd.fieldBegin)){inline=fieldEnd.fieldBegin;}this.getPreviousWordOffset(inline,selection,inline.length,type,!(endPosition.paragraph===fieldEnd.line.paragraph&&endPosition.offset===endOffset),isStarted,endSelection,endPosition);if(endSelection&&endPosition.paragraph===fieldEnd.line.paragraph&&endPosition.offset===startOffset){endPosition.setPositionParagraph(fieldEnd.line,endOffset);return;}if(!endSelection){endPosition.setPositionParagraph(fieldEnd.fieldBegin.line,fieldEnd.fieldBegin.line.getOffset(fieldEnd.fieldBegin,0));}}};TextPosition.prototype.getPreviousWordOffsetFieldSeparator=function(fieldSeparator,selection,indexInInline,type,isInField,isStarted,endSelection,endPosition){this.getPreviousWordOffsetFieldBegin(fieldSeparator.fieldBegin,selection,fieldSeparator.fieldBegin.length,type,isInField,isStarted,endSelection,endPosition);};/* get previous word offset from comment
    * @private
    */TextPosition.prototype.getPreviousWordOffsetComment=function(comment,selection,indexInInline,type,isInField,isStarted,endSelection,endPosition){if(comment.previousNode){var inline=comment.previousNode;if(comment.previousNode instanceof TextElementBox&&HelperMethods.lastIndexOfAny(inline.text,HelperMethods.wordSplitCharacters)!==inline.text.length-1){this.getPreviousWordOffset(inline,selection,indexInInline,type,isInField,isStarted,endSelection,endPosition);}else{this.getPreviousWordOffset(comment.previousNode,selection,comment.previousNode.length,type,isInField,isStarted,endSelection,endPosition);}}else{endPosition.setPositionParagraph(comment.line,selection.getStartLineOffset(comment.line));}};TextPosition.prototype.getPreviousWordOffsetFieldBegin=function(fieldBegin,selection,indexInInline,type,isInField,isStarted,endSelection,endPosition){var startOffset=fieldBegin.line.getOffset(fieldBegin,0);var endOffset=startOffset+fieldBegin.length;if(endPosition.offset===endOffset){endPosition.setPositionParagraph(fieldBegin.line,startOffset);}if(!sf.base.isNullOrUndefined(fieldBegin.previousNode)){this.getPreviousWordOffset(fieldBegin.previousNode,selection,fieldBegin.previousNode.length,type,false,isStarted,endSelection,endPosition);if(endPosition.offset===startOffset){if(type!==0&&!sf.base.isNullOrUndefined(fieldBegin.fieldSeparator)){endPosition.setPositionParagraph(fieldBegin.line,fieldBegin.fieldSeparator.line.getOffset(fieldBegin.fieldSeparator,fieldBegin.fieldSeparator.length));}}}else{if(fieldBegin.fieldSeparator){endPosition.setPositionParagraph(fieldBegin.line,fieldBegin.fieldSeparator.line.getOffset(fieldBegin.fieldSeparator,fieldBegin.fieldSeparator.length));}else{endPosition.setPositionParagraph(fieldBegin.line,selection.getStartLineOffset(fieldBegin.line));}}};TextPosition.prototype.getPreviousWordOffsetImage=function(image,selection,indexInInline,type,isInField,isStarted,endSelection,endPosition){if(isInField){endPosition.setPositionParagraph(image.line,image.line.getOffset(image,indexInInline));endSelection=false;return;}if(indexInInline===image.length){var endOffset=image.line.getOffset(image,image.length);if(endOffset===endPosition.offset){endPosition.setPositionParagraph(image.line,endOffset-image.length);}else{endPosition.setPositionParagraph(image.line,endOffset);}}else if(!sf.base.isNullOrUndefined(image.previousNode)){this.getPreviousWordOffset(image.previousNode,selection,image.previousNode.length,type,isInField,isStarted,endSelection,endPosition);}};TextPosition.prototype.getPreviousWordOffsetSpan=function(span,selection,indexInInline,type,isInField,isStarted,endSelection,endPosition){if(span.text==='\t'||span.text==='\v'){if(isInField){endSelection=false;return;}if(indexInInline===span.length){endSelection=true;var endOffset=span.line.getOffset(span,span.length);if(endOffset===endPosition.offset){endPosition.setPositionParagraph(span.line,endOffset-span.length);}else{endPosition.setPositionParagraph(span.line,endOffset);}}else if(!sf.base.isNullOrUndefined(span.previousNode)){this.getPreviousWordOffset(span.previousNode,selection,span.previousNode.length,type,isInField,isStarted,endSelection,endPosition);}}else{var wordStartIndex=0;if(!isStarted){while(indexInInline>0&&span.text[indexInInline-1]===' '){indexInInline--;}endPosition.setPositionParagraph(span.line,span.line.getOffset(span,indexInInline));}if(indexInInline>0){isStarted=true;if(indexInInline===0&&endSelection&&HelperMethods.wordSplitCharacters.indexOf(span.text[0])===-1){endPosition.setPositionParagraph(span.line,span.line.getOffset(span,indexInInline));endSelection=true;return;}var txt=span.text.length>indexInInline?span.text.slice(0,indexInInline):span.text;wordStartIndex=HelperMethods.lastIndexOfAny(txt,HelperMethods.wordSplitCharacters);if(wordStartIndex===-1&&span.previousElement instanceof CommentCharacterElementBox&&sf.base.isNullOrUndefined(span.previousNode.previousNode)){wordStartIndex=span.length;}if(wordStartIndex!==-1){if(isInField){endSelection=false;return;}while(wordStartIndex>0&&endSelection&&txt[wordStartIndex]!==' '&&HelperMethods.wordSplitCharacters.indexOf(txt[wordStartIndex-1])!==-1){wordStartIndex--;}if(txt[wordStartIndex]===' '||txt[wordStartIndex]===''||!endSelection){wordStartIndex++;}endSelection=true;if(wordStartIndex>0){var offset=span.line.getOffset(span,wordStartIndex);if(span.line.paragraph===endPosition.paragraph&&offset===endPosition.offset){this.getPreviousWordOffsetSpan(span,selection,indexInInline,type,isInField,isStarted,endSelection,endPosition);}else{endPosition.setPositionParagraph(span.line,offset);}}else if(span.previousNode instanceof TextElementBox){this.getPreviousWordOffset(span.previousNode,selection,span.previousNode.length,type,isInField,isStarted,endSelection,endPosition);}else{endPosition.setPositionParagraph(span.line,span.line.getOffset(span,0));}}else{this.setPreviousWordOffset(span,selection,indexInInline,type,isInField,isStarted,endSelection,endPosition);}}else{this.setPreviousWordOffset(span,selection,indexInInline,type,isInField,isStarted,endSelection,endPosition);}}};TextPosition.prototype.setPreviousWordOffset=function(span,selection,indexInInline,type,isInField,isStarted,endSelection,endPosition){if(span.previousNode instanceof ElementBox&&span.line===span.previousNode.line){this.getPreviousWordOffset(span.previousNode,selection,span.previousNode.length,type,isInField,isStarted,endSelection,endPosition);}else{endPosition.setPositionParagraph(span.line,selection.getStartLineOffset(span.line));}};/**
     * Validate if text position is in field forward
     *
     * @private
     */TextPosition.prototype.validateForwardFieldSelection=function(currentIndex,selectionEndIndex){var textPosition=new TextPosition(this.owner);textPosition.setPositionForCurrentIndex(currentIndex);textPosition.isUpdateLocation=false;var isPositionMoved=false;if(this.selection.start.paragraph!==this.selection.end.paragraph||this.selection.start.offset===this.selection.getStartOffset(this.selection.start.paragraph)){// To select Paragraph mark similar to MS WORD
if(this.selection.end.offset===this.selection.end.currentWidget.getEndOffset()&&this.selection.isParagraphLastLine(this.selection.end.currentWidget)){this.selection.end.setPositionParagraph(this.selection.end.currentWidget,this.selection.end.offset+1);}}while(currentIndex!==selectionEndIndex&&TextPosition.isForwardSelection(currentIndex,selectionEndIndex)){if(!isPositionMoved){textPosition.moveNextPosition(false);var nextIndex=textPosition.getHierarchicalIndexInternal();//Handled specifically to break infinite looping, if selection ends at last paragraph mark.
if(currentIndex===nextIndex){break;}}var indexInInline=0;var inlineObj=textPosition.currentWidget.getInline(textPosition.offset,indexInInline);var inline=inlineObj.element;indexInInline=inlineObj.index;if(!sf.base.isNullOrUndefined(inline)){var selectionStartIndex=this.selection.start.getHierarchicalIndexInternal();if(indexInInline===inline.length&&inline instanceof FieldElementBox&&inline.fieldType===1){if(inline.line.getOffset(inline,0)===this.offset){return;}var lineWidget=inline.fieldBegin.line;var fieldBeginOffset=lineWidget.getOffset(inline.fieldBegin,0);var fieldBeginIndex=this.getHierarchicalIndex(lineWidget,fieldBeginOffset.toString());if(!TextPosition.isForwardSelection(selectionStartIndex,fieldBeginIndex)){this.selection.start.setPositionParagraph(lineWidget,fieldBeginOffset);}}var nextInline=this.selection.getNextRenderedElementBox(inline,indexInInline);if(!sf.base.isNullOrUndefined(nextInline)&&nextInline instanceof ElementBox){inline=nextInline;}}isPositionMoved=inline instanceof FieldElementBox&&inline.fieldType===0&&!sf.base.isNullOrUndefined(inline.fieldEnd);if(isPositionMoved){if(inline.line.getOffset(inline,0)===this.offset){return;}var fieldEnd=inline.fieldEnd;var paragraph=fieldEnd.line.paragraph;var fieldEndOffset=fieldEnd.line.getOffset(fieldEnd,1);var fieldEndIndex=this.getHierarchicalIndex(fieldEnd.line,fieldEndOffset.toString());if(!TextPosition.isForwardSelection(fieldEndIndex,selectionEndIndex)){//If selection end is after field begin, extend selection end to field end.
this.moveToInline(inline.fieldEnd,1);return;}textPosition.moveToInline(inline.fieldEnd,1);}currentIndex=textPosition.getHierarchicalIndexInternal();}};/**
     * Validate if text position is in field backward
     *
     * @private
     */TextPosition.prototype.validateBackwardFieldSelection=function(currentIndex,selectionEndIndex){var textPosition=new TextPosition(this.owner);textPosition.setPositionForCurrentIndex(currentIndex);textPosition.isUpdateLocation=false;var isSelectParaMark=false;if(this.selection.start.paragraph!==this.selection.end.paragraph&&this.selection.end.offset!==this.selection.getStartOffset(this.selection.start.paragraph)||this.documentHelper.isSelectionChangedOnMouseMoved&&this.selection.isParagraphFirstLine(this.selection.end.currentWidget)&&this.selection.end.offset===this.selection.getStartOffset(this.selection.start.paragraph)){isSelectParaMark=true;}// To select Paragraph mark similar to MS WORD
if(isSelectParaMark&&this.selection.start.offset===this.selection.start.currentWidget.getEndOffset()&&this.selection.isParagraphLastLine(this.selection.start.currentWidget)){this.selection.start.setPositionParagraph(this.selection.start.currentWidget,this.selection.start.offset+1);}var selectionStartIndex=this.selection.start.getHierarchicalIndexInternal();while(currentIndex!==selectionEndIndex&&TextPosition.isForwardSelection(selectionEndIndex,currentIndex)){var indexInInline=0;var inlineObj=textPosition.currentWidget.getInline(textPosition.offset,indexInInline);var inline=inlineObj.element;indexInInline=inlineObj.index;if(!sf.base.isNullOrUndefined(inline)){var nextInline=this.selection.getNextRenderedElementBox(inline,indexInInline);if(nextInline instanceof FieldElementBox&&nextInline.fieldType===0){var paragraph=nextInline.fieldEnd.line;var fieldEndOffset=paragraph.getOffset(nextInline.fieldEnd,1);var fieldEndIndex=this.getHierarchicalIndex(paragraph,fieldEndOffset.toString());if(!TextPosition.isForwardSelection(fieldEndIndex,selectionStartIndex)){this.selection.start.setPositionParagraph(paragraph,fieldEndOffset);selectionStartIndex=fieldEndIndex;}}}if(inline instanceof FieldElementBox&&inline.fieldType===1&&!sf.base.isNullOrUndefined(inline.fieldBegin)){var line=inline.fieldBegin.line;var fieldBegin=inline.fieldBegin;var fieldBeginOffset=line.getOffset(fieldBegin,0);var fieldBeginIndex=this.getHierarchicalIndex(line,fieldBeginOffset.toString());if(!TextPosition.isForwardSelection(selectionEndIndex,fieldBeginIndex)){//If field begin is before selection end, extend selection end to field begin.
this.moveToInline(inline.fieldBegin,0);return;}textPosition.moveToInline(inline.fieldBegin,0);}else{textPosition.movePreviousPosition();}currentIndex=textPosition.getHierarchicalIndexInternal();}};/**
     * @private
     */TextPosition.prototype.paragraphStartInternal=function(selection,moveToPreviousParagraph){var offset=selection.getStartLineOffset(this.currentWidget);if(this.offset===offset&&moveToPreviousParagraph){var startParagraph=this.moveToNextParagraphInTableCheck();if(startParagraph){this.moveToPreviousParagraphInTable(selection);}else if(!sf.base.isNullOrUndefined(selection.getPreviousParagraphBlock(this.currentWidget.paragraph))){var paragraphValue=selection.getPreviousParagraphBlock(this.currentWidget.paragraph);this.currentWidget=paragraphValue.childWidgets[0];this.offset=selection.getStartLineOffset(this.currentWidget);}}else{this.currentWidget=this.currentWidget.paragraph.getSplitWidgets()[0].childWidgets[0];this.offset=offset;}this.calculateOffset();};/**
     * @private
     */TextPosition.prototype.calculateOffset=function(){var selectionStartIndex=this.owner.selection.start.getHierarchicalIndexInternal();var selectionEndIndex=this.getHierarchicalIndexInternal();if(selectionStartIndex!==selectionEndIndex){this.validateBackwardFieldSelection(selectionStartIndex,selectionEndIndex);}this.updatePhysicalPosition(true);};/**
     * Moves the text position to start of the paragraph.
     *
     * @private
     */TextPosition.prototype.moveToParagraphStartInternal=function(selection,moveToPreviousParagraph){var splittedParagraph=this.currentWidget.paragraph;while(splittedParagraph.previousSplitWidget){splittedParagraph=splittedParagraph.previousSplitWidget;}var startOffset=selection.getStartOffset(splittedParagraph);if(this.offset===startOffset&&moveToPreviousParagraph){var paragraphstart=this.moveToNextParagraphInTableCheck();if(paragraphstart){this.moveToPreviousParagraphInTable(selection);}else if(!sf.base.isNullOrUndefined(selection.getPreviousParagraphBlock(this.paragraph))){this.currentWidget=selection.getPreviousParagraphBlock(this.paragraph).firstChild;this.offset=selection.getStartOffset(this.paragraph);}}else{this.currentWidget=splittedParagraph.firstChild;this.offset=selection.getStartLineOffset(this.currentWidget);}var selectionStartIndex=this.owner.selection.start.getHierarchicalIndexInternal();var selectionEndIndex=this.getHierarchicalIndexInternal();if(selectionStartIndex!==selectionEndIndex){this.validateBackwardFieldSelection(selectionStartIndex,selectionEndIndex);}this.updatePhysicalPosition(false);};/**
     * Moves the text position to end of the paragraph.
     *
     * @private
     */TextPosition.prototype.moveToParagraphEndInternal=function(selection,moveToNextParagraph){var splittedParagraph=this.currentWidget.paragraph;while(splittedParagraph.nextSplitWidget){splittedParagraph=splittedParagraph.nextSplitWidget;}this.currentWidget=splittedParagraph.childWidgets[splittedParagraph.childWidgets.length-1];var endOffset=this.currentWidget.getEndOffset()+1;if(this.offset===endOffset&&moveToNextParagraph){var paragraphEnd=this.moveToNextParagraphInTableCheck();if(paragraphEnd){this.moveToNextParagraphInTable();}else if(!sf.base.isNullOrUndefined(selection.getNextParagraphBlock(this.currentWidget.paragraph))){var endParagraph=selection.getNextParagraphBlock(this.currentWidget.paragraph);this.currentWidget=endParagraph.childWidgets[endParagraph.childWidgets.length-1];this.offset=this.currentWidget.getEndOffset()+1;}}else{this.offset=endOffset;}this.calculateOffset();};/**
     * @private
     */TextPosition.prototype.moveUp=function(selection,left){var paragraph=this.currentWidget.paragraph;//Moves text position to start of line.
this.moveToLineStartInternal(selection,true);//Moves previous line starting.
this.movePreviousPosition();var prevLine=undefined;var currentParagraph=this.currentWidget.paragraph;if(paragraph.isInsideTable&&paragraph!==currentParagraph&&paragraph.associatedCell!==currentParagraph.associatedCell&&!sf.base.isNullOrUndefined(currentParagraph.associatedCell)&&paragraph.associatedCell.ownerRow===currentParagraph.associatedCell.ownerRow){var ownerRow=currentParagraph.associatedCell.ownerRow;if(ownerRow.previousRenderedWidget instanceof TableRowWidget){var cell=selection.getFirstCellInRegion(ownerRow.previousRenderedWidget,currentParagraph.associatedCell,left,true);var lastParagraph=selection.getLastParagraph(cell);this.setPosition(lastParagraph.childWidgets[lastParagraph.childWidgets.length-1],false);}else{var prevBlock=ownerRow.ownerTable.previousRenderedWidget;do{if(prevBlock instanceof TableWidget){prevBlock=selection.getLastBlockInLastCell(prevBlock);}}while(prevBlock instanceof TableWidget);if(prevBlock instanceof ParagraphWidget){this.setPosition(prevBlock.childWidgets[prevBlock.childWidgets.length-1],false);}}prevLine=selection.getLineWidgetParagraph(this.offset,this.currentWidget);}else{if(!paragraph.isInsideTable&&this.currentWidget.paragraph.isInsideTable){var cell=selection.getFirstCellInRegion(this.currentWidget.paragraph.associatedCell.ownerRow,this.currentWidget.paragraph.associatedCell,this.owner.selection.upDownSelectionLength,true);var lastParagraph=selection.getLastParagraph(cell);this.setPosition(lastParagraph.childWidgets[lastParagraph.childWidgets.length-1],false);}else if(paragraph.isInsideTable&&!sf.base.isNullOrUndefined(this.currentWidget.paragraph.associatedCell)&&paragraph.associatedCell.ownerRow.previousRenderedWidget!==paragraph.associatedCell.ownerRow.previousSplitWidget&&paragraph.associatedCell.ownerRow.previousRenderedWidget===this.currentWidget.paragraph.associatedCell.ownerRow){var cell=selection.getLastCellInRegion(this.currentWidget.paragraph.associatedCell.ownerRow,this.currentWidget.paragraph.associatedCell,this.owner.selection.upDownSelectionLength,true);var lastParagraph=selection.getLastParagraph(cell);this.setPosition(lastParagraph.childWidgets[lastParagraph.childWidgets.length-1],false);}prevLine=selection.getLineWidgetParagraph(this.offset,this.currentWidget);}//Moves till the Up/Down selection width.
var top=selection.getTop(prevLine);// Here, updating the left position when line widget end with page break
// to update cursor before page break
if(this.currentWidget.isEndsWithPageBreak&&this.offset===this.currentWidget.getEndOffset()-1){left=this.location.x;}selection.updateTextPositionWidget(prevLine,new Point(left,top),this,false);};/**
     * @private
     */TextPosition.prototype.moveDown=function(selection,left){//Moves text position to end of line.
var prevParagraph=this.currentWidget.paragraph;var currentLine=this.currentWidget;this.moveToLineEndInternal(selection,true);var length=this.selection.getParagraphLength(this.currentWidget.paragraph);if(this.offset>length){this.offset=length;}//Moves next line starting.
this.moveNextPosition();var nextLine=undefined;if(prevParagraph.isInsideTable&&prevParagraph!==this.currentWidget.paragraph&&prevParagraph.associatedCell!==this.currentWidget.paragraph.associatedCell&&!sf.base.isNullOrUndefined(this.currentWidget.paragraph.associatedCell)&&prevParagraph.associatedCell.ownerRow===this.currentWidget.paragraph.associatedCell.ownerRow){var ownerRow=this.currentWidget.paragraph.associatedCell.ownerRow;if(prevParagraph.isInsideTable&&this.currentWidget.paragraph.isInsideTable&&prevParagraph.associatedCell.cellFormat.rowSpan>1&&prevParagraph.associatedCell.cellFormat.rowSpan+prevParagraph.associatedCell.ownerRow.rowIndex===prevParagraph.associatedCell.ownerTable.childWidgets.length){//If the prevParagraph  owner cell is Verically merged upto the last row, then theposition moved to next column. the position moved to out of the current tabel so owner row is assigned to last row.
ownerRow=this.currentWidget.paragraph.associatedCell.ownerTable.childWidgets[this.currentWidget.paragraph.associatedCell.ownerTable.childWidgets.length-1];}if(ownerRow.nextRenderedWidget instanceof TableRowWidget){var cell=this.selection.getLastCellInRegion(ownerRow.nextRenderedWidget,this.currentWidget.paragraph.associatedCell,left,false);this.setPosition(this.selection.getFirstParagraph(cell).childWidgets[0],true);}else{var nextBlock=this.selection.getNextRenderedBlock(ownerRow.ownerTable);do{if(nextBlock instanceof TableWidget){nextBlock=this.selection.getFirstBlockInFirstCell(nextBlock);}}while(nextBlock instanceof TableWidget);if(nextBlock instanceof ParagraphWidget){this.setPosition(nextBlock.childWidgets[0],true);}}nextLine=selection.getLineWidgetParagraph(this.offset,this.currentWidget);}else{if(!prevParagraph.isInsideTable&&this.currentWidget.paragraph.isInsideTable){var cell=this.selection.getLastCellInRegion(this.currentWidget.paragraph.associatedCell.ownerRow,this.currentWidget.paragraph.associatedCell,this.owner.selection.upDownSelectionLength,false);this.setPosition(this.selection.getFirstParagraph(cell).childWidgets[0],true);}else if(prevParagraph.isInsideTable&&!sf.base.isNullOrUndefined(this.currentWidget.paragraph.associatedCell)&&prevParagraph.associatedCell.ownerRow.nextRenderedWidget!==prevParagraph.associatedCell.ownerRow.nextSplitWidget&&prevParagraph.associatedCell.ownerRow.nextRenderedWidget===this.currentWidget.paragraph.associatedCell.ownerRow){var cell=selection.getLastCellInRegion(this.currentWidget.paragraph.associatedCell.ownerRow,this.currentWidget.paragraph.associatedCell,this.owner.selection.upDownSelectionLength,true);this.setPosition(selection.getFirstParagraph(cell).childWidgets[0],false);}nextLine=selection.getLineWidgetParagraph(this.offset,this.currentWidget);}//Moves till the Up/Down selection width.
var top=this.selection.getTop(nextLine);if(nextLine!==currentLine){this.selection.updateTextPositionWidget(nextLine,new Point(left,top),this,false);}};/**
     * Moves the text position to start of the line.
     *
     * @private
     */TextPosition.prototype.moveToLineStartInternal=function(selection,moveToPreviousLine){if(this.location.x>this.viewer.clientActiveArea.right){this.offset=this.offset-1;}var currentLine=selection.getLineWidgetInternal(this.currentWidget,this.offset,moveToPreviousLine);var firstElement;var isParaBidi=this.currentWidget.paragraph.paragraphFormat.bidi;if(isParaBidi&&currentLine.children.length>0&&this.containsRtlText(currentLine)){firstElement=currentLine.children[currentLine.children.length-1];if(firstElement instanceof ListTextElementBox){firstElement=undefined;}}else{firstElement=selection.getFirstElementInternal(currentLine);}this.documentHelper.moveCaretPosition=1;var startOffset=selection.getStartOffset(this.currentWidget.paragraph);if(sf.base.isNullOrUndefined(firstElement)&&this.offset>startOffset){var index=0;var inlineObj=this.currentWidget.getInline(this.offset,index);var inline=inlineObj.element;index=inlineObj.index;if(inline instanceof TextElementBox&&inline.text!=='\v'){this.offset=startOffset;}}else if(!sf.base.isNullOrUndefined(firstElement)){var indexInInline=0;this.currentWidget=firstElement.line;this.offset=this.currentWidget.getOffset(firstElement,indexInInline);indexInInline=0;var inlineObj=this.currentWidget.getInline(this.offset,indexInInline);var inline=inlineObj.element;indexInInline=inlineObj.index;if(inline instanceof FieldElementBox){//Checks if field character is part of rendered field, otherwise moves to previous rendered content.
var prevInline=selection.getPreviousValidElement(inline);if(!sf.base.isNullOrUndefined(prevInline)){inline=prevInline;this.currentWidget=inline.line;this.offset=this.currentWidget.getOffset(inline,inline.length);if(inline instanceof FieldElementBox){this.offset--;}}}}this.updatePhysicalPosition(true);};/**
     * Check paragraph is inside table
     *
     * @private
     */TextPosition.prototype.moveToNextParagraphInTableCheck=function(){if((this.selection.start.paragraph.isInsideTable||this.paragraph.isInsideTable)&&(this.selection.start.paragraph.associatedCell!==this.paragraph.associatedCell||this.selection.isCellSelected(this.selection.start.paragraph.associatedCell,this.selection.start,this))){return true;}return false;};/**
     * Moves the text position to end of the word.
     *
     * @private
     */TextPosition.prototype.moveToWordEndInternal=function(type,excludeSpace){// type === 0 -------->CTRL+ARROW Navigation
// type === 1 -------->CTRL+SHIFT+ARROW Selection
// type === 2 -------->Double-tap Word Selection
var incrementValue=0;var endOffset=this.currentWidget.getEndOffset();if(this.selection.isParagraphFirstLine(this.currentWidget)){if(this.currentWidget.children[0]instanceof ListTextElementBox){incrementValue=1;}if(this.currentWidget.children[1]instanceof ListTextElementBox){incrementValue=2;}}if(this.offset+incrementValue===endOffset||this.offset===endOffset+1){if(this.offset===endOffset&&type!==0){this.setPositionParagraph(this.currentWidget,endOffset+1);}else{var nextParagraph=this.selection.getNextParagraphBlock(this.currentWidget.paragraph);if(sf.base.isNullOrUndefined(nextParagraph)){return;}this.currentWidget=nextParagraph.childWidgets[0];this.offset=this.selection.getStartLineOffset(this.currentWidget);if(type===1){var nextWord=this.moveToNextParagraphInTableCheck();if(nextWord){this.moveToNextParagraphInTable();}else{this.moveToWordEndInternal(type,excludeSpace);}}}}else{var indexInInline=0;var endSelection=false;var inlineObj=this.currentWidget.getInline(this.offset,indexInInline);var inline=inlineObj.element;indexInInline=inlineObj.index;this.getNextWordOffset(inline,indexInInline,type,false,endSelection,this,excludeSpace);}if(type!==0){var selectionStartIndex=this.owner.selection.start.getHierarchicalIndexInternal();var selectionEndIndex=this.getHierarchicalIndexInternal();if(selectionStartIndex!==selectionEndIndex){this.validateForwardFieldSelection(selectionStartIndex,selectionEndIndex);}}this.updatePhysicalPosition(true);};/**
     * move text position to next paragraph inside table
     *
     * @private
     */TextPosition.prototype.moveToNextParagraphInTable=function(){var paragraph=this.currentWidget.paragraph;var nextParagraph=paragraph.isInsideTable?this.selection.getNextSelectionCell(paragraph.associatedCell):this.selection.getNextParagraphBlock(paragraph);if(sf.base.isNullOrUndefined(nextParagraph)){return;}this.currentWidget=nextParagraph.childWidgets[nextParagraph.childWidgets.length-1];this.offset=this.currentWidget.getEndOffset()+1;};/**
     * Moves the text position to start of the previous paragraph.
     *
     */TextPosition.prototype.moveToPreviousParagraph=function(selection){var startOffset=selection.getStartOffset(this.currentWidget.paragraph);if(this.offset===startOffset&&!sf.base.isNullOrUndefined(selection.getPreviousParagraphBlock(this.currentWidget.paragraph))){var previousParagraph=selection.getPreviousParagraphBlock(this.currentWidget.paragraph);this.currentWidget=previousParagraph.childWidgets[0];this.offset=selection.getStartOffset(this.currentWidget.paragraph);}else{this.offset=selection.getStartOffset(this.currentWidget.paragraph);}this.updatePhysicalPosition(true);};/**
     * Move to previous line from current position
     *
     * @private
     */TextPosition.prototype.moveToPreviousLine=function(selection,left){var currentIndex=this.getHierarchicalIndexInternal();var currentLine=selection.getLineWidgetParagraph(this.offset,this.currentWidget);//Moves text position to start of line.
this.moveToLineStartInternal(selection,true);if(this.currentWidget.paragraph.isInsideTable){this.moveUpInTable(selection);}else{this.moveBackward();}var prevLine=selection.getLineWidgetParagraph(this.offset,this.currentWidget);var lineStart=selection.getLeft(prevLine);var lineWidth=selection.getWidth(prevLine,true);//Moves till the Up/Down selection width.
if(lineWidth+lineStart>=left&&currentLine!==prevLine){var top_1=selection.getTop(prevLine);var point=new Point(left,top_1);selection.updateTextPositionWidget(prevLine,point,this,true);}//Checks if the current position is between field result, then move to field begin.
var selectionEndIndex=this.getHierarchicalIndexInternal();this.validateBackwardFieldSelection(currentIndex,selectionEndIndex);};/**
     * @param {Selection} selection Specifies the selection
     * @param {boolean} moveToNextLine Specifies the move to next line
     * @private
     */TextPosition.prototype.moveToLineEndInternal=function(selection,moveToNextLine){if(this.location.x>this.viewer.clientActiveArea.right){this.offset=this.offset-1;}var currentLine=selection.getLineWidgetParagraph(this.offset,this.currentWidget);var firstElement=selection.getFirstElementInternal(currentLine);var isParaBidi=this.currentWidget.paragraph.paragraphFormat.bidi;this.documentHelper.moveCaretPosition=2;if(sf.base.isNullOrUndefined(firstElement)&&this.offset===selection.getStartLineOffset(this.currentWidget)){this.offset=selection.getParagraphLength(this.paragraph)+1;this.updatePhysicalPosition(true);}else if(!sf.base.isNullOrUndefined(firstElement)){var lastElement=void 0;// As per Microsoft Behavior, when current para is RTL and if line widget contains rtl text or mixed inlines(rtl, normal),
// then need to consider the last element and to update offset to last element
if(isParaBidi&&this.containsRtlText(currentLine)){var endOffset=currentLine.getEndOffset();lastElement=currentLine.getInline(endOffset,0).element;}else{lastElement=currentLine.children[currentLine.children.length-1];if(lastElement instanceof ListTextElementBox&&currentLine.children.length>2){lastElement=currentLine.children[currentLine.children.length-3];}}var index=0;index+=lastElement instanceof TextElementBox?lastElement.length:1;this.currentWidget=lastElement.line;if(index===lastElement.length&&sf.base.isNullOrUndefined(lastElement.nextNode)&&selection.isParagraphLastLine(this.currentWidget)){var length_1=selection.getLineLength(this.currentWidget);this.offset=moveToNextLine?length_1+1:length_1;}else{var inline=lastElement;while(!sf.base.isNullOrUndefined(inline)&&inline.length===index&&inline.nextNode instanceof FieldElementBox){var nextInline=selection.getNextValidElement(inline.nextNode);if(inline!==nextInline){inline=nextInline;index=0;}if(inline instanceof FieldElementBox&&inline.fieldType===0&&!sf.base.isNullOrUndefined(inline.fieldEnd)){var fieldBegin=inline;if(sf.base.isNullOrUndefined(fieldBegin.fieldSeparator)){inline=fieldBegin.fieldEnd;}else{inline=fieldBegin.fieldSeparator;this.currentWidget=inline.line;if(this.currentWidget===fieldBegin.fieldEnd.line&&!selection.hasValidInline(this.currentWidget.paragraph,inline,fieldBegin.fieldEnd)){inline=fieldBegin.fieldEnd;}}this.currentWidget=inline.line;}if(inline instanceof FieldElementBox){index=1;}}if(index===inline.length&&sf.base.isNullOrUndefined(inline.nextNode)){index++;}if(!moveToNextLine&&inline instanceof ElementBox&&inline.text==='\v'){index--;}this.offset=this.currentWidget.getOffset(inline,index);}this.updatePhysicalPosition(moveToNextLine);}};/**
     * Move to next line
     *
     * @param {number} left Specified the left
     * @private
     * @returns {void}
     */TextPosition.prototype.moveToNextLine=function(left){var selection=this.selection;var textPosition=new TextPosition(this.owner);textPosition.setPositionInternal(this);var currentIndex=this.getHierarchicalIndexInternal();var currentLine=selection.getLineWidgetParagraph(this.offset,this.currentWidget);var isAtLineStart=this.offset===0?true:false;//Moves text position to end of line.
this.moveToLineEndInternal(selection,true);var isMoveToLineEnd=!textPosition.isAtSamePosition(this);textPosition.setPositionInternal(this);if(this.currentWidget.paragraph.isInsideTable){this.moveDownInTable(selection);}else{this.moveNextPosition();this.moveForward();}var nextLine=selection.getLineWidgetParagraph(this.offset,this.currentWidget);var lineStart=selection.getLeft(nextLine);var firstElement=selection.getFirstElementInternal(nextLine);var firstItemWidth=sf.base.isNullOrUndefined(firstElement)?selection.getWidth(nextLine,true):selection.getLeftInternal(nextLine,firstElement,1)-lineStart;//Moves till the Up/Down selection width.
if(lineStart<left&&firstItemWidth/2<left-lineStart){var top_2=selection.getTop(nextLine);var point=new Point(left,top_2);selection.updateTextPositionWidget(nextLine,point,this,true);var width=selection.getWidth(nextLine,true);if(width<left-lineStart){this.moveToLineEndInternal(selection,true);}}else if(isMoveToLineEnd&&this.currentWidget.paragraph.isInsideTable&&this.currentWidget===this.owner.selection.start.currentWidget){this.setPositionInternal(textPosition);}else if(!isMoveToLineEnd){this.moveToLineEndInternal(selection,true);}//Checks if the current position is between field result, then move to field end.
var selectionEndIndex=this.getHierarchicalIndexInternal();this.validateForwardFieldSelection(currentIndex,selectionEndIndex);};TextPosition.prototype.moveUpInTable=function(selection){var isPositionUpdated=false;var end=this.owner.selection.end;var isBackwardSelection=!this.owner.selection.isEmpty;isPositionUpdated=end.paragraph.isInsideTable;if(isPositionUpdated){var startCell=this.currentWidget.paragraph.associatedCell;var endCell=end.paragraph.associatedCell;var containerCell=selection.getContainerCellOf(endCell,startCell);isPositionUpdated=containerCell.ownerTable.contains(startCell);if(isPositionUpdated){endCell=selection.getSelectedCell(endCell,containerCell);startCell=selection.getSelectedCell(startCell,containerCell);var isInContainerCell=selection.containsCell(containerCell,this.currentWidget.paragraph.associatedCell);var isContainerCellSelected=selection.isCellSelected(containerCell,this,end);if(!isContainerCellSelected){isContainerCellSelected=this.currentWidget.paragraph===selection.getFirstParagraph(containerCell)&&this.isAtParagraphStart;}if((isInContainerCell&&isContainerCellSelected||!isInContainerCell)&&!sf.base.isNullOrUndefined(startCell.ownerRow.previousRenderedWidget)){//Moves to cell in previous row.
var row=startCell.ownerRow.previousRenderedWidget;var cell=selection.getFirstCellInRegion(row,containerCell,this.owner.selection.upDownSelectionLength,true);var previousParagraph=selection.getLastParagraph(cell);this.setPosition(previousParagraph.childWidgets[0],true);return;}else if(isInContainerCell&&isContainerCellSelected&&sf.base.isNullOrUndefined(startCell.ownerRow.previousRenderedWidget)||!isInContainerCell){if(isBackwardSelection){//Moves to first cell of row.
startCell=startCell.ownerRow.childWidgets[0];var previousParagraph=selection.getFirstParagraph(startCell);this.setPosition(previousParagraph.childWidgets[0],true);}else{//Moves to last cell of row.
startCell=startCell.ownerRow.childWidgets[startCell.ownerRow.childWidgets.length-1];var previousParagraph=selection.getLastParagraph(startCell);this.setPosition(previousParagraph.childWidgets[0],false);}}}}if(!isPositionUpdated){//Moves to previous row / previous block.
var cell=selection.getContainerCell(this.currentWidget.paragraph.associatedCell);if(isBackwardSelection){//Moves to first cell of row.
cell=cell.ownerRow.childWidgets[0];var previousParagraph=selection.getFirstParagraph(cell);this.setPosition(previousParagraph.childWidgets[0],true);}else{//Moves to end of row.
cell=cell.ownerRow.childWidgets[cell.ownerRow.childWidgets.length-1];var previousParagraph=selection.getLastParagraph(cell);this.setPosition(previousParagraph.childWidgets[0],false);}}//Moves to previous row / previous block.
this.moveBackward();};TextPosition.prototype.moveDownInTable=function(selection){var isPositionUpdated=false;var isForwardSelection=this.owner.selection.isEmpty||this.owner.selection.isForward;isPositionUpdated=this.owner.selection.start.paragraph.isInsideTable;if(isPositionUpdated){var startCell=this.owner.selection.start.paragraph.associatedCell;var endCell=this.currentWidget.paragraph.associatedCell;var containerCell=selection.getContainerCellOf(startCell,endCell);isPositionUpdated=containerCell.ownerTable.contains(endCell);if(isPositionUpdated){startCell=selection.getSelectedCell(startCell,containerCell);endCell=selection.getSelectedCell(endCell,containerCell);var isInContainerCell=selection.containsCell(containerCell,this.currentWidget.paragraph.associatedCell);var isContainerCellSelected=selection.isCellSelected(containerCell,this.owner.selection.start,this);if((isInContainerCell&&isContainerCellSelected||!isInContainerCell)&&!sf.base.isNullOrUndefined(endCell.ownerRow.nextRenderedWidget)){//Moves to cell in next row.
var row=endCell.ownerRow.nextRenderedWidget;var cell=selection.getLastCellInRegion(row,containerCell,this.owner.selection.upDownSelectionLength,false);var lastParagraph=selection.getLastParagraph(cell);this.setPosition(lastParagraph.childWidgets[lastParagraph.childWidgets.length-1],false);return;}else if(isInContainerCell&&isContainerCellSelected&&sf.base.isNullOrUndefined(endCell.ownerRow.nextRenderedWidget)||!isInContainerCell){if(isForwardSelection){//Moves to last cell of row.
endCell=endCell.ownerRow.childWidgets[endCell.ownerRow.childWidgets.length-1];var lastParagraph=selection.getLastParagraph(endCell);this.setPosition(lastParagraph.childWidgets[lastParagraph.childWidgets.length-1],false);}else{//Moves to first cell of row.
endCell=endCell.ownerRow.childWidgets[0];var lastParagraph=selection.getFirstParagraph(endCell);this.setPosition(lastParagraph.childWidgets[lastParagraph.childWidgets.length-1],true);}}}}if(!isPositionUpdated){//Moves to next row / next block.
var cell=selection.getContainerCell(this.currentWidget.paragraph.associatedCell);if(isForwardSelection){//Moves to end of row.
cell=cell.ownerRow.childWidgets[cell.ownerRow.childWidgets.length-1];var lastParagraph=selection.getLastParagraph(cell);this.setPosition(lastParagraph.childWidgets[lastParagraph.childWidgets.length-1],false);}else if(cell.ownerRow.nextRenderedWidget){//Moves to first cell of row.
cell=cell.ownerRow.nextRenderedWidget.childWidgets[0];var lastParagraph=selection.getFirstParagraph(cell);this.setPosition(lastParagraph.childWidgets[lastParagraph.childWidgets.length-1],true);}}//Moves to next row / next block.
this.moveForward();};/**
     * @private
     * @returns {void}
     */TextPosition.prototype.destroy=function(){this.offset=undefined;this.isUpdateLocation=undefined;if(!sf.base.isNullOrUndefined(this.location)){this.location.destroy();}this.location=undefined;this.currentWidget=undefined;this.owner=undefined;this.documentHelper=undefined;};return TextPosition;}();/**
 * @private
 */var SelectionWidgetInfo=/** @class */function(){function SelectionWidgetInfo(left,width){this.leftIn=0;this.widthIn=0;this.color='';this.leftIn=left;this.widthIn=width;}Object.defineProperty(SelectionWidgetInfo.prototype,"left",{/**
         * @private
         */get:function get(){return this.leftIn;},/**
         * @private
         */set:function set(value){this.leftIn=value;},enumerable:true,configurable:true});Object.defineProperty(SelectionWidgetInfo.prototype,"width",{/**
         * @private
         */get:function get(){return this.widthIn;},/**
         * @private
         */set:function set(value){this.widthIn=value;},enumerable:true,configurable:true});/**
     * @private
     */SelectionWidgetInfo.prototype.destroy=function(){this.widthIn=undefined;this.leftIn=undefined;this.floatingItems=[];this.floatingItems=undefined;};return SelectionWidgetInfo;}();/**
 * @private
 */var Hyperlink=/** @class */function(){function Hyperlink(fieldBeginAdv,selection){this.linkInternal='';this.localRef='';this.opensNewWindow=false;this.isCrossRefField=false;var fieldCode=selection.getFieldCode(fieldBeginAdv);var lowercase=fieldCode.toLowerCase();if(lowercase.substring(0,9)==='hyperlink'){this.parseFieldValues(fieldCode.substring(9).trim(),true);}else if(lowercase.indexOf('ref ')===0&&lowercase.match('\\h')){this.parseFieldValues(fieldCode.substring(4).trim(),false);this.isCrossRefField=true;}}Object.defineProperty(Hyperlink.prototype,"navigationLink",{/**
         * Gets navigation link.
         *
         * @returns string
         * @private
         */get:function get(){return this.linkInternal;},enumerable:true,configurable:true});Object.defineProperty(Hyperlink.prototype,"localReference",{/**
         * Gets the local reference if any.
         *
         * @returns string
         * @private
         */get:function get(){return this.localRef;},enumerable:true,configurable:true});Object.defineProperty(Hyperlink.prototype,"linkType",{/**
         * Gets hyper link type.
         *
         * @returns HyperLinkType
         * @private
         */get:function get(){return this.typeInternal;},enumerable:true,configurable:true});Object.defineProperty(Hyperlink.prototype,"isCrossRef",{/**
         * @private
         */get:function get(){return this.isCrossRefField;},enumerable:true,configurable:true});Hyperlink.prototype.parseFieldValues=function(value,isHyperlink){var codes=value.split(' ');var isLocalRef=false;if(isHyperlink){for(var i=0;i<codes.length;i++){var code=codes[i];if(code.length<1){continue;}if(code==='\\t'||code==='\\l'){isLocalRef=true;}else if(code==='\\n'){this.opensNewWindow=true;}else{code=this.parseFieldValue(code,code[0]==='\"'?'\"':undefined,isHyperlink);if(isLocalRef){this.localRef=code;isLocalRef=false;}else{this.linkInternal=code;}}}}else{this.localRef=codes[0];}this.setLinkType();};Hyperlink.prototype.parseFieldValue=function(value,endChar,isHyperlink){value=isHyperlink?value.substring(1):value.substring(0);var endIndex=endChar?value.indexOf(endChar):-1;if(endIndex<0){endIndex=value.length;}return value.substring(0,endIndex).trim();};Hyperlink.prototype.setLinkType=function(){// If only local reference.
if(sf.base.isNullOrUndefined(this.linkInternal)||this.linkInternal.length<1){this.typeInternal='Bookmark';return;}// Validates link.
if(this.linkInternal.substring(0,4)==='www.'){this.linkInternal='http://'+this.navigationLink;}else if(this.linkInternal[0]==='@'){this.linkInternal='mailto:'+this.navigationLink;}// Finds proper link type.
if(this.linkInternal.substring(0,7)==='http://'||this.linkInternal.substring(0,8)==='https://'){this.typeInternal='WebPage';}else if(this.linkInternal.substring(0,7)==='mailto:'){this.typeInternal='Email';}else{this.typeInternal='File';}};/**
     * @private
     */Hyperlink.prototype.destroy=function(){this.linkInternal=undefined;this.localRef=undefined;this.typeInternal=undefined;this.opensNewWindow=undefined;};return Hyperlink;}();/**
 * @private
 */var ImageInfo=/** @class */function(){/**
     * Constructor for image format class
     *
     * @param imageContainer - Specifies for image width and height values.
     */function ImageInfo(imageContainer){/**
         * @private
         */this.width=0;/**
         * @private
         */this.height=0;this.width=imageContainer.width;this.height=imageContainer.height;}/**
     * Dispose the internal objects which are maintained.
     *
     * @private
     */ImageInfo.prototype.destroy=function(){this.width=undefined;this.height=undefined;};return ImageInfo;}();/* eslint-disable */ /**
 * Selection
 */var Selection=/** @class */function(){/**
     * @param documentEditor
     * @private
     */function Selection(documentEditor){var _this=this;/**
         * @private
         */this.upDownSelectionLength=0;/**
         * @private
         */this.isSkipLayouting=false;/**
         * @private
         */this.isImageSelected=false;this.contextTypeInternal=undefined;/**
         * @private
         */this.caret=undefined;//Format Retrieval Field
/**
         * @private
         */this.isRetrieveFormatting=false;/**
         * @private
         */this.skipFormatRetrieval=false;this.isMoveDownOrMoveUp=false;/**
         * @private
         */this.isViewPasteOptions=false;/**
         * @private
         */this.skipEditRangeRetrieval=false;/**
         * @private
         */this.selectedWidgets=undefined;/**
         * @private
         */this.isHighlightEditRegionIn=false;/**
         * @private
         */this.isHighlightFormFields=false;/**
         * @private
         */this.isHightlightEditRegionInternal=false;/**
         * @private
         */this.isCurrentUser=false;/**
         * @private
         */this.isHighlightNext=false;/**
         * @private
         */this.isWebLayout=false;/**
         * @private
         */this.editRegionHighlighters=undefined;/**
         * @private
         */this.formFieldHighlighters=undefined;this.isSelectList=false;/**
         * @private
         */this.previousSelectedFormField=undefined;/**
         * @private
         */this.isFormatUpdated=false;/**
         * @private
         */this.pasteOptions=function(format){if(format==='Keep source formatting'){_this.owner.editor.applyPasteOptions('KeepSourceFormatting');}else if(format==='Match destination formatting'){_this.owner.editor.applyPasteOptions('MergeWithExistingFormatting');}else{_this.owner.editor.previousParaFormat=undefined;_this.owner.editor.applyPasteOptions('KeepTextOnly');}};/**
         * Hides caret.
         *
         * @private
         * @returns {void}
         */this.hideCaret=function(){if(!sf.base.isNullOrUndefined(_this.caret)){_this.caret.style.display='none';}};this.owner=documentEditor;this.documentHelper=this.owner.documentHelper;this.start=new TextPosition(this.owner);this.end=new TextPosition(this.owner);this.selectedWidgets=new Dictionary();this.characterFormatIn=new SelectionCharacterFormat(this);this.paragraphFormatIn=new SelectionParagraphFormat(this,this.documentHelper);this.sectionFormatIn=new SelectionSectionFormat(this);this.rowFormatIn=new SelectionRowFormat(this);this.cellFormatIn=new SelectionCellFormat(this);this.tableFormatIn=new SelectionTableFormat(this);this.imageFormatInternal=new SelectionImageFormat(this);this.editRangeCollection=[];this.editRegionHighlighters=new Dictionary();this.formFieldHighlighters=new Dictionary();}Object.defineProperty(Selection.prototype,"isHighlightEditRegion",{/**
         * @private
         * @returns {boolean} - Retuens true if highlighting editing region
         */get:function get(){return this.isHighlightEditRegionIn;},/**
         * @private
         */set:function set(value){this.isHighlightEditRegionIn=value;this.onHighlight();},enumerable:true,configurable:true});Object.defineProperty(Selection.prototype,"htmlWriter",{/**
         * @private
         */get:function get(){if(sf.base.isNullOrUndefined(this.htmlWriterIn)){this.htmlWriterIn=new HtmlExport();}return this.htmlWriterIn;},enumerable:true,configurable:true});Object.defineProperty(Selection.prototype,"start",{/**
         * Gets the start text position of last range in the selection
         *
         * @private
         * @returns {TextPosition} - Returns selection start position.
         */get:function get(){if(!sf.base.isNullOrUndefined(this.owner)&&!sf.base.isNullOrUndefined(this.viewer)){if(sf.base.isNullOrUndefined(this.startInternal)){this.startInternal=this.owner.documentStart;}return this.startInternal;}return undefined;},/**
         * @private
         */set:function set(value){this.startInternal=value;},enumerable:true,configurable:true});Object.defineProperty(Selection.prototype,"characterFormat",{//Format retrieval properties
/**
         * Gets the instance of selection character format.
         *
         * @default undefined
         * @aspType SelectionCharacterFormat
         * @blazorType SelectionCharacterFormat
         * @returns {SelectionCharacterFormat} - Returns selection character format.
         */get:function get(){return this.characterFormatIn;},enumerable:true,configurable:true});Object.defineProperty(Selection.prototype,"paragraphFormat",{/**
         * Gets the instance of selection paragraph format.
         *
         * @default undefined
         * @aspType SelectionParagraphFormat
         * @blazorType SelectionParagraphFormat
         * @returns {SelectionParagraphFormat} - Returns selection paragraph format.
         */get:function get(){return this.paragraphFormatIn;},enumerable:true,configurable:true});Object.defineProperty(Selection.prototype,"sectionFormat",{/**
         * Gets the instance of selection section format.
         *
         * @default undefined
         * @aspType SelectionSectionFormat
         * @blazorType SelectionSectionFormat
         * @returns {SelectionSectionFormat} - Returns selection section format.
         */get:function get(){return this.sectionFormatIn;},enumerable:true,configurable:true});Object.defineProperty(Selection.prototype,"tableFormat",{/**
         * Gets the instance of selection table format.
         *
         * @default undefined
         * @aspType SelectionTableFormat
         * @blazorType SelectionTableFormat
         * @returns {SelectionTableFormat} - Returns selection table format.
         */get:function get(){return this.tableFormatIn;},enumerable:true,configurable:true});Object.defineProperty(Selection.prototype,"cellFormat",{/**
         * Gets the instance of selection cell format.
         *
         * @default undefined
         * @aspType SelectionCellFormat
         * @blazorType SelectionCellFormat
         * @returns {SelectionCellFormat} - Returns selection cell format.
         */get:function get(){return this.cellFormatIn;},enumerable:true,configurable:true});Object.defineProperty(Selection.prototype,"rowFormat",{/**
         * Gets the instance of selection row format.
         *
         * @default undefined
         * @aspType SelectionRowFormat
         * @blazorType SelectionRowFormat
         * @returns {SelectionRowFormat} - Returns selection row format.
         */get:function get(){return this.rowFormatIn;},enumerable:true,configurable:true});Object.defineProperty(Selection.prototype,"imageFormat",{/**
         * Gets the instance of selection image format.
         *
         * @default undefined
         * @aspType SelectionImageFormat
         * @blazorType SelectionImageFormat
         * @returns {SelectionImageFormat} - Returns selection image format.
         */get:function get(){return this.imageFormatInternal;},enumerable:true,configurable:true});Object.defineProperty(Selection.prototype,"end",{/**
         * Gets the start text position of selection range.
         *
         * @private
         * @returns {TextPosition} - Returns selection end position.
         */get:function get(){return this.endInternal;},/**
         * For internal use
         *
         * @private
         */set:function set(value){this.endInternal=value;},enumerable:true,configurable:true});Object.defineProperty(Selection.prototype,"startPage",{/**
         * Gets the page number where the selection starts.
         *
         * @returns {number} - Returns the selection start page number.
         */get:function get(){if(!this.owner.isDocumentLoaded||sf.base.isNullOrUndefined(this.viewer)||this.viewer instanceof WebLayoutViewer||sf.base.isNullOrUndefined(this.documentHelper.selectionStartPage)){return 1;}return this.documentHelper.pages.indexOf(this.documentHelper.selectionStartPage)+1;},enumerable:true,configurable:true});Object.defineProperty(Selection.prototype,"endPage",{/**
         * Gets the page number where the selection ends.
         *
         * @returns {number} - Returns the selection end page number.
         */get:function get(){if(!this.owner.isDocumentLoaded||sf.base.isNullOrUndefined(this.viewer)||this.viewer instanceof WebLayoutViewer||sf.base.isNullOrUndefined(this.documentHelper.selectionEndPage)){return 1;}return this.documentHelper.pages.indexOf(this.documentHelper.selectionEndPage)+1;},enumerable:true,configurable:true});Object.defineProperty(Selection.prototype,"isForward",{/**
         * Determines whether the selection direction is forward or not.
         *
         * @default false
         * @private
         * @returns {boolean} - Returns isForward
         */get:function get(){return this.start.isExistBefore(this.end);},enumerable:true,configurable:true});Object.defineProperty(Selection.prototype,"isinFootnote",{/**
         * Determines whether the selection is in footnote or not.
         *
         * @default false
         * @returns {boolean} - Returns true if selection is in footnote
         * @private
         */get:function get(){var container=this.getContainerWidget(this.start.paragraph);if(container instanceof FootNoteWidget&&container.footNoteType==='Footnote'){return true;}else{return false;}},enumerable:true,configurable:true});Object.defineProperty(Selection.prototype,"isinEndnote",{/**
         * Determines whether the selection is in endnote or not.
         *
         * @default false
         * @returns {boolean}
         * @private
         */get:function get(){var container=this.getContainerWidget(this.start.paragraph);if(container instanceof FootNoteWidget&&container.footNoteType==='Endnote'){return true;}else{return false;}},enumerable:true,configurable:true});Object.defineProperty(Selection.prototype,"isEmpty",{/**
         * Determines whether the start and end positions are same or not.
         *
         * @default false
         * @returns {boolean}
         * @private
         */get:function get(){if(sf.base.isNullOrUndefined(this.start)){return true;}return this.start.isAtSamePosition(this.end);},enumerable:true,configurable:true});Object.defineProperty(Selection.prototype,"startOffset",{/**
         * Returns start hierarchical index.
         */get:function get(){return this.getHierarchicalIndexByPosition(this.start);},enumerable:true,configurable:true});Object.defineProperty(Selection.prototype,"endOffset",{/**
         * Returns end hierarchical index.
         */get:function get(){return this.getHierarchicalIndexByPosition(this.end);},enumerable:true,configurable:true});Object.defineProperty(Selection.prototype,"isInShape",{/**
         * @private
         */get:function get(){var container=this.start.paragraph.containerWidget;do{if(container instanceof TextFrame){return true;}if(container){container=container.containerWidget;}}while(container);return false;},enumerable:true,configurable:true});Object.defineProperty(Selection.prototype,"text",{/**
         * Gets the text within selection.
         *
         * @default ''
         * @aspType string
         * @blazorType string
         * @returns {string}
         */get:function get(){return this.getText(false);},enumerable:true,configurable:true});Object.defineProperty(Selection.prototype,"contextType",{/**
         * Gets the context type of the selection.
         */get:function get(){return this.contextTypeInternal;},enumerable:true,configurable:true});Object.defineProperty(Selection.prototype,"bookmarks",{/**
         * Gets bookmark name collection.
         */get:function get(){return this.getSelBookmarks(false);},enumerable:true,configurable:true});/**
     * Gets the bookmark name collection in current selection
     *
     * @param includeHidden - Decide whether to include hidden bookmark name in current selection or not.
     */Selection.prototype.getBookmarks=function(includeHidden){return this.getSelBookmarks(includeHidden);};Object.defineProperty(Selection.prototype,"isCleared",{/**
         * @private
         */get:function get(){return sf.base.isNullOrUndefined(this.end);},enumerable:true,configurable:true});Object.defineProperty(Selection.prototype,"isInField",{/**
         * Returns true if selection is in field
         */get:function get(){if(!sf.base.isNullOrUndefined(this.getHyperlinkField(true))){return true;}return false;},enumerable:true,configurable:true});Selection.prototype.getSelBookmarks=function(includeHidden){var bookmarkCln=[];var bookmarks=this.documentHelper.bookmarks;var start=this.start;var end=this.end;if(!this.isForward){start=this.end;end=this.start;}var bookmrkStart;var bookmrkEnd;var isCellSelected=false;var selectedCells=this.getSelectedCells();for(var i=0;i<bookmarks.length;i++){if(includeHidden||!includeHidden&&bookmarks.keys[i].indexOf('_')!==0){bookmrkStart=bookmarks.get(bookmarks.keys[i]);bookmrkEnd=bookmrkStart.reference;if(sf.base.isNullOrUndefined(bookmrkEnd)){continue;}var bmStartPos=this.getElementPosition(bookmrkStart).startPosition;var bmEndPos=this.getElementPosition(bookmrkEnd,true).startPosition;if(bmStartPos.paragraph.isInsideTable||bmEndPos.paragraph.isInsideTable){if(selectedCells.length>0){if(selectedCells.indexOf(bmStartPos.paragraph.associatedCell)>=0||selectedCells.indexOf(bmEndPos.paragraph.associatedCell)>=0){isCellSelected=true;}else{isCellSelected=false;if(selectedCells.indexOf(bmStartPos.paragraph.associatedCell)<0||selectedCells.indexOf(bmEndPos.paragraph.associatedCell)<0){var endCell=end.paragraph.isInsideTable&&end.paragraph.associatedCell;var bmEndPosCell=bmEndPos.paragraph.associatedCell;if(endCell&&bmEndPosCell&&endCell.ownerTable.equals(bmEndPosCell.ownerTable)&&!(endCell.ownerTable&&selectedCells.indexOf(this.getCellInTable(endCell.ownerTable,bmEndPosCell))>=0)){continue;}}}}else{isCellSelected=false;}}else{isCellSelected=false;}if((start.isExistAfter(bmStartPos)||start.isAtSamePosition(bmStartPos))&&(end.isExistBefore(bmEndPos)||end.isAtSamePosition(bmEndPos))||(bmStartPos.isExistAfter(start)||bmStartPos.isAtSamePosition(start))&&(bmEndPos.isExistBefore(end)||bmEndPos.isAtSamePosition(end))||bmStartPos.isExistAfter(start)&&bmStartPos.isExistBefore(end)&&(end.isExistAfter(bmEndPos)||end.isExistBefore(bmEndPos))||bmEndPos.isExistBefore(end)&&bmEndPos.isExistAfter(start)&&(start.isExistBefore(bmStartPos)||start.isExistAfter(bmStartPos))||isCellSelected){bookmarkCln.push(bookmrkStart.name);}}}return bookmarkCln;};Object.defineProperty(Selection.prototype,"viewer",{get:function get(){return this.owner.viewer;},enumerable:true,configurable:true});Selection.prototype.getModuleName=function(){return'Selection';};Selection.prototype.checkLayout=function(){if(this.owner.layoutType==='Continuous'){this.isWebLayout=true;this.documentHelper.isHeaderFooter=true;this.owner.layoutType='Pages';this.owner.viewer.destroy();this.owner.viewer=new PageLayoutViewer(this.owner);this.owner.editor.layoutWholeDocument();}};//Public API
/**
     * Moves the selection to the header of current page.
     *
     * @returns {void}
     */Selection.prototype.goToHeader=function(){this.checkLayout();this.owner.enableHeaderAndFooter=true;this.enableHeadersFootersRegion(this.start.paragraph.bodyWidget.page.headerWidget);this.isWebLayout=false;};/**
     * Moves the selection to the footer of current page.
     *
     * @returns {void}
     */Selection.prototype.goToFooter=function(){this.checkLayout();this.owner.enableHeaderAndFooter=true;this.enableHeadersFootersRegion(this.start.paragraph.bodyWidget.page.footerWidget);this.isWebLayout=false;};/**
     * Closes the header and footer region.
     *
     * @returns {void}
     */Selection.prototype.closeHeaderFooter=function(){this.disableHeaderFooter();if(this.documentHelper.isHeaderFooter&&this.owner.layoutType==='Pages'){this.owner.layoutType='Continuous';this.documentHelper.isHeaderFooter=false;}};/**
     * Moves the selection to the start of specified page number.
     *
     * @param pageNumber
     * @returns {void}
     */Selection.prototype.goToPage=function(pageNumber){if(pageNumber>=1&&pageNumber<=this.owner.documentHelper.pages.length){var page=this.owner.documentHelper.pages[pageNumber-1];this.updateTextPositionForBlockContainer(page.bodyWidgets[0]);}};/**
     * Selects the entire table if the context is within table.
     *
     * @returns {void}
     */Selection.prototype.selectTable=function(){if(!this.owner.enableSelection){return;}this.selectTableInternal();};/**
     * Selects the entire row if the context is within table.
     *
     * @returns {void}
     */Selection.prototype.selectRow=function(){if(!this.owner.enableSelection){return;}this.selectTableRow();};/**
     * Selects the entire column if the context is within table.
     *
     * @returns {void}
     */Selection.prototype.selectColumn=function(){if(!this.owner.enableSelection){return;}this.selectColumnInternal();};/**
     * Selects the entire cell if the context is within table.
     *
     * @returns {void}
     */Selection.prototype.selectCell=function(){if(!this.owner.enableSelection){return;}this.selectTableCell();};Selection.prototype.select=function(selectionSettings,startOrEnd){if(typeof selectionSettings==='string'){var startPosition=this.getTextPosBasedOnLogicalIndex(selectionSettings);var endPosition=this.getTextPosBasedOnLogicalIndex(startOrEnd);this.selectPosition(startPosition,endPosition);}else{var point=new Point(selectionSettings.x,selectionSettings.y);var pageCoordinates=this.viewer.findFocusedPage(point,true);if(selectionSettings.extend){this.moveTextPosition(pageCoordinates,this.end);}else{this.documentHelper.updateTextPositionForSelection(pageCoordinates,1);}}};/**
     * Selects based on start and end hierarchical index.
     *
     * @param start
     * @param end
     * @returns {void}
     */Selection.prototype.selectByHierarchicalIndex=function(start,end){var startPosition=this.getTextPosBasedOnLogicalIndex(start);var endPosition=this.getTextPosBasedOnLogicalIndex(end);this.selectPosition(startPosition,endPosition);};/**
     * Select the current field if selection is in field
     *
     * @param fieldStart
     * @returns {void}
     */Selection.prototype.selectField=function(fieldStart){if(this.isInField||!sf.base.isNullOrUndefined(fieldStart)){if(sf.base.isNullOrUndefined(fieldStart)){fieldStart=this.getHyperlinkField(true);}this.selectFieldInternal(fieldStart);}};/**
     * @private
     * @param fieldStart
     * @returns {void}
     */Selection.prototype.selectFieldInternal=function(fieldStart){if(fieldStart){var formFillingMode=this.documentHelper.isFormFillProtectedMode;var fieldEnd=fieldStart.fieldEnd;if(formFillingMode){fieldStart=fieldStart.fieldSeparator;}var offset=fieldStart.line.getOffset(fieldStart,formFillingMode?1:0);var startPosition=new TextPosition(this.owner);startPosition.setPositionParagraph(fieldStart.line,offset);var isBookmark=fieldStart.nextNode instanceof BookmarkElementBox;if(isBookmark&&!formFillingMode){fieldEnd=fieldStart.nextElement.reference;}var endoffset=fieldEnd.line.getOffset(fieldEnd,formFillingMode?0:1);var endPosition=new TextPosition(this.owner);endPosition.setPositionParagraph(fieldEnd.line,endoffset);//selects the field range
this.documentHelper.selection.selectRange(startPosition,endPosition);}};/**
     * @param shape
     * @private
     * @returns {void}
     */Selection.prototype.selectShape=function(shape){if(shape){var offset=shape.line.getOffset(shape,0);var startPosition=new TextPosition(this.owner);startPosition.setPositionParagraph(shape.line,offset);var endoffset=shape.line.getOffset(shape,1);var endPosition=new TextPosition(this.owner);endPosition.setPositionParagraph(shape.line,endoffset);this.documentHelper.selection.selectRange(startPosition,endPosition);}};/**
     * Toggles the bold property of selected contents.
     *
     * @private
     * @returns {void}
     */Selection.prototype.toggleBold=function(){if(this.owner.editorModule){this.owner.editorModule.toggleBold();}};/**
     * Toggles the italic property of selected contents.
     *
     * @private
     * @returns {void}
     */Selection.prototype.toggleItalic=function(){if(this.owner.editorModule){this.owner.editorModule.toggleItalic();}};/**
     * Toggles the allCaps property of selected contents.
     *
     * @private
     * @returns {void}
     */Selection.prototype.toggleAllCaps=function(){if(this.owner.editorModule){this.owner.editorModule.toggleAllCaps();}};/**
     * Toggles the underline property of selected contents.
     *
     * @param {Underline} underline Default value of underline parameter is Single.
     * @private
     * @returns {void}
     */Selection.prototype.toggleUnderline=function(underline){if(this.owner.editor){this.owner.editor.toggleUnderline(underline);}};/**
     * Toggles the strike through property of selected contents.
     *
     * @param {Strikethrough} strikethrough Default value of strikethrough parameter is SingleStrike.
     * @private
     * @returns {void}
     */Selection.prototype.toggleStrikethrough=function(strikethrough){if(this.owner.editor){this.owner.editor.toggleStrikethrough(strikethrough);}};/**
     * Toggles the highlight color property of selected contents.
     *
     * @param {HighlightColor} highlightColor Default value of underline parameter is Yellow.
     * @private
     * @returns {void}
     */Selection.prototype.toggleHighlightColor=function(highlightColor){if(this.owner.editor){this.owner.editor.toggleHighlightColor(highlightColor);}};/**
     * Toggles the subscript formatting of selected contents.
     *
     * @private
     * @returns {void}
     */Selection.prototype.toggleSubscript=function(){if(this.owner.editor){this.owner.editor.toggleSubscript();}};/**
     * Toggles the superscript formatting of selected contents.
     *
     * @private
     * @returns {void}
     */Selection.prototype.toggleSuperscript=function(){if(this.owner.editor){this.owner.editor.toggleSuperscript();}};/**
     * Toggles the text alignment property of selected contents.
     *
     * @param {TextAlignment} textAlignment Default value of textAlignment parameter is TextAlignment.Left.
     * @private
     * @returns {void}
     */Selection.prototype.toggleTextAlignment=function(textAlignment){if(this.owner.editor){this.owner.editor.toggleTextAlignment(textAlignment);}};/**
     * Increases the left indent of selected paragraphs to a factor of 36 points.
     *
     * @private
     * @returns {void}
     */Selection.prototype.increaseIndent=function(){if(this.owner.editor){this.owner.editor.increaseIndent();}};/**
     * Decreases the left indent of selected paragraphs to a factor of 36 points.
     *
     * @private
     * @returns {void}
     */Selection.prototype.decreaseIndent=function(){if(this.owner.editor){this.owner.editor.decreaseIndent();}};/**
     * Fires the `requestNavigate` event if current selection context is in hyperlink.
     *
     * @returns {void}
     */Selection.prototype.navigateHyperlink=function(){var fieldBegin=this.getHyperlinkField();if(fieldBegin){this.fireRequestNavigate(fieldBegin);}};/**
     * Navigate Hyperlink
     *
     * @param fieldBegin
     * @private
     * @returns {void}
     */Selection.prototype.fireRequestNavigate=function(fieldBegin){var code=this.getFieldCode(fieldBegin);if(code.toLowerCase().indexOf('ref ')===0&&!code.match('\\h')){return;}var hyperlink=new Hyperlink(fieldBegin,this);var eventArgs={isHandled:false,navigationLink:hyperlink.navigationLink,linkType:hyperlink.linkType,localReference:hyperlink.localReference};this.owner.dotNetRef.invokeMethodAsync("RequestNavigate",eventArgs);/* this.owner.trigger('requestNavigate', eventArgs);*/ // if (!eventArgs.isHandled) {
//     this.documentHelper.selection.navigateBookmark(hyperlink.localReference, true);
// }
};/**
     * Copies the hyperlink URL if the context is within hyperlink.
     *
     * @returns {void}
     */Selection.prototype.copyHyperlink=function(){var hyperLinkField=this.getHyperlinkField();var linkText=this.getLinkText(hyperLinkField);this.copyToClipboard(linkText);};Selection.prototype.isHideSelection=function(paragraph){var bodyWgt=paragraph.bodyWidget;var sectionFormat=bodyWgt.sectionFormat;var pageHt=sectionFormat.pageHeight-sectionFormat.footerDistance;var headerFooterHt=bodyWgt.page.boundingRectangle.height/100*40;return this.contextType.indexOf('Footer')>=0&&paragraph.y+paragraph.height>HelperMethods.convertPointToPixel(pageHt)||this.contextType.indexOf('Header')>=0&&paragraph.y+paragraph.height>headerFooterHt;};//Selection add, Highlight, remove API starts
/**
     * @private
     * @returns {void}
     */Selection.prototype.highlightSelection=function(isSelectionChanged){if(this.owner.enableImageResizerMode){this.owner.imageResizerModule.hideImageResizer();}if(this.isEmpty){if(!this.isInShape&&this.isHideSelection(this.start.paragraph)){this.hideCaret();return;}if(this.isInShape){this.showResizerForShape();}this.updateCaretPosition();}else{if(this.isForward){this.highlightSelectedContent(this.start,this.end);}else{this.highlightSelectedContent(this.end,this.start);}if(this.documentHelper.isComposingIME){this.updateCaretPosition();}}this.documentHelper.updateTouchMarkPosition();if(isSelectionChanged){this.documentHelper.scrollToPosition(this.start,this.end);}};Selection.prototype.createHighlightBorder=function(lineWidget,width,left,top,isElementBoxHighlight){if(width<0){width=0;}var paragraph=lineWidget.paragraph;var floatingItems=[];if(paragraph.floatingElements.length>0){for(var k=0;k<paragraph.floatingElements.length;k++){var shapeElement=paragraph.floatingElements[k];if(shapeElement.line===lineWidget){var startTextPos=this.start;var endTextPos=this.end;if(!this.isForward){startTextPos=this.end;endTextPos=this.start;}var offset=shapeElement.line.getOffset(shapeElement,0);if(startTextPos.currentWidget!==lineWidget&&endTextPos.currentWidget!==lineWidget||startTextPos.currentWidget===lineWidget&&startTextPos.offset<=offset&&(endTextPos.currentWidget===lineWidget&&endTextPos.offset>=offset+1||endTextPos.currentWidget!==lineWidget)||startTextPos.currentWidget!==lineWidget&&endTextPos.currentWidget===lineWidget&&endTextPos.offset>=offset){floatingItems.push(shapeElement);}}}}var page=this.getPage(lineWidget.paragraph);var height=lineWidget.height;var widgets=this.selectedWidgets;var selectionWidget=undefined;var selectionWidgetCollection=undefined;if(this.isHightlightEditRegionInternal){this.addEditRegionHighlight(lineWidget,left,width);return;}else if(this.isHighlightFormFields){this.addFormFieldHighlight(lineWidget,left,width);return;}else{if(widgets.containsKey(lineWidget)){if(widgets.get(lineWidget)instanceof SelectionWidgetInfo){selectionWidget=widgets.get(lineWidget);// if the line element has already added with SelectionWidgetInfo
// now its need to be added as ElementBox highlighting them remove it from dictionary and add it collection.
if(isElementBoxHighlight){widgets.remove(lineWidget);selectionWidgetCollection=[];widgets.add(lineWidget,selectionWidgetCollection);}}else{selectionWidgetCollection=widgets.get(lineWidget);}}else{if(isElementBoxHighlight){selectionWidgetCollection=[];widgets.add(lineWidget,selectionWidgetCollection);}else{var wrapPosition=this.getWrapPosition(lineWidget,paragraph);if(wrapPosition.length>0){var selectionWidgetInfos=this.splitSelectionHighlightPosition(left,width,wrapPosition);if(selectionWidgetInfos.length>0){selectionWidgetInfos[0].floatingItems=floatingItems;widgets.add(lineWidget,selectionWidgetInfos);this.renderHighlight(page,lineWidget,selectionWidgetInfos,top,floatingItems);return;}else{selectionWidget=new SelectionWidgetInfo(left,width);selectionWidget.floatingItems=floatingItems;widgets.add(lineWidget,selectionWidget);}}else{selectionWidget=new SelectionWidgetInfo(left,width);selectionWidget.floatingItems=floatingItems;widgets.add(lineWidget,selectionWidget);}}}if(selectionWidget===undefined){selectionWidget=new SelectionWidgetInfo(left,width);selectionWidget.floatingItems=floatingItems;widgets.add(lineWidget,selectionWidget);}}this.renderHighlight(page,lineWidget,[selectionWidget],top,floatingItems);if(isElementBoxHighlight){selectionWidgetCollection.push(selectionWidget);}};Selection.prototype.renderHighlight=function(page,lineWidget,selectionWidget,top,floatingItems){var documentHelper=this.owner.documentHelper;var pageTop=this.getPageTop(page);var pageLeft=page.boundingRectangle.x;var height=lineWidget.height;if(this.viewer.containerTop<=pageTop||pageTop<this.viewer.containerTop+documentHelper.selectionCanvas.height){var zoomFactor=documentHelper.zoomFactor;this.clipSelection(page,pageTop);for(var i=0;i<selectionWidget.length;i++){var selectedWidget=selectionWidget[i];var left=selectedWidget.left;var width=selectedWidget.width;if(this.documentHelper.isComposingIME){this.renderDashLine(documentHelper.selectionContext,page,lineWidget,pageLeft+left*zoomFactor-this.viewer.containerLeft,top,width*zoomFactor,height);}else{this.documentHelper.selectionContext.fillStyle='gray';documentHelper.selectionContext.globalAlpha=0.4;documentHelper.selectionContext.fillRect(pageLeft+left*zoomFactor-this.viewer.containerLeft,pageTop+top*zoomFactor-this.viewer.containerTop,width*zoomFactor,height*zoomFactor);}}if(floatingItems.length>0){for(var z=0;z<floatingItems.length;z++){var left=floatingItems[z].x;var shapeTop=floatingItems[z].y;var shapeWidth=floatingItems[z].width;var shapeHeight=floatingItems[z].height;documentHelper.selectionContext.fillRect(pageLeft+left*zoomFactor-this.viewer.containerLeft,pageTop+shapeTop*zoomFactor-this.viewer.containerTop,shapeWidth*zoomFactor,shapeHeight*zoomFactor);}}documentHelper.selectionContext.restore();}};Selection.prototype.getWrapPosition=function(lineWidget,paragraph){var bodyWidget=paragraph.bodyWidget;if(!sf.base.isNullOrUndefined(bodyWidget)&&bodyWidget.floatingElements.length>0&&lineWidget.children.length>0){var startLeft=this.getLeftInternal(lineWidget,lineWidget.children[0],0);var width=0;var wrapPos=[];var isStarted=false;for(var z=0;z<lineWidget.children.length;z++){var element=lineWidget.children[z];if(element instanceof ShapeBase&&element.textWrappingStyle!=='Inline'){continue;}if(element.padding.left>0){if(wrapPos.length===1&&wrapPos[0].end===0){wrapPos[0].end=wrapPos[0].start-paragraph.x;wrapPos[0].start=paragraph.x;startLeft=paragraph.x;}var clipInfo={};clipInfo.start=startLeft+width;clipInfo.end=0;if(isStarted){clipInfo.end=startLeft+width+element.padding.left;}wrapPos.push(clipInfo);}width+=element.padding.left+element.width;if(element instanceof TextElementBox){isStarted=true;}}if(wrapPos.length===1&&wrapPos[0].end===0){wrapPos[0].end=wrapPos[0].start-paragraph.x;wrapPos[0].start=paragraph.x;}return wrapPos;}return[];};Selection.prototype.splitSelectionHighlightPosition=function(left,width,clipInfo){var selectedWidget=[];for(var m=0;m<clipInfo.length;m++){var info=clipInfo[m];if(left<info.start&&left+width<info.end||left>info.end){continue;}if(left<info.start&&left+width>info.end){selectedWidget.push(new SelectionWidgetInfo(left,info.start-left));width=left+width-info.end;left=info.end;}else if(left===info.start){left+=info.end;width=width-info.end;}if(m===clipInfo.length-1){selectedWidget.push(new SelectionWidgetInfo(left,width));}}return selectedWidget;};Selection.prototype.addEditRegionHighlight=function(lineWidget,left,width){var highlighters=undefined;var collection=this.editRegionHighlighters;if(collection.containsKey(lineWidget)){highlighters=collection.get(lineWidget);}else{highlighters=[];collection.add(lineWidget,highlighters);}var editRegionHighlight=new SelectionWidgetInfo(left,width);if(this.isCurrentUser){editRegionHighlight.color=this.owner.userColor!==''?this.owner.userColor:'#FFFF00';}highlighters.push(editRegionHighlight);return editRegionHighlight;};Selection.prototype.addFormFieldHighlight=function(lineWidget,left,width){var highlighters=undefined;var collection=this.formFieldHighlighters;if(collection.containsKey(lineWidget)){highlighters=collection.get(lineWidget);}else{highlighters=[];collection.add(lineWidget,highlighters);}var formFieldHighlight=new SelectionWidgetInfo(left,width);highlighters.push(formFieldHighlight);};Selection.prototype.createHighlightBorderInsideTable=function(cellWidget){var page=this.getPage(cellWidget);var selectionWidget=undefined;var left=cellWidget.x-cellWidget.margin.left+cellWidget.leftBorderWidth;var width=cellWidget.width+cellWidget.margin.left+cellWidget.margin.right-cellWidget.leftBorderWidth-cellWidget.rightBorderWidth;var top=cellWidget.y;var height=cellWidget.height;var pageTop=this.getPageTop(page);var pageLeft=page.boundingRectangle.x;var isVisiblePage=this.viewer.containerTop<=pageTop||pageTop<this.viewer.containerTop+this.documentHelper.selectionCanvas.height;var widgets=this.selectedWidgets;if(!this.isHightlightEditRegionInternal&&!this.isHighlightFormFields){if(widgets.containsKey(cellWidget)&&widgets.get(cellWidget)instanceof SelectionWidgetInfo){selectionWidget=widgets.get(cellWidget);if(isVisiblePage){this.documentHelper.selectionContext.clearRect(pageLeft+selectionWidget.left*this.documentHelper.zoomFactor-this.viewer.containerLeft,pageTop+top*this.documentHelper.zoomFactor-this.viewer.containerTop,selectionWidget.width*this.documentHelper.zoomFactor,height*this.documentHelper.zoomFactor);}}else{selectionWidget=new SelectionWidgetInfo(left,width);if(widgets.containsKey(cellWidget)){widgets.remove(widgets.get(cellWidget));}widgets.add(cellWidget,selectionWidget);}}if(isVisiblePage){this.documentHelper.selectionContext.fillStyle='gray';this.documentHelper.selectionContext.globalAlpha=0.4;var zoomFactor=this.documentHelper.zoomFactor;this.clipSelection(page,pageTop);this.documentHelper.selectionContext.fillRect(pageLeft+left*zoomFactor-this.viewer.containerLeft,pageTop+top*zoomFactor-this.viewer.containerTop,width*zoomFactor,height*zoomFactor);this.documentHelper.selectionContext.restore();}};Selection.prototype.clipSelection=function(page,pageTop){var documentHelper=this.owner.documentHelper;var width;var height;if(this.viewer instanceof WebLayoutViewer&&this.documentHelper.zoomFactor<1){width=page.boundingRectangle.width/this.documentHelper.zoomFactor;height=page.boundingRectangle.height/this.documentHelper.zoomFactor;}else{width=page.boundingRectangle.width*this.documentHelper.zoomFactor;height=page.boundingRectangle.height*this.documentHelper.zoomFactor;}var left=page.boundingRectangle.x;documentHelper.selectionContext.beginPath();documentHelper.selectionContext.save();documentHelper.selectionContext.rect(left-this.viewer.containerLeft,pageTop-this.viewer.containerTop,width,height);documentHelper.selectionContext.clip();};/**
     * Add selection highlight
     *
     * @private
     * @returns {void}
     */Selection.prototype.addSelectionHighlight=function(canvasContext,widget,top){if(this.selectedWidgets.containsKey(widget)){var height=this.documentHelper.render.getScaledValue(widget.height);var widgetInfo=this.selectedWidgets.get(widget);var widgetInfoCollection=undefined;if(widgetInfo instanceof SelectionWidgetInfo){widgetInfoCollection=[];widgetInfoCollection.push(widgetInfo);}else{widgetInfoCollection=widgetInfo;}if(!sf.base.isNullOrUndefined(widgetInfoCollection)){for(var i=0;i<widgetInfoCollection.length;i++){var selectedWidgetInfo=widgetInfoCollection[i];var width=this.documentHelper.render.getScaledValue(widgetInfoCollection[i].width);var left=this.documentHelper.render.getScaledValue(widgetInfoCollection[i].left,1);var page=this.owner.selection.getPage(widget.paragraph);this.owner.selection.clipSelection(page,this.owner.selection.getPageTop(page));if(this.documentHelper.isComposingIME){this.renderDashLine(canvasContext,page,widget,left,top,width,height);}else{canvasContext.globalAlpha=0.4;canvasContext.fillStyle='gray';canvasContext.fillRect(left,this.documentHelper.render.getScaledValue(top,2),width,height);if(selectedWidgetInfo.floatingItems&&selectedWidgetInfo.floatingItems.length>0){for(var j=0;j<selectedWidgetInfo.floatingItems.length;j++){var shape=selectedWidgetInfo.floatingItems[j];width=this.documentHelper.render.getScaledValue(shape.width);left=this.documentHelper.render.getScaledValue(shape.x,1);var shapeTop=this.documentHelper.render.getScaledValue(shape.y,2);canvasContext.fillRect(left,shapeTop,width,this.documentHelper.render.getScaledValue(shape.height));}}}canvasContext.restore();}}}};Selection.prototype.renderDashLine=function(ctx,page,widget,left,top,width,height){var fontColor=this.characterFormat.fontColor;var fillColor=fontColor?HelperMethods.getColor(fontColor):'#000000';ctx.globalAlpha=1;// Get character format copied from selection format
var format=this.owner.editor.copyInsertFormat(new WCharacterFormat(),false);var heightInfo=this.documentHelper.textHelper.getHeight(format);var pageTop=this.getPageTop(page);var descent=heightInfo.Height-heightInfo.BaselineOffset;top=this.documentHelper.render.getUnderlineYPosition(widget)+top+4-descent;this.documentHelper.render.renderDashLine(ctx,left,pageTop-this.viewer.containerTop+top*this.documentHelper.zoomFactor,width,fillColor,true);};/**
     * Add Selection highlight inside table
     *
     * @private
     * @returns {void}
     */Selection.prototype.addSelectionHighlightTable=function(canvasContext,tableCellWidget){if(this.selectedWidgets.containsKey(tableCellWidget)){var selectedWidgetInfo=this.selectedWidgets.get(tableCellWidget);var selectedWidgetInfoCollection=undefined;if(selectedWidgetInfo instanceof SelectionWidgetInfo){selectedWidgetInfoCollection=[];selectedWidgetInfoCollection.push(selectedWidgetInfo);}else{selectedWidgetInfoCollection=selectedWidgetInfo;}if(!sf.base.isNullOrUndefined(selectedWidgetInfoCollection)){for(var i=0;i<selectedWidgetInfoCollection.length;i++){var left=this.documentHelper.render.getScaledValue(selectedWidgetInfoCollection[i].left,1);var top_1=this.documentHelper.render.getScaledValue(tableCellWidget.y,2);var width=this.documentHelper.render.getScaledValue(selectedWidgetInfoCollection[i].width);var height=this.documentHelper.render.getScaledValue(tableCellWidget.height);canvasContext.fillStyle='gray';var page=this.owner.selection.getPage(tableCellWidget);this.owner.selection.clipSelection(page,this.owner.selection.getPageTop(page));canvasContext.fillRect(left,top_1,width,height);canvasContext.restore();}}}};Selection.prototype.removeSelectionHighlight=function(widget){var left=0;var top=0;var width=0;var height=0;var page=undefined;if(widget instanceof LineWidget){var lineWidget=widget;var currentParaWidget=lineWidget.paragraph;page=!sf.base.isNullOrUndefined(currentParaWidget)?this.getPage(lineWidget.paragraph):undefined;if(sf.base.isNullOrUndefined(page)){return;}top=this.getTop(lineWidget);height=lineWidget.height;}else if(widget instanceof TableCellWidget){page=!sf.base.isNullOrUndefined(widget)?this.getPage(widget):undefined;if(sf.base.isNullOrUndefined(page)){return;}top=widget.y;height=widget.height;}if(sf.base.isNullOrUndefined(page)){return;}var selectedWidget=this.selectedWidgets.get(widget);var selectedWidgetCollection=undefined;if(selectedWidget instanceof SelectionWidgetInfo){selectedWidgetCollection=[];selectedWidgetCollection.push(selectedWidget);}else{selectedWidgetCollection=selectedWidget;}if(!sf.base.isNullOrUndefined(selectedWidgetCollection)){for(var i=0;i<selectedWidgetCollection.length;i++){width=selectedWidgetCollection[i].width;left=selectedWidgetCollection[i].left;var pageRect=page.boundingRectangle;var pageIndex=this.documentHelper.pages.indexOf(page);var pageGap=this.viewer.pageGap;var pageTop=(pageRect.y-pageGap*(pageIndex+1))*this.documentHelper.zoomFactor+pageGap*(pageIndex+1);var pageLeft=pageRect.x;var zoomFactor=this.documentHelper.zoomFactor;if(this.viewer.containerTop<=pageTop||pageTop<this.viewer.containerTop+this.documentHelper.selectionCanvas.height){this.documentHelper.selectionContext.clearRect(pageLeft+left*zoomFactor-this.viewer.containerLeft-0.5,pageTop+top*zoomFactor-this.viewer.containerTop-0.5,width*zoomFactor+0.5,height*zoomFactor+0.5);}}}};/**
     * Selects Current word
     *
     * @param excludeSpace
     * @returns {void}
     */Selection.prototype.selectCurrentWord=function(excludeSpace){var startPosition=this.start.clone();var endPosition=this.end.clone();this.selectCurrentWordRange(startPosition,endPosition,excludeSpace?excludeSpace:false);this.selectRange(startPosition,endPosition);};/**
     * Selects current paragraph
     *
     * @returns {void}
     */Selection.prototype.selectParagraph=function(){if(!sf.base.isNullOrUndefined(this.start)){this.start.paragraphStartInternal(this,false);this.end.moveToParagraphEndInternal(this,false);this.upDownSelectionLength=this.end.location.x;this.fireSelectionChanged(true);}};/**
     * Selects current line.
     *
     * @returns {void}
     */Selection.prototype.selectLine=function(){if(!sf.base.isNullOrUndefined(this.start)){this.moveToLineStart();this.handleShiftEndKey();}};/**
     * Moves selection to start of the document.
     *
     * @returns {void}
     */Selection.prototype.moveToDocumentStart=function(){this.handleControlHomeKey();};/**
     * Moves selection to end of the document.
     *
     * @returns {void}
     */Selection.prototype.moveToDocumentEnd=function(){this.handleControlEndKey();};/**
     * Moves selection to current paragraph start.
     *
     * @returns {void}
     */Selection.prototype.moveToParagraphStart=function(){if(this.isForward){this.start.paragraphStartInternal(this,false);this.end.setPositionInternal(this.start);this.upDownSelectionLength=this.end.location.x;}else{this.end.paragraphStartInternal(this,false);this.start.setPositionInternal(this.end);this.upDownSelectionLength=this.start.location.x;}this.fireSelectionChanged(true);};/**
     * Moves selection to current paragraph end.
     *
     * @returns {void}
     */Selection.prototype.moveToParagraphEnd=function(){if(this.isForward){this.start.moveToParagraphEndInternal(this,false);this.end.setPositionInternal(this.start);this.upDownSelectionLength=this.end.location.x;}else{this.end.moveToParagraphEndInternal(this,false);this.start.setPositionInternal(this.end);this.upDownSelectionLength=this.start.location.x;}this.fireSelectionChanged(true);};/**
     * Moves selection to next line.
     *
     * @returns {void}
     */Selection.prototype.moveToNextLine=function(){this.moveDown();};/**
     * Moves selection to previous line.
     *
     * @returns {void}
     */Selection.prototype.moveToPreviousLine=function(){this.moveUp();};/**
     * Moves selection to next character.
     *
     * @returns {void}
     */Selection.prototype.moveToNextCharacter=function(){this.handleRightKey();};/**
     * Moves selection to previous character.
     *
     * @returns {void}
     */Selection.prototype.moveToPreviousCharacter=function(){this.handleLeftKey();};Selection.prototype.selectCurrentWordRange=function(startPosition,endPosition,excludeSpace){if(!sf.base.isNullOrUndefined(startPosition)){if(startPosition.offset>0){var wordStart=startPosition.clone();var indexInInline=0;var inlineObj=startPosition.currentWidget.getInline(startPosition.offset,indexInInline);var inline=inlineObj.element;indexInInline=inlineObj.index;if(!sf.base.isNullOrUndefined(inline)&&inline instanceof FieldElementBox&&inline.fieldType===1){if(startPosition.offset>2&&(!sf.base.isNullOrUndefined(inline.fieldSeparator)||sf.base.isNullOrUndefined(inline.fieldBegin))){wordStart.setPositionParagraph(wordStart.currentWidget,startPosition.offset-2);wordStart.moveToWordEndInternal(0,false);if(!(wordStart.paragraph===startPosition.paragraph&&wordStart.offset===startPosition.offset-1)){startPosition.moveToWordStartInternal(2);}}else if(startPosition.offset>3&&sf.base.isNullOrUndefined(inline.fieldSeparator)){wordStart.setPositionParagraph(wordStart.currentWidget,startPosition.offset-3);wordStart.moveToWordEndInternal(0,false);if(!(wordStart.paragraph===startPosition.paragraph&&wordStart.offset===startPosition.offset)){startPosition.moveToWordStartInternal(2);}}}else{wordStart.setPositionParagraph(wordStart.currentWidget,startPosition.offset-1);wordStart.moveToWordEndInternal(0,false);if(!(wordStart.paragraph===startPosition.paragraph&&wordStart.offset===startPosition.offset)){startPosition.moveToWordStartInternal(2);}}}endPosition.moveToWordEndInternal(2,excludeSpace);}};/**
     * Extends selection to paragraph start.
     *
     * @returns {void}
     */Selection.prototype.extendToParagraphStart=function(){if(sf.base.isNullOrUndefined(this.start)){return;}this.end.paragraphStartInternal(this,true);this.upDownSelectionLength=this.end.location.x;this.fireSelectionChanged(true);};/**
     * Extend selection to paragraph end.
     *
     * @returns {void}
     */Selection.prototype.extendToParagraphEnd=function(){if(sf.base.isNullOrUndefined(this.start)){return;}this.end.moveToParagraphEndInternal(this,true);this.upDownSelectionLength=this.end.location.x;this.fireSelectionChanged(true);};/**
     * Move to next text position
     *
     * @private
     * @returns {void}
     */Selection.prototype.moveNextPosition=function(){if(sf.base.isNullOrUndefined(this.start)){return;}if(this.isEmpty){this.start.moveNextPosition();this.end.setPositionInternal(this.start);}this.updateForwardSelection();this.upDownSelectionLength=this.start.location.x;this.fireSelectionChanged(true);if(this.documentHelper.isFormFillProtectedMode){var formField=this.getCurrentFormField();if(!formField){formField=this.getFormFieldInFormFillMode();this.selectPrevNextFormField(true,formField);}}};/**
     * Move to next paragraph
     *
     * @private
     * @returns {void}
     */Selection.prototype.moveToNextParagraph=function(){if(sf.base.isNullOrUndefined(this.start)){return;}this.end.moveToNextParagraphStartInternal();this.start.setPositionInternal(this.end);this.upDownSelectionLength=this.end.location.x;this.fireSelectionChanged(true);};/**
     * To navigate to next footnote from current selection
     *
     * @returns {void}
     */Selection.prototype.nextFootnote=function(){if(this.isinFootnote){var footNoteElement=this.start.paragraph.footNoteReference;var colLength=this.documentHelper.footnoteCollection.length;var indexCount=this.documentHelper.footnoteCollection.indexOf(footNoteElement);var nextFootnoteElement=this.documentHelper.footnoteCollection[indexCount+1];if(sf.base.isNullOrUndefined(nextFootnoteElement)){nextFootnoteElement=footNoteElement;}var start=this.start.clone();var end=this.end.clone();for(var i=0;i<this.documentHelper.pages.length;i++){var referenceElement=this.documentHelper.pages[i].footnoteWidget;for(var j=1;j<referenceElement.childWidgets.length;j++){var element=referenceElement.childWidgets[j].footNoteReference;if(element===nextFootnoteElement){start.setPositionParagraph(referenceElement.childWidgets[j].childWidgets[0],0);end.setPositionInternal(start);this.selectRange(start,end);}}}}};/**
     * To navigate to previous footnote from current selection
     *
     * @returns {void}
     */Selection.prototype.previousFootnote=function(){if(this.isinFootnote){var footNoteElement=this.start.paragraph.footNoteReference;var colLength=this.documentHelper.footnoteCollection.length;var indexCount=this.documentHelper.footnoteCollection.indexOf(footNoteElement);var previousFootnote=this.documentHelper.footnoteCollection[indexCount-1];if(sf.base.isNullOrUndefined(previousFootnote)){previousFootnote=footNoteElement;}var startPosition=this.start.clone();var endPosition=this.end.clone();for(var i=0;i<this.documentHelper.pages.length;i++){var footnote=this.documentHelper.pages[i].footnoteWidget;for(var j=1;j<footnote.childWidgets.length;j++){var element=footnote.childWidgets[j].footNoteReference;if(element===previousFootnote){startPosition.setPositionParagraph(footnote.childWidgets[j].childWidgets[0],0);endPosition.setPositionInternal(startPosition);this.selectRange(startPosition,endPosition);}}}}};/**
     * To navigate to next Endnote from current selection
     *
     * @returns {void}
     */Selection.prototype.nextEndnote=function(){if(this.isinEndnote){var endNoteElement=this.start.paragraph.footNoteReference;var colLength=this.documentHelper.endnoteCollection.length;var indexCount=this.documentHelper.endnoteCollection.indexOf(endNoteElement);var nextEndnote=this.documentHelper.endnoteCollection[indexCount+1];if(sf.base.isNullOrUndefined(nextEndnote)){nextEndnote=endNoteElement;}var startPosition=this.start.clone();var endPosition=this.end.clone();var endnoteElement=this.documentHelper.pages[this.endPage-1].endnoteWidget;for(var j=0;j<endnoteElement.childWidgets.length;j++){var element=endnoteElement.childWidgets[j].footNoteReference;if(element===nextEndnote){startPosition.setPositionParagraph(endnoteElement.childWidgets[j].childWidgets[0],0);endPosition.setPositionInternal(startPosition);this.selectRange(startPosition,endPosition);}}}};/**
     * To navigate to previous Endnote from current selection
     *
     * @returns {void}
     */Selection.prototype.previousEndnote=function(){if(this.isinEndnote){var endNoteElement=this.start.paragraph.footNoteReference;var colLength=this.documentHelper.endnoteCollection.length;var indexCount=this.documentHelper.endnoteCollection.indexOf(endNoteElement);var inline=this.documentHelper.endnoteCollection[indexCount-1];if(sf.base.isNullOrUndefined(inline)){inline=endNoteElement;}var startPosition=this.start.clone();var endPosition=this.end.clone();var referenceElement=this.documentHelper.pages[this.endPage-1].endnoteWidget;for(var j=0;j<referenceElement.childWidgets.length;j++){var element=referenceElement.childWidgets[j].footNoteReference;if(element===inline){startPosition.setPositionParagraph(referenceElement.childWidgets[j].childWidgets[0],0);endPosition.setPositionInternal(startPosition);this.selectRange(startPosition,endPosition);}}}};/**
     * Move to previous text position
     *
     * @private
     * @returns {void}
     */Selection.prototype.movePreviousPosition=function(){if(sf.base.isNullOrUndefined(this.start)){return;}if(this.isEmpty){this.start.movePreviousPosition();this.end.setPositionInternal(this.start);}this.updateBackwardSelection();this.upDownSelectionLength=this.start.location.x;this.fireSelectionChanged(true);if(this.documentHelper.isFormFillProtectedMode){var formField=this.getCurrentFormField();if(!formField){formField=this.getFormFieldInFormFillMode();this.selectPrevNextFormField(false,formField);}}};/**
     * Move to previous paragraph
     *
     * @private
     * @returns {void}
     */Selection.prototype.moveToPreviousParagraph=function(){if(sf.base.isNullOrUndefined(this.start)){return;}this.end.moveToPreviousParagraph(this);this.start.setPositionInternal(this.end);this.upDownSelectionLength=this.end.location.x;this.fireSelectionChanged(true);};/**
     * Extends selection to previous line.
     *
     * @returns {void}
     */Selection.prototype.extendToPreviousLine=function(){if(sf.base.isNullOrUndefined(this.start)){return;}this.end.moveToPreviousLine(this,this.upDownSelectionLength);this.fireSelectionChanged(true);};/**
     * Extend selection to line end
     *
     * @returns {void}
     */Selection.prototype.extendToLineEnd=function(){if(sf.base.isNullOrUndefined(this.start)){return;}this.end.moveToLineEndInternal(this,true);this.upDownSelectionLength=this.end.location.x;this.fireSelectionChanged(true);};/**
     * Extends selection to line start.
     *
     * @returns {void}
     */Selection.prototype.extendToLineStart=function(){if(sf.base.isNullOrUndefined(this.start)){return;}this.end.moveToLineStartInternal(this,true);this.upDownSelectionLength=this.end.location.x;// To select Paragraph mark similar to MS WORD
if(this.start.paragraph===this.end.paragraph&&this.start.offset===this.start.currentWidget.getEndOffset()&&this.isParagraphLastLine(this.start.currentWidget)&&this.isParagraphFirstLine(this.end.currentWidget)){this.start.setPositionParagraph(this.start.currentWidget,this.start.offset+1);}this.fireSelectionChanged(true);};/**
     * @private
     * @returns {void}
     */Selection.prototype.moveUp=function(){if(this.documentHelper.isFormFillProtectedMode){this.selectPrevNextFormField(false);return;}if(sf.base.isNullOrUndefined(this.start)){return;}if(!this.isEmpty){if(this.isForward){this.end.setPositionInternal(this.start);}else{this.start.setPositionInternal(this.end);}this.upDownSelectionLength=this.start.location.x;}this.upDownSelectionLength=this.start.location.x;this.start.moveUp(this,this.upDownSelectionLength);this.end.setPositionInternal(this.start);this.fireSelectionChanged(true);};/**
     * @private
     * @returns {void}
     */Selection.prototype.moveDown=function(){if(this.documentHelper.isFormFillProtectedMode){this.selectPrevNextFormField(true);return;}if(sf.base.isNullOrUndefined(this.start)){return;}if(!this.isEmpty){if(this.isForward){this.start.setPositionInternal(this.end);}else{this.end.setPositionInternal(this.start);}this.upDownSelectionLength=this.start.location.x;}this.start.moveDown(this,this.upDownSelectionLength);this.end.setPositionInternal(this.start);this.fireSelectionChanged(true);};Selection.prototype.updateForwardSelection=function(){if(!this.isEmpty){if(this.isForward){this.start.setPositionInternal(this.end);}else{this.end.setPositionInternal(this.start);}}};Selection.prototype.updateBackwardSelection=function(){if(!this.isEmpty){if(this.isForward){this.end.setPositionInternal(this.start);}else{this.start.setPositionInternal(this.end);}}};/**
     * @private
     * @returns {void}
     */Selection.prototype.getFirstBlockInFirstCell=function(table){if(table.childWidgets.length>0){var firstrow=table.childWidgets[0];if(firstrow.childWidgets.length>0){var firstcell=firstrow.childWidgets[0];if(firstcell.childWidgets.length===0){return undefined;}return firstcell.childWidgets[0];}}return undefined;};/**
     * @private
     * @returns {void}
     */Selection.prototype.getFirstCellInRegion=function(row,startCell,selectionLength,isMovePrevious){var cellStart=this.getCellLeft(row,startCell);var cellEnd=cellStart+startCell.cellFormat.cellWidth;var flag=true;if(cellStart<=selectionLength&&selectionLength<cellEnd){for(var k=0;k<row.childWidgets.length;k++){var left=this.getCellLeft(row,row.childWidgets[k]);if(HelperMethods.round(cellStart,2)<=HelperMethods.round(left,2)&&HelperMethods.round(left,2)<HelperMethods.round(cellEnd,2)){flag=false;return row.childWidgets[k];}}}else{for(var j=0;j<row.childWidgets.length;j++){var cellLeft=this.getCellLeft(row,row.childWidgets[j]);if(cellLeft<=selectionLength&&cellLeft+row.childWidgets[j].cellFormat.cellWidth>selectionLength){flag=false;return row.childWidgets[j];}}}if(flag){if(!sf.base.isNullOrUndefined(row.previousRenderedWidget)&&isMovePrevious){var previousWidget=row.previousRenderedWidget;return this.getFirstCellInRegion(previousWidget,startCell,selectionLength,isMovePrevious);}else if(!sf.base.isNullOrUndefined(row.nextRenderedWidget)&&!isMovePrevious){return this.getFirstCellInRegion(row.nextRenderedWidget,startCell,selectionLength,isMovePrevious);}}return row.childWidgets[0];};/**
     * @private
     * @returns {void}
     */Selection.prototype.getFirstParagraph=function(tableCell){while(tableCell.previousSplitWidget){tableCell=tableCell.previousSplitWidget;}var firstBlock=tableCell.firstChild;return this.getFirstParagraphBlock(firstBlock);};/**
     * Get last block in last cell
     *
     * @private
     * @returns {void}
     */ //Table
Selection.prototype.getLastBlockInLastCell=function(table){if(table.childWidgets.length>0){var lastRow=table.childWidgets[table.childWidgets.length-1];var lastCell=lastRow.childWidgets[lastRow.childWidgets.length-1];while(lastCell.childWidgets.length===0&&!sf.base.isNullOrUndefined(lastCell.previousSplitWidget)){lastCell=lastCell.previousSplitWidget;}return lastCell.childWidgets[lastCell.childWidgets.length-1];}return undefined;};/**
     * Moves selection to start of the current line.
     *
     * @returns {void}
     */Selection.prototype.moveToLineStart=function(){if(sf.base.isNullOrUndefined(this.start)){return;}this.updateBackwardSelection();this.start.moveToLineStartInternal(this,false);this.end.setPositionInternal(this.start);this.upDownSelectionLength=this.start.location.x;this.fireSelectionChanged(true);};/**
     * Moves selection to end of the current line.
     *
     * @returns {void}
     */Selection.prototype.moveToLineEnd=function(){if(sf.base.isNullOrUndefined(this.start)){return;}this.updateForwardSelection();this.start.moveToLineEndInternal(this,false);this.end.setPositionInternal(this.start);this.upDownSelectionLength=this.start.location.x;this.fireSelectionChanged(true);};/**
     * Get Page top
     *
     * @private
     * @returns {void}
     */Selection.prototype.getPageTop=function(page){return(page.boundingRectangle.y-this.viewer.pageGap*(this.documentHelper.pages.indexOf(page)+1))*this.documentHelper.zoomFactor+this.viewer.pageGap*(this.documentHelper.pages.indexOf(page)+1);};/**
     * Move text position to cursor point
     *
     * @private
     * @returns {void}
     */Selection.prototype.moveTextPosition=function(cursorPoint,textPosition){if(sf.base.isNullOrUndefined(this.start)){return;}//Updates the text position based on the cursor position.
var widget=this.documentHelper.getLineWidgetInternal(cursorPoint,true);if(!sf.base.isNullOrUndefined(widget)){this.updateTextPositionWidget(widget,cursorPoint,textPosition,true);}this.upDownSelectionLength=textPosition.location.x;var selectionStartIndex=this.start.getHierarchicalIndexInternal();var selectionEndIndex=this.end.getHierarchicalIndexInternal();if(selectionStartIndex!==selectionEndIndex){// Extends selection end to field begin or field end.
if(TextPosition.isForwardSelection(selectionStartIndex,selectionEndIndex)){textPosition.validateForwardFieldSelection(selectionStartIndex,selectionEndIndex);}else{textPosition.validateBackwardFieldSelection(selectionStartIndex,selectionEndIndex);}}this.fireSelectionChanged(true);};//Helper Method Implementation 
//Document
/**
     * Get document start position
     *
     * @private
     * @returns {TextPosition}
     */Selection.prototype.getDocumentStart=function(){var block=this.documentHelper.pages[0].bodyWidgets[0].childWidgets[0];return this.setPositionForBlock(block,true);};/**
     * Get document end position
     *
     * @private
     * @returns {TextPosition}
     */Selection.prototype.getDocumentEnd=function(){var textPosition=undefined;var documentStart=this.owner.documentStart;var lastPage=this.documentHelper.pages[this.documentHelper.pages.length-1];if(!sf.base.isNullOrUndefined(documentStart)&&lastPage.bodyWidgets[0].childWidgets.length>0){var block=undefined;var section=lastPage.bodyWidgets[0];var blocks=section.childWidgets;var lastBlkItem=blocks.length-1;var lastBlock=blocks[lastBlkItem];if(lastBlock instanceof BlockWidget){block=lastBlock;}textPosition=this.setPositionForBlock(block,false);}return textPosition;};//Keyboard shortcut internal API
/**
     * @private
     * @returns {void}
     */Selection.prototype.handleControlEndKey=function(){var documentEnd=undefined;if(!sf.base.isNullOrUndefined(this.owner.documentEnd)){documentEnd=this.owner.documentEnd;}if(!sf.base.isNullOrUndefined(documentEnd)){this.owner.selection.selectContent(documentEnd,true);}this.checkForCursorVisibility();};/**
     * @private
     * @returns {void}
     */Selection.prototype.handleControlHomeKey=function(){var documentStart=undefined;if(!sf.base.isNullOrUndefined(this.owner.documentStart)){documentStart=this.owner.documentStart;}if(!sf.base.isNullOrUndefined(documentStart)){this.owner.selection.selectContent(documentStart,true);}this.checkForCursorVisibility();};/**
     * @private
     * @returns {void}
     */Selection.prototype.handleControlLeftKey=function(){this.extendToWordStartInternal(true);this.checkForCursorVisibility();};/**
     * @private
     * @returns {void}
     */Selection.prototype.handleControlRightKey=function(){this.extendToWordEndInternal(true);this.checkForCursorVisibility();};/**
     * Handles control down key.
     *
     * @private
     * @returns {void}
     */Selection.prototype.handleControlDownKey=function(){this.moveToNextParagraph();this.checkForCursorVisibility();};/**
     * Handles control up key.
     *
     * @private
     * @returns {void}
     */Selection.prototype.handleControlUpKey=function(){this.moveToPreviousParagraph();this.checkForCursorVisibility();};/**
     * @private
     * @returns {void}
     */Selection.prototype.handleShiftLeftKey=function(){this.extendBackward();this.checkForCursorVisibility();};/**
     * Handles shift up key.
     *
     * @private
     * @returns {void}
     */Selection.prototype.handleShiftUpKey=function(){this.extendToPreviousLine();this.checkForCursorVisibility();};/**
     * Handles shift right key.
     *
     * @private
     * @returns {void}
     */Selection.prototype.handleShiftRightKey=function(){this.extendForward();this.checkForCursorVisibility();};/**
     * Handles shift down key.
     *
     * @private
     * @returns {void}
     */Selection.prototype.handleShiftDownKey=function(){this.extendToNextLine();this.checkForCursorVisibility();};/**
     * @private
     * @returns {void}
     */Selection.prototype.handleControlShiftLeftKey=function(){var isForward=this.isForward?this.start.isCurrentParaBidi:this.end.isCurrentParaBidi;if(isForward){this.extendToWordEndInternal(false);}else{this.extendToWordStartInternal(false);}this.checkForCursorVisibility();};/**
     * Handles control shift up key.
     *
     * @private
     * @returns {void}
     */Selection.prototype.handleControlShiftUpKey=function(){this.extendToParagraphStart();this.checkForCursorVisibility();};/**
     * Handles control shift right key
     *
     * @private
     * @returns {void}
     */Selection.prototype.handleControlShiftRightKey=function(){var isForward=this.isForward?this.start.isCurrentParaBidi:this.end.isCurrentParaBidi;if(isForward){this.extendToWordStartInternal(false);}else{this.extendToWordEndInternal(false);}this.checkForCursorVisibility();};/**
     * Handles control shift down key.
     *
     * @private
     * @returns {void}
     */Selection.prototype.handleControlShiftDownKey=function(){this.extendToParagraphEnd();this.checkForCursorVisibility();};/**
     * Handles left key.
     *
     * @private
     * @returns {void}
     */Selection.prototype.handleLeftKey=function(){if(this.end.isCurrentParaBidi){this.moveNextPosition();}else{this.movePreviousPosition();}this.checkForCursorVisibility();};/**
     * Handles up key.
     *
     * @private
     * @returns {void}
     */Selection.prototype.handleUpKey=function(){this.isMoveDownOrMoveUp=true;this.moveUp();this.isMoveDownOrMoveUp=false;this.checkForCursorVisibility();};/**
     * Handles right key.
     *
     * @private
     * @returns {void}
     */Selection.prototype.handleRightKey=function(){if(this.end.isCurrentParaBidi){this.movePreviousPosition();}else{this.moveNextPosition();}this.checkForCursorVisibility();};/**
     * Handles end key.
     *
     * @private
     * @returns {void}
     */Selection.prototype.handleEndKey=function(){this.moveToLineEnd();this.checkForCursorVisibility();};/**
     * Handles home key.
     *
     * @private
     * @returns {void}
     */Selection.prototype.handleHomeKey=function(){this.moveToLineStart();this.checkForCursorVisibility();};/**
     * Handles down key.
     *
     * @private
     * @returns {void}
     */Selection.prototype.handleDownKey=function(){this.isMoveDownOrMoveUp=true;this.moveDown();this.isMoveDownOrMoveUp=false;this.checkForCursorVisibility();};/**
     * Handles shift end key.
     *
     * @private
     * @returns {void}
     */Selection.prototype.handleShiftEndKey=function(){this.extendToLineEnd();this.checkForCursorVisibility();};/**
     * Handles shift home key.
     *
     * @private
     * @returns {void}
     */Selection.prototype.handleShiftHomeKey=function(){this.extendToLineStart();this.checkForCursorVisibility();};/**
     * Handles control shift end key.
     *
     * @private
     * @returns {void}
     */Selection.prototype.handleControlShiftEndKey=function(){var documentEnd=undefined;if(!sf.base.isNullOrUndefined(this.owner.documentEnd)){documentEnd=this.owner.documentEnd;}if(!sf.base.isNullOrUndefined(documentEnd)){this.end.setPosition(documentEnd.currentWidget,false);this.fireSelectionChanged(true);}this.checkForCursorVisibility();};/**
     * Handles control shift home key.
     *
     * @private
     * @returns {void}
     */Selection.prototype.handleControlShiftHomeKey=function(){var documentStart=undefined;if(!sf.base.isNullOrUndefined(this.owner.documentStart)){documentStart=this.owner.documentStart;}if(!sf.base.isNullOrUndefined(documentStart)){this.end.setPositionInternal(documentStart);this.fireSelectionChanged(true);}this.checkForCursorVisibility();};/**
     * @private
     * @returns {void}
     */Selection.prototype.handleSpaceBarKey=function(){if(this.owner.documentHelper.isDocumentProtected&&this.owner.documentHelper.protectionType==='FormFieldsOnly'&&this.getFormFieldType()==='CheckBox'){this.owner.editor.toggleCheckBoxFormField(this.getCurrentFormField());}};/**
     * Handles tab key.
     *
     * @param isNavigateInCell
     * @param isShiftTab
     * @private
     * @returns {void}
     */Selection.prototype.handleTabKey=function(isNavigateInCell,isShiftTab){var start=this.start;if(sf.base.isNullOrUndefined(start)){return;}if(start.paragraph.isInsideTable&&this.end.paragraph.isInsideTable&&(isNavigateInCell||isShiftTab)){//Perform tab navigation
if(!this.owner.documentHelper.isDocumentProtected&&!(this.documentHelper.protectionType==='FormFieldsOnly')){if(isShiftTab){this.selectPreviousCell();}else{this.selectNextCell();}}}else if((isNavigateInCell||isShiftTab)&&!sf.base.isNullOrUndefined(start)&&start.offset===this.getStartOffset(start.paragraph)&&!sf.base.isNullOrUndefined(start.paragraph.paragraphFormat)&&!sf.base.isNullOrUndefined(start.paragraph.paragraphFormat.listFormat)&&start.paragraph.paragraphFormat.listFormat.listId!==-1&&!this.owner.isReadOnlyMode){this.owner.editorModule.updateListLevel(isShiftTab?false:true);}else if(!this.owner.isReadOnlyMode&&!this.documentHelper.isFormFillProtectedMode){this.owner.editorModule.handleTextInput('\t');}if(this.documentHelper.protectionType==='FormFieldsOnly'&&this.documentHelper.formFields.length>0){this.selectPrevNextFormField(!isShiftTab);}this.checkForCursorVisibility();};// returns current field in FormFill mode
Selection.prototype.getFormFieldInFormFillMode=function(){var currentStart=this.owner.selection.start;var formField;for(var i=this.documentHelper.formFields.length-1;i>=0;i--){if(!this.documentHelper.formFields[i].formFieldData.enabled){continue;}var paraIndex=this.getElementPosition(this.documentHelper.formFields[i]).startPosition;if(paraIndex.isExistBefore(currentStart)){formField=this.documentHelper.formFields[i];break;}else if(i===0){formField=this.documentHelper.formFields[this.documentHelper.formFields.length-1];}}return formField;};// Navigates & Selects next form field
Selection.prototype.selectPrevNextFormField=function(forward,formField){if(this.documentHelper.isFormFillProtectedMode){if(!formField){formField=this.getCurrentFormField();}var index=this.documentHelper.formFields.indexOf(formField);if(forward){for(var i=index;;i++){if(i===this.documentHelper.formFields.length-1){i=0;}else{i=i+1;}if(!this.documentHelper.formFields[i].formFieldData.enabled){i=i-1;continue;}this.selectFieldInternal(this.documentHelper.formFields[i]);break;}}else{for(var i=index;;i--){if(i===0){i=this.documentHelper.formFields.length-1;}else{i=i-1;}if(!this.documentHelper.formFields[i].formFieldData.enabled){i=i+1;continue;}this.selectFieldInternal(this.documentHelper.formFields[i]);break;}}}};/**
     * @private
     * @returns {void}
     */Selection.prototype.navigateToNextFormField=function(){var currentStart=this.owner.selection.end;var currentFormField;for(var i=0;i<this.documentHelper.formFields.length;i++){currentFormField=this.documentHelper.formFields[i];if(!this.documentHelper.formFields[i].formFieldData.enabled){continue;}var paraIndex=this.getElementPosition(this.documentHelper.formFields[i]).startPosition;if(paraIndex.isExistAfter(currentStart)){if(currentFormField.formFieldData instanceof TextFormField&&currentFormField.formFieldData.type==='Text'&&this.documentHelper.isInlineFormFillProtectedMode){this.selectTextElementStartOfField(this.documentHelper.formFields[i]);}else{this.selectFieldInternal(this.documentHelper.formFields[i]);}break;}else if(i===this.documentHelper.formFields.length-1){currentFormField=this.documentHelper.formFields[0];if(currentFormField.formFieldData instanceof TextFormField&&currentFormField.formFieldData.type==='Text'&&this.documentHelper.isInlineFormFillProtectedMode){this.selectTextElementStartOfField(this.documentHelper.formFields[0]);}else{this.selectFieldInternal(this.documentHelper.formFields[0]);}}}};/**
     * @private
     * @returns {void}
     */Selection.prototype.selectTextElementStartOfField=function(formField){var fieldSeparator=formField.fieldSeparator;var element=fieldSeparator.nextElement;if(element){while(!(element instanceof TextElementBox)){element=element.nextElement;}var offset=formField.line.getOffset(element,0);var point=this.getPhysicalPositionInternal(formField.line,offset,false);this.selectInternal(formField.line,element,0,point);}};Selection.prototype.triggerFormFillEvent=function(){var previousField=this.previousSelectedFormField;var currentField=this.getCurrentFormField();var previousFieldData;var currentFieldData;if(currentField!==previousField&&previousField&&previousField.formFieldData instanceof TextFormField&&previousField.formFieldData.type==='Text'){if(previousField.formFieldData.format!==''&&!this.isFormatUpdated){// Need to handle update form field format
this.owner.editor.applyFormTextFormat(previousField);}previousFieldData={'fieldName':previousField.formFieldData.name,'value':this.owner.editorModule.getFormFieldText(previousField)};// this.owner.trigger('afterFormFieldFill', previousFieldData);
}if(currentField!==previousField&&currentField&&currentField.formFieldData instanceof TextFormField&&currentField.formFieldData.type==='Text'){currentFieldData={'fieldName':currentField.formFieldData.name,'value':this.owner.editorModule.getFormFieldText(currentField)};// this.owner.trigger('beforeFormFieldFill', currentFieldData);
}};Selection.prototype.selectPreviousCell=function(){var tableCell=this.start.paragraph.associatedCell;var tableRow=tableCell.ownerRow;var tableAdv=tableRow.ownerTable;if(sf.base.isNullOrUndefined(tableCell.previousWidget)){if(!sf.base.isNullOrUndefined(tableRow.previousRenderedWidget)){//Move text selection or cursor to previous row's last cell
var prevRow=undefined;if(tableRow.previousRenderedWidget instanceof TableRowWidget){prevRow=tableRow.previousRenderedWidget;}this.selectTableCellInternal(prevRow.childWidgets[prevRow.childWidgets.length-1],true);}}else{//Move text selection or cursor to next cell in current row
var prevCell=undefined;if(tableCell.previousWidget instanceof TableCellWidget){prevCell=tableCell.previousWidget;}this.selectTableCellInternal(prevCell,true);}};Selection.prototype.selectNextCell=function(){var tableCell=this.start.paragraph.associatedCell;var tableRow=tableCell.ownerRow;var tableAdv=tableRow.ownerTable;if(sf.base.isNullOrUndefined(tableCell.nextWidget)){if(sf.base.isNullOrUndefined(tableRow.nextRenderedWidget)&&!this.owner.isReadOnlyMode){//Insert new row below                  
this.owner.editorModule.insertRow(false);}else{//Move text selection or cursor to next row's first cell
var nextRow=undefined;if(tableRow.nextRenderedWidget instanceof TableRowWidget){nextRow=tableRow.nextRenderedWidget;}this.selectTableCellInternal(nextRow.childWidgets[0],true);}// }
}else{//Move text selection or cursor to next cell in current row
var nextCell=undefined;if(tableCell.nextRenderedWidget instanceof TableCellWidget){nextCell=tableCell.nextRenderedWidget;}this.selectTableCellInternal(nextCell,true);}};/**
     * Select given table cell
     *
     * @private
     * @returns {void}
     */Selection.prototype.selectTableCellInternal=function(tableCell,clearMultiSelection){var firstParagraph=this.getFirstParagraph(tableCell);var lastParagraph=this.getLastParagraph(tableCell);if(firstParagraph===lastParagraph&&lastParagraph.isEmpty()){this.selectParagraphInternal(lastParagraph,true);}else{var firstLineWidget=lastParagraph.childWidgets[0];this.start.setPosition(firstParagraph.childWidgets[0],true);this.end.setPositionParagraph(firstLineWidget,firstLineWidget.getEndOffset());this.fireSelectionChanged(true);}};/**
     * Select while table
     *
     * @private
     * @returns {void}
     */Selection.prototype.selectTableInternal=function(){var start=this.start;var end=this.end;if(!this.isForward){start=this.end;end=this.start;}if(!sf.base.isNullOrUndefined(start)&&!sf.base.isNullOrUndefined(end)&&!sf.base.isNullOrUndefined(this.getTable(start,end))){var containerCell=this.getContainerCellOf(start.paragraph.associatedCell,end.paragraph.associatedCell);var table=containerCell.ownerTable;var firstPara=this.getFirstParagraphBlock(table);var lastPara=this.getLastParagraphBlock(table);var offset=lastPara.lastChild.getEndOffset();this.start.setPosition(firstPara.childWidgets[0],true);this.end.setPositionParagraph(lastPara.lastChild,offset+1);}this.selectPosition(this.start,this.end);};/**
     * Select single column
     *
     * @private
     * @returns {void}
     */Selection.prototype.selectColumnInternal=function(){var startTextPos=this.start;var endTextPos=this.end;if(!this.isForward){startTextPos=this.end;endTextPos=this.start;}if(!sf.base.isNullOrUndefined(startTextPos)&&!sf.base.isNullOrUndefined(endTextPos)&&!sf.base.isNullOrUndefined(this.getTable(startTextPos,endTextPos))){var containerCell=this.getContainerCellOf(startTextPos.paragraph.associatedCell,endTextPos.paragraph.associatedCell);if(containerCell.ownerTable.contains(endTextPos.paragraph.associatedCell)){var startCell=this.getSelectedCell(startTextPos.paragraph.associatedCell,containerCell);var endCell=this.getSelectedCell(endTextPos.paragraph.associatedCell,containerCell);if(this.containsCell(containerCell,endTextPos.paragraph.associatedCell)){var row=startCell.ownerRow;var columnCells=containerCell.ownerTable.getColumnCellsForSelection(containerCell,containerCell);if(columnCells.length>0){var firstPara=this.getFirstParagraph(columnCells[0]);var lastPara=this.getLastParagraph(columnCells[columnCells.length-1]);this.start.setPosition(firstPara.firstChild,true);var lastLine=lastPara.lastChild;this.end.setPositionParagraph(lastLine,lastLine.getEndOffset()+1);}}else{var startCellColumnCells=containerCell.ownerTable.getColumnCellsForSelection(startCell,startCell);var endCellColumnCells=containerCell.ownerTable.getColumnCellsForSelection(endCell,endCell);if(startCellColumnCells.length>0&&endCellColumnCells.length>0){var firstPara=this.getFirstParagraph(startCellColumnCells[0]);var lastPara=this.getLastParagraph(endCellColumnCells[endCellColumnCells.length-1]);this.start.setPosition(firstPara.firstChild,true);var lastLine=lastPara.lastChild;this.end.setPositionParagraph(lastLine,lastLine.getEndOffset()+1);}}}}this.selectPosition(this.start,this.end);};/**
     * Select single row
     *
     * @private
     * @returns {void}
     */Selection.prototype.selectTableRow=function(){var startPos=this.start;var endPos=this.end;if(!this.isForward){startPos=this.end;endPos=this.start;}if(!sf.base.isNullOrUndefined(startPos)&&!sf.base.isNullOrUndefined(endPos)&&!sf.base.isNullOrUndefined(this.getTable(startPos,endPos))){var containerCell=void 0;containerCell=this.getContainerCellOf(startPos.paragraph.associatedCell,endPos.paragraph.associatedCell);if(containerCell.ownerTable.contains(endPos.paragraph.associatedCell)){var startCell=this.getSelectedCell(startPos.paragraph.associatedCell,containerCell);var endCell=this.getSelectedCell(endPos.paragraph.associatedCell,containerCell);if(this.containsCell(containerCell,endPos.paragraph.associatedCell)){var row=startCell.ownerRow;var firstPara=this.getFirstParagraph(row.childWidgets[0]);var lastPara=this.getLastParagraph(row.childWidgets[row.childWidgets.length-1]);this.start.setPosition(firstPara.firstChild,true);this.end.setPositionParagraph(lastPara.lastChild,lastPara.lastChild.getEndOffset()+1);}else{var firstPara=this.getFirstParagraph(startCell.ownerRow.childWidgets[0]);var lastPara=void 0;lastPara=this.getLastParagraph(endCell.ownerRow.childWidgets[endCell.ownerRow.childWidgets.length-1]);this.start.setPosition(firstPara.firstChild,true);this.end.setPositionParagraph(lastPara.lastChild,lastPara.lastChild.getEndOffset()+1);}}}this.selectPosition(this.start,this.end);};/**
     * Select single cell
     *
     * @private
     * @returns {void}
     */Selection.prototype.selectTableCell=function(){var start=this.start;var end=this.end;if(!this.isForward){start=this.end;end=this.start;}if(sf.base.isNullOrUndefined(this.getTable(start,end))){return;}if(this.isEmpty){if(start.paragraph.isInsideTable&&!sf.base.isNullOrUndefined(start.paragraph.associatedCell)){var firstPara=this.getFirstParagraph(start.paragraph.associatedCell);var lastPara=this.getLastParagraph(end.paragraph.associatedCell);if(firstPara===lastPara){this.start.setPosition(lastPara.firstChild,true);this.end.setPositionParagraph(lastPara.lastChild,lastPara.lastChild.getEndOffset()+1);}else{this.start.setPosition(firstPara.firstChild,true);this.end.setPositionParagraph(lastPara.lastChild,lastPara.lastChild.getEndOffset()+1);}}}else{var containerCell=this.getContainerCell(start.paragraph.associatedCell);if(this.containsCell(containerCell,start.paragraph.associatedCell)&&this.containsCell(containerCell,end.paragraph.associatedCell)){var firstPara=this.getFirstParagraph(containerCell);var lastPara=this.getLastParagraph(containerCell);if(!sf.base.isNullOrUndefined(firstPara)&&!sf.base.isNullOrUndefined(lastPara)){this.start.setPosition(firstPara.firstChild,true);this.end.setPositionParagraph(lastPara.lastChild,lastPara.lastChild.getEndOffset()+1);}}}this.selectPosition(this.start,this.end);};/**
     * Selects the entire document.
     *
     * @returns {void}
     */Selection.prototype.selectAll=function(){var documentStart;var documentEnd;this.documentHelper.skipScrollToPosition=true;var container=this.getContainerWidget(this.start.paragraph);if(this.owner.enableHeaderAndFooter){var headerFooter=this.getContainerWidget(this.start.paragraph);documentStart=this.setPositionForBlock(headerFooter.firstChild,true);documentEnd=this.setPositionForBlock(headerFooter.lastChild,false);}else if(this.isInShape){var textFrame=this.getCurrentTextFrame();documentStart=this.setPositionForBlock(textFrame.firstChild,true);documentEnd=this.setPositionForBlock(textFrame.lastChild,false);}else if(container instanceof FootNoteWidget&&container.footNoteType==='Footnote'){var i=void 0;var j=void 0;var pageLength=this.documentHelper.pages.length;for(i=0;i<=pageLength-1;i++){if(sf.base.isNullOrUndefined(this.documentHelper.pages[i].footnoteWidget)){continue;}else{documentStart=this.setPositionForBlock(this.documentHelper.pages[i].footnoteWidget.firstChild,true);break;}}for(j=pageLength-1;j>=0;j--){if(sf.base.isNullOrUndefined(this.documentHelper.pages[j].footnoteWidget)){continue;}else{var child=this.documentHelper.pages[j].footnoteWidget.childWidgets.length;documentEnd=this.setPositionForBlock(this.documentHelper.pages[j].footnoteWidget.childWidgets[child-1],false);break;}}}else if(container instanceof FootNoteWidget&&container.footNoteType==='Endnote'){var endNotes=this.getContainerWidget(this.start.paragraph);documentStart=this.setPositionForBlock(endNotes.firstChild,true);documentEnd=this.setPositionForBlock(endNotes.lastChild,false);}else{documentStart=this.owner.documentStart;documentEnd=this.owner.documentEnd;}//Selects the entire document.        
if(!sf.base.isNullOrUndefined(documentStart)){this.start.setPositionInternal(documentStart);this.end.setPositionParagraph(documentEnd.currentWidget,documentEnd.offset+1);this.upDownSelectionLength=this.end.location.x;this.fireSelectionChanged(true);}};/**
     * Extends selection backward.
     *
     * @returns {void}
     */Selection.prototype.extendBackward=function(){if(sf.base.isNullOrUndefined(this.start)){return;}var isForward=this.isForward?this.start.isCurrentParaBidi:this.end.isCurrentParaBidi;if(isForward){this.end.moveForward();}else{this.end.moveBackward();}this.upDownSelectionLength=this.end.location.x;this.fireSelectionChanged(true);};/**
     * Extends selection forward.
     *
     * @returns {void}
     */Selection.prototype.extendForward=function(){if(sf.base.isNullOrUndefined(this.start)){return;}var isForward=this.isForward?this.start.isCurrentParaBidi:this.end.isCurrentParaBidi;if(isForward){this.end.moveBackward();}else{this.end.moveForward();}this.upDownSelectionLength=this.end.location.x;this.fireSelectionChanged(true);};/**
     * Extend selection to word start and end
     *
     * @private
     * @returns {void}
     */Selection.prototype.extendToWordStartEnd=function(){if((this.start.paragraph.isInsideTable||this.end.paragraph.isInsideTable)&&(this.start.paragraph.associatedCell!==this.end.paragraph.associatedCell||this.isCellSelected(this.start.paragraph.associatedCell,this.start,this.end))){return true;}return false;};/**
     * Extends selection to word start.
     *
     * @returns {void}
     */Selection.prototype.extendToWordStart=function(){this.extendToWordStartInternal(false);};Object.defineProperty(Selection.prototype,"sfdt",{/**
         * Gets the selected content of the document as SFDT(Syncfusion Document Text) file format.
         *
         * @default undefined
         * @returns {string}
         */get:function get(){if(this.owner.editorModule&&this.start.offset!==this.end.offset){return JSON.stringify(this.writeSfdt());}else{return null;}},enumerable:true,configurable:true});/**
     * Extends selection to word end.
     *
     * @returns {void}
     */Selection.prototype.extendToWordEnd=function(){this.extendToWordEndInternal(false);};/**
     * Extends selection to word start
     *
     * @private
     * @returns {void}
     */Selection.prototype.extendToWordStartInternal=function(isNavigation){if(sf.base.isNullOrUndefined(this.start)){return;}var isCellSelected=this.extendToWordStartEnd();if(isCellSelected){this.end.moveToPreviousParagraphInTable(this);}else{if(isNavigation&&this.end.isCurrentParaBidi){this.end.moveToWordEndInternal(isNavigation?0:1,false);}else{this.end.moveToWordStartInternal(isNavigation?0:1);}}if(isNavigation){this.start.setPositionInternal(this.end);}this.upDownSelectionLength=this.end.location.x;this.fireSelectionChanged(true);};/**
     * Extends selection to word end.
     *
     * @returns {void}
     */Selection.prototype.extendToWordEndInternal=function(isNavigation){if(sf.base.isNullOrUndefined(this.start)){return;}var isCellSelect=this.extendToWordStartEnd();if(isCellSelect){this.end.moveToNextParagraphInTable();}else{if(isNavigation&&this.end.isCurrentParaBidi){this.end.moveToWordStartInternal(isNavigation?0:1);}else{this.end.moveToWordEndInternal(isNavigation?0:1,false);}}if(isNavigation){this.start.setPositionInternal(this.end);}this.upDownSelectionLength=this.end.location.x;this.fireSelectionChanged(true);};/**
     * Extend selection to next line.
     *
     * @returns {void}
     */Selection.prototype.extendToNextLine=function(){if(sf.base.isNullOrUndefined(this.start)){return;}this.end.moveToNextLine(this.upDownSelectionLength);this.fireSelectionChanged(true);};//Selection Text get API
//Selection add, Highlight, remove API enda
Selection.prototype.getTextPosition=function(hierarchicalIndex){var textPosition=new TextPosition(this.owner);textPosition.setPositionForCurrentIndex(hierarchicalIndex);return textPosition;};/**
     * Get Selected text
     *
     * @private
     * @returns {void}
     */Selection.prototype.getText=function(includeObject){if(sf.base.isNullOrUndefined(this.start)||sf.base.isNullOrUndefined(this.end)||sf.base.isNullOrUndefined(this.start.paragraph)||sf.base.isNullOrUndefined(this.end.paragraph)){return undefined;}var startPosition=this.start;var endPosition=this.end;if(startPosition.isAtSamePosition(endPosition)){return'';}return this.getTextInternal(startPosition,endPosition,includeObject);};/**
     * Get selected text
     *
     * @private
     * @returns {string}
     */Selection.prototype.getTextInternal=function(start,end,includeObject){if(start.isExistAfter(end)){var temp=end;end=start;start=temp;}var startPosition=start;var endPosition=end;if(!sf.base.isNullOrUndefined(start)&&!sf.base.isNullOrUndefined(end)&&!sf.base.isNullOrUndefined(start.paragraph)&&!sf.base.isNullOrUndefined(end.paragraph)){var startIndex=0;var endIndex=0;var startOffset=start.offset;var endOffset=end.offset;var startInlineObj=start.currentWidget.getInline(startOffset,startIndex);startIndex=startInlineObj.index;var inline=startInlineObj.element;// If the start position is at the beginning of field begin that has field end, then field code should be skipped.
if(inline instanceof FieldElementBox&&!sf.base.isNullOrUndefined(inline.fieldEnd)){var elementInfo=this.getRenderedInline(inline,startIndex);inline=elementInfo.element;startIndex=elementInfo.index;}var endInlineObj=end.currentWidget.getInline(endOffset,endIndex);var endInline=endInlineObj.element;endIndex=endInlineObj.index;var text='';// Retrieves the text from start inline.
if(inline instanceof ImageElementBox&&includeObject&&startIndex===0){text=ElementBox.objectCharacter;}else if(inline instanceof TextElementBox){text=sf.base.isNullOrUndefined(inline.text)||inline.text===''||inline.text.length<startIndex?text:inline.text.substring(startIndex);}if(startPosition.paragraph===endPosition.paragraph){if(inline instanceof ElementBox){if(inline===endInline&&inline instanceof TextElementBox){text=text.length<endIndex-startIndex?text:text.substring(0,endIndex-startIndex);}else if(inline.nextNode instanceof ElementBox){text=text+this.getTextInline(inline.nextNode,endPosition.paragraph,endInline,endIndex,includeObject);}}}else{if(inline instanceof ElementBox&&inline.nextNode instanceof ElementBox){text=text+this.getTextInline(inline.nextNode,endPosition.paragraph,undefined,0,includeObject);}else{var nextParagraphWidget=this.documentHelper.selection.getNextParagraphBlock(startPosition.paragraph);text=text+'\r';while(!sf.base.isNullOrUndefined(nextParagraphWidget)&&nextParagraphWidget.isEmpty()){text=text+'\r';if(nextParagraphWidget===endPosition.paragraph){return text;}nextParagraphWidget=this.documentHelper.selection.getNextParagraphBlock(nextParagraphWidget);}if(!sf.base.isNullOrUndefined(nextParagraphWidget)&&!nextParagraphWidget.isEmpty()){text=text+this.getTextInline(nextParagraphWidget.childWidgets[0].children[0],endPosition.paragraph,endInline,endIndex,includeObject);}}}// If the selection includes end paragraph mark.
if(endOffset===endPosition.currentWidget.getEndOffset()+1){text=text+'\r';}return text;}return undefined;};/**
     * @private
     * @param block
     * @param offset
     * @returns {string}
     */Selection.prototype.getHierarchicalIndex=function(block,offset){var index;if(block){if(block instanceof HeaderFooterWidget){var hfString=block.headerFooterType.indexOf('Header')!==-1?'H':'F';var pageIndex=block.page.index.toString();// let headerFooterIndex: string = (this.viewer as PageLayoutViewer).getHeaderFooter(block.headerFooterType).toString();
var sectionIndex=block.page.sectionIndex;index=sectionIndex+';'+hfString+';'+pageIndex+';'+offset;}else{index=block.index+';'+offset;}if(block instanceof TextFrame){var indexInOwner=block.containerShape.indexInOwner.toString();index='S'+';'+indexInOwner+';'+offset;return this.getHierarchicalIndex(block.containerShape.paragraph,index);}if(block instanceof FootNoteWidget){// index = block.index + ';' + index;
//block = block.containerWidget;
var hfString=block.footNoteType==='Footnote'?'FN':'EN';var pageIndex=block.page.index.toString();// let headerFooterIndex: string = (this.viewer as PageLayoutViewer).getHeaderFooter(block.headerFooterType).toString();
var sectionIndex=block.page.sectionIndex;index=sectionIndex+';'+hfString+';'+pageIndex+';'+offset;}if(block.containerWidget){if(block instanceof TableCellWidget&&block.rowIndex!==block.containerWidget.index){index=block.rowIndex+';'+index;block=block.containerWidget;}return this.getHierarchicalIndex(block.containerWidget,index);}}return index;};/**
     * @private
     * @returns {string}
     */Selection.prototype.getHierarchicalIndexByPosition=function(position){var info=this.getParagraphInfo(position);return this.getHierarchicalIndex(info.paragraph,info.offset.toString());};/**
     * @private
     * @returns {TextPosition}
     */Selection.prototype.getTextPosBasedOnLogicalIndex=function(hierarchicalIndex){var textPosition=new TextPosition(this.owner);var blockInfo=this.getParagraph({index:hierarchicalIndex});var lineInfo=this.getLineInfoBasedOnParagraph(blockInfo.paragraph,blockInfo.offset);textPosition.setPositionForLineWidget(lineInfo.line,lineInfo.offset);return textPosition;};/**
     * Get offset value to update in selection
     *
     * @private
     * @returns {LineInfo}
     */Selection.prototype.getLineInfoBasedOnParagraph=function(paragraph,offset){var length=this.getParagraphLength(paragraph);var next=paragraph.nextSplitWidget;if(offset>length+1&&sf.base.isNullOrUndefined(next)){offset=length;}while(offset>length&&next instanceof ParagraphWidget){offset-=length;paragraph=next;length=this.getParagraphLength(paragraph);next=paragraph.nextSplitWidget;}return this.getLineInfo(paragraph,offset);};/**
     * @private
     * @returns {ParagraphInfo}
     */Selection.prototype.getParagraph=function(position){var paragraph=this.getParagraphInternal(this.getBodyWidget(position),position);return{paragraph:paragraph,offset:parseInt(position.index,10)};};/**
     * Gets body widget based on position.
     *
     * @private
     * @returns {BlockContainer}
     */Selection.prototype.getBodyWidget=function(position){var index=position.index.indexOf(';');var value=position.index.substring(0,index);position.index=position.index.substring(index).replace(';','');var sectionIndex=parseInt(value,10);index=parseInt(value,10);index=position.index.indexOf(';');value=position.index.substring(0,index);// position = position.substring(index).replace(';', '');
if(value==='H'||value==='F'){return this.getHeaderFooterWidget(position);}else if(value==='FN'||value==='EN'){return this.getFootNoteWidget(position);}index=parseInt(value,10);return this.getBodyWidgetInternal(sectionIndex,index);};Selection.prototype.getFootNoteWidget=function(position){var index1=position.index.indexOf(';');var value1=position.index.substring(0,index1);position.index=position.index.substring(index1).replace(';','');var footNote=value1==='FN';index1=position.index.indexOf(';');value1=position.index.substring(0,index1);position.index=position.index.substring(index1).replace(';','');index1=parseInt(value1,10);var page=this.documentHelper.pages[index1];if(footNote){return page.footnoteWidget;}else{return page.endnoteWidget;}};Selection.prototype.getHeaderFooterWidget=function(position){//HEADER OR FOOTER WIDGET
var index=position.index.indexOf(';');var value=position.index.substring(0,index);position.index=position.index.substring(index).replace(';','');var isHeader=value==='H';index=position.index.indexOf(';');value=position.index.substring(0,index);position.index=position.index.substring(index).replace(';','');index=parseInt(value,10);var page=this.documentHelper.pages[index];if(isHeader){return page.headerWidget;}else{return page.footerWidget;}};/**
     * @private
     * @returns {BodyWidget}
     */Selection.prototype.getBodyWidgetInternal=function(sectionIndex,blockIndex){for(var i=0;i<this.documentHelper.pages.length;i++){var bodyWidget=this.documentHelper.pages[i].bodyWidgets[0];if(bodyWidget.index===sectionIndex){if(bodyWidget.childWidgets.length>0&&bodyWidget.firstChild.index<=blockIndex&&bodyWidget.lastChild.index>=blockIndex){return bodyWidget;}}if(bodyWidget.index>sectionIndex){break;}}return undefined;};Selection.prototype.getParagraphInternal=function(container,position){if(sf.base.isNullOrUndefined(position.index)){return undefined;}// let ins: Widget = container;
var index=position.index.indexOf(';');var value='0';if(index>=0){value=position.index.substring(0,index);position.index=position.index.substring(index).replace(';','');}// if (container instanceof BodyWidget && value === 'HF') {
//     return this.getParagraph(container.headerFooters, position);
// }
index=parseInt(value,10);if(container instanceof TableRowWidget&&index>=container.childWidgets.length){position.index='0;0';index=container.childWidgets.length-1;}var childWidget=this.getBlockByIndex(container,index);if(childWidget){value=position.index.substring(0,1);if(value==='S'){position.index=position.index.substring(1).replace(';','');var indexInOwner=position.index.substring(0,1);position.index=position.index.substring(1).replace(';','');var paraIndex=position.index.substring(0,1);position.index=position.index.substring(1).replace(';','');childWidget=childWidget.floatingElements[indexInOwner].textFrame.childWidgets[paraIndex];}var child=childWidget;if(child instanceof ParagraphWidget){if(position.index.indexOf(';')>0){position.index='0';}return child;}if(child instanceof Widget){if(position.index.indexOf(';')>0){return this.getParagraphInternal(child,position);}else{//If table is shifted to previous text position then return the first paragraph within table.
if(child instanceof TableWidget){return this.documentHelper.selection.getFirstParagraphInFirstCell(child);}return undefined;}}}else if(container){var nextWidget=container.getSplitWidgets().pop().nextRenderedWidget;if(nextWidget instanceof Widget){position.index='0';if(nextWidget instanceof TableWidget){return this.documentHelper.selection.getFirstParagraphInFirstCell(nextWidget);}return nextWidget;}}return undefined;};/**
     * @private
     * @returns {Widget}
     */Selection.prototype.getBlockByIndex=function(container,blockIndex){var childWidget;if(container){for(var j=0;j<container.childWidgets.length;j++){if(container.childWidgets[j].index===blockIndex){childWidget=container.childWidgets[j];break;}}if(!childWidget&&!(container instanceof HeaderFooterWidget)){return this.getBlockByIndex(container.nextSplitWidget,blockIndex);}}return childWidget;};/**
     * Get logical offset of paragraph.
     *
     * @private
     * @returns {ParagraphInfo}
     */Selection.prototype.getParagraphInfo=function(position){return this.getParagraphInfoInternal(position.currentWidget,position.offset);};/**
     * @private
     * @returns {ParagraphInfo}
     */Selection.prototype.getParagraphInfoInternal=function(line,lineOffset){var paragraph=line.paragraph;var offset=this.getParagraphLength(paragraph,line)+lineOffset;var previous=paragraph.previousSplitWidget;while(previous instanceof ParagraphWidget){paragraph=previous;offset+=this.documentHelper.selection.getParagraphLength(paragraph);previous=paragraph.previousSplitWidget;}return{'paragraph':paragraph,'offset':offset};};/**
     * @private
     * @returns {ListTextElementBox}
     */Selection.prototype.getListTextElementBox=function(paragarph){if(sf.base.isNullOrUndefined(paragarph)){return undefined;}var listTextElement;if(!paragarph.isEmpty()){var lineWidget=paragarph.childWidgets[0];if(lineWidget.children.length>1){if(lineWidget.children[0]instanceof ListTextElementBox){listTextElement=lineWidget.children[0];}}}return listTextElement;};/**
     * @private
     * @returns {WListLevel}
     */Selection.prototype.getListLevel=function(paragraph){var currentList=undefined;var listLevelNumber=0;if(!sf.base.isNullOrUndefined(paragraph.paragraphFormat)&&!sf.base.isNullOrUndefined(paragraph.paragraphFormat.listFormat)){currentList=this.documentHelper.getListById(paragraph.paragraphFormat.listFormat.listId);listLevelNumber=paragraph.paragraphFormat.listFormat.listLevelNumber;}if(!sf.base.isNullOrUndefined(currentList)&&!sf.base.isNullOrUndefined(this.documentHelper.getAbstractListById(currentList.abstractListId))// && !isNullOrUndefined(this.documentHelper.getAbstractListById(currentList.abstractListId).levels.getItem(listLevelNumber))) {
&&!sf.base.isNullOrUndefined(this.documentHelper.getAbstractListById(currentList.abstractListId).levels)){return this.documentHelper.layout.getListLevel(currentList,listLevelNumber);}return undefined;};Selection.prototype.getTextInline=function(inlineElement,endParagraphWidget,endInline,endIndex,includeObject){var text='';do{if(inlineElement===endInline){if(inlineElement instanceof TextElementBox){var span=inlineElement;if(!(sf.base.isNullOrUndefined(span.text)||span.text==='')){if(span.text.length<endIndex){text=text+span.text;}else{text=text+span.text.substring(0,endIndex);}}}else if(inlineElement instanceof ImageElementBox&&includeObject&&endIndex===inlineElement.length){text=text+ElementBox.objectCharacter;}return text;}if(inlineElement instanceof TextElementBox){text=text+inlineElement.text;}else if(inlineElement instanceof ImageElementBox&&includeObject){text=text+ElementBox.objectCharacter;}else if(inlineElement instanceof FieldElementBox&&!sf.base.isNullOrUndefined(inlineElement.fieldEnd)){if(!sf.base.isNullOrUndefined(inlineElement.fieldSeparator)){inlineElement=inlineElement.fieldSeparator;}else{inlineElement=inlineElement.fieldEnd;}}if(sf.base.isNullOrUndefined(inlineElement.nextNode)){break;}inlineElement=inlineElement.nextNode;}while(!sf.base.isNullOrUndefined(inlineElement));if(endParagraphWidget===inlineElement.line.paragraph){return text;}var nextParagraphWidget=this.documentHelper.selection.getNextParagraphBlock(inlineElement.line.paragraph);while(!sf.base.isNullOrUndefined(nextParagraphWidget)&&nextParagraphWidget.isEmpty()){text=text+'\r';if(nextParagraphWidget===endParagraphWidget){return text;}nextParagraphWidget=this.documentHelper.selection.getNextParagraphBlock(nextParagraphWidget);}if(!sf.base.isNullOrUndefined(nextParagraphWidget)&&!nextParagraphWidget.isEmpty()){var lineWidget=nextParagraphWidget.childWidgets[0];text=text+'\r'+this.getTextInline(lineWidget.children[0],endParagraphWidget,endInline,endIndex,includeObject);}return text;};/**
     * Returns field code.
     *
     * @private
     * @param fieldBegin
     * @returns {string}
     */Selection.prototype.getFieldCode=function(fieldBegin){var fieldCode='';if(!(fieldBegin.fieldEnd instanceof FieldElementBox)){return fieldCode;}var paragraph=fieldBegin.paragraph;var endParagraph=fieldBegin.fieldEnd.paragraph;if(fieldBegin.fieldSeparator instanceof FieldElementBox){endParagraph=fieldBegin.fieldSeparator.paragraph;}var startLineIndex=fieldBegin.line.indexInOwner;var startIndex=fieldBegin.indexInOwner;do{fieldCode+=this.getFieldCodeInternal(paragraph,startLineIndex,startIndex);if(paragraph===endParagraph){break;}paragraph=this.getNextParagraphBlock(paragraph);startLineIndex=0;startIndex=0;}while(paragraph instanceof ParagraphWidget);return fieldCode.trim();};Selection.prototype.getFieldCodeInternal=function(paragraph,startLineIndex,inlineIndex){var fieldCode='';for(var i=startLineIndex;i<paragraph.childWidgets.length;i++){var line=paragraph.childWidgets[i];for(var i_1=inlineIndex;i_1<line.children.length;i_1++){var element=line.children[i_1];if(element instanceof TextElementBox){fieldCode+=element.text;}if(element instanceof FieldElementBox&&(element.fieldType===2||element.fieldType===1)){return fieldCode;}}inlineIndex=0;}return fieldCode;};/**
     * @private
     * @returns {FieldElementBox}
     */Selection.prototype.getTocFieldInternal=function(){var paragraph=this.start.paragraph;if(!this.isEmpty&&!this.isForward){paragraph=this.end.paragraph;}while(paragraph instanceof ParagraphWidget&&paragraph.childWidgets.length>0){var line=paragraph.firstChild;if(line.children.length>0){var element=line.children[0];var nextElement=element.nextNode;if(element instanceof FieldElementBox&&element.fieldType===0&&nextElement instanceof TextElementBox&&nextElement.text.trim().toLowerCase().indexOf('toc')===0){return element;}}paragraph=paragraph.previousRenderedWidget;}return undefined;};/**
     * Get next paragraph in bodyWidget
     *
     * @private
     * @returns {ParagraphWidget}
     */Selection.prototype.getNextParagraph=function(section){if(section.nextRenderedWidget instanceof BodyWidget){var block=section.nextRenderedWidget.childWidgets[0];return this.getFirstParagraphBlock(block);}return undefined;};/**
     * @private
     * @returns {ParagraphWidget}
     */Selection.prototype.getPreviousParagraph=function(section){if(section.previousRenderedWidget instanceof BodyWidget){var bodyWidget=section.previousRenderedWidget;var block=bodyWidget.childWidgets[bodyWidget.childWidgets.length-1];return this.getLastParagraphBlock(block);}return undefined;};/**
     * Get first paragraph in cell
     *
     * @private
     * @returns {ParagraphWidget}
     */Selection.prototype.getFirstParagraphInCell=function(cell){var firstBlock=cell.childWidgets[0];if(firstBlock instanceof ParagraphWidget){return firstBlock;}else{return this.getFirstParagraphInFirstCell(firstBlock);}};/**
     * Get first paragraph in first cell
     *
     * @private
     * @returns {TableWidget}
     */Selection.prototype.getFirstParagraphInFirstCell=function(table){if(table.childWidgets.length>0){var firstRow=table.childWidgets[0];var cell=firstRow.childWidgets[0];var block=cell.childWidgets[0];return this.getFirstParagraphBlock(block);}return undefined;};/**
     * Get last paragraph in last cell
     *
     * @private
     * @returns {ParagraphWidget}
     */Selection.prototype.getLastParagraphInLastCell=function(table){if(table.childWidgets.length>0){var lastrow=table.lastChild;var lastcell=lastrow.lastChild;var lastBlock=lastcell.lastChild;return this.getLastParagraphBlock(lastBlock);}return undefined;};/**
     * Get last paragraph in first row
     *
     * @private
     * @returns {ParagraphWidget}
     */Selection.prototype.getLastParagraphInFirstRow=function(table){if(table.childWidgets.length>0){var row=table.firstChild;var lastcell=row.lastChild;var lastBlock=lastcell.lastChild;return this.getLastParagraphBlock(lastBlock);}return undefined;};/**
     * Get Next start inline
     *
     * @private
     * @returns {ElementBox}
     */Selection.prototype.getNextStartInline=function(line,offset){var indexInInline=0;var inlineObj=line.getInline(offset,indexInInline);var inline=inlineObj.element;indexInInline=inlineObj.index;if(!sf.base.isNullOrUndefined(inline)&&indexInInline===inline.length&&inline.nextNode instanceof FieldElementBox||inline instanceof ShapeElementBox){var nextValidInline=this.getNextValidElement(inline.nextNode);if(nextValidInline instanceof FieldElementBox&&nextValidInline.fieldType===0){inline=nextValidInline;}}return inline;};/**
     * Get previous text inline
     *
     * @private
     * @returns {ElementBox}
     */Selection.prototype.getPreviousTextInline=function(inline){if(inline.previousNode instanceof TextElementBox){return inline.previousNode;}if(inline.previousNode instanceof FieldElementBox&&HelperMethods.isLinkedFieldCharacter(inline.previousNode)){if(inline.previousNode.fieldType===0||inline.previousNode.fieldType===1){return inline.previousNode;}return inline.previousNode.fieldBegin;}if(!sf.base.isNullOrUndefined(inline.previousNode)){return this.getPreviousTextInline(inline.previousNode);}return undefined;};/**
     * Get next text inline
     *
     * @private
     * @returns {ElementBox}
     */Selection.prototype.getNextTextInline=function(inline){if(inline.nextNode instanceof TextElementBox){return inline.nextNode;}if(inline.nextNode instanceof FieldElementBox&&HelperMethods.isLinkedFieldCharacter(inline.nextNode)){if(inline.nextNode.fieldType===1||inline.nextNode.fieldType===0){return inline.nextNode;}return inline.nextNode.fieldEnd;}if(!sf.base.isNullOrUndefined(inline.nextNode)){return this.getNextTextInline(inline.nextNode);}return undefined;};/**
     * Get container table
     *
     * @private
     * @returns {TableWidget}
     */Selection.prototype.getContainerTable=function(block){if(block.isInsideTable){if(block.associatedCell.ownerTable.isInsideTable){block=this.getContainerTable(block.associatedCell.ownerTable);}else{block=block.associatedCell.ownerTable;}}if(block instanceof TableWidget){return block;}return undefined;};/**
     * @private
     * @returns {boolean}
     */Selection.prototype.isExistBefore=function(start,block){if(start.isInsideTable){var cell1=start.associatedCell;if(block.isInsideTable){var cell2=block.associatedCell;if(cell1===cell2){return cell1.childWidgets.indexOf(start)<cell1.childWidgets.indexOf(block);}if(cell1.ownerRow===cell2.ownerRow){return cell1.cellIndex<cell2.cellIndex;}if(cell1.ownerTable===cell2.ownerTable){return cell1.ownerRow.rowIndex<cell2.ownerRow.rowIndex;}//Checks if current block exists before the block.
var containerCell=this.getContainerCellOf(cell1,cell2);if(containerCell.ownerTable.contains(cell2)){cell1=this.getSelectedCell(cell1,containerCell);cell2=this.getSelectedCell(cell2,containerCell);if(cell1===containerCell){return this.isExistBefore(start,cell2.ownerTable);}if(cell2===containerCell){return this.isExistBefore(cell1.ownerTable,block);}if(containerCell.ownerRow===cell2.ownerRow){return containerCell.cellIndex<cell2.cellIndex;}if(containerCell.ownerTable===cell2.ownerTable){return containerCell.ownerRow.rowIndex<cell2.ownerRow.rowIndex;}return this.isExistBefore(cell1.ownerTable,cell2.ownerTable);}return this.isExistBefore(containerCell.ownerTable,this.getContainerTable(cell2.ownerTable));}else{var ownerTable=this.getContainerTable(start);return this.isExistBefore(ownerTable,block);}}else if(block.isInsideTable){var ownerTable=this.getContainerTable(block);return this.isExistBefore(start,ownerTable);}else{{if(start.containerWidget===block.containerWidget){return start.index<block.index;}if(start.containerWidget instanceof BodyWidget&&block.containerWidget instanceof BodyWidget||start.containerWidget instanceof FootNoteWidget&&block.containerWidget instanceof FootNoteWidget){//Splitted blocks                     
var startPage=this.documentHelper.pages.indexOf(start.containerWidget.page);var endPage=this.documentHelper.pages.indexOf(block.containerWidget.page);return startPage<endPage;}}}return false;};/**
     * @private
     * @returns {boolean}
     */Selection.prototype.isExistAfter=function(start,block){if(start.isInsideTable){var cell1=start.associatedCell;//Current paragraph in cell, paragraph in cell
if(block.isInsideTable){var cell2=block.associatedCell;if(cell1===cell2){return cell1.childWidgets.indexOf(start)>cell1.childWidgets.indexOf(block);}if(cell1.ownerRow===cell2.ownerRow){return cell1.cellIndex>cell2.cellIndex;}if(cell1.ownerTable===cell2.ownerTable){return cell1.ownerRow.rowIndex>cell2.ownerRow.rowIndex;}//Checks if this block exists before block.
var containerCell=this.getContainerCellOf(cell1,cell2);if(containerCell.ownerTable.contains(cell2)){cell1=this.getSelectedCell(cell1,containerCell);cell2=this.getSelectedCell(cell2,containerCell);if(cell1===containerCell){return this.isExistAfter(start,cell2.ownerTable);}if(cell2===containerCell){return this.isExistAfter(cell1.ownerTable,block);}if(containerCell.ownerRow===cell2.ownerRow){return containerCell.cellIndex>cell2.cellIndex;}if(containerCell.ownerTable===cell2.ownerTable){return containerCell.ownerRow.rowIndex>cell2.ownerRow.rowIndex;}return this.isExistAfter(cell1.ownerTable,cell2.ownerTable);}return this.isExistAfter(containerCell.ownerTable,this.getContainerTable(cell2.ownerTable));}else{var ownerTable=this.getContainerTable(start);return this.isExistAfter(ownerTable,block);}}else if(block.isInsideTable){var ownerTable=this.getContainerTable(block);return this.isExistAfter(start,ownerTable);}else{if(start.containerWidget===block.containerWidget){return start.index>block.index;}if(start.containerWidget instanceof BodyWidget&&block.containerWidget instanceof BodyWidget||start.containerWidget instanceof FootNoteWidget&&block.containerWidget instanceof FootNoteWidget){//Splitted blocks                     
var startPage=this.documentHelper.pages.indexOf(start.containerWidget.page);var endPage=this.documentHelper.pages.indexOf(block.containerWidget.page);return startPage>endPage;}//     if (start.owner instanceof WHeaderFooter) {
//         return (start.owner as WHeaderFooter).childWidgets.indexOf(start) 
// > (block.owner as WHeaderFooter).childWidgets.indexOf(block);
//     } else if (start.section === block.section && start.section instanceof WSection) {
//         return (start.section as WSection).childWidgets.indexOf(start)
//  > (start.section as WSection).childWidgets.indexOf(block);
//     } else if (start.wordDocument instanceof WordDocument) {
//         return (start.wordDocument as WordDocument).sections.indexOf(start.section as WSection) > (start.wordDocument as WordDocument).sections.indexOf(block.section as WSection);
}return false;};/**
     * Return true if current inline in exist before inline
     *
     * @private
     * @returns {boolean}
     */Selection.prototype.isExistBeforeInline=function(currentInline,inline){if(currentInline.line===inline.line){return currentInline.line.children.indexOf(currentInline)<=inline.line.children.indexOf(inline);}if(currentInline.line.paragraph===inline.line.paragraph){return currentInline.line.paragraph.childWidgets.indexOf(currentInline.line)<inline.line.paragraph.childWidgets.indexOf(inline.line);}var startParagraph=currentInline.line.paragraph;var endParagraph=inline.line.paragraph;if(startParagraph.containerWidget===endParagraph.containerWidget){if(startParagraph.isInsideTable){return startParagraph.associatedCell.childWidgets.indexOf(startParagraph)<endParagraph.associatedCell.childWidgets.indexOf(endParagraph);}else if(startParagraph.containerWidget instanceof HeaderFooterWidget){// return ((currentInline.owner as WParagraph).owner as WHeaderFooter).blocks.indexOf(currentInline.owner as WParagraph) <
//     ((inline.owner as WParagraph).owner as WHeaderFooter).blocks.indexOf(inline.owner as WParagraph);
}else{return startParagraph.containerWidget.childWidgets.indexOf(startParagraph)<endParagraph.containerWidget.childWidgets.indexOf(endParagraph);}}return this.isExistBefore(startParagraph,endParagraph);};/**
     * Return true id current inline is exist after inline
     *
     * @private
     * @returns {boolean}
     */Selection.prototype.isExistAfterInline=function(currentInline,inline,isRetrieve){if(currentInline.line===inline.line){var selection=this.documentHelper.selection;if(isRetrieve){return currentInline.line.children.indexOf(currentInline)>=inline.line.children.indexOf(inline);}else if(currentInline===inline&&selection.start.offset!==selection.end.offset){return currentInline.line.children.indexOf(currentInline)===inline.line.children.indexOf(inline);}else{return currentInline.line.children.indexOf(currentInline)>inline.line.children.indexOf(inline);}}if(currentInline.line.paragraph===inline.line.paragraph){return currentInline.line.paragraph.childWidgets.indexOf(currentInline.line)>inline.line.paragraph.childWidgets.indexOf(inline.line);}var startParagraph=currentInline.line.paragraph;var endParagraph=inline.line.paragraph;if(startParagraph.containerWidget===endParagraph.containerWidget){if(startParagraph.isInsideTable){return startParagraph.associatedCell.childWidgets.indexOf(startParagraph)>endParagraph.associatedCell.childWidgets.indexOf(endParagraph);}else if(startParagraph.containerWidget instanceof HeaderFooterWidget){// return ((currentInline.owner as WParagraph).owner as WHeaderFooter).blocks.indexOf(currentInline.owner as WParagraph) <
//     ((inline.owner as WParagraph).owner as WHeaderFooter).blocks.indexOf(inline.owner as WParagraph);
}else{return startParagraph.containerWidget.childWidgets.indexOf(startParagraph)>endParagraph.containerWidget.childWidgets.indexOf(endParagraph);}}return this.isExistAfter(startParagraph,endParagraph);};/**
     * Get next rendered block
     *
     * @private
     * @returns {BlockWidget}
     */Selection.prototype.getNextRenderedBlock=function(block){if(sf.base.isNullOrUndefined(block.nextWidget)){return block.nextRenderedWidget;}return block.nextWidget;};/**
     * Get next rendered block
     *
     * @private
     * @returns {BlockWidget}
     */Selection.prototype.getPreviousRenderedBlock=function(block){if(sf.base.isNullOrUndefined(block.previousWidget)){return block.previousRenderedWidget;}return block.previousWidget;};/**
     * Get Next paragraph in block
     *
     * @private
     * @returns {ParagraphWidget}
     */Selection.prototype.getNextParagraphBlock=function(block){if(block.nextRenderedWidget instanceof ParagraphWidget){return block.nextRenderedWidget;}else if(block.nextRenderedWidget instanceof TableWidget){return this.getFirstParagraphInFirstCell(block.nextRenderedWidget);}if(block.containerWidget instanceof TableCellWidget){return this.getNextParagraphCell(block.containerWidget);}else if(block.containerWidget instanceof BodyWidget){var bodyWidget=block.containerWidget;return this.getNextParagraph(block.containerWidget);}else if(block.containerWidget instanceof HeaderFooterWidget&&this.isMoveDownOrMoveUp){return this.getFirstBlockInNextHeaderFooter(block);}return undefined;};/**
     * @private
     * @returns {ParagraphWidget}
     */Selection.prototype.getFirstBlockInNextHeaderFooter=function(block){var headerFooter=block.containerWidget;var nextBlock;if(headerFooter.headerFooterType.indexOf('Header')!==-1){nextBlock=headerFooter.page.footerWidget.firstChild;}else if(headerFooter.page.nextPage){nextBlock=headerFooter.page.nextPage.headerWidget.firstChild;}else{return undefined;}if(nextBlock instanceof ParagraphWidget){return nextBlock;}else{return this.getFirstBlockInFirstCell(nextBlock);}};/**
     * @private
     * @returns {ParagraphWidget}
     */Selection.prototype.getLastBlockInPreviousHeaderFooter=function(block){var headerFooter=block.containerWidget;var previousBlock;if(headerFooter.headerFooterType.indexOf('Footer')!==-1){previousBlock=headerFooter.page.headerWidget.lastChild;}else if(headerFooter.page.previousPage){previousBlock=headerFooter.page.previousPage.footerWidget.lastChild;}else{return undefined;}if(previousBlock instanceof ParagraphWidget){return previousBlock;}else{return this.getFirstBlockInFirstCell(previousBlock);}};/**
     * Get previous paragraph in block
     *
     * @private
     * @returns {ParagraphWidget}
     */Selection.prototype.getPreviousParagraphBlock=function(block){if(block.previousRenderedWidget instanceof ParagraphWidget){return block.previousRenderedWidget;}else if(block.previousRenderedWidget instanceof TableWidget){return this.getLastParagraphInLastCell(block.previousRenderedWidget);}if(block.containerWidget instanceof TableCellWidget){return this.getPreviousParagraphCell(block.containerWidget);}else if(block.containerWidget instanceof BodyWidget){return this.getPreviousParagraph(block.containerWidget);}else if(block.containerWidget instanceof HeaderFooterWidget&&this.isMoveDownOrMoveUp){return this.getLastBlockInPreviousHeaderFooter(block);}return undefined;};/**
     * Get first paragraph in block
     *
     * @private
     * @returns {ParagraphWidget}
     */Selection.prototype.getFirstParagraphBlock=function(block){if(block instanceof ParagraphWidget){return block;}else if(block instanceof TableWidget){return this.getFirstParagraphInFirstCell(block);}return undefined;};/**
     * Get last paragraph in block
     *
     * @private
     * @returns {ParagraphWidget}
     */Selection.prototype.getLastParagraphBlock=function(block){if(block instanceof ParagraphWidget){return block;}else if(block instanceof TableWidget){return this.getLastParagraphInLastCell(block);}return undefined;};/**
     * Return true if paragraph has valid inline
     *
     * @private
     * @returns {ParagraphWidget}
     */Selection.prototype.hasValidInline=function(paragraph,start,end){var index=paragraph.childWidgets.indexOf(start.line);for(var i=index;i<paragraph.childWidgets.length;i++){for(var j=0;j<paragraph.childWidgets[i].children.length;j++){var inline=paragraph.childWidgets[i].children[j];if(inline.length===0){continue;}if(inline===end){return false;}if(inline instanceof TextElementBox||inline instanceof ImageElementBox||inline instanceof FieldElementBox&&HelperMethods.isLinkedFieldCharacter(inline)){return true;}}}return false;};/**
     * Get paragraph length
     *
     * @private
     * @returns {number}
     */Selection.prototype.getParagraphLength=function(paragraph,endLine,elementInfo){var length=0;for(var j=0;j<paragraph.childWidgets.length;j++){var line=paragraph.childWidgets[j];if(endLine instanceof LineWidget&&endLine===line){if(elementInfo){length+=this.getLineLength(line,elementInfo);}break;}length+=this.getLineLength(line);}return length;};/**
     * Get Line length
     *
     * @private
     * @returns {number}
     */Selection.prototype.getLineLength=function(line,elementInfo){var length=0;var bidi=line.paragraph.bidi;for(var i=!bidi?0:line.children.length-1;bidi?i>-1:i<line.children.length;bidi?i--:i++){var element=line.children[i];if(element instanceof ListTextElementBox){continue;}if(elementInfo&&elementInfo.element instanceof ElementBox&&elementInfo.element===element){length+=elementInfo.index;break;}length+=element.length;}return length;};/**
     * Get line information
     *
     * @private
     * @returns {LineInfo}
     */Selection.prototype.getLineInfo=function(paragraph,offset){var line=undefined;var length=0;var childLength=paragraph.childWidgets.length;for(var j=0;j<childLength;j++){line=paragraph.childWidgets[j];length=this.getLineLength(line);if(offset<=length||j===childLength-1){break;}else{offset=offset-length;}}return{'line':line,'offset':offset};};/**
     * @private
     * @returns {ElementInfo}
     */Selection.prototype.getElementInfo=function(line,offset){var element=undefined;for(var i=0;i<line.children.length;i++){element=line.children[i];if(element instanceof ListTextElementBox){continue;}if(offset>element.length&&!(offset===element.length+1&&sf.base.isNullOrUndefined(element.nextNode))){offset=offset-element.length;}else{break;}}return{'element':element,'index':offset};};/**
     * Get paragraph start offset
     *
     * @private
     * @returns {number}
     */Selection.prototype.getStartOffset=function(paragraph){var startOffset=0;if(paragraph.childWidgets.length>0){var childWidgets=paragraph.childWidgets[0];return this.getStartLineOffset(childWidgets);}return startOffset;};/**
     * @private
     */Selection.prototype.getStartLineOffset=function(line){var startOffset=0;for(var i=0;i<line.children.length;i++){var inline=line.children[i];if(inline.length===0){continue;}if(inline instanceof TextElementBox||inline instanceof ImageElementBox||inline instanceof BookmarkElementBox||inline instanceof ShapeElementBox||inline instanceof EditRangeStartElementBox||inline instanceof EditRangeEndElementBox||inline instanceof CommentCharacterElementBox||inline instanceof FieldElementBox&&HelperMethods.isLinkedFieldCharacter(inline)||inline instanceof ContentControl){return startOffset;}if(inline instanceof ListTextElementBox){continue;}startOffset+=inline.length;}return startOffset;};/**
     * Get previous paragraph from selection
     *
     * @private
     */Selection.prototype.getPreviousSelectionCell=function(cell){if(!sf.base.isNullOrUndefined(cell.previousRenderedWidget)){if(!this.isForward){var block=cell.previousRenderedWidget.childWidgets[0];if(block instanceof ParagraphWidget){return block;}else{return this.getFirstParagraphInLastRow(block);}}else{var widgets=cell.previousRenderedWidget.childWidgets;var block=widgets[widgets.length-1];if(block instanceof ParagraphWidget){return block;}else{return this.getPreviousParagraphSelection(block.childWidgets[block.childWidgets.length-1]);}}}return this.getPreviousSelectionRow(cell.ownerRow);};/**
     * Get previous paragraph selection in selection
     *
     * @private
     */Selection.prototype.getPreviousSelectionRow=function(row){if(!sf.base.isNullOrUndefined(row.previousRenderedWidget)){if(!this.isForward){var cell=row.previousRenderedWidget.childWidgets[0];var block=cell.childWidgets[0];return this.getFirstParagraphBlock(block);}else{return this.getPreviousParagraphSelection(row.previousRenderedWidget);}}return this.getPreviousSelectionBlock(row.ownerTable);};/**
     * @private
     */Selection.prototype.getNextSelectionBlock=function(block){if(block.nextRenderedWidget instanceof ParagraphWidget){return block.nextRenderedWidget;}else if(block.nextRenderedWidget instanceof TableWidget){if(this.isEmpty||this.isForward){return this.getLastParagraphInFirstRow(block.nextRenderedWidget);}else{return this.getNextParagraphSelection(block.nextRenderedWidget.childWidgets[0]);}}if(block.containerWidget instanceof TableCellWidget){return this.getNextSelectionCell(block.containerWidget);}else if(block.containerWidget instanceof BodyWidget){return this.getNextSelection(block.containerWidget);}return undefined;};/**
     * Get next paragraph from selected cell
     *
     * @private
     */Selection.prototype.getNextSelectionCell=function(cell){if(!sf.base.isNullOrUndefined(cell.nextRenderedWidget)){if(this.isEmpty||this.isForward){var block=cell.nextRenderedWidget.childWidgets[cell.nextRenderedWidget.childWidgets.length-1];return this.getLastParagraphBlock(block);}else{//Return first paragraph in cell. 
var block=cell.nextRenderedWidget.childWidgets[0];if(block instanceof ParagraphWidget){return block;}else{return this.getNextParagraphSelection(block.childWidgets[0]);}}}return this.getNextSelectionRow(cell.ownerRow);};/**
     * Get next paragraph in selection
     *
     * @private
     */Selection.prototype.getNextSelectionRow=function(row){if(!sf.base.isNullOrUndefined(row.nextRenderedWidget)){var isForwardSelection=this.isEmpty||this.isForward;if(isForwardSelection){var cell=row.nextRenderedWidget.childWidgets[row.nextRenderedWidget.childWidgets.length-1];var block=cell.childWidgets[cell.childWidgets.length-1];return this.getLastParagraphBlock(block);}else{return this.getNextParagraphSelection(row.nextRenderedWidget);}}return this.getNextSelectionBlock(row.ownerTable);};/**
     * Get next block with selection
     *
     * @private
     */Selection.prototype.getNextSelection=function(section){if(section.nextRenderedWidget instanceof BodyWidget){var block=section.nextRenderedWidget.childWidgets[0];if(block instanceof ParagraphWidget){return block;}else{if(this.isEmpty||this.isForward){return this.getLastParagraphInFirstRow(block);}else{return this.getNextParagraphSelection(block.childWidgets[0]);}}}return undefined;};/**
     * @private
     */Selection.prototype.getNextParagraphSelection=function(row){//Iterate the exact cell based on UP/Down selection length.
var cell=row.childWidgets[0];if(this.start.paragraph.isInsideTable&&row.ownerTable.contains(this.start.paragraph.associatedCell)){var startCell=this.getCellInTable(row.ownerTable,this.start.paragraph.associatedCell);cell=this.getFirstCellInRegion(row,startCell,this.upDownSelectionLength,false);}var block=cell.childWidgets[0];return this.getFirstParagraphBlock(block);};/**
     * @private
     */Selection.prototype.getPreviousSelectionBlock=function(block){if(block.previousRenderedWidget instanceof ParagraphWidget){return block.previousRenderedWidget;}else if(block.previousRenderedWidget instanceof TableWidget){if(!this.isForward){return this.getFirstParagraphInLastRow(block.previousRenderedWidget);}else{return this.getPreviousParagraphSelection(block.previousRenderedWidget.childWidgets[block.previousRenderedWidget.childWidgets.length-1]);}}if(block.containerWidget instanceof TableCellWidget){return this.getPreviousSelectionCell(block.containerWidget);}else if(block.containerWidget instanceof BodyWidget){return this.getPreviousSelection(block.containerWidget);}return undefined;};/**
     * Get previous paragraph in selection
     *
     * @private
     */Selection.prototype.getPreviousSelection=function(section){if(section.previousRenderedWidget instanceof BodyWidget){var prevBodyWidget=section.previousRenderedWidget;var block=prevBodyWidget.childWidgets[prevBodyWidget.childWidgets.length-1];if(block instanceof ParagraphWidget){return block;}else{if(!this.isForward){return this.getFirstParagraphInLastRow(block);}else{var tableWidget=block;return this.getPreviousParagraphSelection(tableWidget.childWidgets[tableWidget.childWidgets.length-1]);}}}return undefined;};/**
     * @private
     */Selection.prototype.getPreviousParagraphSelection=function(row){//Iterate the exact cell based on UP/Down selection length.
var cell=row.childWidgets[row.childWidgets.length-1];if(this.start.paragraph.isInsideTable&&row.ownerTable.contains(this.start.paragraph.associatedCell)){var startCell=this.getCellInTable(row.ownerTable,this.start.paragraph.associatedCell);cell=this.getLastCellInRegion(row,startCell,this.upDownSelectionLength,true);}var block=cell.childWidgets[cell.childWidgets.length-1];return this.getLastParagraphBlock(block);};/**
     * Get last cell in the selected region
     *
     * @private
     */Selection.prototype.getLastCellInRegion=function(row,startCell,selLength,isMovePrev){var start=this.getCellLeft(row,startCell);var end=start+startCell.cellFormat.cellWidth;var flag=true;if(start<=selLength&&selLength<end){for(var i=row.childWidgets.length-1;i>=0;i--){var left=this.getCellLeft(row,row.childWidgets[i]);if(HelperMethods.round(start,2)<=HelperMethods.round(left,2)&&HelperMethods.round(left,2)<HelperMethods.round(end,2)){flag=false;return row.childWidgets[i];}}}else{for(var i=row.childWidgets.length-1;i>=0;i--){var left=this.getCellLeft(row,row.childWidgets[i]);if(left<=selLength&&left+row.childWidgets[i].cellFormat.cellWidth>selLength){flag=false;return row.childWidgets[i];}}}if(flag){if(!sf.base.isNullOrUndefined(row.previousRenderedWidget)&&isMovePrev){return this.getLastCellInRegion(row.previousRenderedWidget,startCell,selLength,isMovePrev);}else if(!sf.base.isNullOrUndefined(row.nextRenderedWidget)&&!isMovePrev){return this.getLastCellInRegion(row.nextRenderedWidget,startCell,selLength,isMovePrev);}}return row.childWidgets[row.childWidgets.length-1];};/**
     * Get Container table
     *
     * @private
     */Selection.prototype.getCellInTable=function(table,tableCell){while(tableCell.ownerTable.isInsideTable){if(table.equals(tableCell.ownerTable)){return tableCell;}tableCell=tableCell.ownerTable.associatedCell;}return tableCell;};/**
     * Get first paragraph in last row
     *
     * @private
     */Selection.prototype.getFirstParagraphInLastRow=function(table){if(table.childWidgets.length>0){var lastRow=table.childWidgets[table.childWidgets.length-1];var lastCell=lastRow.childWidgets[0];var lastBlock=lastCell.childWidgets[0];return this.getFirstParagraphBlock(lastBlock);}return undefined;};/**
     * Get previous valid offset
     *
     * @private
     */Selection.prototype.getPreviousValidOffset=function(paragraph,offset){if(offset===0){return 0;}var validOffset=0;var count=0;var value=0;var bidi=paragraph.paragraphFormat.bidi;for(var i=0;i<paragraph.childWidgets.length;i++){var lineWidget=paragraph.childWidgets[i];if(!bidi){for(var j=0;j<lineWidget.children.length;j++){var inline=lineWidget.children[j];if(inline.length===0||inline instanceof ListTextElementBox){continue;}if(offset<=count+inline.length){return offset-1===count?validOffset:offset-1;}if(inline instanceof TextElementBox||inline instanceof ImageElementBox||inline instanceof BookmarkElementBox||inline instanceof FieldElementBox&&HelperMethods.isLinkedFieldCharacter(inline)){validOffset=count+inline.length;}count+=inline.length;}}else{value=lineWidget.getInlineForOffset(offset,false,undefined,false,true,false).index;if(value>=0){return value;}}}return offset-1===count?validOffset:offset-1;};/**
     * Get next valid offset
     *
     * @private
     */Selection.prototype.getNextValidOffset=function(line,offset){var count=0;if(!line.paragraph.paragraphFormat.bidi){for(var i=0;i<line.children.length;i++){var inline=line.children[i];if(inline.length===0||inline instanceof ListTextElementBox){continue;}if(offset<count+inline.length){if(inline instanceof TextElementBox||inline instanceof ImageElementBox||inline instanceof FieldElementBox&&HelperMethods.isLinkedFieldCharacter(inline)){return(offset>count?offset:count)+1;}}if(offset===count+inline.length&&inline instanceof FieldElementBox&&inline.fieldType===1&&inline.previousNode instanceof ImageElementBox){return offset;}count+=inline.length;}}else{if(offset!==this.getLineLength(line)){offset=line.getInlineForOffset(offset,false,undefined,false,false,true).index;}}return offset;};/**
     * Get paragraph mark size info
     *
     * @private
     */Selection.prototype.getParagraphMarkSize=function(paragraph,topMargin,bottomMargin){var size=this.documentHelper.textHelper.getParagraphMarkSize(paragraph.characterFormat);var baselineOffset=size.BaselineOffset;var maxHeight=size.Height;var maxBaselineOffset=baselineOffset;if(paragraph instanceof ParagraphWidget){// let paragraphWidget: ParagraphWidget[] = paragraph.renderedElement() as ParagraphWidget[];
if(paragraph.childWidgets.length>0){var lineWidget=paragraph.childWidgets[0];}//Gets line spacing.
var lineSpacing=this.documentHelper.layout.getLineSpacing(paragraph,maxHeight);var beforeSpacing=this.documentHelper.layout.getBeforeSpacing(paragraph);topMargin=maxBaselineOffset-baselineOffset;bottomMargin=maxHeight-maxBaselineOffset-(size.Height-baselineOffset);//Updates line spacing, paragraph after/ before spacing and aligns the text to base line offset.
var lineSpacingType=paragraph.paragraphFormat.lineSpacingType;if(lineSpacingType==='Multiple'){if(lineSpacing>maxHeight){bottomMargin+=lineSpacing-maxHeight;}else{topMargin+=lineSpacing-maxHeight;}}else if(lineSpacingType==='Exactly'){topMargin+=lineSpacing-(topMargin+size.Height+bottomMargin);}else if(lineSpacing>topMargin+size.Height+bottomMargin){topMargin+=lineSpacing-(topMargin+size.Height+bottomMargin);}topMargin+=beforeSpacing;bottomMargin+=this.documentHelper.layout.getAfterSpacing(paragraph);}return{'width':size.Width,'height':size.Height,'topMargin':topMargin,'bottomMargin':bottomMargin};};/**
     * @private
     */Selection.prototype.getPhysicalPositionInternal=function(line,offset,moveNextLine){if(line.paragraph.isEmpty()){var paragraphWidget=line.paragraph;var left=paragraphWidget.x;if(paragraphWidget.childWidgets.length>0){var lineWidget=paragraphWidget.childWidgets[0];left=this.getLeft(lineWidget);}var topMargin=0;var bottomMargin=0;var size=this.getParagraphMarkSize(line.paragraph,topMargin,bottomMargin);if(offset>0){left+=size.width;}return new Point(left,paragraphWidget.y+topMargin);}else{var indexInInline=0;var inlineObj=line.getInline(offset,indexInInline,line.paragraph.bidi);var inline=inlineObj.element;//return indexInInline must
indexInInline=inlineObj.index;// if (inline.length === indexInInline && !isNullOrUndefined(inline.nextNode) && this.viewer.renderedElements.containsKey(inline) &&
//     this.viewer.renderedElements.get(inline).length > 0 && this.viewer.renderedElements.containsKey(inline.nextNode as WInline)
//     && this.viewer.renderedElements.get(inline.nextNode as WInline).length > 0 &&
//     (this.viewer.renderedElements.get(inline)[this.viewer.renderedElements.get(inline).length - 1] as ElementBox).line !== (this.viewer.renderedElements.get(inline.nextNode as WInline)[0] as ElementBox).line) {
//     //Handled specifically to move the cursor at start of next line.
//     inline = inline.nextNode as WInline;
//     indexInInline = 0;
// }
return this.getPhysicalPositionInline(inline,indexInInline,moveNextLine);}};/**
     * Highlight selected content
     *
     * @private
     */Selection.prototype.highlightSelectedContent=function(start,end){if(start.paragraph.isInsideTable&&(!end.paragraph.isInsideTable||!start.paragraph.associatedCell.equals(end.paragraph.associatedCell)||this.isCellSelected(start.paragraph.associatedCell,start,end))){this.highlightCell(start.paragraph.associatedCell,this,start,end);}else{var inline=undefined;var index=0;if(!this.owner.isReadOnlyMode&&start.paragraph===end.paragraph){if(start.offset+1===end.offset){var inlineObj=end.currentWidget.getInline(end.offset,index);inline=inlineObj.element;// return index value
index=inlineObj.index;if(inline instanceof ImageElementBox||inline instanceof ShapeElementBox){var startOffset=start.currentWidget.getOffset(inline,0);if(startOffset!==start.offset){inline=undefined;}}}else{var indexInInline=0;var startInlineObj=start.currentWidget.getInline(start.offset,indexInInline);var startInline=startInlineObj.element;//return indexInInline
indexInInline=startInlineObj.index;if(indexInInline===startInline.length){startInline=this.getNextRenderedElementBox(startInline,indexInInline);}var endInlineObj=end.currentWidget.getInline(end.offset,indexInInline);var endInline=endInlineObj.element;//return indexInInline
indexInInline=endInlineObj.index;if(startInline instanceof FieldElementBox&&endInline instanceof FieldElementBox&&!sf.base.isNullOrUndefined(startInline.fieldSeparator)){var fieldValue=startInline.fieldSeparator.nextNode;if(fieldValue instanceof ImageElementBox&&fieldValue.nextNode===endInline){inline=fieldValue;}}}}if(!this.owner.isReadOnlyMode&&this.owner.isDocumentLoaded&&(inline instanceof ImageElementBox||inline instanceof ShapeElementBox)){var elementBoxObj=this.getElementBoxInternal(inline,index);var elementBox=elementBoxObj.element;//return index
index=elementBoxObj.index;if(this.owner.enableImageResizerMode){this.owner.imageResizerModule.positionImageResizer(elementBox);this.owner.imageResizerModule.showImageResizer();}if(this.documentHelper.isTouchInput){this.documentHelper.touchStart.style.display='none';this.documentHelper.touchEnd.style.display='none';}}else{this.highlight(start.paragraph,start,end);if(this.isHighlightNext){this.highlightNextBlock(this.hightLightNextParagraph,start,end);this.isHighlightNext=false;this.hightLightNextParagraph=undefined;}}if(this.isInShape){this.showResizerForShape();}}};Selection.prototype.showResizerForShape=function(){var shape=this.getCurrentTextFrame().containerShape;this.owner.imageResizerModule.positionImageResizer(shape);this.owner.imageResizerModule.showImageResizer();};/**
     * @private
     * @returns {void}
     */Selection.prototype.highlight=function(paragraph,start,end){var selectionStartIndex=0;var selectionEndIndex=0;var startElement=undefined;var endElement=undefined;var startLineWidget=undefined;var endLineWidget=undefined;//return start Element and selection start index
var startLineObj=this.getStartLineWidget(paragraph,start,startElement,selectionStartIndex);startElement=startLineObj.element;if(sf.base.isNullOrUndefined(startElement)){startLineWidget=paragraph.childWidgets[0];}else{startLineWidget=startElement.line;}selectionStartIndex=startLineObj.index;var endLineObj=this.getEndLineWidget(end,endElement,selectionEndIndex);endElement=endLineObj.element;if(endElement){endLineWidget=endElement.line;}else{endLineWidget=end.paragraph.childWidgets[end.paragraph.childWidgets.length-1];}selectionEndIndex=endLineObj.index;var top=0;var left=0;if(!sf.base.isNullOrUndefined(startLineWidget)){top=this.getTop(startLineWidget);left=this.getLeftInternal(startLineWidget,startElement,selectionStartIndex);}if(!sf.base.isNullOrUndefined(startLineWidget)&&startLineWidget===endLineWidget){//Selection ends in current line.
var right=this.getLeftInternal(endLineWidget,endElement,selectionEndIndex);var width=0;var isRtlText=false;if(endElement instanceof TextElementBox){isRtlText=endElement.isRightToLeft;}if(!isRtlText&&startElement instanceof TextElementBox){isRtlText=startElement.isRightToLeft;}width=Math.abs(right-left);// Handled the highlighting approach as genric for normal and rtl text.
if(isRtlText||paragraph.bidi){var elementBoxCollection=this.getElementsForward(startLineWidget,startElement,endElement,paragraph.bidi);if(elementBoxCollection&&elementBoxCollection.length>1){for(var i=0;i<elementBoxCollection.length;i++){var element=elementBoxCollection[i];var elementIsRTL=false;var index=element instanceof TextElementBox?element.length:1;if(element===startElement){left=this.getLeftInternal(startLineWidget,element,selectionStartIndex);right=this.getLeftInternal(startLineWidget,element,index);}else if(element===endElement){left=this.getLeftInternal(startLineWidget,element,0);right=this.getLeftInternal(startLineWidget,element,selectionEndIndex);}else{left=this.getLeftInternal(startLineWidget,element,0);right=this.getLeftInternal(startLineWidget,element,index);}if(element instanceof TextElementBox){elementIsRTL=element.isRightToLeft;}width=Math.abs(right-left);// Handled the paragraph mark highliting as special case.
if(element===endElement&&element instanceof TextElementBox&&selectionEndIndex>element.length){var charFormat=element.line.paragraph.characterFormat;var paragraphMarkWidth=this.documentHelper.textHelper.getParagraphMarkSize(charFormat).Width;if(paragraph.bidi&&!elementIsRTL){width-=paragraphMarkWidth;// Highlight the element.
this.createHighlightBorder(startLineWidget,width,left,top,true);// Highlight the paragraph mark of Bidi paragrph. 
left=this.getLineStartLeft(startLineWidget)-paragraphMarkWidth;this.createHighlightBorder(startLineWidget,paragraphMarkWidth,left,top,true);// continue to next element.
continue;}}this.createHighlightBorder(startLineWidget,width,elementIsRTL?right:left,top,true);}}else{// Need to handle the Paragraph mark highlighting.
if(endElement instanceof TextElementBox&&selectionEndIndex>endElement.length){var charFormat=endElement.line.paragraph.characterFormat;var paragraphMarkWidth=this.documentHelper.textHelper.getParagraphMarkSize(charFormat).Width;// Since isRTLText is truo, so the right is considered as left
if(!paragraph.bidi&&isRtlText){right+=paragraphMarkWidth;width-=paragraphMarkWidth;// Highlight the element.
this.createHighlightBorder(startLineWidget,width,right,top,true);// Highlight the paragraph mark. 
right+=endElement.width;this.createHighlightBorder(startLineWidget,paragraphMarkWidth,right,top,true);}else if(paragraph.bidi&&!isRtlText){width-=paragraphMarkWidth;// Highlight the element.
this.createHighlightBorder(startLineWidget,width,left,top,true);// Highlight the paragraph mark of Bidi paragrph. 
left=this.getLineStartLeft(startLineWidget)-paragraphMarkWidth;this.createHighlightBorder(startLineWidget,paragraphMarkWidth,left,top,true);}else{this.createHighlightBorder(startLineWidget,width,isRtlText?right:left,top,false);}}else{this.createHighlightBorder(startLineWidget,width,isRtlText?right:left,top,false);}}}else{// Start element and end element will be in reverese for Bidi paragraph highlighting. 
// So, the right is considered based on Bidi property. 
this.createHighlightBorder(startLineWidget,width,paragraph.bidi?right:left,top,false);}}else{if(!sf.base.isNullOrUndefined(startLineWidget)){var x=startLineWidget.paragraph.x;if(paragraph!==startLineWidget.paragraph){paragraph=startLineWidget.paragraph;}var width=this.getWidth(startLineWidget,true)-(left-startLineWidget.paragraph.x);// Handled the  highlighting approach as genric for normal and rtl text.
if(paragraph.bidi||startElement instanceof TextElementBox&&startElement.isRightToLeft){var right=0;var elementCollection=this.getElementsForward(startLineWidget,startElement,endElement,paragraph.bidi);if(elementCollection){var elementIsRTL=false;for(var i=0;i<elementCollection.length;i++){var element=elementCollection[i];elementIsRTL=false;if(element===startElement){left=this.getLeftInternal(startLineWidget,element,selectionStartIndex);}else{left=this.getLeftInternal(startLineWidget,element,0);}var index=element instanceof TextElementBox?element.length:1;right=this.getLeftInternal(startLineWidget,element,index);if(element instanceof TextElementBox){elementIsRTL=element.isRightToLeft;}width=Math.abs(right-left);this.createHighlightBorder(startLineWidget,width,elementIsRTL?right:left,top,true);}// Highlight the Paragrph mark for last line.
if(startLineWidget.isLastLine()){var charFormat=elementCollection[elementCollection.length-1].line.paragraph.characterFormat;var paragraphMarkWidth=this.documentHelper.textHelper.getParagraphMarkSize(charFormat).Width;if(paragraph.bidi){// The paragraph mark will be at the left most end.
left=this.getLineStartLeft(startLineWidget)-paragraphMarkWidth;}else{// The paragraph mark will at right most end.
left=elementIsRTL?startLineWidget.paragraph.x+this.getWidth(startLineWidget,false):right;}this.createHighlightBorder(startLineWidget,paragraphMarkWidth,left,top,true);}}else{this.createHighlightBorder(startLineWidget,width,left,top,false);}}else{this.createHighlightBorder(startLineWidget,width,left,top,false);}var lineIndex=startLineWidget.paragraph.childWidgets.indexOf(startLineWidget);//Iterates to last item of paragraph or selection end.                                             
this.highlightParagraph(paragraph,lineIndex+1,endLineWidget,endElement,selectionEndIndex);if(paragraph.childWidgets.indexOf(end.currentWidget)!==-1){return;}}if(this.isHideSelection(paragraph)){this.isHighlightNext=false;return;}this.isHighlightNext=true;this.hightLightNextParagraph=paragraph;}};Selection.prototype.highlightNextBlock=function(paragraph,start,end){var block=paragraph.nextRenderedWidget;if(!sf.base.isNullOrUndefined(block)){if(block instanceof ParagraphWidget){this.isHighlightNext=false;this.highlight(block,start,end);if(this.isHighlightNext){this.highlightNextBlock(this.hightLightNextParagraph,start,end);this.isHighlightNext=false;this.hightLightNextParagraph=undefined;}}else{this.highlightTable(block,start,end);}}};/**
     * Get start line widget
     * @private
     * @returns {ElementInfo}
     */Selection.prototype.getStartLineWidget=function(paragraph,start,startElement,selectionStartIndex){var offset=paragraph===start.paragraph?start.offset:this.getStartOffset(paragraph);var startInlineObj=undefined;if(paragraph===start.paragraph){startInlineObj=start.currentWidget.getInline(offset,selectionStartIndex);}else{startInlineObj=paragraph.firstChild.getInline(offset,selectionStartIndex);}startElement=startInlineObj.element;//return selectionStartIndex
selectionStartIndex=startInlineObj.index;if(startElement instanceof FieldElementBox){var inlineInfo=this.getRenderedInline(startElement,selectionStartIndex);startElement=inlineInfo.element;selectionStartIndex=inlineInfo.index;}if(offset===this.getParagraphLength(start.paragraph)+1){selectionStartIndex++;}return{'index':selectionStartIndex,'element':startElement};};/**
     * Get end line widget
     * @private
     */Selection.prototype.getEndLineWidget=function(end,endElement,selectionEndIndex){var endInlineObj=end.currentWidget.getInline(end.offset,selectionEndIndex);endElement=endInlineObj.element;//return selection end index
selectionEndIndex=endInlineObj.index;if(endElement instanceof FieldElementBox){var inlineInfo=this.getRenderedInline(endElement,selectionEndIndex);endElement=inlineInfo.element;selectionEndIndex=inlineInfo.index;}var lineIndex=end.paragraph.childWidgets.indexOf(end.currentWidget);if(lineIndex===end.paragraph.childWidgets.length-1&&end.offset===this.getLineLength(end.currentWidget)+1){selectionEndIndex=endElement?endElement.length+1:1;}return{'index':selectionEndIndex,'element':endElement};};/**
     * Get line widget
     * @private
     */Selection.prototype.getLineWidgetInternal=function(line,offset,moveToNextLine){var lineWidget=undefined;if(line.children.length===0&&line instanceof LineWidget){lineWidget=line;}else{var indexInInline=0;var inlineInfo=line.getInline(offset,indexInInline);var inline=inlineInfo.element;indexInInline=inlineInfo.index;lineWidget=inline instanceof ElementBox?inline.line:this.getLineWidgetInternalInline(inline,indexInInline,moveToNextLine);}return lineWidget;};/**
     * Get last line widget
     * @private
     */Selection.prototype.getLineWidgetParagraph=function(offset,line){var linewidget=undefined;if(line.children.length===0){linewidget=line;}else{var indexInInline=0;var inlineInfo=line.getInline(offset,indexInInline);var inline=inlineInfo.element;indexInInline=inlineInfo.index;linewidget=this.getLineWidget(inline,indexInInline);}return linewidget;};/**
     * Highlight selected cell
     * @private
     */Selection.prototype.highlightCells=function(table,startCell,endCell){var start=this.getCellLeft(startCell.ownerRow,startCell);var end=start+startCell.cellFormat.cellWidth;var endCellLeft=this.getCellLeft(endCell.ownerRow,endCell);var endCellRight=endCellLeft+endCell.cellFormat.cellWidth;if(start>endCellLeft){start=endCellLeft;}if(end<endCellRight){end=endCellRight;}if(start>this.upDownSelectionLength){start=this.upDownSelectionLength;}if(end<this.upDownSelectionLength){end=this.upDownSelectionLength;}var tableWidgetCollection=table.getSplitWidgets();var startTableIndex=tableWidgetCollection.indexOf(startCell.ownerRow.ownerTable);var endTableIndex=tableWidgetCollection.indexOf(endCell.ownerRow.ownerTable);if(startTableIndex===endTableIndex){var count=table.childWidgets.indexOf(endCell.ownerRow);for(var i=table.childWidgets.indexOf(startCell.ownerRow);i<=count;i++){this.highlightRow(table.childWidgets[i],start,end);}}else{var startRowIndex=0;var endRowIndex=0;for(var i=startTableIndex;i<=endTableIndex;i++){table=tableWidgetCollection[i];if(i===startTableIndex){startRowIndex=table.childWidgets.indexOf(startCell.ownerRow);}else{startRowIndex=0;}if(i===endTableIndex){endRowIndex=table.childWidgets.indexOf(endCell.ownerRow);}else{endRowIndex=table.childWidgets.length-1;}for(var j=startRowIndex;j<=endRowIndex;j++){this.highlightRow(table.childWidgets[j],start,end);}}}};/**
     * highlight selected table
     *
     * @private
     */Selection.prototype.highlightTable=function(table,start,end){this.highlightInternal(table.childWidgets[0],start,end);if(!end.paragraph.isInsideTable//Selection end is outside the table cell.
||!table.contains(end.paragraph.associatedCell)){//Selection end is not inside the current table.
this.highlightNextBlock(table,start,end);}};/**
     * Get cell left
     *
     * @private
     */Selection.prototype.getCellLeft=function(row,cell){var left=0;left+=cell.x-cell.margin.left;return left;};/**
     * Get next paragraph for row
     *
     * @private
     */Selection.prototype.getNextParagraphRow=function(row){if(!sf.base.isNullOrUndefined(row.nextRenderedWidget)){var cell=row.nextRenderedWidget.childWidgets[0];var block=cell.childWidgets[0];return this.getFirstParagraphBlock(block);}return this.getNextParagraphBlock(row.ownerTable);};/**
     * Get previous paragraph from row
     *
     * @private
     */Selection.prototype.getPreviousParagraphRow=function(row){if(!sf.base.isNullOrUndefined(row.previousRenderedWidget)){var cell=row.previousRenderedWidget.lastChild;var block=cell.lastChild?cell.lastChild:cell.previousSplitWidget.lastChild;return this.getLastParagraphBlock(block);}return this.getPreviousParagraphBlock(row.ownerTable);};/**
     * Return true if row contain cell
     *
     * @private
     */Selection.prototype.containsRow=function(row,tableCell){if(row.childWidgets.indexOf(tableCell)!==-1){return true;}while(tableCell.ownerTable.isInsideTable){if(row.childWidgets.indexOf(tableCell)!==-1){return true;}tableCell=tableCell.ownerTable.associatedCell;}return row.childWidgets.indexOf(tableCell)!==-1;};/**
     * Highlight selected row
     *
     * @private
     */Selection.prototype.highlightRow=function(row,start,end){for(var i=0;i<row.childWidgets.length;i++){var left=this.getCellLeft(row,row.childWidgets[i]);if(HelperMethods.round(start,2)<=HelperMethods.round(left,2)&&HelperMethods.round(left,2)<HelperMethods.round(end,2)){this.highlightCellWidget(row.childWidgets[i]);}}};/**
     * @private
     */Selection.prototype.highlightInternal=function(row,start,end){for(var i=0;i<row.childWidgets.length;i++){this.highlightCellWidget(row.childWidgets[i]);}if(end.paragraph.isInsideTable&&this.containsRow(row,end.paragraph.associatedCell)){return;}else if(row.nextRenderedWidget instanceof TableRowWidget){this.highlightInternal(row.nextRenderedWidget,start,end);}};/**
     * Get last paragraph in cell
     *
     * @private
     */Selection.prototype.getLastParagraph=function(cell){while(cell.nextSplitWidget){if(cell.nextSplitWidget.childWidgets.length>0){cell=cell.nextSplitWidget;}else{break;}}var lastBlock;if(cell.childWidgets.length>0){lastBlock=cell.lastChild;}else{lastBlock=cell.previousSplitWidget.lastChild;}return this.getLastParagraphBlock(lastBlock);};/**
     * Return true is source cell contain cell
     *
     * @private
     */Selection.prototype.containsCell=function(sourceCell,cell){if(sourceCell.equals(cell)){return true;}while(cell.ownerTable.isInsideTable){if(sourceCell.equals(cell.ownerTable.associatedCell)){return true;}cell=cell.ownerTable.associatedCell;}return false;};/**
     * Return true if cell is selected
     *
     * @private
     */Selection.prototype.isCellSelected=function(cell,startPosition,endPosition){var lastParagraph=this.getLastParagraph(cell);var isAtCellEnd=lastParagraph===endPosition.paragraph&&endPosition.offset===this.getParagraphLength(lastParagraph)+1;return isAtCellEnd||!this.containsCell(cell,startPosition.paragraph.associatedCell)||!this.containsCell(cell,endPosition.paragraph.associatedCell);};/**
     * Return Container cell
     *
     * @private
     */Selection.prototype.getContainerCellOf=function(cell,tableCell){while(cell.ownerTable.isInsideTable){if(cell.ownerTable.contains(tableCell)){return cell;}cell=cell.ownerTable.associatedCell;}return cell;};/**
     * Get Selected cell
     *
     * @private
     */Selection.prototype.getSelectedCell=function(cell,containerCell){if(cell.ownerTable.equals(containerCell.ownerTable)){return cell;}while(cell.ownerTable.isInsideTable){if(cell.ownerTable.associatedCell.equals(containerCell)){return cell;}cell=cell.ownerTable.associatedCell;}return cell;};/**
     * @private
     */Selection.prototype.getSelectedCells=function(){var cells=[];for(var i=0;i<this.selectedWidgets.keys.length;i++){var widget=this.selectedWidgets.keys[i];if(widget instanceof TableCellWidget){cells.push(widget);}}return cells;};/**
     * Get Next paragraph from cell
     *
     * @private
     */Selection.prototype.getNextParagraphCell=function(cell){if(cell.nextRenderedWidget&&cell.nextRenderedWidget instanceof TableCellWidget){//Return first paragraph in cell.            
cell=cell.nextRenderedWidget;var block=cell.firstChild;if(block){return this.getFirstParagraphBlock(block);}else{return this.getNextParagraphCell(cell);}}return this.getNextParagraphRow(cell.containerWidget);};/**
     * Get previous paragraph from cell
     *
     * @private
     */Selection.prototype.getPreviousParagraphCell=function(cell){if(!sf.base.isNullOrUndefined(cell.previousRenderedWidget)&&cell.previousRenderedWidget instanceof TableCellWidget){cell=cell.previousRenderedWidget;var block=cell.lastChild;return this.getLastParagraphBlock(block);}return this.getPreviousParagraphRow(cell.ownerRow);};/**
     * Get cell's container cell
     *
     * @private
     */Selection.prototype.getContainerCell=function(cell){while(!sf.base.isNullOrUndefined(cell.ownerTable)&&cell.ownerTable.isInsideTable){cell=cell.ownerTable.associatedCell;}return cell;};/**
     * Highlight selected cell
     *
     * @private
     */Selection.prototype.highlightCell=function(cell,selection,start,end){if(end.paragraph.isInsideTable){var containerCell=this.getContainerCellOf(cell,end.paragraph.associatedCell);if(containerCell.ownerTable.contains(end.paragraph.associatedCell)){var startCell=this.getSelectedCell(cell,containerCell);var endCell=this.getSelectedCell(end.paragraph.associatedCell,containerCell);if(this.containsCell(containerCell,end.paragraph.associatedCell)){//Selection end is in container cell.
if(this.isCellSelected(containerCell,start,end)){this.highlightCellWidget(containerCell);}else{if(startCell===containerCell){this.highlight(start.paragraph,start,end);if(this.isHighlightNext){this.highlightNextBlock(this.hightLightNextParagraph,start,end);this.isHighlightNext=false;this.hightLightNextParagraph=undefined;}}else{this.highlightContainer(startCell,start,end);}}}else{//Selection end is not in container cell.
this.highlightCellWidget(containerCell);if(containerCell.ownerRow.equals(endCell.ownerRow)){//Highlight other selected cells in current row.
startCell=containerCell;while(!sf.base.isNullOrUndefined(startCell.nextRenderedWidget)){startCell=startCell.nextRenderedWidget;this.highlightCellWidget(startCell);if(startCell===endCell){break;}}}else{this.highlightCells(containerCell.ownerTable,containerCell,endCell);}}}else{this.highlightContainer(containerCell,start,end);}}else{var cell1=this.getContainerCell(cell);this.highlightContainer(cell1,start,end);}};/**
     * @private
     */Selection.prototype.highlightContainer=function(cell,start,end){this.highlightInternal(cell.containerWidget,start,end);this.highlightNextBlock(cell.ownerTable,start,end);};/**
     * Get previous valid element
     *
     * @private
     */Selection.prototype.getPreviousValidElement=function(inline){var previousValidInline=undefined;if(this.documentHelper.isFormFillProtectedMode&&inline.fieldType===2){return inline;}while(inline instanceof FieldElementBox){if(HelperMethods.isLinkedFieldCharacter(inline)){if(inline instanceof FieldElementBox&&inline.fieldType===0){previousValidInline=inline;}else if(inline instanceof FieldElementBox&&inline.fieldType===1){previousValidInline=inline;if(sf.base.isNullOrUndefined(inline.fieldSeparator)){inline=inline.fieldBegin;previousValidInline=inline;}}else{inline=inline.fieldBegin;previousValidInline=inline;}}inline=inline.previousNode;}return sf.base.isNullOrUndefined(previousValidInline)?inline:previousValidInline;};/**
     * Get next valid element
     *
     * @private
     */Selection.prototype.getNextValidElement=function(inline){var nextValidInline=undefined;if(inline instanceof BookmarkElementBox&&inline.bookmarkType===1){return inline;}while(inline instanceof FieldElementBox){if(inline.fieldType===0&&!sf.base.isNullOrUndefined(inline.fieldEnd)){return sf.base.isNullOrUndefined(nextValidInline)?inline:nextValidInline;}else if(inline.fieldType===1&&!sf.base.isNullOrUndefined(inline.fieldBegin)){nextValidInline=inline;}inline=inline.nextNode;}return sf.base.isNullOrUndefined(nextValidInline)?inline:nextValidInline;};/**
     * Return next valid inline with index
     *
     * @private
     */Selection.prototype.validateTextPosition=function(inline,index){if(inline.length===index&&(inline.nextNode instanceof FieldElementBox||!(inline instanceof ImageElementBox)&&inline.nextNode instanceof BookmarkElementBox)){//If inline is last item within field, then set field end as text position.
var nextInline=this.getNextValidElement(inline.nextNode);if(nextInline instanceof FieldElementBox&&nextInline.fieldType===1||nextInline instanceof BookmarkElementBox&&nextInline.bookmarkType===1){inline=nextInline;index=this.documentHelper.isFormFillProtectedMode?0:1;}}else if(index===0&&inline.previousNode instanceof FieldElementBox){var prevInline=this.getPreviousValidElement(inline.previousNode);inline=prevInline;index=inline instanceof FieldElementBox?0:inline.length;if(inline instanceof FieldElementBox&&inline.fieldType===1){index++;}}return{'element':inline,'index':index};};/**
     * Get inline physical location
     *
     * @private
     */Selection.prototype.getPhysicalPositionInline=function(inline,index,moveNextLine){var element=undefined;element=this.getElementBox(inline,index,moveNextLine).element;var lineWidget=undefined;if(sf.base.isNullOrUndefined(element)||sf.base.isNullOrUndefined(element.line)){if(inline instanceof FieldElementBox&&inline.fieldType===1){element=inline;}else{if(inline instanceof FieldElementBox||inline instanceof BookmarkElementBox){return this.getFieldCharacterPosition(inline);}return new Point(0,0);}}var margin=element.margin;var top=0;var left=0;if(element instanceof TextElementBox&&element.text==='\v'&&sf.base.isNullOrUndefined(inline.nextNode)){lineWidget=this.getNextLineWidget(element.line.paragraph,element);index=0;}else{lineWidget=element.line;}top=this.getTop(lineWidget);if(element instanceof ImageElementBox&&element.textWrappingStyle==='Inline'){var format=element.line.paragraph.characterFormat;var previousInline=this.getPreviousTextElement(inline);if(!sf.base.isNullOrUndefined(previousInline)){format=previousInline.characterFormat;}else{var nextInline=this.getNextTextElement(inline);if(!sf.base.isNullOrUndefined(nextInline)){format=nextInline.characterFormat;}}var measureObj=this.documentHelper.textHelper.getHeight(format);if(element.margin.top+element.height-measureObj.BaselineOffset>0){top+=element.margin.top+element.height-measureObj.BaselineOffset;}}else if(!(element instanceof FieldElementBox)){top+=margin.top>0?margin.top:0;}left=sf.base.isNullOrUndefined(element)||sf.base.isNullOrUndefined(lineWidget)?0:this.getLeftInternal(lineWidget,element,index);return new Point(left,top);};/**
     * Get field character position
     *
     * @private
     */Selection.prototype.getFieldCharacterPosition=function(firstInline){var nextValidInline=this.getNextValidElementForField(firstInline);//If field separator/end exists at end of paragraph, then move to next paragraph.
if(sf.base.isNullOrUndefined(nextValidInline)){var nextParagraph=firstInline.line.paragraph;return this.getEndPosition(nextParagraph);}else{return this.getPhysicalPositionInline(nextValidInline,0,true);}};/**
     * @private
     */Selection.prototype.getNextValidElementForField=function(firstInline){if(firstInline instanceof FieldElementBox&&firstInline.fieldType===0&&HelperMethods.isLinkedFieldCharacter(firstInline)){var fieldBegin=firstInline;if(sf.base.isNullOrUndefined(fieldBegin.fieldSeparator)){firstInline=fieldBegin.fieldEnd;}else{firstInline=fieldBegin.fieldSeparator;}}var nextValidInline=undefined;if(!sf.base.isNullOrUndefined(firstInline.nextNode)){nextValidInline=this.getNextValidElement(firstInline.nextNode);}return nextValidInline;};/**
     * Get paragraph end position
     *
     * @private
     */Selection.prototype.getEndPosition=function(widget){var left=widget.x;var top=widget.y;var lineWidget=undefined;if(widget.childWidgets.length>0){lineWidget=widget.childWidgets[widget.childWidgets.length-1];left+=this.getWidth(lineWidget,false);}if(!sf.base.isNullOrUndefined(lineWidget)){top=this.getTop(lineWidget);}var topMargin=0;var bottomMargin=0;var size=this.getParagraphMarkSize(widget,topMargin,bottomMargin);return new Point(left,top+size.topMargin);};/**
     * Get element box
     *
     * @private
     */Selection.prototype.getElementBox=function(currentInline,index,moveToNextLine){var elementBox=undefined;if(!(currentInline instanceof FieldElementBox||currentInline instanceof BookmarkElementBox||currentInline instanceof CommentCharacterElementBox)){elementBox=currentInline;}return{'element':elementBox,'index':index};};/**
     * @private
     */Selection.prototype.getPreviousTextElement=function(inline){if(inline.previousNode instanceof TextElementBox){return inline.previousNode;}if(!sf.base.isNullOrUndefined(inline.previousNode)){return this.getPreviousTextElement(inline.previousNode);}return undefined;};/**
     * Get next text inline
     *
     * @private
     */Selection.prototype.getNextTextElement=function(inline){if(inline.nextNode instanceof TextElementBox){return inline.nextNode;}if(!sf.base.isNullOrUndefined(inline.nextNode)){return this.getNextTextElement(inline.nextNode);}return undefined;};/**
     * @private
     */Selection.prototype.getNextRenderedElementBox=function(inline,indexInInline){if(inline instanceof FieldElementBox){var fieldBegin=inline;if(fieldBegin.fieldType===0){inline=this.getRenderedField(fieldBegin);if(fieldBegin===inline){return fieldBegin;}}indexInInline=1;}while(!sf.base.isNullOrUndefined(inline)&&indexInInline===inline.length&&inline.nextNode instanceof FieldElementBox){var nextValidInline=this.getNextValidElement(inline.nextNode);if(nextValidInline instanceof FieldElementBox&&nextValidInline.fieldType===0){var fieldBegin=nextValidInline;inline=this.getRenderedField(fieldBegin);if(!sf.base.isNullOrUndefined(inline)&&fieldBegin===inline){return fieldBegin;}indexInInline=1;}else{inline=nextValidInline;}}return inline;};/**
     * @private
     */Selection.prototype.getElementBoxInternal=function(inline,index){var element=undefined;element=inline;return{'element':element,'index':index};};/**
     * Get Line widget
     *
     * @private
     */Selection.prototype.getLineWidget=function(inline,index){return this.getLineWidgetInternalInline(inline,index,true);};/**
     * @private
     */Selection.prototype.getLineWidgetInternalInline=function(inline,index,moveToNextLine){var elementObj=this.getElementBox(inline,index,moveToNextLine);var element=elementObj.element;//return index
index=elementObj.index;if(!sf.base.isNullOrUndefined(element)){if(moveToNextLine&&element instanceof TextElementBox&&element.text==='\v'&&index===1){return this.getNextLineWidget(element.line.paragraph,element);}else{return element.line;}}var startInline=inline;//ToDo: Check previous inline here.
var nextValidInline=this.getNextValidElementForField(startInline);//If field separator/end exists at end of paragraph, then move to next paragraph.
if(sf.base.isNullOrUndefined(nextValidInline)){var lineWidget=undefined;var widget=startInline.line.paragraph;if(widget.childWidgets.length>0){lineWidget=widget.childWidgets[widget.childWidgets.length-1];}return lineWidget;}else{return this.getLineWidget(nextValidInline,0);}};/**
     * Get next line widget
     *
     * @private
     */Selection.prototype.getNextLineWidget=function(paragraph,element){var lineWidget=undefined;var widget=paragraph;if(widget.childWidgets.length>0){var widgetIndex=widget.childWidgets.indexOf(element.line);if(widgetIndex===widget.childWidgets.length-1){widget=paragraph;// widget = paragraph.leafWidgets[paragraph.leafWidgets.length - 1];
widgetIndex=-1;}else if(widgetIndex>widget.childWidgets.length-1){widget=this.getNextParagraphBlock(paragraph);widgetIndex=-1;}else if(widgetIndex<0){// widget = paragraph.leafWidgets[paragraph.leafWidgets.length - 1];
widget=paragraph;widgetIndex=widget.childWidgets.indexOf(element.line);}lineWidget=widget.childWidgets[widgetIndex+1];}return lineWidget;};Selection.prototype.getCaretHeight=function(inline,index,format,isEmptySelection,topMargin,isItalic){var elementBoxInfo=this.getElementBox(inline,index,false);var element=elementBoxInfo.element;var currentInline=inline;if(sf.base.isNullOrUndefined(element)){if(currentInline instanceof FieldElementBox){return this.getFieldCharacterHeight(currentInline,format,isEmptySelection,topMargin,isItalic);}return{'height':this.documentHelper.textHelper.getHeight(format).Height,'topMargin':topMargin,'isItalic':isItalic};}var margin=element.margin;var heightElement=element.height;var maxLineHeight=0;if(element instanceof ImageElementBox){var previousInline=this.getPreviousTextElement(inline);var nextInline=this.getNextTextElement(inline);if(sf.base.isNullOrUndefined(previousInline)&&sf.base.isNullOrUndefined(nextInline)){var top_2=0;var bottom=0;var paragarph=inline.line.paragraph;var sizeInfo=this.getParagraphMarkSize(paragarph,top_2,bottom);top_2=sizeInfo.topMargin;bottom=sizeInfo.bottomMargin;maxLineHeight=sizeInfo.height;isItalic=paragarph.characterFormat.italic;if(!isEmptySelection){maxLineHeight+=this.documentHelper.layout.getAfterSpacing(paragarph);}}else if(sf.base.isNullOrUndefined(previousInline)){isItalic=nextInline.characterFormat.italic;return this.getCaretHeight(nextInline,0,nextInline.characterFormat,isEmptySelection,topMargin,isItalic);}else{if(!sf.base.isNullOrUndefined(nextInline)&&element instanceof ImageElementBox){//Calculates the caret size using image character format.
var textSizeInfo=this.documentHelper.textHelper.getHeight(element.characterFormat);var charHeight=textSizeInfo.Height;var baselineOffset=textSizeInfo.BaselineOffset;maxLineHeight=element.margin.top<0&&baselineOffset>element.margin.top+element.height?element.margin.top+element.height+charHeight-baselineOffset:charHeight;if(!isEmptySelection){maxLineHeight+=element.margin.bottom;}}else{isItalic=previousInline.characterFormat.italic;return this.getCaretHeight(previousInline,previousInline.length,previousInline.characterFormat,isEmptySelection,topMargin,isItalic);}}}else{var baselineAlignment=format.baselineAlignment;var elementHeight=heightElement;if(baselineAlignment!=='Normal'&&isEmptySelection){//Set the caret height as sub/super script text height and updates the top margin for sub script text.
elementHeight=elementHeight/1.5;if(baselineAlignment==='Subscript'){topMargin=heightElement-elementHeight;}}maxLineHeight=(margin.top<0?margin.top:0)+elementHeight;if(!isEmptySelection){maxLineHeight+=margin.bottom;}}if(!isEmptySelection){return{'height':maxLineHeight,'topMargin':topMargin,'isItalic':isItalic};}var height=this.documentHelper.textHelper.getHeight(format).Height;if(height>maxLineHeight){height=maxLineHeight;}return{'height':height,'topMargin':topMargin,'isItalic':isItalic};};Selection.prototype.getFieldCharacterHeight=function(startInline,format,isEmptySelection,topMargin,isItalic){var nextValidInline=this.getNextValidElementForField(startInline);//If field separator/end exists at end of paragraph, then move to next paragraph.
if(sf.base.isNullOrUndefined(nextValidInline)){var nextParagraph=startInline.line.paragraph;var height=this.documentHelper.textHelper.getParagraphMarkSize(format).Height;var top_3=0;var bottom=0;var sizeInfo=this.getParagraphMarkSize(nextParagraph,top_3,bottom);var maxLineHeight=sizeInfo.height;top_3=sizeInfo.topMargin;bottom=sizeInfo.bottomMargin;if(!isEmptySelection){maxLineHeight+=bottom;return{'height':maxLineHeight,'topMargin':topMargin,'isItalic':isItalic};}if(height>maxLineHeight){height=maxLineHeight;}return{'height':height,'topMargin':topMargin,'isItalic':isItalic};}else{return this.getCaretHeight(nextValidInline,0,format,isEmptySelection,topMargin,isItalic);}};/**
     * Get rendered inline
     *
     * @private
     */ //FieldCharacter
Selection.prototype.getRenderedInline=function(inline,inlineIndex){var prevInline=this.getPreviousValidElement(inline);while(prevInline instanceof FieldElementBox){prevInline=this.getPreviousTextElement(prevInline);if(prevInline instanceof FieldElementBox){prevInline=prevInline.previousNode;}}if(!sf.base.isNullOrUndefined(prevInline)){inlineIndex=prevInline.length;return{'element':prevInline,'index':inlineIndex};}inlineIndex=0;var nextInline=this.getNextRenderedElementBox(inline,0);if(nextInline instanceof FieldElementBox&&nextInline.fieldType===0){nextInline=nextInline.fieldSeparator;nextInline=nextInline.nextNode;while(nextInline instanceof FieldElementBox){if(nextInline instanceof FieldElementBox&&nextInline.fieldType===0&&HelperMethods.isLinkedFieldCharacter(nextInline)){if(sf.base.isNullOrUndefined(nextInline.fieldSeparator)){nextInline=nextInline.fieldEnd;}else{nextInline=nextInline.fieldSeparator;}}nextInline=nextInline.nextNode;}}return{'element':nextInline,'index':inlineIndex};};//Field Begin
/**
     * Get rendered field
     *
     * @private
     */Selection.prototype.getRenderedField=function(fieldBegin){var inline=fieldBegin;if(sf.base.isNullOrUndefined(fieldBegin.fieldSeparator)){inline=fieldBegin.fieldEnd;}else{inline=fieldBegin.fieldSeparator;var paragraph=inline.line.paragraph;if(paragraph===fieldBegin.fieldEnd.line.paragraph&&!this.hasValidInline(paragraph,inline,fieldBegin.fieldEnd)){inline=fieldBegin.fieldEnd;}else{return inline;}}return inline;};/**
     * Return true is inline is tha last inline
     *
     * @private
     */Selection.prototype.isLastRenderedInline=function(inline,index){while(index===inline.length&&inline.nextNode instanceof FieldElementBox){var nextValidInline=this.getNextValidElement(inline.nextNode);index=0;if(nextValidInline instanceof FieldElementBox&&nextValidInline.fieldType===0){inline=nextValidInline;}if(inline instanceof FieldElementBox&&inline.fieldType===0&&!sf.base.isNullOrUndefined(inline.fieldEnd)){var fieldBegin=inline;if(sf.base.isNullOrUndefined(fieldBegin.fieldSeparator)){inline=fieldBegin.fieldEnd;index=1;}else{inline=fieldBegin.fieldSeparator;var paragraph=inline.line.paragraph;index=1;if(paragraph===fieldBegin.fieldEnd.line.paragraph&&!this.hasValidInline(paragraph,inline,fieldBegin.fieldEnd)){inline=fieldBegin.fieldEnd;}else{break;}}}}return index===inline.length&&sf.base.isNullOrUndefined(inline.nextNode);};/**
     * Get page
     *
     * @private
     */Selection.prototype.getPage=function(widget){var page=undefined;if(widget.containerWidget instanceof TextFrame){var shape=widget.containerWidget.containerShape;if(shape.line){page=this.getPage(shape.line.paragraph);}}else if(widget.containerWidget instanceof BlockContainer){var bodyWidget=widget.containerWidget;page=widget.containerWidget.page;}else if(!sf.base.isNullOrUndefined(widget.containerWidget)){page=this.getPage(widget.containerWidget);}return page;};/**
     * Clear Selection highlight
     *
     * @private
     */Selection.prototype.clearSelectionHighlightInSelectedWidgets=function(){var isNonEmptySelection=false;var widgets=this.selectedWidgets.keys;for(var i=0;i<widgets.length;i++){this.removeSelectionHighlight(widgets[i]);isNonEmptySelection=true;}this.selectedWidgets.clear();return isNonEmptySelection;};/**
     * Clear selection highlight
     *
     * @private
     */Selection.prototype.clearChildSelectionHighlight=function(widget){for(var i=0;i<widget.childWidgets.length;i++){if(widget.childWidgets[i]instanceof LineWidget){this.clearSelectionHighlightLineWidget(widget.childWidgets[i]);}else if(widget.childWidgets[i]instanceof TableCellWidget){this.clearSelectionHighlight(widget.childWidgets[i]);}else if(widget.childWidgets[i]instanceof Widget){this.clearChildSelectionHighlight(widget.childWidgets[i]);}}};/**
     * Get line widget from paragraph widget
     *
     * @private
     */ //Body Widget
Selection.prototype.getLineWidgetBodyWidget=function(widget,point){var bodyWgt=widget;if(bodyWgt instanceof BlockContainer){for(var x=0;x<bodyWgt.floatingElements.length;x++){var floatWidget=bodyWgt.floatingElements[x];if(floatWidget instanceof TableWidget){var floatWidgetWidth=floatWidget.getTableCellWidth();if(point.x<=floatWidget.x+floatWidgetWidth&&point.x>=floatWidget.x&&point.y<=floatWidget.y+floatWidget.height&&point.y>=floatWidget.y){return this.getLineWidgetTableWidget(floatWidget,point);}}}}for(var i=0;i<widget.childWidgets.length;i++){var childWidget=widget.childWidgets[i];if(childWidget instanceof FootNoteWidget){for(var j=0;j<childWidget.childWidgets.length;j++){var footChild=childWidget.childWidgets[j];if(footChild instanceof Widget&&footChild.y<=point.y&&footChild.y+footChild.height>=point.y){if(footChild instanceof ParagraphWidget){return this.getLineWidgetParaWidget(footChild,point);}else{return this.getLineWidgetTableWidget(footChild,point);}}}}else{if(childWidget instanceof Widget&&childWidget.y<=point.y&&childWidget.y+childWidget.height>=point.y){if(childWidget instanceof ParagraphWidget){return this.getLineWidgetParaWidget(childWidget,point);}else{var table=childWidget;if(table.wrapTextAround){continue;}return this.getLineWidgetTableWidget(table,point);}}}}var line=undefined;if(widget.childWidgets.length>0){var firstChild=widget.childWidgets[0];if(firstChild instanceof Widget&&firstChild.y<=point.y){if(widget.childWidgets[widget.childWidgets.length-1]instanceof ParagraphWidget){line=this.getLineWidgetParaWidget(widget.childWidgets[widget.childWidgets.length-1],point);}else{line=this.getLineWidgetTableWidget(widget.childWidgets[widget.childWidgets.length-1],point);}}else{var childWidget=undefined;if(firstChild instanceof Widget){childWidget=firstChild;}if(!sf.base.isNullOrUndefined(childWidget)){if(childWidget instanceof ParagraphWidget){line=this.getLineWidgetParaWidget(firstChild,point);}else{line=this.getLineWidgetTableWidget(firstChild,point);}}}}return line;};//ParagraphWidget
/**
     * Get line widget from paragraph widget
     *
     * @private
     */Selection.prototype.getLineWidgetParaWidget=function(widget,point){var childWidgets=widget.childWidgets;var top=widget.y;for(var i=0;i<childWidgets.length;i++){var line=childWidgets[i];top+=line.marginTop;var lineTotalHeight=line.height;if(line.nextLine&&line.nextLine.marginTop>0){lineTotalHeight+=line.nextLine.marginTop;}if(top<=point.y&&top+lineTotalHeight>=point.y){return line;}top+=line.height;}var lineWidget=undefined;if(childWidgets.length>0){if(widget.y<=point.y){lineWidget=childWidgets[childWidgets.length-1];}else{lineWidget=childWidgets[0];}}return lineWidget;};Selection.prototype.highlightParagraph=function(widget,startIndex,endLine,endElement,endIndex){var top=0;var width=0;var isRtlText=false;if(widget.paragraphFormat.bidi&&endLine.children.indexOf(endElement)>0){endElement=endLine.children[0];}for(var i=startIndex;i<widget.childWidgets.length;i++){var line=widget.childWidgets[i];if(i===startIndex){top=this.getTop(line);}else{top+=line.marginTop;}if(endElement instanceof TextElementBox){isRtlText=endElement.isRightToLeft;}var left=this.getLeft(line);if(line===endLine){//Selection ends in current line.
var right=0;// highlighting approach for normal and rtl text.
if(isRtlText||widget.bidi){var elementBoxCollection=this.getElementsBackward(line,endElement,endElement,widget.bidi);for(var i_2=0;i_2<elementBoxCollection.length;i_2++){var element=elementBoxCollection[i_2];var elementIsRTL=false;if(element===endElement){right=this.getLeftInternal(line,element,endIndex);}else{var index=element instanceof TextElementBox?element.length:1;right=this.getLeftInternal(line,element,index);}left=this.getLeftInternal(line,element,0);if(element instanceof TextElementBox){elementIsRTL=element.isRightToLeft;}width=Math.abs(right-left);// Handled the paragraph mark highliting as special case.
if(element===endElement&&element instanceof TextElementBox&&endIndex>element.length){var paragraphMarkWidth=this.documentHelper.textHelper.getParagraphMarkSize(element.line.paragraph.characterFormat).Width;if(!widget.bidi&&elementIsRTL){right+=paragraphMarkWidth;}else if(widget.bidi&&!elementIsRTL){// Paragrph and Selection ends in normal text
width-=paragraphMarkWidth;// Highlight the element.
this.createHighlightBorder(line,width,left,top,true);// Highlight the paragraph mark of Bidi paragrph. 
left=this.getLineStartLeft(line)-paragraphMarkWidth;this.createHighlightBorder(line,paragraphMarkWidth,left,top,true);// continue to next element.
continue;}}this.createHighlightBorder(line,width,elementIsRTL?right:left,top,true);}return;}else{right=this.getLeftInternal(endLine,endElement,endIndex);width=Math.abs(right-left);this.createHighlightBorder(line,width,isRtlText?right:left,top,false);return;}}else{width=this.getWidth(line,true)-(left-widget.x);// Highlight the paragrph mark for Bidi paragrph.
if(widget.bidi&&line.isLastLine()){left-=this.documentHelper.textHelper.getParagraphMarkSize(widget.characterFormat).Width;}this.createHighlightBorder(line,width,left,top,false);top+=line.height;}}};//Table Widget
/**
     * Get line widget form table widget
     *
     * @private
     */Selection.prototype.getLineWidgetTableWidget=function(widget,point){var lineWidget=undefined;for(var i=0;i<widget.childWidgets.length;i++){//Removed the height condition check to handle the vertically merged cells.
var childWidget=widget.childWidgets[i];if(childWidget instanceof TableRowWidget&&childWidget.y<=point.y){if(childWidget.rowFormat.heightType==='Exactly'&&childWidget.y+HelperMethods.convertPointToPixel(childWidget.rowFormat.height)<point.y){continue;}lineWidget=this.getLineWidgetRowWidget(childWidget,point);var cellWidget=undefined;if(!sf.base.isNullOrUndefined(lineWidget)&&lineWidget.paragraph.containerWidget instanceof TableCellWidget){cellWidget=lineWidget.paragraph.containerWidget;}var cellSpacing=0;var rowSpan=0;if(!sf.base.isNullOrUndefined(cellWidget)){var tableWidget=cellWidget.ownerRow.containerWidget;cellSpacing=HelperMethods.convertPointToPixel(tableWidget.tableFormat.cellSpacing);rowSpan=cellWidget.cellFormat.rowSpan;}var leftCellSpacing=0;var rightCellSpacing=0;var topCellSpacing=0;var bottomCellSpacing=0;if(cellSpacing>0){leftCellSpacing=cellWidget.cellIndex===0?cellSpacing:cellSpacing/2;rightCellSpacing=cellWidget.cellIndex===cellWidget.ownerRow.childWidgets.length-1?cellSpacing:cellSpacing/2;var rowWidget=undefined;if(cellWidget.containerWidget instanceof TableRowWidget){rowWidget=cellWidget.containerWidget;}var tableWidget=undefined;if(cellWidget.containerWidget.containerWidget instanceof TableWidget){tableWidget=cellWidget.containerWidget.containerWidget;}if(!sf.base.isNullOrUndefined(rowWidget)&&!sf.base.isNullOrUndefined(tableWidget)){topCellSpacing=cellWidget.ownerRow.rowIndex===0?cellSpacing:cellSpacing/2;if(cellWidget.ownerRow.rowIndex+rowSpan===cellWidget.ownerTable.childWidgets.length){bottomCellSpacing=cellSpacing;}else{bottomCellSpacing=cellSpacing/2;}}}if(!sf.base.isNullOrUndefined(lineWidget)&&lineWidget.paragraph.x<=point.x&&lineWidget.paragraph.x+lineWidget.width>=point.x&&lineWidget.paragraph.y<=point.y&&this.getTop(lineWidget)+lineWidget.height>=point.y||!sf.base.isNullOrUndefined(cellWidget)&&cellWidget.x-cellWidget.margin.left-leftCellSpacing<=point.x&&cellWidget.x+cellWidget.width+cellWidget.margin.right+rightCellSpacing>=point.x&&cellWidget.y-cellWidget.margin.top-topCellSpacing<=point.y&&cellWidget.y+cellWidget.height+cellWidget.margin.bottom+bottomCellSpacing>=point.y){break;}}}return lineWidget;};//TableRowWidget
/**
     * Get line widget fom row
     *
     * @private
     */Selection.prototype.getLineWidgetRowWidget=function(widget,point){for(var i=0;i<widget.childWidgets.length;i++){var cellSpacing=0;cellSpacing=HelperMethods.convertPointToPixel(widget.ownerTable.tableFormat.cellSpacing);var leftCellSpacing=0;var rightCellSpacing=0;if(cellSpacing>0){leftCellSpacing=widget.childWidgets[i].columnIndex===0?cellSpacing:cellSpacing/2;rightCellSpacing=widget.childWidgets[i].cellIndex===widget.childWidgets[i].ownerRow.childWidgets.length-1?cellSpacing:cellSpacing/2;}if(widget.childWidgets[i].x-widget.childWidgets[i].margin.left-leftCellSpacing<=point.x&&widget.childWidgets[i].x+widget.childWidgets[i].width+widget.childWidgets[i].margin.right+rightCellSpacing>=point.x){return this.getLineWidgetCellWidget(widget.childWidgets[i],point);}}var lineWidget=undefined;if(widget.childWidgets.length>0){if(widget.childWidgets[0].x<=point.x){lineWidget=this.getLineWidgetCellWidget(widget.childWidgets[widget.childWidgets.length-1],point);}else{lineWidget=this.getLineWidgetCellWidget(widget.childWidgets[0],point);}}return lineWidget;};/**
     * @private
     */Selection.prototype.getFirstBlock=function(cell){if(cell.childWidgets.length>0){return cell.childWidgets[0];}return undefined;};//Table Cell Widget
/**
     * Highlight selected cell widget
     *
     * @private
     */Selection.prototype.highlightCellWidget=function(widget){var widgets=[];if(widget.previousSplitWidget||widget.nextSplitWidget){widgets=widget.getSplitWidgets();}else{widgets.push(widget);}for(var i=0;i<widgets.length;i++){widget=widgets[i];//Clears Selection highlight of the child widgets.
this.clearChildSelectionHighlight(widget);//Highlights the entire cell.
this.createHighlightBorderInsideTable(widget);}};/**
     * Clear selection highlight
     *
     * @private
     */Selection.prototype.clearSelectionHighlight=function(widget){if(this.selectedWidgets.containsKey(widget)){this.removeSelectionHighlight(widget);this.selectedWidgets.remove(widget);}};/**
     * Get line widget from cell widget
     *
     * @private
     */Selection.prototype.getLineWidgetCellWidget=function(widget,point){for(var i=0;i<widget.childWidgets.length;i++){if(widget.childWidgets[i].y<=point.y&&widget.childWidgets[i].y+widget.childWidgets[i].height>=point.y){if(widget.childWidgets[i]instanceof ParagraphWidget){return this.getLineWidgetParaWidget(widget.childWidgets[i],point);}else{return this.getLineWidgetTableWidget(widget.childWidgets[i],point);}}}var lineWidget=undefined;if(widget.childWidgets.length>0){if(widget.childWidgets[0].y<=point.y){if(widget.childWidgets[widget.childWidgets.length-1]instanceof ParagraphWidget){lineWidget=this.getLineWidgetParaWidget(widget.childWidgets[widget.childWidgets.length-1],point);}else{lineWidget=this.getLineWidgetTableWidget(widget.childWidgets[0],point);}}}return lineWidget;};//LineWidget
/**
     * update text position
     *
     * @private
     */Selection.prototype.updateTextPosition=function(widget,point){var caretPosition=point;var element=undefined;var index=0;var isImageSelected=false;var isImageSelectedObj=this.updateTextPositionIn(widget,element,index,point,false);if(!sf.base.isNullOrUndefined(isImageSelectedObj)){element=isImageSelectedObj.element;index=isImageSelectedObj.index;caretPosition=isImageSelectedObj.caretPosition;isImageSelected=isImageSelectedObj.isImageSelected;this.isImageSelected=isImageSelected;}if(isImageSelected){this.selectInternal(widget,element,index,caretPosition);if(index===0){this.extendForward();}else{this.extendBackward();}}else{this.selectInternal(widget,element,index,caretPosition);}};/**
     * @private
     */Selection.prototype.updateTextPositionIn=function(widget,inline,index,caretPosition,includeParagraphMark){var isImageSelected=false;var top=this.getTop(widget);var left=widget.paragraph.x;var elementValues=this.getFirstElement(widget,left);var element=elementValues.element;var isRtlText=false;var isParaBidi=false;left=elementValues.left;if(sf.base.isNullOrUndefined(element)){var topMargin=0;var bottomMargin=0;var size=this.getParagraphMarkSize(widget.paragraph,topMargin,bottomMargin);topMargin=size.topMargin;bottomMargin=size.bottomMargin;var selectParaMark=this.documentHelper.mouseDownOffset.y>=top&&this.documentHelper.mouseDownOffset.y<top+widget.height?this.documentHelper.mouseDownOffset.x<left+size.width:true;if(selectParaMark&&includeParagraphMark&&caretPosition.x>left+size.width/2){left+=size.width;if(widget.children.length>0){inline=widget.children[widget.children.length-1];index=inline.length;}index++;}caretPosition=new Point(left,topMargin>0?top+topMargin:top);}else{if(!sf.base.isNullOrUndefined(element)){if(caretPosition.x>left+element.margin.left||element instanceof ShapeBase&&element.textWrappingStyle!=='Inline'){var isInInline=false;if(widget.paragraph.floatingElements.length>0){isInInline=this.documentHelper.checkPointIsInLine(widget,caretPosition);}for(var i=widget.children.indexOf(element);i<widget.children.length;i++){element=widget.children[i];if(element instanceof ShapeBase&&element.textWrappingStyle!=='Inline'){if(this.documentHelper.isInShapeBorder(element,caretPosition)&&!this.documentHelper.isSelectionChangedOnMouseMoved&&!isInInline){left=element.x;top=element.y;break;}continue;}var isCurrentParaBidi=false;if(element instanceof ListTextElementBox||element instanceof TextElementBox){isCurrentParaBidi=element.line.paragraph.paragraphFormat.bidi;}if(caretPosition.x<left+element.margin.left+element.width+element.padding.left||i===widget.children.length-1||widget.children[i+1]instanceof ListTextElementBox&&isCurrentParaBidi){break;}left+=element.margin.left+element.width+element.padding.left;}if(element instanceof TextElementBox){isRtlText=element.isRightToLeft;isParaBidi=element.line.paragraph.paragraphFormat.bidi;}if(caretPosition.x>left+element.margin.left+element.width+element.padding.left){//Line End
index=element instanceof TextElementBox?element.length:1;if(isRtlText&&isParaBidi){index=0;}if(element instanceof TextElementBox&&(element.text!=="\v"||element.text!=='\f')||includeParagraphMark){left+=element.margin.left+element.width+element.padding.left;}}else if(element instanceof TextElementBox){if(element instanceof TextElementBox&&isRtlText){left+=element.width+element.padding.left;}var x=0;if(isRtlText){x=left+element.margin.left-caretPosition.x;}else{x=caretPosition.x-left-element.margin.left-element.padding.left;}left+=element.margin.left+element.padding.left;var prevWidth=0;var charIndex=0;for(var i=1;i<=element.length;i++){var width=0;if(i===element.length){width=element.width+element.padding.left;}else{width=this.documentHelper.textHelper.getWidth(element.text.substr(0,i),element.characterFormat);element.trimEndWidth=width;}if(x<width||i===element.length){//Updates exact left position of the caret.
var charWidth=width-prevWidth;if(x-prevWidth>charWidth/2){if(isRtlText){left-=width;}else{left+=width;}charIndex=i;}else{if(isRtlText){left-=prevWidth;}else{left+=prevWidth;}charIndex=i-1;if(i===1&&element!==widget.children[0]&&!(widget.children[0]instanceof ShapeBase&&widget.children[0].textWrappingStyle!=='Inline')){var curIndex=widget.children.indexOf(element);if(!(widget.children[curIndex-1]instanceof ListTextElementBox)&&!isRtlText){element=widget.children[curIndex-1];charIndex=element instanceof TextElementBox?element.length:1;}}}break;}prevWidth=width;}index=charIndex;}else{isImageSelected=element instanceof ImageElementBox||element instanceof ShapeElementBox;if(caretPosition.x-left-element.margin.left>element.width/2){index=1;left+=element.margin.left+element.width+element.padding.left;}else if(element!==widget.children[0]&&!isImageSelected){var curIndex=widget.children.indexOf(element);if(!(widget.children[curIndex-1]instanceof ListTextElementBox)){element=widget.children[curIndex-1];index=element instanceof TextElementBox?element.length:1;}}}if(element instanceof TextElementBox&&(element.text==='\v'||element.text==='\f')){index=0;}}else{isRtlText=element.isRightToLeft;isParaBidi=element.line.paragraph.paragraphFormat.bidi;if(element instanceof TextElementBox&&(isParaBidi||isRtlText)&&caretPosition.x<left+element.margin.left+element.width+element.padding.left){index=this.getTextLength(element.line,element)+element.length;}else{index=this.getTextLength(element.line,element);}left+=element.margin.left;}if(element instanceof TextElementBox){top+=element.margin.top>0?element.margin.top:0;}else{var textMetrics=this.documentHelper.textHelper.getHeight(element.characterFormat);//for ascent and descent
var height=element.height;if(element instanceof BookmarkElementBox&&!this.documentHelper.layout.hasValidElement(element.line.paragraph)){height=textMetrics.Height;//after text helper class
}top+=element.margin.top+height-textMetrics.BaselineOffset;}inline=element;if(inline instanceof FieldElementBox&&inline.fieldType===2&&!sf.base.isNullOrUndefined(inline.fieldBegin)){inline=inline.fieldBegin;index=0;}if(inline instanceof EditRangeEndElementBox){index=0;}var inlineObj=this.validateTextPosition(inline,index);inline=inlineObj.element;index=inlineObj.index;var isParagraphEnd=sf.base.isNullOrUndefined(inline.nextNode)&&index===inline.length;var isLineEnd=sf.base.isNullOrUndefined(inline.nextNode)&&inline instanceof TextElementBox&&inline.text==='\v';if(includeParagraphMark&&inline.nextNode instanceof FieldElementBox&&index===inline.length){isParagraphEnd=this.isLastRenderedInline(inline,index);}if(includeParagraphMark&&isParagraphEnd||isLineEnd){var width=0;//Include width of Paragraph mark.
if(isParagraphEnd){width=this.documentHelper.textHelper.getParagraphMarkWidth(widget.paragraph.characterFormat);var selectParaMark=this.documentHelper.mouseDownOffset.y>=top&&this.documentHelper.mouseDownOffset.y<top+widget.height?this.documentHelper.mouseDownOffset.x<left+width:true;if(selectParaMark&&caretPosition.x>left+width/2){left+=width;index=inline.length+1;}//Include width of line break mark.
}else if(isLineEnd){width=element.width+element.padding.left;left+=width;index=inline.length;}}caretPosition=new Point(left,top);}}return{'element':inline,'index':index,'caretPosition':caretPosition,'isImageSelected':isImageSelected};};/**
     * @private
     */Selection.prototype.checkAllFloatingElements=function(widget,caretPosition){var bodyWidget;var isShapeSelected=false;var isInShapeBorder=false;var floatElement;if(!sf.base.isNullOrUndefined(widget)){bodyWidget=widget.paragraph.bodyWidget;isShapeSelected=false;isInShapeBorder=false;for(var i=0;i<bodyWidget.floatingElements.length;i++){if(bodyWidget.floatingElements[i]instanceof TableWidget){continue;}floatElement=bodyWidget.floatingElements[i];if(caretPosition.x<floatElement.x+floatElement.margin.left+floatElement.width&&caretPosition.x>floatElement.x&&caretPosition.y<floatElement.y+floatElement.margin.top+floatElement.height&&caretPosition.y>floatElement.y){isShapeSelected=true;if(this.documentHelper.isInShapeBorder(floatElement,caretPosition)){isInShapeBorder=true;}break;}}}return{'element':floatElement,'caretPosition':caretPosition,'isShapeSelected':isShapeSelected,'isInShapeBorder':isInShapeBorder};};/**
     * Get text length if the line widget
     *
     * @private
     */Selection.prototype.getTextLength=function(widget,element){var length=0;var count=widget.children.indexOf(element);if(widget.children.length>0&&widget.children[0]instanceof ListTextElementBox){if(widget.children[1]instanceof ListTextElementBox){count-=2;}else{count-=1;}}for(var i=1;i<count;i++){length+=widget.children[i].length;}return length;};/**
     * Get Line widget left
     *
     * @private
     */Selection.prototype.getLeft=function(widget){var left=widget.paragraph.x;var paragraphFormat=widget.paragraph.paragraphFormat;if(this.isParagraphFirstLine(widget)&&!paragraphFormat.bidi&&!(paragraphFormat.textAlignment==='Right')){left+=HelperMethods.convertPointToPixel(paragraphFormat.firstLineIndent);}for(var i=0;i<widget.children.length;i++){var element=widget.children[i];if(element instanceof ListTextElementBox&&!paragraphFormat.bidi){//after list implementation
if(i===0){left+=element.margin.left+element.width;}else{left+=element.width;}}else{left+=element.margin.left;break;}}return left;};/**
     * Get line widget top
     *
     * @private
     */Selection.prototype.getTop=function(widget){var top=widget.paragraph.y;var count=widget.paragraph.childWidgets.indexOf(widget);for(var i=0;i<count;i++){var line=widget.paragraph.childWidgets[i];top=top+line.height+line.marginTop;}top+=widget.marginTop;return top;};/**
     * Get first element the widget
     *
     * @private
     */Selection.prototype.getFirstElement=function(widget,left){var firstLineIndent=0;if(this.isParagraphFirstLine(widget)&&!widget.paragraph.paragraphFormat.bidi){firstLineIndent=HelperMethods.convertPointToPixel(widget.paragraph.paragraphFormat.firstLineIndent);}left+=firstLineIndent;var element=undefined;for(var i=0;i<widget.children.length;i++){element=widget.children[i];if(element instanceof ListTextElementBox||element instanceof CommentCharacterElementBox){if(widget.paragraph.paragraphFormat.bidi){left+=element.margin.left;element=undefined;break;}left+=element.margin.left+element.width;element=undefined;// }
//  else if (element instanceof FieldElementBox || element instanceof BookmarkElementBox
//     || (element.nextNode instanceof FieldElementBox && ((element.nextNode as FieldElementBox).fieldType === 2))) {
//     element = undefined;
}else{break;}}return{'element':element,'left':left};};/**
     * Return inline index
     *
     * @private
     */ //ElementBox
Selection.prototype.getIndexInInline=function(elementBox){var indexInInline=0;if(elementBox instanceof TextElementBox){var count=elementBox.line.children.indexOf(elementBox);for(var i=0;i<count;i++){var element=elementBox.line.children[i];if(element instanceof FieldElementBox||element instanceof ListTextElementBox){continue;}indexInInline+=element.length;}}return indexInInline;};/**
     * Return true if widget is first inline of paragraph
     *
     * @private
     */Selection.prototype.isParagraphFirstLine=function(widget){if(sf.base.isNullOrUndefined(widget.paragraph.previousSplitWidget)&&widget===widget.paragraph.firstChild){return true;}return false;};/**
     * @param widget
     * @private
     */Selection.prototype.isParagraphLastLine=function(widget){if(sf.base.isNullOrUndefined(widget.paragraph.nextSplitWidget)&&widget===widget.paragraph.lastChild){return true;}return false;};/**
     * Return line widget width
     *
     * @private
     */Selection.prototype.getWidth=function(widget,includeParagraphMark){var width=0;var paraFormat=widget.paragraph.paragraphFormat;if(this.isParagraphFirstLine(widget)&&!paraFormat.bidi){width+=HelperMethods.convertPointToPixel(paraFormat.firstLineIndent);}for(var i=0;i<widget.children.length;i++){var elementBox=widget.children[i];if(elementBox instanceof ShapeBase&&elementBox.textWrappingStyle!=='Inline'){continue;}width+=elementBox.margin.left+elementBox.width+elementBox.padding.left;}if(includeParagraphMark&&widget.paragraph.childWidgets.indexOf(widget)===widget.paragraph.childWidgets.length-1&&sf.base.isNullOrUndefined(widget.paragraph.nextSplitWidget)){width+=this.documentHelper.textHelper.getParagraphMarkWidth(widget.paragraph.characterFormat);}return width;};/**
     * Return line widget left
     *
     * @private
     */Selection.prototype.getLeftInternal=function(widget,elementBox,index){var left=widget.paragraph.x;var paraFormat=widget.paragraph.paragraphFormat;if(this.isParagraphFirstLine(widget)&&!paraFormat.bidi){left+=HelperMethods.convertPointToPixel(widget.paragraph.paragraphFormat.firstLineIndent);}var isRtlText=false;var isParaBidi=false;if(elementBox instanceof TextElementBox){isRtlText=elementBox.isRightToLeft;isParaBidi=elementBox.line.paragraph.paragraphFormat.bidi;}//when line contains normal text and para is RTL para.
//if home key is pressed, update caret position after the last element in a line.
//if end key pressed, update caret position before the first element in a line. 
if(isParaBidi){if(!isRtlText){if(this.documentHelper.moveCaretPosition===1&&widget.children.length>0){elementBox=widget.children[widget.children.length-1];}else if(this.documentHelper.moveCaretPosition===2){elementBox=widget.children[0];}if(elementBox instanceof ListTextElementBox&&widget.children.length>2){elementBox=widget.children[widget.children.length-3];}}}var count=widget.children.indexOf(elementBox);if(widget.children.length===1&&widget.children[0]instanceof ListTextElementBox||widget.children.length===2&&widget.children[0]instanceof ListTextElementBox&&widget.children[1]instanceof ListTextElementBox){count=widget.children.length;}for(var i=0;i<count;i++){var widgetInternal=widget.children[i];if(widgetInternal instanceof ShapeBase&&widgetInternal.textWrappingStyle!=='Inline'){continue;}if(i===1&&widget.children[i]instanceof ListTextElementBox){left+=widget.children[i].width;}else if(widget.children[i]instanceof TabElementBox&&elementBox===widgetInternal){left+=widget.children[i].margin.left;}else{left+=widget.children[i].margin.left+widget.children[i].width+widget.children[i].padding.left;}}if(!sf.base.isNullOrUndefined(elementBox)){left+=elementBox.margin.left+elementBox.padding.left;if(elementBox instanceof ShapeBase&&!sf.base.isNullOrUndefined(elementBox.nextElement)){left+=elementBox.nextElement.margin.left+elementBox.nextElement.padding.left;}if(isRtlText||this.documentHelper.moveCaretPosition===1&&!isRtlText&&isParaBidi){left+=elementBox.width;}}var width=0;if(elementBox instanceof TextElementBox){if(this.documentHelper.moveCaretPosition!==0&&(isParaBidi||isRtlText)){if(isRtlText&&isParaBidi&&this.documentHelper.moveCaretPosition===2||isRtlText&&!isParaBidi&&this.documentHelper.moveCaretPosition===1){left-=elementBox.width;}this.documentHelper.moveCaretPosition=0;return left;}if(index===elementBox.length&&!isRtlText){left+=elementBox.width;}else if(index>elementBox.length){width=this.documentHelper.textHelper.getParagraphMarkWidth(elementBox.line.paragraph.characterFormat);if(isRtlText){left-=elementBox.width+width;}else{left+=elementBox.width+width;}}else{width=this.documentHelper.textHelper.getWidth(elementBox.text.substr(0,index),elementBox.characterFormat);elementBox.trimEndWidth=width;if(isRtlText){left-=width;}else{left+=width;}}this.documentHelper.moveCaretPosition=0;}else if(index>0){if(!sf.base.isNullOrUndefined(elementBox)&&!(elementBox instanceof ListTextElementBox)){if(!(elementBox instanceof ShapeBase&&elementBox.textWrappingStyle!=='Inline')){left+=elementBox.width;}if(index===2){var paragraph=elementBox.line.paragraph;left+=this.documentHelper.textHelper.getParagraphMarkWidth(paragraph.characterFormat);}}else{left+=this.documentHelper.textHelper.getParagraphMarkWidth(widget.paragraph.characterFormat);}}return left;};/**
     * Return line widget start offset
     * @private
     */Selection.prototype.getLineStartLeft=function(widget){var left=widget.paragraph.x;var paragraphFormat=widget.paragraph.paragraphFormat;if(this.isParagraphFirstLine(widget)&&!paragraphFormat.bidi){left+=HelperMethods.convertPointToPixel(paragraphFormat.firstLineIndent);}if(widget.children.length>0){left+=widget.children[0].margin.left;}return left;};/**
     * Update text position
     * @private
     */Selection.prototype.updateTextPositionWidget=function(widget,point,textPosition,includeParagraphMark){var caretPosition=point;var inline=undefined;var index=0;var updatePositionObj;updatePositionObj=this.updateTextPositionIn(widget,inline,index,caretPosition,includeParagraphMark);inline=updatePositionObj.element;index=updatePositionObj.index;caretPosition=updatePositionObj.caretPosition;textPosition.setPositionForSelection(widget,inline,index,caretPosition);};/**
     * Clear selection highlight
     * @private
     */Selection.prototype.clearSelectionHighlightLineWidget=function(widget){if(!sf.base.isNullOrUndefined(this.owner)&&this.selectedWidgets.length>0){this.clearSelectionHighlight(this);}};/**
     * Return first element from line widget
     * @private
     */Selection.prototype.getFirstElementInternal=function(widget){var element=undefined;var isBidi=widget.paragraph.paragraphFormat.bidi;var childLen=widget.children.length;for(var i=isBidi?childLen-1:0;isBidi?i>=0:i<childLen;isBidi?i--:i++){element=widget.children[i];if(element instanceof ListTextElementBox){element=undefined;}else{break;}}return element;};//Selection API    
/**
     * Select content between given range
     * @private
     */Selection.prototype.selectRange=function(startPosition,endPosition){this.start.setPositionInternal(startPosition);this.end.setPositionInternal(endPosition);this.upDownSelectionLength=this.end.location.x;this.fireSelectionChanged(true);};/**
     * Selects current paragraph
     * @private
     */Selection.prototype.selectParagraphInternal=function(paragraph,positionAtStart){var line;if(!sf.base.isNullOrUndefined(paragraph)&&!sf.base.isNullOrUndefined(paragraph.firstChild)){line=paragraph.firstChild;if(positionAtStart){this.start.setPosition(line,positionAtStart);}else{var endOffset=line.getEndOffset();this.start.setPositionParagraph(line,endOffset);}}this.end.setPositionInternal(this.start);this.upDownSelectionLength=this.start.location.x;this.fireSelectionChanged(true);};/**
     * @private
     */Selection.prototype.setPositionForBlock=function(block,selectFirstBlock){var position;if(block instanceof TableWidget){if(selectFirstBlock){block=this.getFirstParagraphInFirstCell(block);}else{block=this.getLastParagraphInLastCell(block);}}if(block instanceof ParagraphWidget){position=new TextPosition(this.owner);if(selectFirstBlock){position.setPosition(block.firstChild,true);}else{var line=block.lastChild;position.setPositionParagraph(line,line.getEndOffset());}}return position;};/**
     * Select content in given text position
     * @private
     */Selection.prototype.selectContent=function(textPosition,clearMultiSelection){if(sf.base.isNullOrUndefined(textPosition)){throw new Error('textPosition is undefined.');}this.start.setPositionInternal(textPosition);this.end.setPositionInternal(textPosition);this.upDownSelectionLength=this.end.location.x;this.fireSelectionChanged(true);};/**
     * Select paragraph
     * @private
     */Selection.prototype.selectInternal=function(lineWidget,element,index,physicalLocation){this.start.setPositionForSelection(lineWidget,element,index,physicalLocation);this.end.setPositionInternal(this.start);this.upDownSelectionLength=physicalLocation.x;this.fireSelectionChanged(true);};/**
     * @private
     */Selection.prototype.selects=function(lineWidget,offset,skipSelectionChange){this.documentHelper.clearSelectionHighlight();this.start.setPositionForLineWidget(lineWidget,offset);this.end.setPositionInternal(this.start);if(!skipSelectionChange){this.fireSelectionChanged(true);}};/**
     * Select content between start and end position
     * @private
     */Selection.prototype.selectPosition=function(startPosition,endPosition){if(sf.base.isNullOrUndefined(startPosition)||sf.base.isNullOrUndefined(endPosition)){throw new Error('TextPosition cannot be undefined');}if(sf.base.isNullOrUndefined(startPosition.paragraph)||startPosition.offset>this.getParagraphLength(startPosition.paragraph)+1){throw new Error('Start TextPosition is not valid.');}if(sf.base.isNullOrUndefined(endPosition.paragraph)||endPosition.offset>this.getParagraphLength(endPosition.paragraph)+1){throw new Error('End TextPosition is not valid.');}if(startPosition.isAtSamePosition(endPosition)){// Select start position.
this.selectRange(startPosition,startPosition);}else{// If both text position exists within same comment or outside comment, and not at same position.
if(startPosition.isExistBefore(endPosition)){endPosition.validateForwardFieldSelection(startPosition.getHierarchicalIndexInternal(),endPosition.getHierarchicalIndexInternal());}else{startPosition.validateForwardFieldSelection(endPosition.getHierarchicalIndexInternal(),startPosition.getHierarchicalIndexInternal());}this.selectRange(startPosition,endPosition);}};/**
     * Notify selection change event
     * @private
     */Selection.prototype.fireSelectionChanged=function(isSelectionChanged){if(!this.isEmpty){if(this.isForward){this.start.updatePhysicalPosition(true);this.end.updatePhysicalPosition(false);}else{this.start.updatePhysicalPosition(false);this.end.updatePhysicalPosition(true);}}if(!this.skipFormatRetrieval){this.retrieveCurrentFormatProperties();}this.documentHelper.clearSelectionHighlight();this.hideToolTip();if(this.owner.isLayoutEnabled&&!this.owner.isShiftingEnabled){this.highlightSelection(true);}// if (this.documentHelper.restrictEditingPane.isShowRestrictPane && !this.skipEditRangeRetrieval) {
//     this.documentHelper.restrictEditingPane.updateUserInformation();
// }
if(isSelectionChanged){if(this.start.paragraph.isInHeaderFooter&&!this.owner.enableHeaderAndFooter){this.owner.enableHeaderAndFooter=true;}else if(!this.start.paragraph.isInHeaderFooter&&this.owner.enableHeaderAndFooter){this.owner.enableHeaderAndFooter=false;}this.owner.fireSelectionChange();}this.documentHelper.updateFocus();if(this.documentHelper.isInlineFormFillProtectedMode&&isSelectionChanged){this.triggerFormFillEvent();this.previousSelectedFormField=this.getCurrentFormField();}};//Formats Retrieval
/**
     * Retrieve all current selection format
     * @private
     */Selection.prototype.retrieveCurrentFormatProperties=function(){this.isRetrieveFormatting=true;var startPosition=this.start;var endPosition=this.end;if(!this.isForward){startPosition=this.end;endPosition=this.start;}this.retrieveImageFormat(startPosition,endPosition);this.retrieveCharacterFormat(startPosition,endPosition);this.retrieveParagraphFormat(startPosition,endPosition);this.retrieveSectionFormat(startPosition,endPosition);this.retrieveTableFormat(startPosition,endPosition);if(!this.isImageSelected){this.imageFormat.clearImageFormat();}this.isRetrieveFormatting=false;this.setCurrentContextType();};/**
     * @private
     */Selection.prototype.retrieveImageFormat=function(start,end){var image;if(start.currentWidget===end.currentWidget&&start.offset+1===end.offset){var elementInfo=end.currentWidget.getInline(end.offset,0);image=elementInfo.element;var index=elementInfo.index;if(image instanceof ImageElementBox){var startOffset=start.currentWidget.getOffset(image,0);if(startOffset!==start.offset){image=undefined;}}}if(image instanceof ImageElementBox){this.imageFormat.copyImageFormat(image);}else{this.imageFormat.clearImageFormat();}};/**
     * Returns the context type of previous character or element.
     * @param isElement - Decides whether to get previous context type from element or character. By default, character.
     */Selection.prototype.getPreviousContextType=function(isElement){var contextType;var start=this.start;if(start.offset>0){var element=start.currentWidget.getInline(start.offset,0).element;if(isElement){element=element.previousElement;}else{element=start.currentWidget.getInline(start.offset-1,0).element;}contextType=this.getContextElement(element);return contextType;}return undefined;};/**
     * Returns the context type of next character or element.
     * @param isElement - Decides whether to get next context type from element or character. By default, character.
     */Selection.prototype.getNextContextType=function(isElement){var contextType;var start=this.start;var element=start.currentWidget.getInline(start.offset,0).element;if(isElement&&element.nextElement){element=element.nextElement;}else{element=start.currentWidget.getInline(start.offset+1,0).element;}contextType=this.getContextElement(element);return contextType;};Selection.prototype.getContextElement=function(element){if(element instanceof TextElementBox){return'Text';}else if(element instanceof FieldElementBox||element instanceof FieldTextElementBox){return'Field';}else if(element instanceof BookmarkElementBox){return'Bookmark';}else if(element instanceof ImageElementBox){return'Image';}else if(element instanceof ShapeElementBox){return'Shape';}else if(element instanceof CommentElementBox||element instanceof CommentCharacterElementBox){return'Comment';}else if(element instanceof ListTextElementBox){return'List';}else if(element instanceof EditRangeStartElementBox||element instanceof EditRangeEndElementBox){return'EditRange';}else{return undefined;}};Selection.prototype.setCurrentContextType=function(){var contextIsinImage=this.imageFormat.image?true:false;var contextIsinTable=sf.base.isNullOrUndefined(this.tableFormat)||sf.base.isNullOrUndefined(this.tableFormat.table)?false:true;var style=this.start.paragraph.paragraphFormat.baseStyle;if(style instanceof WParagraphStyle&&style.name.toLowerCase().indexOf('toc')===0){var tocField=this.getTocFieldInternal();if(!sf.base.isNullOrUndefined(tocField)){this.contextTypeInternal='TableOfContents';return;}}var currentRevision=this.getCurrentRevision();if(currentRevision){this.owner.showRevisions=true;this.owner.dotNetRef.invokeMethodAsync('ShowRevisions',true);this.owner.trackChangesPane.currentSelectedRevision=currentRevision[0];}else if(!sf.base.isNullOrUndefined(this.owner.trackChangesPane.currentSelectedRevision)){this.owner.trackChangesPane.currentSelectedRevision=undefined;}if(this.start.paragraph.isInHeaderFooter){var isInHeader=this.start.paragraph.bodyWidget.headerFooterType.indexOf('Header')!==-1;if(contextIsinTable){if(contextIsinImage){this.contextTypeInternal=isInHeader?'HeaderTableImage':'FooterTableImage';}else{this.contextTypeInternal=isInHeader?'HeaderTableText':'FooterTableText';}}else{if(contextIsinImage){this.contextTypeInternal=isInHeader?'HeaderImage':'FooterImage';}else{this.contextTypeInternal=isInHeader?'HeaderText':'FooterText';}}}else{if(contextIsinTable){this.contextTypeInternal=contextIsinImage?'TableImage':'TableText';}else{this.contextTypeInternal=contextIsinImage?'Image':'Text';}}};Selection.prototype.addItemRevisions=function(currentItem,isFromAccept){for(var i=0;i<currentItem.revisions.length;i++){var currentRevision=currentItem.revisions[i];this.selectRevision(currentRevision);if(isFromAccept){currentRevision.accept();}else{currentRevision.reject();}}};/**
     * @private
     */Selection.prototype.hasRevisions=function(){if(this.getCurrentRevision()){return true;}return false;};Selection.prototype.getCurrentRevision=function(){var start=this.start;var end=this.end;if(!this.isForward){start=this.end;end=this.start;}var elementInfo=start.currentWidget.getInline(start.offset,0);var currentElement=elementInfo.element;var startPara=start.paragraph;var nextOffsetElement=start.currentWidget.getInline(start.offset+1,0).element;var eleEndPosition;if(currentElement&&currentElement===nextOffsetElement){var offset=currentElement.line.getOffset(currentElement,currentElement.length);eleEndPosition=new TextPosition(this.owner);eleEndPosition.setPositionParagraph(currentElement.line,offset);if(end.offset===eleEndPosition.offset&&!sf.base.isNullOrUndefined(currentElement.nextElement)){return undefined;}}if(!sf.base.isNullOrUndefined(currentElement)&&currentElement.revisions.length>0){return currentElement.revisions;}if(startPara.isInsideTable){var cellWidget=startPara.associatedCell;if(!sf.base.isNullOrUndefined(cellWidget.ownerRow)&&cellWidget.ownerRow.rowFormat.revisions.length>0){return cellWidget.ownerRow.rowFormat.revisions;}}if(end.offset>end.paragraph.getLength()){if(end.paragraph.characterFormat.revisions.length>0){return end.paragraph.characterFormat.revisions;}}return undefined;};Selection.prototype.processLineRevisions=function(linewidget,isFromAccept){for(var i=0;i<linewidget.children.length;i++){var element=linewidget.children[i];if(element.revisions.length>0){this.addItemRevisions(element,isFromAccept);}}};/**
     * @private
     * @param isFromAccept
     */Selection.prototype.handleAcceptReject=function(isFromAccept){if(this.isEmpty){var elementInfo=this.start.currentWidget.getInline(this.start.offset+1,0);var currentElement=elementInfo.element;var startPara=this.start.paragraph;if(!sf.base.isNullOrUndefined(currentElement)&&currentElement.revisions.length>0){this.addItemRevisions(currentElement,isFromAccept);}if(startPara.isInsideTable){var cellWidget=startPara.associatedCell;if(!sf.base.isNullOrUndefined(cellWidget)){if(cellWidget.ownerRow.rowFormat.revisions.length>0){this.addItemRevisions(cellWidget.ownerRow.rowFormat,isFromAccept);}}else if(!startPara.isEmpty()){for(var i=0;i<cellWidget.childWidgets.length;i++){var paraWidget=cellWidget.childWidgets[i];for(var lineIndex=void 0;lineIndex<paraWidget.childWidgets.length;lineIndex++){var linewidget=paraWidget.childWidgets[lineIndex];this.processLineRevisions(linewidget,isFromAccept);}}}}}else{var revisions=this.getselectedRevisionElements();for(var i=0;i<revisions.length;i++){this.acceptReject(revisions[i],isFromAccept);}}};Selection.prototype.acceptReject=function(currentRevision,toAccept){this.selectRevision(currentRevision);if(toAccept){currentRevision.accept();}else{currentRevision.reject();}};Selection.prototype.getselectedRevisionElements=function(){var revisionCollec=[];var start=this.start;var end=this.end;if(!this.isForward){start=this.end;end=this.start;}for(var i=0;i<this.selectedWidgets.length;i++){var currentWidget=this.selectedWidgets.keys[i];if(currentWidget instanceof LineWidget){revisionCollec=this.getSelectedLineRevisions(currentWidget,start,end,revisionCollec);}else if(currentWidget instanceof TableCellWidget){if(currentWidget.ownerRow.rowFormat.revisions.length>0){revisionCollec=this.addRevisionsCollec(currentWidget.ownerRow.rowFormat.revisions,revisionCollec);}for(var i_3=0;i_3<currentWidget.childWidgets.length;i_3++){var paraWidget=currentWidget.childWidgets[i_3];for(var lineIndex=0;lineIndex<paraWidget.childWidgets.length;lineIndex++){var linewidget=paraWidget.childWidgets[lineIndex];revisionCollec=this.getSelectedLineRevisions(linewidget,start,end,revisionCollec);}}}}return revisionCollec;};Selection.prototype.getSelectedLineRevisions=function(currentWidget,start,end,elements){if(currentWidget.paragraph.characterFormat.revisions.length>0){elements=this.addRevisionsCollec(currentWidget.paragraph.characterFormat.revisions,elements);}for(var j=0;j<currentWidget.children.length;j++){var currentElement=currentWidget.children[j];var offset=currentElement.line.getOffset(currentElement,0);var eleStartPosition=new TextPosition(this.owner);eleStartPosition.setPositionParagraph(currentElement.line,offset);offset=currentElement.line.getOffset(currentElement,currentElement.length);var eleEndPosition=new TextPosition(this.owner);eleEndPosition.setPositionParagraph(currentElement.line,offset);if((eleEndPosition.isExistAfter(start)&&eleEndPosition.isExistBefore(end)||eleStartPosition.isExistAfter(start)&&eleStartPosition.isExistBefore(end)||eleStartPosition.isAtSamePosition(start)||start.isExistAfter(eleStartPosition)&&end.isExistBefore(eleEndPosition))&&currentElement.revisions.length>0){elements=this.addRevisionsCollec(currentElement.revisions,elements);}}return elements;};Selection.prototype.addRevisionsCollec=function(element,revisCollec){for(var i=0;i<element.length;i++){if(revisCollec.indexOf(element[i])===-1){revisCollec.push(element[i]);}}return revisCollec;};//Table Format retrieval starts
/**
     * Retrieve selection table format
     * @private
     */Selection.prototype.retrieveTableFormat=function(start,end){var tableAdv=this.getTable(start,end);if(!sf.base.isNullOrUndefined(tableAdv)){this.tableFormat.copyFormat(tableAdv.tableFormat);this.tableFormat.table=tableAdv;this.retrieveCellFormat(start,end);this.retrieveRowFormat(start,end);}else{//When the selection is out of table
this.tableFormat.clearFormat();}};/**
     * Retrieve selection cell format
     * @private
     */Selection.prototype.retrieveCellFormat=function(start,end){if(start.paragraph.isInsideTable&&end.paragraph.isInsideTable){this.cellFormat.copyFormat(start.paragraph.associatedCell.cellFormat);this.getCellFormat(start.paragraph.associatedCell.ownerTable,start,end);}else{//When the selection is out of table
this.cellFormat.clearCellFormat();}};/**
     * Retrieve selection row format
     * @private
     */Selection.prototype.retrieveRowFormat=function(start,end){if(start.paragraph.isInsideTable&&end.paragraph.isInsideTable){this.rowFormat.copyFormat(start.paragraph.associatedCell.ownerRow.rowFormat);this.getRowFormat(start.paragraph.associatedCell.ownerTable,start,end);}else{//When the selection is out of table
this.rowFormat.clearRowFormat();}};/**
     * Get selected cell format
     * @private
     */Selection.prototype.getCellFormat=function(table,start,end){if(start.paragraph.associatedCell.equals(end.paragraph.associatedCell)){return;}var isStarted=false;for(var i=0;i<table.childWidgets.length;i++){var row=table.childWidgets[i];if(row===start.paragraph.associatedCell.ownerRow){isStarted=true;}if(isStarted){for(var j=0;j<row.childWidgets.length;j++){var cell=row.childWidgets[j];if(this.isCellSelected(cell,start,end)){this.cellFormat.combineFormat(cell.cellFormat);}if(cell===end.paragraph.associatedCell){this.cellFormat.combineFormat(cell.cellFormat);return;}}}}};/**
     * Get selected row format
     * @private
     */Selection.prototype.getRowFormat=function(table,start,end){var tableRow=start.paragraph.associatedCell.ownerRow;if(tableRow===end.paragraph.associatedCell.ownerRow){return;}for(var i=table.childWidgets.indexOf(tableRow)+1;i<table.childWidgets.length;i++){var tempTableRow=table.childWidgets[i];this.rowFormat.combineFormat(tempTableRow.rowFormat);if(tempTableRow===end.paragraph.associatedCell.ownerRow){return;}}};/**
     * Return table with given text position
     * @private
     */Selection.prototype.getTable=function(startPosition,endPosition){if(!sf.base.isNullOrUndefined(startPosition.paragraph.associatedCell)&&!sf.base.isNullOrUndefined(endPosition.paragraph.associatedCell)){var startTable=startPosition.paragraph.associatedCell.ownerTable;var endTable=startPosition.paragraph.associatedCell.ownerTable;if(startTable===endTable){return startTable;}else{if(startTable.contains(startPosition.paragraph.associatedCell)){return startTable;}else if(endTable.contains(startPosition.paragraph.associatedCell)){return endTable;}else if(!startTable.isInsideTable||!endTable.isInsideTable){return undefined;}else{do{startTable=startTable.associatedCell.ownerTable;if(startTable===endTable||startTable.contains(endTable.associatedCell)){return startTable;}else if(endTable.contains(startTable.associatedCell)){return endTable;}}while(!sf.base.isNullOrUndefined(startTable.associatedCell));}}}return undefined;};Selection.prototype.getContainerWidget=function(block){var bodyWidget;if(block.containerWidget instanceof TextFrame){bodyWidget=block.containerWidget.containerShape.line.paragraph.bodyWidget;}else if(block.containerWidget instanceof BlockContainer){bodyWidget=block.containerWidget;}else{bodyWidget=block.containerWidget;while(!(bodyWidget instanceof BlockContainer)){if(bodyWidget instanceof TextFrame){bodyWidget=bodyWidget.containerShape.line.paragraph;}bodyWidget=bodyWidget.containerWidget;}}return bodyWidget;};//Table format retrieval ends
//Section format retrieval starts
/**
     * Retrieve selection section format
     * @private
     */Selection.prototype.retrieveSectionFormat=function(start,end){var startParaSection=this.getContainerWidget(start.paragraph);var endParaSection=this.getContainerWidget(end.paragraph);if(!sf.base.isNullOrUndefined(startParaSection)){this.sectionFormat.copyFormat(startParaSection.sectionFormat);var startPageIndex=this.documentHelper.pages.indexOf(startParaSection.page);var endPageIndex=this.documentHelper.pages.indexOf(endParaSection.page);for(var i=startPageIndex+1;i<=endPageIndex;i++){this.sectionFormat.combineFormat(this.documentHelper.pages[i].bodyWidgets[0].sectionFormat);}}};//section format retrieval ends.
//Paragraph format retrieval implementation starts.
/**
     * Retrieve selection paragraph format
     * @private
     */Selection.prototype.retrieveParagraphFormat=function(start,end){this.getParagraphFormatForSelection(start.paragraph,this,start,end);};/**
     * @private
     */Selection.prototype.getParagraphFormatForSelection=function(paragraph,selection,start,end){//Selection start in cell.
if(start.paragraph.isInsideTable&&(!end.paragraph.isInsideTable||start.paragraph.associatedCell!==end.paragraph.associatedCell||this.isCellSelected(start.paragraph.associatedCell,start,end))){this.getParagraphFormatInternalInCell(start.paragraph.associatedCell,start,end);}else{this.getParagraphFormatInternalInParagraph(paragraph,start,end);}};/**
     * @private
     */Selection.prototype.getParagraphFormatInternalInParagraph=function(paragraph,start,end){if(start.paragraph===paragraph){this.paragraphFormat.copyFormat(paragraph.paragraphFormat);}else{this.paragraphFormat.combineFormat(paragraph.paragraphFormat);}if(end.paragraph===paragraph){return;}var block=this.getNextRenderedBlock(paragraph);if(!sf.base.isNullOrUndefined(block)){this.getParagraphFormatInternalInBlock(block,start,end);}};/**
     * @private
     */Selection.prototype.getParagraphFormatInternalInBlock=function(block,start,end){if(block instanceof ParagraphWidget){this.getParagraphFormatInternalInParagraph(block,start,end);}else{this.getParagraphFormatInternalInTable(block,start,end);}};/**
     * @private
     */Selection.prototype.getParagraphFormatInternalInTable=function(table,start,end){for(var i=0;i<table.childWidgets.length;i++){var tableRow=table.childWidgets[i];for(var j=0;j<tableRow.childWidgets.length;j++){this.getParagraphFormatInCell(tableRow.childWidgets[j]);}if(end.paragraph.isInsideTable&&this.containsRow(tableRow,end.paragraph.associatedCell)){return;}}var block=this.getNextRenderedBlock(table);//Goto the next block.
this.getParagraphFormatInternalInBlock(block,start,end);};/**
     * Get paragraph format in cell
     * @private
     */Selection.prototype.getParagraphFormatInCell=function(cell){for(var i=0;i<cell.childWidgets.length;i++){this.getParagraphFormatInBlock(cell.childWidgets[i]);}};/**
     * @private
     */Selection.prototype.getParagraphFormatInBlock=function(block){if(block instanceof ParagraphWidget){this.getParagraphFormatInParagraph(block);}else{this.getParagraphFormatInTable(block);}};/**
     * @private
     */Selection.prototype.getParagraphFormatInTable=function(tableAdv){for(var i=0;i<tableAdv.childWidgets.length;i++){var tableRow=tableAdv.childWidgets[i];for(var j=0;j<tableRow.childWidgets.length;j++){this.getParagraphFormatInCell(tableRow.childWidgets[j]);}}};/**
     * @private
     */Selection.prototype.getParagraphFormatInParagraph=function(paragraph){this.paragraphFormat.combineFormat(paragraph.paragraphFormat);};/**
     * Get paragraph format in cell
     * @private
     */Selection.prototype.getParagraphFormatInternalInCell=function(cellAdv,start,end){if(end.paragraph.isInsideTable){var containerCell=this.getContainerCellOf(cellAdv,end.paragraph.associatedCell);if(containerCell.ownerTable.contains(end.paragraph.associatedCell)){var startCell=this.getSelectedCell(cellAdv,containerCell);var endCell=this.getSelectedCell(end.paragraph.associatedCell,containerCell);if(this.containsCell(containerCell,end.paragraph.associatedCell)){//Selection end is in container cell.
if(this.isCellSelected(containerCell,start,end)){this.getParagraphFormatInCell(containerCell);}else{if(startCell===containerCell){this.getParagraphFormatInternalInParagraph(start.paragraph,start,end);}else{this.getParagraphFormatInRow(startCell.ownerRow,start,end);}}}else{//Format other selected cells in current table.
this.getParaFormatForCell(containerCell.ownerTable,containerCell,endCell);}}else{this.getParagraphFormatInRow(containerCell.ownerRow,start,end);}}else{var cell=this.getContainerCell(cellAdv);this.getParagraphFormatInRow(cell.ownerRow,start,end);}};/**
     * @private
     */Selection.prototype.getParaFormatForCell=function(table,startCell,endCell){var startCellIn=this.getCellLeft(startCell.ownerRow,startCell);var endCellIn=startCellIn+startCell.cellFormat.cellWidth;var endCellLeft=this.getCellLeft(endCell.ownerRow,endCell);var endCellRight=endCellLeft+endCell.cellFormat.cellWidth;if(startCellIn>endCellLeft){startCellIn=endCellLeft;}if(endCellIn<endCellRight){endCellIn=endCellRight;}if(startCellIn>this.upDownSelectionLength){startCellIn=this.upDownSelectionLength;}if(startCellIn<this.upDownSelectionLength){startCellIn=this.upDownSelectionLength;}var count=table.childWidgets.indexOf(endCell.ownerRow);for(var i=table.childWidgets.indexOf(startCell.ownerRow);i<=count;i++){var tableRow=table.childWidgets[i];for(var j=0;j<tableRow.childWidgets.length;j++){var cell=tableRow.childWidgets[j];var left=this.getCellLeft(tableRow,cell);if(HelperMethods.round(startCellIn,2)<=HelperMethods.round(left,2)&&HelperMethods.round(left,2)<HelperMethods.round(endCellIn,2)){this.getParagraphFormatInCell(cell);}}}};/**
     * Get paragraph format ins row
     * @private
     */Selection.prototype.getParagraphFormatInRow=function(tableRow,start,end){for(var i=tableRow.rowIndex;i<tableRow.ownerTable.childWidgets.length;i++){var row=tableRow.ownerTable.childWidgets[i];for(var j=0;j<row.childWidgets.length;j++){this.getParagraphFormatInCell(row.childWidgets[j]);}if(end.paragraph.isInsideTable&&this.containsRow(row,end.paragraph.associatedCell)){return;}}var block=this.getNextRenderedBlock(tableRow.ownerTable);//Goto the next block.
this.getParagraphFormatInternalInBlock(block,start,end);};// paragraph format retrieval implementation ends
// Character format retrieval implementation starts.
/**
     * Retrieve Selection character format
     * @private
     */Selection.prototype.retrieveCharacterFormat=function(start,end){this.characterFormat.copyFormat(start.paragraph.characterFormat);if(start.paragraph===end.paragraph&&start.currentWidget.isLastLine()&&start.offset===this.getLineLength(start.currentWidget)&&start.offset+1===end.offset){return;}var para=start.paragraph;if(start.paragraph===end.paragraph&&this.isSelectList){var listLevel=this.getListLevel(start.paragraph);// let breakCharacterFormat: WCharacterFormat = start.paragraph.characterFormat;
if(listLevel&&listLevel.characterFormat.uniqueCharacterFormat){this.characterFormat.copyFormat(listLevel.characterFormat);}return;}if(start.offset===this.getParagraphLength(para)&&!this.isEmpty){para=this.getNextParagraphBlock(para);}while(!sf.base.isNullOrUndefined(para)&&para!==end.paragraph&&para.isEmpty()){para=this.getNextParagraphBlock(para);}var offset=para===start.paragraph?start.offset:0;var indexInInline=0;if(!sf.base.isNullOrUndefined(para)&&!para.isEmpty()){var position=new TextPosition(this.owner);var elemInfo=start.currentWidget.getInline(offset,indexInInline);var physicalLocation=this.getPhysicalPositionInternal(start.currentWidget,offset,true);position.setPositionForSelection(start.currentWidget,elemInfo.element,elemInfo.index,physicalLocation);this.getCharacterFormatForSelection(para,this,position,end);}};/**
     * @private
     */Selection.prototype.getCharacterFormatForSelection=function(paragraph,selection,startPosition,endPosition){//Selection start in cell.
if(startPosition.paragraph instanceof ParagraphWidget&&startPosition.paragraph.isInsideTable&&(!endPosition.paragraph.isInsideTable||startPosition.paragraph.associatedCell!==endPosition.paragraph.associatedCell||this.isCellSelected(startPosition.paragraph.associatedCell,startPosition,endPosition))){this.getCharacterFormatInTableCell(startPosition.paragraph.associatedCell,selection,startPosition,endPosition);}else{this.getCharacterFormat(paragraph,startPosition,endPosition);}};/**
     * Get Character format
     * @private
     */ //Format Retrieval
Selection.prototype.getCharacterFormatForTableRow=function(tableRowAdv,start,end){for(var i=tableRowAdv.rowIndex;i<tableRowAdv.ownerTable.childWidgets.length;i++){var tableRow=tableRowAdv.ownerTable.childWidgets[i];for(var j=0;j<tableRow.childWidgets.length;j++){this.getCharacterFormatForSelectionCell(tableRow.childWidgets[j],start,end);}if(end.paragraph.isInsideTable&&this.containsRow(tableRow,end.paragraph.associatedCell)){return;}}var block=this.getNextRenderedBlock(tableRowAdv.ownerTable);// //Goto the next block.
this.getCharacterFormatForBlock(block,start,end);};/**
     * Get Character format in table
     * @private
     */Selection.prototype.getCharacterFormatInTableCell=function(tableCell,selection,start,end){if(end.paragraph.isInsideTable){var containerCell=this.getContainerCellOf(tableCell,end.paragraph.associatedCell);if(containerCell.ownerTable.contains(end.paragraph.associatedCell)){var startCell=this.getSelectedCell(tableCell,containerCell);var endCell=this.getSelectedCell(end.paragraph.associatedCell,containerCell);if(this.containsCell(containerCell,end.paragraph.associatedCell)){//Selection end is in container cell.
if(this.isCellSelected(containerCell,start,end)){this.getCharacterFormatForSelectionCell(containerCell,start,end);}else{if(startCell===containerCell){this.getCharacterFormat(start.paragraph,start,end);}else{this.getCharacterFormatForTableRow(startCell.ownerRow,start,end);}}}else{//Format other selected cells in current table.
this.getCharacterFormatInternalInTable(containerCell.ownerTable,containerCell,endCell,start,end);}}else{this.getCharacterFormatForTableRow(containerCell.ownerRow,start,end);}}else{var cell=this.getContainerCell(tableCell);this.getCharacterFormatForTableRow(cell.ownerRow,start,end);}};/**
     * @private
     */Selection.prototype.getCharacterFormatInternalInTable=function(table,startCell,endCell,startPosition,endPosition){var startIn=this.getCellLeft(startCell.ownerRow,startCell);var endIn=startIn+startCell.cellFormat.cellWidth;var endCellLeft=this.getCellLeft(endCell.ownerRow,endCell);var endCellRight=endCellLeft+endCell.cellFormat.cellWidth;if(startIn>endCellLeft){startIn=endCellLeft;}if(endIn<endCellRight){endIn=endCellRight;}if(startIn>this.upDownSelectionLength){startIn=this.upDownSelectionLength;}if(endIn<this.upDownSelectionLength){endIn=this.upDownSelectionLength;}var count=table.childWidgets.indexOf(endCell.ownerRow);for(var i=table.childWidgets.indexOf(startCell.ownerRow);i<=count;i++){var row=table.childWidgets[i];for(var j=0;j<row.childWidgets.length;j++){var cell=row.childWidgets[j];var left=this.getCellLeft(row,cell);if(HelperMethods.round(startIn,2)<=HelperMethods.round(left,2)&&HelperMethods.round(left,2)<HelperMethods.round(endIn,2)){this.getCharacterFormatForSelectionCell(cell,startPosition,endPosition);}}}};/**
     * Get character format with in selection
     * @private
     */Selection.prototype.getCharacterFormat=function(paragraph,start,end){if(paragraph!==start.paragraph&&paragraph!==end.paragraph&&!paragraph.isEmpty()){this.getCharacterFormatInternal(paragraph,this);return;}if(end.paragraph===paragraph&&start.paragraph!==paragraph&&end.offset===0){return;}var startOffset=0;var length=this.getParagraphLength(paragraph);if(paragraph===start.paragraph){startOffset=start.offset;//Sets selection character format.            
var isUpdated=this.setCharacterFormat(paragraph,start,end,length);if(isUpdated){return;}}var startLineWidget=paragraph.childWidgets.indexOf(start.currentWidget)!==-1?paragraph.childWidgets.indexOf(start.currentWidget):0;var endLineWidget=paragraph.childWidgets.indexOf(end.currentWidget)!==-1?paragraph.childWidgets.indexOf(end.currentWidget):paragraph.childWidgets.length-1;var endOffset=end.offset;if(paragraph!==end.paragraph){endOffset=length;}var isFieldStartSelected=false;for(var i=startLineWidget;i<=endLineWidget;i++){var lineWidget=paragraph.childWidgets[i];if(i!==startLineWidget){startOffset=this.getStartLineOffset(lineWidget);}if(lineWidget===end.currentWidget){endOffset=end.offset;}else{endOffset=this.getLineLength(lineWidget);}var count=0;for(var j=0;j<lineWidget.children.length;j++){var inline=lineWidget.children[j];if(inline instanceof ListTextElementBox){continue;}if(startOffset>=count+inline.length){count+=inline.length;continue;}if(inline instanceof FieldElementBox&&inline.fieldType===0&&HelperMethods.isLinkedFieldCharacter(inline)){var nextInline=sf.base.isNullOrUndefined(inline.fieldSeparator)?inline.fieldEnd:inline.fieldSeparator;do{count+=inline.length;inline=inline.nextNode;i++;}while(!sf.base.isNullOrUndefined(inline)&&inline!==nextInline);isFieldStartSelected=true;}if(inline instanceof FieldElementBox&&inline.fieldType===1&&HelperMethods.isLinkedFieldCharacter(inline)&&isFieldStartSelected){var fieldInline=inline.fieldBegin;do{this.characterFormat.combineFormat(fieldInline.characterFormat);fieldInline=fieldInline.nextNode;}while(!(fieldInline instanceof FieldElementBox));}if(inline instanceof TextElementBox){this.characterFormat.combineFormat(inline.characterFormat);}if(sf.base.isNullOrUndefined(inline)||endOffset<=count+inline.length){break;}count+=inline.length;}}if(end.paragraph===paragraph){return;}var block=this.getNextRenderedBlock(paragraph);if(!sf.base.isNullOrUndefined(block)){this.getCharacterFormatForBlock(block,start,end);}};Selection.prototype.setCharacterFormat=function(para,startPos,endPos,length){var index=0;var startOffset=startPos.offset;var inlineAndIndex=startPos.currentWidget.getInline(startOffset,index);index=inlineAndIndex.index;var inline=inlineAndIndex.element;if(sf.base.isNullOrUndefined(inline)){var currentLineIndex=startPos.paragraph.childWidgets.indexOf(startPos.currentWidget);if(startPos.currentWidget.previousLine){inline=startPos.currentWidget.previousLine.children[startPos.currentWidget.previousLine.children.length-1];this.characterFormat.copyFormat(inline.characterFormat);return true;}}if(startOffset<length){if(this.isEmpty){if(inline instanceof TextElementBox||inline instanceof FieldElementBox&&(inline.fieldType===0||inline.fieldType===1)){var previousNode=this.getPreviousTextElement(inline);if(startOffset===0&&previousNode){inline=previousNode;}this.characterFormat.copyFormat(inline.characterFormat);}else{if(!sf.base.isNullOrUndefined(this.getPreviousTextElement(inline))){this.characterFormat.copyFormat(this.getPreviousTextElement(inline).characterFormat);}else if(!sf.base.isNullOrUndefined(this.getNextTextElement(inline))){this.characterFormat.copyFormat(this.getNextTextElement(inline).characterFormat);}else{this.characterFormat.copyFormat(para.characterFormat);}}return true;}else{if(index===inline.length&&!sf.base.isNullOrUndefined(inline.nextNode)){this.characterFormat.copyFormat(this.getNextValidCharacterFormat(inline));}else if(inline instanceof TextElementBox){this.characterFormat.copyFormat(inline.characterFormat);}else if(inline instanceof FieldElementBox){this.characterFormat.copyFormat(this.getNextValidCharacterFormatOfField(inline));}}}else{if(length===endPos.offset){if(inline instanceof TextElementBox||inline instanceof FieldElementBox){this.characterFormat.copyFormat(inline.characterFormat);}else if(!sf.base.isNullOrUndefined(inline)){inline=this.getPreviousTextElement(inline);if(!sf.base.isNullOrUndefined(inline)){this.characterFormat.copyFormat(inline.characterFormat);}}else{this.characterFormat.copyFormat(para.characterFormat);}return true;}}return false;};/**
     * @private
     */Selection.prototype.getCharacterFormatForBlock=function(block,start,end){if(block instanceof ParagraphWidget){this.getCharacterFormat(block,start,end);}else{this.getCharacterFormatInTable(block,start,end);}};/**
     * @private
     */Selection.prototype.getCharacterFormatInTable=function(table,start,end){for(var i=0;i<table.childWidgets.length;i++){var row=table.childWidgets[i];for(var j=0;j<row.childWidgets.length;j++){this.getCharacterFormatForSelectionCell(row.childWidgets[j],start,end);}if(end.paragraph.isInsideTable&&this.containsRow(row,end.paragraph.associatedCell)){return;}}var blockAdv=this.getNextRenderedBlock(table);// //Goto the next block.
this.getCharacterFormatForBlock(blockAdv,start,end);};/**
     * Get character format in selection
     * @private
     */Selection.prototype.getCharacterFormatForSelectionCell=function(cell,start,end){for(var i=0;i<cell.childWidgets.length;i++){this.getCharacterFormatForBlock(cell.childWidgets[i],start,end);}};/**
     * @private
     */Selection.prototype.getCharacterFormatInternal=function(paragraph,selection){for(var i=0;i<paragraph.childWidgets.length;i++){var linewidget=paragraph.childWidgets[i];for(var j=0;j<linewidget.children.length;j++){var element=linewidget.children[j];if(!(element instanceof ImageElementBox||element instanceof FieldElementBox)){selection.characterFormat.combineFormat(element.characterFormat);}}}};/**
     * Get next valid character format from inline
     * @private
     */Selection.prototype.getNextValidCharacterFormat=function(inline){var startInline=this.getNextTextElement(inline);if(sf.base.isNullOrUndefined(startInline)){return inline.characterFormat;}var fieldBegin=undefined;if(startInline instanceof FieldElementBox){if(fieldBegin.fieldType===0){fieldBegin=startInline;}}if(sf.base.isNullOrUndefined(fieldBegin)){return startInline.characterFormat;}else{return this.getNextValidCharacterFormatOfField(fieldBegin);}};/**
     * Get next valid paragraph format from field
     * @private
     */Selection.prototype.getNextValidCharacterFormatOfField=function(fieldBegin){var startInline=fieldBegin;if(HelperMethods.isLinkedFieldCharacter(fieldBegin)){if(sf.base.isNullOrUndefined(fieldBegin.fieldSeparator)){startInline=fieldBegin.fieldEnd;}else{startInline=fieldBegin.fieldSeparator;}}var nextValidInline=undefined;if(!sf.base.isNullOrUndefined(startInline.nextNode)){//Check the next node is a valid and returns inline.
nextValidInline=this.getNextValidElement(startInline.nextNode);}//If field separator/end exists at end of paragraph, then move to next paragraph.
if(sf.base.isNullOrUndefined(nextValidInline)){return startInline.characterFormat;}return nextValidInline.characterFormat;};/**
     * Return true if cursor point with in selection range
     * @private
     */Selection.prototype.checkCursorIsInSelection=function(widget,point){if(sf.base.isNullOrUndefined(this.start)||this.isEmpty||sf.base.isNullOrUndefined(widget)){return false;}var isSelected=false;do{if(this.selectedWidgets.containsKey(widget)){var top_4=void 0;var left=void 0;if(widget instanceof LineWidget){top_4=this.owner.selection.getTop(widget);left=this.owner.selection.getLeft(widget);}else{top_4=widget.y;left=widget.x;}var widgetInfo=this.selectedWidgets.get(widget);isSelected=widgetInfo.left<=point.x&&top_4<=point.y&&top_4+widget.height>=point.y&&widgetInfo.left+widgetInfo.width>=point.x;}widget=widget instanceof LineWidget?widget.paragraph:widget.containerWidget;}while(!sf.base.isNullOrUndefined(widget)&&!isSelected);return isSelected;};/**
     * Copy paragraph for to selection paragraph format
     * @private
     */Selection.prototype.copySelectionParagraphFormat=function(){var format=new WParagraphFormat();this.paragraphFormat.copyToFormat(format);return format;};/**
     * Get hyperlink display text
     * @private
     */Selection.prototype.getHyperlinkDisplayText=function(paragraph,fieldSeparator,fieldEnd,isNestedField,format){var para=paragraph;if(para!==fieldEnd.line.paragraph){isNestedField=true;return{displayText:'<<Selection in Document>>','isNestedField':isNestedField,'format':format};}var displayText='';var lineIndex=para.childWidgets.indexOf(fieldSeparator.line);var index=para.childWidgets[lineIndex].children.indexOf(fieldSeparator);for(var j=lineIndex;j<para.childWidgets.length;j++){var lineWidget=para.childWidgets[j];if(j!==lineIndex){index=-1;}for(var i=index+1;i<lineWidget.children.length;i++){var inline=lineWidget.children[i];if(inline===fieldEnd){return{'displayText':displayText,'isNestedField':isNestedField,'format':format};}if(inline instanceof TextElementBox){displayText+=inline.text;format=inline.characterFormat;}else if(inline instanceof FieldElementBox){if(inline instanceof FieldElementBox&&inline.fieldType===0&&!sf.base.isNullOrUndefined(inline.fieldEnd)){if(sf.base.isNullOrUndefined(inline.fieldSeparator)){index=lineWidget.children.indexOf(inline.fieldEnd);}else{index=lineWidget.children.indexOf(inline.fieldSeparator);}}}else{isNestedField=true;return{'displayText':'<<Selection in Document>>','isNestedField':isNestedField,'format':format};}}}return{'displayText':displayText,'isNestedField':isNestedField,'format':format};};/**
     * Navigates hyperlink on mouse Event.
     * @private
     */Selection.prototype.navigateHyperLinkOnEvent=function(cursorPoint,isTouchInput){var _this=this;var widget=this.documentHelper.getLineWidget(cursorPoint);if(!sf.base.isNullOrUndefined(widget)){var hyperLinkField=this.getHyperLinkFieldInCurrentSelection(widget,cursorPoint);//Invokes Hyperlink navigation events.
if(!sf.base.isNullOrUndefined(hyperLinkField)){this.documentHelper.updateTextPositionForSelection(cursorPoint,1);this.fireRequestNavigate(hyperLinkField);setTimeout(function(){if(_this.viewer){_this.documentHelper.isTouchInput=isTouchInput;_this.documentHelper.updateFocus();_this.documentHelper.isTouchInput=false;}});}}};/**
     * @private
     */Selection.prototype.getLinkText=function(fieldBegin){var hyperlink=new Hyperlink(fieldBegin,this);var link=hyperlink.navigationLink;if(hyperlink.localReference.length>0){if(hyperlink.localReference[0]==='_'&&(sf.base.isNullOrUndefined(link)||link.length===0)){link='Current Document';}else{if(hyperlink.isCrossRef){link+=hyperlink.localReference;}else{link+='#'+hyperlink.localReference;}}}hyperlink.destroy();return link;};/**
     * Set Hyperlink content to tool tip element
     * @private
     */Selection.prototype.setHyperlinkContentToToolTip=function(fieldBegin,widget,xPos,isFormField){if(fieldBegin){// if (this.owner.contextMenuModule &&
//     this.owner.contextMenuModule.contextMenuInstance.element.style.display === 'block') {
//     return;
// }
if(!this.toolTipElement){this.toolTipElement=sf.base.createElement('div',{className:'e-de-tooltip e-lib e-popup e-control'});this.documentHelper.viewerContainer.appendChild(this.toolTipElement);}this.toolTipElement.style.display='block';var toolTipText=this.owner.defaultLocale["Click to follow link"]?this.owner.defaultLocale["Click to follow link"]:'Click to follow link';if(this.owner.useCtrlClickToFollowHyperlink){toolTipText='Ctrl+'+toolTipText;}var linkText=this.getLinkText(fieldBegin);if(isFormField){var helpText=fieldBegin.formFieldData.helpText;if(sf.base.isNullOrUndefined(helpText)||helpText===''){return;}this.toolTipElement.innerHTML=helpText;}else{this.toolTipElement.innerHTML=linkText+'</br><b>'+toolTipText+'</b>';}var position=this.getTooltipPosition(fieldBegin.line,xPos,this.toolTipElement.clientWidth,this.toolTipElement.offsetHeight,false);this.showToolTip(position.x,position.y);if(sf.base.isNullOrUndefined(this.toolTipField)||!sf.base.isNullOrUndefined(this.toolTipField)&&fieldBegin!==this.toolTipField){this.toolTipElement.style.left=position.x+"px";this.toolTipElement.style.top=position.y+"px";this.toolTipElement.style.zIndex="2000";}this.toolTipElement.style.position="absolute";this.toolTipElement.style.display='block';this.toolTipField=fieldBegin;}else{this.hideToolTip();}};/**
     * Set Hyperlink content to tool tip element
     * @private
     */Selection.prototype.setFootnoteContentToToolTip=function(footnote,widget,xPos){if(footnote){// if (this.owner.contextMenuModule.contextMenuInstance.element.style.display === 'block' &&
//     this.owner.contextMenuModule) {
//     return;
// }
if(!this.toolTipElement){this.toolTipElement=sf.base.createElement('div',{className:'e-de-tooltip'});this.documentHelper.viewerContainer.appendChild(this.toolTipElement);}this.toolTipElement.style.display='block';// let ln: L10n = new L10n('documenteditor', this.owner.defaultLocale);
// ln.setLocale(this.owner.locale);
var toolTipText=void 0;if(footnote.footnoteType==='Endnote'){toolTipText='Click to View/Edit Endnote';}else if(footnote.footnoteType==='Footnote'){toolTipText='Click to View/Edit Footnote';}this.toolTipElement.innerHTML='<b>'+toolTipText+'</b>';var positions=this.getTooltipPosition(footnote.line,xPos,this.toolTipElement.clientWidth,this.toolTipElement.offsetHeight,false);this.showToolTip(positions.x,positions.y);if(!sf.base.isNullOrUndefined(this.toolTipField)){this.toolTipElement.style.left=positions.x+"px";this.toolTipElement.style.top=positions.y+"px";this.toolTipElement.style.zIndex="2000";//this.toolTipObject.position = { X: positions.x, Y: positions.y };
}this.toolTipElement.style.position="absolute";this.toolTipElement.style.display='block';// this.toolTipField = fieldBegin;
}else{this.hideToolTip();}};/**
     * Set locked content info to tool tip element
     * @private
     */Selection.prototype.setLockInfoTooptip=function(widget,xPos,user){// if (widget) {
//     if (this.owner.contextMenuModule &&
//         this.owner.contextMenuModule.contextMenuInstance.element.style.display === 'block') {
//         return;
//     }
//     let toolTipElement: HTMLElement = this.toolTipElement;
//     if (!this.toolTipElement) {
//         toolTipElement = createElement('div', { className: 'e-de-tooltip' });
//         this.documentHelper.viewerContainer.appendChild(toolTipElement);
//         this.toolTipElement = toolTipElement;
//     }
//     toolTipElement.style.display = 'block';
//     let l10n: L10n = new L10n('documenteditor', this.owner.defaultLocale);
//     l10n.setLocale(this.owner.locale);
//     let toolTipInfo: string = l10n.getConstant('This region is locked by');
//     toolTipElement.innerHTML = toolTipInfo + ' <b>' + user + '</b>';
//     let position: Point = this.getTooltipPosition(widget, xPos, toolTipElement, false);
//     this.showToolTip(position.x, position.y);
//     if (!isNullOrUndefined(this.toolTipField) && user !== this.toolTipField) {
//         this.toolTipObject.position = { X: position.x, Y: position.y };
//     }
//     this.toolTipObject.show();
//     this.toolTipField = user;
// } else {
//     this.hideToolTip();
// }
};/**
     * @private
     */Selection.prototype.getTooltipPosition=function(widget,xPos,clientWidth,clientHeight,isFormField){var widgetTop=this.getTop(widget)*this.documentHelper.zoomFactor;var page=this.getPage(widget.paragraph);// tslint:disable-next-line:max-line-length
var containerWidth=this.documentHelper.viewerContainer.getBoundingClientRect().width+this.documentHelper.viewerContainer.scrollLeft;var left=page.boundingRectangle.x+xPos*this.documentHelper.zoomFactor;if(left+clientWidth+10>containerWidth){left=left-(clientWidth-(containerWidth-left)+15);}var offsetHeight=!isFormField?clientHeight:0;var top=this.getPageTop(page)+(widgetTop-offsetHeight);top=top>this.documentHelper.viewerContainer.scrollTop?top:top+widget.height+offsetHeight;return new Point(left,top);};/**
     * @private
     */Selection.prototype.createPasteElement=function(top,left){// let locale: L10n = new L10n('documenteditor', this.owner.defaultLocale);
// locale.setLocale(this.owner.locale);
// let items: ItemModel[] = [
//     {
//         text: locale.getConstant('Keep source formatting'),
//         iconCss: 'e-icons e-de-paste-source'
//     },
//     {
//         text: locale.getConstant('Match destination formatting'),
//         iconCss: 'e-icons e-de-paste-merge'
//     },
//     {
//         text: locale.getConstant('Text only'),
//         iconCss: 'e-icons e-de-paste-text'
//     }
// ];
if(!this.pasteElement){var htmlElement=this.documentHelper.viewerContainer.getElementsByClassName('e-de-paste')[0];this.pasteElement=htmlElement.parentElement.parentElement;}this.pasteElement.style.display='block';this.pasteElement.style.position='absolute';this.pasteElement.style.left=left;this.pasteElement.style.top=top;this.pasteElement.style.zIndex='2000';};/**
     * Show hyperlink tooltip
     * @private
     */Selection.prototype.showToolTip=function(x,y){// if (!this.toolTipObject) {
//     this.toolTipObject = new Popup(this.toolTipElement, {
//         height: 'auto',
//         width: 'auto',
//         relateTo: this.documentHelper.viewerContainer.parentElement,
//         position: { X: x, Y: y }
//     });
// }
};/**
     * Hide tooltip object
     * @private
     */Selection.prototype.hideToolTip=function(){this.toolTipField=undefined;if(this.toolTipElement){this.toolTipElement.style.display='none';}// if (this.toolTipObject) {
//     this.toolTipElement.style.display = 'none';
//     this.toolTipObject.hide();
//     this.toolTipObject.destroy();
//     this.toolTipObject = undefined;
// }
};/**
     * Return hyperlink field
     * @private
     */Selection.prototype.getHyperLinkFieldInCurrentSelection=function(widget,cursorPosition,isFormField){var inline=undefined;var top=this.getTop(widget);var lineStartLeft=this.getLineStartLeft(widget);if(cursorPosition.y<top||cursorPosition.y>top+widget.height||cursorPosition.x<lineStartLeft||cursorPosition.x>lineStartLeft+widget.paragraph.width){return undefined;}var left=widget.paragraph.x;var elementValues=this.getFirstElement(widget,left);left=elementValues.left;var element=elementValues.element;if(sf.base.isNullOrUndefined(element)){var width=this.documentHelper.textHelper.getParagraphMarkWidth(widget.paragraph.characterFormat);if(cursorPosition.x<=lineStartLeft+width||cursorPosition.x>=lineStartLeft+width){//Check if paragraph is within a field result.
var checkedFields=[];var field=this.getHyperLinkFields(widget.paragraph,checkedFields,false,isFormField);checkedFields=[];checkedFields=undefined;return field;}}else{if(cursorPosition.x>left+element.margin.left){for(var i=widget.children.indexOf(element);i<widget.children.length;i++){element=widget.children[i];if(cursorPosition.x<left+element.margin.left+element.width||i===widget.children.length-1){break;}left+=element.margin.left+element.width;}}inline=element;var width=element.margin.left+element.width;if(sf.base.isNullOrUndefined(inline.nextNode)){//Include width of Paragraph mark.
width+=this.documentHelper.textHelper.getParagraphMarkWidth(inline.line.paragraph.characterFormat);}if(cursorPosition.x<=left+width){//Check if inline is within a field result.
var checkedFields=[];var field=this.getHyperLinkFieldInternal(inline.line.paragraph,inline,checkedFields,false,isFormField);checkedFields=[];checkedFields=undefined;return field;}}return undefined;};/**
     * Return FootnoteElementBox
     * @private
     */Selection.prototype.getFootNoteElementInCurrentSelection=function(lineWidget,position){var inline=undefined;var top=this.getTop(lineWidget);var lineStartInLeft=this.getLineStartLeft(lineWidget);if(position.y<top||position.y>top+lineWidget.height||position.x<lineStartInLeft||position.x>lineStartInLeft+lineWidget.paragraph.width){return undefined;}var leftLength=lineWidget.paragraph.x;var elementValues=this.getFirstElement(lineWidget,leftLength);leftLength=elementValues.left;var element=elementValues.element;if(sf.base.isNullOrUndefined(element)){var width=this.documentHelper.textHelper.getParagraphMarkWidth(lineWidget.paragraph.characterFormat);if(position.x<=lineStartInLeft+width||position.x>=lineStartInLeft+width){//Check if paragraph is within a field result.
var inlineObj=this.documentHelper.selection.start.currentWidget.getInline(this.documentHelper.selection.start.offset,0);var footNote=inlineObj.element;if(footNote instanceof FootnoteElementBox){return footNote;}else{return undefined;}}}else{if(position.x>leftLength+element.margin.left){for(var i=lineWidget.children.indexOf(element);i<lineWidget.children.length;i++){element=lineWidget.children[i];if(position.x<leftLength+element.margin.left+element.width||i===lineWidget.children.length-1){break;}leftLength+=element.margin.left+element.width;}}if(element instanceof FootnoteElementBox){inline=element;}var width=element.margin.left+element.width;if(sf.base.isNullOrUndefined(element.nextNode)){//Include width of Paragraph mark.
width+=this.documentHelper.textHelper.getParagraphMarkWidth(element.line.paragraph.characterFormat);}if(position.x<=leftLength+width){return inline;}}return undefined;};/**
     * Return field if paragraph contain hyperlink field
     * @private
     */Selection.prototype.getHyperlinkField=function(isRetrieve){if(sf.base.isNullOrUndefined(this.end)){return undefined;}var index=0;var selection=this.documentHelper.selection;var start=selection.start;var end=selection.end;if(!selection.isForward){start=selection.end;end=selection.start;}var currentInline=this.end.currentWidget.getInline(end.offset,index);index=currentInline.index;var inline=currentInline.element;var checkedFields=[];var field=undefined;if(sf.base.isNullOrUndefined(inline)){field=this.getHyperLinkFields(this.end.paragraph,checkedFields,isRetrieve);}else if(this.documentHelper.isFormFillProtectedMode&&inline instanceof BookmarkElementBox&&inline.previousNode instanceof FieldElementBox&&inline.previousNode.fieldType===1){field=undefined;}else{var paragraph=inline.line.paragraph;field=this.getHyperLinkFieldInternal(paragraph,inline,checkedFields,isRetrieve,false);}checkedFields=[];return field;};/**
     * @private
     */Selection.prototype.getHyperLinkFields=function(paragraph,checkedFields,isRetrieve,checkFormField){for(var i=0;i<this.documentHelper.fields.length;i++){if(checkedFields.indexOf(this.documentHelper.fields[i])!==-1||sf.base.isNullOrUndefined(this.documentHelper.fields[i].fieldSeparator)){continue;}else{checkedFields.push(this.documentHelper.fields[i]);}var field=this.getFieldCode(this.documentHelper.fields[i]);field=field.trim().toLowerCase();var isParagraph=this.paragraphIsInFieldResult(this.documentHelper.fields[i],paragraph);if((isRetrieve||!isRetrieve&&field.match('hyperlink '))&&isParagraph){return this.documentHelper.fields[i];}if(isParagraph&&checkFormField&&this.documentHelper.fields[i].formFieldData){return this.documentHelper.fields[i];}if((isRetrieve||!isRetrieve&&field.match('ref '))&&isParagraph){return this.documentHelper.fields[i];}}// if (paragraph.containerWidget instanceof BodyWidget && !(paragraph instanceof WHeaderFooter)) {
//     return this.getHyperLinkFields((paragraph.con as WCompositeNode), checkedFields);
// }
return undefined;};/**
     * @private
     */Selection.prototype.getHyperLinkFieldInternal=function(paragraph,inline,fields,isRetrieve,checkFormField){for(var i=0;i<this.documentHelper.fields.length;i++){if(fields.indexOf(this.documentHelper.fields[i])!==-1||sf.base.isNullOrUndefined(this.documentHelper.fields[i].fieldSeparator)){continue;}else{fields.push(this.documentHelper.fields[i]);}var fieldCode=this.getFieldCode(this.documentHelper.fields[i]);fieldCode=fieldCode.trim().toLowerCase();var fieldBegin=this.documentHelper.fields[i];var fieldEnd=fieldBegin.fieldEnd;if(isRetrieve&&fieldBegin.nextNode instanceof BookmarkElementBox){fieldEnd=fieldBegin.nextNode.reference;}var isInline=this.inlineIsInFieldResult(fieldBegin,fieldEnd,fieldBegin.fieldSeparator,inline,isRetrieve)||this.isImageField();if((isRetrieve||!isRetrieve&&fieldCode.match('hyperlink '))&&isInline){return this.documentHelper.fields[i];}if(isInline&&checkFormField&&this.documentHelper.fields[i].formFieldData){return this.documentHelper.fields[i];}if((isRetrieve||!isRetrieve&&fieldCode.match('ref '))&&isInline){return this.documentHelper.fields[i];}}if(paragraph.containerWidget instanceof BodyWidget&&!(paragraph instanceof HeaderFooterWidget)){return this.getHyperLinkFieldInternal(paragraph.containerWidget,inline,fields,isRetrieve,checkFormField);}return undefined;};/**
     * @private
     */Selection.prototype.getBlock=function(currentIndex){if(currentIndex===''||sf.base.isNullOrUndefined(currentIndex)){return undefined;}var index={index:currentIndex};var page=this.start.getPage(index);var bodyIndex=index.index.indexOf(';');var value=index.index.substring(0,bodyIndex);index.index=index.index.substring(bodyIndex).replace(';','');var bodyWidget=page.bodyWidgets[parseInt(value,10)];return this.getBlockInternal(bodyWidget,index.index);};/**
     * Return Block relative to position
     * @private
     */Selection.prototype.getBlockInternal=function(widget,position){if(position===''||sf.base.isNullOrUndefined(position)){return undefined;}var index=position.indexOf(';');var value=position.substring(0,index);position=position.substring(index).replace(';','');var node=widget;// if (node instanceof Widget && value === 'HF') {
//     //Gets the block in Header footers.
//     let blockObj: BlockInfo = this.getBlock((node as WSection).headersFooters, position);
//     return { 'node': (!isNullOrUndefined(blockObj)) ? blockObj.node : undefined, 'position': (!isNullOrUndefined(blockObj)) ? blockObj.position : undefined };
// }
index=parseInt(value,10);if(index>=0&&index<widget.childWidgets.length){var child=widget.childWidgets[index];if(position.indexOf(';')>=0){if(child instanceof ParagraphWidget){if(position.indexOf(';')>=0){position='0';}return child;}if(child instanceof BlockWidget){var blockObj=this.getBlockInternal(child,position);return blockObj;}}else{return child;}}else{return node;}return node;};/**
     * Return true if inline is in field result
     * @private
     */Selection.prototype.inlineIsInFieldResult=function(fieldBegin,fieldEnd,fieldSeparator,inline,isRetrieve){if(!sf.base.isNullOrUndefined(fieldEnd)&&!sf.base.isNullOrUndefined(fieldSeparator)){if(this.isExistBeforeInline(fieldSeparator,inline)){return this.isExistAfterInline(fieldEnd,inline,isRetrieve);}}return false;};/**
     * Retrieve true if paragraph is in field result
     * @private
     */Selection.prototype.paragraphIsInFieldResult=function(fieldBegin,paragraph){if(!sf.base.isNullOrUndefined(fieldBegin.fieldEnd)&&!sf.base.isNullOrUndefined(fieldBegin.fieldSeparator)){var fieldParagraph=fieldBegin.fieldSeparator.line.paragraph;if(fieldBegin.fieldSeparator.line.paragraph===paragraph||this.isExistBefore(fieldParagraph,paragraph)){var currentParagraph=fieldBegin.fieldEnd.line.paragraph;return currentParagraph!==paragraph&&this.isExistAfter(fieldParagraph,paragraph);}}return false;};/**
     * Return true if image is In field
     * @private
     */Selection.prototype.isImageField=function(){if(this.start.paragraph.isEmpty()||this.end.paragraph.isEmpty()){return false;}var startPosition=this.start;var endPosition=this.end;if(!this.isForward){startPosition=this.end;endPosition=this.start;}var indexInInline=0;var inlineInfo=startPosition.paragraph.getInline(startPosition.offset,indexInInline);var inline=inlineInfo.element;indexInInline=inlineInfo.index;if(indexInInline===inline.length){inline=this.getNextRenderedElementBox(inline,indexInInline);}inlineInfo=endPosition.paragraph.getInline(endPosition.offset,indexInInline);var endInline=inlineInfo.element;indexInInline=inlineInfo.index;if(inline instanceof FieldElementBox&&inline.fieldType===0&&endInline instanceof FieldElementBox&&endInline.fieldType===1&&inline.fieldSeparator){var fieldValue=inline.fieldSeparator.nextNode;if(fieldValue instanceof ImageElementBox&&fieldValue.nextNode===endInline){return true;}}return false;};/**
     * Return true if selection is in Form field
     * @private
     */Selection.prototype.isFormField=function(){var inline=this.getCurrentFormField();if(inline instanceof FieldElementBox&&inline.formFieldData){return true;}return false;};/**
     * Return true if selection is in reference field
     * @private
     */Selection.prototype.isReferenceField=function(field){if(sf.base.isNullOrUndefined(field)){field=this.getHyperlinkField(true);}if(field){var fieldCode=this.getFieldCode(field);fieldCode=fieldCode.toLowerCase();if(field instanceof FieldElementBox&&fieldCode.match('ref ')){return true;}}return false;};/**
     * Return true if selection is in text form field
     * @private
     */Selection.prototype.isInlineFormFillMode=function(field){if(this.documentHelper.isInlineFormFillProtectedMode){if(sf.base.isNullOrUndefined(field)){field=this.getCurrentFormField();}if(field){if(field.formFieldData instanceof TextFormField&&field.formFieldData.type==='Text'){return true;}}}return false;};/**
     * @private
     */Selection.prototype.getFormFieldType=function(formField){if(sf.base.isNullOrUndefined(formField)){formField=this.getCurrentFormField();}if(formField instanceof FieldElementBox){if(formField.formFieldData instanceof TextFormField){return'Text';}else if(formField.formFieldData instanceof CheckBoxFormField){return'CheckBox';}else if(formField.formFieldData instanceof DropDownFormField){return'DropDown';}}return undefined;};/**
     * Get selected form field type
     * @private
     */Selection.prototype.getCurrentFormField=function(checkFieldResult){var field;if(checkFieldResult||this.documentHelper.isFormFillProtectedMode&&this.owner.documentEditorSettings.formFieldSettings&&this.owner.documentEditorSettings.formFieldSettings.formFillingMode==='Inline'){for(var i=0;i<this.documentHelper.formFields.length;i++){var formField=this.documentHelper.formFields[i];if(HelperMethods.isLinkedFieldCharacter(formField)){var offset=formField.fieldSeparator.line.getOffset(formField.fieldSeparator,1);var fieldStart=new TextPosition(this.owner);fieldStart.setPositionParagraph(formField.fieldSeparator.line,offset);var fieldEndElement=formField.fieldEnd;offset=fieldEndElement.line.getOffset(fieldEndElement,0);var fieldEnd=new TextPosition(this.owner);fieldEnd.setPositionParagraph(fieldEndElement.line,offset);var start=this.start;var end=this.end;if(!this.isForward){start=this.end;end=this.start;}if((start.isExistAfter(fieldStart)||start.isAtSamePosition(fieldStart))&&(end.isExistBefore(fieldEnd)||end.isAtSamePosition(fieldEnd))){field=formField;break;}}}}else{field=this.getHyperlinkField(true);}if(field instanceof FieldElementBox&&field.fieldType===0&&!sf.base.isNullOrUndefined(field.formFieldData)){return field;}return undefined;};/**
     * @private
     */Selection.prototype.getCurrentTextFrame=function(){var container=this.start.paragraph.containerWidget;do{if(container instanceof TextFrame){return container;}if(container){container=container.containerWidget;}}while(container);return null;};/**
     * @private
     */Selection.prototype.isTableSelected=function(){var start=this.start;var end=this.end;if(!this.isForward){start=this.end;end=this.start;}if(sf.base.isNullOrUndefined(start.paragraph.associatedCell)||sf.base.isNullOrUndefined(end.paragraph.associatedCell)){return false;}var table=start.paragraph.associatedCell.ownerTable.getSplitWidgets();var firstParagraph=this.getFirstBlockInFirstCell(table[0]);var lastParagraph=this.getLastBlockInLastCell(table[table.length-1]);return start.paragraph.associatedCell.equals(firstParagraph.associatedCell)&&end.paragraph.associatedCell.equals(lastParagraph.associatedCell)&&(!firstParagraph.associatedCell.equals(lastParagraph.associatedCell)||start.offset===0&&end.offset===this.getLineLength(lastParagraph.lastChild)+1);};/**
     * Select List Text
     * @private
     */Selection.prototype.selectListText=function(){var lineWidget=this.documentHelper.selectionLineWidget;var endOffset='0';var selectionIndex=lineWidget.getHierarchicalIndex(endOffset);var startPosition=this.getTextPosition(selectionIndex);var endPosition=this.getTextPosition(selectionIndex);this.isSelectList=true;this.selectRange(startPosition,endPosition);this.isSelectList=false;this.highlightListText(this.documentHelper.selectionLineWidget);this.contextTypeInternal='List';};/**
     * Manually select the list text
     * @private
     */Selection.prototype.highlightListText=function(linewidget){var width=linewidget.children[0].width;var left=this.documentHelper.getLeftValue(linewidget);var top=linewidget.paragraph.y;this.createHighlightBorder(linewidget,width,left,top,false);this.documentHelper.isListTextSelected=true;};/**
     * @private
     */Selection.prototype.updateImageSize=function(imageFormat){this.owner.isShiftingEnabled=true;var startPosition=this.start;var endPosition=this.end;if(!this.isForward){startPosition=this.end;endPosition=this.start;}var inline=null;var index=0;var paragraph=startPosition.paragraph;if(paragraph===endPosition.paragraph&&startPosition.offset+1===endPosition.offset){var inlineObj=paragraph.getInline(endPosition.offset,index);inline=inlineObj.element;index=inlineObj.index;}if(inline instanceof ImageElementBox||inline instanceof ShapeElementBox){var width=inline.width;var height=inline.height;inline.width=imageFormat.width;inline.height=imageFormat.height;imageFormat.width=width;imageFormat.height=height;if(paragraph!==null&&paragraph.containerWidget!==null&&this.owner.editorModule){var lineIndex=paragraph.childWidgets.indexOf(inline.line);var elementIndex=inline.line.children.indexOf(inline);this.documentHelper.layout.reLayoutParagraph(paragraph,lineIndex,elementIndex);this.highlightSelection(false);}}};/**
     * Gets selected table content
     * @private
     */Selection.prototype.getSelectedCellsInTable=function(table,startCell,endCell){var startColumnIndex=startCell.columnIndex;var endColumnIndex=endCell.columnIndex+endCell.cellFormat.columnSpan-1;var startRowindex=startCell.ownerRow.index;var endRowIndex=endCell.ownerRow.index;var cells=[];for(var i=0;i<table.childWidgets.length;i++){var row=table.childWidgets[i];if(row.index>=startRowindex&&row.index<=endRowIndex){for(var j=0;j<row.childWidgets.length;j++){var cell=row.childWidgets[j];if(cell.columnIndex>=startColumnIndex&&cell.columnIndex<=endColumnIndex){cells.push(cell);}}}if(row.index>endRowIndex){break;}}return cells;// return html;
};/**
     * Copies the selected content to clipboard.
     *
     * @returns {void}
     */Selection.prototype.copy=function(){if(this.isEmpty){return;}this.copySelectedContent(false);};/**
     * @private
     *
     * @returns {void}
     */Selection.prototype.copySelectedContent=function(isCut){if(sf.base.isNullOrUndefined(this.owner.sfdtExportModule)){return;}this.copyToClipboard(this.getHtmlContent());if(isCut&&this.owner.editorModule){this.owner.editorModule.handleCut(this);}this.documentHelper.updateFocus();};/**
     * Write the selected content as SFDT.
     * @returns SFDT Object.
     */Selection.prototype.writeSfdt=function(){var startPosition=this.start;var endPosition=this.end;if(!this.isForward){startPosition=this.end;endPosition=this.start;}return this.owner.sfdtExportModule.write(startPosition.currentWidget,startPosition.offset,endPosition.currentWidget,endPosition.offset,true);};/**
     * @private
     */Selection.prototype.getHtmlContent=function(){var documentContent=this.writeSfdt();if(this.owner.editorModule){this.owner.editorModule.copiedData=JSON.stringify(documentContent);}return this.htmlWriter.writeHtml(documentContent);};Selection.prototype.copyToClipboard=function(htmlContent){window.getSelection().removeAllRanges();var div=document.createElement('div');div.style.left='-10000px';div.style.top='-10000px';div.style.position='relative';div.innerHTML=htmlContent;document.body.appendChild(div);if(navigator.userAgent.indexOf('Firefox')!==-1){div.tabIndex=0;div.focus();}var range=document.createRange();range.selectNodeContents(div);window.getSelection().addRange(range);var copySuccess=false;try{copySuccess=document.execCommand('copy');}catch(e){// Copying data to Clipboard can potentially fail - for example, if another application is holding Clipboard open.
}finally{window.getSelection().removeAllRanges();div.parentNode.removeChild(div);}return copySuccess;};// Caret implementation starts
/**
     * Shows caret in current selection position.
     *
     * @private
     * @returns {void}
     */Selection.prototype.showCaret=function(){var page=!sf.base.isNullOrUndefined(this.documentHelper.currentPage)?this.documentHelper.currentPage:this.documentHelper.currentRenderingPage;if(sf.base.isNullOrUndefined(page)||this.documentHelper.isRowOrCellResizing||this.owner.enableImageResizerMode&&this.owner.imageResizerModule.isImageResizerVisible&&!this.owner.imageResizerModule.isShapeResize){return;}var left=page.boundingRectangle.x;var right;if(this.viewer instanceof PageLayoutViewer){right=page.boundingRectangle.width*this.documentHelper.zoomFactor+left;}else{right=page.boundingRectangle.width-this.owner.viewer.padding.right-this.documentHelper.scrollbarWidth;}if(!this.owner.enableImageResizerMode||!this.owner.imageResizerModule.isImageResizerVisible||this.owner.imageResizerModule.isShapeResize){if(this.isHideSelection(this.start.paragraph)){this.caret.style.display='none';}else if(this.isEmpty&&(!this.owner.isReadOnlyMode||this.owner.enableCursorOnReadOnly||this.isInlineFormFillMode())){var caretLeft=parseInt(this.caret.style.left.replace('px',''),10);if(caretLeft<left||caretLeft>right){this.caret.style.display='none';}else{this.caret.style.display='block';}}else if(this.isImageSelected&&!this.owner.enableImageResizerMode){this.caret.style.display='block';}else{if(this.caret.style.display==='block'||sf.base.isNullOrUndefined(this)){if(!this.documentHelper.isComposingIME){this.caret.style.display='none';}}}}if(!sf.base.isNullOrUndefined(this)&&this.documentHelper.isTouchInput&&!this.owner.isReadOnlyMode){var caretStartLeft=parseInt(this.documentHelper.touchStart.style.left.replace('px',''),10)+14;var caretEndLeft=parseInt(this.documentHelper.touchEnd.style.left.replace('px',''),10)+14;var page_1=this.getSelectionPage(this.start);if(page_1){if(caretEndLeft<left||caretEndLeft>right){this.documentHelper.touchEnd.style.display='none';}else{this.documentHelper.touchEnd.style.display='block';}if(!this.isEmpty){left=page_1.boundingRectangle.x;right=page_1.boundingRectangle.width*this.documentHelper.zoomFactor+left;}if(caretStartLeft<left||caretStartLeft>right){this.documentHelper.touchStart.style.display='none';}else{this.documentHelper.touchStart.style.display='block';}}}else{this.documentHelper.touchStart.style.display='none';this.documentHelper.touchEnd.style.display='none';}};/**
     * To set the editable div caret position
     *
     * @private
     * @returns {void}
     */Selection.prototype.setEditableDivCaretPosition=function(index){this.documentHelper.editableDiv.focus();var child=this.documentHelper.editableDiv.childNodes[this.documentHelper.editableDiv.childNodes.length-1];if(child){var range=document.createRange();range.setStart(child,index);range.collapse(true);window.getSelection().removeAllRanges();window.getSelection().addRange(range);}};/**
     * Initializes caret.
     *
     * @private
     * @returns {void}
     */Selection.prototype.initCaret=function(){this.caret=sf.base.createElement('div',{styles:'position:absolute',className:'e-de-blink-cursor e-de-cursor-animation'});this.owner.documentHelper.viewerContainer.appendChild(this.caret);};/**
     * Updates caret position.
     *
     * @private
     * @returns {void}
     */Selection.prototype.updateCaretPosition=function(){var caretPosition=this.end.location;var page=this.getSelectionPage(this.end);if(page&&!sf.base.isNullOrUndefined(this.caret)){this.caret.style.left=page.boundingRectangle.x+Math.round(caretPosition.x)*this.documentHelper.zoomFactor+'px';var caretInfo=this.updateCaretSize(this.owner.selection.end);var topMargin=caretInfo.topMargin;//let caretHeight: number = caretInfo.height;
var viewer=this.viewer;var pageTop=(page.boundingRectangle.y-viewer.pageGap*(this.documentHelper.pages.indexOf(page)+1))*this.documentHelper.zoomFactor+viewer.pageGap*(this.documentHelper.pages.indexOf(page)+1);this.caret.style.top=pageTop+Math.round(caretPosition.y+topMargin)*this.documentHelper.zoomFactor+'px';if(this.owner.selection.characterFormat.baselineAlignment==='Subscript'){this.caret.style.top=parseFloat(this.caret.style.top)+parseFloat(this.caret.style.height)/2+'px';}if(this.documentHelper.isTouchInput||this.documentHelper.touchStart.style.display!=='none'){this.documentHelper.touchStart.style.left=page.boundingRectangle.x+(Math.round(caretPosition.x)*this.documentHelper.zoomFactor-14)+'px';this.documentHelper.touchStart.style.top=pageTop+(caretPosition.y+caretInfo.height)*this.documentHelper.zoomFactor+'px';this.documentHelper.touchEnd.style.left=page.boundingRectangle.x+(Math.round(caretPosition.x)*this.documentHelper.zoomFactor-14)+'px';this.documentHelper.touchEnd.style.top=pageTop+(caretPosition.y+caretInfo.height)*this.documentHelper.zoomFactor+'px';}}this.showHidePasteOptions(this.caret.style.top,this.caret.style.left);};/**
     * @private
     * @returns {void}
     */Selection.prototype.showHidePasteOptions=function(top,left){if(sf.base.Browser.isIE){return;}if(this.isViewPasteOptions){if(this.pasteElement&&this.pasteElement.style.display==='block'){return;}this.createPasteElement(top,left);}else if(this.pasteElement){this.pasteElement.style.display='none';}};/**
     * @private
     */Selection.prototype.getRect=function(position){var caretPosition=position.location;var page=this.getSelectionPage(position);if(page){var documentHelper=this.owner.documentHelper;var left=page.boundingRectangle.x+Math.round(caretPosition.x)*documentHelper.zoomFactor;var pageGap=this.viewer.pageGap;var pageTop=(page.boundingRectangle.y-pageGap*(page.index+1))*documentHelper.zoomFactor+pageGap*(page.index+1);var top_5=pageTop+Math.round(caretPosition.y)*documentHelper.zoomFactor;return new Point(left,top_5);}return new Point(0,0);};/**
     * Gets current selected page
     * @private
     */Selection.prototype.getSelectionPage=function(position){var lineWidget=this.getLineWidgetInternal(position.currentWidget,position.offset,true);if(lineWidget){return this.getPage(lineWidget.paragraph);}return undefined;};/**
     * Updates caret size.
     * @private
     */Selection.prototype.updateCaretSize=function(textPosition,skipUpdate){var topMargin=0;var isItalic=false;var caret;var index=0;var caretHeight=0;if(this.characterFormat.italic){isItalic=this.characterFormat.italic;}if(textPosition.paragraph.isEmpty()){var paragraph=textPosition.paragraph;var bottomMargin=0;var paragraphInfo=this.getParagraphMarkSize(paragraph,topMargin,bottomMargin);topMargin=paragraphInfo.topMargin;bottomMargin=paragraphInfo.bottomMargin;var height=paragraphInfo.height;caretHeight=topMargin<0?topMargin+height:height;if(!skipUpdate){this.caret.style.height=caretHeight*this.documentHelper.zoomFactor+'px';}topMargin=0;}else{var inlineInfo=textPosition.currentWidget.getInline(textPosition.offset,index);index=inlineInfo.index;var inline=inlineInfo.element;if(!sf.base.isNullOrUndefined(inline)){caret=this.getCaretHeight(inline,index,inline.characterFormat,true,topMargin,isItalic);caretHeight=caret.height;if(!skipUpdate){this.caret.style.height=caret.height*this.documentHelper.zoomFactor+'px';}}}if(!skipUpdate){if(isItalic){this.caret.style.transform='rotate(13deg)';}else{this.caret.style.transform='';}}return{'topMargin':topMargin,'height':caretHeight};};/**
     * Updates caret to page.
     * @private
     * @returns {void}
     */Selection.prototype.updateCaretToPage=function(startPosition,endPage){if(!sf.base.isNullOrUndefined(endPage)){this.documentHelper.selectionEndPage=endPage;if(this.owner.selection.isEmpty){this.documentHelper.selectionStartPage=endPage;}else{var startLineWidget=this.getLineWidgetParagraph(startPosition.offset,startPosition.paragraph.childWidgets[0]);//Gets start page.
var startPage=this.getPage(startLineWidget.paragraph);if(!sf.base.isNullOrUndefined(startPage)){this.documentHelper.selectionStartPage=startPage;}}}this.checkForCursorVisibility();};/**
     * Gets caret bottom position.
     * @private
     */Selection.prototype.getCaretBottom=function(textPosition,isEmptySelection){var bottom=textPosition.location.y;if(textPosition.paragraph.isEmpty()){var paragraph=textPosition.paragraph;var topMargin=0;var bottomMargin=0;var sizeInfo=this.getParagraphMarkSize(paragraph,topMargin,bottomMargin);topMargin=sizeInfo.topMargin;bottomMargin=sizeInfo.bottomMargin;bottom+=sizeInfo.height;bottom+=topMargin;if(!isEmptySelection){bottom+=bottomMargin;}}else{var index=0;var inlineInfo=textPosition.paragraph.getInline(textPosition.offset,index);var inline=inlineInfo.element;index=inlineInfo.index;var topMargin=0;var isItalic=false;var caretHeightInfo=this.getCaretHeight(inline,index,inline.characterFormat,false,topMargin,isItalic);topMargin=caretHeightInfo.topMargin;isItalic=caretHeightInfo.isItalic;bottom+=caretHeightInfo.height;if(isEmptySelection){bottom-=HelperMethods.convertPointToPixel(this.documentHelper.layout.getAfterSpacing(textPosition.paragraph));}}return bottom;};/**
     * Checks for cursor visibility.
     *
     * @private
     * @returns {void}
     */Selection.prototype.checkForCursorVisibility=function(){this.showCaret();};// caret implementation ends
/**
     * Keyboard shortcuts
     *
     * @private
     * @returns {void}
     */Selection.prototype.onKeyDownInternal=function(event,ctrl,shift,alt){var key=event.which||event.keyCode;if(ctrl&&!shift&&!alt){this.documentHelper.isControlPressed=true;switch(key){// case 9:
//     event.preventDefault();
//     if (this.owner.acceptTab) {
//         this.selection.handleTabKey(false, false);
//     }
//     break;
case 35:this.handleControlEndKey();break;case 36:this.handleControlHomeKey();break;case 37:this.handleControlLeftKey();break;case 38:this.handleControlUpKey();break;case 39:this.handleControlRightKey();break;case 40:this.handleControlDownKey();break;case 65:this.owner.selection.selectAll();break;case 67:event.preventDefault();this.copy();break;case 70:event.preventDefault();this.owner.showDialog("FindPane");break;}}else if(shift&&!ctrl&&!alt){switch(key){case 35:this.handleShiftEndKey();event.preventDefault();break;case 36:this.handleShiftHomeKey();event.preventDefault();break;case 37:this.handleShiftLeftKey();event.preventDefault();break;case 38:this.handleShiftUpKey();event.preventDefault();break;case 39:this.handleShiftRightKey();event.preventDefault();break;case 40:this.handleShiftDownKey();event.preventDefault();break;}}else if(shift&&ctrl&&!alt){switch(key){case 35:this.handleControlShiftEndKey();break;case 36:this.handleControlShiftHomeKey();break;case 37:this.handleControlShiftLeftKey();break;case 38:this.handleControlShiftUpKey();break;case 39:this.handleControlShiftRightKey();break;case 40:this.handleControlShiftDownKey();break;}}else{switch(key){// case 9:
//     event.preventDefault();
//     if (this.owner.acceptTab) {
//         this.handleTabKey(true, false);
//     }
//     break;  
case 33:event.preventDefault();this.documentHelper.viewerContainer.scrollTop-=this.documentHelper.visibleBounds.height;break;case 34:event.preventDefault();this.documentHelper.viewerContainer.scrollTop+=this.documentHelper.visibleBounds.height;break;case 35:this.handleEndKey();event.preventDefault();break;case 36:this.handleHomeKey();event.preventDefault();break;case 37:this.handleLeftKey();event.preventDefault();break;case 38:this.handleUpKey();event.preventDefault();break;case 39:this.handleRightKey();event.preventDefault();break;case 40:this.handleDownKey();event.preventDefault();break;}}if(this.isFormField()&&!this.documentHelper.isDocumentProtected){var formField=this.getCurrentFormField(true);if(formField&&formField.formFieldData instanceof DropDownFormField){formField=event.keyCode===37||event.keyCode===38||event.keyCode===40?formField:formField.nextElement instanceof BookmarkElementBox?formField.nextElement.reference:formField.fieldEnd;var index=event.keyCode===39?1:0;var offset=formField.line.getOffset(formField,index);var point=this.getPhysicalPositionInternal(formField.line,offset,false);this.selectInternal(formField.line,formField,index,point);}}if(!this.owner.isReadOnlyMode||this.isInlineFormFillMode()){this.owner.editorModule.onKeyDownInternal(event,ctrl,shift,alt);}else if(this.documentHelper.isDocumentProtected&&this.documentHelper.protectionType==='FormFieldsOnly'){if(event.keyCode===9||event.keyCode===32){this.owner.editorModule.onKeyDownInternal(event,ctrl,shift,alt);}}if(this.owner.searchModule){if(!sf.base.isNullOrUndefined(this.owner.searchModule.searchHighlighters)&&this.owner.searchModule.searchHighlighters.length>0){this.owner.searchModule.searchResults.clear();}}if(event.keyCode===27||event.which===27){if(!sf.base.isNullOrUndefined(this.owner.optionsPaneModule)){// this.owner.optionsPaneModule.showHideOptionsPane(false);
}if(this.owner.enableHeaderAndFooter){this.disableHeaderFooter();}}};//#region Enable or disable Header Footer
/**
     * @private
     */Selection.prototype.checkAndEnableHeaderFooter=function(point,pagePoint){var page=this.documentHelper.currentPage;if(this.isCursorInsidePageRect(point,page)){if(this.isCursorInHeaderRegion(point,page)){if(this.owner.enableHeaderAndFooter){return false;}return this.enableHeadersFootersRegion(page.headerWidget);}if(this.isCursorInFooterRegion(point,page)){if(this.owner.enableHeaderAndFooter){return false;}return this.enableHeadersFootersRegion(page.footerWidget);}}if(this.owner.enableHeaderAndFooter){this.owner.enableHeaderAndFooter=false;this.documentHelper.updateTextPositionForSelection(pagePoint,1);return true;}return false;};/**
     * @private
     */Selection.prototype.isCursorInsidePageRect=function(point,page){if(this.viewer.containerLeft+point.x>=page.boundingRectangle.x&&this.viewer.containerLeft+point.x<=page.boundingRectangle.x+page.boundingRectangle.width*this.documentHelper.zoomFactor&&this.viewer instanceof PageLayoutViewer){return true;}else if(this.viewer.containerLeft+point.x>=page.boundingRectangle.x&&this.viewer.containerLeft+point.x<=page.boundingRectangle.x+page.boundingRectangle.width){return true;}return false;};/**
     * @private
     */Selection.prototype.isCursorInHeaderRegion=function(point,page){if(this.viewer instanceof PageLayoutViewer){var pageTop=this.getPageTop(page);var headerHeight=0;var header=page.headerWidget;if(header){headerHeight=header.y+header.height;}var isEmpty=header.isEmpty&&!this.owner.enableHeaderAndFooter;var topMargin=HelperMethods.convertPointToPixel(page.bodyWidgets[0].sectionFormat.topMargin);var pageHeight=HelperMethods.convertPointToPixel(page.bodyWidgets[0].sectionFormat.pageHeight);var height=isEmpty?topMargin:Math.min(Math.max(headerHeight,topMargin),pageHeight/100*40);height=height*this.documentHelper.zoomFactor;if(this.viewer.containerTop+point.y>=pageTop&&this.viewer.containerTop+point.y<=pageTop+height){return true;}}return false;};/**
     * @private
     */Selection.prototype.isCursorInFooterRegion=function(point,page){if(this.viewer instanceof PageLayoutViewer){var pageRect=page.boundingRectangle;var pageTop=this.getPageTop(page);var pageBottom=pageTop+pageRect.height*this.documentHelper.zoomFactor;var footerDistance=HelperMethods.convertPointToPixel(page.bodyWidgets[0].sectionFormat.footerDistance);var footerHeight=0;if(page.footerWidget){footerHeight=page.footerWidget.height;}var bottomMargin=HelperMethods.convertPointToPixel(page.bodyWidgets[0].sectionFormat.bottomMargin);var isEmpty=page.footerWidget.isEmpty&&!this.owner.enableHeaderAndFooter;var height=pageRect.height;if(isEmpty){height=(height-bottomMargin)*this.documentHelper.zoomFactor;}else{height=(height-Math.min(pageRect.height/100*40,Math.max(footerHeight+footerDistance,bottomMargin)))*this.documentHelper.zoomFactor;}if(this.viewer.containerTop+point.y<=pageBottom&&this.viewer.containerTop+point.y>=pageTop+height){return true;}}return false;};/**
     * @private
     */Selection.prototype.enableHeadersFootersRegion=function(widget){if(this.viewer instanceof PageLayoutViewer){this.owner.enableHeaderAndFooter=true;this.updateTextPositionForBlockContainer(widget);this.shiftBlockOnHeaderFooterEnableDisable();return true;}return false;};/**
     * @private
     */Selection.prototype.shiftBlockOnHeaderFooterEnableDisable=function(){for(var i=0;i<this.documentHelper.headersFooters.length;i++){var headerFooter=this.documentHelper.headersFooters[i];var sectionFormat=this.getBodyWidgetInternal(i,0).sectionFormat;for(var _i=0,_a=Object.keys(headerFooter);_i<_a.length;_i++){var key=_a[_i];var widget=headerFooter[key];if(widget.isEmpty){this.owner.editor.shiftPageContent(widget.headerFooterType,sectionFormat);}}}};/**
     * @private
     */Selection.prototype.updateTextPositionForBlockContainer=function(widget){var block=widget.firstChild;if(block instanceof TableWidget){block=this.getFirstBlockInFirstCell(block);if(block instanceof TableWidget){block=this.getFirstBlockInFirstCell(block);}}this.selectParagraphInternal(block,true);};/**
     * Disable Header footer
     * @private
     */Selection.prototype.disableHeaderFooter=function(){var page=this.getPage(this.start.paragraph);this.updateTextPositionForBlockContainer(page.bodyWidgets[0]);this.owner.enableHeaderAndFooter=false;this.shiftBlockOnHeaderFooterEnableDisable();};//#endregion
/**
     * @private
     * @returns {void}
     */Selection.prototype.destroy=function(){if(!sf.base.isNullOrUndefined(this.contextTypeInternal)){this.contextTypeInternal=undefined;}// if (this.pasteDropDwn) {
//     this.pasteDropDwn.destroy();
//     this.pasteDropDwn = undefined;
// }
this.caret=undefined;this.contextTypeInternal=undefined;this.upDownSelectionLength=undefined;this.owner=undefined;};/**
     * Navigates to the specified bookmark.
     * @param name
     * @param moveToStart
     * @private
     */Selection.prototype.navigateBookmark=function(name,moveToStart){var bookmarks=this.documentHelper.bookmarks;if(bookmarks.containsKey(name)){//bookmark start element
var bookmrkElmnt=bookmarks.get(name);var offset=bookmrkElmnt.line.getOffset(bookmrkElmnt,0);var startPosition=new TextPosition(this.owner);startPosition.setPositionParagraph(bookmrkElmnt.line,offset);if(moveToStart){this.documentHelper.selection.selectRange(startPosition,startPosition);}else{//bookmark end element
var bookmrkEnd=bookmrkElmnt.reference;var endoffset=bookmrkEnd.line.getOffset(bookmrkEnd,1);var endPosition=new TextPosition(this.owner);endPosition.setPositionParagraph(bookmrkEnd.line,endoffset);//selects the bookmark range
this.documentHelper.selection.selectRange(startPosition,endPosition);}}};/**
     * Selects the specified bookmark.
     * @param name
     */Selection.prototype.selectBookmark=function(name){this.navigateBookmark(name);};/**
     * Returns the toc field from the selection.
     * @private
     */Selection.prototype.getTocField=function(){var paragraph=this.start.paragraph;var tocPara=undefined;while(paragraph!==undefined&&this.isTocStyle(paragraph)){tocPara=paragraph;paragraph=paragraph.previousRenderedWidget;}if(tocPara!==undefined){var lineWidget=tocPara.childWidgets[0];if(lineWidget!==undefined){return lineWidget.children[0];}}return undefined;};/**
     * Returns true if the paragraph has toc style.
     */Selection.prototype.isTocStyle=function(paragraph){var style=paragraph.paragraphFormat.baseStyle;return style!==undefined&&style.name.toLowerCase().indexOf('toc')!==-1;};/**
     * Return true if selection is in TOC
     * @private
     */Selection.prototype.isTOC=function(){var info=this.getParagraphInfo(this.start);var para=info.paragraph;for(var i=0;i<para.childWidgets[0].children.length;i++){var element=para.childWidgets[0].children[i];if(element instanceof FieldElementBox){var fieldCode=this.owner.selection.getFieldCode(element);if(fieldCode.match('TOC ')||fieldCode.match('Toc')){return true;}}else{continue;}}return false;};/**
     * @private
     */Selection.prototype.getElementsForward=function(lineWidget,startElement,endElement,bidi){if(sf.base.isNullOrUndefined(startElement)){return undefined;}var elements=[];while(bidi&&startElement&&startElement!==endElement&&startElement.nextElement&&!startElement.isRightToLeft){startElement=startElement.nextElement;}while(bidi&&endElement&&startElement!==endElement&&endElement.previousElement&&!endElement.isRightToLeft){endElement=endElement.previousElement;}var elementIndex=lineWidget.children.indexOf(startElement);while(elementIndex>=0){for(var i=elementIndex;i>-1&&i<lineWidget.children.length;bidi?i--:i++){var inlineElement=lineWidget.children[i];if(inlineElement.line===lineWidget){if(inlineElement===endElement){elements.push(inlineElement);elementIndex=-1;break;}else{elements.push(inlineElement);}}else{elementIndex=-1;break;}}// inline = inline !== null && inline.NextNode !== null ? (inline.NextNode as Inline).GetNextRenderedInline() : null;
elementIndex=-1;}return elements.length===0?undefined:elements;};// Gets the current line elements in inline reverse order from the end element.
/**
     * @private
     */Selection.prototype.getElementsBackward=function(lineWidget,startElement,endElement,bidi){var elements=[];while(bidi&&startElement&&startElement.previousElement&&(!startElement.isRightToLeft||startElement instanceof TextElementBox&&this.documentHelper.textHelper.isRTLText(startElement.text))){startElement=startElement.previousElement;}var elementIndex=lineWidget.children.indexOf(startElement);while(elementIndex>=0){for(var i=elementIndex;i>-1&&i<lineWidget.children.length;bidi?i++:i--){var inlineElement=lineWidget.children[i];if(inlineElement.line===lineWidget){elements.push(inlineElement);}else{elementIndex=-1;break;}}// inline = inline !== null && inline.NextNode !== null ? (inline.NextNode as Inline).GetNextRenderedInline() : null;
elementIndex=-1;}return elements;};/**
     * Navigate to previous comment in the document.
     *
     * @returns {void}
     */Selection.prototype.navigatePreviousComment=function(){this.commentNavigateInternal(false);};/**
     * Navigate to next comment in the document.
     *
     * @returns {void}
     */Selection.prototype.navigateNextComment=function(){this.commentNavigateInternal(true);};Selection.prototype.commentNavigateInternal=function(next){if(!this.documentHelper.currentSelectedComment){if(this.documentHelper.comments.length===0){return;}this.documentHelper.currentSelectedComment=this.documentHelper.comments[0];}if(this.documentHelper.currentSelectedComment){var comments=this.documentHelper.comments;var comment=this.documentHelper.currentSelectedComment;var index=comments.indexOf(comment);if(next){comment=index===comments.length-1?comments[0]:comments[index+1];}else{comment=index===0?comments[comments.length-1]:comments[index-1];}this.documentHelper.currentSelectedComment=comment;this.selectComment(comment);}};/**
     * Navigate to previous revision in the document.
     *
     * @returns {void}
     */Selection.prototype.navigatePreviousRevision=function(){this.revisionNavigateInternal(false);};/**
     * Navigate to next revision in the document.
     *
     * @returns {void}
     */Selection.prototype.navigateNextRevision=function(){this.revisionNavigateInternal(true);};/**
     * Method to navigate revisions
     *
     * @private
     * @returns {void}
     */Selection.prototype.revisionNavigateInternal=function(next){if(!this.documentHelper.currentSelectedRevisionInternal){if(this.documentHelper.owner.revisions.length===0){return;}this.documentHelper.currentSelectedRevision=this.documentHelper.owner.revisions.get(0);}if(this.documentHelper.currentSelectedRevision){var revisions=this.documentHelper.owner.revisions.changes;var revision=this.documentHelper.currentSelectedRevision;var index=revisions.indexOf(revision);if(next){revision=index===revisions.length-1?revisions[0]:revisions[index+1];}else{revision=index===0?revisions[revisions.length-1]:revisions[index-1];}this.documentHelper.currentSelectedRevision=revision;this.selectRevision(revision);}this.owner.trackChangesPane.currentSelectedRevision=this.documentHelper.currentSelectedRevision;};/**
     * @private
     * @returns {void}
     */Selection.prototype.selectComment=function(comment){if(!sf.base.isNullOrUndefined(comment)){var startPosition=this.getElementPosition(comment.commentStart).startPosition;var endPosition=this.getElementPosition(comment.commentEnd).startPosition;this.selectPosition(startPosition,endPosition);this.documentHelper.currentSelectedComment=comment;this.owner.dotNetRef.invokeMethodAsync('SetSelectedComment',comment.commentId);// if (this.owner.commentReviewPane) {
//     this.owner.commentReviewPane.selectComment(comment);
// }
}};/**
     * @private
     */Selection.prototype.hightlightCommentSelectionMark=function(){if(this.documentHelper.currentSelectedComment){var commentStart=this.getCommentStart(this.documentHelper.currentSelectedComment);if(commentStart&&!commentStart.commentMark){commentStart.renderCommentMark();}sf.base.classList(commentStart.commentMark,['e-de-cmt-mark-selected'],[]);}};/**
     * @private
     */Selection.prototype.updatePreviousCommentMark=function(comment){if(this.documentHelper.currentSelectedComment){var commentStart=this.getCommentStart(this.documentHelper.currentSelectedComment);var commentMark=commentStart.commentMark;if(commentMark){sf.base.classList(commentMark,[],['e-de-cmt-mark-selected']);this.removeSelectionMark('e-de-cmt-mark-selected');}}};Selection.prototype.removeSelectionMark=function(className){if(this.documentHelper.pageContainer){var elements=this.documentHelper.pageContainer.getElementsByClassName(className);for(var i=0;i<elements.length;i++){sf.base.classList(elements[i],[],[className]);}}};Selection.prototype.getCommentStart=function(comment){var commentStart=undefined;if(comment&&comment.commentStart){commentStart=comment.commentStart;}if(commentStart.commentMark!==undefined){commentStart.commentMark.title='Click to see this comment';}return this.getFirstCommentInLine(commentStart);};Selection.prototype.getFirstCommentInLine=function(commentStart){for(var i=0;i<commentStart.line.children.length;i++){var startComment=commentStart.line.children[i];if(startComment instanceof CommentCharacterElementBox&&startComment.commentType===0){return startComment;}}return commentStart;};/**
     * @private
     * @param revision
     * @returns {void}
     */Selection.prototype.selectRevision=function(revision){if(!sf.base.isNullOrUndefined(revision)&&revision.range.length>0){var firstElement=revision.range[0];var lastElement=revision.range[revision.range.length-1];if(firstElement instanceof WRowFormat){var rowWidget=firstElement.ownerBase;var firstCell=rowWidget.childWidgets[0];var lastCell=rowWidget.childWidgets[rowWidget.childWidgets.length-1];var firstPara=this.getFirstParagraph(firstCell);var lastPara=this.getLastParagraph(lastCell);this.start.setPosition(firstPara.firstChild,true);this.end.setPositionParagraph(lastPara.lastChild,lastPara.lastChild.getEndOffset()+1);this.selectPosition(this.start,this.end);}else if(firstElement&&lastElement){var startPosition=new TextPosition(this.owner);var offset=0;if(firstElement instanceof WCharacterFormat){var currentPara=firstElement.ownerBase;offset=currentPara.getLength();startPosition.setPositionParagraph(currentPara.lastChild,offset);}else{offset=firstElement.line.getOffset(firstElement,0);startPosition.setPositionForLineWidget(firstElement.line,offset);}var endPosition=new TextPosition(this.owner);if(lastElement instanceof WCharacterFormat){var currentPara=lastElement.ownerBase;if(currentPara.isEndsWithPageBreak){this.owner.trackChangesPane.isTrackingPageBreak=true;endPosition.setPositionParagraph(currentPara.nextRenderedWidget.childWidgets[0],0);}else{offset=currentPara.getLength();endPosition.setPositionParagraph(currentPara.lastChild,offset+1);}}else{offset=lastElement.line.getOffset(lastElement,0)+lastElement.length;if(this.isTOC()){offset+=1;}endPosition.setPositionForLineWidget(lastElement.line,offset);}var curentPosition=startPosition.clone();if(!startPosition.isExistBefore(endPosition)){startPosition=endPosition;endPosition=curentPosition;}this.selectPosition(startPosition,endPosition);}}};/**
     * @private
     * @returns {void}
     */Selection.prototype.updateEditRangeCollection=function(){if(this.editRangeCollection.length>0){this.editRangeCollection=[];}var editRangeStart;var everyOneArea;if(!this.documentHelper.isDocumentProtected){for(var i=0;i<this.documentHelper.editRanges.length;i++){var user=this.documentHelper.editRanges.keys[i];editRangeStart=this.documentHelper.editRanges.get(user);for(var j=0;j<editRangeStart.length;j++){this.editRangeCollection.push(editRangeStart[j]);}}}else{if(this.documentHelper.editRanges.containsKey(this.owner.currentUser)){editRangeStart=this.documentHelper.editRanges.get(this.owner.currentUser);for(var j=0;j<editRangeStart.length;j++){this.editRangeCollection.push(editRangeStart[j]);}}if(this.documentHelper.editRanges.containsKey('Everyone')){var user='Everyone';everyOneArea=this.documentHelper.editRanges.get(user);for(var j=0;j<everyOneArea.length;j++){this.editRangeCollection.push(everyOneArea[j]);}}}};//Restrict editing implementation starts
/**
     * @private
     * @returns {void}
     */Selection.prototype.onHighlight=function(){if(this.isHighlightEditRegion){this.highlightEditRegion();}else{this.unHighlightEditRegion();}this.viewer.renderVisiblePages();};/**
     * @private
     * @returns {void}
     */Selection.prototype.highlightEditRegion=function(){this.updateEditRangeCollection();// if (this.owner.enableLockAndEdit) {
//     return;
// }
if(!this.isHighlightEditRegion){this.unHighlightEditRegion();return;}this.isHightlightEditRegionInternal=true;if(sf.base.isNullOrUndefined(this.editRegionHighlighters)){this.editRegionHighlighters=new Dictionary();}this.editRegionHighlighters.clear();for(var j=0;j<this.editRangeCollection.length;j++){this.highlightEditRegionInternal(this.editRangeCollection[j]);}this.isHightlightEditRegionInternal=false;this.viewer.updateScrollBars();};/**
     * @private
     * @returns {void}
     */Selection.prototype.highlightFormFields=function(){if(sf.base.isNullOrUndefined(this.formFieldHighlighters)){this.formFieldHighlighters=new Dictionary();}this.formFieldHighlighters.clear();var formFields=this.documentHelper.formFields;if(!sf.base.isNullOrUndefined(formFields)&&formFields.length>0){for(var i=0;i<formFields.length;i++){var formField=formFields[i];if(HelperMethods.isLinkedFieldCharacter(formField)){var offset=formField.line.getOffset(formField,0);var startPosition=new TextPosition(this.owner);startPosition.setPositionParagraph(formField.line,offset);var endElement=formField.fieldEnd;offset=endElement.line.getOffset(endElement,1);var endPosition=new TextPosition(this.owner);endPosition.setPositionParagraph(endElement.line,offset);this.isHighlightFormFields=true;this.highlight(startPosition.paragraph,startPosition,endPosition);if(this.isHighlightNext){this.highlightNextBlock(this.hightLightNextParagraph,startPosition,endPosition);this.isHighlightNext=false;this.hightLightNextParagraph=undefined;}}}this.isHighlightFormFields=false;this.viewer.updateScrollBars();}};/**
     * @private
     * @returns {void}
     */Selection.prototype.unHighlightEditRegion=function(){if(!sf.base.isNullOrUndefined(this.editRegionHighlighters)){this.editRegionHighlighters.clear();this.editRegionHighlighters=undefined;}this.isHightlightEditRegionInternal=false;};/**
     * @private
     * @returns {void}
     */Selection.prototype.highlightEditRegionInternal=function(editRangeStart){var positionInfo=this.getPosition(editRangeStart);var startPosition=positionInfo.startPosition;var endPosition=positionInfo.endPosition;// if (editRangeStart.user === this.owner.currentUser && editRangeStart.group === '') {
this.isCurrentUser=true;// }
this.highlightEditRegions(editRangeStart,startPosition,endPosition);this.isCurrentUser=false;};/**
     * Shows all the editing region, where current user can edit.
     *
     * @returns {void}
     */Selection.prototype.showAllEditingRegion=function(){if(this.editRangeCollection.length===0){this.updateEditRangeCollection();}this.documentHelper.clearSelectionHighlight();for(var j=0;j<this.editRangeCollection.length;j++){var editRangeStart=this.editRangeCollection[j];var positionInfo=this.getPosition(editRangeStart);var startPosition=positionInfo.startPosition;var endPosition=positionInfo.endPosition;this.highlightEditRegions(editRangeStart,startPosition,endPosition);}};Selection.prototype.highlightEditRegions=function(editRangeStart,startPosition,endPosition){if(!editRangeStart.line.paragraph.isInsideTable||editRangeStart.line.paragraph.isInsideTable&&!editRangeStart.editRangeEnd.line.paragraph.isInsideTable){this.highlight(editRangeStart.line.paragraph,startPosition,endPosition);if(this.isHighlightNext){this.highlightNextBlock(this.hightLightNextParagraph,startPosition,endPosition);this.isHighlightNext=false;this.hightLightNextParagraph=undefined;}}else{var row=editRangeStart.line.paragraph.associatedCell.ownerRow;var cell=row.childWidgets[editRangeStart.columnFirst];if(cell){for(var i=0;i<cell.childWidgets.length;i++){if(cell.childWidgets[i]instanceof ParagraphWidget){this.highlight(cell.childWidgets[i],startPosition,endPosition);if(this.isHighlightNext){this.highlightNextBlock(this.hightLightNextParagraph,startPosition,endPosition);this.isHighlightNext=false;this.hightLightNextParagraph=undefined;}}}}}};/**
     * Navigate to next editing region, where current user can edit.
     *
     * @returns {void}
     */Selection.prototype.navigateToNextEditingRegion=function(){var editRange=this.getEditRangeStartElement();//Sort based on position
for(var i=this.editRangeCollection.length-1;i>=0;i--){for(var j=1;j<=i;j++){var nextPosition=this.getPosition(this.editRangeCollection[j-1]).startPosition;var firstPosition=this.getPosition(this.editRangeCollection[j]).startPosition;if(nextPosition.isExistAfter(firstPosition)){var temp=this.editRangeCollection[j-1];this.editRangeCollection[j-1]=this.editRangeCollection[j];this.editRangeCollection[j]=temp;}}}var index=this.editRangeCollection.indexOf(editRange);var editRangeStart=index<this.editRangeCollection.length-1?this.editRangeCollection[index+1]:this.editRangeCollection[0];var positionInfo=this.getPosition(editRangeStart);var startPosition=positionInfo.startPosition;var endPosition=positionInfo.endPosition;this.selectRange(startPosition,endPosition);};/**
     * Highlight all the editing region, where current user can edit.
     *
     * @returns {void}
     */Selection.prototype.toggleEditingRegionHighlight=function(){this.isHighlightEditRegion=!this.isHighlightEditRegion;};/**
     * @private
     */Selection.prototype.getEditRangeStartElement=function(){for(var i=0;i<this.editRangeCollection.length;i++){var editStart=this.editRangeCollection[i];var position=this.getPosition(editStart);var start=position.startPosition;var end=position.endPosition;if((this.start.isExistAfter(start)||this.start.isAtSamePosition(start))&&(this.end.isExistBefore(end)||this.end.isAtSamePosition(end))){return editStart;}}return undefined;};/**
     * Returns true if selection is inside the edit region
     *
     * @returns {boolean}
     */Selection.prototype.isSelectionInEditRegion=function(){if(!this.documentHelper.isDocumentProtected){return false;}return this.checkSelectionIsAtEditRegion();};Selection.prototype.checkSelectionIsAtEditRegion=function(start,end){for(var i=0;i<this.editRangeCollection.length;i++){var editRangeStart=this.editRangeCollection[i];var positionInfo=this.getPosition(editRangeStart);var startPosition=positionInfo.startPosition;var endPosition=positionInfo.endPosition;if(sf.base.isNullOrUndefined(start)&&sf.base.isNullOrUndefined(end)){start=this.start;end=this.end;if(!this.isForward){start=this.end;end=this.start;}}if((start.isExistAfter(startPosition)||start.isAtSamePosition(startPosition))&&(end.isExistBefore(endPosition)||end.isAtSamePosition(endPosition))){return true;}}return false;};/**
     * @private
     */Selection.prototype.getPosition=function(element){var offset=element.line.getOffset(element,1);var startPosition=new TextPosition(this.owner);startPosition.setPositionParagraph(element.line,offset);var endElement;if(element instanceof EditRangeStartElementBox){endElement=element.editRangeEnd;}else if(element instanceof ContentControl){endElement=element.reference;}else if(element instanceof BookmarkElementBox){endElement=element.reference;}offset=endElement.line.getOffset(endElement,1);var endPosition=new TextPosition(this.owner);endPosition.setPositionParagraph(endElement.line,offset);return{'startPosition':startPosition,'endPosition':endPosition};};/**
     * @private
     */Selection.prototype.checkContentControlLocked=function(checkFormat){this.owner.editorModule.isXmlMapped=false;for(var i=0;i<this.documentHelper.contentControlCollection.length;i++){var contentControlStart=this.documentHelper.contentControlCollection[i];var position=this.getPosition(contentControlStart);var cCstart=position.startPosition;var cCend=position.endPosition;var start=this.start;var end=this.end;if(!this.isForward){start=this.end;end=this.start;}if(sf.base.isNullOrUndefined(checkFormat)){var cCStartInsideSelction=(cCstart.isExistAfter(start)||cCstart.isAtSamePosition(start))&&(cCstart.isExistBefore(end)||cCstart.isAtSamePosition(end));var cCEndInsideSelction=(cCend.isExistAfter(start)||cCend.isAtSamePosition(start))&&(cCend.isExistBefore(end)||cCend.isAtSamePosition(end));if(cCStartInsideSelction&&cCEndInsideSelction){if(contentControlStart.contentControlProperties.lockContentControl){//this.owner.trigger('contentControl');
return true;}return false;}if(cCStartInsideSelction||cCEndInsideSelction){if(!(cCstart.isAtSamePosition(start)||cCend.isAtSamePosition(start))){return true;}}}if((start.isExistAfter(cCstart)||start.isAtSamePosition(cCstart))&&(end.isExistBefore(cCend)||end.isAtSamePosition(cCend))){if(contentControlStart.contentControlProperties.xmlMapping&&contentControlStart.contentControlProperties.xmlMapping.isMapped){this.owner.editorModule.isXmlMapped=true;}if(contentControlStart.contentControlProperties.lockContents){//this.owner.trigger('contentControl');
return true;}else if(sf.base.isNullOrUndefined(checkFormat)&&(contentControlStart.contentControlProperties.type==='CheckBox'||contentControlStart.contentControlProperties.type==='ComboBox'||contentControlStart.contentControlProperties.type==='DropDownList'||contentControlStart.contentControlProperties.type==='Date')){//this.owner.trigger('contentControl');
return true;}}}return false;};/**
     * @private
     */Selection.prototype.getElementPosition=function(element,isEnd){var offset=element.line.getOffset(element,isEnd?0:1);var startPosition=new TextPosition(this.owner);startPosition.setPositionParagraph(element.line,offset);return{'startPosition':startPosition,'endPosition':undefined};};//Restrict editing implementation ends
/**
     * Update ref field.
     * @private
     */Selection.prototype.updateRefField=function(field){if(sf.base.isNullOrUndefined(field)){field=this.getHyperlinkField(true);}if(!sf.base.isNullOrUndefined(field)){if(!this.isReferenceField(field)){return;}var fieldCode=this.getFieldCode(field).replace(/\s+/g,' ');fieldCode=fieldCode.trim();if(fieldCode.toLowerCase().indexOf('ref')===0){var code=fieldCode.split(' ');if(code.length>1){var bookmarkId=code[1];if(this.documentHelper.bookmarks.containsKey(bookmarkId)){var start=this.start;var end=this.end;if(!this.isForward){start=this.end;end=this.start;}var bookmarkStart=this.documentHelper.bookmarks.get(bookmarkId);var bookmarkEnd=bookmarkStart.reference;var previousNode=bookmarkStart.previousNode;if((sf.base.isNullOrUndefined(previousNode)||!(previousNode instanceof FieldElementBox))&&bookmarkEnd.previousNode instanceof FieldElementBox&&bookmarkEnd.previousNode.fieldType===1&&!sf.base.isNullOrUndefined(bookmarkEnd.previousNode.fieldBegin)&&!sf.base.isNullOrUndefined(bookmarkEnd.previousNode.fieldBegin.formFieldData)){bookmarkStart=bookmarkEnd.previousNode.fieldBegin.fieldSeparator;bookmarkEnd=bookmarkEnd.previousNode.fieldBegin.fieldEnd;}else if(previousNode instanceof FieldElementBox&&previousNode.fieldType===0&&!sf.base.isNullOrUndefined(previousNode.formFieldData)){bookmarkStart=previousNode.fieldSeparator;bookmarkEnd=previousNode.fieldEnd;}var offset=bookmarkStart.line.getOffset(bookmarkStart,1);start.setPositionParagraph(bookmarkStart.line,offset);end.setPositionParagraph(bookmarkEnd.line,bookmarkEnd.line.getOffset(bookmarkEnd,0));var documentContent=this.owner.sfdtExportModule.write(start.currentWidget,start.offset,end.currentWidget,end.offset,false,true);var startElement=field.fieldSeparator;var endElement=field.fieldEnd;start.setPositionParagraph(startElement.line,startElement.line.getOffset(startElement,1));end.setPositionParagraph(endElement.line,endElement.line.getOffset(endElement,0));this.owner.editor.pasteContents(documentContent);}}}}};/**
     *
     * @private
     * @returns {void}
     */Selection.prototype.footnoteReferenceElement=function(start,end,inline){var container=this.getContainerWidget(start.paragraph);var count=0;if(container instanceof FootNoteWidget){var footNoteElement=this.start.paragraph.footNoteReference;for(var i=0;i<this.documentHelper.pages.length;i++){count=0;var page=this.documentHelper.pages[i];for(var j=0;j<page.bodyWidgets.length;j++){var bodyWidget=page.bodyWidgets[j];for(var k=0;k<bodyWidget.childWidgets.length;k++){var paragraph=bodyWidget.childWidgets[k];for(var l=0;l<paragraph.childWidgets.length;l++){var lines=paragraph.childWidgets[l];count=0;if(!sf.base.isNullOrUndefined(lines.children)){for(var m=0;m<lines.children.length;m++){var child=lines.children[m];count+=child.length;if(child instanceof FootnoteElementBox&&child===footNoteElement){start.setPositionParagraph(lines,count-1);end.setPositionParagraph(lines,count);this.selectRange(start,end);}}}}}}}}};return Selection;}();/**
 * Selection Export
 */ /**
 * @private
 */var TextSearch=/** @class */function(){function TextSearch(owner){this.wordBefore='\\b';this.wordAfter='\\b';this.isHeader=false;this.isFooter=false;this.owner=owner;this.documentHelper=this.owner.documentHelper;}TextSearch.prototype.find=function(pattern,findOption){return this.findNext(pattern,findOption,'0;0;0');};TextSearch.prototype.findNext=function(pattern,findOption,hierarchicalPosition){if(typeof pattern==='string'){pattern=this.stringToRegex(pattern,findOption);}if(hierarchicalPosition===undefined){hierarchicalPosition='0;0;0';}this.owner.searchModule.textSearchResults.clearResults();var results=this.owner.searchModule.textSearchResults;this.findDocument(results,pattern,true,findOption,hierarchicalPosition);return results.length>0,results.currentSearchResult;};TextSearch.prototype.stringToRegex=function(textToFind,option){if(textToFind.indexOf('\\')>-1){textToFind=textToFind.split('\\').join('\\\\');}// eslint-disable-next-line max-len
if(textToFind.indexOf('(')>-1||textToFind.indexOf(')')>-1||textToFind.indexOf('.')>-1||textToFind.indexOf('[')>-1||textToFind.indexOf(']')>-1||textToFind.indexOf('$')>-1||textToFind.indexOf('{')>-1||textToFind.indexOf('}')>-1||textToFind.indexOf('*')>-1||textToFind.indexOf('|')>-1||textToFind.indexOf('^')>-1||textToFind.indexOf('?')>-1){var text='';for(var i=0;i<textToFind.length;i++){// eslint-disable-next-line max-len
if(textToFind[i]==='('||textToFind[i]===')'||textToFind[i]==='.'||textToFind[i]==='['||textToFind[i]===']'||textToFind[i]==='$'||textToFind[i]==='{'||textToFind[i]==='}'||textToFind[i]==='*'||textToFind[i]==='|'||textToFind[i]==='^'||textToFind[i]==='?'){text+='\\'+textToFind[i];}else{text+=textToFind[i];}}textToFind=text;}if(option==='WholeWord'||option==='CaseSensitiveWholeWord'){textToFind=this.wordBefore+textToFind+this.wordAfter;}return new RegExp(textToFind,option==='CaseSensitive'||option==='CaseSensitiveWholeWord'?'g':'ig');};TextSearch.prototype.isPatternEmpty=function(pattern){var wordEmpty=this.wordBefore+this.wordAfter;var patternRegExp=pattern.toString();return patternRegExp.length===0||patternRegExp===wordEmpty;};TextSearch.prototype.findAll=function(pattern,findOption,hierarchicalPosition){if(typeof pattern==='string'){pattern=this.stringToRegex(pattern,findOption);}if(hierarchicalPosition===undefined){hierarchicalPosition='0;0;0';}this.owner.searchModule.textSearchResults.clearResults();var results=this.owner.searchModule.textSearchResults;this.findDocument(results,pattern,false,findOption,hierarchicalPosition);if(results.length>0&&results.currentIndex<0){results.currentIndex=0;}if(!sf.base.isNullOrUndefined(results.currentSearchResult)){var eventArgs={source:this.documentHelper.owner};this.owner.dotNetRef.invokeMethodAsync("SearchResultsChange");//this.documentHelper.owner.trigger('searchResultsChange', eventArgs);
return results;}return undefined;};TextSearch.prototype.getElementInfo=function(inlineElement,indexInInline,includeNextLine){var inlines=inlineElement;var stringBuilder='';var spans=new Dictionary();// eslint-disable  no-constant-condition
do{if(inlineElement instanceof TextElementBox&&!sf.base.isNullOrUndefined(inlineElement.text)&&inlineElement.text!==''){spans.add(inlineElement,stringBuilder.length);// IndexInInline Handled specifically for simple find operation to start from starting point
if(inlineElement===inlines){stringBuilder=stringBuilder+inlineElement.text.substring(indexInInline);}else{stringBuilder=stringBuilder+inlineElement.text;}}else if(inlineElement instanceof FieldElementBox){var fieldBegin=inlineElement;if(!sf.base.isNullOrUndefined(fieldBegin.fieldEnd)){// eslint-disable-next-line max-len
inlineElement=sf.base.isNullOrUndefined(fieldBegin.fieldSeparator)?fieldBegin.fieldEnd:fieldBegin.fieldSeparator;}}if(!sf.base.isNullOrUndefined(inlineElement)&&sf.base.isNullOrUndefined(inlineElement.nextNode)){break;}if(!sf.base.isNullOrUndefined(inlineElement)){if(!sf.base.isNullOrUndefined(includeNextLine)&&!includeNextLine){var elementBoxes=inlineElement.line.children;var length_1=inlineElement.line.children.length;if(elementBoxes.indexOf(inlineElement)<length_1-1){inlineElement=inlineElement.nextNode;}else{inlineElement=undefined;break;}}else{inlineElement=inlineElement.nextNode;}}// eslint-disable-next-line no-constant-condition
}while(true);var text=stringBuilder.toString();return{elementsWithOffset:spans,fullText:text};};// eslint-disable-next-line max-len
TextSearch.prototype.updateMatchedTextLocation=function(matches,results,textInfo,indexInInline,inlines,isFirstMatch,selectionEnd,startPosition){for(var i=0;i<matches.length;i++){var match=matches[i];var isMatched=void 0;if(!sf.base.isNullOrUndefined(startPosition)&&match.index<startPosition){continue;}var result=results.addResult();var spanKeys=textInfo.keys;for(var i_1=0;i_1<spanKeys.length;i_1++){var span=spanKeys[i_1];var startIndex=textInfo.get(span);var spanLength=span.length;// IndexInInline Handled specifically for simple find operation to start from starting point
if(span===inlines){spanLength-=indexInInline;}if(sf.base.isNullOrUndefined(result.start)&&match.index<startIndex+spanLength){var index=match.index-startIndex;// IndexInInline Handled specifically for simple find operation to start from starting point
if(span===inlines){index+=indexInInline;}var offset=span.line.getOffset(span,index);result.start=this.getTextPosition(span.line,offset.toString());result.start.location=this.owner.selection.getPhysicalPositionInternal(span.line,offset,true);result.start.setPositionParagraph(span.line,offset);}if(match.index+match[0].length<=startIndex+spanLength){var index=match.index+match[0].length-startIndex;// IndexInInline Handled specifically for simple find operation to start from starting point
if(span===inlines){index+=indexInInline;}var offset=span.line.getOffset(span,index);result.end=this.getTextPosition(span.line,offset.toString());result.end.location=this.owner.selection.getPhysicalPositionInternal(span.line,offset,true);result.end.setPositionParagraph(span.line,offset);isMatched=true;break;}}result.isHeader=this.isHeader;result.isFooter=this.isFooter;if(isFirstMatch){results.currentIndex=0;break;}else if(results.currentIndex<0&&!sf.base.isNullOrUndefined(selectionEnd)&&(selectionEnd.isExistBefore(result.start)||selectionEnd.isAtSamePosition(result.start))){results.currentIndex=results.indexOf(result);}if(!sf.base.isNullOrUndefined(startPosition)&&isMatched){break;}}};// eslint-disable-next-line max-len
TextSearch.prototype.findDocument=function(results,pattern,isFirstMatch,findOption,hierachicalPosition){if(this.isPatternEmpty(pattern)){return;}if(findOption===undefined){findOption='None';}var inline=undefined;var selectionEnd=undefined;if(hierachicalPosition!==undefined){selectionEnd=this.owner.selection.end;}if(hierachicalPosition!==undefined&&isFirstMatch&&selectionEnd!==undefined&&selectionEnd.paragraph!==undefined){if(selectionEnd.paragraph instanceof ParagraphWidget){var indexInInline=0;// IndexInInline Handled specifically for simple find operation to start from starting point
// eslint-disable-next-line max-len
var inlineElement=selectionEnd.currentWidget.getInline(this.owner.selection.start.offset,indexInInline);inline=inlineElement.element;indexInInline=inlineElement.index;if(!sf.base.isNullOrUndefined(inline)){var nextParagraphWidget=undefined;nextParagraphWidget=this.findInline(inline,pattern,findOption,indexInInline,isFirstMatch,results,selectionEnd);while(results.length===0&&!sf.base.isNullOrUndefined(nextParagraphWidget)){while(!sf.base.isNullOrUndefined(nextParagraphWidget)&&nextParagraphWidget.childWidgets.length===0){// eslint-disable-next-line max-len
nextParagraphWidget=this.owner.selection.getNextParagraph(nextParagraphWidget.containerWidget);}if(sf.base.isNullOrUndefined(nextParagraphWidget)){break;}var lineWidget=nextParagraphWidget.childWidgets[0];if(lineWidget.children[0]instanceof ListTextElementBox){inline=lineWidget.children[2]instanceof TextElementBox?lineWidget.children[2]:undefined;}else{inline=lineWidget.children[0];}if(sf.base.isNullOrUndefined(inline)){break;}nextParagraphWidget=this.findInline(inline,pattern,findOption,0,isFirstMatch,results,selectionEnd);}if(results.length>0){return;}}}}var section;section=this.documentHelper.pages[0].bodyWidgets[0];while(!sf.base.isNullOrUndefined(section)&&section.childWidgets.length===0){section=section.nextWidget;}if(sf.base.isNullOrUndefined(section)||section.childWidgets.length===0){return;}this.isHeader=false;this.isFooter=false;this.findInlineText(section,pattern,findOption,isFirstMatch,results,selectionEnd);for(var i=0;i<this.documentHelper.pages.length;i++){var headerWidget=this.documentHelper.pages[i].headerWidget;if(!sf.base.isNullOrUndefined(headerWidget)){this.isHeader=true;this.isFooter=false;this.findInlineText(headerWidget,pattern,findOption,isFirstMatch,results,selectionEnd);}}for(var i=0;i<this.documentHelper.pages.length;i++){var footerWidget=this.documentHelper.pages[i].footerWidget;if(!sf.base.isNullOrUndefined(footerWidget)){this.isHeader=false;this.isFooter=true;this.findInlineText(footerWidget,pattern,findOption,isFirstMatch,results,selectionEnd);}}if(isFirstMatch&&!sf.base.isNullOrUndefined(results)&&results.length>0){return;}};// eslint-disable-next-line max-len
TextSearch.prototype.findInlineText=function(section,pattern,findOption,isFirstMatch,results,selectionEnd){var paragraphWidget=this.owner.selection.getFirstParagraphBlock(section.childWidgets[0]);// eslint-disable-next-line max-len
while(!sf.base.isNullOrUndefined(paragraphWidget)&&paragraphWidget.childWidgets.length===1&&paragraphWidget.childWidgets[0].children.length===0){paragraphWidget=this.owner.selection.getNextParagraphBlock(paragraphWidget);}while(!sf.base.isNullOrUndefined(paragraphWidget)&&paragraphWidget.childWidgets.length>0){var inlineElement=paragraphWidget.childWidgets[0];var inlineEle=inlineElement.children[0];if(sf.base.isNullOrUndefined(inlineEle)){break;}this.findInline(inlineEle,pattern,findOption,0,isFirstMatch,results,selectionEnd);paragraphWidget=this.owner.selection.getNextParagraphBlock(paragraphWidget);// eslint-disable-next-line max-len
while(!sf.base.isNullOrUndefined(paragraphWidget)&&paragraphWidget.childWidgets.length===1&&paragraphWidget.childWidgets[0].children.length===0){paragraphWidget=this.owner.selection.getNextParagraphBlock(paragraphWidget);}}if(isFirstMatch&&!sf.base.isNullOrUndefined(results)&&results.length>0){return;}};// eslint-disable-next-line max-len
TextSearch.prototype.findInline=function(inlineElement,pattern,option,indexInInline,isFirstMatch,results,selectionEnd){var inlines=inlineElement;var textInfo=this.getElementInfo(inlineElement,indexInInline);var text=textInfo.fullText;var matches=[];var spans=textInfo.elementsWithOffset;var matchObject;// eslint-disable-next-line no-cond-assign
while(!sf.base.isNullOrUndefined(matchObject=pattern.exec(text))){matches.push(matchObject);}this.updateMatchedTextLocation(matches,results,spans,indexInInline,inlines,isFirstMatch,selectionEnd);if(isFirstMatch){return undefined;}// eslint-disable-next-line max-len
var paragraphWidget=this.owner.selection.getNextParagraphBlock(inlineElement.line.paragraph);return paragraphWidget;};TextSearch.prototype.getTextPosition=function(lineWidget,hierarchicalIndex){var textPosition=new TextPosition(this.owner);var index=textPosition.getHierarchicalIndex(lineWidget,hierarchicalIndex);textPosition.setPositionForCurrentIndex(index);return textPosition;};return TextSearch;}();/**
 * @private
 */var SearchWidgetInfo=/** @class */function(){function SearchWidgetInfo(left,width){this.leftInternal=0;this.widthInternal=0;this.leftInternal=left;this.widthInternal=width;}Object.defineProperty(SearchWidgetInfo.prototype,"left",{get:function get(){return this.leftInternal;},set:function set(value){this.leftInternal=value;},enumerable:true,configurable:true});Object.defineProperty(SearchWidgetInfo.prototype,"width",{get:function get(){return this.widthInternal;},set:function set(value){this.widthInternal=value;},enumerable:true,configurable:true});return SearchWidgetInfo;}();/**
 * @private
 */var TextSearchResult=/** @class */function(){function TextSearchResult(owner){this.startIn=undefined;this.endIn=undefined;this.owner=owner;this.documentHelper=this.owner.documentHelper;}Object.defineProperty(TextSearchResult.prototype,"start",{get:function get(){return this.startIn;},set:function set(value){this.startIn=value;},enumerable:true,configurable:true});Object.defineProperty(TextSearchResult.prototype,"end",{get:function get(){return this.endIn;},set:function set(value){this.endIn=value;},enumerable:true,configurable:true});Object.defineProperty(TextSearchResult.prototype,"text",{get:function get(){return this.documentHelper.selection.getTextInternal(this.start,this.end,false);},enumerable:true,configurable:true});TextSearchResult.prototype.destroy=function(){this.start=undefined;this.end=undefined;};return TextSearchResult;}();/**
 * @private
 */var TextSearchResults=/** @class */function(){function TextSearchResults(owner){this.currentIndex=-1;this.owner=owner;}Object.defineProperty(TextSearchResults.prototype,"length",{get:function get(){if(this.innerList===undefined){return 0;}return this.innerList.length;},enumerable:true,configurable:true});Object.defineProperty(TextSearchResults.prototype,"currentSearchResult",{get:function get(){if(this.innerList===undefined||this.currentIndex<0||this.currentIndex>=this.length){return undefined;}return this.innerList[this.currentIndex];},enumerable:true,configurable:true});TextSearchResults.prototype.addResult=function(){var textSearchResult=new TextSearchResult(this.owner);if(sf.base.isNullOrUndefined(this.innerList)){this.innerList=[];}this.innerList.push(textSearchResult);return textSearchResult;};TextSearchResults.prototype.clearResults=function(){this.currentIndex=-1;if(!sf.base.isNullOrUndefined(this.innerList)){for(var i=this.innerList.length-1;i>=0;i--){this.innerList[i].destroy();this.innerList.splice(i,1);}}};TextSearchResults.prototype.indexOf=function(result){if(sf.base.isNullOrUndefined(this.innerList)){return-1;}return this.innerList.indexOf(result);};TextSearchResults.prototype.destroy=function(){if(!sf.base.isNullOrUndefined(this.innerList)){this.clearResults();}this.innerList=undefined;};return TextSearchResults;}();/**
 * Search Result info
 */var SearchResults=/** @class */function(){function SearchResults(search){this.searchModule=search;}Object.defineProperty(SearchResults.prototype,"length",{/**
         * Gets the length of search results.
         *
         * @aspType int
         * @blazorType int
         * @returns {number} - Returns search results length.
         */get:function get(){return this.searchModule.textSearchResults.length;},enumerable:true,configurable:true});Object.defineProperty(SearchResults.prototype,"index",{/**
         * Gets the index of current search result.
         *
         * @aspType int
         * @blazorType int
         * @returns {number} - Returns current search result index.
         */get:function get(){return this.searchModule.textSearchResults.currentIndex;},/**
         * Set the index of current search result.
         *
         * @param {number} value - Specifies the search result index.
         * @aspType int
         * @blazorType int
         */set:function set(value){if(this.length===0||value<0||value>this.searchModule.textSearchResults.length-1){return;}this.searchModule.textSearchResults.currentIndex=value;this.navigate();},enumerable:true,configurable:true});/**
     * Get start and end offset of searched text results.
     *
     * @returns {TextSearchResults[]} - Returns the text search results.
     */SearchResults.prototype.getTextSearchResultsOffset=function(){var index=[];var searchIndex;for(var i=0;i<this.searchModule.textSearchResults.innerList.length;i++){searchIndex=this.getOffset(this.searchModule.textSearchResults.innerList[i]);index.push(searchIndex);}return index;};SearchResults.prototype.getOffset=function(innerList){var start=innerList.start;var end=innerList.end;var blockInfo=this.searchModule.documentHelper.owner.selection.getParagraphInfo(start);// eslint-disable-next-line max-len
var startIndex=this.searchModule.documentHelper.owner.selection.getHierarchicalIndex(blockInfo.paragraph,blockInfo.offset.toString());blockInfo=this.searchModule.documentHelper.owner.selection.getParagraphInfo(end);// eslint-disable-next-line max-len
var endIndex=this.searchModule.documentHelper.owner.selection.getHierarchicalIndex(blockInfo.paragraph,blockInfo.offset.toString());return{'startOffset':startIndex,'endOffset':endIndex};};SearchResults.prototype.getModuleName=function(){return'SearchResults';};/**
     * Replace text in current search result.
     *
     * @private
     * @param {string} textToReplace - text to replace
     * @returns {void}
     */SearchResults.prototype.replace=function(textToReplace){if(this.index===-1){return;}this.searchModule.replaceInternal(textToReplace);};/**
     * Replace all the instance of search result.
     *
     * @param {string} textToReplace text to replace
     * @returns {void}
     */SearchResults.prototype.replaceAll=function(textToReplace){if(this.index===-1){return;}this.searchModule.replaceAllInternal(textToReplace);};/**
     * @private
     * @returns {void}
     */SearchResults.prototype.navigate=function(){this.searchModule.navigate(this.searchModule.textSearchResults.currentSearchResult);this.searchModule.highlight(this.searchModule.textSearchResults);};/**
     * Clears all the instance of search result.
     *
     * @returns {void}
     */SearchResults.prototype.clear=function(){this.searchModule.textSearchResults.clearResults();this.searchModule.clearSearchHighlight();this.searchModule.viewer.renderVisiblePages();};return SearchResults;}();/**
 * Search module
 */var Search=/** @class */function(){function Search(owner){/**
         * @private
         */this.searchHighlighters=undefined;this.isHandledOddPageHeader=undefined;this.isHandledEvenPageHeader=undefined;this.isHandledOddPageFooter=undefined;this.isHandledEvenPageFooter=undefined;this.owner=owner;this.searchHighlighters=new Dictionary();this.textSearch=new TextSearch(this.owner);this.textSearchResults=new TextSearchResults(this.owner);this.searchResultsInternal=new SearchResults(this);}Object.defineProperty(Search.prototype,"viewer",{get:function get(){return this.owner.viewer;},enumerable:true,configurable:true});Object.defineProperty(Search.prototype,"searchResults",{/**
         * Gets the search results object.
         *
         * @aspType SearchResults
         * @blazorType SearchResults
         * @returns {SearchResults} - Returns the search results object.
         */get:function get(){return this.searchResultsInternal;},enumerable:true,configurable:true});Object.defineProperty(Search.prototype,"documentHelper",{get:function get(){return this.owner.documentHelper;},enumerable:true,configurable:true});Search.prototype.getModuleName=function(){return'Search';};//#region Find & Find All
/**
     * Finds the immediate occurrence of specified text from cursor position in the document.
     *
     * @param {string} text - Specifies text to find.
     * @param {FindOption} findOptions - Default value of findOptions parameter is 'None'.
     * @returns {void}
     */Search.prototype.find=function(text,findOptions){if(sf.base.isNullOrUndefined(findOptions)){findOptions='None';}var result=this.textSearch.find(text,findOptions);if(!sf.base.isNullOrUndefined(result)){this.navigate(result);}};/**
     * Finds all occurrence of specified text in the document.
     *
     * @param {string} text - Specifies text to find.
     * @param {FindOption} findOptions - Default value of findOptions parameter is 'None'.
     * @returns {void}
     */Search.prototype.findAll=function(text,findOptions){if(sf.base.isNullOrUndefined(text||text==='')){return;}if(sf.base.isNullOrUndefined(findOptions)){findOptions='None';}var results=this.textSearch.findAll(text,findOptions);if(!sf.base.isNullOrUndefined(results)&&results.length>0){this.navigate(results.innerList[results.currentIndex]);this.highlight(results);}};//#endregion
//#region Replace and Replace All   
/**
     * Replace the searched string with specified string
     *
     * @private
     * @param  {string} replaceText  - Specifies text to replace.
     * @param  {TextSearchResult} result - Specifies the result.
     * @param  {TextSearchResults} results - Specifies the results.
     * @returns {number} - Returns replaced text count.
     */Search.prototype.replace=function(replaceText,result,results){if(sf.base.isNullOrUndefined(this.viewer.owner)||this.viewer.owner.isReadOnlyMode||sf.base.isNullOrUndefined(results)){return 0;}if(!sf.base.isNullOrUndefined(this.viewer)){this.clearSearchHighlight();}this.navigate(result);var endPosition=this.documentHelper.selection.start;if(this.owner.enableTrackChanges&&this.documentHelper.selection.start.currentWidget){var inline=undefined;// eslint-disable-next-line max-len
var inlineElement=this.documentHelper.selection.end.currentWidget.getInline(this.owner.selection.start.offset,0);inline=inlineElement.element;if(inline.revisions.length>0){this.isRepalceTracking=true;}}var index=results.indexOf(result);if(index<0){return 0;}this.owner.editorModule.insertTextInternal(replaceText,true);var endTextPosition=result.end;var startPosition=new TextPosition(this.viewer.owner);startPosition.setPositionParagraph(endTextPosition.currentWidget,endPosition.offset-replaceText.length);this.documentHelper.selection.selectRange(endPosition,startPosition);var eventArgs={source:this.viewer.owner};this.owner.dotNetRef.invokeMethodAsync("SearchResultsChange");return 1;};/**
     * Find the textToFind string in current document and replace the specified string.
     *
     * @private
     * @param {string} textToReplace - Specifies the text to replace.
     * @param {FindOption} findOptions - Default value of findOptions parameter is FindOption.None.
     * @returns {void}
     */Search.prototype.replaceInternal=function(textToReplace,findOptions){if(textToReplace===''||sf.base.isNullOrUndefined(textToReplace)){return;}if(sf.base.isNullOrUndefined(findOptions)){findOptions='None';}var textToFind=this.textSearchResults.currentSearchResult.text;var pattern=this.viewer.owner.searchModule.textSearch.stringToRegex(textToFind,findOptions);var index=this.owner.selection.end.getHierarchicalIndexInternal();var result=this.viewer.owner.searchModule.textSearch.findNext(pattern,findOptions,index);if(!sf.base.isNullOrUndefined(result)){this.navigate(result);this.textSearchResults.addResult();this.textSearchResults.innerList[0]=result;this.replace(textToReplace,result,this.textSearchResults);index=this.owner.selection.end.getHierarchicalIndexInternal();result=this.textSearch.findNext(textToFind,findOptions,index);if(result){this.textSearchResults.addResult();this.textSearchResults.innerList[0]=result;this.navigate(result);}}};/**
     * Replace all the searched string with specified string
     *
     * @private
     * @param  {string} replaceText - Specifies the replace text.
     * @param  {TextSearchResults} results - Specfies the results.
     * @returns {number} - Returns the replace count.
     */Search.prototype.replaceAll=function(replaceText,results){if(sf.base.isNullOrUndefined(this.viewer.owner)||this.viewer.owner.isReadOnlyMode||sf.base.isNullOrUndefined(results)){return 0;}if(this.owner.editorHistory){this.owner.editorHistory.initComplexHistory(this.owner.selection,'ReplaceAll');}var count=results.length;this.viewer.owner.isLayoutEnabled=false;for(var i=count-1;i>=0;i--){var result=results.innerList[i];this.navigate(results.innerList[i]);this.owner.editorModule.insertTextInternal(replaceText,true);if(result.isHeader||result.isFooter){// eslint-disable-next-line max-len
this.documentHelper.layout.updateHeaderFooterToParent(this.documentHelper.selection.start.paragraph.bodyWidget);}results.innerList[i].destroy();}if(this.owner.editorHistory&&!sf.base.isNullOrUndefined(this.owner.editorHistory.currentHistoryInfo)){this.owner.editorHistory.updateComplexHistory();}else{this.owner.editorModule.updateComplexWithoutHistory(2);}this.searchResults.clear();return count;};/**
     * Find the textToFind string in current document and replace the specified string.
     *
     * @private
     * @param {string} textToReplace - Specifies the text to replace.
     * @param {FindOption} findOptions - Default value of findOptions parameter is FindOption.None.
     * @returns {void}
     */Search.prototype.replaceAllInternal=function(textToReplace,findOptions){if(sf.base.isNullOrUndefined(textToReplace)){return;}if(sf.base.isNullOrUndefined(findOptions)){findOptions='None';}if(this.textSearchResults.length>0){this.navigate(this.textSearchResults.innerList[this.textSearchResults.currentIndex]);this.highlight(this.textSearchResults);this.replaceAll(textToReplace,this.textSearchResults);}};//#endregion
//#region Highlight Search Result
/**
     * @private
     * @param {TextSearchResult} textSearchResult - Specifies the text search results.
     * @returns {void}
     */Search.prototype.navigate=function(textSearchResult){if(textSearchResult){var start=textSearchResult.start;var end=textSearchResult.end;if(!sf.base.isNullOrUndefined(this.owner)&&!sf.base.isNullOrUndefined(this.owner.selection)&&!sf.base.isNullOrUndefined(start)&&!sf.base.isNullOrUndefined(end)&&!sf.base.isNullOrUndefined(start.paragraph)&&!sf.base.isNullOrUndefined(end.paragraph)){this.owner.selection.selectRange(start,end);}}};/**
     * @private
     * @param {TextSearchResults} textSearchResults - Specifies the text search results.
     * @returns {void}
     */Search.prototype.highlight=function(textSearchResults){this.searchHighlighters=new Dictionary();for(var i=0;i<textSearchResults.innerList.length;i++){var result=textSearchResults.innerList[i];this.highlightResult(result);}this.viewer.renderVisiblePages();};Search.prototype.highlightResult=function(result){this.highlightSearchResult(result.start.paragraph,result.start,result.end);};/* eslint-disable  */Search.prototype.highlightSearchResult=function(paragraph,start,end){var selectionStartIndex=0;var selectionEndIndex=0;var startElement=null;var endElement=null;var lineWidget=this.documentHelper.selection.getStartLineWidget(paragraph,start,startElement,selectionStartIndex);selectionStartIndex=lineWidget.index;startElement=lineWidget.element;var startLineWidget=startElement?startElement.line:paragraph.childWidgets[0];var endLine=this.documentHelper.selection.getEndLineWidget(end,endElement,selectionEndIndex);selectionEndIndex=endLine.index;endElement=endLine.element;var endLineWidget=endElement?endElement.line:end.paragraph.childWidgets[end.paragraph.childWidgets.length-1];var top=this.documentHelper.selection.getTop(startLineWidget);var left=this.documentHelper.selection.getLeftInternal(startLineWidget,startElement,selectionStartIndex);if(!sf.base.isNullOrUndefined(startLineWidget)&&startLineWidget===endLineWidget){//find result ends in current line.
var right=this.documentHelper.selection.getLeftInternal(endLineWidget,endElement,selectionEndIndex);var isRtlText=false;if(endElement instanceof TextElementBox){isRtlText=endElement.isRightToLeft;}var width=0;width=Math.abs(right-left);if(!isRtlText&&startElement instanceof TextElementBox){isRtlText=startElement.isRightToLeft;}// Handled the highlighting approach as genric for normal and rtl text.
if(isRtlText||paragraph.bidi){var elementBox=this.documentHelper.selection.getElementsForward(startLineWidget,startElement,endElement,paragraph.bidi);if(elementBox&&elementBox.length>1){for(var i=0;i<elementBox.length;i++){var element=elementBox[i];var elementIsRTL=false;var index=element instanceof TextElementBox?element.length:1;if(element===startElement){left=this.documentHelper.selection.getLeftInternal(startLineWidget,element,selectionStartIndex);right=this.documentHelper.selection.getLeftInternal(startLineWidget,element,index);}else if(element===endElement){left=this.documentHelper.selection.getLeftInternal(startLineWidget,element,0);right=this.documentHelper.selection.getLeftInternal(startLineWidget,element,selectionEndIndex);}else{left=this.documentHelper.selection.getLeftInternal(startLineWidget,element,0);right=this.documentHelper.selection.getLeftInternal(startLineWidget,element,index);}if(element instanceof TextElementBox){elementIsRTL=element.isRightToLeft;}width=Math.abs(right-left);this.createHighlightBorder(startLineWidget,width,elementIsRTL?right:left,top);}}else{this.createHighlightBorder(startLineWidget,width,isRtlText?right:left,top);}}else{// Start element and end element will be in reverese for Bidi paragraph highlighting. 
// So, the right is considered based on Bidi property. 
this.createHighlightBorder(startLineWidget,width,left,top);}}else{if(!sf.base.isNullOrUndefined(startLineWidget)){if(paragraph!==startLineWidget.paragraph){paragraph=startLineWidget.paragraph;}var width=this.documentHelper.selection.getWidth(startLineWidget,true)-(left-startLineWidget.paragraph.x);// Handled the  highlighting approach as genric for normal and rtl text.
if(paragraph.bidi||startElement instanceof TextElementBox&&startElement.isRightToLeft){var right=0;var elementCollection=this.documentHelper.selection.getElementsForward(startLineWidget,startElement,endElement,paragraph.bidi);if(elementCollection){var elementIsRTL=false;for(var i=0;i<elementCollection.length;i++){var element=elementCollection[i];var index=element instanceof TextElementBox?element.length:1;right=this.documentHelper.selection.getLeftInternal(startLineWidget,element,index);elementIsRTL=false;if(element===startElement){left=this.documentHelper.selection.getLeftInternal(startLineWidget,element,selectionStartIndex);}else{left=this.documentHelper.selection.getLeftInternal(startLineWidget,element,0);}if(element instanceof TextElementBox){elementIsRTL=element.isRightToLeft;}width=Math.abs(right-left);this.createHighlightBorder(startLineWidget,width,elementIsRTL?right:left,top);}// Highlight the Paragrph mark for last line.
}}else{this.createHighlightBorder(startLineWidget,width,left,top);}var lineIndex=startLineWidget.paragraph.childWidgets.indexOf(startLineWidget);//Iterates to last item of paragraph or search result end.
for(var i=0;i<paragraph.childWidgets.length;i++){if(paragraph===startLineWidget.paragraph){lineIndex+=1;}this.highlightSearchResultParaWidget(paragraph,lineIndex,endLineWidget,endElement,selectionEndIndex);if(paragraph===endLineWidget.paragraph){return;}else{lineIndex=0;}}}}};Search.prototype.createHighlightBorder=function(lineWidget,width,left,top){var findHighLight=this.addSearchHighlightBorder(lineWidget);var page=this.viewer.owner.selection.getPage(lineWidget.paragraph);var pageTop=page.boundingRectangle.y;var pageLeft=page.boundingRectangle.x;findHighLight.left=Math.ceil(left);top=Math.ceil(top);findHighLight.width=Math.floor(width);var height=Math.floor(lineWidget.height);var context=this.documentHelper.containerContext;};Search.prototype.addSearchHighlightBorder=function(lineWidget){var highlighters=undefined;var collection=this.searchHighlighters;if(collection.containsKey(lineWidget)){highlighters=collection.get(lineWidget);}else{highlighters=[];collection.add(lineWidget,highlighters);}var searchHighlight=new SearchWidgetInfo(0,0);highlighters.push(searchHighlight);return searchHighlight;};Search.prototype.highlightSearchResultParaWidget=function(widget,startIndex,endLine,endElement,endIndex){var top=0;var width=0;var isRtlText=false;for(var j=startIndex;j<widget.childWidgets.length;j++){var lineWidget=widget.childWidgets[j];if(j===startIndex){top=this.documentHelper.selection.getTop(lineWidget);}var left=this.documentHelper.selection.getLeft(lineWidget);if(endElement instanceof TextElementBox){isRtlText=endElement.isRightToLeft;}if(lineWidget===endLine){//Selection ends in current line.
var right=0;// Handled the highlighting using the element box highlighting approach as genric for normal and rtl text.
if(isRtlText||widget.bidi){var elementBox=this.documentHelper.selection.getElementsBackward(lineWidget,endElement,endElement,widget.bidi);for(var i=0;i<elementBox.length;i++){var element=elementBox[i];var elementIsRTL=false;left=this.documentHelper.selection.getLeftInternal(lineWidget,element,0);if(element===endElement){right=this.documentHelper.selection.getLeftInternal(lineWidget,element,endIndex);}else{var index=element instanceof TextElementBox?element.length:1;right=this.documentHelper.selection.getLeftInternal(lineWidget,element,index);}if(element instanceof TextElementBox){elementIsRTL=element.isRightToLeft;}width=Math.abs(right-left);this.createHighlightBorder(lineWidget,width,elementIsRTL?right:left,top);}return;}else{right=this.documentHelper.selection.getLeftInternal(endLine,endElement,endIndex);width=Math.abs(right-left);this.createHighlightBorder(lineWidget,width,isRtlText?right:left,top);return;}}else{width=this.documentHelper.selection.getWidth(lineWidget,true)-(left-widget.x);this.createHighlightBorder(lineWidget,width,left,top);top+=lineWidget.height;}}};//#endregion
//#region Get find result view
/**
     * @private
     * @param {string} result - Specified the result.
     * @returns {void}
     */Search.prototype.addSearchResultItems=function(result){if(sf.base.isNullOrUndefined(result)||result===''){return;}if(sf.base.isNullOrUndefined(this.owner.findResultsList)){this.owner.findResultsList=[];}this.owner.findResultsList.push(result);};/**
     * @private
     * @param {TextSearchResults} textSearchResults - Specified text search result.
     * @returns {void}
     */Search.prototype.addFindResultView=function(textSearchResults){for(var i=0;i<textSearchResults.innerList.length;i++){var result=textSearchResults.innerList[i];this.addFindResultViewForSearch(result);}this.isHandledOddPageHeader=true;this.isHandledOddPageFooter=true;this.isHandledEvenPageHeader=true;this.isHandledEvenPageFooter=true;};/**
     * @private
     * @returns {void}
     */ /* eslint-disable  */Search.prototype.addFindResultViewForSearch=function(result){if(result.start!=null&&result.end!=null&&result.start.paragraph!=null&&result.end.paragraph!=null){var prefixText=void 0;var suffixtext=void 0;var currentText=void 0;var startIndex=0;var inlineObj=result.start.currentWidget.getInline(result.start.offset,startIndex);var inline=inlineObj.element;startIndex=inlineObj.index;var prefix='';var lastIndex=0;if(inline instanceof FieldElementBox){var elementInfo=this.owner.selection.getRenderedInline(inline,startIndex);if(elementInfo.element.nextNode instanceof TextElementBox){inline=elementInfo.element.nextNode;startIndex=elementInfo.index;}else{inline=elementInfo.element;startIndex=elementInfo.index;}}var boxObj=this.owner.selection.getElementBoxInternal(inline,startIndex);var box=boxObj.element;startIndex=boxObj.index;if(box!=null){if(box instanceof TextElementBox&&startIndex>0){prefix=box.text.substring(0,startIndex);}var boxIndex=box.line.children.indexOf(box);lastIndex=prefix.lastIndexOf(' ');while(lastIndex<0&&boxIndex>0&&box.line.children[boxIndex-1]instanceof TextElementBox){prefix=box.line.children[boxIndex-1].text+prefix;boxIndex--;lastIndex=prefix.lastIndexOf(' ');}}var shiftIndex=prefix.lastIndexOf('\v');if(shiftIndex>0){prefix=prefix.substring(0,shiftIndex);}else{lastIndex=prefix.lastIndexOf(' ');prefixText=lastIndex<0?prefix:prefix.substring(lastIndex+1);}currentText=result.text;var endIndex=0;var endInlineObj=result.end.currentWidget.getInline(result.end.offset,endIndex);var endInline=endInlineObj.element;endIndex=endInlineObj.index;suffixtext='';//Checks prefix element box is empty
if(boxObj!=null){// Gets the element box using endIndex of the text and set as suffix
boxObj=this.owner.selection.getElementBoxInternal(endInline,endIndex);box=boxObj.element;endIndex=boxObj.index;}//Checks suffix element box is empty.
if(box!=null){if(box instanceof TextElementBox&&endIndex<box.length){suffixtext=box.text.substring(endIndex);}var boxIndex=box.line.children.indexOf(box);while(boxIndex+1<box.line.children.length&&box.line.children[boxIndex+1]instanceof TextElementBox||box.line.children[boxIndex+1]instanceof FieldElementBox){if(box.line.children[boxIndex+1]instanceof FieldElementBox){boxIndex=boxIndex+2;}else{suffixtext=suffixtext+box.line.children[boxIndex+1].text;boxIndex=boxIndex+1;}}}lastIndex=suffixtext.lastIndexOf(' ');suffixtext=suffixtext==='\v'?suffixtext='':suffixtext;var headerFooterString='';if(result.isHeader){headerFooterString='<span class="e-de-header-footer-list">'+'Header'+': '+'</span>';}else if(result.isFooter){headerFooterString='<span class="e-de-header-footer-list">'+'Footer'+': '+'</span>';}else{headerFooterString='';headerFooterString='';this.isHandledOddPageHeader=true;this.isHandledEvenPageHeader=true;this.isHandledOddPageFooter=true;this.isHandledEvenPageFooter=true;}var listElement='';var page=result.documentHelper.selection.getPage(result.start.paragraph);if(sf.base.isNullOrUndefined(this.isHandledEvenPageHeader)&&sf.base.isNullOrUndefined(this.isHandledEvenPageFooter)){this.isHandledEvenPageHeader=true;this.isHandledEvenPageFooter=true;}else if(sf.base.isNullOrUndefined(this.isHandledOddPageHeader)&&sf.base.isNullOrUndefined(this.isHandledOddPageFooter)){this.isHandledOddPageHeader=true;this.isHandledOddPageFooter=true;}if(result.isHeader){if(page.headerWidget.headerFooterType==='FirstPageHeader'&&page.bodyWidgets[0].sectionFormat.differentFirstPage){listElement='<li tabindex=0 class="e-de-search-result-item e-de-op-search-txt">'+headerFooterString+prefix+'<span class="e-de-op-search-word" style="pointer-events:none">'+result.text+'</span>'+suffixtext+'</li>';}else if(page.headerWidget.headerFooterType==='EvenHeader'&&this.isHandledEvenPageHeader){listElement='<li tabindex=0 class="e-de-search-result-item e-de-op-search-txt">'+headerFooterString+prefix+'<span class="e-de-op-search-word" style="pointer-events:none">'+result.text+'</span>'+suffixtext+'</li>';this.isHandledEvenPageHeader=false;}else if(page.headerWidget.headerFooterType==='OddHeader'&&this.isHandledOddPageHeader){listElement='<li tabindex=0 class="e-de-search-result-item e-de-op-search-txt">'+headerFooterString+prefix+'<span class="e-de-op-search-word" style="pointer-events:none">'+result.text+'</span>'+suffixtext+'</li>';this.isHandledOddPageHeader=false;}}else if(result.isFooter){if(page.footerWidget.headerFooterType==='FirstPageFooter'&&page.bodyWidgets[0].sectionFormat.differentFirstPage){listElement='<li tabindex=0 class="e-de-search-result-item e-de-op-search-txt">'+headerFooterString+prefix+'<span class="e-de-op-search-word" style="pointer-events:none">'+result.text+'</span>'+suffixtext+'</li>';}else if(page.footerWidget.headerFooterType==='EvenFooter'&&this.isHandledEvenPageFooter){listElement='<li tabindex=0 class="e-de-search-result-item e-de-op-search-txt">'+headerFooterString+prefix+'<span class="e-de-op-search-word" style="pointer-events:none">'+result.text+'</span>'+suffixtext+'</li>';this.isHandledEvenPageFooter=false;}else if(page.footerWidget.headerFooterType==='OddFooter'&&this.isHandledOddPageFooter){listElement='<li tabindex=0 class="e-de-search-result-item e-de-op-search-txt">'+headerFooterString+prefix+'<span class="e-de-op-search-word" style="pointer-events:none">'+result.text+'</span>'+suffixtext+'</li>';this.isHandledOddPageFooter=false;}}else if(!result.isHeader&&!result.isFooter){listElement='<li tabindex=0 class="e-de-search-result-item e-de-op-search-txt">'+headerFooterString+prefix+'<span class="e-de-op-search-word" style="pointer-events:none">'+result.text+'</span>'+suffixtext+'</li>';}this.addSearchResultItems(listElement);}};//#endregion
/**
     * Clears search highlight.
     *
     * @private
     * @returns {void}
     */Search.prototype.clearSearchHighlight=function(){if(!sf.base.isNullOrUndefined(this.searchHighlighters)){this.searchHighlighters.clear();this.searchHighlighters=undefined;}var eventArgs={source:this.viewer.owner};this.owner.dotNetRef.invokeMethodAsync("SearchResultsChange");//this.viewer.owner.trigger('searchResultsChange', eventArgs);
};/**
     * @private
     * @returns {void}
     */Search.prototype.destroy=function(){if(this.textSearchResults){this.textSearchResults.destroy();}};return Search;}();var OptionsPane=/** @class */function(){function OptionsPane(){}return OptionsPane;}();// import { LayoutViewer, DocumentHelper } from '../index';
// import { TextSearchResults } from './text-search-results';
// import { TextSearchResult } from './text-search-result';
// import { createElement, isNullOrUndefined, L10n, classList } from '@syncfusion/ej2-base';
// import { FindOption } from '../../base/types';
// import { TextPosition } from '../selection/selection-helper';
// import { HelperMethods } from '../editor/editor-helper';
// import { CheckBox, ChangeEventArgs } from '@syncfusion/ej2-buttons';
// import { Tab, SelectEventArgs, TabItemModel } from '@syncfusion/ej2-navigations';
// /**
//  * Options Pane class.
//  */
// export class OptionsPane {
//     private documentHelper: DocumentHelper;
//     /**
//      * @private
//      */
//     public optionsPane: HTMLElement;
//     /**
//      * @private
//      */
//     public isOptionsPaneShow: boolean = false;
//     private resultsListBlock: HTMLElement;
//     private messageDiv: HTMLElement;
//     private results: TextSearchResults;
//     private searchInput: HTMLInputElement;
//     private searchDiv: HTMLElement;
//     private searchTextBoxContainer: HTMLElement;
//     private replaceWith: HTMLInputElement;
//     private findDiv: HTMLElement;
//     private replaceDiv: HTMLElement;
//     private replaceButton: HTMLElement;
//     private replaceAllButton: HTMLElement;
//     private occurrenceDiv: HTMLElement;
//     private findOption: FindOption = 'None';
//     private matchCase: CheckBox = undefined;
//     private wholeWord: CheckBox = undefined;
//     // private regular: CheckBox = undefined;
//     private searchText: string = 'Navigation';
//     private resultsText: string = 'Results';
//     private messageDivText: string = 'No matches';
//     private replaceButtonText: string = 'Replace';
//     private replaceAllButtonText: string = 'Replace All';
//     private focusedIndex: number = -1;
//     private focusedElement: HTMLElement[] = [];
//     private resultContainer: HTMLElement;
//     private navigateToPreviousResult: HTMLElement;
//     private navigateToNextResult: HTMLElement;
//     private closeButton: HTMLElement;
//     private isOptionsPane: Boolean = true;
//     private findTab: HTMLElement;
//     private findTabButton: HTMLElement;
//     private replaceTabButton: HTMLElement;
//     private searchIcon: HTMLSpanElement;
//     private matchDiv: HTMLElement;
//     private replacePaneText: string = 'Replace';
//     private findPaneText: string = 'Find';
//     private matchDivReplaceText: string = 'No matches';
//     private matchInput: HTMLInputElement;
//     private wholeInput: HTMLInputElement;
//     private regularInput: HTMLInputElement;
//     /**
//      * @private
//      */
//     public tabInstance: Tab = undefined;
//     private findTabContentDiv: HTMLElement;
//     private replaceTabContentDiv: HTMLElement;
//     /**
//      * @private
//      */
//     public isReplace: boolean = false;
//     private localeValue: L10n;
//     /**
//      * Constructor for Options pane module
//      * @private
//      */
//     constructor(documentHelper: DocumentHelper) {
//         this.documentHelper = documentHelper;
//     }
//     get viewer(): LayoutViewer {
//         return this.documentHelper.owner.viewer;
//     }
//     /**
//      * Get the module name.
//      */
//     private getModuleName(): string {
//         return 'OptionsPane';
//     }
//     /**
//      * Initialize the options pane.
//      * @param {L10n} localeValue - Specifies the localization based on culture.
//      * @private
//      */
//     // tslint:disable:max-func-body-length
//     public initOptionsPane(localeValue: L10n, isRtl?: boolean): void {
//         let viewer: LayoutViewer = this.viewer;
//         this.localeValue = localeValue;
//         this.optionsPane = createElement('div', { className: 'e-de-op', styles: 'display:none;' });
//         this.optionsPane.addEventListener('keydown', this.onKeyDownOnOptionPane);
//         this.searchDiv = createElement('div', {
//             className: this.documentHelper.owner.containerId + '_searchDiv e-de-op-header',
//             innerHTML: localeValue.getConstant(this.searchText)
//         });
//         this.optionsPane.appendChild(this.searchDiv);
//         // tslint:disable-next-line:max-line-length
//         this.closeButton = createElement('button', {
//             className: 'e-de-op-close-button e-de-close-icon e-de-op-icon-btn e-btn e-flat e-icon-btn', id: 'close',
//             attrs: { type: 'button' }
//         });
//         this.optionsPane.appendChild(this.closeButton);
//         let closeSpan: HTMLSpanElement = createElement('span', { className: 'e-de-op-close-icon e-de-close-icon e-btn-icon e-icons' });
//         this.closeButton.appendChild(closeSpan);
//         this.focusedElement.push(this.closeButton);
//         //Find tab header
//         this.findTab = createElement('div', { id: this.documentHelper.owner.containerId + '_findTabDiv', className: 'e-de-op-tab' });
//         this.optionsPane.appendChild(this.findTab);
//         this.findTabButton = createElement('div', { innerHTML: localeValue.getConstant(this.findPaneText) });
//         this.replaceTabButton = createElement('div', { innerHTML: localeValue.getConstant(this.replacePaneText) });
//         let findTabContent: HTMLElement = createElement('div');
//         this.findTabContentDiv = createElement('div', { className: 'e-de-search-tab-content' });
//         this.searchTextBoxContainer = createElement('div', { className: 'e-input-group e-de-op-input-group' });
//         this.findTabContentDiv.appendChild(this.searchTextBoxContainer);
//         // tslint:disable-next-line:max-line-length
//         this.searchInput = createElement('input', { className: 'e-input e-de-search-input', id: this.documentHelper.owner.containerId + '_option_search_text_box', attrs: { placeholder: localeValue.getConstant('Search for') } }) as HTMLInputElement;
//         this.searchTextBoxContainer.appendChild(this.searchInput);
//         this.searchIcon = createElement('span', {
//             className: 'e-de-op-icon e-de-op-search-icon e-input-group-icon e-icon',
//             id: this.documentHelper.owner.containerId + '_search-icon'
//         });
//         this.searchIcon.tabIndex = 0;
//         this.searchTextBoxContainer.appendChild(this.searchIcon);
//         this.focusedElement.push(this.searchIcon);
//         // tslint:disable-next-line:max-line-length
//         this.navigateToPreviousResult = createElement('span', { className: 'e-de-op-icon e-de-op-nav-btn e-arrow-up e-spin-up e-btn-icon e-icon e-input-group-icon' });
//         this.navigateToPreviousResult.tabIndex = 0;
//         this.searchTextBoxContainer.appendChild(this.navigateToPreviousResult);
//         this.focusedElement.push(this.navigateToPreviousResult);
//         // tslint:disable-next-line:max-line-length
//         this.navigateToNextResult = createElement('span', { className: 'e-de-op-icon e-de-op-nav-btn e-arrow-down e-spin-down e-btn-icon e-icon e-input-group-icon' });
//         this.navigateToNextResult.tabIndex = 0;
//         this.searchTextBoxContainer.appendChild(this.navigateToNextResult);
//         this.focusedElement.push(this.navigateToNextResult);
//         let div: HTMLElement = createElement('div', { className: 'e-de-op-more-less' });
//         this.matchInput = createElement('input', {
//             attrs: { type: 'checkbox' },
//             id: this.documentHelper.owner.containerId + '_matchCase'
//         }) as HTMLInputElement;
//         div.appendChild(this.matchInput);
//         // tslint:disable-next-line:max-line-length
//         this.matchCase = new CheckBox({ label: localeValue.getConstant('Match case'), enableRtl: isRtl, checked: false, change: this.matchChange });
//         this.matchCase.appendTo(this.matchInput);
//         this.focusedElement.push(this.matchInput);
//         this.matchInput.tabIndex = 0;
//         let wholeWordLabel: string;
//         if (isRtl) {
//             wholeWordLabel = '_e-de-rtl';
//         } else {
//             wholeWordLabel = '_e-de-ltr';
//         }
//         this.wholeInput = createElement('input', {
//             attrs: { type: 'checkbox' },
//             id: this.documentHelper.owner.containerId + '_wholeWord' + wholeWordLabel
//         }) as HTMLInputElement;
//         div.appendChild(this.wholeInput);
//         // tslint:disable-next-line:max-line-length
//         this.wholeWord = new CheckBox({ label: localeValue.getConstant('Whole words'), enableRtl: isRtl, checked: false, change: this.wholeWordsChange });
//         this.wholeWord.appendTo(this.wholeInput);
//         this.focusedElement.push(this.wholeInput);
//         this.wholeInput.tabIndex = 0;
//         this.findTabContentDiv.appendChild(div);
//         //Replace tab
//         let replaceTabContent: HTMLElement = createElement('div');
//         this.replaceTabContentDiv = createElement('div', { className: 'e-de-op-replacetabcontentdiv', styles: 'display:none;' });
//         this.findTabContentDiv.appendChild(this.replaceTabContentDiv);
//         this.createReplacePane(isRtl);
//         this.findDiv = createElement('div', { className: 'findDiv', styles: 'display:block;' });
//         findTabContent.appendChild(this.findTabContentDiv);
//         this.resultContainer = createElement('div', { styles: 'width:85%;display:block;', className: 'e-de-op-result-container' });
//         this.findDiv.appendChild(this.resultContainer);
//         // tslint:disable-next-line:max-line-length
//         this.messageDiv = createElement('div', { className: this.documentHelper.owner.containerId + '_messageDiv e-de-op-msg', innerHTML: this.localeValue.getConstant(this.messageDivText), id: this.documentHelper.owner.containerId + '_search_status' });
//         this.resultContainer.appendChild(this.messageDiv);
//         // tslint:disable-next-line:max-line-length
//         this.resultsListBlock = createElement('div', { id: this.documentHelper.owner.containerId + '_list_box_container', styles: 'display:none;width:270px;list-style:none;padding-right:5px;overflow:auto;', className: 'e-de-result-list-block' });
//         this.findDiv.appendChild(this.resultsListBlock);
//         this.findTabContentDiv.appendChild(this.findDiv);
//         let items: TabItemModel[] = [
//             { header: { text: this.findTabButton }, content: findTabContent },
//             { header: { text: this.replaceTabButton }, content: replaceTabContent }] as TabItemModel[];
//         this.tabInstance = new Tab({ items: items, enableRtl: isRtl, selected: this.selectedTabItem });
//         this.tabInstance.isStringTemplate = true;
//         this.tabInstance.appendTo(this.findTab);
//         this.onWireEvents();
//         if (isRtl) {
//             this.optionsPane.classList.add('e-de-rtl');
//             this.closeButton.classList.add('e-de-rtl');
//             this.searchDiv.classList.add('e-de-rtl');
//         }
//     }
//     /**
//      * Create replace pane instances.
//      */
//     private createReplacePane(isRtl?: boolean): void {
//         this.replaceDiv = createElement('div');
//         this.replaceTabContentDiv.appendChild(this.replaceDiv);
//         this.replaceWith = createElement('input', {
//             className: 'e-de-op-replacewith e-input',
//             attrs: { placeholder: this.localeValue.getConstant('Replace with') }
//         }) as HTMLInputElement;
//         this.replaceDiv.appendChild(this.replaceWith);
//         let replaceButtonDivTextAlign: string;
//         let replaceButtonMargin: string;
//         if (isRtl) {
//             replaceButtonDivTextAlign = 'text-align:left';
//             replaceButtonMargin = 'margin-left:10px';
//         } else {
//             replaceButtonDivTextAlign = 'text-align:right';
//             replaceButtonMargin = 'margin-right:10px';
//         }
//         let replaceButtonDiv: HTMLElement = createElement('div', { styles: replaceButtonDivTextAlign, className: 'e-de-op-dlg-footer' });
//         this.replaceDiv.appendChild(replaceButtonDiv);
//         this.replaceButton = createElement('button', {
//             className: 'e-control e-btn e-flat e-replace',
//             styles: replaceButtonMargin,
//             innerHTML: this.localeValue.getConstant(this.replaceButtonText),
//             attrs: { type: 'button' }
//         });
//         replaceButtonDiv.appendChild(this.replaceButton);
//         this.replaceAllButton = createElement('button', {
//             className: 'e-control e-btn e-flat e-replaceall',
//             innerHTML: this.localeValue.getConstant(this.replaceAllButtonText),
//             attrs: { type: 'button' }
//         });
//         replaceButtonDiv.appendChild(this.replaceAllButton);
//         this.matchDiv = createElement('div', { styles: 'display:none;padding-top:10px;' });
//         this.replaceDiv.appendChild(this.matchDiv);
//         let emptyDiv6: HTMLElement = createElement('div', { className: 'e-de-op-search-replacediv' });
//         this.replaceDiv.appendChild(emptyDiv6);
//         this.occurrenceDiv = createElement('div', { styles: 'display:none;' });
//         this.replaceDiv.appendChild(this.occurrenceDiv);
//     }
//     /**
//      * Gets selected tab item which tab is selected.
//      * @param {SelectEventArgs} args - Specifies which tab will be opened.
//      * @private
//      */
//     public selectedTabItem = (args: SelectEventArgs): void => {
//         let contentParent: Element = this.findTab.getElementsByClassName('e-content').item(0);
//         if (args.previousIndex !== args.selectedIndex) {
//             let previousTab: Element = contentParent.children[0];
//             let nextTab: Element = contentParent.children[1];
//             let element: HTMLElement = previousTab.firstElementChild as HTMLElement;
//             if (element) {
//                 if (element.parentElement) {
//                     element.parentElement.removeChild(element);
//                 }
//                 nextTab.appendChild(element);
//             }
//         }
//         let selectedElement: Element = contentParent.children[0];
//         if (!isNullOrUndefined(selectedElement)) {
//             if (args.selectedIndex === 0) {
//                 this.isOptionsPane = true;
//                 this.onFindPane();
//             } else {
//                 this.isOptionsPane = false;
//                 this.onReplacePane();
//             }
//         }
//     }
//     private searchOptionChange = (): void => {
//         this.clearSearchResultItems();
//         this.documentHelper.owner.searchModule.clearSearchHighlight();
//         let inputText: string = this.searchInput.value;
//         if (inputText === '') {
//             return;
//         }
//         let pattern: RegExp = this.documentHelper.owner.searchModule.textSearch.stringToRegex(inputText, this.findOption);
//         let endSelection: TextPosition = this.documentHelper.selection.end;
//         let selectionIndex: string = endSelection.getHierarchicalIndexInternal();
//         this.results = this.documentHelper.owner.searchModule.textSearch.findAll(pattern, this.findOption, selectionIndex);
//         if (this.results != null && this.results.length > 0) {
//             this.navigateSearchResult(false);
//         } else {
//             this.viewer.renderVisiblePages();
//             this.messageDiv.innerHTML = this.localeValue.getConstant('No matches');
//             this.resultContainer.style.display = 'block';
//             this.resultsListBlock.style.display = 'none';
//             this.clearFocusElement();
//             this.resultsListBlock.innerHTML = '';
//         }
//     }
//     private navigateSearchResult(navigate: boolean): void {
//         if (navigate) {
//             this.documentHelper.owner.searchModule.navigate(this.results.innerList[this.results.currentIndex]);
//         }
//         this.documentHelper.owner.searchModule.highlight(this.results);
//         this.documentHelper.owner.searchModule.addFindResultView(this.results);
//         this.resultsListBlock.style.display = 'block';
//         this.resultContainer.style.display = 'block';
//         let lists: string[] = this.documentHelper.owner.findResultsList;
//         let text: string = '';
//         for (let i: number = 0; i < lists.length; i++) {
//             text += lists[i];
//         }
//         this.clearFocusElement();
//         this.resultsListBlock.innerHTML = text;
//         for (let i: number = 0; i < this.resultsListBlock.children.length; i++) {
//             this.focusedElement.push(this.resultsListBlock.children[i] as HTMLElement);
//         }
//         let currentIndexValue: number = this.results.currentIndex;
//         // tslint:disable-next-line:max-line-length
//         this.messageDiv.innerHTML = this.localeValue.getConstant('Result') + ' ' + (currentIndexValue + 1) + ' ' + this.localeValue.getConstant('of') + ' ' + this.resultsListBlock.children.length;
//         let listElement: HTMLElement = this.resultsListBlock.children[currentIndexValue] as HTMLElement;
//         if (listElement.classList.contains('e-de-search-result-item')) {
//             listElement.classList.remove('e-de-search-result-item');
//             listElement.classList.add('e-de-search-result-hglt');
//             listElement.children[0].classList.add('e-de-op-search-word-text');
//             this.scrollToPosition(listElement);
//         }
//     }
//     /**
//      * Apply find option based on whole words value.
//      * @param {ChangeEventArgs} args - Specifies the search options value.
//      * @private
//      */
//     public wholeWordsChange = (args: ChangeEventArgs): void => {
//         if (this.matchInput.checked && this.wholeInput.checked) {
//             this.findOption = 'CaseSensitiveWholeWord';
//         } else if (this.matchInput.checked && !(this.wholeInput.checked)) {
//             this.findOption = 'CaseSensitive';
//         } else if (!(this.matchInput.checked) && this.wholeInput.checked) {
//             this.findOption = 'WholeWord';
//         } else {
//             this.findOption = 'None';
//         }
//         this.searchOptionChange();
//     }
//     /**
//      * Apply find option based on match value.
//      * @param {ChangeEventArgs} args - Specifies the search options value.
//      * @private
//      */
//     public matchChange = (args: ChangeEventArgs): void => {
//         if (this.matchInput.checked && this.wholeInput.checked) {
//             this.findOption = 'CaseSensitiveWholeWord';
//         } else if (!(this.matchInput.checked) && this.wholeInput.checked) {
//             this.findOption = 'WholeWord';
//         } else if (this.matchInput.checked && !(this.wholeInput.checked)) {
//             this.findOption = 'CaseSensitive';
//         } else {
//             this.findOption = 'None';
//         }
//         this.searchOptionChange();
//     }
//     /**
//      * Apply find options based on regular value.
//      * @param {ChangeEventArgs} args - Specifies the search options value.
//      * @private
//      */
//     // public regularChange = (args: ChangeEventArgs): void => {
//     //     if (args.checked) {
//     //         this.matchCase.element.parentElement.parentElement.classList.add('e-checkbox-disabled');
//     //         this.wholeWord.element.parentElement.parentElement.classList.add('e-checkbox-disabled');
//     //         this.matchCase.checked = false;
//     //         this.wholeWord.checked = false;
//     //         this.findOption = 'None';
//     //         this.onKeyDownInternal();
//     //     } else {
//     //         this.matchCase.element.parentElement.parentElement.classList.remove('e-checkbox-disabled');
//     //         this.wholeWord.element.parentElement.parentElement.classList.remove('e-checkbox-disabled');
//     //     }
//     // }
//     // tslint:enable:no-any 
//     /**
//      * Binding events from the element when optins pane creation.
//      * @private
//      */
//     public onWireEvents = (): void => {
//         this.searchIcon.addEventListener('click', this.searchIconClickInternal);
//         this.navigateToNextResult.addEventListener('click', this.navigateNextResultButtonClick);
//         this.navigateToPreviousResult.addEventListener('click', this.navigatePreviousResultButtonClick);
//         this.searchInput.addEventListener('keydown', this.onKeyDown);
//         this.searchInput.addEventListener('keyup', this.onEnableDisableReplaceButton);
//         this.resultsListBlock.addEventListener('click', this.resultListBlockClick);
//         this.closeButton.addEventListener('click', this.close);
//         this.replaceButton.addEventListener('click', this.onReplaceButtonClick);
//         this.replaceAllButton.addEventListener('click', this.onReplaceAllButtonClick);
//     }
//     /**
//      * Fires on key down actions done.
//      * @private
//      */
//     public onKeyDownInternal(): void {
//         // tslint:disable-next-line:max-line-length
//         let inputElement: HTMLInputElement = document.getElementById(this.documentHelper.owner.containerId + '_option_search_text_box') as HTMLInputElement;
//         inputElement.blur();
//         let text: string = inputElement.value;
//         if (text === '') {
//             return;
//         }
//         if (text.length >= 1 && this.searchIcon.classList.contains('e-de-op-search-icon')) {
//             this.searchIcon.classList.add('e-de-op-search-close-icon');
//             this.searchIcon.classList.remove('e-de-op-search-icon');
//         }
//         let height: number = this.isOptionsPane ? 215 : 292;
//         let resultsContainerHeight: number = this.documentHelper.owner.getDocumentEditorElement().offsetHeight - height;
//         this.clearSearchResultItems();
//         this.documentHelper.owner.searchModule.clearSearchHighlight();
//         let pattern: RegExp = this.documentHelper.owner.searchModule.textSearch.stringToRegex(text, this.findOption);
//         let endSelection: TextPosition = this.documentHelper.selection.end;
//         let index: string = endSelection.getHierarchicalIndexInternal();
//         this.results = this.documentHelper.owner.searchModule.textSearch.findAll(pattern, this.findOption, index);
//         let results: TextSearchResults = this.results;
//         if (isNullOrUndefined(results)) {
//             this.viewer.renderVisiblePages();
//         }
//         if (results != null && results.length > 0) {
//             if ((this.focusedElement.indexOf(this.navigateToPreviousResult) === -1) && this.isOptionsPane) {
//                 this.focusedElement.push(this.navigateToPreviousResult);
//             }
//             if ((this.focusedElement.indexOf(this.navigateToNextResult) === -1) && this.isOptionsPane) {
//                 this.focusedElement.push(this.navigateToNextResult);
//             }
//             this.documentHelper.owner.searchModule.navigate(this.results.innerList[this.results.currentIndex]);
//             this.documentHelper.owner.searchModule.highlight(results);
//             this.documentHelper.owner.searchModule.addFindResultView(results);
//             // if (this.isOptionsPane) {
//             this.resultsListBlock.style.display = 'block';
//             this.resultsListBlock.style.height = resultsContainerHeight + 'px';
//             this.resultContainer.style.display = 'block';
//             let list: string[] = this.documentHelper.owner.findResultsList;
//             let text: string = '';
//             this.clearFocusElement();
//             this.resultsListBlock.innerHTML = '';
//             for (let i: number = 0; i < list.length; i++) {
//                 text += list[i];
//             }
//             this.resultsListBlock.innerHTML = text;
//             for (let i: number = 0; i < this.resultsListBlock.children.length; i++) {
//                 this.focusedElement.push(this.resultsListBlock.children[i] as HTMLElement);
//             }
//             let lists: HTMLCollection = this.resultsListBlock.children;
//             let currentIndex: number = this.results.currentIndex;
//             // tslint:disable-next-line:max-line-length
//             this.messageDiv.innerHTML = this.localeValue.getConstant('Result') + ' ' + (currentIndex + 1) + ' ' + this.localeValue.getConstant('of') + ' ' + this.resultsListBlock.children.length;
//             let listElement: HTMLElement = this.resultsListBlock.children[currentIndex] as HTMLElement;
//             if (listElement.classList.contains('e-de-search-result-item')) {
//                 listElement.classList.remove('e-de-search-result-item');
//                 listElement.classList.add('e-de-search-result-hglt');
//                 listElement.children[0].classList.add('e-de-op-search-word-text');
//             }
//             this.navigateToNextResult.focus();
//             this.focusedIndex = this.focusedElement.indexOf(this.navigateToNextResult);
//             this.getMessageDivHeight();
//             // } else {
//             //this.focusedIndex = 4;
//             // }
//         } else {
//             this.messageDiv.innerHTML = this.localeValue.getConstant('No matches');
//             this.resultContainer.style.display = 'block';
//             this.resultsListBlock.style.display = 'none';
//             this.clearFocusElement();
//             this.resultsListBlock.innerHTML = '';
//         }
//     }
//     /**
//      * Enable find pane only.
//      * @private
//      */
//     public onFindPane = (): void => {
//         this.replaceDiv.style.display = 'none';
//         this.occurrenceDiv.style.display = 'none';
//         if (!isNullOrUndefined(this.results) && this.results.length === 0) {
//             this.resultsListBlock.innerHTML = '';
//             this.resultsListBlock.style.display = 'none';
//             this.messageDiv.innerHTML = this.localeValue.getConstant('No matches');
//         }
//         let height: number = this.isOptionsPane ? 215 : 292;
//         let resultsContainerHeight: number = this.documentHelper.owner.getDocumentEditorElement().offsetHeight - height;
//         this.resultsListBlock.style.height = resultsContainerHeight + 'px';
//         this.replaceTabContentDiv.style.display = 'none';
//         this.findDiv.style.display = 'block';
//         this.messageDiv.style.display = 'block';
//         this.focusedElement = [];
//         // tslint:disable-next-line:max-line-length
//         this.focusedElement.push(this.closeButton, this.searchInput, this.searchIcon, this.navigateToPreviousResult, this.navigateToNextResult, this.matchInput, this.wholeInput);
//         this.focusedIndex = 1;
//         this.searchInput.select();
//         this.getMessageDivHeight();
//     }
//     private getMessageDivHeight(): void {
//         if (!this.isOptionsPane && this.messageDiv.classList.contains('e-de-op-msg')) {
//             this.messageDiv.classList.add('e-de-op-replace-messagediv');
//             this.messageDiv.classList.remove('e-de-op-msg');
//         } else if (this.isOptionsPane && this.messageDiv.classList.contains('e-de-op-replace-messagediv')) {
//             this.messageDiv.classList.add('e-de-op-msg');
//             this.messageDiv.classList.remove('e-de-op-replace-messagediv');
//         }
//     }
//     private onEnableDisableReplaceButton = (): void => {
//         if (this.searchInput.value.length !== 0) {
//             (this.replaceButton as HTMLButtonElement).disabled = false;
//             (this.replaceAllButton as HTMLButtonElement).disabled = false;
//         } else {
//             (this.replaceButton as HTMLButtonElement).disabled = true;
//             (this.replaceAllButton as HTMLButtonElement).disabled = true;
//         }
//     }
//     /**
//      * Enable replace pane only.
//      * @private
//      */
//     public onReplacePane = (): void => {
//         this.findDiv.style.display = 'block';
//         this.replaceDiv.style.display = 'block';
//         this.replaceTabContentDiv.style.display = 'block';
//         let height: number = this.isOptionsPane ? 215 : 292;
//         let resultsContainerHeight: number = this.documentHelper.owner.getDocumentEditorElement().offsetHeight - height;
//         this.resultsListBlock.style.height = resultsContainerHeight + 'px';
//         this.isOptionsPane = false;
//         if (this.searchInput.value.length !== 0) {
//             (this.replaceButton as HTMLButtonElement).disabled = false;
//             (this.replaceAllButton as HTMLButtonElement).disabled = false;
//         } else {
//             (this.replaceButton as HTMLButtonElement).disabled = true;
//             (this.replaceAllButton as HTMLButtonElement).disabled = true;
//         }
//         this.focusedElement = [];
//         // tslint:disable-next-line:max-line-length
//         this.focusedElement.push(this.closeButton, this.searchInput, this.searchIcon, this.navigateToPreviousResult, this.navigateToNextResult, this.matchInput, this.wholeInput, this.replaceWith, this.replaceButton, this.replaceAllButton);
//         this.focusedIndex = 1;
//         if (this.searchInput.value === '') {
//             this.searchInput.select();
//         } else {
//             this.replaceWith.select();
//         }
//         this.getMessageDivHeight();
//     }
//     /**
//      * Fires on key down on options pane.
//      * @param {KeyboardEvent} event - Specifies the focus of current element.
//      * @private
//      */
//     public onKeyDownOnOptionPane = (event: KeyboardEvent): void => {
//         // if (event.keyCode === 70) {
//         //     event.preventDefault();
//         //     return;
//         // }
//         if (event.keyCode === 9) {
//             event.preventDefault();
//             let focusIndex: number = undefined;
//             if (event.shiftKey) {
//                 focusIndex = (this.focusedIndex === 0 || isNullOrUndefined(this.focusedIndex)) ?
//                     this.focusedElement.length - 1 : this.focusedIndex - 1;
//             } else {
//                 focusIndex = (this.focusedElement.length - 1 === this.focusedIndex || isNullOrUndefined(this.focusedIndex)) ?
//                     0 : this.focusedIndex + 1;
//             }
//             let element: HTMLElement = this.focusedElement[focusIndex];
//             element.focus();
//             if (element instanceof HTMLInputElement) {
//                 element.select();
//             }
//             this.focusedIndex = focusIndex;
//             if (element instanceof HTMLLIElement) {
//                 this.scrollToPosition(element);
//             }
//         } else if (event.keyCode === 13) {
//             // tslint:disable-next-line:max-line-length
//             if (event.target !== this.searchInput && event.target !== this.closeButton) {
//                 event.preventDefault();
//                 let index: number = this.focusedElement.indexOf(event.target as HTMLElement);
//                 if (index !== -1) {
//                     let list: HTMLLIElement = this.focusedElement[index] as HTMLLIElement;
//                     list.click();
//                     list.focus();
//                     this.focusedIndex = index;
//                 }
//             }
//         } else if (event.keyCode === 40 || event.keyCode === 38) {
//             if (this.resultsListBlock.style.display !== 'none') {
//                 let index: number;
//                 let element: HTMLElement;
//                 if (event.keyCode === 40) {
//                     if (this.focusedIndex > 7) {
//                         if (this.focusedIndex + 1 < this.focusedElement.length) {
//                             element = this.focusedElement[this.focusedIndex + 1];
//                             element.focus();
//                             this.focusedIndex = this.focusedIndex + 1;
//                         }
//                     } else {
//                         index = (this.focusedElement.length - this.resultsListBlock.children.length) + this.results.currentIndex + 1;
//                         if (index < this.focusedElement.length) {
//                             element = this.focusedElement[index];
//                             element.focus();
//                             this.focusedIndex = index;
//                         }
//                     }
//                 } else {
//                     if (this.focusedIndex > 6) {
//                         index = this.focusedIndex - 1;
//                         element = this.focusedElement[index];
//                         element.focus();
//                         this.focusedIndex = index;
//                     }
//                 }
//             }
//         }
//     }
//     /**
//      * Fires on replace.
//      * @private
//      */
//     public onReplaceButtonClick = (): void => {
//         let optionsPane: HTMLElement = this.optionsPane;
//         let findText: string = this.searchInput.value;
//         let replaceText: string = this.replaceWith.value;
//         let results: TextSearchResults = this.documentHelper.owner.searchModule.textSearchResults;
//         if (findText !== '' && !isNullOrUndefined(findText)) {
//             if (this.documentHelper.owner.selection != null) {
//                 let selectionText: string = this.documentHelper.owner.selection.text;
//                 if (!this.documentHelper.owner.selection.isEmpty) {
//                     if (this.documentHelper.owner.selection.isForward) {
//                         this.documentHelper.owner.selection.selectContent(this.documentHelper.owner.selection.start, true);
//                     } else {
//                         this.documentHelper.owner.selection.selectContent(this.documentHelper.owner.selection.end, true);
//                     }
//                 }
//                 if (!isNullOrUndefined(results) && !isNullOrUndefined(results.currentSearchResult)) {
//                     let result: TextSearchResult = results.currentSearchResult;
//                     this.documentHelper.owner.searchModule.navigate(result);
//                     if (result.text === selectionText) {
//                         let replace: string = isNullOrUndefined(replaceText) ? '' : replaceText;
//                         this.documentHelper.owner.searchModule.replace(replace, result, results);
//                         let pattern: RegExp = this.documentHelper.owner.searchModule.textSearch.stringToRegex(findText, this.findOption);
//                         let endSelection: TextPosition = this.documentHelper.selection.end;
//                         let index: string = endSelection.getHierarchicalIndexInternal();
//                         // tslint:disable-next-line:max-line-length
//                         this.documentHelper.owner.searchModule.textSearchResults = this.documentHelper.owner.searchModule.textSearch.findAll(pattern, this.findOption, index);
//                         this.results = this.documentHelper.owner.searchModule.textSearchResults;
//                         if (!isNullOrUndefined(this.results) && !isNullOrUndefined(this.results.currentSearchResult)) {
//                             this.documentHelper.owner.searchModule.navigate(this.results.currentSearchResult);
//                         } else {
//                             this.messageDiv.style.display = 'block';
//                             this.messageDiv.innerHTML = this.localeValue.getConstant(this.matchDivReplaceText);
//                         }
//                         this.documentHelper.owner.findResultsList = [];
//                         if (!isNullOrUndefined(this.results) && this.results.innerList.length > 0) {
//                             this.navigateSearchResult(true);
//                         } else {
//                             this.resultsListBlock.innerHTML = '';
//                         }
//                     }
//                 } else {
//                     this.messageDiv.style.display = 'block';
//                     this.messageDiv.innerHTML = this.localeValue.getConstant(this.matchDivReplaceText);
//                 }
//             }
//         }
//     }
//     /**
//      * Fires on replace all.
//      * @private
//      */
//     public onReplaceAllButtonClick = (): void => {
//         this.replaceAll();
//         this.resultsListBlock.style.display = 'none';
//         this.messageDiv.innerHTML = '';
//     }
//     /**
//      * Replace all.
//      * @private
//      */
//     public replaceAll(): void {
//         let optionsPane: HTMLElement = this.optionsPane;
//         let findText: string = this.searchInput.value;
//         let replaceText: string = this.replaceWith.value;
//         if (findText !== '' && !isNullOrUndefined(findText)) {
//             let pattern: RegExp = this.documentHelper.owner.searchModule.textSearch.stringToRegex(findText, this.findOption);
//             let endSelection: TextPosition = this.documentHelper.selection.end;
//             let index: string = endSelection.getHierarchicalIndexInternal();
//             let results: TextSearchResults = this.documentHelper.owner.searchModule.textSearch.findAll(pattern, this.findOption, index);
//             let replace: string = isNullOrUndefined(replaceText) ? '' : replaceText;
//             let count: number = isNullOrUndefined(results) ? 0 : results.length;
//             this.documentHelper.owner.searchModule.replaceAll(replace, results);
//             this.matchDiv.style.display = 'block';
//             this.matchDiv.innerHTML = this.localeValue.getConstant('All Done') + '!';
//             this.occurrenceDiv.style.display = 'block';
//             // tslint:disable-next-line:max-line-length
//             this.occurrenceDiv.innerHTML = this.localeValue.getConstant('We replaced all') + ' ' + count + ' ' + this.localeValue.getConstant('instances') + ' ' + this.localeValue.getConstant('of') + ' "' + findText + '" ' + this.localeValue.getConstant('with') + ' "' + replaceText + '" ';
//         }
//     }
//     /**
//      * Fires on search icon.
//      * @private
//      */
//     public searchIconClickInternal = (): void => {
//         // tslint:disable:no-any 
//         let inputElement: any = document.getElementById(this.documentHelper.owner.containerId + '_option_search_text_box');
//         // tslint:enable:no-any
//         let text: string = inputElement.value;
//         if (text === '') {
//             return;
//         }
//         if (this.searchIcon.classList.contains('e-de-op-search-close-icon')) {
//             this.searchIcon.classList.add('e-de-op-search-icon');
//             this.searchIcon.classList.remove('e-de-op-search-close-icon');
//             inputElement.value = '';
//             this.messageDiv.innerHTML = this.localeValue.getConstant('No matches');
//             this.resultContainer.style.display = 'block';
//             this.resultsListBlock.style.display = 'none';
//             this.matchDiv.style.display = 'none';
//             this.occurrenceDiv.style.display = 'none';
//             this.onEnableDisableReplaceButton();
//             this.clearFocusElement();
//             this.resultsListBlock.innerHTML = '';
//             this.clearSearchResultItems();
//             this.documentHelper.owner.searchModule.clearSearchHighlight();
//             this.viewer.renderVisiblePages();
//             return;
//         }
//         if (this.searchIcon.classList.contains('e-de-op-search-icon') && text.length >= 1) {
//             this.searchIcon.classList.add('e-de-op-search-close-icon');
//             this.searchIcon.classList.remove('e-de-op-search-icon');
//             this.onEnableDisableReplaceButton();
//         }
//         this.clearSearchResultItems();
//         this.documentHelper.owner.searchModule.clearSearchHighlight();
//         let patterns: RegExp = this.documentHelper.owner.searchModule.textSearch.stringToRegex(text, this.findOption);
//         let endSelection: TextPosition = this.documentHelper.selection.end;
//         let index: string = endSelection.getHierarchicalIndexInternal();
//         this.results = this.documentHelper.owner.searchModule.textSearch.findAll(patterns, this.findOption, index);
//         if (this.results != null && this.results.length > 0) {
//             let start: TextPosition = this.results.innerList[this.results.currentIndex].start;
//             let end: TextPosition = this.results.innerList[this.results.currentIndex].end;
//             this.documentHelper.scrollToPosition(start, end, true);
//             this.navigateSearchResult(false);
//             this.getMessageDivHeight();
//             let height: number = this.isOptionsPane ? 215 : 292;
//             let resultsContainerHeight: number = this.documentHelper.owner.getDocumentEditorElement().offsetHeight - height;
//             this.resultsListBlock.style.height = resultsContainerHeight + 'px';
//         } else {
//             this.messageDiv.innerHTML = this.localeValue.getConstant('No matches');
//             this.resultContainer.style.display = 'block';
//             this.resultsListBlock.style.display = 'none';
//             this.clearFocusElement();
//             this.resultsListBlock.innerHTML = '';
//         }
//     }
//     /**
//      * Fires on getting next results.
//      * @private
//      */
//     public navigateNextResultButtonClick = (): void => {
//         if (document.getElementById(this.documentHelper.owner.containerId + '_list_box_container') != null &&
//             document.getElementById(this.documentHelper.owner.containerId + '_list_box_container').style.display !== 'none') {
//             let selectionEnd: TextPosition = this.documentHelper.owner.selection.end;
//             let nextResult: TextSearchResult;
//             let currentIndex: number = 0;
//             if (selectionEnd.isExistAfter(this.results.currentSearchResult.start)) {
//                 currentIndex = this.results.currentIndex;
//             }
//             for (let i: number = currentIndex; i < this.results.length; i++) {
//                 let result: TextSearchResult = this.results.innerList[i];
//                 if (selectionEnd.isExistBefore(result.start) || selectionEnd.isAtSamePosition(result.start)) {
//                     nextResult = result;
//                     this.results.currentIndex = i;
//                     break;
//                 }
//             }
//             if (isNullOrUndefined(nextResult)) {
//                 this.results.currentIndex = 0;
//                 nextResult = this.results.innerList[0];
//             }
//             // tslint:disable-next-line:max-line-length
//             this.messageDiv.innerHTML = this.localeValue.getConstant('Result') + ' ' + (this.results.currentIndex + 1) + ' ' + this.localeValue.getConstant('of') + ' ' + this.resultsListBlock.children.length;
//             this.updateListItems(nextResult);
//             this.focusedIndex = this.focusedElement.indexOf(this.navigateToNextResult);
//         }
//     }
//     private updateListItems(textSearchResult: TextSearchResult): void {
//         let searchElements: NodeListOf<Element> = this.resultsListBlock.getElementsByClassName('e-de-search-result-hglt');
//         for (let j: number = 0; j < searchElements.length; j++) {
//             let list: HTMLElement = searchElements[j] as HTMLElement;
//             classList(list, ['e-de-search-result-item'], ['e-de-search-result-hglt']);
//             classList(list.children[0], [], ['e-de-op-search-word-text']);
//         }
//         let listElement: HTMLElement = this.resultsListBlock.children[this.results.currentIndex] as HTMLElement;
//         classList(listElement, ['e-de-search-result-hglt'], ['e-de-search-result-item']);
//         classList(listElement.children[0], ['e-de-op-search-word-text'], []);
//         this.scrollToPosition(listElement);
//         this.documentHelper.owner.searchModule.navigate(textSearchResult);
//         this.documentHelper.owner.searchModule.highlight(this.results);
//     }
//     /**
//      * Fires on getting previous results.
//      * @private
//      */
//     public navigatePreviousResultButtonClick = (): void => {
//         if (document.getElementById(this.documentHelper.owner.containerId + '_list_box_container') != null &&
//             document.getElementById(this.documentHelper.owner.containerId + '_list_box_container').style.display !== 'none') {
//             let previousResult: TextSearchResult;
//             let selectionStart: TextPosition = this.documentHelper.owner.selection.start;
//             let currentIndex: number = this.results.currentIndex;
//             if (selectionStart.isExistAfter(this.results.currentSearchResult.start)) {
//                 currentIndex = this.results.length - 1;
//             }
//             for (let i: number = currentIndex; i >= 0; i--) {
//                 let result: TextSearchResult = this.results.innerList[i];
//                 if (selectionStart.isExistAfter(result.start) || this.documentHelper.owner.selection.end.isAtSamePosition(result.start)) {
//                     previousResult = result;
//                     this.results.currentIndex = i;
//                     break;
//                 }
//             }
//             if (isNullOrUndefined(previousResult)) {
//                 this.results.currentIndex = this.results.length - 1;
//                 previousResult = this.results.innerList[this.results.currentIndex];
//             }
//             // tslint:disable-next-line:max-line-length
//             this.messageDiv.innerHTML = this.localeValue.getConstant('Result') + ' ' + (this.results.currentIndex + 1) + ' ' + this.localeValue.getConstant('of') + ' ' + this.resultsListBlock.children.length;
//             this.updateListItems(previousResult);
//             this.focusedIndex = this.focusedElement.indexOf(this.navigateToPreviousResult);
//         }
//     }
//     /**
//      * Scrolls to position.
//      * @param {HTMLElement} list - Specifies the list element.
//      * @private
//      */
//     public scrollToPosition(list: HTMLElement): void {
//         let rect: ClientRect = list.getBoundingClientRect();
//         let top: number;
//         if (rect.top > 0) {
//             top = rect.top - list.parentElement.getBoundingClientRect().top;
//             if ((list.parentElement.offsetHeight - top) <= list.offsetHeight) {
//                 if (Math.ceil(top + list.offsetHeight) === list.parentElement.scrollHeight) {
//                     list.parentElement.scrollTop = top;
//                 }
//                 list.parentElement.scrollTop = list.parentElement.scrollTop + (list.parentElement.offsetHeight / 100) * 30;
//             } else if (top < 0) {
//                 list.parentElement.scrollTop = list.parentElement.scrollTop - (list.parentElement.offsetHeight / 100) * 30;
//             }
//         } else {
//             list.parentElement.scrollTop = 0;
//         }
//     }
//     /**
//      * Fires on key down
//      * @param {KeyboardEvent} event - Speficies key down actions.
//      * @private
//      */
//     public onKeyDown = (event: KeyboardEvent): void => {
//         let code: number = event.which || event.keyCode;
//         if (code === 13 && event.keyCode !== 9 && event.keyCode !== 40) {
//             event.preventDefault();
//             this.findDiv.style.height = '';
//             this.onKeyDownInternal();
//         } else if (code === 8 && (this.searchInput.value.length === 0)) {
//             this.resultContainer.style.display = 'block';
//         } else if (event.keyCode !== 9 && event.keyCode !== 40 && event.keyCode !== 27) {
//             this.documentHelper.owner.searchModule.clearSearchHighlight();
//             this.clearSearchResultItems();
//             this.viewer.renderVisiblePages();
//             this.resultsListBlock.style.display = 'none';
//             this.messageDiv.innerHTML = this.localeValue.getConstant('No matches');
//             this.resultContainer.style.display = 'none';
//             this.clearFocusElement();
//             this.resultsListBlock.innerHTML = '';
//             if (this.searchIcon.classList.contains('e-de-op-search-close-icon')) {
//                 this.searchIcon.classList.add('e-de-op-search-icon');
//                 this.searchIcon.classList.remove('e-de-op-search-close-icon');
//             }
//         } else if (code === 27 && event.keyCode === 27) {
//             this.showHideOptionsPane(false);
//         }
//     }
//     /**
//      * Clear the focus elements.
//      * @private
//      */
//     public clearFocusElement(): void {
//         for (let i: number = 0; i < this.resultsListBlock.children.length; i++) {
//             let index: number = this.focusedElement.indexOf(this.resultsListBlock.children[i] as HTMLElement);
//             if (index !== -1) {
//                 this.focusedElement.splice(index, 1);
//             }
//         }
//         this.focusedIndex = 1;
//     }
//     /**
//      * Close the optios pane.
//      * @private
//      */
//     public close = (): void => {
//         this.clearFocusElement();
//         this.showHideOptionsPane(false);
//         this.resultsListBlock.innerHTML = '';
//         this.focusedIndex = 1;
//         this.isOptionsPane = true;
//     }
//     /**
//      * Fires on results list block.
//      * @param {MouseEvent} args - Specifies which list was clicked.
//      * @private
//      */
//     public resultListBlockClick = (args: MouseEvent): void => {
//         let currentlist: EventTarget = args.target;
//         let element: HTMLCollection = this.resultsListBlock.children;
//         let index: number = 0;
//         for (let i: number = 0; i < element.length; i++) {
//             let list: HTMLElement = element[i] as HTMLElement;
//             if (list.classList.contains('e-de-search-result-hglt')) {
//                 list.classList.remove('e-de-search-result-hglt');
//                 list.children[0].classList.remove('e-de-op-search-word-text');
//                 list.classList.add('e-de-search-result-item');
//             }
//         }
//         let list: HTMLElement;
//         for (let i: number = 0; i < element.length; i++) {
//             if (currentlist === element[i]) {
//                 index = i;
//                 list = element[i] as HTMLElement;
//                 if (list.classList.contains('e-de-search-result-item')) {
//                     list.classList.remove('e-de-search-result-item');
//                     list.classList.add('e-de-search-result-hglt');
//                     list.children[0].classList.add('e-de-op-search-word-text');
//                     this.focusedIndex = this.focusedElement.indexOf(list);
//                 }
//             }
//         }
//         let currentelement: TextSearchResult = this.results.innerList[index];
//         this.results.currentIndex = index;
//         // tslint:disable-next-line:max-line-length
//         this.messageDiv.innerHTML = this.localeValue.getConstant('Result') + ' ' + (index + 1) + ' ' + this.localeValue.getConstant('of') + ' ' + this.resultsListBlock.children.length;
//         this.documentHelper.owner.searchModule.navigate(currentelement);
//         this.documentHelper.owner.searchModule.highlight(this.results);
//         if (list) {
//             list.focus();
//         }
//     }
//     /**
//      * Show or hide option pane based on boolean value.
//      * @param {boolean} show - Specifies showing or hiding the options pane.
//      * @private
//      */
//     public showHideOptionsPane(show: boolean): void {
//         if (!isNullOrUndefined(this.documentHelper.owner.selectionModule)) {
//             if (show) {
//                 this.localeValue = new L10n('documenteditor', this.documentHelper.owner.defaultLocale);
//                 this.localeValue.setLocale(this.documentHelper.owner.locale);
//                 if (isNullOrUndefined(this.optionsPane)) {
//                     this.initOptionsPane(this.localeValue, this.documentHelper.owner.enableRtl);
//                     //Add Option Pane
//                     let isRtl: boolean = this.documentHelper.owner.enableRtl;
//                     let optionsPaneContainerStyle: string;
//                     if (isRtl) {
//                         optionsPaneContainerStyle = 'display:inline-flex;direction:rtl;';
//                     } else {
//                         optionsPaneContainerStyle = 'display:inline-flex;';
//                     }
//                     this.documentHelper.optionsPaneContainer.setAttribute('style', optionsPaneContainerStyle);
//                     // tslint:disable-next-line:max-line-length
//                     this.documentHelper.optionsPaneContainer.insertBefore(this.documentHelper.owner.optionsPaneModule.optionsPane, this.documentHelper.viewerContainer);
//                 }
//                 this.optionsPane.style.display = 'block';
//                 if (this.documentHelper.owner.isReadOnlyMode) {
//                     this.tabInstance.hideTab(1);
//                 } else {
//                     this.tabInstance.hideTab(1, false);
//                 }
//                 if (this.isReplace && !this.documentHelper.owner.isReadOnlyMode) {
//                     this.tabInstance.select(1);
//                     this.isReplace = false;
//                     this.isOptionsPane = false;
//                 } else {
//                     this.tabInstance.select(0);
//                 }
//                 this.searchDiv.innerHTML = this.localeValue.getConstant(this.searchText);
//                 this.isOptionsPaneShow = true;
//                 // tslint:disable-next-line:max-line-length
//                 let textBox: HTMLInputElement = document.getElementById(this.documentHelper.owner.getDocumentEditorElement().id + '_option_search_text_box') as HTMLInputElement;
//                 let selectedText: string = this.documentHelper.owner.selection.text;
//                 if (!isNullOrUndefined(selectedText)) {
//                     let char: string[] = ['\v', '\r'];
//                     let index: number = HelperMethods.indexOfAny(selectedText, char);
//                     selectedText = index < 0 ? selectedText : selectedText.substring(0, index);
//                 }
//                 textBox.value = selectedText;
//                 textBox.select();
//                 this.messageDiv.innerHTML = '';
//                 if (this.searchIcon.classList.contains('e-de-op-search-close-icon')) {
//                     this.searchIcon.classList.add('e-de-op-search-icon');
//                     this.searchIcon.classList.remove('e-de-op-search-close-icon');
//                 }
//                 this.documentHelper.selection.caret.style.display = 'none';
//                 this.focusedIndex = 1;
//                 this.focusedElement = [];
//                 if (this.isOptionsPane) {
//                     // tslint:disable-next-line:max-line-length
//                     this.focusedElement.push(this.closeButton, this.searchInput, this.searchIcon, this.navigateToPreviousResult, this.navigateToNextResult, this.matchInput, this.wholeInput);
//                 } else {
//                     // tslint:disable-next-line:max-line-length
//                     this.focusedElement.push(this.closeButton, this.searchInput, this.searchIcon, this.navigateToPreviousResult, this.navigateToNextResult, this.matchInput, this.wholeInput, this.replaceWith, this.replaceButton, this.replaceAllButton);
//                 }
//                 this.documentHelper.updateViewerSize();
//             } else {
//                 if (!isNullOrUndefined(this.optionsPane)) {
//                     this.clearSearchResultItems();
//                     this.documentHelper.owner.searchModule.clearSearchHighlight();
//                     this.isOptionsPaneShow = false;
//                     let resultListBox: HTMLElement = document.getElementById(this.documentHelper.owner.containerId + '_list_box_container');
//                     let message: HTMLElement = document.getElementById(this.documentHelper.owner.containerId + '_search_status');
//                     if (!isNullOrUndefined(resultListBox) && !isNullOrUndefined(message)) {
//                         resultListBox.style.display = 'none';
//                         this.clearFocusElement();
//                         resultListBox.innerHTML = '';
//                         message.innerHTML = this.localeValue.getConstant('No matches');
//                     }
//                 }
//                 this.documentHelper.updateViewerSize();
//                 if (!isNullOrUndefined(this.optionsPane)) {
//                     if (this.optionsPane.style.display !== 'none') {
//                         this.documentHelper.selection.updateCaretPosition();
//                         this.optionsPane.style.display = 'none';
//                     }
//                 }
//                 this.documentHelper.updateFocus();
//                 this.documentHelper.selection.caret.style.display = 'block';
//             }
//         }
//     }
//     /**
//      * Clears search results.
//      * @private
//      */
//     public clearSearchResultItems(): void {
//         if (!isNullOrUndefined(this.documentHelper.owner.findResultsList)) {
//             this.documentHelper.owner.findResultsList = [];
//         }
//     }
//     /**
//      * Dispose the internal objects which are maintained.
//      * @private
//      */
//     public destroy(): void {
//         if (this.optionsPane) {
//             this.optionsPane.innerHTML = '';
//             this.optionsPane = undefined;
//         }
//         if (this.resultsListBlock) {
//             this.resultsListBlock.innerHTML = '';
//             this.resultsListBlock = undefined;
//         }
//         if (this.messageDiv) {
//             this.messageDiv.innerHTML = '';
//             this.messageDiv = undefined;
//         }
//         if (this.resultContainer) {
//             this.resultContainer.innerHTML = '';
//         }
//         this.resultContainer = undefined;
//         if (this.searchInput) {
//             this.searchInput.value = '';
//             this.searchInput = undefined;
//         }
//         if (this.searchDiv) {
//             this.searchDiv.innerHTML = '';
//             this.searchDiv = undefined;
//         }
//         if (this.searchTextBoxContainer) {
//             this.searchTextBoxContainer.innerHTML = '';
//             this.searchTextBoxContainer = undefined;
//         }
//         if (this.replaceWith) {
//             this.replaceWith.innerHTML = '';
//             this.replaceWith = undefined;
//         }
//         if (this.findDiv) {
//             this.findDiv.innerHTML = '';
//             this.findDiv = undefined;
//         }
//         if (this.replaceButton) {
//             this.replaceButton.innerHTML = '';
//             this.replaceButton = undefined;
//         }
//         if (this.replaceAllButton) {
//             this.replaceAllButton.innerHTML = '';
//             this.replaceAllButton = undefined;
//         }
//         if (this.matchInput) {
//             this.matchInput.innerHTML = '';
//             this.matchCase = undefined;
//         }
//         if (this.wholeInput) {
//             this.wholeInput.innerHTML = '';
//             this.wholeWord = undefined;
//         }
//         // if (this.regularInput) {
//         //     this.regularInput.innerHTML = '';
//         //     this.regular = undefined;
//         // }
//         if (!isNullOrUndefined(this.results)) {
//             this.results.destroy();
//         }
//         if (this.focusedElement) {
//             this.focusedElement = [];
//         }
//         this.focusedElement = undefined;
//         this.destroyInternal();
//     }
//     /**
//      * Dispose the internal objects which are maintained.
//      */
//     private destroyInternal(): void {
//         if (this.searchText) {
//             this.searchText = undefined;
//         }
//         if (this.resultsText) {
//             this.resultsText = undefined;
//         }
//         if (this.messageDivText) {
//             this.messageDivText = undefined;
//         }
//         if (this.replaceButtonText) {
//             this.replaceButtonText = undefined;
//         }
//         if (this.replaceAllButtonText) {
//             this.replaceAllButtonText = undefined;
//         }
//     }
// }
/**
 * Search Export
 */ /**
 * @private
 */var ModifiedLevel=/** @class */function(){function ModifiedLevel(owner,modified){this.ownerListLevelIn=undefined;this.modifiedListLevelIn=undefined;this.ownerListLevel=owner;this.modifiedListLevel=modified;}Object.defineProperty(ModifiedLevel.prototype,"ownerListLevel",{get:function get(){return this.ownerListLevelIn;},set:function set(value){this.ownerListLevelIn=value;},enumerable:true,configurable:true});Object.defineProperty(ModifiedLevel.prototype,"modifiedListLevel",{get:function get(){return this.modifiedListLevelIn;},set:function set(value){this.modifiedListLevelIn=value;},enumerable:true,configurable:true});ModifiedLevel.prototype.destroy=function(){this.ownerListLevel=undefined;this.modifiedListLevel=undefined;};return ModifiedLevel;}();/**
 * @private
 */var ModifiedParagraphFormat=/** @class */function(){function ModifiedParagraphFormat(ownerFormat,modifiedFormat){this.ownerFormatIn=undefined;this.modifiedFormatIn=undefined;this.ownerFormat=ownerFormat;this.modifiedFormat=modifiedFormat;}Object.defineProperty(ModifiedParagraphFormat.prototype,"ownerFormat",{get:function get(){return this.ownerFormatIn;},set:function set(value){this.ownerFormatIn=value;},enumerable:true,configurable:true});Object.defineProperty(ModifiedParagraphFormat.prototype,"modifiedFormat",{get:function get(){return this.modifiedFormatIn;},set:function set(value){this.modifiedFormatIn=value;},enumerable:true,configurable:true});ModifiedParagraphFormat.prototype.destroy=function(){this.ownerFormat=undefined;this.modifiedFormat.destroy();this.modifiedFormat=undefined;};return ModifiedParagraphFormat;}();/**
 * @private
 */var RowHistoryFormat=/** @class */function(){function RowHistoryFormat(startingPoint,rowFormat){this.startingPoint=startingPoint;this.rowFormat=rowFormat;this.rowHeightType=rowFormat.heightType;}RowHistoryFormat.prototype.revertChanges=function(isRedo,owner){//backup current format values.
var currentRowHeightType=this.rowFormat.heightType;//Restore old values.
owner.editorModule.tableResize.updateRowHeight(this.rowFormat.ownerBase,isRedo?this.displacement:-this.displacement);owner.documentHelper.layout.reLayoutTable(this.rowFormat.ownerBase.ownerTable);if(this.rowFormat.heightType!==this.rowHeightType){this.rowFormat.heightType=this.rowHeightType;}//backup the current format values for redo.
this.rowHeightType=currentRowHeightType;};return RowHistoryFormat;}();/**
 * @private
 */var TableHistoryInfo=/** @class */function(){function TableHistoryInfo(table,owner){this.tableHolder=new WTableHolder();this.tableFormat=new TableFormatHistoryInfo();this.rows=[];this.owner=owner;this.copyProperties(table);}TableHistoryInfo.prototype.copyProperties=function(table){if(table.tableHolder){this.tableHolder=table.tableHolder.clone();}if(table.tableFormat){this.tableFormat.leftIndent=table.tableFormat.leftIndent;this.tableFormat.preferredWidth=table.tableFormat.preferredWidth;this.tableFormat.preferredWidthType=table.tableFormat.preferredWidthType;this.tableFormat.allowAutoFit=table.tableFormat.allowAutoFit;}for(var i=0;i<table.childWidgets.length;i++){var row=table.childWidgets[i];var rowFormat=new RowFormatHistoryInfo();rowFormat.gridBefore=row.rowFormat.gridBefore;rowFormat.gridBeforeWidth=row.rowFormat.gridBeforeWidth;rowFormat.gridBeforeWidthType=row.rowFormat.gridBeforeWidthType;rowFormat.gridAfter=row.rowFormat.gridAfter;rowFormat.gridAfterWidth=row.rowFormat.gridAfterWidth;rowFormat.gridAfterWidthType=row.rowFormat.gridAfterWidthType;for(var j=0;j<row.childWidgets.length;j++){var cell=row.childWidgets[j];var cellFormat=new CellFormatHistoryInfo();cellFormat.columnIndex=cell.columnIndex;cellFormat.columnSpan=cell.cellFormat.columnSpan;cellFormat.preferredWidth=cell.cellFormat.preferredWidth;cellFormat.preferredWidthType=cell.cellFormat.preferredWidthType;rowFormat.cells.push(cellFormat);}this.rows.push(rowFormat);}this.tableHierarchicalIndex=this.owner.selection.getHierarchicalIndex(table,'0');};TableHistoryInfo.prototype.destroy=function(){this.tableHierarchicalIndex=undefined;if(this.tableHolder){this.tableHolder.destroy();this.tableHolder=undefined;}if(this.tableFormat){this.tableFormat=null;}if(this.rows){this.rows=[];this.rows=undefined;}};return TableHistoryInfo;}();/**
 * @private
 */var TableFormatHistoryInfo=/** @class */function(){function TableFormatHistoryInfo(){}return TableFormatHistoryInfo;}();/**
 * @private
 */var RowFormatHistoryInfo=/** @class */function(){function RowFormatHistoryInfo(){this.cells=[];}return RowFormatHistoryInfo;}();/**
 * @private
 */var CellFormatHistoryInfo=/** @class */function(){function CellFormatHistoryInfo(){}return CellFormatHistoryInfo;}();/**
 * @private
 */var BaseHistoryInfo=/** @class */function(){function BaseHistoryInfo(node){this.ownerIn=node;this.documentHelper=node.documentHelper;this.modifiedPropertiesIn=[];this.modifiedNodeLength=[];this.removedNodesIn=[];}Object.defineProperty(BaseHistoryInfo.prototype,"owner",{//Properties
//gets owner control
get:function get(){return this.ownerIn;},enumerable:true,configurable:true});Object.defineProperty(BaseHistoryInfo.prototype,"editorHistory",{get:function get(){return this.owner.editorHistory;},enumerable:true,configurable:true});Object.defineProperty(BaseHistoryInfo.prototype,"action",{get:function get(){return this.actionIn;},set:function set(value){this.actionIn=value;},enumerable:true,configurable:true});Object.defineProperty(BaseHistoryInfo.prototype,"modifiedProperties",{get:function get(){return this.modifiedPropertiesIn;},enumerable:true,configurable:true});Object.defineProperty(BaseHistoryInfo.prototype,"removedNodes",{/* eslint-enable */get:function get(){return this.removedNodesIn;},enumerable:true,configurable:true});Object.defineProperty(BaseHistoryInfo.prototype,"selectionStart",{//gets or sets selection start
get:function get(){return this.selectionStartIn;},set:function set(value){this.selectionStartIn=value;},enumerable:true,configurable:true});Object.defineProperty(BaseHistoryInfo.prototype,"selectionEnd",{get:function get(){return this.selectionEndIn;},set:function set(value){this.selectionEndIn=value;},enumerable:true,configurable:true});Object.defineProperty(BaseHistoryInfo.prototype,"insertPosition",{get:function get(){return this.insertPositionIn;},set:function set(value){this.insertPositionIn=value;},enumerable:true,configurable:true});Object.defineProperty(BaseHistoryInfo.prototype,"endPosition",{get:function get(){return this.endPositionIn;},set:function set(value){this.endPositionIn=value;},enumerable:true,configurable:true});Object.defineProperty(BaseHistoryInfo.prototype,"viewer",{get:function get(){return this.ownerIn.viewer;},enumerable:true,configurable:true});BaseHistoryInfo.prototype.updateSelection=function(){var blockInfo=this.owner.selection.getParagraphInfo(this.owner.selection.start);this.selectionStart=this.owner.selection.getHierarchicalIndex(blockInfo.paragraph,blockInfo.offset.toString());blockInfo=this.owner.selection.getParagraphInfo(this.owner.selection.end);this.selectionEnd=this.owner.selection.getHierarchicalIndex(blockInfo.paragraph,blockInfo.offset.toString());};BaseHistoryInfo.prototype.setBookmarkInfo=function(bookmark){this.removedNodes.push({'bookmark':bookmark,'startIndex':bookmark.indexInOwner,'endIndex':bookmark.reference.indexInOwner});};BaseHistoryInfo.prototype.setFormFieldInfo=function(field,value){this.removedNodes.push({'formField':field,'value':value});};BaseHistoryInfo.prototype.setEditRangeInfo=function(editStart){this.removedNodes.push({'editStart':editStart,'startIndex':editStart.indexInOwner,'endIndex':editStart.editRangeEnd.indexInOwner});};BaseHistoryInfo.prototype.revertFormTextFormat=function(){/* eslint-disable @typescript-eslint/no-explicit-any */var fieldInfo=this.removedNodes[0];var text=fieldInfo.value;/* eslint-enable @typescript-eslint/no-explicit-any */var formField=fieldInfo.formField;if(this.editorHistory.isUndoing){this.owner.editorModule.applyTextFormatInternal(formField,text);this.editorHistory.recordChanges(this);}else{text=HelperMethods.formatText(formField.formFieldData.format,text);this.owner.editorModule.applyTextFormatInternal(formField,text);this.editorHistory.undoStack.push(this);}};BaseHistoryInfo.prototype.revertFormField=function(){/* eslint-disable @typescript-eslint/no-explicit-any */var fieldInfo=this.removedNodes[0];/* eslint-enable @typescript-eslint/no-explicit-any */var field=fieldInfo.formField;if(field.formFieldData instanceof CheckBoxFormField){this.owner.editorModule.toggleCheckBoxFormField(field,true,fieldInfo.value);}else{this.owner.editorModule.updateFormField(field,fieldInfo.value);}};BaseHistoryInfo.prototype.revertBookmark=function(){var bookmarkInfo=this.removedNodes[0];var bookmark=bookmarkInfo.bookmark;if(this.editorHistory.isUndoing){this.documentHelper.bookmarks.add(bookmark.name,bookmark);bookmark.line.children.splice(bookmarkInfo.startIndex,0,bookmark);var previousNode=bookmark.previousNode;if(previousNode instanceof FieldElementBox&&!sf.base.isNullOrUndefined(previousNode.formFieldData)){previousNode.formFieldData.name=bookmark.name;}bookmark.reference.line.children.splice(bookmarkInfo.endIndex,0,bookmark.reference);this.editorHistory.recordChanges(this);}else{this.owner.editorModule.deleteBookmarkInternal(bookmark);this.editorHistory.undoStack.push(this);}};BaseHistoryInfo.prototype.revertComment=function(){var editPosition=this.insertPosition;var comment=this.removedNodes[0];var insert=false;if(this.action==='InsertCommentWidget'){insert=this.editorHistory.isRedoing;}else if(this.action==='DeleteCommentWidget'){insert=this.editorHistory.isUndoing;}if(insert){if(comment){if(comment.isReply){this.owner.editor.addReplyComment(comment,this.insertPosition);}else{this.owner.editor.addCommentWidget(comment,false,true,true);}}}else{var commentElement=this.owner.editor.getCommentElementBox(editPosition);this.owner.editor.deleteCommentWidget(commentElement);}};BaseHistoryInfo.prototype.revertEditRangeRegion=function(){var editRangeInfo=this.removedNodes[0];var editStart=editRangeInfo.editStart;if(this.editorHistory.isUndoing){var user=editStart.user===''?editStart.group:editStart.user;this.owner.editor.updateRangeCollection(editStart,user);editStart.line.children.splice(editRangeInfo.startIndex,0,editStart);editStart.editRangeEnd.line.children.splice(editRangeInfo.endIndex,0,editStart.editRangeEnd);this.editorHistory.recordChanges(this);}else{this.owner.editorModule.removeUserRestrictionsInternal(editStart);this.editorHistory.undoStack.push(this);}this.owner.editor.fireContentChange();};/* eslint-disable  */BaseHistoryInfo.prototype.revert=function(){if(this.action==='FormTextFormat'){this.revertFormTextFormat();return;}if(this.action==='UpdateFormField'){this.revertFormField();return;}if(this.action==='DeleteBookmark'){this.revertBookmark();return;}if(this.action==='RemoveEditRange'){this.revertEditRangeRegion();return;}if(this.action==='InsertCommentWidget'||this.action==='DeleteCommentWidget'){this.revertComment();return;}if(this.action==='ListFormat'&&this.owner.editor.listNumberFormat!==''){var abstractList=this.documentHelper.lists[0].abstractList.levels[this.owner.editor.listLevelNumber];var currentListLevelPattern=abstractList.listLevelPattern;var currentNUmberFormat=abstractList.numberFormat;abstractList.listLevelPattern=this.owner.editor.listLevelPattern;abstractList.numberFormat=this.owner.editor.listNumberFormat;this.owner.editor.listLevelPattern=currentListLevelPattern;this.owner.editor.listNumberFormat=currentNUmberFormat;}this.owner.isShiftingEnabled=true;var selectionStartTextPosition=undefined;var selectionEndTextPosition=undefined;var start=this.selectionStart;var end=this.selectionEnd;var isForwardSelection=TextPosition.isForwardSelection(start,end);// eslint-disable-next-line max-len  
if(this.modifiedProperties.length>0||this.action==='Selection'||this.action==='ClearCharacterFormat'||this.action==='ClearParagraphFormat'){selectionStartTextPosition=this.owner.selection.getTextPosBasedOnLogicalIndex(start);selectionEndTextPosition=this.owner.selection.getTextPosBasedOnLogicalIndex(end);this.revertModifiedProperties(selectionStartTextPosition,selectionEndTextPosition);}else{var sel=this.owner.selection;var deletedNodes=this.removedNodes;this.removedNodesIn=[];if(sf.base.isNullOrUndefined(this.endPosition)){this.endPosition=this.insertPosition;}var isForward=TextPosition.isForwardSelection(this.insertPosition,this.endPosition);var insertTextPosition=sel.getTextPosBasedOnLogicalIndex(isForward?this.insertPosition:this.endPosition);var endTextPosition=sel.getTextPosBasedOnLogicalIndex(isForward?this.endPosition:this.insertPosition);if(this.lastElementRevision&&this.editorHistory.isUndoing){if(sf.base.isNullOrUndefined(this.endRevisionLogicalIndex)){this.updateEndRevisionInfo();}}if(this.action==='ClearRevisions'){this.undoRevisionForElements(insertTextPosition,endTextPosition,deletedNodes[deletedNodes.length-1]);deletedNodes=[];}if(this.action==='Uppercase'){sel.selectPosition(insertTextPosition,endTextPosition);this.editorHistory.currentBaseHistoryInfo=this;var editModule=this.owner.editorModule;editModule.changeSelectedTextCase(sel,insertTextPosition,endTextPosition,this.action.toString(),deletedNodes);editModule.reLayout(sel);return;}if(insertTextPosition.isAtSamePosition(endTextPosition)){sel.selectContent(insertTextPosition,true);}else{sel.selectPosition(insertTextPosition,endTextPosition);}if(this.action==='InsertHyperlink'&&this.editorHistory.isRedoing){var fieldBegin=this.owner.selection.getHyperlinkField();if(!sf.base.isNullOrUndefined(fieldBegin)){var offset=fieldBegin.line.getOffset(fieldBegin,0);insertTextPosition.setPositionParagraph(fieldBegin.line,offset);this.owner.selection.start.setPositionInternal(insertTextPosition);offset=fieldBegin.fieldEnd.line.getOffset(fieldBegin.fieldEnd,1);endTextPosition.setPositionParagraph(fieldBegin.fieldEnd.line,offset);}}this.editorHistory.currentBaseHistoryInfo=this;this.selectionStart=this.insertPosition;this.insertPosition=undefined;this.selectionEnd=this.endPosition;this.endPosition=undefined;var isRemoveContent=false;if(this.endRevisionLogicalIndex&&deletedNodes.length>0){if(this.editorHistory.isUndoing||this.editorHistory.isRedoing&&insertTextPosition.isAtSamePosition(endTextPosition)){var currentPosition=sel.getTextPosBasedOnLogicalIndex(this.endRevisionLogicalIndex);sel.selectPosition(insertTextPosition,currentPosition);}if(this.editorHistory.isUndoing){this.owner.editor.deleteSelectedContents(sel,true);}}if(!insertTextPosition.isAtSamePosition(endTextPosition)){isRemoveContent=this.action==='BackSpace'||this.action==='Delete'||this.action==='ClearCells'||this.action==='DeleteCells';var skipDelete=deletedNodes.length>0&&this.action==='ParaMarkTrack'||this.action==='ClearRevisions'||this.action==='AcceptTOC';if(!isRemoveContent&&this.action!=='MergeCells'&&this.action!=='InsertRowAbove'&&this.action!=='InsertRowBelow'&&this.action!=='InsertColumnLeft'&&this.action!=='InsertColumnRight'&&this.action!=='Borders'&&this.action!=='DeleteTable'&&this.action!=='DeleteColumn'&&this.action!=='DeleteRow'){sel.end.setPositionInternal(endTextPosition);if(!this.owner.selection.isEmpty&&!skipDelete){if(this.editorHistory.isRedoing&&this.action!=='Accept Change'&&this.action!=='ParaMarkTrack'&&this.action!=='ParaMarkReject'&&this.action!=='RemoveRowTrack'){this.owner.editorModule.removeSelectedContents(sel);}else{this.owner.editorModule.deleteSelectedContents(sel,true);}if(!sf.base.isNullOrUndefined(this.editorHistory.currentHistoryInfo)&&this.editorHistory.currentHistoryInfo.action==='PageBreak'&&this.documentHelper.blockToShift){this.documentHelper.layout.shiftLayoutedItems(false);}}}}var isRedoAction=this.editorHistory.isRedoing&&!isRemoveContent;isRemoveContent=this.lastElementRevision?false:isRemoveContent;this.revertModifiedNodes(deletedNodes,isRedoAction,isForwardSelection?start:end,start===end);if(isRemoveContent){this.removeContent(insertTextPosition,endTextPosition);}//this.owner.editorModule.reLayout(this.documentHelper.selection);
}var isSelectionChanged=false;var updateSelection=false;if(!sf.base.isNullOrUndefined(this.editorHistory.currentHistoryInfo)&&(this.editorHistory.currentHistoryInfo.action==='Reject All'||this.editorHistory.currentHistoryInfo.action==='Accept All')){updateSelection=true;}if(!this.owner.trackChangesPane.isTrackingPageBreak&&((this.editorHistory.isUndoing||this.endRevisionLogicalIndex||this.action==='RemoveRowTrack'||updateSelection)&&sf.base.isNullOrUndefined(this.editorHistory.currentHistoryInfo)||updateSelection)||(this.action==='InsertRowAbove'||this.action==='Borders'||this.action==='InsertRowBelow'||this.action==='InsertColumnLeft'||this.action==='InsertColumnRight'||this.action==='Accept Change')&&(this.editorHistory.isRedoing||this.editorHistory.currentHistoryInfo.action==='Paste')){if(this.action==='RemoveRowTrack'&&this.editorHistory.isRedoing){selectionStartTextPosition=this.owner.selection.getTextPosBasedOnLogicalIndex(this.selectionStart);selectionEndTextPosition=this.owner.selection.getTextPosBasedOnLogicalIndex(this.selectionEnd);}else{selectionStartTextPosition=this.owner.selection.getTextPosBasedOnLogicalIndex(start);selectionEndTextPosition=this.owner.selection.getTextPosBasedOnLogicalIndex(end);}this.owner.selection.selectRange(selectionStartTextPosition,selectionEndTextPosition);isSelectionChanged=true;}this.owner.trackChangesPane.isTrackingPageBreak=false;// Updates insert position of history info instance.
this.insertPosition=start;this.endPosition=end;if(!sf.base.isNullOrUndefined(this.editorHistory.currentHistoryInfo)&&(this.editorHistory.currentHistoryInfo.action==='Accept All'||this.editorHistory.currentHistoryInfo.action==='Reject All')){if(this.owner.documentHelper.blockToShift){this.owner.documentHelper.layout.shiftLayoutedItems(false);}}this.owner.editorModule.reLayout(this.owner.selection,this.owner.selection.isEmpty);if(isSelectionChanged){this.documentHelper.scrollToPosition(this.owner.selection.start,this.owner.selection.end);}this.highlightListText();};BaseHistoryInfo.prototype.highlightListText=function(){if(!sf.base.isNullOrUndefined(this.editorHistory.currentHistoryInfo)){if(this.action==='ListCharacterFormat'||this.editorHistory.currentHistoryInfo.action==='ListSelect'&&this.action==='ListFormat'){var selectionStartTextPosition=this.owner.selection.getTextPosBasedOnLogicalIndex(this.selectionStart);var widget=selectionStartTextPosition.currentWidget;this.documentHelper.selection.highlightListText(widget);}}};BaseHistoryInfo.prototype.removeContent=function(insertTextPosition,endTextPosition){//If the base parent of the insert text position and end text position is null 
//then the paragraphs already removed.
//Example scenario: In table editing that is delete cells operation 
// we will backed up the entire table ad it will be replaced on undo operation.
//At that time if the positions are in table 
//which is already replaced in undo (revert modified nodes method) then the base parent of the paragraph will be null.
//So again, selecting the content and deleting is unnecessary
// and it will cause improper position updates and null reference exceptions. 
if(!sf.base.isNullOrUndefined(insertTextPosition.paragraph.containerWidget)&&insertTextPosition.paragraph.containerWidget instanceof BodyWidget&&!sf.base.isNullOrUndefined(endTextPosition.paragraph.containerWidget)&&endTextPosition.paragraph.containerWidget instanceof BodyWidget||!sf.base.isNullOrUndefined(insertTextPosition.paragraph.containerWidget)&&!sf.base.isNullOrUndefined(endTextPosition.paragraph.containerWidget)&&insertTextPosition.paragraph.containerWidget instanceof TableCellWidget&&endTextPosition.paragraph.containerWidget instanceof TableCellWidget&&!sf.base.isNullOrUndefined(insertTextPosition.paragraph.bodyWidget)||!sf.base.isNullOrUndefined(insertTextPosition.paragraph.containerWidget)&&!sf.base.isNullOrUndefined(endTextPosition.paragraph.containerWidget)&&insertTextPosition.paragraph.containerWidget instanceof TextFrame&&endTextPosition.paragraph.containerWidget instanceof TextFrame){//Removes if any empty paragraph is added while delete.
this.owner.selection.selectRange(insertTextPosition,endTextPosition);var isDelete=false;if(this.action==='BackSpace'||this.action==='Uppercase'||this.action==='RemoveRowTrack'){isDelete=true;}this.owner.editorModule.deleteSelectedContents(this.owner.selection,isDelete);}};BaseHistoryInfo.prototype.updateEndRevisionInfo=function(){this.lastElementRevision=this.checkAdjacentNodeForMarkedRevision(this.lastElementRevision);var currentRevision=this.retrieveEndPosition(this.lastElementRevision);var blockInfo=this.owner.selection.getParagraphInfo(currentRevision);this.endRevisionLogicalIndex=this.owner.selection.getHierarchicalIndex(blockInfo.paragraph,blockInfo.offset.toString());this.lastElementRevision.isMarkedForRevision=false;};BaseHistoryInfo.prototype.retrieveEndPosition=function(elementBox){var endPosition=new TextPosition(this.owner);var offset=elementBox.line.getOffset(elementBox,0)+elementBox.length;endPosition.setPositionFromLine(elementBox.line,offset);return endPosition;};/**
     * Method to retrieve exact spitted node which is marked as last available element.
     *
     * @param {ElementBox} elementBox - Specifies the element box
     * @returns {ElementBox} - Returns element box
     */BaseHistoryInfo.prototype.checkAdjacentNodeForMarkedRevision=function(elementBox){var nextItem=elementBox.nextNode;var markedNode;while(!sf.base.isNullOrUndefined(nextItem)&&nextItem.isMarkedForRevision){markedNode=nextItem;nextItem=nextItem.nextNode;}return!sf.base.isNullOrUndefined(markedNode)?markedNode:elementBox;};BaseHistoryInfo.prototype.revertModifiedProperties=function(start,end){if(this.action==='CellFormat'||this.action==='CellOptions'||this.action==='TableOptions'){this.owner.isShiftingEnabled=false;}this.owner.selection.selectRange(start,end);if(this.action==='RowResizing'||this.action==='CellResizing'){this.revertResizing();}else if(this.action==='CellOptions'||this.action==='TableOptions'){this.revertTableDialogProperties(this.action);}else if(this.action!=='Selection'){this.revertProperties();}};// Redoes the Action
BaseHistoryInfo.prototype.redoAction=function(){var editor=this.owner.editorModule;switch(this.action){case'BackSpace':editor.singleBackspace(this.owner.selection,true);break;case'Delete':editor.singleDelete(this.owner.selection,true);break;case'DeleteTable':editor.deleteTable();break;case'DeleteColumn':editor.deleteColumn();break;case'DeleteRow':editor.deleteRow();break;case'MergeCells':editor.mergeSelectedCellsInTable();break;case'InsertRowAbove':editor.insertRow(true);break;case'InsertRowBelow':editor.insertRow(false);break;case'InsertColumnLeft':editor.insertColumn(true);break;case'InsertColumnRight':editor.insertColumn(true);break;case'SectionBreak':editor.insertSection(this.owner.selection,true);break;case'TableAutoFitToContents':editor.autoFitTable('FitToContents');break;case'TableAutoFitToWindow':editor.autoFitTable('FitToWindow');break;case'TableFixedColumnWidth':editor.autoFitTable('FixedColumnWidth');break;case'RemoveRowTrack':this.owner.selection.handleAcceptReject(true);break;}};BaseHistoryInfo.prototype.revertModifiedNodes=function(deletedNodes,isRedoAction,start,isEmptySelection){if(isRedoAction&&(this.action==='BackSpace'||this.action==='Delete'||this.action==='DeleteTable'||this.action==='DeleteColumn'||this.action==='DeleteRow'||this.action==='InsertRowAbove'||this.action==='InsertRowBelow'||this.action==='InsertColumnLeft'||this.action==='InsertColumnRight'||this.action==='MergeCells'||this.action==='SectionBreak'||this.action==='TableAutoFitToContents'||this.action==='TableAutoFitToWindow'||this.action==='TableFixedColumnWidth')){this.redoAction();if(this.action==='SectionBreak'){return;}}if(deletedNodes.length>0){if(this.editorHistory.isUndoing&&(this.action==='RemoveRowTrack'||this.action==='DeleteCells'||this.action==='DeleteColumn'||this.action==='DeleteRow'||this.action==='MergeCells')||this.action==='InsertRowAbove'||this.action==='InsertRowBelow'||this.action==='InsertColumnLeft'||this.action==='ClearCells'||this.action==='InsertColumnRight'||this.action==='Borders'||this.action==='TableAutoFitToContents'||this.action==='TableAutoFitToWindow'||this.action==='TableFixedColumnWidth'||this.action==='RemoveRowTrack'){var insertIndex=this.selectionStart;var block=this.owner.editorModule.getBlock({index:insertIndex}).node;var lastNode=deletedNodes[deletedNodes.length-1];if((block instanceof TableWidget||block.previousRenderedWidget instanceof TableWidget||block.isInsideTable)&&lastNode instanceof TableWidget){if(block instanceof ParagraphWidget&&!block.isInsideTable){block=block.previousRenderedWidget;}else if(block instanceof ParagraphWidget&&block.isInsideTable){block=block.associatedCell.ownerTable;}block=block.combineWidget(this.viewer);this.owner.editorModule.insertTableInternal(block,lastNode,false);deletedNodes.splice(deletedNodes.indexOf(lastNode),1);}else if(lastNode instanceof TableWidget){this.owner.editorModule.insertBlock(lastNode);}}else{var initialStart=start;var block=this.owner.editorModule.getBlock({index:initialStart}).node;// initialStart = blockObj.position;
if(deletedNodes.length>0&&(this.action==='BackSpace'&&isEmptySelection||!(block instanceof TableWidget)&&!(block instanceof HeaderFooterWidget))){var lastNode=deletedNodes[0];if(this.action==='TrackingPageBreak'||this.action==='SectionBreak'&&lastNode instanceof BodyWidget||!sf.base.isNullOrUndefined(this.editorHistory.currentHistoryInfo)&&this.editorHistory.currentHistoryInfo.action==='PageBreak'){lastNode=deletedNodes[1];}if(lastNode instanceof ParagraphWidget&&this.owner.selection.start.offset>0){this.owner.editorModule.insertNewParagraphWidget(lastNode,true);if(lastNode.characterFormat.removedIds.length>0){this.owner.editor.constructRevisionFromID(lastNode.characterFormat,undefined);}deletedNodes.splice(deletedNodes.indexOf(lastNode),1);if(sf.base.isNullOrUndefined(block)){var nextBlock=this.documentHelper.selection.getNextParagraphBlock(lastNode.getSplitWidgets().pop());this.owner.selection.getNextRenderedBlock(lastNode);if(sf.base.isNullOrUndefined(nextBlock)){//Sets the selection as starting of last paragraph.
this.owner.selection.selectParagraphInternal(lastNode,true);}}}if(lastNode instanceof TableWidget&&this.owner.selection.start.offset>0){var firstBlock=deletedNodes[deletedNodes.length-1];if(firstBlock instanceof ParagraphWidget){this.owner.editorModule.insertNewParagraphWidget(firstBlock,true);deletedNodes.splice(deletedNodes.indexOf(firstBlock),1);if(sf.base.isNullOrUndefined(block)){var nextBlock=this.documentHelper.selection.getNextParagraphBlock(firstBlock.getSplitWidgets().pop());if(sf.base.isNullOrUndefined(nextBlock)){//Sets the selection as starting of last paragraph.
this.owner.selection.selectParagraphInternal(firstBlock,true);}}}}}if(deletedNodes.length>0){var firstNode=deletedNodes[deletedNodes.length-1];if(block instanceof TableWidget){block=block.combineWidget(this.viewer);if(firstNode instanceof TableWidget){this.owner.editorModule.insertTableInternal(block,firstNode,true);deletedNodes.splice(deletedNodes.indexOf(firstNode),1);this.insertPosition=start;var nextWidget=firstNode.getSplitWidgets().pop();if(nextWidget.nextRenderedWidget instanceof TableWidget){block=nextWidget.nextRenderedWidget;}else{initialStart=start;block=this.owner.editorModule.getBlock({index:initialStart}).node;}}}//Checks if first node is paragraph and current insert position is paragraph end.
if(firstNode instanceof ParagraphWidget&&this.owner.selection.start.offset>0&&this.owner.selection.start.offset===this.owner.selection.getLineLength(this.owner.selection.start.paragraph.lastChild)){var editor=this.owner.editorModule;editor.insertNewParagraphWidget(firstNode,false);if(firstNode.characterFormat.removedIds.length>0){this.owner.editor.constructRevisionFromID(firstNode.characterFormat,undefined);}deletedNodes.splice(deletedNodes.indexOf(firstNode),1);//Removes the intermediate empty paragraph instance.
if(this.action!=='Paste'){editor.removeBlock(this.owner.selection.start.paragraph);}var paragraph=this.documentHelper.selection.getNextParagraphBlock(firstNode.getSplitWidgets().pop());if(!sf.base.isNullOrUndefined(paragraph)){this.owner.selection.selectParagraphInternal(paragraph,true);}}else if(deletedNodes[0]instanceof TableWidget&&deletedNodes.length!==1){var nextNode=deletedNodes[1];if(nextNode instanceof ParagraphWidget&&nextNode.isEmpty()){deletedNodes.splice(deletedNodes.indexOf(nextNode),1);}}}if(deletedNodes.length>0){if(block instanceof TableWidget){block=block.combineWidget(this.viewer);}this.insertRemovedNodes(deletedNodes,block);}}}};BaseHistoryInfo.prototype.insertRemovedNodes=function(deletedNodes,block){for(var i=deletedNodes.length-1,index=0;i>-1;i--){var node=deletedNodes[i];if(node instanceof ElementBox){this.owner.editorModule.insertInlineInSelection(this.owner.selection,node);}else if(node instanceof BlockWidget){if(node instanceof TableRowWidget){if(block instanceof TableWidget){block.childWidgets.splice(index,0,node);this.owner.editorModule.updateNextBlocksIndex(node,true);if(i===0||!(deletedNodes[i-1]instanceof TableRowWidget)){this.documentHelper.layout.layoutBodyWidgetCollection(block.index,block.containerWidget,block,false);}}}else if(block instanceof TableWidget){this.owner.editorModule.insertBlockTable(this.owner.selection,node,block);}else{this.owner.editorModule.insertBlock(node);}}else if(node instanceof WCharacterFormat){var insertIndex=this.selectionStart;var wiget=this.owner.editorModule.getBlock({index:insertIndex}).node;if(wiget instanceof ParagraphWidget){if(node.removedIds.length>0){wiget.characterFormat.removedIds=node.removedIds.slice();this.owner.editor.constructRevisionFromID(wiget.characterFormat,true);}else if(wiget.characterFormat.revisions.length>0){wiget.characterFormat=node.cloneFormat();}}}else if(node instanceof BodyWidget){this.owner.editorModule.insertSection(this.owner.selection,false);}else if(typeof node==='string'&&this.action==='AcceptTOC'){var insertIndex=this.selectionStart;var widget=this.owner.editorModule.getBlock({index:insertIndex}).node;var endWidget=this.owner.editorModule.getBlock({index:this.selectionEnd}).node;var currentRevision=this.owner.documentHelper.revisionsInternal.get(node);if(this.editorHistory.isUndoing){while(widget instanceof ParagraphWidget&&widget!==endWidget){this.owner.editor.insertRevisionForBlock(widget,currentRevision.revisionType,true,currentRevision);widget=this.documentHelper.selection.getNextParagraphBlock(widget.getSplitWidgets().pop());}this.owner.editor.insertRevisionForBlock(endWidget,currentRevision.revisionType,true,currentRevision);}else{while(currentRevision.range.length>0){var item=currentRevision.range[0];var revisionIndex=item.revisions.indexOf(currentRevision);if(revisionIndex>=0){item.revisions.splice(revisionIndex,1);var rangeIndex=currentRevision.range.indexOf(item);currentRevision.range.splice(rangeIndex,1);}if(currentRevision.range.length===0){this.owner.revisions.remove(currentRevision);}}}this.owner.editor.addRemovedNodes(currentRevision.revisionID);}}deletedNodes=[];};BaseHistoryInfo.prototype.undoRevisionForElements=function(start,end,id){var currentPara=start.paragraph;var endPara=end.paragraph;var currentRevision=this.documentHelper.revisionsInternal.get(id);var startoffset=this.owner.selection.getParagraphInfo(start).offset;var endoffset=this.owner.selection.getParagraphInfo(end).offset;var isSamePara=start.paragraph===end.paragraph;if(this.editorHistory.isUndoing){while(currentPara!==endPara){this.owner.editor.applyRevisionForCurrentPara(currentPara,startoffset,currentPara.getLength(),id,true);currentPara=this.documentHelper.selection.getNextParagraphBlock(currentPara.getSplitWidgets().pop());if(currentPara!==endPara){startoffset=0;}}if(currentPara===endPara){if(!isSamePara){startoffset=0;}this.owner.editor.applyRevisionForCurrentPara(currentPara,startoffset,endoffset,id,false);}}else{while(currentRevision.range.length>0){var item=currentRevision.range[0];var revisionIndex=item.revisions.indexOf(currentRevision);if(revisionIndex>=0){item.revisions.splice(revisionIndex,1);var rangeIndex=currentRevision.range.indexOf(item);currentRevision.range.splice(rangeIndex,1);}if(currentRevision.range.length===0){this.owner.revisions.remove(currentRevision);}}}this.removedNodes.push(id);};BaseHistoryInfo.prototype.revertResizing=function(){this.editorHistory.currentBaseHistoryInfo=this;if(this.action==='RowResizing'){if(this.modifiedProperties[0]instanceof RowHistoryFormat){this.modifiedProperties[0].revertChanges(this.editorHistory.isRedoing,this.owner);}}else{if(this.modifiedProperties[0]instanceof TableHistoryInfo){//selected cell resizing the condition checks done based on the selected widgets only. so need to highlight the selection.
if(this.owner.selection.selectedWidgets.length===0){this.owner.selection.highlightSelection(true);}var prevTableHistoryInfo=this.modifiedProperties[0];var position=prevTableHistoryInfo.tableHierarchicalIndex;var block=this.owner.editorModule.getBlock({index:position}).node;if(block instanceof TableWidget){var tableResize=this.owner.editorModule.tableResize;this.owner.editor.setOffsetValue(this.owner.selection);block=block.combineWidget(this.owner.viewer);tableResize.currentResizingTable=block;this.modifiedProperties.splice(0,1);if(this.editorHistory.isUndoing||this.editorHistory.isRedoing){var tableHistoryInfoCurrent=new TableHistoryInfo(block,this.owner);this.modifiedProperties.splice(0,0,tableHistoryInfoCurrent);this.owner.isLayoutEnabled=false;tableResize.applyProperties(tableResize.currentResizingTable,prevTableHistoryInfo);tableResize.currentResizingTable.isGridUpdated=true;this.owner.isLayoutEnabled=true;tableResize.updateGridValue(tableResize.currentResizingTable,false);prevTableHistoryInfo.destroy();prevTableHistoryInfo=undefined;}}}}};BaseHistoryInfo.prototype.revertTableDialogProperties=function(action){this.owner.isShiftingEnabled=false;this.editorHistory.currentBaseHistoryInfo=this;this.currentPropertyIndex=0;if(action==='CellOptions'){var selection=this.owner.selection;var cellFormat=this.modifiedProperties[0];this.owner.editorModule.updateCellMargins(selection,cellFormat);}else if(action==='TableOptions'){//this.owner.tableOptionsDialogModule.applyTableOptionsHelper(<WTableFormat>this.modifiedProperties[0]);
}this.currentPropertyIndex=0;this.owner.isShiftingEnabled=true;};BaseHistoryInfo.prototype.addModifiedPropertiesForSection=function(format,property,value){if(this.editorHistory.isUndoing||this.editorHistory.isRedoing){var modifiedProperties=this.modifiedProperties;var previousFormat=this.currentPropertyIndex<modifiedProperties.length?modifiedProperties[this.currentPropertyIndex]:modifiedProperties[modifiedProperties.length-1];if(sf.base.isNullOrUndefined(property)){value=previousFormat;if(this.currentPropertyIndex<this.modifiedProperties.length){this.modifiedProperties[this.currentPropertyIndex]=format.cloneFormat();}else{this.modifiedProperties[this.modifiedProperties.length-1]=format.cloneFormat();}}else{value=previousFormat.getPropertyValue(property);previousFormat.copyFormat(format);}this.currentPropertyIndex++;}else{if(sf.base.isNullOrUndefined(property)){this.modifiedProperties.push(format.cloneFormat());}else{var currentFormat=new WSectionFormat();currentFormat.copyFormat(format);this.modifiedProperties.push(currentFormat);}}return value;};BaseHistoryInfo.prototype.addModifiedProperties=function(format,property,value){if(this.editorHistory.isUndoing||this.editorHistory.isRedoing){var previousFormat=this.currentPropertyIndex<this.modifiedProperties.length?this.modifiedProperties[this.currentPropertyIndex]:this.modifiedProperties[this.modifiedProperties.length-1];var skipRemove=false;if(format.ownerBase instanceof ElementBox){var prevLength=this.modifiedNodeLength[this.currentPropertyIndex];if(format.ownerBase.length<prevLength){skipRemove=true;this.modifiedNodeLength[this.currentPropertyIndex]=format.ownerBase.length;this.modifiedNodeLength.splice(this.currentPropertyIndex+1,0,prevLength-format.ownerBase.length);//Adds a copy of character format at next position for splitted inline.
var nextFormat=new WCharacterFormat(undefined);nextFormat.copyFormat(previousFormat);this.modifiedProperties.splice(this.currentPropertyIndex+1,0,nextFormat);}}if(this.action==='ClearCharacterFormat'){if(this.editorHistory.isUndoing){value=previousFormat;if(!skipRemove){this.modifiedProperties.splice(this.currentPropertyIndex,1);this.currentPropertyIndex--;}}else{this.modifiedProperties.push(format.cloneFormat());}}else{value=previousFormat;if(this.currentPropertyIndex<this.modifiedProperties.length){this.modifiedProperties[this.currentPropertyIndex]=format.cloneFormat();}else{this.modifiedProperties[this.modifiedProperties.length-1]=format.cloneFormat();}}this.currentPropertyIndex++;}else{if(sf.base.isNullOrUndefined(property)){this.modifiedProperties.push(format.cloneFormat());}else{var currentFormat=new WCharacterFormat(undefined);currentFormat.copyFormat(format);this.modifiedProperties.push(currentFormat);}if(format.ownerBase instanceof ElementBox){this.modifiedNodeLength.push(format.ownerBase.length);}else{this.modifiedNodeLength.push(0);}}return value;};BaseHistoryInfo.prototype.addModifiedPropertiesForParagraphFormat=function(format,property,value){if(this.editorHistory.isUndoing||this.editorHistory.isRedoing){var previousFormat=this.currentPropertyIndex<this.modifiedProperties.length?this.modifiedProperties[this.currentPropertyIndex]:this.modifiedProperties[this.modifiedProperties.length-1];if(this.action==='ClearParagraphFormat'){if(this.editorHistory.isUndoing){value=previousFormat;this.modifiedProperties.splice(this.currentPropertyIndex,1);this.currentPropertyIndex--;}else{this.modifiedProperties.push(format.cloneFormat());}this.currentPropertyIndex++;return value;}if(sf.base.isNullOrUndefined(property)){value=previousFormat;if(this.currentPropertyIndex<this.modifiedProperties.length){this.modifiedProperties[this.currentPropertyIndex]=format.cloneFormat();}else{this.modifiedProperties[this.modifiedProperties.length-1]=format.cloneFormat();}this.currentPropertyIndex++;return value;}if(property==='listFormat'){value=new WParagraphFormat(undefined);value.copyFormat(previousFormat);previousFormat.listFormat=new WListFormat();previousFormat.listFormat.copyFormat(format.listFormat);this.currentPropertyIndex++;return value;}if(property==='styleName'){if(!sf.base.isNullOrUndefined(previousFormat.baseStyle)){value=new WParagraphStyle();value.copyStyle(previousFormat.baseStyle);this.currentPropertyIndex++;if(!sf.base.isNullOrUndefined(format.baseStyle)){previousFormat.baseStyle=new WParagraphStyle();previousFormat.baseStyle.copyStyle(format.baseStyle);}return value;}else{if(!sf.base.isNullOrUndefined(format.baseStyle)){previousFormat.baseStyle=new WParagraphStyle();previousFormat.baseStyle.copyStyle(format.baseStyle);}return undefined;}}value=previousFormat.getPropertyValue(property);previousFormat.copyFormat(format);this.currentPropertyIndex++;}else{if(sf.base.isNullOrUndefined(property)){this.modifiedProperties.push(format.cloneFormat());}else{var currentFormat=new WParagraphFormat(undefined);currentFormat.copyFormat(format);this.modifiedProperties.push(currentFormat);}}return value;};BaseHistoryInfo.prototype.addModifiedPropertiesForContinueNumbering=function(paragraphFormat,value){if(this.editorHistory.isUndoing||this.editorHistory.isRedoing){var previousFormat=this.currentPropertyIndex<this.modifiedProperties.length?this.modifiedProperties[this.currentPropertyIndex]:this.modifiedProperties[this.modifiedProperties.length-1];value=previousFormat;if(this.currentPropertyIndex<this.modifiedProperties.length){this.modifiedProperties[this.currentPropertyIndex]=paragraphFormat.cloneFormat();}else{this.modifiedProperties[this.modifiedProperties.length-1]=paragraphFormat.cloneFormat();}this.currentPropertyIndex++;return value;}else{var currentFormat=new WParagraphFormat();currentFormat.copyFormat(paragraphFormat);this.modifiedProperties.push(currentFormat);}return value;};BaseHistoryInfo.prototype.addModifiedPropertiesForRestartNumbering=function(listFormat,value){if(this.editorHistory.isUndoing||this.editorHistory.isRedoing){var listId=this.currentPropertyIndex<this.modifiedProperties.length?this.modifiedProperties[this.currentPropertyIndex]:this.modifiedProperties[this.modifiedProperties.length-1];value=listId;if(this.currentPropertyIndex<this.modifiedProperties.length){this.modifiedProperties[this.currentPropertyIndex]=listFormat.listId;}else{this.modifiedProperties[this.modifiedProperties.length-1]=listFormat.listId;}this.currentPropertyIndex++;return value;}else{this.modifiedProperties.push(listFormat.listId);}return value;};BaseHistoryInfo.prototype.addModifiedPropertiesForList=function(listLevel){var value;if(this.editorHistory.isUndoing||this.editorHistory.isRedoing){var previousLevel=this.currentPropertyIndex<this.modifiedProperties.length?this.modifiedProperties[this.currentPropertyIndex]:this.modifiedProperties[this.modifiedProperties.length-1];value=previousLevel;previousLevel=new ModifiedLevel(listLevel,this.owner.editorModule.cloneListLevel(listLevel));if(this.currentPropertyIndex<this.modifiedProperties.length){this.modifiedProperties[this.currentPropertyIndex]=previousLevel;}else{this.modifiedProperties[this.modifiedProperties.length-1]=previousLevel;}this.currentPropertyIndex++;}else{this.modifiedProperties.push(new ModifiedLevel(listLevel,this.owner.editorModule.cloneListLevel(listLevel)));value=listLevel;}return value;};BaseHistoryInfo.prototype.revertProperties=function(){this.editorHistory.currentBaseHistoryInfo=this;this.currentPropertyIndex=0;var property=this.getProperty();this.viewer.owner.editorModule.setOffsetValue(this.documentHelper.selection);if(this.action==='ClearCharacterFormat'||this.modifiedProperties[0]instanceof WCharacterFormat){if(this.action==='ListCharacterFormat'){this.owner.editorModule.updateListCharacterFormat(this.documentHelper.selection,property,undefined);return;}this.owner.editorModule.updateSelectionCharacterFormatting(property,undefined,false);}else if(this.action==='ClearParagraphFormat'||this.modifiedProperties[0]instanceof WParagraphFormat){if(this.action==='ContinueNumbering'){this.owner.editorModule.revertContinueNumbering(this.owner.selection,this.modifiedProperties[0]);return;}if(this.action==='StyleName'&&this.modifiedProperties[0]instanceof WParagraphFormat){this.owner.editorModule.updateSelectionParagraphFormatting(property,this.modifiedProperties[0].baseStyle,false);return;}this.owner.editor.setPreviousBlockToLayout();var selection=this.owner.documentHelper.selection;var isBidiList=(selection.paragraphFormat.bidi||(this.modifiedProperties[0]instanceof WParagraphFormat&&this.modifiedProperties[0]).bidi)&&(selection.paragraphFormat.listId!==-1||property==='listFormat');if(!isBidiList){this.owner.documentHelper.layout.isBidiReLayout=true;}this.owner.editorModule.updateSelectionParagraphFormatting(property,undefined,false);if(!isBidiList){this.owner.documentHelper.layout.isBidiReLayout=false;}}else if(this.modifiedProperties[0]instanceof WSectionFormat){this.owner.editorModule.updateSectionFormat(property,undefined);}else if(this.action==='RestartNumbering'){this.owner.editorModule.restartListAtInternal(this.owner.selection,this.modifiedProperties[0]);return;}else if(this.modifiedProperties[0]instanceof ImageInfo){this.owner.selection.updateImageSize(this.modifiedProperties[0]);}else if(this.modifiedProperties[0]instanceof ModifiedLevel){var modified=new Dictionary();for(var i=0;i<this.modifiedProperties.length;i++){var modifiedLevel=this.modifiedProperties[i];// modified.modifiedLevels.add(modifiedLevel.ownerListLevel.levelNumber, modifiedLevel);
modified.add(i,modifiedLevel);}this.editorHistory.updateListChanges(modified);modified.destroy();modified=undefined;}else if(this.modifiedProperties[0]instanceof WTableFormat){this.owner.editorModule.updateTableFormat(this.owner.selection,property,undefined);}else if(this.modifiedProperties[0]instanceof WCellFormat){this.owner.isShiftingEnabled=true;this.owner.editorModule.updateCellFormat(this.owner.selection,property,undefined);}else if(this.modifiedProperties[0]instanceof WRowFormat){this.owner.editorModule.updateRowFormat(this.owner.selection,property,undefined);}this.currentPropertyIndex=0;if(this.action==='ClearCharacterFormat'||this.action==='ClearParagraphFormat'){this.owner.editorModule.getOffsetValue(this.documentHelper.selection);}};BaseHistoryInfo.prototype.addModifiedCellOptions=function(applyFormat,format,table){var currentFormat;if(sf.base.isNullOrUndefined(applyFormat.bottomMargin)&&sf.base.isNullOrUndefined(applyFormat.topMargin)&&sf.base.isNullOrUndefined(applyFormat.rightMargin)&&sf.base.isNullOrUndefined(applyFormat.leftMargin)){currentFormat=this.copyCellOptions(table.tableFormat);}else{currentFormat=this.copyCellOptions(applyFormat);}if(this.editorHistory.isUndoing||this.editorHistory.isRedoing){var previousFormat=this.currentPropertyIndex<this.modifiedProperties.length?this.modifiedProperties[this.currentPropertyIndex]:this.modifiedProperties[this.modifiedProperties.length-1];format=previousFormat;if(this.currentPropertyIndex<this.modifiedProperties.length){this.modifiedProperties[this.currentPropertyIndex]=this.copyCellOptions(applyFormat);}else{this.modifiedProperties[this.modifiedProperties.length-1]=this.copyCellOptions(applyFormat);}this.currentPropertyIndex++;return format;}else{this.modifiedProperties.push(currentFormat);}return format;};BaseHistoryInfo.prototype.copyCellOptions=function(format){var cellFormat=new WCellFormat();cellFormat.topMargin=format.topMargin;cellFormat.rightMargin=format.rightMargin;cellFormat.bottomMargin=format.bottomMargin;cellFormat.leftMargin=format.leftMargin;return cellFormat;};BaseHistoryInfo.prototype.addModifiedTableOptions=function(format){var currentFormat=this.copyTableOptions(format);if(this.editorHistory.isUndoing||this.editorHistory.isRedoing){var previousFormat=this.currentPropertyIndex<this.modifiedProperties.length?this.modifiedProperties[this.currentPropertyIndex]:this.modifiedProperties[this.modifiedProperties.length-1];if(this.currentPropertyIndex<this.modifiedProperties.length){this.modifiedProperties.splice(this.currentPropertyIndex,1,currentFormat);}else{this.modifiedProperties.splice(this.modifiedProperties.length-1,1,currentFormat);}this.currentPropertyIndex++;}else{this.modifiedProperties.push(currentFormat);}};BaseHistoryInfo.prototype.copyTableOptions=function(format){var tableFormat=new WTableFormat();tableFormat.topMargin=format.topMargin;tableFormat.rightMargin=format.rightMargin;tableFormat.bottomMargin=format.bottomMargin;tableFormat.leftMargin=format.leftMargin;tableFormat.cellSpacing=format.cellSpacing;return tableFormat;};BaseHistoryInfo.prototype.getProperty=function(){switch(this.action){case'Bold':return'bold';case'Italic':return'italic';case'FontColor':return'fontColor';case'FontFamily':return'fontFamily';case'FontSize':return'fontSize';case'HighlightColor':return'highlightColor';case'BaselineAlignment':return'baselineAlignment';case'Strikethrough':return'strikethrough';case'Underline':return'underline';case'AfterSpacing':return'afterSpacing';case'BeforeSpacing':return'beforeSpacing';case'LeftIndent':return'leftIndent';case'RightIndent':return'rightIndent';case'FirstLineIndent':return'firstLineIndent';case'LineSpacingType':return'lineSpacingType';case'LineSpacing':return'lineSpacing';case'TextAlignment':return'textAlignment';case'ListFormat':return'listFormat';case'PageHeight':return'pageHeight';case'PageWidth':return'pageWidth';case'TableAlignment':return'tableAlignment';case'TableLeftIndent':return'leftIndent';case'DefaultCellSpacing':return'cellSpacing';case'LeftMargin':case'CellLeftMargin':case'DefaultCellLeftMargin':return'leftMargin';case'RightMargin':case'CellRightMargin':case'DefaultCellRightMargin':return'rightMargin';case'TopMargin':case'CellTopMargin':case'DefaultCellTopMargin':return'topMargin';case'BottomMargin':case'CellBottomMargin':case'DefaultCellBottomMargin':return'bottomMargin';case'CellContentVerticalAlignment':return'verticalAlignment';case'RowHeight':return'height';case'RowHeightType':return'heightType';case'RowHeader':return'isHeader';case'AllowBreakAcrossPages':return'allowBreakAcrossPages';case'TablePreferredWidth':case'CellPreferredWidth':return'preferredWidth';case'TablePreferredWidthType':case'CellPreferredWidthType':return'preferredWidthType';case'Shading':return'shading';case'StyleName':return'styleName';case'ParagraphBidi':case'TableBidi':return'bidi';case'ContextualSpacing':return'contextualSpacing';}return undefined;};BaseHistoryInfo.prototype.getCharacterPropertyValue=function(property,modifiedProperty){var value;if(property==='bold'){value=modifiedProperty.bold;}else if(property==='italic'){value=modifiedProperty.italic;}else if(property==='fontColor'){value=modifiedProperty.fontColor;}else if(property==='fontFamily'){value=modifiedProperty.fontFamily;}else if(property==='fontSize'){value=modifiedProperty.fontSize;}else if(property==='highlightColor'){value=modifiedProperty.highlightColor;}else if(property==='baselineAlignment'){value=modifiedProperty.baselineAlignment;}else if(property==='strikethrough'){value=modifiedProperty.strikethrough;}else if(property==='underline'){value=modifiedProperty.underline;}return value;};BaseHistoryInfo.prototype.addModifiedTableProperties=function(format,property,value){if(this.editorHistory.isUndoing||this.editorHistory.isRedoing){var previousTableFormat=this.currentPropertyIndex<this.modifiedProperties.length?this.modifiedProperties[this.currentPropertyIndex]:this.modifiedProperties[this.modifiedProperties.length-1];if(sf.base.isNullOrUndefined(property)){value=previousTableFormat;if(this.currentPropertyIndex<this.modifiedProperties.length){this.modifiedProperties[this.currentPropertyIndex]=format.cloneFormat();}else{this.modifiedProperties[this.modifiedProperties.length-1]=format.cloneFormat();}this.currentPropertyIndex++;return value;}if(property==='shading'){value=previousTableFormat.shading;}else{value=previousTableFormat.getPropertyValue(property);}previousTableFormat.copyFormat(format);this.currentPropertyIndex++;}else{var currentFormat=new WTableFormat();currentFormat.copyFormat(format);this.modifiedProperties.push(currentFormat);}return value;};BaseHistoryInfo.prototype.addModifiedRowProperties=function(rowFormat,property,value){if(this.editorHistory.isUndoing||this.editorHistory.isRedoing){var previousFormat=this.currentPropertyIndex<this.modifiedProperties.length?this.modifiedProperties[this.currentPropertyIndex]:this.modifiedProperties[this.modifiedProperties.length-1];if(sf.base.isNullOrUndefined(property)){value=previousFormat;if(this.currentPropertyIndex<this.modifiedProperties.length){this.modifiedProperties[this.currentPropertyIndex]=rowFormat.cloneFormat();}else{this.modifiedProperties[this.modifiedProperties.length-1]=rowFormat.cloneFormat();}this.currentPropertyIndex++;return value;}value=previousFormat.getPropertyValue(property);previousFormat.copyFormat(rowFormat);this.currentPropertyIndex++;}else{var currentFormat=new WRowFormat();currentFormat.copyFormat(rowFormat);this.modifiedProperties.push(currentFormat);}return value;};BaseHistoryInfo.prototype.addModifiedCellProperties=function(cellFormat,property,value){if(this.editorHistory.isUndoing||this.editorHistory.isRedoing){var previousFormat=this.currentPropertyIndex<this.modifiedProperties.length?this.modifiedProperties[this.currentPropertyIndex]:this.modifiedProperties[this.modifiedProperties.length-1];if(sf.base.isNullOrUndefined(property)){value=previousFormat;if(this.currentPropertyIndex<this.modifiedProperties.length){this.modifiedProperties[this.currentPropertyIndex]=cellFormat.cloneFormat();}else{this.modifiedProperties[this.modifiedProperties.length-1]=cellFormat.cloneFormat();}this.currentPropertyIndex++;return value;}if(property==='shading'){value=previousFormat.shading;}else{value=previousFormat.getPropertyValue(property);}previousFormat.copyFormat(cellFormat);this.currentPropertyIndex++;}else{var currentFormat=new WCellFormat();currentFormat.copyFormat(cellFormat);this.modifiedProperties.push(currentFormat);}return value;};/**
     * @private
     * @returns {void}
     */BaseHistoryInfo.prototype.destroy=function(){this.selectionStart=undefined;this.selectionEnd=undefined;this.insertPosition=undefined;this.endPosition=undefined;if(!sf.base.isNullOrUndefined(this.modifiedNodeLength)){this.modifiedNodeLength=[];this.modifiedNodeLength=undefined;}if(!sf.base.isNullOrUndefined(this.modifiedProperties)){for(var i=0;i<this.modifiedProperties.length;i++){var property=this.modifiedProperties[i];if(property instanceof WCharacterFormat){property.destroy();}else if(property instanceof WParagraphFormat){property.destroy();}else if(property instanceof WSectionFormat){property.destroy();}else if(property instanceof ModifiedLevel){property.destroy();}this.modifiedProperties.splice(this.modifiedProperties.indexOf(property),1);i--;}this.modifiedPropertiesIn=undefined;}if(!sf.base.isNullOrUndefined(this.removedNodes)){for(var i=0;i<this.removedNodes.length;i++){var node=this.removedNodes[i];if(node instanceof ParagraphWidget){node.destroyInternal(this.viewer);}else if(node instanceof ElementBox){node.destroy();}this.removedNodes.splice(this.removedNodes.indexOf(node),1);i--;}this.removedNodesIn=undefined;}this.ownerIn=undefined;};return BaseHistoryInfo;}();var __extends$3=undefined&&undefined.__extends||function(){var _extendStatics4=function extendStatics(d,b){_extendStatics4=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;}||function(d,b){for(var p in b){if(b.hasOwnProperty(p))d[p]=b[p];}};return _extendStatics4(d,b);};return function(d,b){_extendStatics4(d,b);function __(){this.constructor=d;}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};}();/**
 * EditorHistory preservation class
 */ /**
 * @private
 */var HistoryInfo=/** @class */function(_super){__extends$3(HistoryInfo,_super);function HistoryInfo(node,isChild){var _this=_super.call(this,node)||this;_this.isChildHistoryInfo=false;_this.editRangeStart=undefined;_this.documentHelper=node.documentHelper;_this.isChildHistoryInfo=isChild;return _this;}Object.defineProperty(HistoryInfo.prototype,"hasAction",{get:function get(){return!sf.base.isNullOrUndefined(this.modifiedActions);},enumerable:true,configurable:true});HistoryInfo.prototype.addModifiedAction=function(baseHistoryInfo){// For complex actions such as Replace text, Insert/Remove Hyperlink etc.
if(!(this.editorHistory.isUndoing||this.editorHistory.isRedoing)){if(sf.base.isNullOrUndefined(this.modifiedActions)){this.modifiedActions=[];}this.modifiedActions.push(baseHistoryInfo);}};HistoryInfo.prototype.revert=function(){this.editorHistory.currentHistoryInfo=this;if(this.action==='BordersAndShading'){this.owner.editorModule.isBordersAndShadingDialog=true;}if(!sf.base.isNullOrUndefined(this.modifiedActions)){if(this.editorHistory.isUndoing){var i=this.modifiedActions.length;while(i>0){var baseHistoryInfo=this.modifiedActions[i-1];baseHistoryInfo.revert();i=i-1;}}else{var i=0;while(i<this.modifiedActions.length){var baseHistoryInfo=this.modifiedActions[i];baseHistoryInfo.revert();i=i+1;}}}if(this.action==='RestrictEditing'){var user=this.editRangeStart.user!==''?this.editRangeStart.user:this.editRangeStart.group;if(this.editorHistory.isUndoing){var index=this.owner.documentHelper.editRanges.get(user).indexOf(this.editRangeStart);if(index!==-1){this.owner.documentHelper.editRanges.get(user).splice(index,1);}}else{this.owner.editor.updateRangeCollection(this.editRangeStart,user);}this.owner.selection.updateEditRangeCollection();}if(!this.isChildHistoryInfo){this.editorHistory.updateComplexHistory();}else{this.editorHistory.updateComplexHistoryInternal();}};HistoryInfo.prototype.destroy=function(){if(!sf.base.isNullOrUndefined(this.modifiedActions)){while(this.modifiedActions.length>0){var baseHistoryInfo=this.modifiedActions[this.modifiedActions.length-1];baseHistoryInfo.destroy();this.modifiedActions.splice(this.modifiedActions.indexOf(baseHistoryInfo),1);}this.modifiedActions=undefined;}_super.prototype.destroy.call(this);};return HistoryInfo;}(BaseHistoryInfo);/**
 *  `EditorHistory` Module class is used to handle history preservation
 */var EditorHistory=/** @class */function(){/**
     * @param {DocumentEditor} node - Specified the document editor.
     * @private
     */function EditorHistory(node){//Fields
this.undoStackIn=[];this.redoStackIn=[];this.historyInfoStack=[];/**
         * @private
         */this.isUndoing=false;/**
         * @private
         */this.isRedoing=false;this.owner=node;this.documentHelper=node.documentHelper;this.modifiedParaFormats=new Dictionary();this.undoLimitIn=500;this.redoLimitIn=500;}Object.defineProperty(EditorHistory.prototype,"currentHistoryInfo",{/**
         * @private
         * @returns {HistoryInfo} - Returns the history info.
         */get:function get(){return this.historyInfoStack&&this.historyInfoStack.length>0?this.historyInfoStack[this.historyInfoStack.length-1]:undefined;},/**
         * @private
         * @param {HistoryInfo} value - Specified the value.
         */set:function set(value){if(value instanceof HistoryInfo){this.historyInfoStack.push(value);}else{this.historyInfoStack.pop();}},enumerable:true,configurable:true});Object.defineProperty(EditorHistory.prototype,"undoStack",{//Properties
/**
         * gets undo stack
         *
         * @private
         * @returns {BaseHistoryInfo[]} - Returns the undo stack.
         */get:function get(){return this.undoStackIn;},enumerable:true,configurable:true});Object.defineProperty(EditorHistory.prototype,"redoStack",{/**
         * gets redo stack
         *
         * @private
         * @returns {BaseHistoryInfo[]} - Returns the redo stack.
         */get:function get(){return this.redoStackIn;},enumerable:true,configurable:true});Object.defineProperty(EditorHistory.prototype,"undoLimit",{/**
         * Gets or Sets the limit of undo operations can be done.
         *
         * @aspType int
         * @blazorType int
         * @returns {number} - Returns the redo limit
         */get:function get(){return sf.base.isNullOrUndefined(this.undoLimitIn)?0:this.undoLimitIn;},/**
         * Sets the limit of undo operations can be done.
         *
         * @aspType int
         * @blazorType int
         * @param {number} value - Specified the value.
         */set:function set(value){if(value<0){throw new Error('The limit should be greater than or equal to zero.');}this.undoLimitIn=value;},enumerable:true,configurable:true});Object.defineProperty(EditorHistory.prototype,"redoLimit",{/**
         * Gets or Sets the limit of redo operations can be done.
         *
         * @aspType int
         * @blazorType int
         * @returns {number} - Returns the redo limit
         */get:function get(){return sf.base.isNullOrUndefined(this.redoLimitIn)?0:this.redoLimitIn;},/**
         * Gets or Sets the limit of redo operations can be done.
         *
         * @aspType int
         * @blazorType int
         * @param {number} value - Specified the value.
         */set:function set(value){if(value<0){throw new Error('The limit should be greater than or equal to zero.');}this.redoLimitIn=value;},enumerable:true,configurable:true});Object.defineProperty(EditorHistory.prototype,"viewer",{get:function get(){return this.owner.viewer;},enumerable:true,configurable:true});EditorHistory.prototype.getModuleName=function(){return'EditorHistory';};/**
     * Determines whether undo operation can be done.
     *
     * @returns {boolean} - Returns the canUndo.
     */EditorHistory.prototype.canUndo=function(){return!sf.base.isNullOrUndefined(this.undoStack)&&this.undoStack.length>0;};/**
     * Determines whether redo operation can be done.
     *
     * @returns {boolean} - Returns the canRedo.
     */EditorHistory.prototype.canRedo=function(){return!sf.base.isNullOrUndefined(this.redoStack)&&this.redoStack.length>0;};//EditorHistory Initialization
/**
     * initialize EditorHistory
     *
     * @private
     * @param {Action} action - Specifies the action.
     * @returns {void}
     */EditorHistory.prototype.initializeHistory=function(action){this.currentBaseHistoryInfo=new BaseHistoryInfo(this.owner);this.currentBaseHistoryInfo.action=action;this.currentBaseHistoryInfo.updateSelection();};/**
     * Initialize complex history
     *
     * @private
     * @param {Selection} selection - Specifies the selection.
     * @param {Action} action - Specifies the action.
     * @returns {void}
     */EditorHistory.prototype.initComplexHistory=function(selection,action){this.currentHistoryInfo=new HistoryInfo(selection.owner,!sf.base.isNullOrUndefined(this.currentHistoryInfo));this.currentHistoryInfo.action=action;this.currentHistoryInfo.updateSelection();};/**
     * @private
     * @param {Point} startingPoint - Specifies the start point.
     * @param {TableResizer} tableResize - Spcifies the table resizer.
     * @returns {void}
     */EditorHistory.prototype.initResizingHistory=function(startingPoint,tableResize){if(tableResize.resizeNode===1){this.initializeHistory('RowResizing');if(!sf.base.isNullOrUndefined(this.currentBaseHistoryInfo)){// eslint-disable-next-line max-len
this.currentBaseHistoryInfo.modifiedProperties.push(new RowHistoryFormat(startingPoint,tableResize.currentResizingTable.childWidgets[tableResize.resizerPosition].rowFormat));}}else{this.initializeHistory('CellResizing');if(this.currentBaseHistoryInfo){tableResize.currentResizingTable=tableResize.currentResizingTable.combineWidget(this.viewer);var tableHistoryInfo=new TableHistoryInfo(tableResize.currentResizingTable,this.owner);tableHistoryInfo.startingPoint=startingPoint;this.currentBaseHistoryInfo.modifiedProperties.push(tableHistoryInfo);}}};/**
     * Update resizing history
     *
     * @private
     * @param {Point} point - Specifies the point.
     * @param {TableResizer} tableResize - Specifies the table resizer.
     * @returns {void}
     */EditorHistory.prototype.updateResizingHistory=function(point,tableResize){if(tableResize.resizeNode===1){if(!sf.base.isNullOrUndefined(this.currentBaseHistoryInfo)){var rowHistoryFormat=this.currentBaseHistoryInfo.modifiedProperties[0];if(rowHistoryFormat.startingPoint.y===point.y){this.currentBaseHistoryInfo.modifiedProperties.length=0;}else{rowHistoryFormat.displacement=HelperMethods.convertPixelToPoint(point.y-rowHistoryFormat.startingPoint.y);this.recordChanges(this.currentBaseHistoryInfo);this.currentBaseHistoryInfo=undefined;}}}else{if(!sf.base.isNullOrUndefined(this.currentBaseHistoryInfo)){var cellHistoryFormat=this.currentBaseHistoryInfo.modifiedProperties[0];if(cellHistoryFormat.startingPoint.x===point.x){this.currentBaseHistoryInfo.modifiedProperties.length=0;}else{cellHistoryFormat.displacement=HelperMethods.convertPixelToPoint(point.x-cellHistoryFormat.startingPoint.x);cellHistoryFormat.endIndex=tableResize.getCellReSizerPosition(point);this.owner.editorHistory.recordChanges(this.currentBaseHistoryInfo);this.currentBaseHistoryInfo=undefined;}}}};/**
     * Record the changes
     *
     * @private
     * @param {BaseHistoryInfo} baseHistoryInfo - Specified the base history info.
     * @returns {void}
     */EditorHistory.prototype.recordChanges=function(baseHistoryInfo){if(!this.owner.enableHistoryMode){return;}if(this.isUndoing){if(sf.base.isNullOrUndefined(this.redoStack)){this.redoStackIn=[];}if(this.redoStack.length===this.redoLimit&&this.redoLimit>0){var count=this.undoLimit>20?10:1;this.redoStackIn.splice(0,count);}if(this.redoStack.length<this.redoLimit){this.redoStack.push(baseHistoryInfo);}}else{if(!this.isRedoing){this.clearRedoStack();}if(sf.base.isNullOrUndefined(this.undoStack)){this.undoStackIn=[];}if(this.undoStack.length===this.undoLimit&&this.undoLimit>0){var count=this.undoLimit>20?10:1;this.undoStackIn.splice(0,count);}if(this.undoStack.length<this.undoLimit){this.undoStackIn.push(baseHistoryInfo);}}};/**
     * update EditorHistory
     *
     * @private
     * @returns {void}
     */EditorHistory.prototype.updateHistory=function(){if(this.documentHelper.owner.enableHistoryMode&&!sf.base.isNullOrUndefined(this.currentBaseHistoryInfo)){//Updates the current end position
if(!sf.base.isNullOrUndefined(this.currentBaseHistoryInfo)&&sf.base.isNullOrUndefined(this.currentBaseHistoryInfo.endPosition)){this.currentBaseHistoryInfo.endPosition=this.currentBaseHistoryInfo.insertPosition;}if(!sf.base.isNullOrUndefined(this.currentHistoryInfo)){this.currentHistoryInfo.addModifiedAction(this.currentBaseHistoryInfo);}else{this.recordChanges(this.currentBaseHistoryInfo);}this.currentBaseHistoryInfo=undefined;}};/**
     * @private
     * @returns {boolean} -Returns isHandleComplexHistory
     */EditorHistory.prototype.isHandledComplexHistory=function(){var isHandledComplexHistory=false;if(!(this.isUndoing||this.isRedoing)){isHandledComplexHistory=this.owner.editorModule.insertRemoveBookMarkElements();}if(this.documentHelper.owner.enableHistoryMode&&!sf.base.isNullOrUndefined(this.currentHistoryInfo)){this.updateHistory();isHandledComplexHistory=true;}else if(this.owner.editorModule.isHandledComplex){isHandledComplexHistory=true;}return isHandledComplexHistory;};/**
     * Update complex history
     *
     * @private
     * @returns {void}
     */EditorHistory.prototype.updateComplexHistory=function(){var selection=this.documentHelper.selection;if(this.currentHistoryInfo.hasAction){if(this.currentHistoryInfo.action==='AutoFormatHyperlink'||this.currentHistoryInfo.action==='SkipCommentInline'){var startPosition=new TextPosition(selection.owner);this.owner.editorModule.setPositionForCurrentIndex(startPosition,this.currentHistoryInfo.insertPosition);// this.reLayoutParagraph(startPosition.paragraph, 0);
if(selection.owner.editorHistory.isUndoing){this.owner.editorModule.setPositionForCurrentIndex(selection.start,this.currentHistoryInfo.selectionStart);this.owner.editorModule.setPositionForCurrentIndex(selection.end,this.currentHistoryInfo.selectionEnd);}else{this.owner.editorModule.setPositionForCurrentIndex(selection.start,this.currentHistoryInfo.endPosition);this.owner.editorModule.setPositionForCurrentIndex(selection.end,this.currentHistoryInfo.endPosition);}}if(this.currentHistoryInfo.action==='InsertHyperlink'){var startPosition=new TextPosition(selection.owner);this.owner.editorModule.setPositionForCurrentIndex(startPosition,this.currentHistoryInfo.insertPosition);var endPosition=new TextPosition(selection.owner);this.owner.editorModule.setPositionForCurrentIndex(endPosition,this.currentHistoryInfo.endPosition);this.documentHelper.layout.reLayoutParagraph(startPosition.paragraph,0,0);if(endPosition.paragraph!==startPosition.paragraph){this.documentHelper.layout.reLayoutParagraph(endPosition.paragraph,0,0);}}if(this.currentHistoryInfo.action==='ReplaceAll'){this.owner.editorModule.layoutWholeDocument();}else if(selection.owner.isShiftingEnabled){this.documentHelper.layout.shiftLayoutedItems(false);if(this.owner.enableHeaderAndFooter){this.owner.editorModule.updateHeaderFooterWidget();}this.documentHelper.removeEmptyPages();}}if(this.owner.showRevisions){this.owner.trackChangesPane.updateTrackChanges();}selection.owner.isShiftingEnabled=false;selection.owner.isLayoutEnabled=true;// // selection.addMultipleSelectionRanges();
if(this.currentHistoryInfo.action==='ApplyStyle'){this.owner.editor.getOffsetValue(selection);}else{selection.start.updatePhysicalPosition(true);if(selection.isEmpty){selection.end.setPositionInternal(selection.start);}else{selection.end.updatePhysicalPosition(true);}}selection.upDownSelectionLength=selection.end.location.x;this.documentHelper.isScrollHandler=true;this.viewer.updateScrollBars();selection.fireSelectionChanged(true);this.documentHelper.isScrollHandler=false;this.documentHelper.updateFocus();this.updateComplexHistoryInternal();this.owner.editorModule.fireContentChange();};/**
     * @private
     *
     * @returns {void}
     */EditorHistory.prototype.updateComplexHistoryInternal=function(){if(!sf.base.isNullOrUndefined(this.currentHistoryInfo)){//Updates the current end position
if(sf.base.isNullOrUndefined(this.currentHistoryInfo.endPosition)){this.currentHistoryInfo.endPosition=this.currentHistoryInfo.insertPosition;}if(this.historyInfoStack.length>1){var historyInfo=this.historyInfoStack[this.historyInfoStack.length-2];historyInfo.addModifiedAction(this.currentHistoryInfo);}else{this.recordChanges(this.currentHistoryInfo);}this.currentHistoryInfo=undefined;}};//List history preservation undo API
/**
     * update list changes for history preservation
     *
     * @private
     * @param  {WAbstractList} currentAbstractList - Specfies the abstractlist.
     * @param  {WList} list - Specifies the list.
     * @returns {Dictionary<number, ModifiedLevel>} - Returns the modified action.
     */EditorHistory.prototype.updateListChangesInHistory=function(currentAbstractList,list){this.currentBaseHistoryInfo=new BaseHistoryInfo(this.documentHelper.owner);this.currentBaseHistoryInfo.action='List';this.currentBaseHistoryInfo.updateSelection();var collection=new Dictionary();for(var i=0;i<currentAbstractList.levels.length;i++){var levels=this.documentHelper.getAbstractListById(list.abstractListId).levels[i];this.currentBaseHistoryInfo.addModifiedPropertiesForList(levels);var modifiedLevel=new ModifiedLevel(levels,currentAbstractList.levels[i]);if(!sf.base.isNullOrUndefined(levels)){this.documentHelper.owner.editorModule.copyListLevel(levels,currentAbstractList.levels[i]);}collection.add(i,modifiedLevel);}return collection;};/**
     * Apply list changes
     *
     * @private
     * @param  {Selection} selection - Specifies the selection.
     * @param  {Dictionary<number, ModifiedLevel>} modifiedLevelsInternal - Specifies the modified levels.
     * @returns {void}
     */EditorHistory.prototype.applyListChanges=function(selection,modifiedLevelsInternal){if(sf.base.isNullOrUndefined(this.modifiedParaFormats)){this.modifiedParaFormats=new Dictionary();}var collection=[];for(var i=0;i<this.documentHelper.listParagraphs.length;i++){var paragraph=this.documentHelper.listParagraphs[i];var paraFormat=paragraph.paragraphFormat;var currentList=this.documentHelper.getListById(paraFormat.listFormat.listId);var listLevel=this.documentHelper.layout.getListLevel(currentList,paraFormat.listFormat.listLevelNumber);if(modifiedLevelsInternal.containsKey(paraFormat.listFormat.listLevelNumber)&&modifiedLevelsInternal.get(paraFormat.listFormat.listLevelNumber).ownerListLevel===listLevel){var modifiedFormat=new WParagraphFormat(null);modifiedFormat.leftIndent=paraFormat.leftIndent;modifiedFormat.firstLineIndent=paraFormat.firstLineIndent;var modified=new ModifiedParagraphFormat(paraFormat,modifiedFormat);collection.push(modified);this.owner.editorModule.copyFromListLevelParagraphFormat(paraFormat,listLevel.paragraphFormat);}}this.modifiedParaFormats.add(this.currentBaseHistoryInfo,collection);};/**
     * Update list changes
     *
     * @private
     * @param  {Dictionary<number, ModifiedLevel>} modifiedCollection - Specifies the modified colection.
     * @returns {void }
     */EditorHistory.prototype.updateListChanges=function(modifiedCollection){this.documentHelper.owner.isLayoutEnabled=false;this.owner.editorModule.updateListParagraphs();for(var i=0;i<modifiedCollection.keys.length;i++){var levelNumber=modifiedCollection.keys[0];var modifiedLevel=modifiedCollection.get(levelNumber);if(!sf.base.isNullOrUndefined(this.currentBaseHistoryInfo)){modifiedLevel=this.currentBaseHistoryInfo.addModifiedPropertiesForList(modifiedLevel.ownerListLevel);}this.owner.editorModule.copyListLevel(modifiedLevel.ownerListLevel,modifiedLevel.modifiedListLevel);}this.revertListChanges();this.documentHelper.owner.isLayoutEnabled=true;this.documentHelper.renderedLists.clear();this.documentHelper.renderedLevelOverrides=[];this.documentHelper.pages=[];this.documentHelper.layout.layout();var selection=this.documentHelper.selection;selection.start.updatePhysicalPosition(true);if(selection.isEmpty){selection.end.setPositionInternal(selection.start);}else{selection.end.updatePhysicalPosition(true);}selection.upDownSelectionLength=selection.end.location.x;selection.fireSelectionChanged(false);this.updateHistory();};/**
     * Revert list changes
     *
     * @returns {void}
     */EditorHistory.prototype.revertListChanges=function(){if(!sf.base.isNullOrUndefined(this.currentBaseHistoryInfo)&&this.documentHelper.owner.editorHistory.modifiedParaFormats.containsKey(this.currentBaseHistoryInfo)){var collection=this.modifiedParaFormats.get(this.currentBaseHistoryInfo);for(var i=0;i<collection.length;i++){var modified=new WParagraphFormat(null);modified.leftIndent=collection[i].ownerFormat.leftIndent;modified.firstLineIndent=collection[i].ownerFormat.firstLineIndent;collection[i].ownerFormat.copyFormat(collection[i].modifiedFormat);collection[i].modifiedFormat.leftIndent=modified.leftIndent;collection[i].modifiedFormat.firstLineIndent=modified.firstLineIndent;}}};/**
     * Reverts the last editing action.
     *
     * @returns {void}
     */EditorHistory.prototype.undo=function(){if(this.owner.isReadOnlyMode&&this.owner.documentHelper.protectionType!=='FormFieldsOnly'||!this.canUndo()||!this.owner.enableHistoryMode){return;}//this.owner.ClearTextSearchResults();
var historyInfo=this.undoStack.pop();this.isUndoing=true;historyInfo.revert();this.isUndoing=false;this.owner.selection.checkForCursorVisibility();this.owner.editorModule.isBordersAndShadingDialog=false;};/**
     * Performs the last reverted action.
     *
     * @returns {void}
     */EditorHistory.prototype.redo=function(){if(this.owner.isReadOnlyMode&&this.owner.documentHelper.protectionType!=='FormFieldsOnly'||!this.canRedo()||!this.owner.enableHistoryMode){return;}//this.owner.ClearTextSearchResults();
var historyInfo=this.redoStack.pop();if(historyInfo.action==='BordersAndShading'){this.owner.editorModule.isBordersAndShadingDialog=true;}this.isRedoing=true;historyInfo.revert();this.isRedoing=false;this.owner.selection.checkForCursorVisibility();this.owner.editorModule.isBordersAndShadingDialog=false;};/**
     * @private
     * @returns {void}
     */EditorHistory.prototype.destroy=function(){this.clearHistory();this.undoStackIn=undefined;this.redoStackIn=undefined;};/**
     * @private
     * @returns {void}
     */EditorHistory.prototype.clearHistory=function(){this.clearUndoStack();this.clearRedoStack();};EditorHistory.prototype.clearUndoStack=function(){if(this.canUndo()){while(this.undoStack.length>0){var historyInfo=this.undoStack.pop();historyInfo.destroy();historyInfo=undefined;}}};EditorHistory.prototype.clearRedoStack=function(){if(this.canRedo()){while(this.redoStack.length>0){var historyInfo=this.redoStack.pop();historyInfo.destroy();historyInfo=undefined;}}};return EditorHistory;}();/**
 * EditorHistory implementation
 */ /**
 * @private
 */var TableResizer=/** @class */function(){function TableResizer(node){this.resizeNode=0;this.resizerPosition=-1;this.currentResizingTable=undefined;this.owner=node;this.documentHelper=this.owner.documentHelper;this.startingPoint=new Point(0,0);}Object.defineProperty(TableResizer.prototype,"viewer",{get:function get(){return this.owner.viewer;},enumerable:true,configurable:true});TableResizer.prototype.getModuleName=function(){return'TableResizer';};TableResizer.prototype.updateResizingHistory=function(touchPoint){if(this.owner.editorHistory){this.owner.editorHistory.updateResizingHistory(touchPoint,this);}this.documentHelper.isRowOrCellResizing=false;this.resizerPosition=-1;};TableResizer.prototype.handleResize=function(point){this.owner.documentHelper.isRowOrCellResizing=true;this.startingPoint.x=point.x;this.startingPoint.y=point.y;//Initialize resizing history.
this.owner.editorHistory.initResizingHistory(point,this);};//Table Resizing implementation starts
TableResizer.prototype.isInRowResizerArea=function(touchPoint){var position=this.getRowReSizerPosition(undefined,touchPoint);if(position===-1){return false;}else{this.resizeNode=1;this.resizerPosition=position;return true;}};TableResizer.prototype.isInCellResizerArea=function(touchPoint){var position=this.getCellReSizerPosition(touchPoint);if(position===-1){return false;}else{this.resizeNode=0;this.resizerPosition=position;return true;}};TableResizer.prototype.getCellReSizerPosition=function(touchPoint){var position=-1;var resizerBoundaryWidth=2;var tableWidget=this.getTableWidget(touchPoint);var cellWidget=this.getTableCellWidget(touchPoint);var cellSpacing=sf.base.isNullOrUndefined(tableWidget)?0:tableWidget.tableFormat.cellSpacing;if(tableWidget&&cellSpacing>0){this.currentResizingTable=tableWidget;// eslint-disable-next-line max-len
if(this.documentHelper.isInsideRect(tableWidget.x-HelperMethods.convertPointToPixel(tableWidget.leftBorderWidth)-0.25,tableWidget.y,HelperMethods.convertPointToPixel(tableWidget.leftBorderWidth)+0.5,tableWidget.height,touchPoint)){return position=0;}var startingPointX=tableWidget.x;for(var i=0;i<tableWidget.tableHolder.columns.length;i++){var preferredWidth=HelperMethods.convertPointToPixel(tableWidget.tableHolder.columns[i].preferredWidth);// eslint-disable-next-line max-len
if(this.documentHelper.isInsideRect(startingPointX-1,tableWidget.y,tableWidget.leftBorderWidth+resizerBoundaryWidth,tableWidget.height,touchPoint)){return position=i>0?i:0;// eslint-disable-next-line max-len
}else if(i>0&&this.documentHelper.isInsideRect(startingPointX+preferredWidth-resizerBoundaryWidth/2,tableWidget.y,resizerBoundaryWidth,tableWidget.height,touchPoint)){return position=i+1;}startingPointX=startingPointX+preferredWidth;}}else{if(!sf.base.isNullOrUndefined(cellWidget)){this.currentResizingTable=cellWidget.ownerTable;// eslint-disable-next-line max-len
if(this.documentHelper.isInsideRect(cellWidget.x-cellWidget.margin.left-resizerBoundaryWidth/2,cellWidget.y-cellWidget.margin.top,resizerBoundaryWidth,cellWidget.height+cellWidget.margin.top+cellWidget.margin.bottom,touchPoint)){return position=cellWidget.columnIndex;}else if(sf.base.isNullOrUndefined(cellWidget.nextRenderedWidget)// eslint-disable-next-line max-len
&&this.documentHelper.isInsideRect(cellWidget.x+cellWidget.margin.right+cellWidget.width-resizerBoundaryWidth/2,cellWidget.y-cellWidget.margin.top,resizerBoundaryWidth,cellWidget.height+cellWidget.margin.top+cellWidget.margin.bottom,touchPoint)){return position=cellWidget.columnIndex+cellWidget.cellFormat.columnSpan;}else if(cellWidget.childWidgets.length>0){return this.getCellReSizerPositionInternal(cellWidget,touchPoint);// Gets the nested table resizer position.
}}}return position;};TableResizer.prototype.getCellReSizerPositionInternal=function(cellWidget,touchPoint){var position=-1;var childTableWidget=this.getTableWidgetFromWidget(touchPoint,cellWidget);var childCellWidget=undefined;if(!sf.base.isNullOrUndefined(childTableWidget)&&childTableWidget.tableFormat.cellSpacing>0){this.currentResizingTable=childTableWidget;// eslint-disable-next-line max-len
if(this.documentHelper.isInsideRect(childTableWidget.x-childTableWidget.leftBorderWidth-0.25,childTableWidget.y,childTableWidget.leftBorderWidth+0.5,childTableWidget.height,touchPoint)){return position=0;}var startingPointX=childTableWidget.x;for(var i=0;i<childTableWidget.tableHolder.columns.length;i++){var preferredWidth=HelperMethods.convertPointToPixel(childTableWidget.tableHolder.columns[i].preferredWidth);// eslint-disable-next-line max-len
if(this.documentHelper.isInsideRect(startingPointX-1,childTableWidget.y,childTableWidget.leftBorderWidth+2,childTableWidget.height,touchPoint)){return position=i>0?i:0;// eslint-disable-next-line max-len
}else if(i>0&&this.documentHelper.isInsideRect(startingPointX+preferredWidth-1,childTableWidget.y,2,childTableWidget.height,touchPoint)){return position=i+1;}startingPointX=startingPointX+preferredWidth;}}else{if(!sf.base.isNullOrUndefined(childTableWidget)){childCellWidget=childTableWidget.getTableCellWidget(touchPoint);}if(!sf.base.isNullOrUndefined(childCellWidget)){this.currentResizingTable=childCellWidget.ownerTable;// eslint-disable-next-line max-len
if(this.documentHelper.isInsideRect(childCellWidget.x-childCellWidget.margin.left-1,childCellWidget.y-childCellWidget.margin.top,2,childCellWidget.height,touchPoint)){return position=childCellWidget.columnIndex;}else if(sf.base.isNullOrUndefined(childCellWidget.nextRenderedWidget)// eslint-disable-next-line max-len
&&this.documentHelper.isInsideRect(childCellWidget.x+childCellWidget.margin.right+childCellWidget.width-1,childCellWidget.y-childCellWidget.margin.top,2,childCellWidget.height,touchPoint)){return position=childCellWidget.columnIndex+childCellWidget.cellFormat.columnSpan;}else if(childCellWidget.childWidgets.length>0){return this.getCellReSizerPositionInternal(childCellWidget,touchPoint);}}}return position;};TableResizer.prototype.getRowReSizerPosition=function(widget,touchPoint){var tableWidget=undefined;var cellWidget=undefined;if(sf.base.isNullOrUndefined(widget)){tableWidget=this.getTableWidget(touchPoint);cellWidget=this.getTableCellWidget(touchPoint);}else{tableWidget=this.getTableWidgetFromWidget(touchPoint,widget);}var cellSpacing=sf.base.isNullOrUndefined(tableWidget)?0:tableWidget.tableFormat.cellSpacing;if(tableWidget&&cellSpacing>0){this.currentResizingTable=tableWidget;// eslint-disable-next-line max-len
if(this.owner.documentHelper.isInsideRect(tableWidget.x,tableWidget.y+tableWidget.height-cellSpacing,this.getActualWidth(tableWidget.lastChild),sf.base.isNullOrUndefined(tableWidget.nextSplitWidget)?tableWidget.bottomBorderWidth+cellSpacing:0,touchPoint)){return tableWidget.lastChild.rowIndex;}for(var i=0;i<tableWidget.childWidgets.length;i++){//Need to consider for splitted widgets
var rowWidget=tableWidget.childWidgets[i];if(tableWidget.childWidgets.indexOf(rowWidget)>-1// eslint-disable-next-line max-len
&&this.owner.documentHelper.isInsideRect(rowWidget.x,rowWidget.y+rowWidget.height+cellSpacing/2,this.getActualWidth(rowWidget),cellSpacing/2,touchPoint)){return rowWidget.rowIndex;}}}else{if(tableWidget&&cellWidget){cellWidget=this.getTableCellWidget(touchPoint);}if(cellWidget){var rowWidget=cellWidget.containerWidget;var height=0;if(rowWidget.rowIndex===rowWidget.ownerTable.childWidgets.length-1){height=rowWidget.bottomBorderWidth+2;}else{height=rowWidget.nextRenderedWidget.topBorderWidth+2;}// eslint-disable-next-line max-len
if(this.owner.documentHelper.isInsideRect(rowWidget.x,rowWidget.y+rowWidget.height-height,rowWidget.width,height*2,touchPoint)){this.currentResizingTable=rowWidget.ownerTable;return rowWidget.rowIndex;}else{if(cellWidget.childWidgets.length>0){return this.getRowReSizerPosition(cellWidget,touchPoint);}}}}return-1;};TableResizer.prototype.handleResizing=function(touchPoint){var dragValue=0;if(this.resizeNode===0){dragValue=touchPoint.x-this.startingPoint.x;this.resizeTableCellColumn(dragValue);}else{dragValue=touchPoint.y-this.startingPoint.y;this.resizeTableRow(dragValue);}};TableResizer.prototype.resizeTableRow=function(dragValue){var table=this.currentResizingTable;if(sf.base.isNullOrUndefined(table)||dragValue===0||this.resizerPosition===-1){return;}var selection=this.owner.selection;if(table.isInsideTable){this.owner.isLayoutEnabled=false;//Layouting is disabled to skip the child table layouting.
}var row=undefined;if(this.resizerPosition>-1){row=table.childWidgets[this.resizerPosition];if(row){this.updateRowHeight(row,dragValue);}selection.selectPosition(selection.start,selection.end);}if(table.isInsideTable){var parentTable=this.owner.documentHelper.layout.getParentTable(table);this.owner.isLayoutEnabled=true;//layouting is enabled to layout the parent table of the nested table.
table=parentTable;}this.startingPoint.y+=HelperMethods.convertPointToPixel(dragValue);this.owner.documentHelper.layout.reLayoutTable(table);this.owner.editorModule.reLayout(this.owner.selection);if(row){this.getRowReSizerPosition(undefined,this.startingPoint);}if(this.currentResizingTable&&(this.currentResizingTable.childWidgets===undefined||this.currentResizingTable.childWidgets[this.resizerPosition]===undefined)){this.resizerPosition=-1;}};TableResizer.prototype.getTableWidget=function(cursorPoint){var widget=undefined;var currentPage=this.owner.documentHelper.currentPage;if(!sf.base.isNullOrUndefined(currentPage)){for(var i=0;i<currentPage.bodyWidgets.length;i++){var bodyWidget=currentPage.bodyWidgets[i];widget=this.getTableWidgetFromWidget(cursorPoint,bodyWidget);if(!sf.base.isNullOrUndefined(widget)){break;}}}return widget;};TableResizer.prototype.getTableWidgetFromWidget=function(point,widget){for(var j=0;j<widget.childWidgets.length;j++){if(widget.childWidgets[j]instanceof TableWidget){var childWidget=widget.childWidgets[j];var tableWidth=0;if(childWidget.wrapTextAround){tableWidth=childWidget.getTableCellWidth();}if(!childWidget.wrapTextAround&&childWidget.y<=point.y&&childWidget.y+childWidget.height>=point.y){return childWidget;}if(childWidget.wrapTextAround&&childWidget.x<=point.x&&childWidget.x+tableWidth>=point.x&&childWidget.y<=point.y&&childWidget.y+childWidget.height>=point.y){return childWidget;}}}return undefined;};TableResizer.prototype.getTableCellWidget=function(cursorPoint){var widget=undefined;var currentPage=this.owner.documentHelper.currentPage;if(!sf.base.isNullOrUndefined(currentPage)){for(var i=0;i<currentPage.bodyWidgets.length;i++){var bodyWidget=currentPage.bodyWidgets[i];widget=bodyWidget.getTableCellWidget(cursorPoint);if(!sf.base.isNullOrUndefined(widget)){break;}}}return widget;};TableResizer.prototype.updateRowHeight=function(row,dragValue){var rowFormat=row.rowFormat;if(rowFormat.heightType==='Auto'){rowFormat.heightType='AtLeast';var row_1=rowFormat.ownerBase;var currentHeight=this.owner.documentHelper.layout.getRowHeight(row_1,[row_1]);//the minimum height of the Row in MS word is 2.7 points which is equal to 3.6 pixel.
if(currentHeight+dragValue>=2.7&&rowFormat.height!==currentHeight+dragValue){rowFormat.height=currentHeight+dragValue;}}else{//the minimum height of the Row in MS word is 2.7 points which is equal to 3.6 pixel.
if(rowFormat.height+dragValue>=2.7&&rowFormat.height!==rowFormat.height+dragValue){rowFormat.height=rowFormat.height+dragValue;}}};//Resize Table cell
TableResizer.prototype.resizeTableCellColumn=function(dragValue){var table=this.currentResizingTable;if(sf.base.isNullOrUndefined(table)||dragValue===0||sf.base.isNullOrUndefined(table.childWidgets)||this.resizerPosition<0){return;}var selectionFlag=true;var selection=this.owner.selection;this.owner.editor.setOffsetValue(selection);table=table.combineWidget(this.viewer);this.owner.isLayoutEnabled=false;// table.PreserveGrid = true;
this.setPreferredWidth(table);var containerWidth=table.getOwnerWidth(true);var newIndent=table.leftIndent;var tableAlignment=table.tableFormat.tableAlignment;if(!selection.isEmpty){selectionFlag=this.resizeColumnWithSelection(selection,table,dragValue);}if(!selectionFlag){this.owner.isLayoutEnabled=true;return;}if(this.resizerPosition===0){// Todo: need to handle the resizing of first column and table indent.
var columnIndex=this.resizerPosition;var rightColumn=table.tableHolder.columns[columnIndex];var width=rightColumn.preferredWidth;if(dragValue>0){var prevDragValue=dragValue;do{var newWidth=HelperMethods.round(rightColumn.preferredWidth-dragValue,1);if(newWidth>=rightColumn.minWidth){rightColumn.preferredWidth=newWidth;newIndent=table.leftIndent+dragValue;newIndent=newIndent>=-1440?newIndent<=1440?newIndent:1440:-1440;break;}else{prevDragValue=dragValue;dragValue+=newWidth-rightColumn.minWidth;}}while(dragValue!==prevDragValue);}else{var prevDragValue=dragValue;do{var newWidth=HelperMethods.round(rightColumn.preferredWidth-dragValue,1);if(newWidth<=2112){rightColumn.preferredWidth=newWidth;newIndent=table.leftIndent+dragValue;newIndent=newIndent>=-1440?newIndent<=1440?newIndent:1440:-1440;break;}else{prevDragValue=dragValue;dragValue-=newWidth-2112;}}while(dragValue!==prevDragValue);}var dragOffset=dragValue;if(tableAlignment!=='Left'&&table.tableHolder.getTotalWidth(0)>containerWidth&&table.tableFormat.preferredWidthType==='Auto'){if(table.tableHolder.isFitColumns(containerWidth,table.tableHolder.tableWidth,table.tableFormat.preferredWidthType==='Auto')){table.tableHolder.fitColumns(containerWidth,table.tableHolder.tableWidth,table.tableFormat.preferredWidthType==='Auto');}else{rightColumn.preferredWidth=width;}dragOffset=0;}if(tableAlignment==='Center'&&(table.tableHolder.getTotalWidth(0)<containerWidth||table.tableFormat.preferredWidthType!=='Auto')){dragOffset=dragOffset/2;}table.tableFormat.leftIndent=tableAlignment==='Left'?newIndent:0;table.tableHolder.tableWidth=table.tableHolder.getTotalWidth(0);this.updateCellPreferredWidths(table);this.updateGridValue(table,true,dragOffset);}else if(table!==null&&this.resizerPosition===table.tableHolder.columns.length){// Todo: need to handle the resizing of last column and table width.
this.resizeColumnAtLastColumnIndex(table,dragValue,containerWidth);}else{if(this.resizerPosition===-1){this.owner.isLayoutEnabled=true;return;}this.resizeCellAtMiddle(table,dragValue);}// table.PreserveGrid = false;
this.owner.isLayoutEnabled=true;selection.selectPosition(selection.start,selection.end);};TableResizer.prototype.resizeColumnWithSelection=function(selection,table,dragValue){//const newIndent: number = table.leftIndent;
var cellwidget=this.getTableCellWidget(this.startingPoint);if(cellwidget&&(selection.selectedWidgets.containsKey(cellwidget)||cellwidget.previousWidget&&selection.selectedWidgets.containsKey(cellwidget.previousWidget))){var selectedCells=selection.getSelectedCells();if(this.resizerPosition===0){this.resizeColumnAtStart(table,dragValue,selectedCells);}else if(table!==null&&this.resizerPosition===table.tableHolder.columns.length){var leftColumnCollection=this.getColumnCells(table,this.resizerPosition,true);for(var i=0;i<leftColumnCollection.length;i++){var cell=leftColumnCollection[i];if(selectedCells.indexOf(cell)!==-1){this.increaseOrDecreaseWidth(cell,dragValue,true);}}//Updates the grid after value for all the rows.
this.updateRowsGridAfterWidth(table);table.updateWidth(dragValue);table.tableFormat.allowAutoFit=false;this.updateGridValue(table,true,dragValue);}else{if(this.resizerPosition===-1){return false;}var columnIndex=this.resizerPosition;var leftColumnCollection=this.getColumnCells(table,columnIndex,true);var rightColumnCollection=this.getColumnCells(table,columnIndex,false);var isColumnResizing=this.isColumnSelected(table,columnIndex);if(leftColumnCollection.length>0&&!isColumnResizing){for(var i=0;i<leftColumnCollection.length;i++){if(selectedCells.indexOf(leftColumnCollection[i])===-1){leftColumnCollection.splice(i,1);i--;}}}if(rightColumnCollection.length>0&&!isColumnResizing){for(var i=0;i<rightColumnCollection.length;i++){if(selectedCells.indexOf(rightColumnCollection[i])===-1){rightColumnCollection.splice(i,1);i--;}}}//Getting the adjacent cell collections for left side selected cells in the right column collection.
if(leftColumnCollection.length===0&&rightColumnCollection.length>0){for(var i=0;i<rightColumnCollection.length;i++){var cell=rightColumnCollection[i];if(cell.previousWidget){leftColumnCollection.push(cell.previousWidget);}}}else if(rightColumnCollection.length===0&&leftColumnCollection.length>0){for(var i=0;i<leftColumnCollection.length;i++){var cell=leftColumnCollection[i];if(cell.nextWidget){rightColumnCollection.push(cell.nextWidget);}}}this.changeWidthOfCells(table,leftColumnCollection,rightColumnCollection,dragValue);if(table.tableFormat.allowAutoFit){table.updateWidth(dragValue);}table.tableFormat.allowAutoFit=false;this.updateGridValue(table,true,dragValue);}selection.selectPosition(selection.start,selection.end);}return false;};TableResizer.prototype.resizeColumnAtStart=function(table,dragValue,selectedCells){var newIndent=table.leftIndent;//const rightColumnCollection: TableCellWidget[] = this.getColumnCells(table, this.resizerPosition, false);
var offset=0;var selectedRow=selectedCells[0].ownerRow;var rowFormat=selectedRow.rowFormat;if(rowFormat.beforeWidth>0){var newGridBefore=rowFormat.beforeWidth+dragValue;if(newGridBefore>0){this.updateGridBefore(selectedRow,dragValue);}else{var leastGridBefore=this.getLeastGridBefore(table,selectedRow);if(newGridBefore<leastGridBefore&&offset!==newGridBefore){newIndent=table.leftIndent+newGridBefore;table.tableFormat.leftIndent=newIndent>=-1440?newIndent<=1440?newIndent:1440:-1440;for(var i=0;i<table.childWidgets.length;i++){var tableRow=table.childWidgets[i];if(selectedRow!==tableRow){this.updateGridBefore(tableRow,-newGridBefore);}}}}}else{if(dragValue<0){newIndent=table.leftIndent+dragValue;table.tableFormat.leftIndent=newIndent>=-1440?newIndent<=1440?newIndent:1440:-1440;this.updateWidthForCells(table,selectedCells,dragValue);}else{var leastGridBefore=this.getLeastGridBefore(table,selectedRow);var currentTableIndent=table.tableFormat.leftIndent;if(currentTableIndent===0){for(var i=0;i<table.childWidgets.length;i++){var tableRow=table.childWidgets[i];if(selectedCells.indexOf(tableRow.childWidgets[0])!==-1){this.updateGridBefore(tableRow,dragValue);this.increaseOrDecreaseWidth(tableRow.childWidgets[0],dragValue,false);}}}else{var difference=leastGridBefore-dragValue;if(difference>0){newIndent=table.leftIndent+dragValue;table.tableFormat.leftIndent=newIndent>=-1440?newIndent<=1440?newIndent:1440:-1440;this.updateWidthForCells(table,selectedCells,dragValue);}else{newIndent=table.leftIndent+leastGridBefore;table.tableFormat.leftIndent=newIndent>=-1440?newIndent<=1440?newIndent:1440:-1440;for(var i=0;i<table.childWidgets.length;i++){var tableRow=table.childWidgets[i];if(selectedCells.indexOf(tableRow.childWidgets[0])!==-1){this.increaseOrDecreaseWidth(tableRow.childWidgets[0],dragValue,false);this.updateGridBefore(tableRow,dragValue-leastGridBefore);}else{this.updateGridBefore(tableRow,-leastGridBefore);}}}}}}table.tableFormat.allowAutoFit=false;this.updateGridValue(table,true,dragValue);};TableResizer.prototype.updateWidthForCells=function(table,selectedCells,dragValue){for(var i=0;i<table.childWidgets.length;i++){var tableRow=table.childWidgets[i];if(selectedCells.indexOf(tableRow.childWidgets[0])!==-1){this.increaseOrDecreaseWidth(tableRow.childWidgets[0],dragValue,false);}else{this.updateGridBefore(tableRow,-dragValue);}}};TableResizer.prototype.resizeColumnAtLastColumnIndex=function(table,dragValue,containerWidth){var tableAlignment=table.tableFormat.tableAlignment;var preferredWidth=table.tableFormat.preferredWidth;var hasTableWidth=preferredWidth;var columnIndex=this.resizerPosition;var leftColumn=table.tableHolder.columns[columnIndex-1];var prevDragValue=0;while(dragValue!==prevDragValue){var newWidth=HelperMethods.round(leftColumn.preferredWidth+dragValue,1);if(newWidth>=leftColumn.minWidth){leftColumn.preferredWidth=newWidth;prevDragValue=dragValue;}else{prevDragValue=dragValue;dragValue-=newWidth-leftColumn.minWidth;}}this.updateCellPreferredWidths(table);if(hasTableWidth||table.tableHolder.getTotalWidth(0)>containerWidth){table.tableFormat.allowAutoFit=false;table.updateWidth(dragValue);table.tableHolder.tableWidth=table.tableHolder.getTotalWidth(0);}var dragOffset=dragValue;if(tableAlignment==='Right'){dragOffset=0;}else if(tableAlignment==='Center'){dragOffset=dragOffset/2;}this.updateGridValue(table,true,dragOffset);};TableResizer.prototype.resizeCellAtMiddle=function(table,dragValue){var columnIndex=this.resizerPosition;var leftColumn=table.tableHolder.columns[columnIndex-1];var rightColumn=table.tableHolder.columns[columnIndex];if(dragValue>0){var isContinue=true;while(isContinue){var newWidth=HelperMethods.round(rightColumn.preferredWidth-dragValue,1);if(newWidth>=rightColumn.minWidth){rightColumn.preferredWidth=newWidth;leftColumn.preferredWidth=leftColumn.preferredWidth+dragValue;isContinue=false;}else{dragValue+=newWidth-rightColumn.minWidth;}}}else{var isContinue=true;while(isContinue){var newWidth=HelperMethods.round(leftColumn.preferredWidth+dragValue,1);if(newWidth>=leftColumn.minWidth){leftColumn.preferredWidth=newWidth;rightColumn.preferredWidth=rightColumn.preferredWidth-dragValue;isContinue=false;}else{dragValue-=newWidth-leftColumn.minWidth;}}}// Update the cell widths based on the columns preferred width
this.updateCellPreferredWidths(table);if(table.tableFormat.allowAutoFit){table.updateWidth(dragValue);}table.tableFormat.allowAutoFit=false;table.tableHolder.tableWidth=table.tableHolder.getTotalWidth(0);this.updateGridValue(table,false,dragValue);};TableResizer.prototype.updateGridValue=function(table,isUpdate,dragValue){if(isUpdate){table.calculateGrid();table.isGridUpdated=false;}table.buildTableColumns();table.isGridUpdated=true;this.viewer.owner.isLayoutEnabled=true;if(table.isInsideTable){var parentTable=this.documentHelper.layout.getParentTable(table);this.documentHelper.layout.reLayoutTable(parentTable);// Need to optmize this.
}else{this.documentHelper.layout.reLayoutTable(table);}this.owner.editor.getOffsetValue(this.documentHelper.selection);this.owner.editorModule.reLayout(this.owner.selection);if(dragValue){this.startingPoint.x+=HelperMethods.convertPointToPixel(dragValue);this.resizerPosition=this.getCellReSizerPosition(this.startingPoint);}};TableResizer.prototype.getColumnCells=function(table,columnIndex,isLeftSideCollection){var cells=[];for(var i=0;i<table.childWidgets.length;i++){var row=table.childWidgets[i];for(var j=0;j<row.childWidgets.length;j++){var cell=row.childWidgets[j];if(isLeftSideCollection){if(cell.columnIndex+cell.cellFormat.columnSpan===columnIndex){cells.push(cell);}}else{if(cell.columnIndex===columnIndex){cells.push(cell);}}}}return cells;};TableResizer.prototype.updateGridBefore=function(row,offset){if(row.rowFormat.beforeWidth+offset!==row.rowFormat.beforeWidth){row.rowFormat.beforeWidth=row.rowFormat.beforeWidth+offset;row.rowFormat.gridBeforeWidth=row.rowFormat.beforeWidth;}};TableResizer.prototype.getLeastGridBefore=function(table,ignoreRow){var gridBefore=0;var flag=0;for(var i=0;i<table.childWidgets.length;i++){var row=table.childWidgets[i];if(row!==ignoreRow){if(flag===0){gridBefore=row.rowFormat.beforeWidth;flag++;}if(row.rowFormat.beforeWidth<=gridBefore){gridBefore=row.rowFormat.beforeWidth;}}}return gridBefore;};TableResizer.prototype.increaseOrDecreaseWidth=function(cell,dragValue,isIncrease){var preferredWidth=cell.cellFormat.preferredWidth;if(cell.cellFormat.preferredWidthType==='Auto'){preferredWidth=cell.cellFormat.cellWidth;cell.cellFormat.preferredWidthType='Point';}var minimumWidth=cell.ownerColumn.minWidth;if(cell.cellFormat.preferredWidthType==='Percent'){minimumWidth=cell.convertPointToPercent(minimumWidth);}// Margins properties usedd for internal purpose.
if(isIncrease){cell.cellFormat.preferredWidth=preferredWidth+dragValue>minimumWidth?preferredWidth+dragValue:minimumWidth;}else{cell.cellFormat.preferredWidth=preferredWidth-dragValue>minimumWidth?preferredWidth-dragValue:minimumWidth;}};// eslint-disable-next-line max-len
TableResizer.prototype.changeWidthOfCells=function(table,leftColumnCollection,rightColumnCollection,dragValue){if(leftColumnCollection.length>0){var flag=false;for(var i=0;i<leftColumnCollection.length;i++){var cell=leftColumnCollection[i];this.increaseOrDecreaseWidth(cell,dragValue,true);if(cell.cellIndex===cell.ownerRow.childWidgets.length-1){flag=true;}}if(flag){this.updateRowsGridAfterWidth(table);}}if(rightColumnCollection.length>0){var diff=0;for(var i=0;i<rightColumnCollection.length;i++){var cell=rightColumnCollection[i];if(cell.cellIndex===0){var newGridBefore=cell.ownerRow.rowFormat.beforeWidth+dragValue;if(newGridBefore>=0){this.updateGridBefore(cell.ownerRow,dragValue);}else{if(diff!==newGridBefore){diff=newGridBefore;}cell.ownerRow.rowFormat.gridBeforeWidth=0;cell.ownerRow.rowFormat.gridBeforeWidthType='Auto';}}this.increaseOrDecreaseWidth(cell,dragValue,false);}if(diff!==0){var newIndent=table.leftIndent+diff;table.tableFormat.leftIndent=newIndent>=-1440?newIndent<=1440?newIndent:1440:-1440;for(var j=0;j<table.childWidgets.length;j++){var row=table.childWidgets[j];if(rightColumnCollection.indexOf(row.childWidgets[0])===-1){this.updateGridBefore(row,diff>0?diff:-diff);}}}}};TableResizer.prototype.updateRowsGridAfterWidth=function(table){var maxRowWidth=this.getMaxRowWidth(table,true);for(var i=0;i<table.childWidgets.length;i++){var row=table.childWidgets[i];var currentRowWidth=this.getRowWidth(row,true);if(maxRowWidth>=currentRowWidth&&row.rowFormat.afterWidth!==maxRowWidth-currentRowWidth){var value=maxRowWidth-currentRowWidth;row.rowFormat.gridAfterWidth=value;row.rowFormat.afterWidth=value;}}};TableResizer.prototype.getRowWidth=function(row,toUpdateGridAfter){var rowWidth=0;if(toUpdateGridAfter){rowWidth=rowWidth+row.rowFormat.beforeWidth;}for(var i=0;i<row.childWidgets.length;i++){var cell=row.childWidgets[i];rowWidth+=cell.cellFormat.cellWidth;}return rowWidth;};TableResizer.prototype.getMaxRowWidth=function(table,toUpdateGridAfter){var width=0;for(var i=0;i<table.childWidgets.length;i++){var row=table.childWidgets[i];var rowWidth=0;if(toUpdateGridAfter){rowWidth=rowWidth+row.rowFormat.beforeWidth;}for(var i_1=0;i_1<row.childWidgets.length;i_1++){var cell=row.childWidgets[i_1];rowWidth+=cell.cellFormat.cellWidth;}if(width<rowWidth){width=rowWidth;}}return width;};TableResizer.prototype.isColumnSelected=function(table,columnIndex){var selection=this.owner.selection;var selectedCells=selection.getSelectedCells();var leftColumnCells=this.getColumnCells(table,columnIndex,true);var rightColumnCells=this.getColumnCells(table,columnIndex,false);var isColumnSelected=false;for(var i=0;i<leftColumnCells.length;i++){var columnCell=leftColumnCells[i];isColumnSelected=selectedCells.indexOf(columnCell)!==-1?true:false;}if(!isColumnSelected){for(var i=0;i<rightColumnCells.length;i++){var columnCell=rightColumnCells[i];isColumnSelected=selectedCells.indexOf(columnCell)!==-1?true:false;}}return isColumnSelected;};TableResizer.prototype.applyProperties=function(table,tableHistoryInfo){if(sf.base.isNullOrUndefined(tableHistoryInfo)){return;}// PreserveGrid = true;
if(tableHistoryInfo.tableHolder){table.tableHolder=tableHistoryInfo.tableHolder.clone();}if(tableHistoryInfo.tableFormat!==null){table.tableFormat.leftIndent=tableHistoryInfo.tableFormat.leftIndent;table.tableFormat.preferredWidth=tableHistoryInfo.tableFormat.preferredWidth;table.tableFormat.preferredWidthType=tableHistoryInfo.tableFormat.preferredWidthType;table.tableFormat.allowAutoFit=tableHistoryInfo.tableFormat.allowAutoFit;}for(var i=0;i<table.childWidgets.length;i++){var row=table.childWidgets[i];var rowFormat=tableHistoryInfo.rows[i];row.rowFormat.gridBefore=rowFormat.gridBefore;row.rowFormat.gridBeforeWidth=rowFormat.gridBeforeWidth;row.rowFormat.gridBeforeWidthType=rowFormat.gridBeforeWidthType;row.rowFormat.gridAfter=rowFormat.gridAfter;row.rowFormat.gridAfterWidth=rowFormat.gridAfterWidth;row.rowFormat.gridAfterWidthType=rowFormat.gridAfterWidthType;for(var j=0;j<row.childWidgets.length;j++){var cell=row.childWidgets[j];var cellFormat=rowFormat.cells[j];cell.columnIndex=cellFormat.columnIndex;cell.cellFormat.columnSpan=cellFormat.columnSpan;cell.cellFormat.preferredWidth=cellFormat.preferredWidth;cell.cellFormat.preferredWidthType=cellFormat.preferredWidthType;}}var containerWidth=table.getOwnerWidth(true);var tableWidth=table.getTableClientWidth(containerWidth);//Sets the width to cells
table.setWidthToCells(tableWidth,table.tableFormat.preferredWidthType==='Auto');// PreserveGrid = false;
};TableResizer.prototype.getActualWidth=function(row){var width=0;if(row.childWidgets.length>0){for(var i=0;i<row.childWidgets.length;i++){width+=row.childWidgets[i].cellFormat.cellWidth;}}return width;};TableResizer.prototype.setPreferredWidth=function(table){for(var i=0;i<table.childWidgets.length;i++){var rw=table.childWidgets[i];var rowFormat=rw.rowFormat;if(rowFormat.gridBefore>0){rowFormat.gridBeforeWidth=rowFormat.beforeWidth;rowFormat.gridBeforeWidthType='Point';}for(var j=0;j<rw.childWidgets.length;j++){var cell=rw.childWidgets[j];cell.cellFormat.preferredWidth=cell.cellFormat.cellWidth;cell.cellFormat.preferredWidthType='Point';}if(rowFormat.gridAfter>0){rowFormat.gridAfterWidth=rowFormat.afterWidth;rowFormat.gridAfterWidthType='Point';}}};TableResizer.prototype.updateCellPreferredWidths=function(table){var tableWidth=table.tableHolder.tableWidth;for(var i=0;i<table.childWidgets.length;i++){var row=table.childWidgets[i];if(row.rowFormat.gridBefore>0){var width=table.tableHolder.getCellWidth(0,row.rowFormat.gridBefore,tableWidth);this.updateGridBeforeWidth(width,row);}for(var j=0;j<row.childWidgets.length;j++){var cell=row.childWidgets[j];cell.updateWidth(table.tableHolder.getCellWidth(cell.columnIndex,cell.cellFormat.columnSpan,tableWidth));}if(row.rowFormat.gridAfter>0){// eslint-disable-next-line max-len
this.updateGridAfterWidth(table.tableHolder.getCellWidth(row.childWidgets.length,row.rowFormat.gridAfter,tableWidth),row);}}};TableResizer.prototype.updateGridBeforeWidth=function(width,row){var rowFormat=row.rowFormat;if(width!==rowFormat.beforeWidth){rowFormat.beforeWidth=width;if(rowFormat.gridBeforeWidthType==='Auto'){rowFormat.gridBeforeWidthType='Point';}if(rowFormat.gridBeforeWidthType==='Point'){rowFormat.gridBeforeWidth=rowFormat.beforeWidth;}else{// The value is calculated from the pixel values hence, its converted to percent using method.
var ownerWidth=row.ownerTable.getTableClientWidth(row.ownerTable.getOwnerWidth(true));var value=row.ownerTable.convertPointToPercent(rowFormat.beforeWidth,ownerWidth);rowFormat.gridBeforeWidth=value;}}};TableResizer.prototype.updateGridAfterWidth=function(width,row){var rowFormat=row.rowFormat;if(width!==rowFormat.afterWidth){rowFormat.afterWidth=width;}if(rowFormat.gridAfterWidthType==='Auto'){rowFormat.gridAfterWidthType='Point';}if(rowFormat.gridAfterWidthType==='Point'){rowFormat.gridAfterWidth=rowFormat.afterWidth;}else{// The value is calculated from the pixel values hence, its converted to percent using method.
var ownerWidth=row.ownerTable.getTableClientWidth(row.ownerTable.getOwnerWidth(true));var value=row.ownerTable.convertPointToPercent(rowFormat.afterWidth,ownerWidth);rowFormat.gridAfterWidth=value;}};return TableResizer;}();/**
 * Editor module
 */var Editor=/** @class */function(){/**
     * Initialize the editor module
     *
     * @param {DocumentHelper} documentHelper - Document helper
     * @private
     */function Editor(documentHelper){var _this=this;this.nodes=[];this.editHyperlinkInternal=false;this.startParagraph=undefined;this.endParagraph=undefined;this.removeEditRange=false;this.formFieldCounter=1;this.skipFieldDeleteTracking=false;this.isForHyperlinkFormat=false;this.isTrackingFormField=false;this.isCmtDeleteStarted=false;this.removeCommentCharacters=[];/**
         * @private
         */this.isRemoveRevision=false;/**
         * @private
         */this.isHandledComplex=false;/**
         * @private
         */this.tableResize=undefined;/**
         * @private
         */this.tocStyles={};/**
         * @private
         */this.chartType=false;this.refListNumber=undefined;this.incrementListNumber=-1;this.removedBookmarkElements=[];/**
         * @private
         */this.tocBookmarkId=0;/**
         * @private
         */this.triggerPageSpellCheck=true;/**
         * @private
         */this.copiedData=undefined;this.pageRefFields={};this.delBlockContinue=false;this.delBlock=undefined;this.delSection=undefined;/**
         * @private
         */this.isInsertingTOC=false;this.editStartRangeCollection=[];this.skipReplace=false;this.skipTableElements=false;/**
         * @private
         */this.listNumberFormat='';/**
         * @private
         */this.listLevelNumber=0;/**
         * @private
         */this.isXmlMapped=false;/* eslint-disable @typescript-eslint/no-explicit-any */this.copiedContent='';/* eslint-enable @typescript-eslint/no-explicit-any */this.copiedTextContent='';/**
         * @private
         */this.previousParaFormat=undefined;this.previousCharFormat=undefined;this.previousSectionFormat=undefined;this.pasteTextPosition=undefined;this.isSkipHistory=false;this.isPaste=false;this.isPasteListUpdated=false;/**
         * @private
         */this.isInsertField=false;/**
         * @private
         */this.isBordersAndShadingDialog=false;/**
         * @private
         * @returns {void}
         */this.onTextInputInternal=function(){if(sf.base.Browser.isDevice){var documentHelper=_this.documentHelper;var nbsp=new RegExp(String.fromCharCode(160),'g');var lineFeed=new RegExp(String.fromCharCode(10),'g');documentHelper.prefix=documentHelper.prefix.replace(nbsp,' ').replace(lineFeed,' ');var text=documentHelper.editableDiv.textContent.replace(nbsp,' ').replace(lineFeed,' ');var textBoxText=text.substring(2);if(documentHelper.isCompositionStart&&documentHelper.isCompositionUpdated){documentHelper.isCompositionUpdated=false;if(!documentHelper.owner.isReadOnlyMode&&documentHelper.owner.isDocumentLoaded&&_this.canEditContentControl){if(documentHelper.prefix.substring(2)!==textBoxText){if(_this.selection.isEmpty){// eslint-disable-next-line max-len
_this.selection.start.setPositionForLineWidget(documentHelper.selection.start.currentWidget,_this.selection.start.offset-(documentHelper.prefix.length-2));_this.handleTextInput(textBoxText);documentHelper.prefix='@'+String.fromCharCode(160)+textBoxText;}else{_this.handleTextInput(textBoxText);documentHelper.prefix='@'+String.fromCharCode(160)+textBoxText;}}}return;}else if(documentHelper.isCompositionStart&&documentHelper.isCompositionEnd&&documentHelper.suffix===''){if(documentHelper.prefix.substring(2)!==textBoxText){if(_this.selection.isEmpty&&documentHelper.isCompositionStart){documentHelper.isCompositionStart=false;// eslint-disable-next-line max-len
_this.selection.start.setPositionForLineWidget(documentHelper.selection.start.currentWidget,_this.selection.start.offset-documentHelper.prefix.substring(2).length);_this.selection.retrieveCurrentFormatProperties();if(documentHelper.suffix===''||textBoxText===''){_this.handleTextInput(textBoxText);}}else if(!_this.selection.isEmpty){documentHelper.isCompositionStart=false;_this.handleTextInput(textBoxText);}}else if(textBoxText===''){documentHelper.isCompositionStart=false;_this.handleBackKey();}else if(documentHelper.prefix.substring(2)===textBoxText&&documentHelper.suffix===''){documentHelper.isCompositionStart=false;_this.handleTextInput(' ');}documentHelper.isCompositionEnd=false;return;}else if(documentHelper.isCompositionEnd||documentHelper.isCompositionStart&&!documentHelper.isCompositionUpdated){if(textBoxText.length<documentHelper.prefix.length&&// eslint-disable-next-line max-len
textBoxText===documentHelper.prefix.substring(2,documentHelper.prefix.length-1)||documentHelper.editableDiv.innerText.length<2){_this.handleBackKey();return;}else if(documentHelper.suffix!==''&&documentHelper.editableDiv.innerText[documentHelper.editableDiv.innerText.length-1]!==String.fromCharCode(160)){documentHelper.isCompositionStart=false;//When cursor is placed in between a word and chosen a word from predicted words.
// eslint-disable-next-line max-len
_this.selection.start.setPositionForLineWidget(documentHelper.selection.start.currentWidget,_this.selection.start.offset-(documentHelper.prefix.length-2));// eslint-disable-next-line max-len
_this.selection.end.setPositionForLineWidget(documentHelper.selection.end.currentWidget,_this.selection.end.offset+documentHelper.suffix.length);//Retrieve the character format properties. Since the selection was changed manually.
_this.selection.retrieveCurrentFormatProperties();_this.handleTextInput(textBoxText);return;}}if(text!=='\r'&&text!=='\b'&&text!=="\x1B"&&!documentHelper.owner.isReadOnlyMode&&documentHelper.isControlPressed===false&&_this.canEditContentControl){if(text==='@'||text[0]!=='@'||text===''||text.length<documentHelper.prefix.length&&textBoxText===documentHelper.prefix.substring(2,documentHelper.prefix.length-1)){_this.handleBackKey();if(documentHelper.editableDiv.innerText.length<2){_this.predictText();}}else if(text.indexOf(documentHelper.prefix)===0&&text.length>documentHelper.prefix.length){_this.handleTextInput(text.substring(documentHelper.prefix.length));}else if(text.indexOf(documentHelper.prefix)===-1&&text[text.length-1]!==String.fromCharCode(160)&&text[text.length-1]!==' '){if(textBoxText.charAt(0).toLowerCase()+textBoxText.slice(1)===documentHelper.prefix.substring(2)){// eslint-disable-next-line max-len
_this.selection.start.setPositionParagraph(documentHelper.selection.start.currentWidget,_this.selection.start.offset-(documentHelper.prefix.length-2));}_this.handleTextInput(textBoxText);}else if(text.length!==2){_this.handleTextInput(' ');}}}else{var text=_this.documentHelper.editableDiv.innerText;if(text!==String.fromCharCode(160)){if(text!=='\r'&&text!=='\b'&&text!=="\x1B"&&!_this.owner.isReadOnlyMode&&_this.documentHelper.isControlPressed===false&&_this.canEditContentControl){_this.handleTextInput(text);}}else{_this.handleTextInput(' ');}_this.documentHelper.editableDiv.innerText='';}};/**
         * Fired on paste.
         *
         * @param {ClipboardEvent} event - Specfies clipboard event
         * @private
         * @returns {void}
         */this.onPaste=function(event){if(!_this.owner.isReadOnlyMode&&_this.canEditContentControl){_this.pasteInternal(event);}event.preventDefault();};this.documentHelper=documentHelper;this.tableResize=new TableResizer(this.documentHelper.owner);this.base64=new Base64();}Object.defineProperty(Editor.prototype,"restrictFormatting",{/**
         * @private
         * @returns {boolean} - Returns the restrict formatting
         */get:function get(){return this.documentHelper.isDocumentProtected&&(this.documentHelper.restrictFormatting||!this.documentHelper.restrictFormatting&&!this.selection.isSelectionInEditRegion());},enumerable:true,configurable:true});Object.defineProperty(Editor.prototype,"restrictEditing",{/**
         * @private
         * @returns {boolean} - Returns the restrict editing
         */get:function get(){return this.documentHelper.isDocumentProtected&&(this.documentHelper.protectionType==='ReadOnly'&&!this.selection.isSelectionInEditRegion()||this.documentHelper.protectionType==='FormFieldsOnly');},enumerable:true,configurable:true});Object.defineProperty(Editor.prototype,"canEditContentControl",{/**
         * @private
         * @returns {boolean} - Returns the can edit content control.
         */get:function get(){if(this.owner.isReadOnlyMode){return false;}if(this.selection.checkContentControlLocked()){return false;}return true;},enumerable:true,configurable:true});Object.defineProperty(Editor.prototype,"viewer",{get:function get(){if(!sf.base.isNullOrUndefined(this.owner)){return this.owner.viewer;}return undefined;},enumerable:true,configurable:true});Object.defineProperty(Editor.prototype,"editorHistory",{get:function get(){return this.documentHelper.owner.editorHistory;},enumerable:true,configurable:true});Object.defineProperty(Editor.prototype,"selection",{get:function get(){if(this.documentHelper){return this.documentHelper.selection;}return undefined;},enumerable:true,configurable:true});Object.defineProperty(Editor.prototype,"owner",{get:function get(){return this.documentHelper.owner;},enumerable:true,configurable:true});Editor.prototype.getModuleName=function(){return'Editor';};/**
     * Inserts the specified field at cursor position
     *
     * @param {string} code - Specify the field code
     * @param {string} result - Specify the field result
     * @returns {void}
     */Editor.prototype.insertField=function(code,result){this.isInsertField=true;var fieldCode=code;fieldCode=HelperMethods.trimStart(fieldCode);if(fieldCode.substring(0,8)==='NUMPAGES'){this.insertPageCount(result);}else if(fieldCode.substring(0,4)==='PAGE'){this.insertPageNumber(result);}else{if(sf.base.isNullOrUndefined(result)){if(fieldCode.substring(0,10)==='MERGEFIELD'){fieldCode=fieldCode.substring(10).trim();var index=fieldCode.indexOf('\\*');result=''+fieldCode.substring(0,index).trim()+'';}}var paragraph=new ParagraphWidget();var insertFormat=new WCharacterFormat();var selectionFormat=this.copyInsertFormat(insertFormat,false);var line=new LineWidget(paragraph);var fieldBegin=new FieldElementBox(0);fieldBegin.characterFormat.mergeFormat(selectionFormat);line.children.push(fieldBegin);var fieldCodeSpan=new TextElementBox();fieldCodeSpan.text=code;line.children.push(fieldCodeSpan);var fieldSeparator=new FieldElementBox(2);fieldSeparator.fieldBegin=fieldBegin;fieldBegin.fieldSeparator=fieldSeparator;line.children.push(fieldSeparator);var fieldResultSpan=new TextElementBox();fieldResultSpan.text=result;fieldResultSpan.characterFormat.mergeFormat(selectionFormat);line.children.push(fieldResultSpan);var fieldEnd=new FieldElementBox(1);fieldEnd.characterFormat.mergeFormat(selectionFormat);fieldEnd.fieldSeparator=fieldSeparator;fieldEnd.fieldBegin=fieldBegin;fieldBegin.fieldEnd=fieldEnd;fieldSeparator.fieldEnd=fieldEnd;line.children.push(fieldEnd);fieldBegin.line=line;paragraph.childWidgets.push(line);this.documentHelper.fields.push(fieldBegin);var section=new BodyWidget();section.sectionFormat=new WSectionFormat(section);section.childWidgets.push(paragraph);this.pasteContentsInternal([section],false);}this.isInsertField=false;};/**
     * To update style for paragraph
     *
     * @param {string} style - style name
     * @param {boolean} clearDirectFormatting - Removes manual formatting (formatting not applied using a style)
     * from the selected text, to match the formatting of the applied style. Default value is false.
     * @returns {void}
     */Editor.prototype.applyStyle=function(style,clearDirectFormatting){clearDirectFormatting=sf.base.isNullOrUndefined(clearDirectFormatting)?false:clearDirectFormatting;var startPosition=undefined;var endPosition=undefined;if(clearDirectFormatting){this.initComplexHistory('ApplyStyle');this.setOffsetValue(this.selection);startPosition=this.startOffset;endPosition=this.endOffset;var isSelectionEmpty=this.selection.isEmpty;this.clearFormatting();if(isSelectionEmpty&&!this.selection.isEmpty){this.selection.end.setPositionInternal(this.selection.start);}}/* eslint-disable */var styleObj=this.documentHelper.styles.findByName(style);/* eslint-enable */if(styleObj!==undefined){this.onApplyParagraphFormat('styleName',styleObj,false,true);}else{// eslint-disable-next-line max-len
this.documentHelper.owner.parser.parseStyle(JSON.parse(this.getCompleteStyles()),JSON.parse(this.documentHelper.preDefinedStyles.get(style)),this.documentHelper.styles);this.applyStyle(style);}if(this.editorHistory&&this.editorHistory.currentHistoryInfo&&this.editorHistory.currentHistoryInfo.action==='ApplyStyle'){this.startOffset=startPosition;this.endOffset=endPosition;this.editorHistory.updateComplexHistory();}this.startParagraph=undefined;this.endParagraph=undefined;};// Public Implementation Starts
/**
     * Moves the selected content in the document editor control to clipboard.
     *
     * @returns {void}
     */Editor.prototype.cut=function(){if(this.owner.isReadOnlyMode||this.selection.isEmpty||!this.canEditContentControl){return;}this.selection.copySelectedContent(true);this.documentHelper.owner.parser.isCutPerformed=true;};/**
     * Insert editing region in current selection range.
     *
     * @param {string} user - Specified the native rendering
     * @returns {void}
     */Editor.prototype.insertEditingRegion=function(user){this.insertEditRangeElement(user&&user!==''?user:'Everyone');};Editor.prototype.enforceProtection=function(credential,restrictFormatType,isReadOnly){var typeOfProtection;var limitToFormatting;if(typeof restrictFormatType==='boolean'){typeOfProtection=isReadOnly?'ReadOnly':this.documentHelper.protectionType;limitToFormatting=restrictFormatType;}else{limitToFormatting=true;typeOfProtection=restrictFormatType;}this.documentHelper.restrictFormatting=limitToFormatting;this.documentHelper.protectionType=typeOfProtection;this.selection.isHighlightEditRegion=true;this.addProtection(credential,this.documentHelper.protectionType);};Editor.prototype.getCommentHierarchicalIndex=function(comment){var index='';while(comment.ownerComment){index=comment.ownerComment.replyComments.indexOf(comment)+';'+index;comment=comment.ownerComment;}index='C;'+this.documentHelper.comments.indexOf(comment)+';'+index;return index;};Editor.prototype.alertBox=function(){// const localObj: L10n = new L10n('documenteditor', this.owner.defaultLocale);
// localObj.setLocale(this.owner.locale);
// DialogUtility.alert(localObj.getConstant('Multiple Comment'));
};/**
     * Insert comment
     *
     * @param {string} text - comment text.
     * @returns {void}
     */ // Comment implementation starts
Editor.prototype.insertComment=function(text){if(sf.base.isNullOrUndefined(this.selection.start)||this.owner.isReadOnlyMode||this.viewer.owner.enableHeaderAndFooter||!this.viewer.owner.enableComment){return;}// if (this.viewer.owner.commentReviewPane.commentPane.isEditMode) {
//     return this.alertBox();
// }
if(sf.base.isNullOrUndefined(text)){text='';}this.insertCommentInternal(text);};/**
     * @private
     */Editor.prototype.insertCommentInternal=function(text){if(this.selection.isEmpty){// If selection is at paragraph end, move selection to previous word similar to MS Word
if(this.selection.start.isAtSamePosition(this.selection.end)&&this.selection.start.isAtParagraphEnd){var startOffset=this.selection.start.offset;this.selection.start.offset=startOffset-1!==-1?startOffset-1:startOffset;}this.selection.selectCurrentWord();// If paragraph mark selected, remove paragraph mark selection
if(this.selection.isParagraphLastLine(this.selection.end.currentWidget)&&this.selection.end.offset===this.selection.getLineLength(this.selection.end.currentWidget)+1){this.selection.end.offset-=1;}}var paragraphInfo=this.selection.getParagraphInfo(this.selection.start);var startIndex=this.selection.getHierarchicalIndex(paragraphInfo.paragraph,paragraphInfo.offset.toString());var endParagraphInfo=this.selection.getParagraphInfo(this.selection.end);var endIndex=this.selection.getHierarchicalIndex(endParagraphInfo.paragraph,endParagraphInfo.offset.toString());this.initComplexHistory('InsertComment');var startPosition=this.selection.start;var endPosition=this.selection.end;var position=new TextPosition(this.owner);if(!this.selection.isForward){startPosition=this.selection.end;endPosition=this.selection.start;}// Clones the end position.
position.setPositionInternal(endPosition);var commentRangeStart=new CommentCharacterElementBox(0);var commentRangeEnd=new CommentCharacterElementBox(1);var isAtSameParagraph=startPosition.isInSameParagraphIndex(endPosition);// Adds comment start at selection start position.
endPosition.setPositionInternal(startPosition);this.initInsertInline(commentRangeStart);if(sf.base.isNullOrUndefined(position.paragraph)){var endIndex_1=this.selection.getHierarchicalIndex(endParagraphInfo.paragraph,endParagraphInfo.offset.toString());var endPos=this.selection.getTextPosBasedOnLogicalIndex(endIndex_1);position.setPositionInternal(endPos);}// Updates the cloned position, since comment start is added in the same paragraph.
if(isAtSameParagraph){position.setPositionParagraph(position.currentWidget,position.offset+commentRangeStart.length);}// Adds comment end and comment at selection end position.
startPosition.setPositionInternal(position);endPosition.setPositionInternal(position);this.initInsertInline(commentRangeEnd);var commentAdv=new CommentElementBox(new Date().toISOString());if(this.owner.editorHistory){this.initHistory('InsertCommentWidget');this.owner.editorHistory.currentBaseHistoryInfo.removedNodes.push(commentAdv);}commentAdv.author=this.owner.currentUser?this.owner.currentUser:'Guest user';commentAdv.initial=this.constructCommentInitial(commentAdv.author);commentAdv.text=text;commentAdv.commentId=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);commentRangeStart.comment=commentAdv;commentRangeStart.commentId=commentAdv.commentId;commentRangeEnd.comment=commentAdv;commentRangeEnd.commentId=commentAdv.commentId;commentAdv.commentStart=commentRangeStart;commentAdv.commentEnd=commentRangeEnd;this.addCommentWidget(commentAdv,true,true,true);if(this.editorHistory){this.editorHistory.currentBaseHistoryInfo.insertPosition=this.getCommentHierarchicalIndex(commentAdv);this.editorHistory.updateHistory();}// this.selection.selectPosition(this.selection.getTextPosBasedOnLogicalIndex(startIndex), this.selection.getTextPosBasedOnLogicalIndex(endIndex));
if(this.editorHistory){this.editorHistory.updateComplexHistory();}this.reLayout(this.selection,false);return commentAdv;};/**
     * Delete all the comments in current document
     *
     * @returns {void}
     */Editor.prototype.deleteAllComments=function(){if(this.documentHelper.comments.length===0){return;}// this.documentHelper.clearSearchHighlight();
this.initComplexHistory('DeleteAllComments');this.owner.isLayoutEnabled=false;var historyInfo;if(this.editorHistory&&this.editorHistory.currentHistoryInfo){historyInfo=this.editorHistory.currentHistoryInfo;}while(this.documentHelper.comments.length>0){var comment=this.documentHelper.comments[0];this.initComplexHistory('DeleteComment');this.deleteCommentInternal(comment);if(this.editorHistory&&this.editorHistory.currentHistoryInfo){historyInfo.addModifiedAction(this.editorHistory.currentHistoryInfo);}}this.selection.selectContent(this.owner.documentStart,true);if(this.editorHistory){this.editorHistory.currentHistoryInfo=historyInfo;this.editorHistory.updateComplexHistory();}};/**
     * Delete current selected comment.
     *
     * @returns {void}
     */Editor.prototype.deleteComment=function(){if(this.owner.isReadOnlyMode||sf.base.isNullOrUndefined(this.owner)||sf.base.isNullOrUndefined(this.owner.viewer)||sf.base.isNullOrUndefined(this.owner.documentHelper.currentSelectedComment)||this.owner.enableHeaderAndFooter||!this.viewer.owner.enableComment){return;}this.deleteCommentInternal(this.owner.documentHelper.currentSelectedComment);};/**
     * @param {CommentElementBox} comment - Specified the comment element box
     * @private
     * @returns {void}
     */Editor.prototype.deleteCommentInternal=function(comment){this.initComplexHistory('DeleteComment');if(comment){var commentStart=comment.commentStart;var commentEnd=comment.commentEnd;if(commentEnd.indexInOwner!==-1){this.removeInline(commentEnd);}if(commentStart.indexInOwner!==-1){this.removeInline(commentStart);}commentStart.removeCommentMark();if(comment.replyComments.length>0){for(var i=comment.replyComments.length-1;i>=0;i--){this.deleteCommentInternal(comment.replyComments[i]);}}if(this.owner.editorHistory){this.initHistory('DeleteCommentWidget');this.owner.editorHistory.currentBaseHistoryInfo.insertPosition=this.getCommentHierarchicalIndex(comment);this.owner.editorHistory.currentBaseHistoryInfo.removedNodes.push(comment);}this.deleteCommentWidget(comment);if(this.editorHistory){this.editorHistory.updateHistory();}}if(this.editorHistory){this.editorHistory.updateComplexHistory();}};/**
     * @param {CommentElementBox} comment - Specified the comment element box
     * @private
     * @returns {void}
     */Editor.prototype.deleteCommentWidget=function(comment){var commentIndex=this.documentHelper.comments.indexOf(comment);if(commentIndex!==-1){this.documentHelper.comments.splice(commentIndex,1);}else if(comment.isReply&&comment.ownerComment){commentIndex=comment.ownerComment.replyComments.indexOf(comment);comment.ownerComment.replyComments.splice(commentIndex,1);}var deleteCommentJson;var deleteCommentObj={};deleteCommentObj.comment=this.getCommentObj(comment);deleteCommentJson=JSON.stringify(deleteCommentObj);this.owner.dotNetRef.invokeMethodAsync('DeleteCommentWidget',deleteCommentJson);// if (this.owner.commentReviewPane) {
//     this.owner.commentReviewPane.deleteComment(comment);
//     if (this.documentHelper.currentSelectedComment === comment) {
//         this.documentHelper.currentSelectedComment = undefined;
//     }
// }
};/**
     * @param {CommentElementBox} comment - Specified the comment element box
     * @private
     * @returns {void}
     */Editor.prototype.resolveComment=function(comment){if(this.owner.isReadOnlyMode){return;}// const eventArgs: CommentActionEventArgs = { author: comment.author, cancel: false, type: 'Resolve' };
// this.owner.trigger('beforeCommentAction', eventArgs);
// if (eventArgs.cancel && eventArgs.type === 'Resolve') {
//     return;
// }
this.resolveOrReopenComment(comment,true);// if (this.owner.commentReviewPane) {
//     this.owner.commentReviewPane.resolveComment(comment);
// }
};/**
     * @param {CommentElementBox} comment - Specified the comment element box
     * @private
     * @returns {void}
     */Editor.prototype.reopenComment=function(comment){if(this.owner.isReadOnlyMode){return;}// const eventArgs: CommentActionEventArgs = { author: comment.author, cancel: false, type: 'Reopen' };
// this.owner.trigger('beforeCommentAction', eventArgs);
// if (eventArgs.cancel && eventArgs.type === 'Reopen') {
//     return;
// }
this.resolveOrReopenComment(comment,false);// if (this.owner.commentReviewPane) {
//     this.owner.commentReviewPane.reopenComment(comment);
// }
};Editor.prototype.resolveOrReopenComment=function(comment,resolve){comment.isResolved=resolve;for(var i=0;i<comment.replyComments.length;i++){comment.replyComments[i].isResolved=resolve;}};/**
     * @param {CommentElementBox} parentComment - Specified the parent comment
     * @param {string} text - Specified the text.
     * @private
     * @returns {void}
     */Editor.prototype.replyComment=function(parentComment,text){if(this.owner.isReadOnlyMode){return;}var commentWidget=parentComment;if(parentComment){this.initComplexHistory('InsertComment');var currentCmtStart=commentWidget.commentStart;var currentCmtEnd=commentWidget.commentEnd;var offset=currentCmtStart.line.getOffset(currentCmtStart,1);var startPosition=new TextPosition(this.documentHelper.owner);startPosition.setPositionParagraph(currentCmtStart.line,offset);var endOffset=currentCmtEnd.line.getOffset(currentCmtEnd,1);var endPosition=new TextPosition(this.documentHelper.owner);endPosition.setPositionParagraph(currentCmtEnd.line,endOffset);this.selection.start.setPositionInternal(startPosition);this.selection.end.setPositionInternal(endPosition);startPosition=this.selection.start;endPosition=this.selection.end;var position=new TextPosition(this.owner);// Clones the end position.
position.setPositionInternal(endPosition);var commentRangeStart=new CommentCharacterElementBox(0);var commentRangeEnd=new CommentCharacterElementBox(1);var isAtSameParagraph=startPosition.isInSameParagraph(endPosition);// Adds comment start at selection start position.
endPosition.setPositionInternal(startPosition);this.initInsertInline(commentRangeStart);// Updates the cloned position, since comment start is added in the same paragraph.
if(isAtSameParagraph){position.setPositionParagraph(position.currentWidget,position.offset+commentRangeStart.length);}// Adds comment end and comment at selection end position.
startPosition.setPositionInternal(position);endPosition.setPositionInternal(position);this.initInsertInline(commentRangeEnd);var replyComment=new CommentElementBox(new Date().toISOString());replyComment.author=this.owner.currentUser?this.owner.currentUser:'Guest user';replyComment.text=text?text:'';replyComment.commentId=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);replyComment.isReply=true;commentWidget.replyComments.push(replyComment);replyComment.ownerComment=commentWidget;if(this.owner.editorHistory){this.initHistory('InsertCommentWidget');this.owner.editorHistory.currentBaseHistoryInfo.removedNodes.push(replyComment);}commentRangeStart.comment=replyComment;commentRangeStart.commentId=replyComment.commentId;commentRangeEnd.comment=replyComment;commentRangeEnd.commentId=replyComment.commentId;replyComment.commentStart=commentRangeStart;replyComment.commentEnd=commentRangeEnd;// if (this.owner.commentReviewPane) {
//     this.owner.commentReviewPane.addReply(replyComment, false, true);
// }
if(this.editorHistory){this.editorHistory.currentBaseHistoryInfo.insertPosition=this.getCommentHierarchicalIndex(replyComment);this.editorHistory.updateHistory();}if(this.editorHistory){this.editorHistory.updateComplexHistory();}this.reLayout(this.selection);}};Editor.prototype.removeInline=function(element){this.selection.start.setPositionParagraph(element.line,element.line.getOffset(element,0));this.selection.end.setPositionParagraph(this.selection.start.currentWidget,this.selection.start.offset+element.length);this.initHistory('RemoveInline');if(this.editorHistory&&this.editorHistory.currentBaseHistoryInfo){this.updateHistoryPosition(this.selection.start,true);}this.removeSelectedContents(this.documentHelper.selection);if(this.editorHistory){this.editorHistory.updateHistory();}this.fireContentChange();};/**
     * @param {CommentElementBox} commentWidget - Specifies the comment
     * @param {boolean} isNewComment - Specifies is new comment
     * @param {boolean} showComments - Specifies show comments
     * @param {boolean} selectComment - Specified select comment
     * @private
     * @returns {void}
     */Editor.prototype.addCommentWidget=function(commentWidget,isNewComment,showComments,selectComment){if(this.documentHelper.comments.indexOf(commentWidget)===-1){var isInserted=false;if(this.documentHelper.comments.length>0){var currentStart=this.selection.getElementPosition(commentWidget.commentStart).startPosition;for(var i=0;i<this.documentHelper.comments.length;i++){// eslint-disable-next-line max-len
var paraIndex=this.selection.getElementPosition(this.documentHelper.comments[i].commentStart).startPosition;if(currentStart.isExistBefore(paraIndex)){isInserted=true;this.documentHelper.comments.splice(i,0,commentWidget);break;}}}if(!isInserted){this.documentHelper.comments.push(commentWidget);}var newCommentJson=void 0;var newCommentObj={};newCommentObj.comment=this.getCommentObj(commentWidget);newCommentObj.index=this.documentHelper.comments.indexOf(commentWidget);newCommentObj.isNewComment=isNewComment;newCommentJson=JSON.stringify(newCommentObj);this.owner.dotNetRef.invokeMethodAsync('AddCommentWidget',newCommentJson);// if (this.owner.commentReviewPane) {
//     this.owner.showComments = showComments;
//     this.owner.commentReviewPane.selectedTab = 0;
//     this.owner.commentReviewPane.addComment(commentWidget, isNewComment, selectComment);
//     if (selectComment) {
//         this.owner.selection.selectComment(commentWidget);
//     }
// }
}};/**
     * @param {CommentElementBox} comment - Specifies comment element box
     * @param {string} hierarchicalIndex - Specifies the hierachical index.
     * @private
     * @returns {void}
     */Editor.prototype.addReplyComment=function(comment,hierarchicalIndex){var index=hierarchicalIndex.split(';');var ownerComment=this.documentHelper.comments[parseInt(index[1],10)];if(index[2]!==''){ownerComment.replyComments.splice(parseInt(index[2],10),0,comment);comment.ownerComment=ownerComment;}var replyCommentJson;var replyCommentObj={};replyCommentObj.comment=this.getCommentObj(comment);replyCommentObj.index=ownerComment.replyComments.indexOf(comment);replyCommentJson=JSON.stringify(replyCommentObj);this.owner.dotNetRef.invokeMethodAsync('AddReplyComment',replyCommentJson);// if (this.owner.commentReviewPane) {
//     this.owner.showComments = true;
//     this.owner.commentReviewPane.addReply(comment, false, true);
//     this.owner.selection.selectComment(comment);
// }
};/**
 * @private
 */Editor.prototype.getCommentObj=function(commentEle){var comment={};comment.date=commentEle.date;comment.text=commentEle.text;comment.isReply=commentEle.isReply;comment.isResolved=commentEle.isResolved;comment.author=commentEle.author;comment.initial=commentEle.initial;comment.commentId=commentEle.commentId;comment.userColor=this.documentHelper.getAuthorColor(commentEle.author);if(commentEle.ownerComment&&commentEle.ownerComment.commentId){comment.ownerCommentId=commentEle.ownerComment.commentId;}return comment;};/**
     * @param {string} password - Specifies the password
     * @param {string} protectionType - Specifies the protection type
     * @private
     * @returns {void}
     */Editor.prototype.addProtection=function(password,protectionType){if(password===''){this.protectDocument(protectionType);}else{this.currentProtectionType=protectionType;var enforceProtectionHandler=new XmlHttpRequestHandler();var passwordBase64=this.base64.encodeString(password);/* eslint-disable @typescript-eslint/no-explicit-any */var formObject={passwordBase64:passwordBase64,saltBase64:'',spinCount:100000};/* eslint-enable @typescript-eslint/no-explicit-any */var url=this.owner.serviceUrl+this.owner.serverActionSettings.restrictEditing;enforceProtectionHandler.url=url;enforceProtectionHandler.contentType='application/json;charset=UTF-8';enforceProtectionHandler.onSuccess=this.enforceProtectionInternal.bind(this);enforceProtectionHandler.onFailure=this.protectionFailureHandler.bind(this);enforceProtectionHandler.onError=this.protectionFailureHandler.bind(this);enforceProtectionHandler.customHeaders=this.owner.headers;enforceProtectionHandler.send(formObject);}};/* eslint-disable @typescript-eslint/no-explicit-any */Editor.prototype.protectionFailureHandler=function(result){// const localeValue: L10n = new L10n('documenteditor', this.owner.defaultLocale);
// localeValue.setLocale(this.documentHelper.owner.locale);
// if (result.name === 'onError') {
//     DialogUtility.alert(localeValue.getConstant('Error in establishing connection with web server'));
// } else {
//     this.owner.fireServiceFailure(result);
//     console.error(result.statusText);
// }
};/**
     * @private
     */Editor.prototype.enforceProtectionInternal=function(result,protectionType){var data=JSON.parse(result.data);this.documentHelper.saltValue=data[0];this.documentHelper.hashValue=data[1];if(protectionType){this.currentProtectionType=protectionType;}this.protectDocument(this.currentProtectionType);};/* eslint-enable @typescript-eslint/no-explicit-any */Editor.prototype.protectDocument=function(protectionType){this.protect(protectionType);// const restrictPane: HTMLElement = this.documentHelper.restrictEditingPane.restrictPane;
// if (restrictPane && restrictPane.style.display === 'block') {
//     this.documentHelper.restrictEditingPane.showStopProtectionPane(true);
//     this.documentHelper.restrictEditingPane.loadPaneValue();
//     this.documentHelper.dialog.hide();
// }
};/**
     * Stop document protection.
     *
     * @param {string} password - Specifies the password
     * @returns {void}
     */ /* eslint-disable @typescript-eslint/no-explicit-any */Editor.prototype.stopProtection=function(password){if(this.documentHelper.isDocumentProtected){var unProtectDocumentHandler=new XmlHttpRequestHandler();var passwordBase64=this.base64.encodeString(password);var formObject={passwordBase64:passwordBase64,saltBase64:this.documentHelper.saltValue,spinCount:100000};unProtectDocumentHandler.url=this.owner.serviceUrl+this.owner.serverActionSettings.restrictEditing;unProtectDocumentHandler.contentType='application/json;charset=UTF-8';unProtectDocumentHandler.customHeaders=this.owner.headers;unProtectDocumentHandler.onSuccess=this.onUnProtectionSuccess.bind(this);unProtectDocumentHandler.onFailure=this.protectionFailureHandler.bind(this);unProtectDocumentHandler.onError=this.protectionFailureHandler.bind(this);unProtectDocumentHandler.send(formObject);}};/**
     * @private
     */Editor.prototype.onUnProtectionSuccess=function(result){var encodeString=JSON.parse(result.data);this.validateHashValue(encodeString[1]);};/* eslint-enable @typescript-eslint/no-explicit-any */Editor.prototype.validateHashValue=function(currentHashValue){// const localeValue: L10n = new L10n('documenteditor', this.owner.defaultLocale);
// localeValue.setLocale(this.documentHelper.owner.locale);
var decodeUserHashValue=this.base64.decodeString(currentHashValue);var documentHashValue=this.documentHelper.hashValue;var defaultHashValue=this.base64.decodeString(documentHashValue);var stopProtection=true;if(decodeUserHashValue.length===defaultHashValue.length){for(var i=0;i<decodeUserHashValue.length;i++){if(decodeUserHashValue[i]!==defaultHashValue[i]){stopProtection=false;break;}}}else{stopProtection=false;}if(stopProtection){this.unProtectDocument();}else{// DialogUtility.alert(localeValue.getConstant('The password is incorrect'));
}};/**
     * @private
     * @returns {void}
     */Editor.prototype.unProtectDocument=function(){this.documentHelper.isDocumentProtected=false;this.documentHelper.restrictFormatting=false;this.documentHelper.selection.highlightEditRegion();// const restrictPane: HTMLElement = this.documentHelper.restrictEditingPane.restrictPane;
// if (restrictPane && restrictPane.style.display === 'block') {
//     this.documentHelper.restrictEditingPane.showStopProtectionPane(false);
// }
// this.documentHelper.dialog.hide();
};/**
     * Notify content change event
     *
     * @private
     * @returns {void}
     */Editor.prototype.fireContentChange=function(){if(this.selection.isHighlightEditRegion){// if (this.owner.enableLockAndEdit) {
//     this.owner.collaborativeEditingModule.updateLockRegion();
// } else {
this.selection.onHighlight();// }
}this.selection.highlightFormFields();if(!this.isPaste){this.copiedContent=undefined;this.copiedTextContent='';this.previousSectionFormat=undefined;this.previousParaFormat=undefined;this.previousCharFormat=undefined;this.selection.isViewPasteOptions=false;if(this.isPasteListUpdated){this.isPasteListUpdated=false;}this.selection.showHidePasteOptions(undefined,undefined);}if(this.documentHelper.owner.isLayoutEnabled&&!this.documentHelper.owner.isShiftingEnabled){this.documentHelper.owner.fireContentChange();}if(!sf.base.isNullOrUndefined(this.selection.editPosition)){this.triggerPageSpellCheck=false;}};/**
     * Update physical location for text position
     *
     * @param {boolean} isSelectionChanged - Specifies the selection change
     * @private
     * @returns {void}
     */Editor.prototype.updateSelectionTextPosition=function(isSelectionChanged){this.getOffsetValue(this.selection);this.selection.start.updatePhysicalPosition(true);if(this.selection.isEmpty){this.selection.end.setPositionInternal(this.selection.start);}else{this.selection.end.updatePhysicalPosition(true);}this.selection.upDownSelectionLength=this.selection.end.location.x;this.selection.fireSelectionChanged(isSelectionChanged);};/**
     * Predict text
     *
     * @private
     * @returns {void}
     */Editor.prototype.predictText=function(){this.documentHelper.suffix='';if(this.selection.start.paragraph.isEmpty()||this.selection.start.offset===0&&this.selection.start.currentWidget.isFirstLine()||this.selection.end.offset===0&&this.selection.end.currentWidget.isFirstLine()){this.documentHelper.prefix='';}else{this.getPrefixAndSuffix();}this.documentHelper.prefix='@'+String.fromCharCode(160)+this.documentHelper.prefix;// &nbsp;
this.documentHelper.editableDiv.innerText=this.documentHelper.prefix;this.documentHelper.selection.setEditableDivCaretPosition(this.documentHelper.prefix.length);};/* eslint-disable  */Editor.prototype.getPrefixAndSuffix=function(){//let viewer: LayoutViewer = this.owner.viewer;
var editor=this.owner;var documentHelper=editor.documentHelper;if(this.selection.text!==''){documentHelper.prefix='';return;}else{var startIndex=0;var inlineInfo=this.selection.start.currentWidget.getInline(this.selection.start.offset,startIndex);var inline=inlineInfo.element;startIndex=inlineInfo.index;if(inline!==undefined){var boxInfo=this.selection.getElementBoxInternal(inline,startIndex);var box=boxInfo.element;startIndex=boxInfo.index;var spaceIndex=0;if(!sf.base.isNullOrUndefined(box)){var prefixAdded=false;if(box instanceof TextElementBox&&startIndex>0&&box.line.isFirstLine()){documentHelper.prefix='';}if(!(inline instanceof TextElementBox)){inline=this.selection.getPreviousTextElement(inline);}/* eslint-disable no-cond-assign */while((spaceIndex=documentHelper.prefix.lastIndexOf(' '))<0&&inline instanceof TextElementBox){if(inline.previousNode instanceof TextElementBox&&documentHelper.prefix.indexOf(' ')===-1){if(!prefixAdded){documentHelper.prefix=inline.text.substring(0,startIndex);prefixAdded=true;}else{documentHelper.prefix=inline.text+documentHelper.prefix;}inline=inline.previousNode;// If the line has no elements then break the loop to avoid the exception.
if(inline instanceof ListTextElementBox){break;}if(!(inline instanceof TextElementBox)){inline=this.selection.getPreviousTextElement(inline);}}else if(!(inline.previousNode instanceof TextElementBox)){if(!prefixAdded){documentHelper.prefix=inline.text.substring(0,startIndex);prefixAdded=true;}else{documentHelper.prefix=inline.text+documentHelper.prefix;}break;}}if(!(documentHelper.prefix.length>1&&documentHelper.prefix[documentHelper.prefix.length-1]===' '&&documentHelper.prefix[documentHelper.prefix.length-2]==='.')){spaceIndex=documentHelper.prefix.lastIndexOf(' ');}else{spaceIndex=-1;documentHelper.prefix='';}documentHelper.prefix=spaceIndex<0?documentHelper.prefix:documentHelper.prefix.substring(spaceIndex);if(documentHelper.prefix.indexOf(' ')===0&&documentHelper.prefix.length>=1){documentHelper.prefix=documentHelper.prefix.substring(1);}// suffix text prediction
var endIndex=0;var endInlineInfo=this.selection.end.currentWidget.getInline(this.selection.end.offset,endIndex);var endInline=endInlineInfo.element;endIndex=endInlineInfo.index;boxInfo=this.selection.getElementBoxInternal(endInline,endIndex);box=boxInfo.element;endIndex=boxInfo.index;if(box){var suffixAdded=false;if(box instanceof TextElementBox&&endIndex<box.length){documentHelper.suffix='';}// boxIndex = renderedElements.get(endInline).indexOf(box);
while((spaceIndex=documentHelper.suffix.indexOf(' '))<0&&endInline instanceof TextElementBox){if(endInline.nextNode instanceof TextElementBox&&documentHelper.suffix.indexOf(' ')===-1){if(!suffixAdded){documentHelper.suffix=box.text.substring(endIndex);suffixAdded=true;}else{documentHelper.suffix=documentHelper.suffix+endInline.text;}endInline=endInline.nextNode;}else if(!(endInline.nextNode instanceof TextElementBox)){if(!suffixAdded){documentHelper.suffix=box.text.substring(endIndex);suffixAdded=true;}else{documentHelper.suffix=documentHelper.suffix+endInline.text;}break;}}spaceIndex=documentHelper.suffix.indexOf(' ');documentHelper.suffix=spaceIndex<0?documentHelper.suffix:documentHelper.suffix.substring(0,spaceIndex);}}}}};/**
     * key action
     * @private
     * @returns {void}
     */ /* eslint-disable  */Editor.prototype.onKeyDownInternal=function(event,ctrl,shift,alt){var key=event.which||event.keyCode;if(ctrl&&!shift&&!alt){this.documentHelper.isControlPressed=true;switch(key){case 8:event.preventDefault();this.handleCtrlBackKey();break;case 46:event.preventDefault();this.handleCtrlDelete();break;case 9:event.preventDefault();if(this.owner.acceptTab){this.selection.handleTabKey(false,false);}break;case 13:event.preventDefault();this.insertPageBreak();break;case 48:event.preventDefault();this.onApplyParagraphFormat('beforeSpacing',0,false,false);break;case 49:event.preventDefault();if(!this.owner.isReadOnlyMode||this.selection.isInlineFormFillMode()){this.onApplyParagraphFormat('lineSpacing',1,false,false);}break;case 50:event.preventDefault();if(!this.owner.isReadOnlyMode||this.selection.isInlineFormFillMode()){this.onApplyParagraphFormat('lineSpacing',2,false,false);}break;case 53:event.preventDefault();if(!this.owner.isReadOnlyMode||this.selection.isInlineFormFillMode()){this.onApplyParagraphFormat('lineSpacing',1.5,false,false);}break;case 66:event.preventDefault();if(!this.owner.isReadOnlyMode||this.selection.isInlineFormFillMode()){this.toggleBold();}break;case 68:event.preventDefault();this.owner.showDialog("Font");break;case 69:if(!this.owner.isReadOnlyMode||this.selection.isInlineFormFillMode()){this.toggleTextAlignment('Center');}event.preventDefault();break;case 72:event.preventDefault();if(!this.owner.isReadOnly){this.owner.showDialog("ReplacePane");}break;case 73:event.preventDefault();if(!this.owner.isReadOnlyMode||this.selection.isInlineFormFillMode()){this.toggleItalic();}break;case 74:if(!this.owner.isReadOnlyMode||this.selection.isInlineFormFillMode()){this.toggleTextAlignment('Justify');}event.preventDefault();break;case 75:event.preventDefault();this.owner.showDialog("Hyperlink");break;case 76:if(!this.owner.isReadOnlyMode||this.selection.isInlineFormFillMode()){this.toggleTextAlignment('Left');}event.preventDefault();break;case 77:if(!this.owner.isReadOnlyMode||this.selection.isInlineFormFillMode()){this.owner.selection.increaseIndent();}event.preventDefault();break;case 78:event.preventDefault();if(!this.owner.isReadOnlyMode){this.owner.openBlank();}break;case 82:if(!this.owner.isReadOnlyMode||this.selection.isInlineFormFillMode()){this.toggleTextAlignment('Right');}event.preventDefault();break;case 85:event.preventDefault();if(!this.owner.isReadOnlyMode||this.selection.isInlineFormFillMode()){this.owner.selection.toggleUnderline('Single');}break;case 88:event.preventDefault();if(!this.owner.isReadOnlyMode){this.owner.editor.cut();}break;case 89:if(this.owner.enableEditorHistory){this.editorHistory.redo();event.preventDefault();}break;case 90:if(this.owner.enableEditorHistory){this.editorHistory.undo();event.preventDefault();}break;case 219:event.preventDefault();if(!this.owner.isReadOnlyMode||this.selection.isInlineFormFillMode()){this.onApplyCharacterFormat('fontSize','decrement',true);}break;case 221:event.preventDefault();if(!this.owner.isReadOnlyMode||this.selection.isInlineFormFillMode()){this.onApplyCharacterFormat('fontSize','increment',true);}break;case 187:event.preventDefault();if(!this.owner.isReadOnlyMode||this.selection.isInlineFormFillMode()){this.toggleBaselineAlignment('Subscript');}break;}}else if(shift&&!ctrl&&!alt){switch(key){case 9:event.preventDefault();if(this.owner.acceptTab){this.selection.handleTabKey(false,true);}break;case 13:this.handleShiftEnter();event.preventDefault();break;}}else if(shift&&ctrl&&!alt){switch(key){case 68:if(!this.owner.isReadOnlyMode){this.owner.selection.toggleUnderline('Double');}break;case 77:if(!this.owner.isReadOnlyMode){this.owner.selection.decreaseIndent();}event.preventDefault();break;case 188:event.preventDefault();if(!this.owner.isReadOnlyMode){this.onApplyCharacterFormat('fontSize','decrement',true);}break;case 190:event.preventDefault();if(!this.owner.isReadOnlyMode){this.onApplyCharacterFormat('fontSize','increment',true);}break;case 187:event.preventDefault();if(!this.owner.isReadOnlyMode){this.toggleBaselineAlignment('Superscript');}break;case 69:event.preventDefault();if(!this.owner.isReadOnlyMode){var eventArgs={isTrackChangesEnabled:!this.owner.enableTrackChanges};// this.owner.trigger('trackChange', eventArgs);
}}}else if(!shift&&ctrl&&alt){switch(key){case 72:event.preventDefault();if(!this.owner.isReadOnlyMode&&this.owner.isDocumentLoaded){this.toggleHighlightColor();}break;case 70:event.preventDefault();if(!this.owner.isReadOnlyMode&&this.owner.isDocumentLoaded){this.insertFootnote();}break;case 68:event.preventDefault();if(!this.owner.isReadOnlyMode&&this.owner.isDocumentLoaded){this.insertEndnote();}break;}}else{switch(key){case 8:event.preventDefault();this.handleBackKey();break;case 9:event.preventDefault();if(this.owner.acceptTab){this.selection.handleTabKey(true,false);}break;case 13:event.preventDefault();this.documentHelper.triggerSpellCheck=true;this.handleEnterKey();this.documentHelper.triggerSpellCheck=false;break;case 27:event.preventDefault();if(!this.isPaste){this.copiedContent=undefined;this.copiedTextContent='';this.previousParaFormat=undefined;this.previousCharFormat=undefined;this.previousSectionFormat=undefined;this.selection.isViewPasteOptions=false;if(this.isPasteListUpdated){this.isPasteListUpdated=false;}this.selection.showHidePasteOptions(undefined,undefined);}break;case 46:this.handleDelete();event.preventDefault();break;case 32:this.selection.handleSpaceBarKey();break;case 120:var textPosition=this.selection.getDocumentEnd();textPosition.offset=this.selection.getDocumentEnd().offset+1;if(this.selection.start.isAtSamePosition(this.selection.getDocumentStart())&&this.selection.end.isAtSamePosition(textPosition)){this.owner.updateFields();}else{this.selection.updateRefField();}break;}}};/**
     * @private
     * @returns {void}
     */Editor.prototype.handleShiftEnter=function(){if(!this.owner.isReadOnlyMode){this.handleTextInput('\v');}this.selection.checkForCursorVisibility();};/**
     * Handles back key.
     *
     * @private
     * @returns {void}
     */Editor.prototype.handleBackKey=function(){if(!this.owner.isReadOnlyMode&&this.canEditContentControl||this.selection.isInlineFormFillMode()){this.owner.editorModule.onBackSpace();}this.selection.checkForCursorVisibility();};/**
     * Handles delete
     *
     * @private
     * @returns {void}
     */Editor.prototype.handleDelete=function(){if(!this.owner.isReadOnlyMode&&this.canEditContentControl||this.selection.isInlineFormFillMode()){this.owner.editorModule["delete"]();}this.selection.checkForCursorVisibility();};/**
     * Handles enter key.
     *
     * @private
     * @returns {void}
     */Editor.prototype.handleEnterKey=function(){if(!this.owner.isReadOnlyMode&&this.canEditContentControl||this.selection.isInlineFormFillMode()){if(sf.base.Browser.isDevice){this.documentHelper.isCompositionStart=false;}this.owner.editorModule.onEnter();}this.selection.checkForCursorVisibility();};/**
     * Handles Control back key.
     *
     * @private
     * @returns {void}
     */Editor.prototype.handleCtrlBackKey=function(){var start=this.selection.start;var end=this.selection.end;if(!this.owner.isReadOnlyMode||this.selection.isInlineFormFillMode()){if(!this.selection.isForward){start=end;}if(this.selection.isEmpty){this.selection.handleControlShiftLeftKey();this.owner.editorModule.onBackSpace();/* eslint-disable max-len */}else if((sf.base.isNullOrUndefined(start.paragraph.previousRenderedWidget)||start.paragraph.previousRenderedWidget instanceof TableWidget)&&start.offset===0){return;}else{this.selection.handleLeftKey();this.selection.handleControlShiftLeftKey();this.owner.editorModule.onBackSpace();}}};/**
     * Handles Ctrl delete
     *
     * @private
     * @returns {void}
     */Editor.prototype.handleCtrlDelete=function(){if(!this.owner.isReadOnlyMode&&this.canEditContentControl||this.selection.isInlineFormFillMode()){if(!this.selection.isEmpty){this.selection.handleLeftKey();this.selection.handleControlShiftRightKey();var selectedText=this.selection.text;var checkSpace=HelperMethods.endsWith(selectedText);if(checkSpace){this.selection.handleShiftLeftKey();}this.owner.editorModule["delete"]();}else{this.selection.handleControlShiftRightKey();this.owner.editorModule["delete"]();}}};/**
     * @private
     * @returns {void}
     */Editor.prototype.handleTextInput=function(text){var _this=this;if(!this.owner.isReadOnlyMode&&this.canEditContentControl||this.selection.isInlineFormFillMode()){if(this.animationTimer){clearTimeout(this.animationTimer);}sf.base.classList(this.selection.caret,[],['e-de-cursor-animation']);this.owner.editorModule.insertText(text);/* eslint-disable @typescript-eslint/indent */this.animationTimer=setTimeout(function(){if(_this.animationTimer){clearTimeout(_this.animationTimer);}if(_this.selection&&_this.selection.caret){sf.base.classList(_this.selection.caret,['e-de-cursor-animation'],[]);}},600);}this.selection.checkForCursorVisibility();};/**
     * Copies to format.
     * @param {WCharacterFormat} format
     * @private
     * @returns {void}
     */Editor.prototype.copyInsertFormat=function(format,copy){var insertFormat=new WCharacterFormat();var sFormat=this.selection.characterFormat;if(copy){insertFormat.copyFormat(format);}if(!sf.base.isNullOrUndefined(sFormat.bold)&&format.bold!==sFormat.bold){insertFormat.bold=sFormat.bold;}if(!sf.base.isNullOrUndefined(sFormat.italic)&&format.italic!==sFormat.italic){insertFormat.italic=sFormat.italic;}if(sFormat.fontSize>0&&format.fontSize!==sFormat.fontSize){insertFormat.fontSize=sFormat.fontSize;}if(!sf.base.isNullOrUndefined(sFormat.fontFamily)&&format.fontFamily!==sFormat.fontFamily){insertFormat.fontFamily=sFormat.fontFamily;}if(!sf.base.isNullOrUndefined(sFormat.highlightColor)&&format.highlightColor!==sFormat.highlightColor){insertFormat.highlightColor=sFormat.highlightColor;}if(!sf.base.isNullOrUndefined(sFormat.baselineAlignment)&&format.baselineAlignment!==sFormat.baselineAlignment){insertFormat.baselineAlignment=sFormat.baselineAlignment;}if(!sf.base.isNullOrUndefined(sFormat.fontColor)&&format.fontColor!==sFormat.fontColor){insertFormat.fontColor=sFormat.fontColor;}if(!sf.base.isNullOrUndefined(sFormat.underline)&&format.underline!==sFormat.underline){insertFormat.underline=sFormat.underline;}if(!sf.base.isNullOrUndefined(sFormat.strikethrough)&&format.strikethrough!==sFormat.strikethrough){insertFormat.strikethrough=sFormat.strikethrough;}return insertFormat;};Editor.prototype.getResultContentControlText=function(element){var ele=element.nextNode;var text='';while(!(ele instanceof ContentControl)){if(ele instanceof TextElementBox){text+=ele.text;}if(sf.base.isNullOrUndefined(ele)){break;}if(sf.base.isNullOrUndefined(ele.nextNode)){if(ele.paragraph.nextRenderedWidget){ele=ele.paragraph.nextRenderedWidget.firstChild.children[0];}else{break;}}else{ele=ele.nextNode;}}return text;};Editor.prototype.updateXmlMappedContentControl=function(){if(this.isXmlMapped){var startInlineEle=this.getContentControl();if(startInlineEle&&startInlineEle.contentControlProperties){this.updateCustomXml(startInlineEle.contentControlProperties.xmlMapping.storeItemId,startInlineEle.contentControlProperties.xmlMapping.xPath,this.getResultContentControlText(startInlineEle));}}};Editor.prototype.updateCustomXml=function(itemId,xPath,text){if(this.documentHelper.customXmlData.containsKey(itemId)){var xml=this.documentHelper.customXmlData.get(itemId);var parser=new DOMParser();var xmlDoc=parser.parseFromString(xml,'text/xml');var lastText=xPath.substring(xPath.lastIndexOf('/')+1);lastText=lastText.split('[')[0];lastText=lastText.substring(lastText.lastIndexOf(':')+1);lastText=lastText.substring(lastText.lastIndexOf('@')+1);var htmlCollec=xmlDoc.getElementsByTagName(lastText);if(htmlCollec.length>0){htmlCollec[0].childNodes[0].nodeValue=text;}else if(xmlDoc.documentElement.attributes.length>0&&xmlDoc.documentElement.attributes.getNamedItem(lastText)!==null){xmlDoc.documentElement.attributes.getNamedItem(lastText).value=text;}else{return;}var newXml=new XMLSerializer();var xmlString=newXml.serializeToString(xmlDoc);this.documentHelper.customXmlData.set(itemId,xmlString);}};/**
     * Inserts the specified text at cursor position
     * @param {string} text - text to insert
     */Editor.prototype.insertText=function(text){if(sf.base.isNullOrUndefined(text)||text===''){return;}this.insertTextInternal(text,false);};/**
     * @private
     * @returns {void}
     */ /* eslint-disable  */Editor.prototype.insertTextInternal=function(text,isReplace,revisionType){if(this.documentHelper.protectionType==='FormFieldsOnly'&&this.selection.isInlineFormFillMode()){var inline=this.selection.getCurrentFormField();var resultText=this.getFormFieldText();var rex=new RegExp(this.owner.documentHelper.textHelper.getEnSpaceCharacter(),'gi');if(resultText.length>0&&resultText.replace(rex,'')===''){resultText='';this.selection.selectFieldInternal(inline);}var maxLength=inline.formFieldData.maxLength;if(maxLength!==0&&resultText.length>=maxLength){return;}}var selection=this.documentHelper.selection;var insertPosition;var isRemoved=true;revisionType=this.owner.enableTrackChanges&&sf.base.isNullOrUndefined(revisionType)?'Insertion':revisionType;this.isListTextSelected();if(sf.base.isNullOrUndefined(revisionType)||revisionType==='Insertion'){this.initHistory('Insert');}var paragraphInfo=this.selection.getParagraphInfo(selection.start);var paraFormat=paragraphInfo.paragraph.paragraphFormat;selection.editPosition=selection.getHierarchicalIndex(paragraphInfo.paragraph,paragraphInfo.offset.toString());var bidi=selection.start.paragraph.paragraphFormat.bidi;if(!selection.isEmpty&&!selection.isImageSelected||this.documentHelper.isListTextSelected&&selection.contextType==='List'){selection.isSkipLayouting=true;selection.skipFormatRetrieval=true;var endPosition=undefined;if(this.owner.enableTrackChanges){if(!this.selection.start.isExistBefore(this.selection.end)){endPosition=this.selection.start.clone();}else{endPosition=this.selection.end.clone();}this.skipReplace=true;}isRemoved=this.removeSelectedContents(selection);this.skipReplace=false;if(!sf.base.isNullOrUndefined(endPosition)&&this.owner.search.isRepalceTracking){this.owner.search.isRepalceTracking=false;this.selection.start.setPositionInternal(this.selection.start);this.selection.end.setPositionInternal(endPosition);}else{if(!sf.base.isNullOrUndefined(endPosition)){this.selection.start.setPositionInternal(endPosition);this.selection.end.setPositionInternal(endPosition);}}selection.skipFormatRetrieval=false;selection.isSkipLayouting=false;}else if(selection.isEmpty&&!this.documentHelper.isListTextSelected&&!isReplace){this.documentHelper.isTextInput=true;}paragraphInfo=this.selection.getParagraphInfo(selection.start);paragraphInfo.paragraph.paragraphFormat.copyFormat(paraFormat);var isSpecialChars=this.documentHelper.textHelper.containsSpecialCharAlone(text);if(isRemoved){selection.owner.isShiftingEnabled=true;this.updateInsertPosition();insertPosition=selection.start;if(insertPosition.paragraph.isEmpty()){var span=new TextElementBox();var insertFormat=this.copyInsertFormat(insertPosition.paragraph.characterFormat,true);span.characterFormat.copyFormat(insertFormat);span.text=text;var isBidi=this.documentHelper.textHelper.getRtlLanguage(text).isRtl;span.characterFormat.bidi=isBidi;span.isRightToLeft=isBidi;span.line=insertPosition.paragraph.childWidgets[0];span.margin=new Margin(0,0,0,0);span.line.children.push(span);if(this.owner.enableTrackChanges){if(span.paragraph.characterFormat.revisions.length>0){var matchedRevisions=this.getMatchedRevisionsToCombine(span.paragraph.characterFormat.revisions,revisionType);if(matchedRevisions.length>0){this.mapMatchedRevisions(matchedRevisions,span.paragraph.characterFormat,span,true);}}else if(!this.checkToCombineRevisionWithPrevPara(span,revisionType)){this.insertRevision(span,revisionType);}}if((insertPosition.paragraph.paragraphFormat.textAlignment==='Center'||insertPosition.paragraph.paragraphFormat.textAlignment==='Right')&&insertPosition.paragraph.paragraphFormat.listFormat.listId===-1){insertPosition.paragraph.x=this.owner.viewer.clientActiveArea.x;}this.documentHelper.layout.reLayoutParagraph(insertPosition.paragraph,0,0);}else{var indexInInline=0;var inlineObj=insertPosition.currentWidget.getInline(insertPosition.offset,indexInInline,bidi,isReplace?false:true);var inline=inlineObj.element;indexInInline=inlineObj.index;inline.ischangeDetected=true;if(inline instanceof TextElementBox&&text!==' '&&this.documentHelper.owner.isSpellCheck){this.owner.spellChecker.removeErrorsFromCollection({'element':inline,'text':inline.text});if(!isReplace){inline.ignoreOnceItems=[];}}if(inline.canTrigger&&inline.text.length<=1){inline.canTrigger=false;}// Todo: compare selection format
var insertFormat=this.copyInsertFormat(inline.characterFormat,true);var isBidi=this.documentHelper.textHelper.getRtlLanguage(text).isRtl;var insertLangId=this.documentHelper.textHelper.getRtlLanguage(text).id;var inlineLangId=0;var isRtl=false;var isInlineContainsSpecChar=false;if(inline instanceof TextElementBox){inlineLangId=this.documentHelper.textHelper.getRtlLanguage(inline.text).id;isRtl=this.documentHelper.textHelper.getRtlLanguage(inline.text).isRtl;isInlineContainsSpecChar=this.documentHelper.textHelper.containsSpecialCharAlone(inline.text);}if(isBidi||!this.documentHelper.owner.isSpellCheck){insertFormat.bidi=isBidi;}if((!this.documentHelper.owner.isSpellCheck||text!==' '&&inline.text!==' ')&&insertFormat.isSameFormat(inline.characterFormat)&&this.canInsertRevision(inline,revisionType)&&insertLangId===inlineLangId||text.trim()===''&&!isBidi&&inline.characterFormat.bidi||isRtl&&insertFormat.isSameFormat(inline.characterFormat)&&isSpecialChars){this.insertTextInline(inline,selection,text,indexInInline);}else{var isContainsRtl=this.documentHelper.layout.isContainsRtl(selection.start.currentWidget);var tempSpan=new TextElementBox();tempSpan.text=text;tempSpan.line=inline.line;tempSpan.isRightToLeft=isRtl;tempSpan.characterFormat.copyFormat(insertFormat);if(inline instanceof FootnoteElementBox){tempSpan.characterFormat.baselineAlignment='Normal';}var isRevisionCombined=false;var insertIndex=inline.indexInOwner;var prevRevisionCount=tempSpan.revisions.length;if(indexInInline===inline.length){var isParaBidi=inline.line.paragraph.bidi;if(isParaBidi&&inline instanceof FieldElementBox&&inline.fieldType===1){inline=inline.fieldBegin;insertIndex=inline.indexInOwner;}var index=-1;if(isParaBidi||inline instanceof EditRangeEndElementBox||isContainsRtl&&isInlineContainsSpecChar||isRtl&&isBidi){index=insertIndex;}else{index=insertIndex+1;}if(this.owner.enableTrackChanges&&!(inline instanceof BookmarkElementBox)){isRevisionCombined=this.checkToMapRevisionWithInlineText(inline,indexInInline,tempSpan,isBidi,revisionType);if(!isRevisionCombined&&tempSpan.revisions.length===prevRevisionCount){isRevisionCombined=this.checkToMapRevisionWithNextNode(inline.nextNode,tempSpan,isBidi,revisionType);}}if(!isRevisionCombined){inline.line.children.splice(index,0,tempSpan);this.checkToCombineRevisionsinBlocks(tempSpan,prevRevisionCount===tempSpan.revisions.length,true,revisionType);}}else if(indexInInline===0){if(this.owner.enableTrackChanges){isRevisionCombined=this.checkToMapRevisionWithInlineText(inline,indexInInline,tempSpan,isBidi,revisionType);if(!isRevisionCombined&&tempSpan.revisions.length===0){this.checkToMapRevisionWithPreviousNode(inline.previousNode,tempSpan,isBidi,revisionType);}}if(!isRevisionCombined){if(isRtl&&!isBidi){inline.line.children.splice(insertIndex+1,0,tempSpan);}else{inline.line.children.splice(insertIndex,0,tempSpan);}this.checkToCombineRevisionsinBlocks(tempSpan,prevRevisionCount===tempSpan.revisions.length,true,revisionType);}}else{if(inline instanceof TextElementBox){var splittedSpan=new TextElementBox();splittedSpan.line=inline.line;splittedSpan.characterFormat.copyFormat(inline.characterFormat);if(bidi&&isRtl&&!isBidi){splittedSpan.text=inline.text.slice(0,indexInInline);if(!this.owner.enableTrackChanges){this.updateRevisionForSpittedTextElement(inline,splittedSpan);}inline.text=inline.text.substring(indexInInline);}else{splittedSpan.text=inline.text.substring(indexInInline);if(!this.owner.enableTrackChanges&&!this.selection.isInField){this.updateRevisionForSpittedTextElement(inline,splittedSpan);}inline.text=inline.text.slice(0,indexInInline);}if(this.owner.enableTrackChanges){isRevisionCombined=this.checkToMapRevisionWithInlineText(inline,indexInInline,tempSpan,isBidi,revisionType);if(isRevisionCombined||tempSpan.revisions.length>prevRevisionCount){this.copyElementRevision(inline,splittedSpan,true);}else if(tempSpan.revisions.length===prevRevisionCount){this.updateRevisionForSpittedTextElement(inline,splittedSpan);this.insertRevision(tempSpan,revisionType);}}else if(this.selection.isInField){this.copyElementRevision(inline,splittedSpan,false);this.updateElementInFieldRevision(inline,tempSpan,inline.revisions,true);}if(this.owner.isSpellCheck){this.owner.spellChecker.updateSplittedElementError(inline,splittedSpan);}inline.line.children.splice(insertIndex+1,0,splittedSpan);}if(!isRevisionCombined){inline.line.children.splice(insertIndex+1,0,tempSpan);}}if(!bidi&&this.documentHelper.layout.isContainsRtl(selection.start.currentWidget)){this.documentHelper.layout.reArrangeElementsForRtl(selection.start.currentWidget,bidi);}//if (!isRevisionCombined) {
this.documentHelper.layout.reLayoutParagraph(insertPosition.paragraph,inline.line.indexInOwner,0);//}
}}this.setPositionParagraph(paragraphInfo.paragraph,paragraphInfo.offset+text.length,true);this.updateEndPosition();if(!sf.base.isNullOrUndefined(this.editorHistory)&&!sf.base.isNullOrUndefined(this.editorHistory.currentHistoryInfo)&&this.editorHistory.currentHistoryInfo.action==='ListSelect'&&this.documentHelper.isListTextSelected){this.editorHistory.updateHistory();this.editorHistory.updateComplexHistory();}if(sf.base.isNullOrUndefined(revisionType)||revisionType==='Insertion'){this.reLayout(selection);}this.documentHelper.isTextInput=false;}this.updateXmlMappedContentControl();if(!isReplace&&isRemoved&&(text===' '||text==='\t'||text==='\v')){var isList=false;if(!(text==='\v')){isList=this.checkAndConvertList(selection,text==='\t');}if(!isList){if(!sf.base.isNullOrUndefined(selection.getHyperlinkField())){return;}//Checks if the previous text is URL, then it is auto formatted to hyperlink.
this.checkAndConvertToHyperlink(selection,false);}}};Editor.prototype.updateElementInFieldRevision=function(revisionElement,elementToInclude,revisions,isEnd){for(var i=0;i<revisions.length;i++){var currentRevision=revisions[i];var rangeIndex=currentRevision.range.indexOf(revisionElement);currentRevision.range.splice(isEnd?rangeIndex+1:rangeIndex,0,elementToInclude);}};Editor.prototype.retrieveFieldResultantText=function(item){var resultantText='';if(item.fieldType===1){var textElement=item.previousElement;while(!sf.base.isNullOrUndefined(textElement)&&textElement instanceof TextElementBox){resultantText=textElement.text+resultantText;textElement=!sf.base.isNullOrUndefined(textElement.previousNode)?textElement.previousNode.previousValidNodeForTracking:undefined;}}return resultantText;};Editor.prototype.checkToCombineRevisionsinBlocks=function(tempSpan,checkWidget,isEnd,revisionType){if(!checkWidget||!this.owner.enableTrackChanges){return;}// if (tempSpan instanceof FieldElementBox && tempSpan.fieldType === 2) {
//     return;
// }
if(tempSpan instanceof BookmarkElementBox||tempSpan instanceof CommentCharacterElementBox||tempSpan instanceof EditRangeStartElementBox||tempSpan instanceof EditRangeEndElementBox){return;}var isCombined=false;if(isEnd){isCombined=this.combineRevisionWithNextPara(tempSpan,revisionType);}else{isCombined=this.combineRevisionWithPrevPara(tempSpan,revisionType);}if(!isCombined){this.insertRevision(tempSpan,revisionType);}};Editor.prototype.checkToMapRevisionWithNextNode=function(inline,tempSpan,isBidi,revisionType){if(sf.base.isNullOrUndefined(inline)){return false;}var nextElement=inline.nextValidNodeForTracking;if(!sf.base.isNullOrUndefined(nextElement)){return this.checkToMapRevisionWithInlineText(nextElement,0,tempSpan,isBidi,revisionType);}return false;};Editor.prototype.checkToMapRevisionWithPreviousNode=function(inline,tempSpan,isBidi,revisionType){if(sf.base.isNullOrUndefined(inline)){return false;}var prevElement=inline.previousValidNodeForTracking;if(!sf.base.isNullOrUndefined(prevElement)){return this.checkToMapRevisionWithInlineText(prevElement,prevElement.length,tempSpan,isBidi,revisionType);}return false;};Editor.prototype.checkToMapRevisionWithInlineText=function(inline,indexInInline,newElement,isBidi,revisionType){if(!sf.base.isNullOrUndefined(inline)){if(revisionType==='Deletion'){this.updateLastElementRevision(newElement);}if(inline.length===indexInInline){inline=inline.previousValidNodeForTracking;indexInInline=inline.length;if(inline.revisions.length>0){return this.applyMatchedRevisionInorder(inline,newElement,indexInInline,false,isBidi,revisionType);}}else if(indexInInline===0){inline=inline.nextValidNodeForTracking;if(!sf.base.isNullOrUndefined(inline)&&inline.revisions.length>0){return this.applyMatchedRevisionInorder(inline,newElement,indexInInline,true,isBidi,revisionType);}}}return false;};Editor.prototype.combineElementRevisions=function(inline,elementToCombine){if(inline.revisions.length===0||elementToCombine.revisions.length===0){return;}for(var i=0;i<inline.revisions.length;i++){var prevRevision=inline.revisions[i];for(var j=0;j<elementToCombine.revisions.length;j++){var currentRevision=elementToCombine.revisions[i];if(prevRevision.range.indexOf(elementToCombine)===-1&&currentRevision.revisionType===prevRevision.revisionType&&currentRevision.author===prevRevision.author){elementToCombine.revisions.splice(j,1);prevRevision.range.push(elementToCombine);elementToCombine.revisions.splice(j,0,prevRevision);}}}};Editor.prototype.applyMatchedRevisionInorder=function(inline,newElement,indexInInline,isBegin,isBidi,revisionType){var revisionsMatched=this.getMatchedRevisionsToCombine(inline.revisions,revisionType);// if (revisionsMatched.length === inline.revisions.length && this.documentHelper.isTextInput && inline instanceof TextElementBox && newElement instanceof TextElementBox && !isBidi && (<TextElementBox>inline).text !== ' ') {
//     this.insertTextInline(inline, this.selection, (newElement as TextElementBox).text, indexInInline, true);
//     this.updateLastElementRevision(inline);
//     return true;
// } else
if(revisionsMatched.length>0){this.mapMatchedRevisions(revisionsMatched,inline,newElement,isBegin);}//this.updateLastElementRevision(newElement);
return false;};Editor.prototype.copyElementRevision=function(elementToCopy,elementToInclude,isSplitElementMerged){if(!this.isTrackingFormField){for(var i=0;i<elementToCopy.revisions.length;i++){var currentRevision=elementToCopy.revisions[i];var rangeIndex=currentRevision.range.indexOf(elementToCopy);elementToInclude.revisions.splice(0,0,currentRevision);currentRevision.range.splice(rangeIndex+(isSplitElementMerged?2:1),0,elementToInclude);}}};/* eslint-disable @typescript-eslint/no-explicit-any */Editor.prototype.mapMatchedRevisions=function(revisions,revisionElement,elementToInclude,isBegin){for(var i=0;i<revisions.length;i++){var currentRevision=revisions[i];if(!this.isRevisionAlreadyIn(elementToInclude,currentRevision)||elementToInclude instanceof WCharacterFormat){elementToInclude.revisions.splice(0,0,currentRevision);var rangeIndex=currentRevision.range.indexOf(revisionElement);currentRevision.range.splice(isBegin?rangeIndex:rangeIndex+1,0,elementToInclude);}}};Editor.prototype.isRevisionAlreadyIn=function(element,revision){if(element.revisions.length>0){for(var i=0;i<element.revisions.length;i++){var elementRevision=element.revisions[i];if(elementRevision.revisionID===revision.revisionID){return true;}}}return false;};Editor.prototype.getMatchedRevisionsToCombine=function(revisions,revisionType){var matchedRevisions=[];for(var i=0;i<revisions.length;i++){if(this.isRevisionMatched(revisions[i],revisionType)){matchedRevisions.push(revisions[i]);}}return matchedRevisions;};Editor.prototype.decideInlineForTrackChanges=function(inline,revisionType){var matched=false;if(this.owner.enableTrackChanges&&!this.canInsertRevision(inline,revisionType)){var currentElement=inline.nextValidNodeForTracking;if(!sf.base.isNullOrUndefined(currentElement)&&this.canInsertRevision(currentElement,revisionType)){inline=currentElement;matched=true;}}return{'element':inline,'isMatched':matched};};/**
     * @private
     * @returns {void}
     */Editor.prototype.insertIMEText=function(text,isUpdate){if(this.documentHelper.lastComposedText===text&&isUpdate){return;}// Clone selection start position
var paragraphInfo=this.selection.getParagraphInfo(this.selection.start);var startPosition=this.selection.getHierarchicalIndex(paragraphInfo.paragraph,paragraphInfo.offset.toString());// Insert IME text in current selection
this.insertText(text);this.documentHelper.lastComposedText=text;// update selection start
var start=this.selection.start;this.setPositionForCurrentIndex(start,startPosition);// Update selection end
var endPosition=new TextPosition(this.owner);endPosition.setPositionForLineWidget(start.currentWidget,start.offset+text.length);this.selection.selectPosition(isUpdate?start:endPosition,endPosition);};/**
     * Insert Section break at cursor position
     *
     * @returns {void}
     */Editor.prototype.insertSectionBreak=function(){var selection=this.documentHelper.selection;if(sf.base.isNullOrUndefined(selection)||this.owner.isReadOnlyMode||selection.start.paragraph.isInHeaderFooter){return;}this.initHistory('SectionBreak');if(!selection.isEmpty){selection.selectContent(selection.isForward?selection.start:selection.end,true);}this.documentHelper.owner.isShiftingEnabled=true;this.updateInsertPosition();this.insertSection(selection,true);this.updateEndPosition();this.reLayout(selection,true);if(this.owner.layoutType==='Continuous'){this.layoutWholeDocument();}};Editor.prototype.combineRevisionWithBlocks=function(elementBox,revisionType){if(!this.owner.enableTrackChanges||sf.base.isNullOrUndefined(elementBox)){return;}while(elementBox instanceof BookmarkElementBox||elementBox instanceof CommentCharacterElementBox){elementBox=elementBox.nextElement;}if(sf.base.isNullOrUndefined(elementBox)){return;}var prevPara=elementBox.paragraph.previousRenderedWidget;if(prevPara instanceof TableWidget){return;}if(!sf.base.isNullOrUndefined(prevPara)&&!prevPara.isEmpty()&&prevPara.characterFormat.revisions.length>0){var lastLine_1=prevPara.lastChild;if(sf.base.isNullOrUndefined(lastLine_1)||lastLine_1.children.length===0){return;}var lastElement_1=lastLine_1.children[lastLine_1.children.length-1];while(lastElement_1 instanceof BookmarkElementBox||lastElement_1 instanceof CommentCharacterElementBox){lastElement_1=lastElement_1.previousElement;}if(lastElement_1.revisions.length>0){if(this.compareElementRevision(prevPara.characterFormat,elementBox)){var currentRevision=elementBox.revisions[elementBox.revisions.length-1];if(this.compareElementRevision(lastElement_1,elementBox)){var lastElementRevision=lastElement_1.revisions[lastElement_1.revisions.length-1];if(currentRevision!==lastElementRevision){this.clearAndUpdateRevisons(currentRevision.range,lastElementRevision,lastElementRevision.range.indexOf(lastElement_1)+1);}}}}}prevPara=null;var lastLine=elementBox.paragraph.lastChild;var lastElement=lastLine.children[lastLine.children.length-1];elementBox=lastElement;var nextPara=elementBox.paragraph.nextRenderedWidget;if(nextPara instanceof TableWidget){return;}if(!sf.base.isNullOrUndefined(nextPara)&&!nextPara.isEmpty()&&elementBox.paragraph.characterFormat.revisions.length>0){// let lastLine: LineWidget = elementBox.paragraph.lastChild as LineWidget;
// let lastElement: ElementBox = lastLine.children[lastLine.children.length - 1];
var firstLine=nextPara.firstChild;var firstElement=firstLine.children[0];while(firstElement instanceof BookmarkElementBox||firstElement instanceof CommentCharacterElementBox){firstElement=firstElement.previousElement;}if(sf.base.isNullOrUndefined(firstElement)){return;}if(firstElement.revisions.length>0){var firstEleRevision=firstElement.revisions[firstElement.revisions.length-1];if(this.compareElementRevision(elementBox.paragraph.characterFormat,firstElement)){if(this.compareElementRevision(elementBox,firstElement)){var lastElementRevision=elementBox.revisions[elementBox.revisions.length-1];if(firstEleRevision!==lastElementRevision){this.clearAndUpdateRevisons(firstEleRevision.range,lastElementRevision,lastElementRevision.range.indexOf(elementBox)+1);}}}}}if(elementBox.revisions.length===0){this.insertRevision(elementBox,revisionType);}};Editor.prototype.checkToCombineRevisionWithNextPara=function(elementBox,revisionType){var nextPara=elementBox.paragraph.nextRenderedWidget;if(nextPara instanceof TableWidget){return false;}if(!sf.base.isNullOrUndefined(nextPara)&&!nextPara.isEmpty()){var firstLine=nextPara.firstChild;var firstElement=firstLine.children[0];while(firstElement instanceof BookmarkElementBox||firstElement instanceof CommentCharacterElementBox){firstElement=firstElement.previousElement;}if(sf.base.isNullOrUndefined(firstElement)){return false;}if(firstElement.revisions.length>0){var mappedRevisions=this.getMatchedRevisionsToCombine(firstElement.revisions,revisionType);if(mappedRevisions.length>0){this.mapMatchedRevisions(mappedRevisions,firstElement,elementBox,true);return true;}}}return false;};Editor.prototype.checkToCombineRevisionWithPrevPara=function(elementBox,revisionType){var prevPara=elementBox.paragraph.previousRenderedWidget;if(prevPara instanceof TableWidget){return false;}if(!sf.base.isNullOrUndefined(prevPara)&&prevPara.characterFormat.revisions.length>0){if(!this.isRevisionMatched(prevPara.characterFormat,revisionType)){return false;}// let firstLine: LineWidget = prevPara.firstChild as LineWidget;
// let lastLine: LineWidget = prevPara.lastChild as LineWidget;
// if (isNullOrUndefined(lastLine) || lastLine.children.length === 0) {
//     return false;
// }
// let lastElement: ElementBox = lastLine.children[lastLine.children.length - 1];
// if (lastElement instanceof BookmarkElementBox || lastElement instanceof CommentCharacterElementBox) {
//     lastElement = lastElement.previousValidNodeForTracking;
// }
// if (isNullOrUndefined(lastElement)) {
//     return false;
// }
// if (lastElement.revisions.length > 0) {
var mappedRevisions=this.getMatchedRevisionsToCombine(prevPara.characterFormat.revisions,revisionType);if(mappedRevisions.length>0){this.mapMatchedRevisions(mappedRevisions,prevPara.characterFormat,elementBox,false);return true;}// }
}return false;};Editor.prototype.combineRevisionWithNextPara=function(elementBox,revisionType){var isLastLine=elementBox.line.isLastLine();var nextElement=elementBox.nextNode;if(isLastLine&&sf.base.isNullOrUndefined(nextElement)){return this.checkToCombineRevisionWithNextPara(elementBox,revisionType);}return false;};Editor.prototype.combineRevisionWithPrevPara=function(elementBox,revisionType){var isFirstLine=elementBox.line.isFirstLine();var prevElement=elementBox.previousNode;if(isFirstLine&&sf.base.isNullOrUndefined(prevElement)){return this.checkToCombineRevisionWithPrevPara(elementBox,revisionType);}return false;};Editor.prototype.removeRevision=function(revisionToRemove){var elementInfo=this.selection.start.currentWidget.getInline(this.selection.start.offset+1,0);var elementBox=elementInfo.element;if(elementInfo.element.revisions.length>0){for(var i=0;i<elementBox.revisions.length;i++){if(elementBox.revisions[i].revisionType===revisionToRemove.revisionType){var revision=elementBox.revisions[i];var startIndex=revision.range.indexOf(elementBox);for(var j=startIndex;startIndex<revision.range.length;startIndex++){revision.range[j].revisions.splice(i,1);revision.range.splice(j,1);}}}}};Editor.prototype.clearElementRevision=function(revision){if(sf.base.isNullOrUndefined(revision)){return;}for(var i=0;i<revision.range.length;i++){if(revision.range[i]instanceof ElementBox){var currentElement=revision.range[i];currentElement.revisions.splice(currentElement.revisions.length-1,1);revision.range.splice(i,1);}}};/**
     * @private
     * @returns {void}
     */ /* eslint-disable @typescript-eslint/no-explicit-any */Editor.prototype.insertRevision=function(item,type,author,date,spittedRange){author=!sf.base.isNullOrUndefined(author)?author:this.owner.currentUser?this.owner.currentUser:'Guest user';var currentDate=!sf.base.isNullOrUndefined(date)?date:new Date().toISOString();if(item instanceof ElementBox&&!sf.base.isNullOrUndefined(item.line)&&item.line.paragraph.associatedCell||item instanceof WCharacterFormat&&item.ownerBase instanceof ParagraphWidget&&item.ownerBase.associatedCell){var cellWidget=undefined;if(item instanceof ElementBox){cellWidget=item.line.paragraph.associatedCell;}else if(item instanceof WCharacterFormat){cellWidget=item.ownerBase.associatedCell;}if(cellWidget.ownerRow.rowFormat.revisions.length>0){var rowFormat=cellWidget.ownerRow.rowFormat;var matchedRevisions=this.getMatchedRevisionsToCombine(rowFormat.revisions,type);if(matchedRevisions.length>0){for(var i=0;i<matchedRevisions.length;i++){item.revisions.splice(0,0,matchedRevisions[i]);matchedRevisions[i].range.push(item);}return;}}}var revision=new Revision(this.owner,author,currentDate);revision.revisionType=type;revision.revisionID=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);if(!sf.base.isNullOrUndefined(spittedRange)&&spittedRange.length>0){this.clearAndUpdateRevisons(spittedRange,revision,spittedRange.indexOf(item));}else{item.revisions.push(revision);revision.range.push(item);}this.updateRevisionCollection(revision);};/**
     * Method help to clear previous revisions and include new revision at specified index
     *
     * @param range - range of elements to be cleared
     * @param revision - revision to be inserted
     * @param index - index at which to be included in the revision range
     * @returns {void}
     */Editor.prototype.clearAndUpdateRevisons=function(range,revision,index){for(var i=0;i<range.length;i++){if(range[i]instanceof ElementBox){var currentElement=range[i];currentElement.revisions.splice(currentElement.revisions.length-1,1);currentElement.revisions.push(revision);revision.range.splice(index+i,0,currentElement);}}};Editor.prototype.splitRevisionByElement=function(item,revision){if(item.revisions.length>0){var range=revision.range;var index=range.indexOf(item);revision.range=range.splice(0,index+1);return range;}return undefined;};/**
     * Method to update revision for the splitted text element
     * @param inline - Original text element
     * @param splittedSpan - Splitted element
     */Editor.prototype.updateRevisionForSpittedTextElement=function(inline,splittedSpan){for(var i=0;i<inline.revisions.length;i++){var revision=inline.revisions[i];/* eslint-disable @typescript-eslint/no-explicit-any */var splittedRange=this.splitRevisionByElement(inline,revision);this.insertRevision(splittedSpan,revision.revisionType,revision.author,revision.date,splittedRange);}};Editor.prototype.isRevisionMatched=function(item,type){var author=this.owner.currentUser?this.owner.currentUser:'Guest user';if(item instanceof Revision){if((sf.base.isNullOrUndefined(type)||type===item.revisionType)&&item.author===author){return true;}}else if(item.revisions.length>0){for(var i=0;i<item.revisions.length;i++){var elementRevision=item.revisions[i];if((sf.base.isNullOrUndefined(type)||type===elementRevision.revisionType)&&elementRevision.author===author){return true;}}}return false;};Editor.prototype.compareElementRevision=function(element,compare){if(element.revisions.length===0||compare.revisions.length===0){return false;}for(var i=0;i<element.revisions.length;i++){var currentRevision=element.revisions[i];for(var j=0;j<compare.revisions.length;j++){if(currentRevision.author===compare.revisions[i].author&&currentRevision.revisionType===compare.revisions[i].revisionType){return true;}}}return false;};/* eslint-disable @typescript-eslint/no-explicit-any */Editor.prototype.canInsertRevision=function(item,type){var revisionType=sf.base.isNullOrUndefined(type)?'Insertion':type;if(revisionType==='Deletion'){return false;}if(this.owner.enableTrackChanges){return this.isRevisionMatched(item,revisionType);//if it has revision
}else if(item.revisions.length>0){return false;}return true;};Editor.prototype.insertRevisionAtEnd=function(item,newElement,revisionType){if(newElement instanceof BookmarkElementBox||newElement instanceof CommentCharacterElementBox||newElement instanceof EditRangeStartElementBox||newElement instanceof EditRangeEndElementBox){return false;}item=item.previousValidNodeForTracking;if(sf.base.isNullOrUndefined(item)){return false;}return this.insertRevisionAtPosition(item,newElement,true,revisionType);};Editor.prototype.insertRevisionAtPosition=function(item,newElement,isEnd,revisionType){// if (newElement instanceof FieldElementBox && (newElement as FieldElementBox).fieldType === 2) {
//     return false;
// }
var prevRevisionLength=newElement.revisions.length;var isRevisionCombined=this.checkToMapRevisionWithInlineText(item,isEnd?item.length:0,newElement,false,revisionType);// Check to combine with previous and next element
if(isEnd){if(!isRevisionCombined&&newElement.revisions.length===prevRevisionLength){isRevisionCombined=this.checkToMapRevisionWithNextNode(item.nextNode,newElement,false,revisionType);}}else{if(!isRevisionCombined&&newElement.revisions.length===prevRevisionLength){isRevisionCombined=this.checkToMapRevisionWithPreviousNode(item.previousNode,newElement,false,revisionType);}}return isRevisionCombined;};Editor.prototype.insertRevisionAtBegining=function(item,newElement,revisionType){if(newElement instanceof BookmarkElementBox||newElement instanceof CommentCharacterElementBox||newElement instanceof EditRangeStartElementBox||newElement instanceof EditRangeEndElementBox){return false;}item=item.nextValidNodeForTracking;if(sf.base.isNullOrUndefined(item)){return false;}return this.insertRevisionAtPosition(item,newElement,false,revisionType);};Editor.prototype.splitRevisionForSpittedElement=function(element,spittedElement){for(var i=element.revisions.length-1;i>=0;i--){var revision=element.revisions[i];var splittedRange=this.splitRevisionByElement(element,revision);this.insertRevision(spittedElement,revision.revisionType,revision.author,revision.date,splittedRange);}};/**
     * Method to combine element revision if not inserts new revision
     */ // private checkToCombineRevision(element: ElementBox, newElement: ElementBox, revisionType: RevisionType): boolean {
//     let isCombined: boolean = false;
//     if (this.isRevisionMatched(element, revisionType)) {
//         isCombined = true;
//         this.combineElementRevision(element, newElement, true);
//     } else {
//         this.insertRevision(newElement, revisionType);
//     }
//     return isCombined;
// }
Editor.prototype.combineElementRevision=function(currentElementRevisions,elementToCombine){for(var i=0;i<currentElementRevisions.length;i++){for(var j=0;j<elementToCombine.length;j++){var currentRevision=currentElementRevisions[i];var revisionToCombine=elementToCombine[i];if(currentRevision.author===revisionToCombine.author&&currentRevision.revisionType===revisionToCombine.revisionType){var rangeLength=revisionToCombine.range.length;for(var k=0;k<rangeLength;k++){var item=revisionToCombine.range[0];item.revisions.splice(item.revisions.indexOf(revisionToCombine),1);revisionToCombine.range.splice(0,1);currentRevision.range.push(item);item.revisions.push(currentRevision);}if(revisionToCombine.range.length===0){this.owner.revisions.remove(revisionToCombine);}}}}};Editor.prototype.combineRevisions=function(block,startPosition,endposition){if(!this.owner.enableTrackChanges){return;}var info=this.selection.getLineInfo(block,startPosition.offset);var elementInfo=info.line.getInline(startPosition.offset,0);var currentElement=elementInfo.element;if(currentElement.revisions.length>0){if(this.isRevisionMatched(currentElement,'Insertion')){var nextElement=currentElement.nextElement;if(!sf.base.isNullOrUndefined(nextElement)&&nextElement.revisions.length>0){var revision=currentElement.revisions[currentElement.revisions.length-1];var range=nextElement.revisions[nextElement.revisions.length-1].range;this.clearAndUpdateRevisons(range,revision,revision.range.indexOf(currentElement)+1);}}}// let startOffset: number = startPosition.currentWidget.getOffset(firstElement, 0);
// let endOffset: number = endposition.currentWidget.getOffset(lastElement, 0);
};/**
     * Method to update the revision for whole block
     *
     * @private
     * @returns {void}
     */Editor.prototype.insertRevisionForBlock=function(widget,revisionType,isTOC,revision){if(widget.childWidgets.length===0||!this.owner.enableTrackChanges){return;}if(revisionType==='Deletion'){var editPostion=this.selection.editPosition;var start=this.selection.start.clone();var end=this.selection.end.clone();for(var i=0;i<widget.childWidgets.length;i++){var line=widget.childWidgets[i];this.removeContent(line,0,this.documentHelper.selection.getLineLength(line));}this.selection.editPosition=editPostion;this.selection.start.setPositionInternal(start);this.selection.end.setPositionInternal(end);// let textPosition: TextPosition = this.selection.getTextPosBasedOnLogicalIndex(editPostion);
// this.selection.selectContent(textPosition, true);
this.removeEmptyLine(widget);}else{var skipParaMark=false;if(sf.base.isNullOrUndefined(revision)){var author=this.owner.currentUser?this.owner.currentUser:'Guest user';var currentDate=new Date().toISOString();revision=new Revision(this.owner,author,currentDate);revision.revisionID=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);revision.revisionType=revisionType;}for(var i=0;i<widget.childWidgets.length;i++){var elemets=widget.childWidgets[i].children;if(elemets.length===0){var paraIndex=widget.containerWidget.childWidgets.indexOf(widget);var prevWidget=undefined;if(paraIndex>0){prevWidget=widget.containerWidget.childWidgets[paraIndex-1];}if(!sf.base.isNullOrUndefined(prevWidget)&&prevWidget instanceof ParagraphWidget&&prevWidget.characterFormat.revisions.length>0){if(this.isRevisionMatched(prevWidget.characterFormat,revisionType)){var mappedRevisions=this.getMatchedRevisionsToCombine(prevWidget.characterFormat.revisions,revisionType);if(mappedRevisions.length>0){this.mapMatchedRevisions(mappedRevisions,prevWidget.characterFormat,widget.characterFormat,false);skipParaMark=true;revision=undefined;}}}}for(var j=0;j<elemets.length;j++){if(j===0&&!isTOC){var prevRevisionCount=elemets[i].revisions.length;this.checkToCombineRevisionsinBlocks(elemets[i],true,false,'Insertion');if(elemets[i].revisions.length>prevRevisionCount){revision=elemets[i].revisions[elemets[i].revisions.length-1];}else{elemets[j].revisions.push(revision);revision.range.push(elemets[j]);}}else{elemets[j].revisions.push(revision);revision.range.push(elemets[j]);}}}if(!isTOC&&!skipParaMark){widget.characterFormat.revisions.push(revision);revision.range.push(widget.characterFormat);}if(!sf.base.isNullOrUndefined(revision)){this.updateRevisionCollection(revision);}}};Editor.prototype.updateRevisionCollection=function(revision){var isInserted=false;var paraIndex=undefined;if(this.owner.revisions.changes.indexOf(revision)<0){if(!this.documentHelper.revisionsInternal.containsKey(revision.revisionID)){this.documentHelper.revisionsInternal.add(revision.revisionID,revision);}if(this.owner.revisions.changes.length>0){var currentStart=this.owner.selection.start;for(var i=0;i<this.owner.revisions.changes.length;i++){var currentRange=this.owner.revisions.changes[i].range[0];if(currentRange instanceof ElementBox&&!sf.base.isNullOrUndefined(currentRange.line)&&currentRange.line.paragraph.bodyWidget){paraIndex=this.selection.getElementPosition(this.owner.revisions.changes[i].range[0]).startPosition;}else if(currentRange instanceof WRowFormat){var rowWidget=currentRange.ownerBase;var firstCell=rowWidget.childWidgets[0];var firstPara=this.selection.getFirstParagraph(firstCell);if(firstPara.bodyWidget){var selection=this.documentHelper.selection;this.updateEditPosition(firstCell,selection);paraIndex=this.selection.getTextPosBasedOnLogicalIndex(selection.editPosition);}}else if(currentRange instanceof WCharacterFormat){var paraWidget=currentRange.ownerBase;if(paraWidget.lastChild&&paraWidget.lastChild.paragraph.bodyWidget){var offset=paraWidget.getLength();var startPosition=new TextPosition(this.owner);startPosition.setPositionParagraph(paraWidget.lastChild,offset);paraIndex=startPosition;}}if(!sf.base.isNullOrUndefined(paraIndex)&&!sf.base.isNullOrUndefined(currentStart)){if(currentStart.isExistBefore(paraIndex)){isInserted=true;this.owner.revisions.changes.splice(i,0,revision);break;}}}}if(!isInserted){this.owner.revisions.changes.push(revision);}this.documentHelper.updateAuthorIdentity();}};/**
     * @private
     * @returns {BodyWidget}
     */Editor.prototype.insertSection=function(selection,selectFirstBlock){var newSectionFormat=this.selection.start.paragraph.bodyWidget.sectionFormat.cloneFormat();var lastBlock;var firstBlock;if(selection.start.paragraph.isInsideTable){var table=this.documentHelper.layout.getParentTable(selection.start.paragraph);table=table.combineWidget(this.owner.viewer);var insertBefore=false;if(selection.start.paragraph.associatedCell.rowIndex===0){insertBefore=true;}var newParagraph=new ParagraphWidget();var previousBlock=table.previousRenderedWidget;if(!insertBefore){lastBlock=this.splitTable(table,selection.start.paragraph.associatedCell.ownerRow);this.documentHelper.layout.layoutBodyWidgetCollection(lastBlock.index,lastBlock.containerWidget,lastBlock,false);lastBlock=lastBlock.getSplitWidgets().pop();}else{lastBlock=table;}var insertIndex=0;if((sf.base.isNullOrUndefined(previousBlock)||!previousBlock.bodyWidget.equals(lastBlock.bodyWidget))&&insertBefore){insertIndex=0;newParagraph.index=0;}else{insertIndex=lastBlock.indexInOwner+1;newParagraph.index=lastBlock.index+1;}lastBlock.containerWidget.childWidgets.splice(insertIndex,0,newParagraph);newParagraph.containerWidget=lastBlock.containerWidget;this.updateNextBlocksIndex(newParagraph,true);this.documentHelper.layout.layoutBodyWidgetCollection(newParagraph.index,newParagraph.containerWidget,newParagraph,false);lastBlock=newParagraph;}else{var paragraphInfo=this.selection.getParagraphInfo(selection.start);var selectionStart=this.selection.getHierarchicalIndex(paragraphInfo.paragraph,paragraphInfo.offset.toString());//Split Paragraph
this.splitParagraphInternal(selection,selection.start.paragraph,selection.start.currentWidget,selection.start.offset);this.setPositionForCurrentIndex(selection.start,selectionStart);lastBlock=selection.start.paragraph.getSplitWidgets().pop();}//Split body widget
firstBlock=this.splitBodyWidget(lastBlock.bodyWidget,newSectionFormat,lastBlock).firstChild;if(firstBlock instanceof TableWidget){firstBlock.updateRowIndex(0);}this.documentHelper.layout.layoutBodyWidgetCollection(firstBlock.index,firstBlock.containerWidget,firstBlock,false);if(firstBlock instanceof TableWidget){firstBlock=selection.getFirstParagraphInFirstCell(firstBlock);}if(selectFirstBlock){selection.selectParagraphInternal(firstBlock,true);}return firstBlock;};/**
     * @private
     */Editor.prototype.splitBodyWidget=function(bodyWidget,sectionFormat,startBlock){//let sectionIndex: number;
//Move blocks after the start block to next body widget
var newBodyWidget=this.documentHelper.layout.moveBlocksToNextPage(startBlock);//Update SectionIndex for splitted body widget
this.updateSectionIndex(sectionFormat,newBodyWidget,true);// insert New header footer widget in to section index 
this.insertRemoveHeaderFooter(newBodyWidget.sectionIndex,true);if(this.documentHelper.viewer instanceof PageLayoutViewer){//update header and footer for splitted widget
this.documentHelper.layout.layoutHeaderFooter(newBodyWidget,this.owner.viewer,newBodyWidget.page);}//Update Child item index from 0 for new Section
this.updateBlockIndex(0,newBodyWidget.firstChild);// Start sinfting from first block
this.owner.viewer.updateClientArea(newBodyWidget.sectionFormat,newBodyWidget.page);return newBodyWidget;};Editor.prototype.insertRemoveHeaderFooter=function(sectionIndex,insert){if(this.documentHelper.headersFooters[sectionIndex]){// Need to handle further
this.documentHelper.headersFooters.splice(sectionIndex,0,{});}else{this.documentHelper.headersFooters[sectionIndex]={};}};Editor.prototype.updateBlockIndex=function(blockIndex,block){var blocks;var sectionIndex=block.bodyWidget.sectionIndex;do{blocks=block.getSplitWidgets();for(var i=0;i<blocks.length;i++){blocks[i].index=blockIndex;}blockIndex++;block=blocks.pop().nextRenderedWidget;}while(!sf.base.isNullOrUndefined(block)&&block.bodyWidget.sectionIndex===sectionIndex);};/**
     * @private
     * @returns {void}
     */Editor.prototype.updateSectionIndex=function(sectionFormat,startBodyWidget,increaseIndex){var currentSectionIndex=startBodyWidget.sectionIndex;var bodyWidget=startBodyWidget;do{if(bodyWidget.index===currentSectionIndex&&sectionFormat){bodyWidget.sectionFormat=sectionFormat;}if(increaseIndex){bodyWidget.index++;}else{bodyWidget.index--;}bodyWidget=bodyWidget.nextRenderedWidget;}while(bodyWidget);};//Auto convert List
Editor.prototype.checkAndConvertList=function(selection,isTab){var list=selection.paragraphFormat.getList();if(!sf.base.isNullOrUndefined(list)||selection.start.paragraph.containerWidget instanceof FootNoteWidget){return false;}var convertList=false;var isLeadingZero=false;var indexInInline=0;var inlineObj=selection.start.currentWidget.getInline(selection.start.offset-1,indexInInline);var inline=inlineObj.element;indexInInline=inlineObj.index;if(!(inline instanceof TextElementBox)){return false;}var span=inline;var text=span.text.substring(0,indexInInline);var tabValue=0;var length=0;while(!sf.base.isNullOrUndefined(span.previousNode)){if(span.previousNode instanceof TextElementBox&&(span.previousNode.text==='\t'||span.previousNode.text.trim().length===0)){span.previousNode.text==='\t'?tabValue+=36:length=span.previousNode.text.length*2.5;span=span.previousNode;continue;}return false;}span=inline;var index=0;var tabIndex=text.lastIndexOf('\t');index=tabIndex>=0?tabIndex+1:text.lastIndexOf(' ')+1;while(span.previousNode instanceof TextElementBox&&index===0){span=span.previousNode;var previousText=span.text;tabIndex=previousText.lastIndexOf('\t');index=tabIndex>=0?tabIndex+1:previousText.lastIndexOf(' ')+1;text=span.text+text;text=text.substring(index);}text=HelperMethods.trimStart(text);var numberFormat=text.substring(1,2);var previousList=undefined;var listLevelPattern=this.getListLevelPattern(text.substring(0,1));if(listLevelPattern!=='None'&&this.checkNumberFormat(numberFormat,listLevelPattern==='Bullet',text)){convertList=true;}else if(this.checkLeadingZero(text)){isLeadingZero=true;convertList=true;}else{previousList=this.checkNextLevelAutoList(text);if(!sf.base.isNullOrUndefined(previousList)){convertList=true;}}if(convertList){this.initComplexHistory('AutoList');var paragraph=inline.paragraph;selection.start.setPositionParagraph(paragraph.childWidgets[0],paragraph.childWidgets[0].getOffset(inline,indexInInline+1));selection.end.setPositionParagraph(paragraph.childWidgets[0],0);this.initHistory('Delete');this.deleteSelectedContents(selection,false);this.reLayout(selection,false);var followCharacter=isTab?'Tab':'Space';numberFormat=!isLeadingZero?'%1'+numberFormat:'%1'+text.substring(text.length-1,text.length);var leadingZeroText=text.substring(text.length-3,text.length-1);listLevelPattern=!isLeadingZero?listLevelPattern:this.getListLevelPattern(leadingZeroText);var listLevel=new WListLevel(undefined);listLevel.listLevelPattern=listLevelPattern;if(listLevelPattern==='Bullet'){if(text==='*'){listLevel.numberFormat="\uF0B7";listLevel.characterFormat.fontFamily='Symbol';}else if(text==='-'){listLevel.numberFormat='-';}}else{listLevel.numberFormat=numberFormat;}listLevel.followCharacter=followCharacter;var leftIndent=selection.paragraphFormat.leftIndent;if(tabValue!==0||length!==0){listLevel.paragraphFormat.leftIndent=leftIndent+18+tabValue+length;}else if(indexInInline>2){listLevel.paragraphFormat.leftIndent=leftIndent+(indexInInline-2)*2.5+18;}else if(leftIndent>0){listLevel.paragraphFormat.leftIndent=leftIndent+18;}else{listLevel.paragraphFormat.leftIndent=36;}listLevel.paragraphFormat.firstLineIndent=-18;if(!isLeadingZero&&text.substring(0,1)==='0'||leadingZeroText==='00'){listLevel.startAt=0;}else{listLevel.startAt=1;}if(!sf.base.isNullOrUndefined(previousList)){selection.paragraphFormat.setList(previousList);}else{this.autoConvertList(selection,listLevel);}if(this.editorHistory&&!sf.base.isNullOrUndefined(this.editorHistory.currentHistoryInfo)){this.editorHistory.updateComplexHistory();}else{this.reLayout(selection);}}return convertList;};Editor.prototype.checkNextLevelAutoList=function(text){var selection=this.documentHelper.selection;var previousList=undefined;var convertList=false;var currentParagraph=selection.start.paragraph;var prevParagraph=selection.getPreviousParagraphBlock(currentParagraph);var isList=false;while(!sf.base.isNullOrUndefined(prevParagraph)&&prevParagraph instanceof ParagraphWidget){if(prevParagraph.paragraphFormat.listFormat&&prevParagraph.paragraphFormat.listFormat.listId!==-1){isList=true;break;}prevParagraph=selection.getPreviousParagraphBlock(prevParagraph);}if(isList){var listNumber=this.documentHelper.layout.getListNumber(prevParagraph.paragraphFormat.listFormat,true);var prevListText=listNumber.substring(0,listNumber.length-1);var currentListText=text.substring(0,text.length-1);//check if numberFormat equal
var inputString=void 0;if(listNumber.substring(listNumber.length-1)!==text.substring(text.length-1)){convertList=false;}else if(currentListText.match(/^[0-9]+$/)&&prevListText.match(/^[0-9]+$/)){inputString=parseInt(currentListText,10);if(parseInt(prevListText,10)===inputString||parseInt(prevListText,10)+1===inputString||parseInt(prevListText,10)+2===inputString){convertList=true;}}else if(currentListText.match(/^[a-zA-Z]+$/)&&prevListText.match(/^[a-zA-Z]+$/)){if(prevListText.charCodeAt(0)===text.charCodeAt(0)||prevListText.charCodeAt(0)+1===text.charCodeAt(0)||prevListText.charCodeAt(0)+2===text.charCodeAt(0)){convertList=true;}else if(currentListText.match(/^[MDCLXVImdclxvi]+$/)&&prevListText.match(/^[MDCLXVImdclxvi]+$/)){var prevListNumber=this.getNumber(prevListText.toUpperCase());var currentListNumber=this.getNumber(currentListText.toUpperCase());if(prevListNumber===currentListNumber||prevListNumber+1===currentListNumber||prevListNumber+2===currentListNumber){convertList=true;}}}if(convertList){previousList=this.documentHelper.getListById(prevParagraph.paragraphFormat.listFormat.listId);}}return previousList;};Editor.prototype.getNumber=function(roman){var conversion={'M':1000,'D':500,'C':100,'L':50,'X':10,'V':5,'I':1};var arr=roman.split('');var num=0;for(var i=0;i<arr.length;i++){var currentValue=conversion[arr[i]];var nextValue=conversion[arr[i+1]];if(currentValue<nextValue){num-=currentValue;}else{num+=currentValue;}}return num;};Editor.prototype.getListLevelPattern=function(value){switch(value){case'0':case'1':return'Arabic';case'I':return'UpRoman';case'i':return'LowRoman';case'A':return'UpLetter';case'a':return'LowLetter';case'*':case'-':return'Bullet';case'00':case'01':return'LeadingZero';default:return'None';}};Editor.prototype.autoConvertList=function(selection,listLevel){var start=selection.start;if(!selection.isForward){start=selection.end;}var newList=new WList();if(this.documentHelper.lists.length>0){newList.listId=this.documentHelper.lists[this.documentHelper.lists.length-1].listId+1;}else{newList.listId=0;}var newAbstractList=new WAbstractList();var layout=this.documentHelper;if(layout.abstractLists.length>0){newAbstractList.abstractListId=layout.abstractLists[layout.abstractLists.length-1].abstractListId+1;}else{newAbstractList.abstractListId=0;}newList.abstractListId=newAbstractList.abstractListId;newList.abstractList=newAbstractList;layout.abstractLists.push(newAbstractList);newAbstractList.levels.push(listLevel);listLevel.ownerBase=newAbstractList;selection.paragraphFormat.setList(newList);selection.paragraphFormat.listLevelNumber=0;};Editor.prototype.checkNumberFormat=function(numberFormat,isBullet,text){if(isBullet){return numberFormat==='';}else{var index=text.indexOf(numberFormat);return(numberFormat==='.'||numberFormat===')'||numberFormat==='>'||numberFormat==='-')&&text.substring(index,text.length-1)==='';}};Editor.prototype.checkLeadingZero=function(text){var j;var isZero=false;for(var i=0;i<=text.length-1;i++){if(text.charAt(i)==='0'){isZero=true;continue;}j=i;break;}var numberFormat=undefined;if(text.charAt(j)==='1'){numberFormat=text.charAt(j+1);}else{numberFormat=text.charAt(j);}return isZero&&this.checkNumberFormat(numberFormat,false,text);};Editor.prototype.getPageFromBlockWidget=function(block){var page=undefined;if(block.containerWidget instanceof BodyWidget){page=block.containerWidget.page;}else if(block.containerWidget instanceof HeaderFooterWidget){page=block.containerWidget.page;}else if(block.containerWidget instanceof TableCellWidget){page=block.containerWidget.bodyWidget.page;}return page;};/**
     * @private
     * @returns {void}
     */Editor.prototype.insertTextInline=function(element,selection,text,index,skipReLayout){if(element instanceof TextElementBox){element.text=HelperMethods.insert(element.text,index,text);var paragraph=element.line.paragraph;var lineIndex=paragraph.childWidgets.indexOf(element.line);var elementIndex=element.line.children.indexOf(element);if(element.line.paragraph.bidi||this.documentHelper.layout.isContainsRtl(element.line)){this.documentHelper.layout.reArrangeElementsForRtl(element.line,element.line.paragraph.bidi);}if(sf.base.isNullOrUndefined(skipReLayout)||!skipReLayout){this.documentHelper.layout.reLayoutParagraph(paragraph,lineIndex,elementIndex,element.line.paragraph.bidi);}}else if(element instanceof ImageElementBox){this.insertImageText(element,selection,text,index);}else if(element instanceof FieldElementBox){if(element.fieldType===0){this.insertFieldBeginText(element,selection,text,index);}else if(element.fieldType===2){this.insertFieldSeparatorText(element,selection,text,index);}else{this.insertFieldEndText(element,selection,text,index);}}else if(element instanceof BookmarkElementBox||element instanceof EditRangeStartElementBox||element instanceof EditRangeEndElementBox){this.insertBookMarkText(element,text);}};Editor.prototype.insertFieldBeginText=function(fieldBegin,selection,text,index){var spanObj=new TextElementBox();spanObj.text=text;var lineIndex=fieldBegin.line.paragraph.childWidgets.indexOf(fieldBegin.line);var spanIndex=fieldBegin.line.children.indexOf(fieldBegin);spanObj.characterFormat.copyFormat(fieldBegin.characterFormat);fieldBegin.line.children.splice(spanIndex,0,spanObj);spanObj.line=fieldBegin.line;this.documentHelper.layout.reLayoutParagraph(fieldBegin.line.paragraph,lineIndex,spanIndex);};Editor.prototype.insertBookMarkText=function(element,text){var spanObj=new TextElementBox();spanObj.text=text;var lineIndex=element.line.paragraph.childWidgets.indexOf(element.line);var spanIndex=element.line.children.indexOf(element);spanObj.characterFormat.copyFormat(element.characterFormat);if(element instanceof EditRangeEndElementBox||element instanceof BookmarkElementBox){element.line.children.splice(spanIndex,0,spanObj);}else{element.line.children.splice(spanIndex+1,0,spanObj);}spanObj.line=element.line;this.documentHelper.layout.reLayoutParagraph(element.line.paragraph,lineIndex,spanIndex);};Editor.prototype.insertFieldSeparatorText=function(fieldSeparator,selection,text,index){var previousInline=selection.getPreviousTextInline(fieldSeparator);var nextInline=selection.getNextTextInline(fieldSeparator);var span=new TextElementBox();span.text=text;var spanIndex=fieldSeparator.line.children.indexOf(fieldSeparator);if(index===fieldSeparator.length){spanIndex++;}if(sf.base.isNullOrUndefined(previousInline)&&sf.base.isNullOrUndefined(nextInline)){span.characterFormat.copyFormat(fieldSeparator.line.paragraph.characterFormat);}else if(sf.base.isNullOrUndefined(previousInline)){span.characterFormat.copyFormat(nextInline.characterFormat);}else{span.characterFormat.copyFormat(previousInline.characterFormat);}fieldSeparator.line.children.splice(spanIndex,0,span);span.line=fieldSeparator.line;var lineIndex=fieldSeparator.line.paragraph.childWidgets.indexOf(fieldSeparator.line);this.documentHelper.layout.reLayoutParagraph(fieldSeparator.line.paragraph,lineIndex,spanIndex);};Editor.prototype.insertFieldEndText=function(fieldEnd,selection,text,index){var span=new TextElementBox();span.text=text;var spanIndex=fieldEnd.line.children.indexOf(fieldEnd);span.characterFormat.copyFormat(fieldEnd.characterFormat);fieldEnd.line.children.splice(spanIndex+1,0,span);span.line=fieldEnd.line;var lineIndex=fieldEnd.line.paragraph.childWidgets.indexOf(fieldEnd.line);if(this.owner.enableTrackChanges){var isBidi=this.documentHelper.textHelper.getRtlLanguage(text).isRtl;var revisionType='Insertion';var isRevisionCombined=this.checkToMapRevisionWithInlineText(fieldEnd,index,span,isBidi,revisionType);if(!isRevisionCombined&&span.revisions.length===0){isRevisionCombined=this.checkToMapRevisionWithNextNode(fieldEnd.nextNode,span,isBidi,revisionType);}}this.documentHelper.layout.reLayoutParagraph(fieldEnd.line.paragraph,lineIndex,spanIndex);};Editor.prototype.insertImageText=function(image,selection,text,index){var previousInlineObj=selection.getPreviousTextInline(image);var nextInlineObj=selection.getNextTextInline(image);var line=image.line;var element=new TextElementBox();var paragraph=line.paragraph;var lineIndex=paragraph.childWidgets.indexOf(line);element.text=text;var spanIndex=line.children.indexOf(image);if(index===image.length){spanIndex++;}if(sf.base.isNullOrUndefined(previousInlineObj)&&sf.base.isNullOrUndefined(nextInlineObj)){element.characterFormat.copyFormat(paragraph.characterFormat);}else if(sf.base.isNullOrUndefined(previousInlineObj)){element.characterFormat.copyFormat(nextInlineObj.characterFormat);}else{element.characterFormat.copyFormat(previousInlineObj.characterFormat);}line.children.splice(spanIndex,0,element);element.line=line;this.documentHelper.layout.reLayoutParagraph(paragraph,lineIndex,spanIndex);};/**
     * @private
     */Editor.prototype.isListTextSelected=function(){if(this.documentHelper.isListTextSelected){this.initComplexHistory('ListSelect');if(this.documentHelper.selection.start.paragraph.paragraphFormat.listFormat&&this.documentHelper.selection.start.paragraph.paragraphFormat.listFormat.listId!==-1){this.onApplyList(undefined);}}};//Auto Format and insert Hyperlink Implementation starts
Editor.prototype.checkAndConvertToHyperlink=function(selection,isEnter,paragraph){var text;var span;if(isEnter){span=paragraph.lastChild.children[paragraph.lastChild.children.length-1];text=span.text;}else{var indexInInline=0;var inlineObj=selection.start.currentWidget.getInline(selection.start.offset-1,indexInInline);var inline=inlineObj.element;indexInInline=inlineObj.index;if(!(inline instanceof TextElementBox)){return;}span=inline;text=span.text.substring(0,indexInInline);}var index=0;var tabCharIndex=text.lastIndexOf('\t');index=tabCharIndex>=0?tabCharIndex+1:text.lastIndexOf(' ')+1;while(span.previousElement instanceof TextElementBox&&index===0){span=span.previousNode;var previousText=span.text;tabCharIndex=previousText.lastIndexOf('\t');index=tabCharIndex>=0?tabCharIndex+1:previousText.lastIndexOf(' ')+1;text=span.text+text;}text=text.substring(index);var lowerCaseText=text.toLowerCase();var containsURL=false;if(lowerCaseText.substring(0,8)==='file:///'||lowerCaseText.substring(0,7)==='http://'&&lowerCaseText.length>7||lowerCaseText.substring(0,8)==='https://'&&lowerCaseText.length>8||lowerCaseText.substring(0,4)==='www.'&&lowerCaseText.length>4||lowerCaseText.substring(0,3)==='\\'&&lowerCaseText.length>3||lowerCaseText.substring(0,7)==='mailto:'&&lowerCaseText.length>7){containsURL=true;if(lowerCaseText.substring(0,4)==='www.'&&lowerCaseText.length>4){text='http://'+text;}}else{var atIndex=text.indexOf('@');var dotIndex=text.indexOf('.');if(atIndex>0&&atIndex<dotIndex&&dotIndex<text.length-1){containsURL=true;text='mailto:'+text;}}if(containsURL){var startPos=new TextPosition(this.documentHelper.owner);startPos.setPositionParagraph(span.line,span.line.getOffset(span,index));var endPos=new TextPosition(this.documentHelper.owner);if(isEnter){endPos.setPositionParagraph(span.line,span.line.getEndOffset());}else{if(selection.end.currentWidget.children.length===0&&selection.end.offset===0){var prevLine=selection.end.currentWidget.previousLine;endPos.setPositionParagraph(prevLine,prevLine.getEndOffset());}else{endPos.setPositionParagraph(selection.end.currentWidget,selection.end.offset-1);}}this.autoFormatHyperlink(selection,text,startPos,endPos);}};Editor.prototype.autoFormatHyperlink=function(selection,url,startPosition,endPosition){this.initComplexHistory('AutoFormatHyperlink');var blockInfo=this.selection.getParagraphInfo(startPosition);var start=this.selection.getHierarchicalIndex(blockInfo.paragraph,blockInfo.offset.toString());if(this.editorHistory&&this.editorHistory.currentHistoryInfo){this.editorHistory.currentHistoryInfo.insertPosition=start;}// Moves the selection to URL text start and end position.
selection.start.setPositionInternal(startPosition);selection.end.setPositionInternal(endPosition);// Preserves the character format for hyperlink field.
var temp=this.getCharacterFormat(selection);var format=new WCharacterFormat();format.copyFormat(temp);var fieldEnd=this.createHyperlinkElement(url,startPosition,endPosition,format);// Moves the selection to the end of field end position.
selection.start.setPositionParagraph(fieldEnd.line,fieldEnd.line.getOffset(fieldEnd,1));// Moves to next text position. (To achieve common behavior for space and enter).
selection.start.moveNextPosition();selection.end.setPositionInternal(selection.start);blockInfo=this.selection.getParagraphInfo(selection.end);var end=this.selection.getHierarchicalIndex(blockInfo.paragraph,blockInfo.offset.toString());if(this.editorHistory&&this.editorHistory.currentHistoryInfo){this.editorHistory.currentHistoryInfo.endPosition=end;this.editorHistory.updateComplexHistory();this.reLayout(selection);}else{this.updateComplexWithoutHistory(0,start,end);}};Editor.prototype.appylingHyperlinkFormat=function(selection){this.initHistory('Underline');this.updateCharacterFormatWithUpdate(selection,'underline','Single',false);if(this.editorHistory){this.editorHistory.updateHistory();}this.reLayout(selection,false);// Applies font color for field result.
this.initHistory('FontColor');this.isForHyperlinkFormat=true;this.updateCharacterFormatWithUpdate(selection,'fontColor','#0563c1',false);this.isForHyperlinkFormat=false;if(this.editorHistory){this.editorHistory.updateHistory();}this.reLayout(selection,false);};Editor.prototype.createHyperlinkElement=function(url,startPosition,endPosition,format){var selection=this.selection;this.documentHelper.layout.allowLayout=false;this.appylingHyperlinkFormat(selection);this.documentHelper.layout.allowLayout=true;// Adds the field end at the URL text end position.
var fieldEnd=new FieldElementBox(1);fieldEnd.characterFormat.copyFormat(format);fieldEnd.line=selection.end.currentWidget;selection.start.setPositionInternal(selection.end);// this.insertElementInCurrentLine(selection, fieldEnd, true);
this.initInsertInline(fieldEnd);// Moves the selection to URL text start position.        
selection.start.setPositionInternal(startPosition);selection.end.setPositionInternal(selection.start);// Adds field begin, field code and field separator at the URL text start position.
var begin=this.insertHyperlinkfield(selection,format,url);var lineIndex=selection.start.paragraph.childWidgets.indexOf(begin.line);var index=begin.line.children.indexOf(begin);fieldEnd.linkFieldCharacter(this.documentHelper);this.documentHelper.layout.reLayoutParagraph(selection.start.paragraph,lineIndex,index);return fieldEnd;};Editor.prototype.insertHyperlinkfield=function(selection,format,url,isBookmark){// Adds field begin, field code and field separator at the URL text start position.
var begin=new FieldElementBox(0);begin.characterFormat.copyFormat(format);begin.line=selection.start.currentWidget;this.initInsertInline(begin);var span=new TextElementBox();span.characterFormat.copyFormat(format);if(isBookmark){span.text=' HYPERLINK \\l \"'+url+'\" ';}else{span.text=' HYPERLINK \"'+url+'\" ';}span.line=selection.start.currentWidget;this.initInsertInline(span);var separator=new FieldElementBox(2);separator.characterFormat.copyFormat(format);separator.line=selection.start.currentWidget;this.initInsertInline(separator);return begin;};/**
     * @private
     */ /* eslint-disable @typescript-eslint/no-explicit-any */Editor.prototype.unlinkRangeFromRevision=function(inline,removeCollection){for(var i=0;i<inline.revisions.length;i++){var currentRevision=inline.revisions[i];var rangeIndex=currentRevision.range.indexOf(inline);if(rangeIndex>=0){currentRevision.range.splice(rangeIndex,1);}if(currentRevision.range.length===0&&removeCollection){this.owner.revisions.remove(currentRevision);if(this.isRemoveRevision&&this.documentHelper.revisionsInternal.containsKey(currentRevision.revisionID)){this.documentHelper.revisionsInternal.remove(currentRevision.revisionID);}}}};/**
     * @private
     */ /* eslint-disable @typescript-eslint/no-explicit-any */Editor.prototype.unlinkWholeRangeInRevision=function(item,revision){var currentRevision=revision;item.revisions.splice(item.revisions.indexOf(item),1);var rangeLength=currentRevision.range.length;for(var rangeIndex=0;rangeIndex<rangeLength;rangeIndex++){currentRevision.range.splice(0,1);}if(currentRevision.range.length===0){this.owner.revisions.remove(currentRevision);if(this.isRemoveRevision&&this.documentHelper.revisionsInternal.containsKey(currentRevision.revisionID)){this.documentHelper.revisionsInternal.remove(currentRevision.revisionID);}}};/**
     * @private
     * @returns {void}
     */Editor.prototype.unLinkFieldCharacter=function(inline){if(inline instanceof FieldElementBox&&inline.fieldType===0){if(inline.fieldEnd){if(this.documentHelper){this.documentHelper.fieldToLayout=inline;this.documentHelper.fieldEndParagraph=inline.line.paragraph;}// inline.line.paragraph.addFieldCharacter(inline.fieldEnd);
if(inline.fieldEnd){inline.fieldEnd.fieldBegin=undefined;}inline.fieldEnd=undefined;}}if(inline instanceof FieldElementBox&&inline.fieldType===2){if(!sf.base.isNullOrUndefined(inline.fieldEnd)){if(this.documentHelper){this.documentHelper.fieldToLayout=inline.fieldBegin;this.documentHelper.fieldEndParagraph=inline.line.paragraph;}inline.fieldBegin.fieldSeparator=undefined;inline.fieldEnd.fieldSeparator=undefined;}}else if(inline instanceof FieldElementBox&&inline.fieldType===1){if(inline.fieldBegin){if(!sf.base.isNullOrUndefined(this.documentHelper)){this.documentHelper.fieldToLayout=inline.fieldBegin;this.documentHelper.fieldEndParagraph=inline.line.paragraph;}var fieldIndex=this.documentHelper.fields.indexOf(inline.fieldBegin);if(fieldIndex!==-1){this.documentHelper.fields.splice(fieldIndex,1);}var formFieldIndex=this.documentHelper.formFields.indexOf(inline.fieldBegin);if(formFieldIndex!==-1){this.documentHelper.formFields.splice(formFieldIndex,1);}inline.fieldBegin.fieldEnd=undefined;inline.fieldBegin=undefined;}}};Editor.prototype.getCharacterFormat=function(selection){if(selection.start.paragraph.isEmpty()){return selection.start.paragraph.characterFormat;}else{var info=selection.start.currentWidget.getInline(selection.start.offset,0);return info.element.characterFormat;}};/**
     * Insert Hyperlink
     *
     * @param {string} address - Hyperlink URL
     * @param {string} displayText - Display text for the hyperlink
     * @returns {void}
     */Editor.prototype.insertHyperlink=function(address,displayText){if(sf.base.isNullOrUndefined(displayText)){displayText=address;}this.insertHyperlinkInternal(address,displayText,this.owner.selection.text!==displayText,false);};/**
     * @private
     */Editor.prototype.insertHyperlinkInternal=function(url,displayText,remove,isBookmark){var selection=this.documentHelper.selection;if(selection.start.paragraph.associatedCell!==selection.end.paragraph.associatedCell){return;}if(remove){//Empty selection Hyperlink insert
this.insertHyperlinkInternalInternal(selection,url,displayText,isBookmark);}else{//Non-Empty Selection- change the selected text to Field       
// this.preservedFontCol = this.getFontColor();
var startPosition=selection.start;var endPosition=selection.end;if(!selection.isForward){startPosition=selection.end;endPosition=selection.start;}var fieldStartPosition=new TextPosition(this.documentHelper.owner);fieldStartPosition.setPositionInternal(startPosition);var temp=this.getCharacterFormat(selection);var format=new WCharacterFormat(undefined);format.copyFormat(temp);this.initComplexHistory('InsertHyperlink');var blockInfo=this.selection.getParagraphInfo(startPosition);var start=this.selection.getHierarchicalIndex(blockInfo.paragraph,blockInfo.offset.toString());if(this.editorHistory&&this.editorHistory.currentHistoryInfo){this.editorHistory.currentHistoryInfo.insertPosition=this.selection.getHierarchicalIndex(blockInfo.paragraph,blockInfo.offset.toString());}this.appylingHyperlinkFormat(selection);this.documentHelper.layout.allowLayout=true;startPosition.setPositionInternal(endPosition);// Adds the field end at the URL text end position.
var fieldEnd=new FieldElementBox(1);fieldEnd.characterFormat.copyFormat(format);fieldEnd.line=selection.end.currentWidget;startPosition.setPositionInternal(endPosition);// this.insertElementInCurrentLine(selection, fieldEnd, true);
this.initInsertInline(fieldEnd);// Moves the selection to URL text start position.        
startPosition.setPositionInternal(fieldStartPosition);endPosition.setPositionInternal(startPosition);// Adds field begin, field code and field separator at the URL text start position.
var begin=this.insertHyperlinkfield(selection,format,url,isBookmark);fieldEnd.linkFieldCharacter(this.documentHelper);var lineIndex=selection.start.paragraph.childWidgets.indexOf(begin.line);var index=begin.line.children.indexOf(begin);this.documentHelper.layout.reLayoutParagraph(selection.start.paragraph,lineIndex,index);var lineWidget=fieldEnd.line;selection.selects(lineWidget,lineWidget.getOffset(fieldEnd,fieldEnd.length),true);blockInfo=this.selection.getParagraphInfo(endPosition);var end=this.selection.getHierarchicalIndex(blockInfo.paragraph,blockInfo.offset.toString());if(this.editorHistory&&this.editorHistory.currentHistoryInfo){this.editorHistory.currentHistoryInfo.endPosition=this.selection.getHierarchicalIndex(blockInfo.paragraph,blockInfo.offset.toString());this.editorHistory.updateComplexHistory();}else{this.updateComplexWithoutHistory(1,start,end);}}};Editor.prototype.insertHyperlinkInternalInternal=function(selection,url,displayText,isBookmark){if(sf.base.isNullOrUndefined(selection.start)){return;}if(this.editHyperlink(selection,url,displayText)){return;}this.initHistory('InsertHyperlink');var isRemoved=true;if(!selection.isEmpty){var isTrackEnabled=this.owner.enableTrackChanges;this.owner.enableTrackChanges=false;isRemoved=this.removeSelectedContents(selection);this.owner.enableTrackChanges=isTrackEnabled;}if(isRemoved){// Preserves the character format for hyperlink field.
var temp=this.getCharacterFormat(selection);var format=new WCharacterFormat();format.copyFormat(temp);this.insertHyperlinkByFormat(selection,url,displayText,format,isBookmark);}//else
//    this.Select(Start, true);
};Editor.prototype.insertHyperlinkByFormat=function(selection,url,displayText,format,isBookmark){this.updateInsertPosition();selection.owner.isShiftingEnabled=true;var element=[];var fieldBegin=new FieldElementBox(0);element.push(fieldBegin);var span=new TextElementBox();if(isBookmark){span.text=' HYPERLINK \\l \"'+url+'\" ';}else{span.text=' HYPERLINK \"'+url+'\" ';}element.push(span);var fieldSeparator=new FieldElementBox(2);element.push(fieldSeparator);if(!sf.base.isNullOrUndefined(displayText)&&displayText!==''){span=new TextElementBox();span.characterFormat.underline='Single';span.characterFormat.fontColor='#0563c1';span.text=displayText;element.push(span);}var fieldEnd=new FieldElementBox(1);element.push(fieldEnd);this.insertElement(element);//let paragraph: ParagraphWidget = selection.start.paragraph;
fieldEnd.linkFieldCharacter(this.documentHelper);if(this.documentHelper.fields.indexOf(fieldBegin)===-1){this.documentHelper.fields.push(fieldBegin);}//let offset: number = fieldEnd.line.getOffset(fieldEnd, 1);
selection.selects(fieldEnd.line,fieldEnd.line.getOffset(fieldEnd,fieldEnd.length),true);this.updateEndPosition();this.reLayout(selection,true);};Editor.prototype.initInsertInline=function(element,insertHyperlink){this.initHistory('InsertInline');this.insertInlineInSelection(this.documentHelper.selection,element);if(this.editorHistory){this.editorHistory.updateHistory();}};Editor.prototype.insertElementInCurrentLine=function(selection,inline){if(this.checkIsNotRedoing()){selection.owner.isShiftingEnabled=true;}if(!selection.isEmpty){this.removeSelectedContents(selection);}this.updateInsertPosition();this.insertElement([inline]);if(this.checkEndPosition(selection)){this.updateHistoryPosition(selection.start,false);}this.fireContentChange();};/**
     * Edit Hyperlink
     * @param {Selection} selection - Specified the selection
     * @param {string} url - Specifies the url
     * @param {string} displayText - Specified the display test
     * @param {boolean} isBookmark - Specifies is bookmark
     * @private
     * @returns {boolean} - Return tru of hyperlink is edited.
     */Editor.prototype.editHyperlink=function(selection,url,displayText,isBookmark){var fieldBegin=selection.getHyperlinkField();if(sf.base.isNullOrUndefined(fieldBegin)){return false;}this.initHistory('InsertHyperlink');this.editHyperlinkInternal=sf.base.isNullOrUndefined(this.editorHistory)||this.editorHistory&&sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo);var fieldResult='';var isNestedField=false;// Preserves the character format for hyperlink field.
var temp=this.getCharacterFormat(selection);var format=new WCharacterFormat();format.copyFormat(temp);var fieldSeparator=undefined;if(!sf.base.isNullOrUndefined(fieldBegin.fieldSeparator)){fieldSeparator=fieldBegin.fieldSeparator;var fieldObj=selection.getHyperlinkDisplayText(fieldBegin.fieldSeparator.line.paragraph,fieldBegin.fieldSeparator,fieldBegin.fieldEnd,isNestedField,format);fieldResult=fieldObj.displayText;isNestedField=fieldObj.isNestedField;format=fieldObj.format;}var offset=fieldBegin.line.getOffset(fieldBegin,0);selection.start.setPositionParagraph(fieldBegin.line,offset);offset=fieldBegin.fieldEnd.line.getOffset(fieldBegin.fieldEnd,1);selection.end.setPositionParagraph(fieldBegin.fieldEnd.line,offset);this.skipFieldDeleteTracking=true;this.deleteSelectedContents(selection,false);if(!isNestedField&&fieldResult!==displayText||sf.base.isNullOrUndefined(fieldSeparator)){this.insertHyperlinkByFormat(selection,url,displayText,format,isBookmark);}else{//Modify the new hyperlink url. Inserts field begin, url and field separator.
this.updateInsertPosition();var newFieldBegin=new FieldElementBox(0);newFieldBegin.characterFormat.copyFormat(fieldBegin.characterFormat);newFieldBegin.line=selection.start.currentWidget;this.insertInlineInternal(newFieldBegin);var span=new TextElementBox();span.characterFormat.copyFormat(fieldBegin.characterFormat);if(isBookmark){span.text=' HYPERLINK \\l \"'+url+'\" ';}else{span.text=' HYPERLINK \"'+url+'\" ';}span.line=selection.start.currentWidget;this.insertInlineInternal(span);var nodes=this.editorHistory&&this.editorHistory.currentBaseHistoryInfo?this.editorHistory.currentBaseHistoryInfo.removedNodes:this.nodes;this.insertClonedFieldResult(selection,nodes,fieldSeparator);var fieldEnd=selection.end.currentWidget.getInline(selection.end.offset,0).element;fieldEnd.linkFieldCharacter(this.documentHelper);this.skipFieldDeleteTracking=false;var paragraph=newFieldBegin.line.paragraph;var lineIndex=newFieldBegin.line.paragraph.childWidgets.indexOf(newFieldBegin.line);var elementIndex=newFieldBegin.line.children.indexOf(newFieldBegin);this.documentHelper.layout.reLayoutParagraph(paragraph,lineIndex,elementIndex);selection.selects(newFieldBegin.fieldEnd.line,offset,true);this.updateEndPosition();this.reLayout(selection,true);}this.editHyperlinkInternal=false;this.nodes=[];return true;};/* eslint-disable @typescript-eslint/no-explicit-any */Editor.prototype.insertClonedFieldResult=function(selection,nodes,fieldSeparator){var isStarted=false;for(var i=nodes.length-1;i>-1;i--){var node=nodes[i];/* eslint-enable @typescript-eslint/no-explicit-any */if(!isStarted){if(fieldSeparator===node){isStarted=true;}else{if(node instanceof ParagraphWidget&&node===fieldSeparator.line.paragraph){isStarted=true;var paragraph=undefined;if(i===nodes.length-1){paragraph=selection.start.paragraph;var fieldParagraph=fieldSeparator.line.paragraph;this.getClonedFieldResultWithSel(fieldParagraph,selection,fieldSeparator);}else{paragraph=this.getClonedFieldResult(fieldSeparator.line.paragraph,fieldSeparator);this.insertParagraph(paragraph,true);}selection.selectParagraphInternal(selection.getNextParagraphBlock(paragraph),true);}continue;}}if(node instanceof ElementBox){this.insertInlineInternal(node.clone());}else if(node instanceof BlockWidget){this.insertBlock(node.clone());}// else if (node instanceof WSection)
//     editor.insertSection((node as WSection)._Clone());
}};Editor.prototype.getClonedFieldResultWithSel=function(paragraph,selection,fieldSeparator){var lineIndex=paragraph.childWidgets.indexOf(fieldSeparator.line);var elementIndex=paragraph.childWidgets[lineIndex].children.indexOf(fieldSeparator);for(var j=lineIndex;j<paragraph.childWidgets.length;j++){var lineWidget=paragraph.childWidgets[j];if(j!==lineIndex){elementIndex=0;}for(var i=elementIndex;i<lineWidget.children.length;i++){this.insertInlineInternal(lineWidget.children[i].clone());}}};Editor.prototype.getClonedFieldResult=function(curParagraph,fieldSeparator){var paragraph=new ParagraphWidget();paragraph.characterFormat.copyFormat(curParagraph.characterFormat);paragraph.paragraphFormat.copyFormat(curParagraph.paragraphFormat);var lineIndex=curParagraph.childWidgets.indexOf(fieldSeparator.line);var elementIndex=curParagraph.childWidgets[lineIndex].children.indexOf(fieldSeparator);for(var j=lineIndex;j<curParagraph.childWidgets.length;j++){var lineWidget=curParagraph.childWidgets[j];if(j!==lineIndex){elementIndex=0;}for(var i=elementIndex;i<lineWidget.children.length;i++){paragraph.childWidgets[0].children.push(lineWidget.children[i]);}}return paragraph;};/**
     * Removes the hyperlink if selection is within hyperlink.
     *
     * @returns {void}
     */Editor.prototype.removeHyperlink=function(){if(this.owner.isReadOnlyMode){return;}var selection=this.selection;var fieldBegin=selection.getHyperlinkField();if(sf.base.isNullOrUndefined(fieldBegin)){return;}var fieldEnd=fieldBegin.fieldEnd;var fieldSeparator=fieldBegin.fieldSeparator;var fieldStartPosition=new TextPosition(selection.owner);fieldStartPosition.setPositionParagraph(fieldBegin.line,fieldBegin.line.getOffset(fieldBegin,0));var blockInfo=this.selection.getParagraphInfo(fieldStartPosition);var fieldStartString=this.selection.getHierarchicalIndex(blockInfo.paragraph,blockInfo.offset.toString());var fieldSeparatorPosition=new TextPosition(selection.owner);fieldSeparatorPosition.setPositionParagraph(fieldSeparator.line,fieldSeparator.line.getOffset(fieldSeparator,fieldSeparator.length));blockInfo=this.selection.getParagraphInfo(fieldSeparatorPosition);var fieldSeparatorString=this.selection.getHierarchicalIndex(blockInfo.paragraph,blockInfo.offset.toString());this.initComplexHistory('RemoveHyperlink');selection.start.setPositionParagraph(fieldEnd.line,fieldEnd.line.getOffset(fieldEnd,0));blockInfo=this.selection.getParagraphInfo(selection.start);var startIndex=this.selection.getHierarchicalIndex(blockInfo.paragraph,blockInfo.offset.toString());selection.end.setPositionInternal(selection.start);this["delete"]();selection.start.setPositionInternal(this.selection.getTextPosBasedOnLogicalIndex(fieldSeparatorString));this.initHistory('Underline');this.updateCharacterFormatWithUpdate(selection,'underline','None',false);if(this.editorHistory){this.editorHistory.updateHistory();}selection.end.setPositionInternal(this.selection.getTextPosBasedOnLogicalIndex(startIndex));// Applies font color for field result.
this.initHistory('FontColor');this.updateCharacterFormatWithUpdate(selection,'fontColor',undefined,false);if(this.editorHistory){this.editorHistory.updateHistory();}this.reLayout(selection,false);selection.end.setPositionInternal(selection.start);selection.start.setPositionInternal(this.selection.getTextPosBasedOnLogicalIndex(fieldStartString));this.initHistory('Delete');this.deleteSelectedContents(selection,false);this.reLayout(selection,true);if(this.editorHistory&&!sf.base.isNullOrUndefined(this.editorHistory.currentHistoryInfo)){this.editorHistory.updateComplexHistory();}};//Paste Implementation starts
/**
     * Paste copied clipboard content on Paste event
     * @param {ClipboardEvent} event - Specifies the paste event
     * @param {any} pasteWindow - Specifies the paste window
     * @private
     */ /* eslint-disable @typescript-eslint/no-explicit-any */Editor.prototype.pasteInternal=function(event,pasteWindow){this.currentPasteOptions=this.owner.defaultPasteOption;if(this.documentHelper.owner.enableLocalPaste){this.paste();}else{this.selection.isViewPasteOptions=true;if(this.selection.pasteElement){this.selection.pasteElement.style.display='none';}if(sf.base.isNullOrUndefined(pasteWindow)){pasteWindow=window;}/* eslint-enable @typescript-eslint/no-explicit-any */var textContent='';var htmlContent='';var rtfContent='';var clipbordData=pasteWindow.clipboardData?pasteWindow.clipboardData:event.clipboardData;if(sf.base.Browser.info.name!=='msie'){rtfContent=clipbordData.getData('Text/Rtf');htmlContent=clipbordData.getData('Text/Html');}this.copiedTextContent=textContent=clipbordData.getData('Text');this.previousCharFormat=new WCharacterFormat();this.previousCharFormat.copyFormat(this.selection.start.paragraph.characterFormat);this.previousParaFormat=new WParagraphFormat();this.previousParaFormat.copyFormat(this.selection.start.paragraph.paragraphFormat);if(this.documentHelper.protectionType==='FormFieldsOnly'&&this.documentHelper.selection.isInlineFormFillMode()){htmlContent='';rtfContent='';}if(rtfContent!==''){this.pasteAjax(rtfContent,'.rtf');}else if(htmlContent!==''){var doc=new DOMParser().parseFromString(htmlContent,'text/html');var result=new XMLSerializer().serializeToString(doc);result=result.replace(/<!--StartFragment-->/gi,'');result=result.replace(/<!--EndFragment-->/gi,'');// Removed namesapce which is added when using XMLSerializer.
// When copy content from MS Word, the clipboard html content already have same namespace which cause duplicate namespace
// Here, removed the duplicate namespace.
result=result.replace('xmlns="http://www.w3.org/1999/xhtml"','');this.pasteAjax(result,'.html');}else if(textContent!==null&&textContent!==''){this.pasteContents(textContent);this.applyPasteOptions(this.currentPasteOptions);this.documentHelper.editableDiv.innerHTML='';}else if(sf.base.Browser.info.name!=='msie'&&clipbordData.items!==undefined&&clipbordData.items.length!==0&&clipbordData.items[0].type==='image/png'){this.pasteImage(clipbordData.items[0].getAsFile());}else if(sf.base.Browser.info.name==='msie'&&clipbordData.files!==undefined&&clipbordData.files.length!==0&&clipbordData.files[0].type==='image/png'){this.pasteImage(clipbordData.files[0]);}// if (textContent !== '') {
//     this.pasteContents(textContent);
//     this.documentHelper.editableDiv.innerHTML = '';
// }
}};Editor.prototype.pasteImage=function(imgFile){var _this=this;var fileReader=new FileReader();fileReader.onload=function(){_this.onPasteImage(fileReader.result);};fileReader.readAsDataURL(imgFile);};/**
     * @private
     * @returns {void}
     */Editor.prototype.onPasteImage=function(data){var image=document.createElement('img');var editor=this;image.addEventListener('load',function(){editor.insertImage(data,this.width,this.height);});image.src=data;};Editor.prototype.pasteAjax=function(content,type){var proxy=this;/* eslint-disable @typescript-eslint/no-explicit-any */var formObject={content:content,type:type};this.pasteRequestHandler=new XmlHttpRequestHandler();this.owner.documentHelper.viewerContainer.focus();// showSpinner(this.owner.element);
this.pasteRequestHandler.url=proxy.owner.serviceUrl+this.owner.serverActionSettings.systemClipboard;this.pasteRequestHandler.responseType='json';this.pasteRequestHandler.contentType='application/json;charset=UTF-8';this.pasteRequestHandler.customHeaders=proxy.owner.headers;this.pasteRequestHandler.onSuccess=this.pasteFormattedContent.bind(this);this.pasteRequestHandler.onFailure=this.onPasteFailure.bind(this);this.pasteRequestHandler.onError=this.onPasteFailure.bind(this);this.pasteRequestHandler.send(formObject);};/**
     * @private
     * @returns {void}
     */Editor.prototype.pasteFormattedContent=function(result){var _this=this;if(this.isPasteListUpdated){this.isPasteListUpdated=false;}this.pasteContents(sf.base.isNullOrUndefined(result.data)?this.copiedTextContent:result.data);if(this.currentPasteOptions!=='KeepSourceFormatting'){this.applyPasteOptions(this.currentPasteOptions);}//hideSpinner(this.owner.element);
setTimeout(function(){if(!sf.base.isNullOrUndefined(_this.viewer)){_this.viewer.updateScrollBars();}},0);};Editor.prototype.onPasteFailure=function(result){this.owner.fireServiceFailure(result);console.error(result.status,result.statusText);//hideSpinner(this.owner.element);
this.documentHelper.updateFocus();};/**
     * Pastes provided sfdt content or the data present in local clipboard if any.
     *
     * @param {string} sfdt? insert the specified sfdt content at current position
     * @returns {void}
     */Editor.prototype.paste=function(sfdt,defaultPasteOption){var _this=this;if(sf.base.isNullOrUndefined(sfdt)){sfdt=this.owner.enableLocalPaste?this.copiedData:undefined;}if(!sf.base.isNullOrUndefined(defaultPasteOption)){this.currentPasteOptions=defaultPasteOption;}/* eslint-disable @typescript-eslint/no-explicit-any */if(sfdt){var document_1=JSON.parse(sfdt);this.pasteContents(document_1);this.applyPasteOptions(this.currentPasteOptions);if(this.chartType){setTimeout(function(){if(!sf.base.isNullOrUndefined(_this.viewer)){_this.viewer.updateScrollBars();}},30);this.chartType=false;}}};Editor.prototype.getUniqueListOrAbstractListId=function(isList){if(isList&&this.documentHelper.lists.length){var sortedList=this.documentHelper.lists.slice().sort(function(a,b){return a.listId-b.listId;});return sortedList[sortedList.length-1].listId+1;}else if(this.documentHelper.abstractLists.length){var sortedAbsList=this.documentHelper.abstractLists.slice().sort(function(a,b){return a.abstractListId-b.abstractListId;});return sortedAbsList[sortedAbsList.length-1].abstractListId+1;}return 0;};Editor.prototype.checkSameLevelFormat=function(lstLevelNo,abstractList,list){return abstractList.levels[lstLevelNo].listLevelPattern===list.abstractList.levels[lstLevelNo].listLevelPattern&&abstractList.levels[lstLevelNo].numberFormat===list.abstractList.levels[lstLevelNo].numberFormat&&(abstractList.levels[lstLevelNo].listLevelPattern==='Bullet'||abstractList.levels[lstLevelNo].startAt===list.abstractList.levels[lstLevelNo].startAt);};Editor.prototype.listLevelPatternInCollection=function(lstLevelNo,listLevel){var _this=this;return this.documentHelper.lists.filter(function(list){return list.abstractList.levels[lstLevelNo].listLevelPattern===listLevel.listLevelPattern&&list.abstractList.levels[lstLevelNo].numberFormat===listLevel.numberFormat&&(listLevel.listLevelPattern==='Bullet'||list.abstractList.levels[lstLevelNo].startAt===listLevel.startAt)&&_this.isEqualParagraphFormat(list.abstractList.levels[lstLevelNo].paragraphFormat,listLevel.paragraphFormat);})[0];};Editor.prototype.isEqualParagraphFormat=function(source,dest){if(sf.base.isNullOrUndefined(dest.leftIndent)&&source.leftIndent!==0||!sf.base.isNullOrUndefined(dest.leftIndent)&&Math.round(source.leftIndent)!==Math.round(dest.leftIndent)){return false;}if(sf.base.isNullOrUndefined(dest.rightIndent)&&source.rightIndent!==0||!sf.base.isNullOrUndefined(dest.rightIndent)&&Math.round(source.rightIndent)!==Math.round(dest.rightIndent)){return false;}if(sf.base.isNullOrUndefined(dest.firstLineIndent)&&source.firstLineIndent!==0||!sf.base.isNullOrUndefined(dest.firstLineIndent)&&Math.round(source.firstLineIndent)!==Math.round(dest.firstLineIndent)){return false;}if(sf.base.isNullOrUndefined(dest.beforeSpacing)&&source.beforeSpacing!==0||!sf.base.isNullOrUndefined(dest.beforeSpacing)&&Math.round(source.beforeSpacing)!==Math.round(dest.beforeSpacing)){return false;}if(sf.base.isNullOrUndefined(dest.afterSpacing)&&source.afterSpacing!==0||!sf.base.isNullOrUndefined(dest.afterSpacing)&&Math.round(source.afterSpacing)!==Math.round(dest.afterSpacing)){return false;}if(sf.base.isNullOrUndefined(dest.textAlignment)&&source.textAlignment!=='Left'||!sf.base.isNullOrUndefined(dest.textAlignment)&&source.textAlignment!==dest.textAlignment){return false;}if(sf.base.isNullOrUndefined(dest.bidi)&&source.bidi!==false||!sf.base.isNullOrUndefined(dest.bidi)&&source.bidi!==dest.bidi){return false;}if(sf.base.isNullOrUndefined(dest.contextualSpacing)&&source.contextualSpacing!==false||!sf.base.isNullOrUndefined(dest.contextualSpacing)&&source.contextualSpacing!==dest.contextualSpacing){return false;}if(sf.base.isNullOrUndefined(dest.keepWithNext)&&source.keepWithNext!==false||!sf.base.isNullOrUndefined(dest.keepWithNext)&&source.keepWithNext!==dest.keepWithNext){return false;}if(sf.base.isNullOrUndefined(dest.keepLinesTogether)&&source.keepLinesTogether!==false||!sf.base.isNullOrUndefined(dest.keepLinesTogether)&&source.keepLinesTogether!==dest.keepLinesTogether){return false;}if(sf.base.isNullOrUndefined(dest.widowControl)&&source.widowControl!==false||!sf.base.isNullOrUndefined(dest.widowControl)&&source.widowControl!==dest.widowControl){return false;}if(sf.base.isNullOrUndefined(dest.outlineLevel)&&source.outlineLevel!=='BodyText'||!sf.base.isNullOrUndefined(dest.outlineLevel)&&source.outlineLevel!==dest.outlineLevel){return false;}if(sf.base.isNullOrUndefined(dest.lineSpacing)&&source.lineSpacing!==1||!sf.base.isNullOrUndefined(dest.lineSpacing)&&Math.round(source.lineSpacing)!==Math.round(dest.lineSpacing)){return false;}if(sf.base.isNullOrUndefined(dest.lineSpacingType)&&source.lineSpacingType!=='Multiple'||!sf.base.isNullOrUndefined(dest.lineSpacingType)&&source.lineSpacingType!==dest.lineSpacingType){return false;}return true;};Editor.prototype.getBlocksToUpdate=function(blocks){var blcks=[];for(var i=0;i<blocks.length;i++){var obj=blocks[i];if(obj.paragraphFormat&&obj.paragraphFormat.listFormat&&Object.keys(obj.paragraphFormat.listFormat).length>0){blcks.push(obj);}else if(obj.rows){for(var j=0;j<obj.rows.length;j++){var currentRow=obj.rows[j];for(var k=0;k<currentRow.cells.length;k++){var cell=currentRow.cells[k];blcks=blcks.concat(this.getBlocksToUpdate(cell.blocks));}}}}return blcks;};Editor.prototype.updateListIdForBlocks=function(blocks,abstractList,list,id,idToUpdate){var update=false;for(var i=0;i<blocks.length;i++){var obj=blocks[i];if(obj.paragraphFormat&&obj.paragraphFormat.listFormat&&Object.keys(obj.paragraphFormat.listFormat).length>0){var format=obj.paragraphFormat.listFormat;var existingList=this.listLevelPatternInCollection(format.listLevelNumber,abstractList.levels[format.listLevelNumber]);if(format.listId===id){if(sf.base.isNullOrUndefined(existingList)&&(!list||list&&!this.checkSameLevelFormat(format.listLevelNumber,abstractList,list))){update=true;format.listId=idToUpdate;}else if(!sf.base.isNullOrUndefined(existingList)&&this.checkSameLevelFormat(format.listLevelNumber,abstractList,existingList)){if(!format.isUpdated){format.listId=existingList.listId;format.isUpdated=true;}update=false;}}}else if(obj.rows){for(var j=0;j<obj.rows.length;j++){var row=obj.rows[j];for(var k=0;k<row.cells.length;k++){var cell=row.cells[k];var toUpdate=this.updateListIdForBlocks(cell.blocks,abstractList,list,id,idToUpdate);if(!update){update=toUpdate;}}}}}return update;};Editor.prototype.updatePasteContent=function(pasteContent,sectionId){var uniqueListId=this.getUniqueListOrAbstractListId(true);if(pasteContent.lists.filter(function(obj){return obj.listId===uniqueListId;}).length>0){var sortedPasteList=pasteContent.lists.slice().sort(function(a,b){return a.listId-b.listId;});uniqueListId=sortedPasteList[sortedPasteList.length-1].listId+1;}var uniqueAbsLstId=this.getUniqueListOrAbstractListId(false);if(pasteContent.abstractLists.filter(function(obj){return obj.abstractListId===uniqueAbsLstId;}).length>0){var sortedPasteAbsList=pasteContent.abstractLists.slice().sort(function(a,b){return a.abstractListId-b.abstractListId;});uniqueAbsLstId=sortedPasteAbsList[sortedPasteAbsList.length-1].abstractListId+1;}var _loop_1=function _loop_1(k){var list=pasteContent.lists[k];var abstractList=pasteContent.abstractLists.filter(function(obj){return obj.abstractListId===list.abstractListId;})[0];var lstDup=this_1.documentHelper.lists.filter(function(obj){return obj.listId===list.listId;});if(!sf.base.isNullOrUndefined(abstractList)){var isUpdate=this_1.updateListIdForBlocks(pasteContent.sections[sectionId].blocks,abstractList,lstDup[0],list.listId,uniqueListId);if(isUpdate){abstractList.abstractListId=uniqueAbsLstId;list.listId=uniqueListId;list.abstractListId=uniqueAbsLstId;uniqueListId++;uniqueAbsLstId++;}else{pasteContent.lists.splice(k,1);pasteContent.abstractLists.splice(pasteContent.abstractLists.indexOf(abstractList),1);k--;}}out_k_1=k;};var this_1=this,out_k_1;for(var k=0;k<pasteContent.lists.length;k++){_loop_1(k);k=out_k_1;}var blocks=this.getBlocksToUpdate(pasteContent.sections[sectionId].blocks);for(var i=0;i<blocks.length;i++){var blck=blocks[i];delete blck.paragraphFormat.listFormat.isUpdated;}};/**
     * @private
     */Editor.prototype.getBlocks=function(pasteContent,isPaste,sections,comments,revision){var widgets=[];if(typeof pasteContent==='string'){var startParagraph=this.selection.start.paragraph;if(!this.selection.isForward){startParagraph=this.selection.end.paragraph;}var arr=[];var txt=pasteContent;txt=txt.replace(/\r\n/g,'\r');if(navigator.userAgent.indexOf('Firefox')!==-1){arr=txt.split('\n');}else{arr=txt.split('\r');}var widget=[];var bodyWidget=new BodyWidget();bodyWidget.sectionFormat=new WSectionFormat(bodyWidget);bodyWidget.childWidgets=widget;for(var i=0;i<arr.length;i++){if(i===arr.length-1&&arr[i].length===0){continue;}var currentInline=this.selection.start.currentWidget.getInline(this.selection.start.offset,0);var element=this.selection.getPreviousValidElement(currentInline.element);if(element!==currentInline.element){element=this.selection.getNextValidElement(currentInline.element);}var insertFormat=element&&element===currentInline.element?startParagraph.characterFormat:element?element.characterFormat:this.copyInsertFormat(startParagraph.characterFormat,false);if(!sf.base.isNullOrUndefined(this.previousCharFormat)){insertFormat=this.previousCharFormat;}var insertParaFormat=this.documentHelper.selection.copySelectionParagraphFormat();if(!sf.base.isNullOrUndefined(this.previousParaFormat)){insertParaFormat=this.previousParaFormat;}var paragraph=new ParagraphWidget();paragraph.paragraphFormat.copyFormat(insertParaFormat);var line=new LineWidget(paragraph);if(arr[i].length>0){var textElement=new TextElementBox();textElement.characterFormat.copyFormat(insertFormat);textElement.text=arr[i];line.children.push(textElement);textElement.line=line;}paragraph.childWidgets.push(line);paragraph.containerWidget=bodyWidget;widget.push(paragraph);}widgets.push(bodyWidget);}else{this.viewer.owner.parser.addCustomStyles(pasteContent);if(!isPaste&&pasteContent.comments.length>0){this.documentHelper.owner.parser.commentsCollection=new Dictionary();this.documentHelper.owner.parser.parseComments(pasteContent,comments);}for(var i=0;i<pasteContent.sections.length;i++){var parser=this.documentHelper.owner.parser;parser.isPaste=isPaste;if(!this.isPasteListUpdated&&!sf.base.isNullOrUndefined(pasteContent.lists)){if(this.documentHelper.lists.length>0){this.updatePasteContent(pasteContent,i);}this.isPasteListUpdated=true;if(!sf.base.isNullOrUndefined(pasteContent.abstractLists)){parser.parseAbstractList(pasteContent,this.documentHelper.abstractLists);}if(!sf.base.isNullOrUndefined(pasteContent.lists)){parser.parseList(pasteContent,this.documentHelper.lists);}}if(!sf.base.isNullOrUndefined(pasteContent.revisions)){if(isPaste){var revisionChanges=this.viewer.owner.revisionsInternal.changes;if(!sf.base.isNullOrUndefined(parser.revisionCollection)){parser.revisionCollection=undefined;}parser.revisionCollection=new Dictionary();var revisionCollection=parser.revisionCollection;if(!(this.documentHelper.owner.sfdtExportModule.copyWithTrackChange&&parser.isCutPerformed)){if(pasteContent.revisions.length>=1){for(var i_1=0;i_1<pasteContent.revisions.length;i_1++){var revisionCheck=true;if(revisionCollection.containsKey(pasteContent.revisions[i_1].revisionId)){if(revisionChanges.length>0){for(var j=0;j<revisionChanges.length;j++){if(revisionChanges[j].revisionID===pasteContent.revisions[i_1].revisionId){revisionCheck=false;}}}if(revisionCheck){var revision_1=revisionCollection.get(pasteContent.revisions[i_1].revisionId);revisionChanges.push(revision_1);}}else{parser.parseRevisions(pasteContent,revisionChanges);}}}}this.documentHelper.owner.sfdtExportModule.copyWithTrackChange=false;}else{parser.revisionCollection=this.documentHelper.revisionsInternal;parser.parseRevisions(pasteContent,revision);}}var bodyWidget=new BodyWidget();bodyWidget.sectionFormat=new WSectionFormat(bodyWidget);parser.parseSectionFormat(pasteContent.sections[i].sectionFormat,bodyWidget.sectionFormat);if(!isPaste){sections.unshift(bodyWidget);}else{widgets.push(bodyWidget);}parser.parseBody(pasteContent.sections[i].blocks,bodyWidget.childWidgets);parser.isPaste=false;}}if(this.currentPasteOptions==='MergeWithExistingFormatting'){this.applyMergeFormat(widgets);}return widgets;};Editor.prototype.applyMergeFormat=function(bodyWidgets){var startParagraph=this.selection.start.paragraph;var currentInline=this.selection.start.currentWidget.getInline(this.selection.start.offset,0);var element=this.selection.getPreviousValidElement(currentInline.element);var insertFormat=element?element.characterFormat:this.copyInsertFormat(startParagraph.characterFormat,false);var insertParaFormat=this.documentHelper.selection.copySelectionParagraphFormat();for(var k=0;k<bodyWidgets.length;k++){var widgets=bodyWidgets[k].childWidgets;for(var i=0;i<widgets.length;i++){var widget=widgets[i];if(widget instanceof ParagraphWidget){widget.paragraphFormat.copyFormat(insertParaFormat);this.applyFormatInternal(widget,insertFormat);}else{for(var j=0;j<widget.childWidgets.length;j++){var row=widget.childWidgets[j];for(var k_1=0;k_1<row.childWidgets.length;k_1++){var cell=row.childWidgets[k_1];for(var l=0;l<cell.childWidgets.length;l++){this.applyFormatInternal(cell.childWidgets[l],insertFormat);}}}}}}};Editor.prototype.applyFormatInternal=function(widget,insertFormat){if(widget instanceof ParagraphWidget){for(var j=0;j<widget.childWidgets.length;j++){var lineWidget=widget.childWidgets[j];for(var k=0;k<lineWidget.children.length;k++){var inlineCharacterFormat=lineWidget.children[k].characterFormat;var characterFormat=inlineCharacterFormat.cloneFormat();if(sf.base.isNullOrUndefined(insertFormat.uniqueCharacterFormat)){lineWidget.children[k].characterFormat=insertFormat;}else{lineWidget.children[k].characterFormat.uniqueCharacterFormat=undefined;lineWidget.children[k].characterFormat.copyFormat(insertFormat);}if(characterFormat.bold){lineWidget.children[k].characterFormat.bold=characterFormat.bold;}if(characterFormat.italic){lineWidget.children[k].characterFormat.italic=characterFormat.italic;}if(characterFormat.underline!=='None'){lineWidget.children[k].characterFormat.underline=characterFormat.underline;}}}}else{for(var j=0;j<widget.childWidgets.length;j++){var rowWidget=widget.childWidgets[j];for(var k=0;k<rowWidget.childWidgets.length;k++){var cellWidget=rowWidget.childWidgets[k];for(var l=0;l<cellWidget.childWidgets.length;l++){this.applyFormatInternal(cellWidget.childWidgets[l],insertFormat);}}}}};Editor.prototype.applyPasteOptions=function(options){if(sf.base.isNullOrUndefined(this.copiedContent)||this.copiedTextContent===''){return;}this.isSkipHistory=true;this.currentPasteOptions=options;this.selection.start.setPositionInternal(this.pasteTextPosition.startPosition);this.selection.end.setPositionInternal(this.pasteTextPosition.endPosition);switch(options){case'KeepSourceFormatting':this.pasteContents(this.copiedContent!==''?this.copiedContent:this.copiedTextContent);break;case'MergeWithExistingFormatting':var start=this.selection.isForward?this.selection.start:this.selection.end;var currentFormat=start.paragraph.paragraphFormat;this.pasteContents(this.copiedContent!==''?this.copiedContent:this.copiedTextContent,currentFormat);break;case'KeepTextOnly':this.pasteContents(this.copiedTextContent);break;}this.isSkipHistory=false;};/**
     * @private
     * @returns {void}
     */Editor.prototype.pasteContents=function(content,currentFormat){if(typeof content!=='string'){this.copiedContent=content;}if(this.documentHelper.protectionType==='FormFieldsOnly'&&this.documentHelper.selection.isInlineFormFillMode()){var inline=this.selection.getCurrentFormField();var resultText=this.getFormFieldText();var maxLength=inline.formFieldData.maxLength;var selectedTextLength=this.documentHelper.selection.text.length;if(maxLength>0){if(selectedTextLength===0){var contentlength=maxLength-resultText.length;content=content.substring(0,contentlength);}else if(selectedTextLength>0){content=content.substring(0,selectedTextLength);}}}this.pasteContentsInternal(this.getBlocks(content,true),true,currentFormat);this.isInsertField=false;};Editor.prototype.pasteContentsInternal=function(widgets,isPaste,currentFormat){this.isPaste=isPaste;/* eslint-enable @typescript-eslint/no-explicit-any */var selection=this.documentHelper.selection;var isRemoved=true;if(!this.isSkipHistory){this.initComplexHistory('Paste');}if(this.documentHelper.isListTextSelected){var paragraph=selection.start.paragraph;if(paragraph.paragraphFormat.listFormat&&paragraph.paragraphFormat.listFormat.listId!==-1){this.onApplyList(undefined);}}if(!this.isSkipHistory){this.initHistory('Paste');}if(!selection.isEmpty||this.documentHelper.isListTextSelected){isRemoved=this.removeSelectedContentInternal(selection,selection.start,selection.end);}if(isRemoved){this.pasteContent(widgets,currentFormat);}else if(this.editorHistory){this.editorHistory.currentBaseHistoryInfo=undefined;}if(this.editorHistory&&this.editorHistory.currentHistoryInfo){this.editorHistory.updateHistory();this.editorHistory.updateComplexHistory();}else{this.reLayout(selection,selection.isEmpty);}this.isPaste=false;};Editor.prototype.pasteContent=function(widgets,currentFormat){/* eslint-enable @typescript-eslint/no-explicit-any */this.documentHelper.owner.isShiftingEnabled=true;var insertPosition='';this.updateInsertPosition();if(this.editorHistory&&this.editorHistory.currentBaseHistoryInfo){insertPosition=this.editorHistory.currentBaseHistoryInfo.insertPosition;}else{var position=this.selection.start;if(!this.selection.isForward){position=this.selection.end;}var blockInfo=this.selection.getParagraphInfo(position);insertPosition=this.selection.getHierarchicalIndex(blockInfo.paragraph,blockInfo.offset.toString());}this.documentHelper.owner.isLayoutEnabled=true;this.documentHelper.owner.isPastingContent=true;this.pasteCopiedData(widgets,currentFormat);var endPosition='';this.updateEndPosition();if(this.editorHistory&&this.editorHistory.currentBaseHistoryInfo){endPosition=this.editorHistory.currentBaseHistoryInfo.endPosition;}else{var blockInfo=this.selection.getParagraphInfo(this.selection.start);endPosition=this.selection.getHierarchicalIndex(blockInfo.paragraph,blockInfo.offset.toString());}var startPosition=new TextPosition(this.documentHelper.owner);this.setPositionForCurrentIndex(startPosition,insertPosition);var end=new TextPosition(this.documentHelper.owner);this.setPositionForCurrentIndex(end,endPosition);this.pasteTextPosition={startPosition:startPosition,endPosition:end};this.documentHelper.owner.isPastingContent=false;this.documentHelper.selection.fireSelectionChanged(true);};Editor.prototype.pasteCopiedData=function(bodyWidget,currentFormat){if(this.documentHelper.layout.isBidiReLayout){this.documentHelper.layout.isBidiReLayout=false;}if(this.isPaste&&this.isSectionEmpty(this.selection)&&!this.selection.start.paragraph.isInHeaderFooter){this.previousSectionFormat=new WSectionFormat();this.previousSectionFormat.copyFormat(this.selection.start.paragraph.bodyWidget.sectionFormat);this.selection.start.paragraph.bodyWidget.sectionFormat.copyFormat(bodyWidget[0].sectionFormat);this.selection.start.paragraph.bodyWidget.sectionFormat.footerDistance=this.previousSectionFormat.footerDistance;this.selection.start.paragraph.bodyWidget.sectionFormat.headerDistance=this.previousSectionFormat.headerDistance;if(this.owner.viewer instanceof PageLayoutViewer){var page=this.selection.start.paragraph.bodyWidget.page;this.owner.viewer.updatePageBoundingRectangle(this.selection.start.paragraph.bodyWidget,page,page.boundingRectangle.y);this.owner.viewer.updateClientArea(this.selection.start.paragraph.bodyWidget.sectionFormat,page);}}for(var k=0;k<bodyWidget.length;k++){var widgets=bodyWidget[k].childWidgets;for(var j=0;j<widgets.length;j++){var widget=widgets[j];if(widget instanceof ParagraphWidget&&widget.childWidgets.length===0){widget.childWidgets[0]=new LineWidget(widget);}if(widget instanceof ParagraphWidget&&!sf.base.isNullOrUndefined(currentFormat)){widget.paragraphFormat.copyFormat(currentFormat);var insertFormat=this.copyInsertFormat(this.selection.start.paragraph.characterFormat,false);widget.characterFormat.mergeFormat(insertFormat);}if(j===widgets.length-1&&widget instanceof ParagraphWidget){var newParagraph=widget;if(newParagraph.childWidgets.length>0&&newParagraph.childWidgets[0].children.length>0){var insertPosition=this.selection.start;if((insertPosition.paragraph.paragraphFormat.textAlignment==='Center'||insertPosition.paragraph.paragraphFormat.textAlignment==='Right')&&insertPosition.paragraph.paragraphFormat.listFormat.listId===-1){insertPosition.paragraph.x=this.owner.viewer.clientActiveArea.x;}if(this.currentPasteOptions==='KeepTextOnly'){var paraFormat=new WParagraphFormat();this.selection.start.paragraph.paragraphFormat=paraFormat;}this.insertElement(newParagraph.childWidgets[0].children,newParagraph.paragraphFormat);}}else if(widget instanceof BlockWidget){var startParagraph=this.selection.start.paragraph;var isTable=widget instanceof TableWidget;if(isTable){var table=widget;this.generateTableRevision(table);if(startParagraph.isInsideTable){//Handled to resize table based on parent cell width.
var clientWidth=startParagraph.getContainerWidth();table.fitCellsToClientArea(clientWidth);}if(startParagraph.isEmpty()&&startParagraph.previousWidget instanceof TableWidget){return this.insertTableRows(table,startParagraph.previousWidget);}}this.insertBlockInternal(widget);}}}};Editor.prototype.generateTableRevision=function(table){if(this.owner.enableTrackChanges&&!sf.base.isNullOrUndefined(table)){for(var i=0;i<table.childWidgets.length;i++){var row=table.childWidgets[i];this.insertRevision(row.rowFormat,'Insertion');for(var j=0;j<row.childWidgets.length;j++){var cell=row.childWidgets[j];for(var k=0;k<cell.childWidgets.length;k++){var para=cell.childWidgets[k];if(!sf.base.isNullOrUndefined(para)){this.insertRevisionForBlock(para,'Insertion');}}}}}};Editor.prototype.isSectionEmpty=function(selection){var startParagraph=selection.start.paragraph;if(startParagraph){if(startParagraph.isInsideTable||startParagraph.isInHeaderFooter||startParagraph!==selection.end.paragraph){return false;}var bodyWidget=startParagraph.bodyWidget;if(bodyWidget){var page=bodyWidget.page;if(page){if((sf.base.isNullOrUndefined(page.previousPage)||page.previousPage.sectionIndex!==page.sectionIndex)&&sf.base.isNullOrUndefined(page.nextPage)&&startParagraph.isEmpty()&&bodyWidget.childWidgets.length===1){return true;}}}}return false;};/**
     * Insert table on undo
     *
     * @param {TableWidget} table - Specifies the table
     * @param {TableWidget} newTable - Speciefies the new table
     * @param {boolean} moveRows - Specifies the new row
     * @private
     * @private {void}
     */Editor.prototype.insertTableInternal=function(table,newTable,moveRows){//Gets the index of current table.
var insertIndex=table.getIndex();if(moveRows){//Moves the rows to table.
for(var i=0,index=0;i<table.childWidgets.length;i++,index++){var row=table.childWidgets[i];newTable.childWidgets.splice(index,0,row);row.containerWidget=newTable;table.childWidgets.splice(i,1);i--;}}var owner=table.containerWidget;//remove old table revisions if it is present.
this.constructRevisionsForTable(table,false);this.removeBlock(table,true);//Inserts table in the current table position.        
var blockAdvCollection=owner.childWidgets;blockAdvCollection.splice(insertIndex,0,newTable);newTable.index=table.index;table.containerWidget=undefined;newTable.containerWidget=owner;this.documentHelper.layout.clearTableWidget(newTable,true,true,true);newTable.buildTableColumns();this.constructRevisionsForTable(newTable,true);newTable.isGridUpdated=true;this.updateNextBlocksIndex(newTable,true);this.documentHelper.layout.linkFieldInTable(newTable);this.documentHelper.layout.layoutBodyWidgetCollection(newTable.index,owner,newTable,false);};/* eslint-disable @typescript-eslint/no-explicit-any */Editor.prototype.canConstructRevision=function(item){if(item.revisions.length>0&&item.revisions[0].range.length===0||item.removedIds.length>0){return true;}return false;};Editor.prototype.constructRevisionsForTable=function(table,canConstructRevision){for(var i=0;i<table.childWidgets.length;i++){var rowWidget=table.childWidgets[i];if(canConstructRevision){if(this.canConstructRevision(rowWidget.rowFormat)){this.constructRevisionFromID(rowWidget.rowFormat,true);}for(var rowIndex=0;rowIndex<rowWidget.childWidgets.length;rowIndex++){var cellWidget=rowWidget.childWidgets[rowIndex];for(var paraIndex=0;paraIndex<cellWidget.childWidgets.length;paraIndex++){if(cellWidget.childWidgets[paraIndex]instanceof ParagraphWidget){this.constructRevisionsForBlock(cellWidget.childWidgets[paraIndex],canConstructRevision);}}}}else{this.removeDeletedCellRevision(rowWidget);}}};Editor.prototype.constructRevisionsForBlock=function(paragraph,canConstructRevision){for(var linIndex=0;linIndex<paragraph.childWidgets.length;linIndex++){var lineWidget=paragraph.childWidgets[linIndex];for(var elementIndex=0;elementIndex<lineWidget.children.length;elementIndex++){if(canConstructRevision){if(lineWidget.children[elementIndex]instanceof ElementBox&&this.canConstructRevision(lineWidget.children[elementIndex])){this.constructRevisionFromID(lineWidget.children[elementIndex],true);}}}}if(this.canConstructRevision(paragraph.characterFormat)){this.constructRevisionFromID(paragraph.characterFormat,true);}};/**
     * @private
     * @param paraWidget
     * @param startoffset
     * @param endoffset
     * @param revisionId
     * @param isParaMarkIncluded
     * @returns {void}
     */Editor.prototype.applyRevisionForCurrentPara=function(paraWidget,startoffset,endoffset,revisionId,isParaMarkIncluded){var elementInfo=paraWidget.getInline(startoffset+1,0);var currentElement=elementInfo.element;var skipElement=false;if(startoffset===paraWidget.getLength()){skipElement=true;}var endElement=paraWidget.getInline(endoffset,0).element;if(endoffset>paraWidget.getLength()){isParaMarkIncluded=true;}if(!sf.base.isNullOrUndefined(currentElement)&&!sf.base.isNullOrUndefined(endElement)){if(!skipElement&&currentElement===endElement){currentElement.removedIds.push(revisionId);this.constructRevisionFromID(currentElement,true);}else{while(!sf.base.isNullOrUndefined(currentElement)&&currentElement!==endElement){if(!skipElement){currentElement.removedIds.push(revisionId);this.constructRevisionFromID(currentElement,true);}if(!sf.base.isNullOrUndefined(currentElement.nextNode)){currentElement=currentElement.nextNode.nextValidNodeForTracking;}skipElement=false;}if(!sf.base.isNullOrUndefined(currentElement)&&!skipElement){currentElement.removedIds.push(revisionId);this.constructRevisionFromID(currentElement,true);}}}else if(!sf.base.isNullOrUndefined(currentElement)&&!skipElement){currentElement.removedIds.push(revisionId);this.constructRevisionFromID(currentElement,true);}else if(!sf.base.isNullOrUndefined(endElement)){endElement.removedIds.push(revisionId);this.constructRevisionFromID(endElement,true);}if(isParaMarkIncluded){paraWidget.characterFormat.removedIds.push(revisionId);this.constructRevisionFromID(paraWidget.characterFormat,true);}};/**
     * Insert table on undo
     *
     * @param {Selection} selection - Specified the selection
     * @param {WBlock} block - Spcifies the block
     * @param {WTable} table - Specifies the table.
     * @private
     * @returns {void}
     */Editor.prototype.insertBlockTable=function(selection,block,table){var offset=selection.start.offset;var lineIndex=selection.start.paragraph.childWidgets.indexOf(selection.start.currentWidget);if(block instanceof ParagraphWidget&&offset>0){//Moves the inline items before selection start to the inserted paragraph.
this.moveInlines(selection.start.paragraph,block,0,0,selection.start.paragraph.firstChild,offset,selection.start.currentWidget);selection.selectParagraphInternal(selection.start.paragraph,true);if(this.checkInsertPosition(selection)){this.updateHistoryPosition(this.selection.getHierarchicalIndex(block,offset.toString()),true);}}if(offset>0&&this.checkInsertPosition(selection)){this.updateHistoryPosition(selection.start,true);}var index=table.indexInOwner;table.containerWidget.childWidgets.splice(index,0,block);block.containerWidget=table.containerWidget;block.index=table.index;this.updateNextBlocksIndex(block,true);this.documentHelper.layout.layoutBodyWidgetCollection(block.index,block.containerWidget,block,false);if(this.checkInsertPosition(selection)){var paragraph=undefined;if(block instanceof ParagraphWidget){paragraph=block;}if(block instanceof TableWidget){paragraph=selection.getFirstParagraphInFirstCell(block);}this.updateHistoryPosition(this.selection.getHierarchicalIndex(paragraph,'0'),true);}};/**
     * On cut handle selected content remove and relayout
     *
     * @param {Selection} selection - Specified the selection
     * @private
     * @returns {void}
     */Editor.prototype.handleCut=function(selection){var startPosition=selection.start;var endPosition=selection.end;if(!selection.isForward){startPosition=selection.end;endPosition=selection.start;}// this.owner.isShiftingEnabled = true;
var blockInfo=this.selection.getParagraphInfo(startPosition);selection.editPosition=this.selection.getHierarchicalIndex(blockInfo.paragraph,blockInfo.offset.toString());if(startPosition.paragraph===endPosition.paragraph&&startPosition.offset+1===endPosition.offset){//Gets selected image and copy image to clipboard.
var index=0;var currentInline=startPosition.paragraph.getInline(endPosition.offset,index);var inline=currentInline.element;}this.initHistory('Cut');selection.owner.isShiftingEnabled=true;if(this.editorHistory&&this.editorHistory.currentBaseHistoryInfo){if(this.checkInsertPosition(selection)){this.updateHistoryPosition(selection.editPosition,true);}}this.deleteSelectedContent(endPosition.paragraph,selection,startPosition,endPosition,3);var textPosition=new TextPosition(selection.owner);this.setPositionForCurrentIndex(textPosition,selection.editPosition);selection.selectContent(textPosition,true);if(this.editorHistory&&this.editorHistory.currentBaseHistoryInfo){if(this.checkEndPosition(selection)){this.updateHistoryPosition(selection.end,false);}}this.reLayout(selection);};Editor.prototype.insertInlineInternal=function(element,revisionType){var selection=this.selection;var length=element.length;var paragraphInfo=this.selection.getParagraphInfo(selection.start);revisionType=sf.base.isNullOrUndefined(revisionType)?'Insertion':revisionType;if(selection.start.paragraph.isEmpty()){var paragraph=selection.start.paragraph;if((paragraph.paragraphFormat.textAlignment==='Center'||paragraph.paragraphFormat.textAlignment==='Right')&&paragraph.paragraphFormat.listFormat.listId===-1){paragraph.x=this.owner.viewer.clientActiveArea.x;}var isUndoing=!sf.base.isNullOrUndefined(this.editorHistory)?this.editorHistory.isUndoing||this.editorHistory.isRedoing:false;paragraph.childWidgets[0].children.push(element);element.line=paragraph.childWidgets[0];if(this.owner.enableTrackChanges&&element.isValidNodeForTracking&&!isUndoing){this.insertRevision(element,revisionType);}if(element.removedIds.length>0||isUndoing){this.constructRevisionFromID(element,true);}element.linkFieldCharacter(this.documentHelper);if(element instanceof FootnoteElementBox){if(element.footnoteType==='Footnote'){this.updateFootnoteCollection(element);}if(element.footnoteType==='Endnote'){this.updateEndnoteCollection(element);}}this.documentHelper.layout.reLayoutParagraph(paragraph,0,0,undefined,undefined);}else{var indexInInline=0;var inlineObj=selection.start.currentWidget.getInline(selection.start.offset,indexInInline);var curInline=inlineObj.element;indexInInline=inlineObj.index;this.insertElementInternal(curInline,element,indexInInline,revisionType,true);}this.setPositionParagraph(paragraphInfo.paragraph,paragraphInfo.offset+length,true);};Editor.prototype.insertElement=function(element,paragraphFormat){var selection=this.selection;var length=0;var paragraph=undefined;var lineIndex=-1;var lineWidget=undefined;var insertIndex=0;var begin=undefined;var paragraphInfo=this.selection.getParagraphInfo(selection.start);var isTrackingEnabled=this.owner.enableTrackChanges;var curInline=undefined;var prevElement=undefined;var indexInInline=0;if(selection.start.paragraph.isEmpty()){paragraph=selection.start.paragraph;lineWidget=paragraph.childWidgets[0];lineIndex=0;}else{var bidi=selection.start.paragraph.paragraphFormat.bidi;var inlineObj=selection.start.currentWidget.getInline(selection.start.offset,indexInInline,bidi);curInline=inlineObj.element;indexInInline=inlineObj.index;paragraph=curInline.line.paragraph;lineIndex=paragraph.childWidgets.indexOf(curInline.line);insertIndex=curInline.indexInOwner;lineWidget=curInline.line;var isRtl=false;if(curInline instanceof TextElementBox){isRtl=this.documentHelper.textHelper.getRtlLanguage(curInline.text).isRtl;}if(indexInInline===curInline.length){// Add new Element in current 
if(!bidi){insertIndex++;}begin=false;}else if(indexInInline===0){if(isRtl&&bidi&&this.isInsertField){insertIndex++;}else if(sf.base.isNullOrUndefined(curInline.previousNode)){insertIndex=0;}begin=true;}else{insertIndex++;prevElement=new TextElementBox();prevElement.characterFormat.copyFormat(curInline.characterFormat);if(bidi&&this.isInsertField&&isRtl){prevElement.text=curInline.text.slice(0,indexInInline);curInline.text=curInline.text.substring(indexInInline);}else{prevElement.text=curInline.text.substring(indexInInline);curInline.text=curInline.text.slice(0,indexInInline);}if(curInline.revisions.length>0&&!this.owner.enableTrackChanges){this.splitRevisionForSpittedElement(curInline,prevElement);}lineWidget.children.splice(insertIndex,0,prevElement);prevElement.line=curInline.line;}}for(var i=0;i<element.length;i++){length+=element[i].length;if(element[i]instanceof TextElementBox&&element[i].text.indexOf(' ')>=0){this.documentHelper.triggerSpellCheck=true;}var prevRevisionsCount=element[i].revisions.length;element[i].ischangeDetected=true;lineWidget.children.splice(insertIndex,0,element[i]);element[i].line=lineWidget;element[i].linkFieldCharacter(this.documentHelper);var isRevisionCombined=this.updateRevisionForElement(curInline,element[i],indexInInline,i===0?true:false,prevElement,begin);//Check to combine elements with previous / next para
if(isTrackingEnabled&&!isRevisionCombined&&element[i].revisions.length===prevRevisionsCount){//if (!(element[i] instanceof FieldElementBox && (element[i] as FieldElementBox).fieldType === 2)) {
this.checkToCombineRevisionsinBlocks(element[i],prevRevisionsCount===element[i].revisions.length,i>0&&i===element.length-1,'Insertion');//}
}curInline=element[i];insertIndex++;}if(paragraphFormat&&(sf.base.isNullOrUndefined(paragraph.paragraphFormat.listFormat.list)||!sf.base.isNullOrUndefined(paragraph.paragraphFormat.listFormat)&&paragraph.paragraphFormat.listFormat.listId===-1)){paragraph.paragraphFormat.copyFormat(paragraphFormat);}this.documentHelper.layout.reLayoutParagraph(paragraph,lineIndex,0,this.isInsertField?undefined:paragraph.paragraphFormat.bidi);this.setPositionParagraph(paragraphInfo.paragraph,paragraphInfo.offset+length,true);};Editor.prototype.updateRevisionForElement=function(currentElement,newElement,indexInInline,isFirstItem,prevElement,isBeginning){if(!this.owner.enableTrackChanges){return false;}if(sf.base.isNullOrUndefined(currentElement)&&sf.base.isNullOrUndefined(prevElement)){return false;}var isMiddle=sf.base.isNullOrUndefined(isBeginning)?true:false;var prevRevisionCount=newElement.revisions.length;if(isFirstItem){if(isMiddle){var isRevisionCombined=this.checkToMapRevisionWithInlineText(currentElement,indexInInline,newElement,false,'Insertion');if(isRevisionCombined||newElement.revisions.length>prevRevisionCount){this.copyElementRevision(currentElement,prevElement,true);}else if(newElement.revisions.length===0){this.splitRevisionForSpittedElement(currentElement,prevElement);this.insertRevision(newElement,'Insertion');}}else if(isBeginning){return this.insertRevisionAtBegining(currentElement,newElement,'Insertion');}else{return this.insertRevisionAtEnd(currentElement,newElement,'Insertion');}}else{// if (currentElement instanceof FieldElementBox && currentElement.fieldType === 2) {
//     currentElement = (currentElement as FieldElementBox).previousElement;
// }
return this.insertRevisionAtEnd(currentElement,newElement,'Insertion');}return false;};Editor.prototype.insertElementInternal=function(element,newElement,index,revisionType,relayout){var line=element.line;var paragraph=line.paragraph;var lineIndex=line.indexInOwner;var insertIndex=element.indexInOwner;var isBidi=paragraph.paragraphFormat.bidi&&element.isRightToLeft;var isEqualFormat=false;revisionType=sf.base.isNullOrUndefined(revisionType)?'Insertion':revisionType;var isUndoing=this.skipTracking();var isTrackingEnabled=this.owner.enableTrackChanges;var isRevisionCombined=false;var prevRevisionCount=newElement.revisions.length;if(this.owner.editorHistory&&(this.owner.editorHistory.isUndoing||this.owner.editorHistory.isRedoing)&&newElement instanceof TextElementBox){isEqualFormat=element.characterFormat.isEqualFormat(newElement.characterFormat)&&this.documentHelper.textHelper.isRTLText(newElement.text);}if(!isEqualFormat){if(index===element.length){// Add new Element in current 
if(!isBidi){insertIndex++;}if(newElement.removedIds.length>0||isUndoing){this.constructRevisionFromID(newElement,true,element);}else if(isTrackingEnabled&&!isUndoing&&!this.skipFieldDeleteTracking){isRevisionCombined=this.insertRevisionAtEnd(element,newElement,revisionType);}line.children.splice(insertIndex,0,newElement);}else if(index===0){if(newElement.removedIds.length>0){this.constructRevisionFromID(newElement,false);}else if(isTrackingEnabled&&!isUndoing&&!this.skipFieldDeleteTracking){isRevisionCombined=this.insertRevisionAtBegining(element,newElement,revisionType);}if(sf.base.isNullOrUndefined(element.previousNode)){element.line.children.splice(0,0,newElement);insertIndex=0;}else{element.line.children.splice(insertIndex,0,newElement);}}else{if(!isBidi){insertIndex++;}var textElement=new TextElementBox();textElement.characterFormat.copyFormat(element.characterFormat);textElement.text=element.text.substring(index);if(element.revisions.length>0&&!isTrackingEnabled&&!isUndoing&&newElement.removedIds.length===0){this.splitRevisionForSpittedElement(element,textElement);}element.text=element.text.substr(0,index);line.children.splice(insertIndex,0,textElement);textElement.line=element.line;isRevisionCombined=true;this.isTrackingFormField=element.previousElement instanceof FieldElementBox?true:false;if(newElement.removedIds.length>0&&!this.isTrackingFormField){this.constructRevisionFromID(newElement,false);this.copyElementRevision(element,textElement,true);}else if(this.owner.enableTrackChanges){if(!(newElement instanceof BookmarkElementBox)&&!(newElement instanceof CommentCharacterElementBox)&&!(newElement instanceof EditRangeStartElementBox)&&!(newElement instanceof EditRangeEndElementBox)){var isRevisionCombined_1=this.checkToMapRevisionWithInlineText(element,index,newElement,isBidi,revisionType);if(isRevisionCombined_1||newElement.revisions.length>prevRevisionCount){this.copyElementRevision(element,textElement,true);}else if(newElement.revisions.length===prevRevisionCount){this.splitRevisionForSpittedElement(element,textElement);this.insertRevision(newElement,revisionType);}}else{this.copyElementRevision(element,textElement,false);}}//Inserts the new inline.
line.children.splice(isBidi?insertIndex+1:insertIndex,0,newElement);insertIndex-=1;}}else{element.text=element.text.substring(0,index)+newElement.text+element.text.substring(index);}newElement.line=element.line;newElement.linkFieldCharacter(this.documentHelper);if(newElement instanceof ContentControl&&newElement.type===0){this.documentHelper.contentControlCollection.push(newElement);}if(newElement instanceof ShapeBase&&newElement.textWrappingStyle!=='Inline'){if(paragraph.floatingElements.indexOf(newElement)===-1){paragraph.floatingElements.push(newElement);}if(paragraph.bodyWidget.floatingElements.indexOf(newElement)===-1){paragraph.bodyWidget.floatingElements.push(newElement);}}if(isTrackingEnabled&&!isRevisionCombined&&!isUndoing&&!this.skipFieldDeleteTracking){this.checkToCombineRevisionsinBlocks(newElement,prevRevisionCount===newElement.revisions.length,index===element.length,revisionType);}if(newElement instanceof FootnoteElementBox){if(isUndoing){// this.documentHelper.layout.isLayoutWhole = true;
newElement.isLayout=false;}if(newElement.footnoteType==='Footnote'){this.updateFootnoteCollection(newElement);}if(newElement.footnoteType==='Endnote'){this.updateEndnoteCollection(newElement);}}if(relayout){this.documentHelper.layout.reLayoutParagraph(paragraph,lineIndex,insertIndex,undefined,undefined);}};/**
     * @private
     * @returns {void}
     */ /* eslint-disable @typescript-eslint/no-explicit-any */Editor.prototype.constructRevisionFromID=function(insertElement,isEnd,prevElement){if(insertElement.removedIds.length>0){for(var i=0;i<insertElement.removedIds.length;i++){var revisionToInclude=undefined;if(this.documentHelper.revisionsInternal.containsKey(insertElement.removedIds[i])){revisionToInclude=this.documentHelper.revisionsInternal.get(insertElement.removedIds[i]);insertElement.revisions.push(revisionToInclude);isEnd=isEnd?true:this.skipTracking();if(isEnd){if(this.editorHistory.isRedoing&&this.owner.editorHistory.currentBaseHistoryInfo&&this.owner.editorHistory.currentBaseHistoryInfo.action==='BackSpace'){isEnd=false;}}if(!sf.base.isNullOrUndefined(prevElement)){var rangeIndex=revisionToInclude.range.indexOf(prevElement);if(rangeIndex>=0){revisionToInclude.range.splice(rangeIndex+(isEnd?1:0),0,insertElement);}else{revisionToInclude.range.splice(isEnd?revisionToInclude.range.length:0,0,insertElement);}}else{revisionToInclude.range.splice(isEnd?revisionToInclude.range.length:0,0,insertElement);}this.updateRevisionCollection(revisionToInclude);}}insertElement.removedIds=[];}else{// on undoing revisions will be cloned , so need to update range information.
for(var i=0;i<insertElement.revisions.length;i++){var currentRevision=insertElement.revisions[i];if(this.documentHelper.revisionsInternal.containsKey(currentRevision.revisionID)){currentRevision=this.documentHelper.revisionsInternal.get(currentRevision.revisionID);currentRevision.range.splice(isEnd?currentRevision.range.length:0,0,insertElement);this.updateRevisionCollection(currentRevision);}}}};/**
     * Insert block on undo
     *
     * @param {Selection} selection - Specifies the selection
     * @param {WBlock} block - Specifes the block
     * @private
     * @returns {void}
     */Editor.prototype.insertBlock=function(block){var isRemoved=true;var selection=this.selection;if(!selection.isEmpty){isRemoved=this.removeSelectedContents(selection);}if(!isRemoved){selection.selectContent(selection.start,false);}this.insertBlockInternal(block);this.addOrRemoveCommentsInBlock(block,true);if(this.checkInsertPosition(selection)){var paragraph=undefined;if(block instanceof ParagraphWidget){paragraph=block;}else{paragraph=this.selection.getFirstParagraphInFirstCell(block);}this.updateHistoryPosition(this.selection.getHierarchicalIndex(paragraph,'0'),true);}this.fireContentChange();};Editor.prototype.insertBlockInternal=function(block){var selection=this.selection;var startPara=this.selection.start.paragraph;if(!selection.start.isAtParagraphStart){if(block instanceof ParagraphWidget){var startPosition=selection.start.clone();//let prevBlock: ParagraphWidget = (block as ParagraphWidget).clone()
this.insertNewParagraphWidget(block,false);if(!this.isInsertingTOC){this.combineRevisions(block,startPosition,this.selection.end);}return;}this.updateInsertPosition();startPara=startPara.combineWidget(this.owner.viewer);this.splitParagraph(startPara,startPara.firstChild,0,selection.start.currentWidget,selection.start.offset,false);selection.selectParagraphInternal(this.selection.start.paragraph,true);}var bodyWidget=selection.start.paragraph.containerWidget;var blockIndex=selection.start.paragraph.index;var insertIndex=bodyWidget.childWidgets.indexOf(selection.start.paragraph);if(!sf.base.isNullOrUndefined(bodyWidget)){bodyWidget.childWidgets.splice(insertIndex,0,block);block.containerWidget=bodyWidget;block.index=blockIndex;block.height=0;if(block instanceof TableWidget){block.isGridUpdated=false;block.buildTableColumns();block.isGridUpdated=true;}this.updateNextBlocksIndex(block,true);if(!this.isInsertingTOC&&this.owner.enableTrackChanges&&!this.skipTracking()&&block instanceof ParagraphWidget){this.insertRevisionForBlock(block,'Insertion');}else if(block instanceof ParagraphWidget){this.constructRevisionsForBlock(block,true);}else if(block instanceof TableWidget){this.constructRevisionsForTable(block,true);}this.documentHelper.layout.layoutBodyWidgetCollection(blockIndex,bodyWidget,block,false);}};/**
     * Inserts the image with specified size at cursor position in the document editor.
     *
     * @param {string} imageString  Base64 string, web URL or file URL.
     * @param {number} width? Image width
     * @param {number} height? Image height
     * @returns {void}
     */Editor.prototype.insertImage=function(imageString,width,height){var _this=this;if(this.owner.isReadOnlyMode||!this.canEditContentControl){return;}if(sf.base.isNullOrUndefined(width)){width=100;}if(sf.base.isNullOrUndefined(height)){height=100;}this.insertPicture(imageString,width,height);setTimeout(function(){if(!sf.base.isNullOrUndefined(_this.viewer)){_this.viewer.updateScrollBars();}},30);};/**
     * Inserts a table of specified size at cursor position
     *  in the document editor.
     *
     * @param {number} rows Default value of rows parameter is 1.
     * @param {number} columns Default value of columns parameter is 1.
     * @returns {void}
     */Editor.prototype.insertTable=function(rows,columns){var startPos=this.selection.start;if(this.owner.isReadOnlyMode||!this.canEditContentControl){return;}rows=rows||1;columns=columns||1;var table=this.createTable(rows,columns);var clientWidth=startPos.paragraph.getContainerWidth()-table.tableFormat.leftIndent;table.splitWidthToTableCells(clientWidth);var prevBlock=startPos.paragraph.previousWidget;if(startPos.currentWidget.isFirstLine()&&startPos.offset===0&&prevBlock instanceof TableWidget){this.insertTableRows(table,prevBlock);table.destroy();return;}else{this.initHistory('InsertTable');this.documentHelper.owner.isShiftingEnabled=true;this.insertBlock(table);}var startLine=this.selection.getFirstParagraphInFirstCell(table).childWidgets[0];startPos.setPosition(startLine,true);this.selection.end.setPositionInternal(startPos);var lastParagraph=this.selection.getLastParagraphInLastCell(table.getSplitWidgets().pop());var endOffset=lastParagraph.getLength()+1;if(this.editorHistory&&this.editorHistory.currentBaseHistoryInfo){this.editorHistory.currentBaseHistoryInfo.endPosition=this.selection.getHierarchicalIndex(lastParagraph,endOffset.toString());}this.reLayout(this.selection);};/**
     * Inserts the specified number of rows to the table above or below to the row at cursor position.
     *
     * @param {boolean} above The above parameter is optional and if omitted,
     * it takes the value as false and inserts below the row at cursor position.
     * @param {number} count The count parameter is optional and if omitted, it takes the value as 1.
     * @returns {void}
     */Editor.prototype.insertRow=function(above,count){var rowPlacement=above?'Above':'Below';if(this.owner.isReadOnlyMode||!this.canEditContentControl){return;}var startPos=this.selection.isForward?this.selection.start:this.selection.end;var endPos=this.selection.isForward?this.selection.end:this.selection.start;if(startPos.paragraph.isInsideTable){if(this.checkIsNotRedoing()){this.initHistory(rowPlacement==='Above'?'InsertRowAbove':'InsertRowBelow');}this.documentHelper.owner.isShiftingEnabled=true;var startCell=this.getOwnerCell(this.selection.isForward).getSplitWidgets()[0];var endCell=this.getOwnerCell(!this.selection.isForward).getSplitWidgets()[0];var table=startCell.ownerTable.combineWidget(this.owner.viewer);var row=rowPlacement==='Below'?endCell.ownerRow:startCell.ownerRow;if(this.editorHistory){var clonedTable=this.cloneTableToHistoryInfo(table);}var rowCount=count?count:this.getRowCountToInsert();var rows=[];var index=row.rowIndex;if(rowPlacement==='Below'){index++;var isAffectedByRowSpannedCell=sf.base.isNullOrUndefined(endCell.previousWidget)||endCell.columnIndex===endCell.previousWidget.columnIndex+1;var isRowSpanEnd=endCell.cellIndex!==endCell.columnIndex&&isAffectedByRowSpannedCell&&row.rowIndex+startCell.cellFormat.rowSpan-1===endCell.ownerRow.rowIndex;if(!isRowSpanEnd){if(endCell.cellFormat.rowSpan>1){if(!sf.base.isNullOrUndefined(row.nextWidget)&&row.nextWidget instanceof TableRowWidget){endCell.cellFormat.rowSpan+=rowCount;row=row.nextWidget;}}}row.bottomBorderWidth=0;}for(var i=0;i<rowCount;i++){var cellCountInfo=this.updateRowspan(row,rowPlacement==='Below'?endCell:startCell,rowPlacement);var newRow=this.createRowAndColumn(cellCountInfo.count,i);newRow.rowFormat.copyFormat(row.rowFormat);if(this.owner.enableTrackChanges){this.insertRevision(newRow.rowFormat,'Insertion');}this.updateCellFormatForInsertedRow(newRow,cellCountInfo.cellFormats);rows.push(newRow);}table.insertTableRowsInternal(rows,index);var cell=undefined;var paragraph=undefined;if(table.childWidgets[index]instanceof TableRowWidget){cell=table.childWidgets[index].firstChild;paragraph=this.selection.getFirstParagraph(cell);}else{var widget=undefined;while(!(widget instanceof TableWidget)){widget=table.nextRenderedWidget;}paragraph=this.selection.getFirstParagraphInFirstCell(widget);}this.documentHelper.layout.reLayoutTable(table);this.selection.selectParagraphInternal(paragraph,true);}this.reLayout(this.selection,true);};/**
     * Fits the table based on AutoFitType.
     *
     * @param {AutoFitType} - auto fit type
     * @returns {void}
     */Editor.prototype.autoFitTable=function(fitType){if(this.documentHelper.owner.isReadOnlyMode||!this.canEditContentControl){return;}var startPosition=this.selection.start;var endPosition=this.selection.end;if(!this.selection.isForward){startPosition=this.selection.end;endPosition=this.selection.start;}var tableAdv=this.selection.getTable(startPosition,endPosition);tableAdv=tableAdv.getSplitWidgets()[0];var parentTable=this.documentHelper.layout.getParentTable(tableAdv);if(!sf.base.isNullOrUndefined(parentTable)){this.setOffsetValue(this.selection);parentTable=parentTable.combineWidget(this.owner.viewer);this.initHistory(fitType==='FitToContents'?'TableAutoFitToContents':fitType==='FitToWindow'?'TableAutoFitToWindow':'TableFixedColumnWidth');if(this.documentHelper.owner.editorHistoryModule){this.cloneTableToHistoryInfo(parentTable);}parentTable.updateProperties(true,tableAdv,fitType);this.documentHelper.owner.isShiftingEnabled=true;//Layouts the table.
this.documentHelper.layout.reLayoutTable(tableAdv);this.reLayout(this.selection,true);}};Editor.prototype.updateCellFormatForInsertedRow=function(newRow,cellFormats){for(var i=0;i<newRow.childWidgets.length;i++){newRow.childWidgets[i].cellFormat.copyFormat(cellFormats[i]);newRow.childWidgets[i].cellFormat.rowSpan=1;}};Editor.prototype.updateRowspan=function(row,startCell,rowPlacement){var spannedCells=row.getPreviousRowSpannedCells(true);var count=0;var cellFormats=[];for(var i=0;i<row.childWidgets.length;i++){var cell=row.childWidgets[i];var isCellIncluded=false;// Need to check with all the row spanned cells. if the start cell contains rowspan greater than 1, 
// and when inserting below, need to increment rowspan for all row spanned cells by 1 except
// if the spanned cells is placed in the same column or cell to be cloned has the same row index of cloned cell row index.
// and when inserting above, if cloned cell placed in the same row of start cell or
// if the cloned cell has equal column index, need to skip updating rowspan value of cloned cell.
// else update row span value for spanned cell except 
// if the spanned cells is placed in the same column or cell to be cloned has the same row index of cloned cell row index.
var isRowSpanned=sf.base.isNullOrUndefined(cell.previousWidget)||cell.columnIndex!==cell.previousWidget.columnIndex+1;for(var j=0;j<spannedCells.length;j++){if(isRowSpanned){var spannedCell=spannedCells[j];var clonedRowIndex=spannedCell.ownerRow.rowIndex+spannedCell.cellFormat.rowSpan-1;if(cell.columnIndex<spannedCell.columnIndex&&cell.cellIndex!==cell.columnIndex){isCellIncluded=true;count++;cellFormats.push(cell.cellFormat);}if(startCell.cellFormat.rowSpan===1){// Need to check whether cell is affected by a row spanned cell. if cell is placed on the row where it is affected 
// by row spanned cell, then if we are inserting row below, need to add new cell with spanned cell width
// or if we are inserting above, need to update row span value of the spanned cell.
// if cell is placed inbetween the spanned cell , 
// then if we are inserting below, need to update row span value of spanned cell or
// if we are inserting above, need to skip updating row span value except
// if start cell is placed on the same row of spanned cell or if start cell placed in the same column.
if(clonedRowIndex>cell.ownerRow.rowIndex){if(rowPlacement==='Above'&&spannedCell.ownerRow===startCell.ownerRow){continue;}else{spannedCell.cellFormat.rowSpan+=1;spannedCells.splice(j,1);j--;}}else if(cell.cellIndex!==cell.columnIndex&&isRowSpanned&&clonedRowIndex===cell.ownerRow.rowIndex){if(rowPlacement==='Above'){spannedCell.cellFormat.rowSpan+=1;spannedCells.splice(j,1);j--;}else{count++;cellFormats.push(spannedCell.cellFormat);spannedCells.splice(j,1);j--;}}}else{if(spannedCell!==startCell){if(rowPlacement==='Above'&&(spannedCell.ownerRow===startCell.ownerRow||spannedCell.columnIndex===startCell.columnIndex)){continue;}else{if(spannedCell.columnIndex!==startCell.columnIndex&&spannedCell.ownerRow.rowIndex!==cell.ownerRow.rowIndex&&(clonedRowIndex>startCell.ownerRow.rowIndex||rowPlacement==='Above'&&clonedRowIndex===startCell.ownerRow.rowIndex)){spannedCell.cellFormat.rowSpan+=1;spannedCells.splice(j,1);j--;}}}}}}if(spannedCells.indexOf(cell)===-1&&cell.cellFormat.rowSpan>1){isCellIncluded=true;}if(!isCellIncluded){count++;cellFormats.push(cell.cellFormat);}}return{count:count,cellFormats:cellFormats};};Editor.prototype.insertTableRows=function(table,prevBlock){this.initHistory('InsertTableBelow');table.containerWidget=prevBlock.containerWidget;prevBlock=prevBlock.combineWidget(this.owner.viewer);// if (this.editorHistory) {
//     let clonedTable: TableWidget = this.cloneTableToHistoryInfo(prevBlock);
// }
var row=prevBlock.childWidgets[prevBlock.childWidgets.length-1];prevBlock.insertTableRowsInternal(table.childWidgets,prevBlock.childWidgets.length);var paragraph=this.selection.getFirstParagraph(row.nextWidget.childWidgets[0]);if(this.checkInsertPosition(this.selection)){this.updateHistoryPosition(this.selection.getHierarchicalIndex(paragraph,'0'),true);}prevBlock.isDefaultFormatUpdated=false;this.documentHelper.layout.reLayoutTable(prevBlock);this.selection.start.setPosition(paragraph.firstChild,true);if(this.editorHistory&&this.editorHistory.currentBaseHistoryInfo){this.updateHistoryPosition(this.selection.end,false);}this.selection.end.setPosition(paragraph.firstChild,true);this.reLayout(this.selection);};/**
     * Inserts the specified number of columns to the table left or right to the column at cursor position.
     *
     * @param {number} left The left parameter is optional and if omitted, it takes the value as false and
     * inserts to the right of column at cursor position.
     * @param {number} count The count parameter is optional and if omitted, it takes the value as 1.
     * @returns {void}
     */Editor.prototype.insertColumn=function(left,count){if(this.owner.isReadOnlyMode||!this.canEditContentControl){return;}var columnPlacement=left?'Left':'Right';if(this.selection.start.paragraph.isInsideTable){if(this.checkIsNotRedoing()){this.initHistory(columnPlacement==='Left'?'InsertColumnLeft':'InsertColumnRight');}this.selection.owner.isShiftingEnabled=true;var startCell=this.getOwnerCell(this.selection.isForward);var endCell=this.getOwnerCell(!this.selection.isForward);var table=startCell.ownerRow.ownerTable.combineWidget(this.owner.viewer);if(this.editorHistory){//Clones the entire table to preserve in history.
this.cloneTableToHistoryInfo(table);}this.selection.owner.isLayoutEnabled=false;var cellIndex=startCell.columnIndex;if(columnPlacement==='Right'){cellIndex=endCell.columnIndex+endCell.cellFormat.columnSpan;}var startParagraph=undefined;var newCell=undefined;var columnCount=count?count:this.getColumnCountToInsert();var rowSpannedCells=[];//let rowSpanCellIndex: number = cellIndex;
for(var i=0;i<columnCount;i++){for(var j=0;j<table.childWidgets.length;j++){var row=table.childWidgets[j];newCell=this.createColumn(this.selection.getLastParagraph(startCell));newCell.index=j;newCell.rowIndex=row.rowIndex;newCell.containerWidget=row;newCell.cellFormat.copyFormat(startCell.cellFormat);newCell.cellFormat.rowSpan=1;if(sf.base.isNullOrUndefined(startParagraph)){startParagraph=this.selection.getFirstParagraph(newCell);}if(cellIndex===0){row.childWidgets.splice(cellIndex,0,newCell);}else{var isCellInserted=false;for(var j_1=0;j_1<row.childWidgets.length;j_1++){var rowCell=row.childWidgets[j_1];// Add the row spanned cells to colection for adding column before / after row spnned cells.
if(rowCell.cellFormat.rowSpan>1){rowSpannedCells.push(rowCell);}if(rowCell.columnIndex+rowCell.cellFormat.columnSpan===cellIndex){row.childWidgets.splice(rowCell.cellIndex+1,0,newCell);isCellInserted=true;}else if(cellIndex>rowCell.columnIndex&&rowCell.columnIndex+rowCell.cellFormat.columnSpan>cellIndex&&cellIndex<rowCell.columnIndex+rowCell.cellFormat.columnSpan){row.childWidgets.splice(rowCell.cellIndex,0,newCell);isCellInserted=true;}if(isCellInserted){break;}}// If the cell is not inserted for row, then check for row spanned cells.
if(!isCellInserted){if(rowSpannedCells.length>0){for(var k=0;k<rowSpannedCells.length;k++){var rowSpannedCell=rowSpannedCells[k];if(rowSpannedCell.ownerRow!==row&&row.rowIndex<=rowSpannedCell.ownerRow.rowIndex+rowSpannedCell.cellFormat.rowSpan-1){if(rowSpannedCell.columnIndex+rowSpannedCell.cellFormat.columnSpan===cellIndex){if(rowSpannedCell.cellIndex>row.childWidgets.length){row.childWidgets.push(newCell);}else{row.childWidgets.splice(rowSpannedCell.cellIndex,0,newCell);}isCellInserted=true;}else if(cellIndex>rowSpannedCell.columnIndex&&rowSpannedCell.columnIndex+rowSpannedCell.cellFormat.columnSpan>cellIndex&&cellIndex<rowSpannedCell.columnIndex+rowSpannedCell.cellFormat.columnSpan){row.childWidgets.splice(rowSpannedCell.columnIndex,0,newCell);isCellInserted=true;}}if(isCellInserted){break;}}}}}}}table.updateRowIndex(0);var parentTable=this.documentHelper.layout.getParentTable(table);if(parentTable){parentTable.fitChildToClientArea();}else{table.fitChildToClientArea();}this.selection.owner.isLayoutEnabled=true;table.isGridUpdated=false;table.buildTableColumns();table.isGridUpdated=true;this.documentHelper.skipScrollToPosition=true;this.documentHelper.layout.reLayoutTable(table);this.selection.start.setPosition(startParagraph.firstChild,true);this.selection.end.setPosition(this.selection.getLastParagraph(newCell).firstChild,false);if(this.checkIsNotRedoing()||sf.base.isNullOrUndefined(this.editorHistory)){this.reLayout(this.selection);}}};/**
     * Creates table with specified rows and columns.
     * @private
     *
     * @returns {TableWidget}
     */Editor.prototype.createTable=function(rows,columns){var startPara=this.selection.start.paragraph;var table=new TableWidget();table.tableFormat=new WTableFormat(table);table.tableFormat.preferredWidthType='Auto';table.tableFormat.leftIndent=this.selection.start.paragraph.leftIndent;table.tableFormat.initializeTableBorders();var index=0;while(index<rows){var tableRow=this.createRowAndColumn(columns,index);tableRow.rowFormat.heightType='Auto';if(this.owner.enableTrackChanges){this.insertRevision(tableRow.rowFormat,'Insertion');}tableRow.containerWidget=table;table.childWidgets.push(tableRow);index++;}return table;};Editor.prototype.createRowAndColumn=function(columns,rowIndex){var startPara=this.selection.start.paragraph;var tableRow=new TableRowWidget();tableRow.rowFormat=new WRowFormat(tableRow);tableRow.index=rowIndex;for(var i=0;i<columns;i++){var tableCell=this.createColumn(startPara);tableCell.index=i;tableCell.rowIndex=rowIndex;tableCell.containerWidget=tableRow;tableRow.childWidgets.push(tableCell);}return tableRow;};Editor.prototype.createColumn=function(paragraph){var tableCell=new TableCellWidget();var para=new ParagraphWidget();para.paragraphFormat.copyFormat(paragraph.paragraphFormat);para.paragraphFormat.leftIndent=0;para.characterFormat.copyFormat(paragraph.characterFormat);para.containerWidget=tableCell;tableCell.childWidgets.push(para);tableCell.cellFormat=new WCellFormat(tableCell);return tableCell;};Editor.prototype.getColumnCountToInsert=function(){var count=1;var start=this.selection.start;var end=this.selection.end;if(!this.selection.isForward){start=this.selection.end;end=this.selection.start;}if(start&&end&&this.selection.getTable(start,end)){if(start.paragraph.associatedCell===end.paragraph.associatedCell){return count=1;}if(start.paragraph.associatedCell.ownerRow===end.paragraph.associatedCell.ownerRow){return count=count+end.paragraph.associatedCell.cellIndex-start.paragraph.associatedCell.cellIndex;}else{count=0;var selectedCells=start.paragraph.associatedCell.ownerTable.getColumnCellsForSelection(start.paragraph.associatedCell,end.paragraph.associatedCell);for(var i=0;i<selectedCells.length;i++){if(start.paragraph.associatedCell.ownerRow===selectedCells[i].ownerRow){count++;}}}}return count===0?1:count;};Editor.prototype.getRowCountToInsert=function(){var count=1;var start=this.selection.start;var end=this.selection.end;if(!this.selection.isForward){start=this.selection.end;end=this.selection.start;}if(!sf.base.isNullOrUndefined(start)&&!sf.base.isNullOrUndefined(end)&&!sf.base.isNullOrUndefined(this.selection.getTable(start,end))){if(start.paragraph.associatedCell===end.paragraph.associatedCell||start.paragraph.associatedCell.ownerRow===end.paragraph.associatedCell.ownerRow){return count=1;}else{return count=count+this.getOwnerRow(!this.selection.isForward).rowIndex-this.getOwnerRow(this.selection.isForward).rowIndex;}}return count===0?1:count;};Editor.prototype.getOwnerCell=function(isStart){var cell=undefined;var startCell=isStart?this.selection.start.paragraph.associatedCell:this.selection.end.paragraph.associatedCell;var endCell=isStart?this.selection.end.paragraph.associatedCell:this.selection.start.paragraph.associatedCell;cell=startCell;var owner=cell.ownerTable;while(!sf.base.isNullOrUndefined(owner)&&owner.containerWidget instanceof TableCellWidget&&owner!==endCell.ownerTable){cell=owner.containerWidget;owner=cell.ownerTable;}return cell;};Editor.prototype.getOwnerRow=function(isStart){var row;var startRow=isStart?this.selection.start.paragraph.associatedCell.ownerRow:this.selection.end.paragraph.associatedCell.ownerRow;var endRow=isStart?this.selection.end.paragraph.associatedCell.ownerRow:this.selection.start.paragraph.associatedCell.ownerRow;row=startRow;var owner=row.ownerTable;while(!sf.base.isNullOrUndefined(owner)&&owner.containerWidget instanceof TableCellWidget&&owner!==endRow.ownerTable){row=owner.containerWidget.ownerRow;owner=row.ownerTable;}return row;};Editor.prototype.getOwnerTable=function(isStart){var table=undefined;var startTable=this.selection.start.paragraph.associatedCell.ownerTable;var endTable=this.selection.end.paragraph.associatedCell.ownerTable;table=isStart?startTable:endTable;while(table.containerWidget instanceof TableCellWidget&&table!==(isStart?endTable:startTable)){table=table.containerWidget.ownerTable;}return table;};/**
     * Merge Selected cells
     *
     * @private
     * @returns {void}
     */Editor.prototype.mergeSelectedCellsInTable=function(){if(!this.canMergeCells()){return;}if(this.owner.enableTrackChanges){// let localizeValue: L10n = new L10n('documenteditor', this.owner.defaultLocale);
// localizeValue.setLocale(this.owner.locale);
// this.alertDialog = DialogUtility.alert({
//     title: localizeValue.getConstant('UnTrack'),
//     content: localizeValue.getConstant('Merge Track'),
//     showCloseIcon: true,
//     okButton: {
//         text: 'Ok', click: this.confirmCellMerge.bind(this)
//     },
//     closeOnEscape: true,
//     position: { X: 'center', Y: 'center' },
//     animationSettings: { effect: 'Zoom' }
// });
}else{this.confirmCellMerge();}};Editor.prototype.confirmCellMerge=function(){if(this.checkIsNotRedoing()){this.initHistory('MergeCells');}this.selection.owner.isShiftingEnabled=true;var startPosition=this.selection.start;var endPosition=this.selection.end;if(!this.selection.isForward){startPosition=this.selection.end;endPosition=this.selection.start;}var startOwnerCell=this.getOwnerCell(this.selection.isForward);var endOwnerCell=this.getOwnerCell(!this.selection.isForward);var containerCell=this.selection.getContainerCellOf(startOwnerCell,endOwnerCell);if(containerCell.ownerTable.contains(endOwnerCell)){if(!this.selection.containsCell(containerCell,endOwnerCell)){//Start and End are in different cells.               
var table=startOwnerCell.ownerTable.combineWidget(this.owner.viewer);startOwnerCell=this.selection.getSelectedCell(startOwnerCell,containerCell);endOwnerCell=this.selection.getSelectedCell(endOwnerCell,containerCell);//Merges the selected cells.               
var mergedCell=this.mergeSelectedCells(table,startOwnerCell,endOwnerCell);var firstParagraph=this.selection.getFirstParagraph(mergedCell);startPosition.setPosition(firstParagraph.firstChild,true);var lastParagraph=this.selection.getLastParagraph(mergedCell);endPosition.setPosition(lastParagraph.lastChild,false);}}if(this.checkIsNotRedoing()||sf.base.isNullOrUndefined(this.editorHistory)){this.reLayout(this.selection,false);}// if (!isNullOrUndefined(this.alertDialog)) {
//     this.alertDialog.close();
//     this.alertDialog = undefined;
// }
};Editor.prototype.mergeSelectedCells=function(table,startCell,endCell){//Clones the entire table to preserve in history.
var clonedTable=this.cloneTableToHistoryInfo(table);this.selection.owner.isLayoutEnabled=false;//Merges the selected cells.
var start=this.selection.getCellLeft(startCell.ownerRow,startCell);var end=start+startCell.cellFormat.cellWidth;var endCellLeft=this.selection.getCellLeft(endCell.ownerRow,endCell);var endCellRight=endCellLeft+endCell.cellFormat.cellWidth;var cellInfo=this.updateSelectedCellsInTable(start,end,endCellLeft,endCellRight);start=cellInfo.start;end=cellInfo.end;var count=table.childWidgets.indexOf(endCell.ownerRow);var rowStartIndex=table.childWidgets.indexOf(startCell.ownerRow);var mergedCell=undefined;var firstBlock;for(var i=rowStartIndex;i<=count;i++){var row=table.childWidgets[i];for(var j=0;j<row.childWidgets.length;j++){var cell=row.childWidgets[j];var cellStart=this.selection.getCellLeft(row,cell);if(HelperMethods.round(start,2)<=HelperMethods.round(cellStart,2)&&HelperMethods.round(cellStart,2)<HelperMethods.round(end,2)){var lastBlock=cell.lastChild;if(lastBlock instanceof ParagraphWidget&&lastBlock.isEmpty()){cell.childWidgets.pop();}if(sf.base.isNullOrUndefined(mergedCell)){mergedCell=cell;firstBlock=lastBlock;}else{if(i===rowStartIndex){mergedCell.cellFormat.preferredWidth+=cell.cellFormat.preferredWidth;mergedCell.cellFormat.columnSpan+=cell.cellFormat.columnSpan;this.mergeBorders(mergedCell,cell);}for(var k=0;k<cell.childWidgets.length;k++){var block=cell.childWidgets[k];var newBlock=block.clone();newBlock.containerWidget=mergedCell;mergedCell.childWidgets.push(newBlock);}row.childWidgets.splice(j,1);cell.destroy();j--;}}}//To Ensure minimul content. 
if((mergedCell.childWidgets.length===0||mergedCell.childWidgets.length===1&&mergedCell.childWidgets[0]instanceof TableWidget)&&firstBlock){var newBlock=firstBlock.clone();mergedCell.childWidgets.push(newBlock);newBlock.containerWidget=mergedCell;}if(row.childWidgets.length===0){var rowIndex=table.childWidgets.indexOf(row);row.updateRowBySpannedCells();table.childWidgets.splice(rowIndex,1);row.destroy();count--;i--;}}if(!sf.base.isNullOrUndefined(mergedCell)&&rowStartIndex<count){mergedCell.cellFormat.rowSpan=count-rowStartIndex+1;}this.updateBlockIndexAfterMerge(mergedCell);table.updateRowIndex(0);table.calculateGrid();table.isGridUpdated=false;table.buildTableColumns();table.isGridUpdated=true;this.documentHelper.layout.reLayoutTable(table);//Layouts the table after merging cells.
this.selection.owner.isLayoutEnabled=true;return mergedCell;};Editor.prototype.mergeBorders=function(mergedCell,tableCell){var mergedCellborders=undefined;var cellBorders=null;if(!sf.base.isNullOrUndefined(mergedCell.cellFormat.borders)){mergedCellborders=mergedCell.cellFormat.borders;}if(!sf.base.isNullOrUndefined(tableCell.cellFormat.borders)){cellBorders=tableCell.cellFormat.borders;}if(sf.base.isNullOrUndefined(mergedCellborders)&&sf.base.isNullOrUndefined(cellBorders)){return;}if(sf.base.isNullOrUndefined(mergedCellborders)){mergedCellborders=new WBorders(mergedCell.cellFormat);mergedCellborders.copyFormat(cellBorders);}else if(sf.base.isNullOrUndefined(cellBorders)){return;}else{if(mergedCell.ownerRow.rowIndex===tableCell.ownerRow.rowIndex){mergedCellborders.top=mergedCell.getBorderBasedOnPriority(mergedCellborders.top,cellBorders.bottom);mergedCellborders.bottom=mergedCell.getBorderBasedOnPriority(mergedCellborders.bottom,cellBorders.bottom);}}};Editor.prototype.updateBlockIndexAfterMerge=function(cell){for(var i=0;i<cell.childWidgets.length;i++){cell.childWidgets[i].index=i;}};/**
     * Determines whether merge cell operation can be done.
     *
     * @returns {boolean} - Returns can merge cells.
     */Editor.prototype.canMergeCells=function(){if(this.selection.isEmpty||!this.selection.start.paragraph.isInsideTable||!this.selection.end.paragraph.isInsideTable){return false;}var startPos=this.selection.start;var endPos=this.selection.end;if(!this.selection.isForward){startPos=this.selection.end;endPos=this.selection.start;}var startCell=this.getOwnerCell(this.selection.isForward);var endCell=this.getOwnerCell(!this.selection.isForward);var containerCell=this.selection.getContainerCellOf(startCell,endCell);if(containerCell.ownerTable.contains(endCell)){if(!this.selection.containsCell(containerCell,endCell)){startCell=this.selection.getSelectedCell(startCell,containerCell);endCell=this.selection.getSelectedCell(endCell,containerCell);var rowSpan=1;if(startCell.ownerRow===endCell.ownerRow){var startCellIndex=startCell.ownerRow.childWidgets.indexOf(startCell);for(var i=startCellIndex;i<=startCell.ownerRow.childWidgets.indexOf(endCell);i++){var cell=startCell.ownerRow.childWidgets[i];var prevCell=cell.previousWidget;if(i!==startCellIndex){if(cell.cellFormat.rowSpan!==rowSpan){return false;}if(!sf.base.isNullOrUndefined(prevCell)&&cell.columnIndex!==prevCell.cellFormat.columnSpan+prevCell.columnIndex){return false;}}rowSpan=cell.cellFormat.rowSpan;}return true;}return this.canMergeSelectedCellsInTable(startCell.ownerTable,startCell,endCell);}}return false;};Editor.prototype.canMergeSelectedCellsInTable=function(table,startCell,endCell){var count=table.childWidgets.indexOf(endCell.ownerRow);var rowStartIndex=table.childWidgets.indexOf(startCell.ownerRow);var startLeft=this.selection.getCellLeft(startCell.ownerRow,startCell);var endLeft=startLeft+startCell.cellFormat.cellWidth;var endCellLeft=this.selection.getCellLeft(endCell.ownerRow,endCell);var endCellRight=endCellLeft+endCell.cellFormat.cellWidth;var cellInfo=this.updateSelectedCellsInTable(startLeft,endLeft,endCellLeft,endCellRight);startLeft=cellInfo.start;endLeft=cellInfo.end;var selectionLeft=0;var selectionRight=0;var isRowLeftWithinSel=false;var isRowRightWithinSel=false;var rowSpannedCells=[];for(var i=rowStartIndex;i<=count;i++){var row=table.childWidgets[i];var rowLeft=0;var rowRight=0;var isStarted=false;for(var j=0;j<row.childWidgets.length;j++){var cell=row.childWidgets[j];var cellStart=this.selection.getCellLeft(row,cell);if(this.checkCellWithInSelection(startLeft,endLeft,cellStart)){isRowLeftWithinSel=false;isRowRightWithinSel=false;if(cell.cellFormat.rowSpan>1){rowSpannedCells.push(cell);}if(!isStarted){rowLeft=cellStart;rowRight=cellStart;isStarted=true;}var prevCell=cell.previousWidget;if(rowRight!==0&&HelperMethods.round(rowRight,0)!==HelperMethods.round(cellStart,0)){rowRight=cellStart;}rowRight+=HelperMethods.convertPointToPixel(cell.cellFormat.cellWidth);var isPrevCellWithinSel=this.checkPrevOrNextCellIsWithinSel(startLeft,endLeft,cell,true);var isNextCellWithinSel=this.checkPrevOrNextCellIsWithinSel(startLeft,endLeft,cell,false);// When selected cell not having row spanned cells and column index is not having immediate cell index value,
// then returned false.
var isNoRowSpan=rowSpannedCells.length===0||rowSpannedCells.length===1&&rowSpannedCells[0]===cell;// checks whether current cell is with in selection.
var isCellWithInSel=this.checkCurrentCell(rowSpannedCells,cell,isPrevCellWithinSel,isNextCellWithinSel);// when last selected row not having equal row span then returned false.
if(i===count&&!sf.base.isNullOrUndefined(prevCell)&&cell.cellFormat.rowSpan>prevCell.cellFormat.rowSpan&&!isCellWithInSel){return false;}if(i!==rowStartIndex){for(var m=0;m<rowSpannedCells.length;m++){{var rowSpan=rowSpannedCells[m].ownerRow.rowIndex+rowSpannedCells[m].cellFormat.rowSpan-1;if(rowSpan>=row.rowIndex){if(rowSpannedCells[m].columnIndex>cell.columnIndex){isRowRightWithinSel=true;}else{isRowLeftWithinSel=true;}if(i===count&&rowSpannedCells[m]!==cell&&rowSpan>cell.ownerRow.rowIndex+cell.cellFormat.rowSpan-1){return false;}if(rowSpan===row.rowIndex&&!this.checkPrevOrNextCellIsWithinSel(startLeft,endLeft,cell,false)){rowSpannedCells.splice(rowSpannedCells.indexOf(rowSpannedCells[m]),1);}}}}}if(isPrevCellWithinSel&&!sf.base.isNullOrUndefined(prevCell)&&isNoRowSpan&&cell.columnIndex!==prevCell.columnIndex+1&&this.checkCellWidth(cell)){return false;}}}if(i===rowStartIndex){selectionLeft=rowLeft;selectionRight=rowRight;}else{if(rowRight>0&&rowLeft>0){if(!((isRowLeftWithinSel||Math.round(selectionLeft)===Math.round(rowLeft))&&(isRowRightWithinSel||Math.round(selectionRight)===Math.round(rowRight)))){return false;}}if(i===count){return true;}}}return false;};Editor.prototype.checkCellWidth=function(cell){var prevCell=cell.previousWidget;var cellLeft=this.documentHelper.selection.getCellLeft(cell.ownerRow,cell);var prevCellLeft=this.documentHelper.selection.getCellLeft(cell.ownerRow,prevCell);var left=prevCellLeft+HelperMethods.convertPointToPixel(prevCell.cellFormat.cellWidth);if(HelperMethods.round(left,2)!==HelperMethods.round(cellLeft,2)){return true;}return false;};Editor.prototype.checkCellWithInSelection=function(startLeft,endLeft,cellStart){if(HelperMethods.round(startLeft,2)<=HelperMethods.round(cellStart,2)&&HelperMethods.round(cellStart,2)<HelperMethods.round(endLeft,2)){return true;}return false;};Editor.prototype.checkPrevOrNextCellIsWithinSel=function(startLeft,endLeft,cell,isPrev){var prevOrNextCell=isPrev?cell.previousWidget:cell.nextWidget;var cellStart=0;if(sf.base.isNullOrUndefined(prevOrNextCell)){return false;}cellStart=this.documentHelper.selection.getCellLeft(prevOrNextCell.ownerRow,prevOrNextCell);return this.checkCellWithInSelection(startLeft,endLeft,cellStart);};Editor.prototype.checkCurrentCell=function(rowSpannedCells,cell,isPrevCellWithInSel,isNextCellWithinSel){var cellOwner=cell.ownerRow;if(rowSpannedCells.length>0){for(var i=0;i<rowSpannedCells.length;i++){var spannedCellOwner=rowSpannedCells[i].ownerRow;var rowSpan=spannedCellOwner.rowIndex+rowSpannedCells[i].cellFormat.rowSpan-1;if(rowSpannedCells[i]===cell&&(rowSpannedCells.length===1||this.checkRowSpannedCells(rowSpannedCells,cell))&&!(isNextCellWithinSel||isPrevCellWithInSel)){return true;}if(rowSpannedCells[i]!==cell&&spannedCellOwner.rowIndex<cellOwner.rowIndex&&rowSpan===cellOwner.rowIndex+cell.cellFormat.rowSpan-1){return true;}}}return false;};Editor.prototype.checkRowSpannedCells=function(rowSpannedCells,cell){for(var i=0;i<rowSpannedCells.length;i++){if(rowSpannedCells[i]!==cell&&rowSpannedCells[i].columnIndex===cell.columnIndex){return true;}}return false;};/**
     * @private
     * @returns {void}
     */Editor.prototype.insertNewParagraphWidget=function(newParagraph,insertAfter){this.updateInsertPosition();this.insertParagraph(newParagraph,insertAfter);if(!insertAfter){var nextParagraph=void 0;var currentParagraph=newParagraph;do{nextParagraph=this.selection.getNextParagraphBlock(currentParagraph);currentParagraph=nextParagraph;}while(nextParagraph&&nextParagraph.equals(newParagraph));if(!sf.base.isNullOrUndefined(nextParagraph)){this.selection.selectParagraphInternal(nextParagraph,true);}else{this.selection.selectParagraphInternal(newParagraph,true);}}this.fireContentChange();};Editor.prototype.insertParagraph=function(newParagraph,insertAfter){var lineWidget=this.selection.start.currentWidget;var offset=this.selection.start.offset;if(this.editorHistory&&this.editorHistory.isUndoing&&this.editorHistory.currentBaseHistoryInfo.action==='InsertTextParaReplace'){offset=0;}var currentParagraph=this.selection.start.paragraph;currentParagraph=currentParagraph.combineWidget(this.owner.viewer);if(insertAfter){var length_1=this.selection.getLineLength(currentParagraph.lastChild);var insertIndex_1=newParagraph.firstChild?newParagraph.firstChild.children.length:0;this.moveInlines(currentParagraph,newParagraph,insertIndex_1,offset,lineWidget,length_1,currentParagraph.lastChild);}else if(offset>0){this.moveInlines(currentParagraph,newParagraph,0,0,currentParagraph.firstChild,offset,lineWidget);}var splittedWidget=currentParagraph.getSplitWidgets();currentParagraph=insertAfter?splittedWidget[splittedWidget.length-1]:splittedWidget[0];var insertIndex=currentParagraph.containerWidget.childWidgets.indexOf(currentParagraph);if(insertAfter){insertIndex++;}var bodyWidget=currentParagraph.containerWidget;newParagraph.index=currentParagraph.index;newParagraph.containerWidget=bodyWidget;bodyWidget.childWidgets.splice(insertIndex,0,newParagraph);this.constructRevisionsForBlock(newParagraph,true);this.updateNextBlocksIndex(insertAfter?currentParagraph:newParagraph,true);newParagraph.height=0;this.documentHelper.layout.layoutBodyWidgetCollection(newParagraph.index,bodyWidget,newParagraph,false);};Editor.prototype.moveInlines=function(currentParagraph,newParagraph,insertIndex,startOffset,startLine,endOffset,endLine){if(newParagraph.childWidgets.length===0){var line=new LineWidget(newParagraph);newParagraph.childWidgets.push(line);}var isMoved=false;this.documentHelper.layout.clearListElementBox(currentParagraph);this.documentHelper.layout.clearListElementBox(newParagraph);for(var j=0;j<currentParagraph.childWidgets.length;j++){var lineWidget=currentParagraph.childWidgets[j];if(startLine===lineWidget&&endLine===lineWidget){insertIndex=this.moveContent(lineWidget,startOffset,endOffset,insertIndex,newParagraph);break;}if(endLine===lineWidget){insertIndex=this.moveContent(lineWidget,0,endOffset,insertIndex,newParagraph);break;}else if(startLine===lineWidget){isMoved=true;insertIndex=this.moveContent(lineWidget,startOffset,this.documentHelper.selection.getLineLength(lineWidget),insertIndex,newParagraph);}else if(isMoved){insertIndex=this.moveContent(lineWidget,0,this.documentHelper.selection.getLineLength(lineWidget),insertIndex,newParagraph);}}this.removeEmptyLine(currentParagraph);if(!currentParagraph.isInsideTable){this.documentHelper.layout.reLayoutParagraph(currentParagraph,0,0);}};Editor.prototype.moveContent=function(lineWidget,startOffset,endOffset,insertIndex,paragraph){var count=0;//let lineIndex: number = lineWidget.paragraph.childWidgets.indexOf(lineWidget);
for(var i=0;i<lineWidget.children.length;i++){var inline=lineWidget.children[i];if(startOffset>=count+inline.length||inline instanceof ListTextElementBox){if(!(inline instanceof ListTextElementBox)){count+=inline.length;}continue;}var startIndex=0;if(startOffset>count){startIndex=startOffset-count;}var endIndex=endOffset-count;if(endIndex>inline.length){endIndex=inline.length;}if(startIndex>0){count+=startIndex;}if(startIndex===0&&endIndex===inline.length){if(inline instanceof ShapeElementBox){var shapeIndex=lineWidget.paragraph.floatingElements.indexOf(inline);if(shapeIndex!==-1){lineWidget.paragraph.floatingElements.splice(shapeIndex,1);}}paragraph.firstChild.children.splice(insertIndex,0,inline);inline.line=paragraph.firstChild;insertIndex++;// if (editAction < 4) {
// this.unLinkFieldCharacter(inline);
lineWidget.children.splice(i,1);i--;// }
}else if(inline instanceof TextElementBox){// if (editAction < 4) {
var span=new TextElementBox();span.characterFormat.copyFormat(inline.characterFormat);span.text=inline.text.substr(startIndex,endIndex-startIndex);inline.ischangeDetected=true;span.ischangeDetected=true;paragraph.firstChild.children.splice(insertIndex,0,span);span.line=paragraph.firstChild;insertIndex++;this.updateRevisionForMovedContent(inline,span);inline.text=inline.text.slice(0,startIndex)+inline.text.slice(endIndex);inline.ischangeDetected=true;}if(endOffset<=count+endIndex-startIndex){break;}count+=endIndex-startIndex;}return insertIndex;};Editor.prototype.updateRevisionForMovedContent=function(inline,tempSpan){for(var i=0;i<inline.revisions.length;i++){var currentRevision=inline.revisions[i];var rangeIndex=currentRevision.range.indexOf(inline);tempSpan.revisions.splice(0,0,currentRevision);currentRevision.range.splice(rangeIndex,0,tempSpan);}};/**
     * update complex changes when history is not preserved
     *
     * @param {number} action - Specifies the action
     * @param {string} start - Specifies the selection start
     * @param {string} end - Specified the selection end
     * @private
     * @returns {void}
     */Editor.prototype.updateComplexWithoutHistory=function(action,start,end){var selection=this.documentHelper.selection;if(action===0){var startPosition=new TextPosition(selection.owner);this.setPositionForCurrentIndex(startPosition,start);this.documentHelper.layout.reLayoutParagraph(startPosition.paragraph,0,0);this.setPositionForCurrentIndex(selection.start,end);this.setPositionForCurrentIndex(selection.end,end);}if(action===1){var startPosition=new TextPosition(selection.owner);this.setPositionForCurrentIndex(startPosition,start);var endPosition=new TextPosition(selection.owner);this.setPositionForCurrentIndex(endPosition,end);this.documentHelper.layout.reLayoutParagraph(startPosition.paragraph,0,0);if(endPosition.paragraph!==startPosition.paragraph){this.documentHelper.layout.reLayoutParagraph(endPosition.paragraph,0,0);}}if(selection.owner.isShiftingEnabled){this.documentHelper.layout.shiftLayoutedItems(false);if(this.documentHelper.owner.enableHeaderAndFooter){this.updateHeaderFooterWidget();}}selection.owner.isShiftingEnabled=false;selection.start.updatePhysicalPosition(true);if(selection.isEmpty){selection.end.setPositionInternal(selection.start);}else{selection.end.updatePhysicalPosition(true);}selection.upDownSelectionLength=selection.end.location.x;selection.fireSelectionChanged(true);this.documentHelper.updateFocus();this.owner.viewer.updateScrollBars();this.fireContentChange();this.isHandledComplex=true;};/**
     * Re-layout content.
     *
     * @param {Selection} selection - Specifies the selection
     * @param isSelectionChanged - Specifies the selection changed
     * @private
     * @returns {void}
     */Editor.prototype.reLayout=function(selection,isSelectionChanged){if(!sf.base.isNullOrUndefined(this.previousBlockToLayout)){// Layout content for previous page to fix content based on KeepWithNext format.
var previousBlock=this.previousBlockToLayout;this.documentHelper.layout.layoutBodyWidgetCollection(previousBlock.index,previousBlock.bodyWidget,previousBlock,false,false);this.previousBlockToLayout=undefined;}if(!this.documentHelper.isComposingIME&&this.editorHistory&&this.editorHistory.isHandledComplexHistory()){if(this.editorHistory.currentHistoryInfo&&this.editorHistory.currentHistoryInfo.action!=='ClearFormat'){if(this.editorHistory.currentHistoryInfo.action!=='ApplyStyle'){this.startParagraph=undefined;this.endParagraph=undefined;}}this.isHandledComplex=false;return;}if(sf.base.isNullOrUndefined(this.documentHelper.blockToShift)){this.documentHelper.removeEmptyPages();this.documentHelper.layout.updateFieldElements();/*  if (!isNullOrUndefined(selection.start.paragraph.bodyWidget.page.footnoteWidget)) {
                  let foot: FootNoteWidget = selection.start.paragraph.bodyWidget.page.footnoteWidget;
                  //this.documentHelper.layout.layoutfootNote(foot);
              }
              if (!isNullOrUndefined(selection.start.paragraph.bodyWidget.page.endnoteWidget)) {
                  let foot: FootNoteWidget = selection.start.paragraph.bodyWidget.page.endnoteWidget;
                  //this.documentHelper.layout.layoutfootNote(foot);
              }*/this.owner.viewer.updateScrollBars();if(!selection.owner.isShiftingEnabled){selection.fireSelectionChanged(true);this.startParagraph=undefined;this.endParagraph=undefined;}}if(sf.base.isNullOrUndefined(isSelectionChanged)){isSelectionChanged=selection.isEmpty;}if(this.owner.showRevisions){this.owner.trackChangesPane.updateTrackChanges();}if(selection.owner.isShiftingEnabled){selection.owner.isShiftingEnabled=false;selection.owner.isLayoutEnabled=true;this.documentHelper.layout.shiftLayoutedItems(true);if(this.documentHelper.owner.enableHeaderAndFooter){this.updateHeaderFooterWidget();}if(!sf.base.isNullOrUndefined(selection.start.paragraph)){if(selection.start.paragraph.containerWidget instanceof FootNoteWidget){if(selection.start.paragraph.containerWidget.footNoteType==='Footnote'){this.documentHelper.layout.isRelayoutFootnote=true;this.shiftFootnotePageContent(selection.start.paragraph.containerWidget);}else{this.documentHelper.layout.isRelayoutFootnote=false;this.shiftFootnotePageContent();}}}this.getOffsetValue(selection);selection.upDownSelectionLength=selection.end.location.x;selection.fireSelectionChanged(true);this.documentHelper.updateFocus();this.startParagraph=undefined;this.endParagraph=undefined;this.documentHelper.layout.allowLayout=true;}if(this.editorHistory&&this.editorHistory.currentBaseHistoryInfo&&(this.editorHistory.currentBaseHistoryInfo.action!=='RowResizing'&&this.editorHistory.currentBaseHistoryInfo.action!=='CellResizing'||this.editorHistory.isUndoing||this.editorHistory.isRedoing)){if(this.editorHistory.currentBaseHistoryInfo.modifiedProperties.length>0){this.editorHistory.currentBaseHistoryInfo.updateSelection();}if(!(this.editorHistory.undoStack&&this.editorHistory.undoStack.length>0&&this.editorHistory.undoStack[this.editorHistory.undoStack.length-1]instanceof HistoryInfo&&this.editorHistory.undoStack[this.editorHistory.undoStack.length-1].modifiedActions&&this.editorHistory.undoStack[this.editorHistory.undoStack.length-1].modifiedActions[this.editorHistory.undoStack[this.editorHistory.undoStack.length-1].modifiedActions.length-1]===this.editorHistory.currentBaseHistoryInfo)){this.editorHistory.updateHistory();}else{this.editorHistory.currentBaseHistoryInfo=undefined;}}this.fireContentChange();// if (this.owner.enableLockAndEdit) {
//     // Editable region border get updated in content changes event.
//     // So, handled rerendering content after applying border.
//     this.owner.viewer.updateScrollBars();
// }
this.owner.documentHelper.layout.isRelayout=false;};/**
     * @private
     * @returns {void}
     */Editor.prototype.updateHeaderFooterWidget=function(headerFooterWidget){if(sf.base.isNullOrUndefined(headerFooterWidget)){headerFooterWidget=this.selection.start.paragraph.bodyWidget;}this.updateHeaderFooterWidgetToPage(headerFooterWidget);this.shiftPageContent(headerFooterWidget.headerFooterType,headerFooterWidget.sectionFormat);};Editor.prototype.updateHeaderFooterWidgetToPage=function(node){var currentPage=node.page;node=this.documentHelper.layout.updateHeaderFooterToParent(node);var isEvenPage=node.headerFooterType==='EvenHeader'||node.headerFooterType==='EvenFooter';for(var i=0;i<this.documentHelper.pages.length;i++){var page=this.documentHelper.pages[i];if(i+1===1&&page.bodyWidgets[0].sectionFormat.differentFirstPage&&node.headerFooterType.indexOf('FirstPage')!==-1){return;}if(page.index===0&&page.bodyWidgets[0].sectionFormat.differentFirstPage&&node.headerFooterType.indexOf('FirstPage')===-1){continue;}if(currentPage!==page){if(page.bodyWidgets[0].sectionFormat.differentOddAndEvenPages){if(isEvenPage&&(i+1)%2===0){this.updateHeaderFooterWidgetToPageInternal(page,node,node.headerFooterType.indexOf('Header')!==-1);}else if(!isEvenPage&&(i+1)%2!==0){if(i>0||!page.bodyWidgets[0].sectionFormat.differentFirstPage){this.updateHeaderFooterWidgetToPageInternal(page,node,node.headerFooterType.indexOf('Header')!==-1);}}}else{this.updateHeaderFooterWidgetToPageInternal(page,node,node.headerFooterType.indexOf('Header')!==-1);}}}};Editor.prototype.updateHeaderFooterWidgetToPageInternal=function(page,widget,isHeader){if(widget.page!==page){var hfWidget=widget.clone();hfWidget.page=page;this.owner.viewer.updateHFClientArea(hfWidget.sectionFormat,isHeader);hfWidget=this.documentHelper.layout.layoutHeaderFooterItems(this.owner.viewer,hfWidget);var headerOrFooter=void 0;if(isHeader){headerOrFooter=page.headerWidget;page.headerWidget=hfWidget;}else{headerOrFooter=page.footerWidget;page.footerWidget=hfWidget;}this.removeFieldInWidget(headerOrFooter);this.removeFieldInWidget(headerOrFooter,undefined,true);headerOrFooter.destroy();}};/**
     * @private
     * @returns {void}
     */Editor.prototype.removeFieldInWidget=function(widget,isBookmark,isContentControl){if(sf.base.isNullOrUndefined(isBookmark)){isBookmark=false;}for(var i=0;i<widget.childWidgets.length;i++){this.removeFieldInBlock(widget.childWidgets[i],isBookmark,isContentControl);}};Editor.prototype.removeFieldInBlock=function(block,isBookmark,isContentControl){if(block instanceof TableWidget){if(block.wrapTextAround&&!sf.base.isNullOrUndefined(block.bodyWidget)){var index=block.bodyWidget.floatingElements.indexOf(block);if(index!==-1){block.bodyWidget.floatingElements.splice(index,1);}}this.removeFieldTable(block,isBookmark,isContentControl);}else{this.removeField(block,isBookmark,isContentControl);}};Editor.prototype.removeFieldTable=function(table,isBookmark,isContentControl){for(var i=0;i<table.childWidgets.length;i++){var row=table.childWidgets[i];for(var j=0;j<row.childWidgets.length;j++){this.removeFieldInWidget(row.childWidgets[j],isBookmark,isContentControl);}}};Editor.prototype.shiftFootnotePageContent=function(foot){var section=this.documentHelper.pages[0].bodyWidgets[0];if(!sf.base.isNullOrUndefined(foot)){var index=this.documentHelper.pages.indexOf(foot.page);section=this.documentHelper.pages[index].bodyWidgets[0];}if(!sf.base.isNullOrUndefined(section.page.footnoteWidget)){this.checkAndShiftFromBottom(section.page,section.page.footnoteWidget);}if(!sf.base.isNullOrUndefined(section.page.endnoteWidget)){//this.checkAndShiftFromBottom(section.page, section.page.endnoteWidget);
}if(this.documentHelper.blockToShift){this.documentHelper.renderedLists.clear();this.documentHelper.renderedLevelOverrides=[];this.documentHelper.layout.shiftLayoutedItems(false);}};/**
     * @private
     * @returns {void}
     */Editor.prototype.shiftPageContent=function(type,sectionFormat){// let type: HeaderFooterType = headerFooter.headerFooterType;
var pageIndex;if(type.indexOf('First')!==-1){pageIndex=0;}else if(sectionFormat.differentOddAndEvenPages){var isEven=type.indexOf('Even')!==-1;if(sectionFormat.differentFirstPage){pageIndex=isEven?1:2;}else{pageIndex=!isEven?0:1;}}else{pageIndex=sectionFormat.differentFirstPage?1:0;if(pageIndex===1&&this.documentHelper.pages.length===1){pageIndex=0;}}var section=this.documentHelper.pages[pageIndex].bodyWidgets[0];do{if(type.indexOf('Header')!==-1){var widget=section.page.headerWidget;var isNotEmpty=!widget.isEmpty||widget.isEmpty&&this.owner.enableHeaderAndFooter;var firstBlock=section.firstChild;var top_1=HelperMethods.convertPointToPixel(sectionFormat.topMargin);var headerDistance=HelperMethods.convertPointToPixel(sectionFormat.headerDistance);if(isNotEmpty){top_1=Math.max(headerDistance+section.page.headerWidget.height,top_1);}if(firstBlock.y!==top_1){this.owner.viewer.updateClientArea(section.sectionFormat,section.page);firstBlock=firstBlock.combineWidget(this.owner.viewer);var prevWidget=firstBlock.previousRenderedWidget;if(prevWidget){if(firstBlock.containerWidget.equals(prevWidget.containerWidget)){this.owner.viewer.cutFromTop(prevWidget.y+prevWidget.height);this.documentHelper.layout.updateContainerWidget(firstBlock,prevWidget.containerWidget,prevWidget.indexInOwner+1,false);}}this.documentHelper.blockToShift=firstBlock;}}else{this.checkAndShiftFromBottom(section.page,section.page.footerWidget);}if(this.documentHelper.blockToShift){this.documentHelper.renderedLists.clear();this.documentHelper.renderedLevelOverrides=[];this.documentHelper.layout.shiftLayoutedItems(false);}while(section){var splittedSection=section.getSplitWidgets();section=splittedSection[splittedSection.length-1].nextRenderedWidget;if(section){if(pageIndex===0){break;}else{if(section.page.index+1%2===0&&pageIndex===1||section.page.index+1%2!==0&&pageIndex===2){break;}var nextPage=section.page.nextPage;if(!sf.base.isNullOrUndefined(nextPage)&&nextPage.bodyWidgets[0].equals(section)){section=nextPage.bodyWidgets[0];break;}}}}}while(section);};Editor.prototype.checkAndShiftFromBottom=function(page,footerWidget){var bodyWidget=page.bodyWidgets[0];var blockToShift;for(var i=0;i<bodyWidget.childWidgets.length;i++){var block=bodyWidget.childWidgets[i];if(block.y+block.height>footerWidget.y){blockToShift=block;break;}if(bodyWidget.childWidgets.length-1===i&&block.y+block.height<footerWidget.y){blockToShift=block;break;}}this.owner.viewer.updateClientArea(bodyWidget.sectionFormat,page,true);this.owner.viewer.cutFromTop(blockToShift.y);this.documentHelper.blockToShift=blockToShift;};Editor.prototype.allowFormattingInFormFields=function(property){if(this.documentHelper.protectionType==='FormFieldsOnly'&&this.selection.isInlineFormFillMode()&&!sf.base.isNullOrUndefined(this.owner.documentEditorSettings.formFieldSettings.formattingExceptions)){for(var j=0;j<this.owner.documentEditorSettings.formFieldSettings.formattingExceptions.length;j++){if(property.toLowerCase()===this.owner.documentEditorSettings.formFieldSettings.formattingExceptions[j].toLowerCase()){return true;}}}return false;};Editor.prototype.getContentControl=function(){for(var i=0;i<this.documentHelper.contentControlCollection.length;i++){var contentControlStart=this.documentHelper.contentControlCollection[i];var position=this.selection.getPosition(contentControlStart);var cCstart=position.startPosition;var cCend=position.endPosition;var start=this.selection.start;var end=this.selection.end;if(!this.selection.isForward){start=this.selection.end;end=this.selection.start;}if((start.isExistAfter(cCstart)||start.isAtSamePosition(cCstart))&&(end.isExistBefore(cCend)||end.isAtSamePosition(cCend))){return contentControlStart;}}return undefined;};Editor.prototype.checkPlainTextContentControl=function(){var start=this.selection.start;var end=this.selection.end;if(!this.selection.isForward){end=this.selection.start;start=this.selection.end;}var startIndex=0;var endIndex=0;var startInline=start.currentWidget.getInline(start.offset,startIndex);var endInline=end.currentWidget.getInline(end.offset,endIndex);startIndex=startInline.index;endIndex=endInline.index;var startInlineEle=startInline.element;var endInlineEle=endInline.element;var startPosition;var endPosition;if(startInlineEle&&startInlineEle.contentControlProperties&&startInlineEle.contentControlProperties.type==='Text'||endInlineEle&&endInlineEle.contentControlProperties&&endInlineEle.contentControlProperties.type==='Text'){startInlineEle=this.getContentControl();if(startInlineEle.contentControlProperties&&!sf.base.isNullOrUndefined(startInlineEle)){var offset=startInlineEle.line.getOffset(startInlineEle,1);startPosition=new TextPosition(this.owner);startPosition.setPositionParagraph(startInlineEle.line,offset);}else{startPosition=start;}if(endInlineEle.contentControlProperties&&startInlineEle.reference){endInlineEle=startInlineEle.reference;var endoffset=endInlineEle.line.getOffset(endInlineEle,endInlineEle.length);endPosition=new TextPosition(this.owner);endPosition.setPositionParagraph(endInlineEle.line,endoffset);}else{endPosition=end;}this.selection.selectRange(startPosition,endPosition);}else if(start.paragraph.contentControlProperties&&start.paragraph.contentControlProperties.type==='Text'){this.selection.selectParagraph();}};//Paste Implementation ends
//Character Format apply implementation starts
/**
     * Applies character format for selection.
     *
     * @param {string} property - Specifies the property
     * @param {Object} value - Specifies the value
     * @param {boolean} update - Spcifies the update
     * @private
     * @returns {void}
     */Editor.prototype.onApplyCharacterFormat=function(property,value,update){var allowFormatting=this.documentHelper.isFormFillProtectedMode&&this.documentHelper.selection.isInlineFormFillMode()&&this.allowFormattingInFormFields(property);if(this.restrictFormatting&&!allowFormatting||this.selection.checkContentControlLocked(true)){return;}this.documentHelper.layout.isBidiReLayout=true;var selection=this.documentHelper.selection;if(selection.owner.isReadOnlyMode&&!allowFormatting||!selection.owner.isDocumentLoaded){return;}update=sf.base.isNullOrUndefined(update)?false:update;var action=property[0].toUpperCase()+property.slice(1);var paragraph=selection.start.paragraph;var lastLine=paragraph.childWidgets[paragraph.childWidgets.length-1];this.checkPlainTextContentControl();if(selection.isEmpty&&selection.contextType!=='List'){selection.skipFormatRetrieval=true;if(selection.end.isAtParagraphEnd){this.initHistory(action);this.documentHelper.owner.isShiftingEnabled=true;this.applyCharFormatValue(paragraph.characterFormat,property,value,update);this.reLayout(this.documentHelper.selection);this.documentHelper.updateFocus();}else{selection.fireSelectionChanged(true);}selection.skipFormatRetrieval=false;return;}//Skip consider highlightcolor if paragraph mark alone is selected similar to Microsoft Word behaviour
if(property==='highlightColor'&&selection.start.isInSameParagraph(selection.end)){var start=selection.start;var end=selection.end;if(!this.selection.isForward){end=selection.start;start=selection.end;}if(end.offset===selection.getLineLength(end.currentWidget)+1&&end.offset-1===start.offset){return;}}this.setOffsetValue(selection);this.initHistory(action);// Todo: Complete Microsoft Word behavior on apply formatting in empty selection
// if (selection.isEmpty) {
//     this.documentHelper.owner.isShiftingEnabled = true;
//     this.applyCharFormatValue(paragraph.characterFormat, property, value, update);
//     this.reLayout(this.documentHelper.selection);
//     this.documentHelper.updateFocus();
//     return;
// }
if(selection.contextType==='List'){// this.updateCharacterFormatForListText(selection, action, value, update);
this.applyCharacterFormatForListText(selection,property,value,update);}else{//Iterate and update format.
this.updateSelectionCharacterFormatting(property,value,update);}this.documentHelper.layout.isBidiReLayout=false;};Editor.prototype.applyCharacterFormatForListText=function(selection,property,values,update){var listLevel=selection.getListLevel(selection.start.paragraph);if(sf.base.isNullOrUndefined(listLevel)){return;}var characterFormat=listLevel.characterFormat;switch(property){case'bold':this.applyListCharacterFormatByValue(selection,characterFormat,'bold',!characterFormat.bold);break;case'italic':this.applyListCharacterFormatByValue(selection,characterFormat,'italic',!characterFormat.italic);break;case'fontColor':this.applyListCharacterFormatByValue(selection,characterFormat,'fontColor',values);break;case'fontFamily':this.applyListCharacterFormatByValue(selection,characterFormat,'fontFamily',values);break;case'fontSize':this.applyListCharacterFormatByValue(selection,characterFormat,'fontSize',values);break;case'highlightColor':this.applyListCharacterFormatByValue(selection,characterFormat,'highlightColor',values);break;case'baselineAlignment':if(characterFormat.baselineAlignment===values){values='Normal';}this.applyListCharacterFormatByValue(selection,characterFormat,'baselineAlignment',values);break;case'strikethrough':if(characterFormat.strikethrough===values){values='None';}this.applyListCharacterFormatByValue(selection,characterFormat,'strikethrough',values);break;case'underline':if(characterFormat.underline===values){values='None';}this.applyListCharacterFormatByValue(selection,characterFormat,'underline',values);break;case'characterFormat':this.applyListCharacterFormatByValue(selection,characterFormat,undefined,values);break;}};Editor.prototype.applyListCharacterFormatByValue=function(selection,format,property,value){this.initHistory('ListCharacterFormat');this.applyCharFormatValue(format,property,value,false);this.editorHistory.updateHistory();this.reLayout(selection);this.fireContentChange();};/**
     * @private
     * @returns {void}
     */Editor.prototype.updateListCharacterFormat=function(selection,property,value){this.updateListTextSelRange(selection,property,value,false);};Editor.prototype.updateListTextSelRange=function(selection,property,value,update){this.documentHelper.owner.isShiftingEnabled=true;var startPositionInternal=selection.start;var endPositionInternal=selection.end;if(!selection.isForward){startPositionInternal=selection.end;endPositionInternal=selection.start;}this.initHistoryPosition(selection,startPositionInternal);var listLevel=selection.getListLevel(selection.start.paragraph);this.applyCharFormatValue(listLevel.characterFormat,property,value,update);this.startSelectionReLayouting(startPositionInternal.paragraph,selection,startPositionInternal,endPositionInternal);};/**
     * @private
     * @returns {void}
     */Editor.prototype.updateInsertPosition=function(){var selection=this.documentHelper.selection;var position=selection.start;if(!selection.isForward){position=selection.end;}if(this.editorHistory&&!sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo)&&!sf.base.isNullOrUndefined(position)){if(sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo.insertPosition)){this.updateHistoryPosition(position,true);}}};/**
     * Preserve paragraph and offset value for selection
     *
     * @private
     * @returns {void}
     */Editor.prototype.setOffsetValue=function(selection){var info=this.selection.getParagraphInfo(selection.start);this.startParagraph=info.paragraph;this.startOffset=info.offset;info=this.selection.getParagraphInfo(selection.end);this.endParagraph=info.paragraph;this.endOffset=info.offset;};/**
     * Toggles the highlight color property of selected contents.
     *
     * @param {HighlightColor} highlightColor Default value of underline parameter is Yellow.
     * @returns {void}
     */Editor.prototype.toggleHighlightColor=function(highlightColor){var selection=this.documentHelper.selection;if(sf.base.isNullOrUndefined(highlightColor)||highlightColor==='NoColor'){highlightColor='Yellow';}//In Ms Word the highlight color is took from the ribbon. So we Have given yellow as constant.
if(selection.characterFormat.highlightColor===highlightColor){highlightColor='NoColor';}this.selection.characterFormat.highlightColor=highlightColor;};/**
     * Toggles the subscript formatting of selected contents.
     *
     * @returns {void}
     */Editor.prototype.toggleSubscript=function(){if(this.owner.isReadOnlyMode||this.restrictFormatting){return;}var value=this.selection.characterFormat.baselineAlignment==='Subscript'?'Normal':'Subscript';this.selection.characterFormat.baselineAlignment=value;};/**
     * Toggles the superscript formatting of selected contents.
     *
     * @returns {void}
     */Editor.prototype.toggleSuperscript=function(){if(this.owner.isReadOnlyMode||this.restrictFormatting){return;}var value=this.selection.characterFormat.baselineAlignment==='Superscript'?'Normal':'Superscript';this.selection.characterFormat.baselineAlignment=value;};/**
     * Increases the left indent of selected paragraphs to a factor of 36 points.
     *
     * @returns {void}
     */Editor.prototype.increaseIndent=function(){if(!this.owner.isReadOnlyMode||this.selection.isInlineFormFillMode()){this.onApplyParagraphFormat('leftIndent',this.documentHelper.defaultTabWidth,true,false);}};/**
     * Decreases the left indent of selected paragraphs to a factor of 36 points.
     *
     * @returns {void}
     */Editor.prototype.decreaseIndent=function(){if(!this.owner.isReadOnlyMode||this.selection.isInlineFormFillMode()){this.onApplyParagraphFormat('leftIndent',-this.documentHelper.defaultTabWidth,true,false);}};/**
     * Clears the list format for selected paragraphs.
     *
     * @returns {void}
     */Editor.prototype.clearList=function(){this.selection.owner.editorModule.onApplyList(undefined);};/**
     * Applies the bullet list to selected paragraphs.
     *
     * @param {string} bullet Bullet character
     * @param {string} fontFamily Bullet font family
     * @returns {void}
     */Editor.prototype.applyBullet=function(bullet,fontFamily){if(!this.owner.isReadOnlyMode||this.selection.isInlineFormFillMode()){this.applyBulletOrNumbering(bullet,'Bullet',fontFamily);}};/**
     * Applies the numbering list to selected paragraphs.
     *
     * @param {string} numberFormat  %n representations in numberFormat parameter will be replaced by respective list levels value.
     * `%1) will be displayed as 1) `
     * @param {ListLevelPattern} listLevelPattern  Default value of listLevelPattern parameter is ListLevelPattern.Arabic
     * @returns {void}
     */Editor.prototype.applyNumbering=function(numberFormat,listLevelPattern){if(!this.owner.isReadOnlyMode||this.selection.isInlineFormFillMode()){this.applyBulletOrNumbering(numberFormat,listLevelPattern,'Verdana');}};/**
     * Toggles the baseline alignment property of selected contents.
     *
     * @param {BaselineAlignment} baseAlignment Specifies the baseline alignment
     * @returns {void}
     */Editor.prototype.toggleBaselineAlignment=function(baseAlignment){this.updateProperty(2,baseAlignment);};/**
     * Clears the formatting.
     *
     * @returns {void}
     */Editor.prototype.clearFormatting=function(){var selection=this.documentHelper.selection;this.setPreviousBlockToLayout();this.initComplexHistory('ClearFormat');// let startIndex: string = selection.start.getHierarchicalIndexInternal();
// let endIndex: string = selection.end.getHierarchicalIndexInternal();
if(selection.isEmpty){selection.start.moveToParagraphStartInternal(selection,false);selection.end.moveToParagraphEndInternal(selection,false);}this.setOffsetValue(selection);if(this.editorHistory){this.editorHistory.initializeHistory('ClearCharacterFormat');}this.updateSelectionCharacterFormatting('ClearCharacterFormat',undefined,false);this.getOffsetValue(selection);if(this.editorHistory){this.editorHistory.updateHistory();}this.setOffsetValue(selection);if(this.editorHistory){this.editorHistory.initializeHistory('ClearParagraphFormat');}this.updateParagraphFormatInternal('ClearParagraphFormat',undefined,false);if(this.editorHistory){this.editorHistory.updateHistory();}this.getOffsetValue(selection);if(this.editorHistory&&!sf.base.isNullOrUndefined(this.editorHistory.currentHistoryInfo)){this.editorHistory.updateComplexHistory();}this.startParagraph=undefined;this.endParagraph=undefined;// else {
//     this.checkAndUpdatedSelection(startIndex, endIndex);
// }
};Editor.prototype.updateProperty=function(type,value){var selection=this.selection;if((this.owner.isReadOnlyMode||this.restrictFormatting)&&!this.selection.isInlineFormFillMode()||!selection.owner.isDocumentLoaded){return;}var startPosition=selection.start;var endPosition=selection.end;if(!selection.isForward){startPosition=selection.end;endPosition=selection.start;}var indexInInline=0;var inlineObj=startPosition.currentWidget.getInline(startPosition.offset,indexInInline);var inline=inlineObj.element;indexInInline=inlineObj.index;var paragraph=startPosition.paragraph;if(!sf.base.isNullOrUndefined(inline)&&inline.length===indexInInline&&!this.selection.isEmpty){inline=inline.nextNode;}if(type===1){var currentUnderline='None';if(!sf.base.isNullOrUndefined(inline)){currentUnderline=inline.characterFormat.underline;}else if(!sf.base.isNullOrUndefined(paragraph)){currentUnderline=paragraph.characterFormat.underline;}this.selection.characterFormat.underline=value===currentUnderline?'None':value;}else{var script='Normal';if(!sf.base.isNullOrUndefined(inline)){script=inline.characterFormat.baselineAlignment;}else if(!sf.base.isNullOrUndefined(paragraph)){script=paragraph.characterFormat.baselineAlignment;}if(script===value){value='Normal';}this.selection.characterFormat.baselineAlignment=value;}};Editor.prototype.getCompleteStyles=function(){var completeStylesString='{"styles":[';for(var _i=0,_a=this.documentHelper.preDefinedStyles.keys;_i<_a.length;_i++){var name_1=_a[_i];completeStylesString+=this.documentHelper.preDefinedStyles.get(name_1)+',';}return completeStylesString.slice(0,-1)+']}';};/**
     * Initialize default styles
     *
     * @private
     * @returns {void}
     */Editor.prototype.intializeDefaultStyles=function(){var existingStyles=this.owner.getStyleNames('Paragraph');var defaultStyleNames=['Normal','Heading 1','Heading 2','Heading 3','Heading 4','Heading 5','Heading 6'];var styleNames=defaultStyleNames.filter(function(val){return existingStyles.indexOf(val)===-1;});for(var _i=0,styleNames_1=styleNames;_i<styleNames_1.length;_i++){var name_2=styleNames_1[_i];this.createStyle(this.documentHelper.preDefinedStyles.get(name_2));}};/**
     * Creates a new instance of Style.
     *
     * @returns {void}
     */Editor.prototype.createStyle=function(styleString){this.createStyleIn(styleString);};/**
     * Create a Style.
     * @private
     * @returns {object}
     */Editor.prototype.createStyleIn=function(styleString){/* eslint-disable @typescript-eslint/no-explicit-any */var style=JSON.parse(styleString);var styleObj=this.documentHelper.styles.findByName(style.name);if(styleObj!==undefined){//Create a new style with new name and add it to collection.
style.name=this.getUniqueStyleName(style.name);}this.documentHelper.owner.parser.parseStyle(JSON.parse(this.getCompleteStyles()),style,this.documentHelper.styles);return this.documentHelper.styles.findByName(style.name);};Editor.prototype.getUniqueStyleName=function(name){var uniqueName=this.getUniqueName(name);var style=this.documentHelper.styles.findByName(uniqueName);while(!sf.base.isNullOrUndefined(style)){uniqueName=this.getUniqueStyleName(style.name);style=this.documentHelper.styles.findByName(uniqueName);}return uniqueName;};Editor.prototype.getUniqueName=function(name){var matchArray=name.match(/\d+$/);if(!sf.base.isNullOrUndefined(matchArray)&&matchArray.length>0){return name.replace(matchArray[0],(parseInt(matchArray[0],10)+1).toString());}else{return name+'_1';}};/**
     * Update Character format for selection
     * @private
     */Editor.prototype.updateSelectionCharacterFormatting=function(property,values,update){if(sf.base.isNullOrUndefined(property)){property='CharacterFormat';}switch(property){case'bold':this.updateCharacterFormat('bold',values);break;case'italic':this.updateCharacterFormat('italic',values);break;case'fontColor':this.updateCharacterFormat('fontColor',values);break;case'fontFamily':this.updateCharacterFormat('fontFamily',values);break;case'fontSize':this.documentHelper.layout.isBidiReLayout=false;this.updateCharacterFormatWithUpdate(this.documentHelper.selection,'fontSize',values,update);break;case'highlightColor':this.updateCharacterFormat('highlightColor',values);break;case'baselineAlignment':this.updateCharacterFormat('baselineAlignment',values);break;case'strikethrough':this.updateCharacterFormat('strikethrough',values);break;case'underline':this.updateCharacterFormat('underline',values);break;case'styleName':this.updateCharacterFormatWithUpdate(this.documentHelper.selection,'styleName',values,true);break;case'CharacterFormat':this.updateCharacterFormat(undefined,values);break;case'ClearCharacterFormat':this.updateCharacterFormat(undefined,values);break;case'allCaps':this.updateCharacterFormat('allCaps',values);break;}this.reLayout(this.documentHelper.selection);};Editor.prototype.updateCharacterFormat=function(property,value){this.updateCharacterFormatWithUpdate(this.documentHelper.selection,property,value,false);};Editor.prototype.updateCharacterFormatWithUpdate=function(selection,property,value,update){this.documentHelper.owner.isShiftingEnabled=true;var startPosition=selection.start;var endPosition=selection.end;if(!selection.isForward){startPosition=selection.end;endPosition=selection.start;}this.applyCharFormatSelectedContent(startPosition.paragraph,selection,startPosition,endPosition,property,value,update);};Editor.prototype.applyCharFormatSelectedContent=function(paragraph,selection,start,end,property,value,update){//Selection start in cell.
if(start.paragraph.isInsideTable&&(!end.paragraph.isInsideTable||start.paragraph.associatedCell!==end.paragraph.associatedCell||selection.isCellSelected(start.paragraph.associatedCell,start,end))){var cell=void 0;start.paragraph.associatedCell.ownerTable.combineWidget(this.owner.viewer);if(this.checkInsertPosition(selection)){this.updateHistoryPosition(start,true);}cell=start.paragraph.associatedCell;this.applyCharFormatCell(cell,selection,start,end,property,value,update);var table=cell.ownerTable;this.documentHelper.layout.layoutBodyWidgetCollection(table.index,table.containerWidget,table,false);}else{this.applyCharFormat(paragraph,selection,start,end,property,value,update);}};Editor.prototype.applyCharFormatForSelectedPara=function(paragraph,selection,property,value,update){for(var i=0;i<paragraph.childWidgets.length;i++){var line=paragraph.childWidgets[i];for(var j=0;j<line.children.length;j++){var element=line.children[j];this.applyCharFormatValue(element.characterFormat,property,value,update);}}this.applyCharFormatValue(paragraph.characterFormat,property,value,update);};Editor.prototype.splittedLastParagraph=function(paragraph){var splittedWidets=paragraph.getSplitWidgets();return splittedWidets[splittedWidets.length-1];};Editor.prototype.getNextParagraphForCharacterFormatting=function(block,start,end,property,value,update){var widgetCollection=block.getSplitWidgets();block=widgetCollection[widgetCollection.length-1];block=this.documentHelper.selection.getNextRenderedBlock(block);if(!sf.base.isNullOrUndefined(block)){//Goto the next block.
if(block instanceof ParagraphWidget){this.applyCharFormat(block,this.documentHelper.selection,start,end,property,value,update);}else{this.applyCharFormatForTable(0,block,this.documentHelper.selection,start,end,property,value,update);}}};Editor.prototype.applyCharFormat=function(paragraph,selection,start,end,property,value,update){paragraph=paragraph.combineWidget(this.owner.viewer);var startOffset=0;var length=selection.getParagraphLength(paragraph);var startLineWidget=paragraph.childWidgets.indexOf(start.currentWidget)!==-1?paragraph.childWidgets.indexOf(start.currentWidget):0;var endOffset=end.offset;var endLineWidget=paragraph.childWidgets.indexOf(end.currentWidget)!==-1?paragraph.childWidgets.indexOf(end.currentWidget):paragraph.childWidgets.length-1;if(!sf.base.isNullOrUndefined(selection)){if(paragraph===start.paragraph){startOffset=start.offset;}}if(!paragraph.equals(end.paragraph)){var lastLine=paragraph.childWidgets[paragraph.childWidgets.length-1];//Skip consider highlightcolor if paragraph mark alone is selected similar to Microsoft Word behaviour
if(!(property==='highlightColor'&&selection.isParagraphLastLine(lastLine)&&start.currentWidget===lastLine&&start.offset===selection.getLineLength(lastLine))){this.applyCharFormatValue(paragraph.characterFormat,property,value,update);}endOffset=length;}else{var lastLine=paragraph.childWidgets[paragraph.childWidgets.length-1];if(selection.isParagraphLastLine(lastLine)&&end.currentWidget===lastLine&&(endOffset===selection.getLineLength(lastLine)+1||selection.isEmpty&&selection.end.isAtParagraphEnd)){this.applyCharFormatValue(paragraph.characterFormat,property,value,update);}}// let count: number = 0;
for(var i=startLineWidget;i<=endLineWidget;i++){var line=paragraph.childWidgets[i];if(i!==startLineWidget){startOffset=selection.getStartLineOffset(line);}if(line===end.currentWidget){endOffset=end.offset;}else{endOffset=selection.getLineLength(line);}var count=0;var isBidi=line.paragraph.paragraphFormat.bidi;var isContainsRtl=this.documentHelper.layout.isContainsRtl(line);var isStarted=true;var endElement=undefined;var indexOf=-1;var isIncrease=true;for(var j=!isBidi?0:line.children.length-1;!isBidi?j<line.children.length:j>=0;isBidi?j--:isIncrease?j++:j--){var inlineObj=line.children[j];if(!isBidi&&isContainsRtl){while((isStarted||sf.base.isNullOrUndefined(endElement))&&inlineObj instanceof TextElementBox&&(this.documentHelper.textHelper.isRTLText(inlineObj.text)||this.documentHelper.textHelper.containsSpecialCharAlone(inlineObj.text))&&inlineObj.nextElement){if(!endElement){endElement=inlineObj;}if(indexOf===-1){indexOf=line.children.indexOf(inlineObj);}j=inlineObj.line.children.indexOf(inlineObj);inlineObj=inlineObj.nextElement;isIncrease=false;}}isStarted=false;if(inlineObj instanceof ListTextElementBox){continue;}if(endElement===inlineObj){endElement=undefined;j=indexOf;indexOf=-1;isIncrease=true;}if(startOffset>=count+inlineObj.length){count+=inlineObj.length;continue;}var startIndex=0;if(startOffset>count){startIndex=startOffset-count;}var endIndex=endOffset-count;var inlineLength=inlineObj.length;if(endIndex>inlineLength){endIndex=inlineLength;}var index=this.applyCharFormatInline(inlineObj,selection,startIndex,endIndex,property,value,update);if(isBidi||isContainsRtl&&!isIncrease){j-=index;}else{j+=index;}if(endOffset<=count+inlineLength){break;}count+=inlineLength;}}var endParagraph=end.paragraph;if(!paragraph.bidi&&this.documentHelper.layout.isContainsRtl(paragraph.childWidgets[startLineWidget])){this.documentHelper.layout.reLayoutParagraph(paragraph,startLineWidget,0,false,true);}else{this.documentHelper.layout.reLayoutParagraph(paragraph,startLineWidget,0);}if(paragraph.equals(endParagraph)){return;}this.getNextParagraphForCharacterFormatting(paragraph,start,end,property,value,update);};/**
     * Toggles the bold property of selected contents.
     *
     * @returns {void}
     */Editor.prototype.toggleBold=function(){if((this.owner.isReadOnlyMode||this.restrictFormatting)&&!this.selection.isInlineFormFillMode()){return;}var value=this.getCurrentSelectionValue('bold');this.selection.characterFormat.bold=value;};/**
     * Toggles the bold property of selected contents.
     *
     * @returns {void}
     */Editor.prototype.toggleItalic=function(){if((this.owner.isReadOnlyMode||this.restrictFormatting)&&!this.selection.isInlineFormFillMode()){return;}var value=this.getCurrentSelectionValue('italic');this.selection.characterFormat.italic=value;};/**
     * Change the selected text to uppercase.
     * @private
     */Editor.prototype.changeCase=function(property){if(this.selection.isEmpty||(this.owner.isReadOnlyMode||this.restrictFormatting)&&!this.selection.isInlineFormFillMode()){return;}this.initHistory('Uppercase');this.documentHelper.owner.isShiftingEnabled=true;var selection=this.selection;var startPosition=selection.start;var endPosition=selection.end;if(!selection.isForward){startPosition=selection.end;endPosition=selection.start;}this.changeSelectedTextCase(selection,startPosition,endPosition,property);this.reLayout(selection);};/**
     * Change the selected text case.
     * @private
     */ // eslint-disable-next-line max-len
Editor.prototype.changeSelectedTextCase=function(selection,startPosition,endPosition,property,removedTextNodes){var blockInfo=this.selection.getParagraphInfo(startPosition);selection.editPosition=this.selection.getHierarchicalIndex(blockInfo.paragraph,blockInfo.offset.toString());if(this.editorHistory&&this.editorHistory.currentBaseHistoryInfo){if(this.checkInsertPosition(selection)){this.updateHistoryPosition(startPosition,true);}}var isRevert=this.editorHistory.isUndoing;if(isRevert&&!sf.base.isNullOrUndefined(removedTextNodes)&&removedTextNodes.length>0){this.removedTextNodes=removedTextNodes;}var endPos=endPosition.selection.endOffset;this.changeTextCase(startPosition.paragraph,selection,startPosition,endPosition,property,isRevert);if(this.editorHistory&&this.editorHistory.currentBaseHistoryInfo){if(endPosition.selection.endOffset!==endPos){endPosition=selection.getTextPosBasedOnLogicalIndex(endPos);}if(this.checkEndPosition(selection)){this.updateHistoryPosition(endPosition,false);}selection.selectPosition(startPosition,endPosition);}};// eslint-disable-next-line max-len
Editor.prototype.changeTextCase=function(para,selection,startPosition,endPosition,property,isRevert){if(startPosition.paragraph.isInsideTable&&(!endPosition.paragraph.isInsideTable||startPosition.paragraph.associatedCell!==endPosition.paragraph.associatedCell||selection.isCellSelected(startPosition.paragraph.associatedCell,startPosition,endPosition))){var tableCell=void 0;startPosition.paragraph.associatedCell.ownerTable.combineWidget(this.owner.viewer);if(this.checkInsertPosition(selection)){this.updateHistoryPosition(startPosition,true);}tableCell=startPosition.paragraph.associatedCell;this.changeCaseParaFormatInCell(tableCell,startPosition,endPosition,property,isRevert);var table=tableCell.ownerTable;this.documentHelper.layout.layoutBodyWidgetCollection(table.index,table.containerWidget,table,false);}else{this.changeCaseParagraph(para,selection,startPosition,endPosition,property,isRevert);}};// eslint-disable-next-line max-len
Editor.prototype.changeCaseParagraph=function(para,selection,startPos,endPos,property,isRevert){para=para.combineWidget(this.owner.viewer);var startOffsetVal=0;var len=selection.getParagraphLength(para);var startLine=para.childWidgets.indexOf(startPos.currentWidget)!==-1?para.childWidgets.indexOf(startPos.currentWidget):0;var endOffsetVal=endPos.offset;var endLine=para.childWidgets.indexOf(endPos.currentWidget)!==-1?para.childWidgets.indexOf(endPos.currentWidget):para.childWidgets.length-1;if(!sf.base.isNullOrUndefined(selection)){if(para===startPos.paragraph){startOffsetVal=startPos.offset;}}if(!para.equals(endPos.paragraph)){endOffsetVal=len;}// let count: number = 0;
for(var i=startLine;i<=endLine;i++){var line=para.childWidgets[i];if(i!==startLine){startOffsetVal=selection.getStartLineOffset(line);}if(line===endPos.currentWidget){endOffsetVal=endPos.offset;}else{endOffsetVal=selection.getLineLength(line);}var textCount=0;var isBidi=line.paragraph.paragraphFormat.bidi;var isLineContainsRtl=this.documentHelper.layout.isContainsRtl(line);var isIterationStarted=true;var endElementBox=undefined;var childIndex=-1;var isIncreaseIteration=true;// eslint-disable-next-line max-len
for(var j=!isBidi?0:line.children.length-1;!isBidi?j<line.children.length:j>=0;isBidi?j--:isIncreaseIteration?j++:j--){var child=line.children[j];if(!isBidi&&isLineContainsRtl){while((isIterationStarted||sf.base.isNullOrUndefined(endElementBox))&&child instanceof TextElementBox&&(this.documentHelper.textHelper.isRTLText(child.text)||this.documentHelper.textHelper.containsSpecialCharAlone(child.text))&&child.nextElement){if(!endElementBox){endElementBox=child;}if(childIndex===-1){childIndex=line.children.indexOf(child);}j=child.line.children.indexOf(child);child=child.nextElement;isIncreaseIteration=false;}}isIterationStarted=false;if(child instanceof ListTextElementBox){continue;}if(endElementBox===child){endElementBox=undefined;j=childIndex;childIndex=-1;isIncreaseIteration=true;}if(startOffsetVal>=textCount+child.length){textCount+=child.length;continue;}var startIndex=0;if(startOffsetVal>textCount){startIndex=startOffsetVal-textCount;}var endIndex=endOffsetVal-textCount;var inlineLength=child.length;if(endIndex>inlineLength){endIndex=inlineLength;}var index=this.changeCaseInline(child,selection,startIndex,endIndex,property,isRevert);if(isBidi||isLineContainsRtl&&!isIncreaseIteration){j-=index;}else{j+=index;}if(endOffsetVal<=textCount+inlineLength){break;}textCount+=inlineLength;}}var endPara=endPos.paragraph;if(!para.bidi&&this.documentHelper.layout.isContainsRtl(para.childWidgets[startLine])){this.documentHelper.layout.reLayoutParagraph(para,startLine,0,false,true);}else{this.documentHelper.layout.reLayoutParagraph(para,startLine,0);}if(para.equals(endPara)){return;}this.changeCaseNextBlock(para,startPos,endPos,property,isRevert);};// eslint-disable-next-line max-len
Editor.prototype.changeCaseInline=function(inline,selection,startIndex,endIndex,property,isRevert){if(inline instanceof TextElementBox){if(startIndex===0&&endIndex===inline.length){this.changeCaseInlineInternal(inline,selection,startIndex,endIndex,property,isRevert);}else{return this.changeCaseInlineInternal(inline,selection,startIndex,endIndex,property,isRevert);}}return 0;};Editor.prototype.addRemovedTextNodes=function(inline,newText){if(inline instanceof TextElementBox){if(!sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo)){var span=this.editorHistory.currentBaseHistoryInfo.removedNodes[0];if(sf.base.isNullOrUndefined(span)){span=new TextElementBox();span.text='';this.editorHistory.currentBaseHistoryInfo.removedNodes.push(span);}span.text+=newText;}}};// eslint-disable-next-line max-len
Editor.prototype.changeCaseInlineInternal=function(inlineObj,selection,startIndex,endIndex,property,isRevert){var x=0;var index=inlineObj.line.children.indexOf(inlineObj);var paragraph=inlineObj.paragraph;var lineIndex=paragraph.childWidgets.indexOf(inlineObj.line);var textElement;if(startIndex>0){var textToChange=inlineObj.text.substr(startIndex,endIndex-startIndex);this.addRemovedTextNodes(inlineObj,textToChange);textElement=new TextElementBox();textElement.characterFormat.copyFormat(inlineObj.characterFormat);textElement.line=inlineObj.line;//Change the text case
textElement.text=this.getChangeCaseText(textToChange,property,isRevert);textElement.isRightToLeft=inlineObj.isRightToLeft;if(!paragraph.paragraphFormat.bidi&&!this.documentHelper.layout.isContainsRtl(inlineObj.line)){index++;}inlineObj.line.children.splice(index,0,textElement);x++;}if(endIndex<inlineObj.length){textElement=new TextElementBox();textElement.characterFormat.copyFormat(inlineObj.characterFormat);textElement.text=inlineObj.text.substring(endIndex);textElement.line=inlineObj.line;textElement.isRightToLeft=inlineObj.isRightToLeft;if(!paragraph.paragraphFormat.bidi&&!this.documentHelper.layout.isContainsRtl(inlineObj.line)){index++;}inlineObj.line.children.splice(index,0,textElement);x++;}var textElementBox=inlineObj;if(startIndex===0){var newText=textElementBox.text.substr(0,endIndex);this.addRemovedTextNodes(inlineObj,newText);//Change the text case
textElementBox.text=this.getChangeCaseText(newText,property,isRevert);}else{var preText=textElementBox.text.substr(0,startIndex);textElementBox.text=preText;}return x;};// eslint-disable-next-line max-len
Editor.prototype.changeCaseNextBlock=function(block,start,end,property,isRevert){block=this.getNextBlockForChangeCase(block,start,end,property,isRevert);if(!sf.base.isNullOrUndefined(block)){//Goto the next block.
if(block instanceof ParagraphWidget){this.changeCaseParagraph(block,this.documentHelper.selection,start,end,property,isRevert);}else{this.changeCaseForTable(0,block,this.documentHelper.selection,start,end,property,isRevert);}}};// eslint-disable-next-line max-len
Editor.prototype.getNextBlockForChangeCase=function(block,start,end,property,isRevert){var widgetCollection=block.getSplitWidgets();block=widgetCollection[widgetCollection.length-1];block=this.documentHelper.selection.getNextRenderedBlock(block);return block;};Editor.prototype.getChangeCaseText=function(input,property,isRevert){if(isRevert){if(!sf.base.isNullOrUndefined(this.removedTextNodes)&&this.removedTextNodes.length>0){var textElement=this.removedTextNodes[0];var oldText=textElement.text.substr(0,input.length);textElement.text=textElement.text.substr(oldText.length,textElement.length-oldText.length);input=oldText;if(textElement.text===''){this.removedTextNodes.splice(0,1);}}}else{switch(property){case'Uppercase':input=input.toUpperCase();break;default:break;}}return input;};// Table
// eslint-disable-next-line max-len
Editor.prototype.changeCaseForTable=function(indexToStart,tableWidget,selection,startPos,endPos,property,isRevert){tableWidget=tableWidget.combineWidget(this.owner.viewer);for(var i=indexToStart;i<tableWidget.childWidgets.length;i++){var row=tableWidget.childWidgets[i];for(var j=0;j<row.childWidgets.length;j++){this.changeCaseForSelectedCell(row.childWidgets[j],selection,property,isRevert);}if(endPos.paragraph.isInsideTable&&selection.containsRow(row,endPos.paragraph.associatedCell)){this.documentHelper.layout.layoutBodyWidgetCollection(tableWidget.index,tableWidget.containerWidget,tableWidget,false);return;}}this.documentHelper.layout.layoutBodyWidgetCollection(tableWidget.index,tableWidget.containerWidget,tableWidget,false);this.changeCaseNextBlock(tableWidget,startPos,endPos,property,isRevert);};// eslint-disable-next-line max-len
Editor.prototype.changeCaseForSelectedCell=function(cell,selection,property,isRevert){for(var i=0;i<cell.childWidgets.length;i++){var block=cell.childWidgets[i];if(block instanceof ParagraphWidget){this.changeCaseForSelectedPara(block,selection,property,isRevert);}else{this.changeCaseForSelTable(block,selection,property,isRevert);}}};// eslint-disable-next-line max-len
Editor.prototype.changeCaseForSelectedPara=function(paragraph,selection,property,isRevert){for(var i=0;i<paragraph.childWidgets.length;i++){var line=paragraph.childWidgets[i];for(var j=0;j<line.children.length;j++){var element=line.children[j];if(!sf.base.isNullOrUndefined(element)&&element instanceof TextElementBox){this.addRemovedTextNodes(element,element.text);element.text=this.getChangeCaseText(element.text,property,isRevert);}}}};// eslint-disable-next-line max-len
Editor.prototype.changeCaseForSelTable=function(tableWidget,selection,property,isRevert){for(var i=0;i<tableWidget.childWidgets.length;i++){var row=tableWidget.childWidgets[i];for(var j=0;j<row.childWidgets.length;j++){this.changeCaseForSelectedCell(row.childWidgets[j],selection,property,isRevert);}}};// Cell
// eslint-disable-next-line max-len
Editor.prototype.changeCaseParaFormatInCell=function(tableCell,startPos,endPos,property,isRevert){var selection=this.documentHelper.selection;if(endPos.paragraph.isInsideTable){var cellContainer=selection.getContainerCellOf(tableCell,endPos.paragraph.associatedCell);if(cellContainer.ownerTable.contains(endPos.paragraph.associatedCell)){var startCell=selection.getSelectedCell(tableCell,cellContainer);var endCell=selection.getSelectedCell(endPos.paragraph.associatedCell,cellContainer);if(selection.containsCell(cellContainer,endPos.paragraph.associatedCell)){//Selection end is in container cell.
if(selection.isCellSelected(cellContainer,startPos,endPos)){this.changeCaseParaForCellInternal(cellContainer,selection,property,isRevert);}else{if(startCell===cellContainer){this.changeCaseParagraph(startPos.paragraph,selection,startPos,endPos,property,isRevert);}else{this.changeCaseParaForRow(startCell.ownerRow,selection,startPos,endPos,property,isRevert);}}}else{//Change case of other selected cells in the current table.
this.changeCaseParaForTableCell(cellContainer.ownerTable,cellContainer,endCell,property,isRevert);}}else{this.changeCaseParaForRow(cellContainer.ownerRow,selection,startPos,endPos,property,isRevert);}}else{var wCell=selection.getContainerCell(tableCell);this.changeCaseParaForRow(wCell.ownerRow,selection,startPos,endPos,property,isRevert);}};// Table
// eslint-disable-next-line max-len
Editor.prototype.changeCaseParaForTableCell=function(tableWidget,startCell,endCell,property,isRevert){var selection=this.documentHelper.selection;var cellStartValue=selection.getCellLeft(startCell.ownerRow,startCell);var cellEndValue=cellStartValue+startCell.cellFormat.cellWidth;var cellEndLeft=selection.getCellLeft(endCell.ownerRow,endCell);var cellEndRight=cellEndLeft+endCell.cellFormat.cellWidth;var cellInfo=this.updateSelectedCellsInTable(cellStartValue,cellEndValue,cellEndLeft,cellEndRight);cellStartValue=cellInfo.start;cellEndValue=cellInfo.end;var count=tableWidget.childWidgets.indexOf(endCell.ownerRow);for(var m=tableWidget.childWidgets.indexOf(startCell.ownerRow);m<=count;m++){var row=tableWidget.childWidgets[m];for(var j=0;j<row.childWidgets.length;j++){var left=selection.getCellLeft(row,row.childWidgets[j]);if(Math.round(cellStartValue)<=Math.round(left)&&Math.round(left)<Math.round(cellEndValue)){this.changeCaseParaForCellInternal(row.childWidgets[j],selection,property,isRevert);}}}};// eslint-disable-next-line max-len
Editor.prototype.changeCaseParaForCellInternal=function(tableCell,selection,property,isRevert){for(var i=0;i<tableCell.childWidgets.length;i++){var childBlock=tableCell.childWidgets[i];if(childBlock instanceof ParagraphWidget){this.changeCaseForSelectedPara(childBlock,selection,property,isRevert);}else{this.changeCaseParaFormatTableInternal(childBlock,selection,property,isRevert);}}};// eslint-disable-next-line max-len
Editor.prototype.changeCaseParaFormatTableInternal=function(table,selection,property,isRevert){for(var x=0;x<table.childWidgets.length;x++){var row=table.childWidgets[x];for(var y=0;y<row.childWidgets.length;y++){this.changeCaseParaForCellInternal(row.childWidgets[y],selection,property,isRevert);}}};// Row
// eslint-disable-next-line max-len
Editor.prototype.changeCaseParaForRow=function(wRow,selection,start,end,property,isRevert){for(var i=wRow.rowIndex;i<wRow.ownerTable.childWidgets.length;i++){var row=wRow.ownerTable.childWidgets[i];for(var j=0;j<row.childWidgets.length;j++){this.changeCaseParaForCellInternal(row.childWidgets[j],selection,property,isRevert);}if(end.paragraph.isInsideTable&&this.documentHelper.selection.containsRow(row,end.paragraph.associatedCell)){return;}}this.changeCaseNextBlock(wRow.ownerTable,start,end,property,isRevert);};/**
     * Toggle All Caps formatting for the selected content.
     *
     * @returns {void}
     */Editor.prototype.toggleAllCaps=function(){if(this.documentHelper.owner.isReadOnlyMode&&!this.selection.isInlineFormFillMode()){return;}var value=this.getCurrentSelectionValue('allCaps');this.selection.characterFormat.allCaps=value;};Editor.prototype.getCurrentSelectionValue=function(property){var value=false;if(property==='bold'||property==='italic'){var characterFormat=this.getSelectedCharacterFormat();if(property==='bold'){value=!characterFormat.bold;}if(property==='italic'){value=!characterFormat.italic;}}return value;};Editor.prototype.getSelectedCharacterFormat=function(){var index=0;var start=this.selection.start;if(!this.selection.isForward){start=this.selection.end;}var lineWidget=start.currentWidget;var inlineObj=lineWidget.getInline(start.offset,index);var inline=inlineObj.element;// inline.ownerBase
index=inlineObj.index;var characterFormat=lineWidget.paragraph.characterFormat;if(!sf.base.isNullOrUndefined(inline)){if(this.selection.isEmpty&&this.selection.contextType==='List'){var listLevel=this.selection.getListLevel(this.selection.start.paragraph);if(listLevel.characterFormat.uniqueCharacterFormat){characterFormat=listLevel.characterFormat;}}else if(!this.selection.isEmpty&&index===inline.length){characterFormat=sf.base.isNullOrUndefined(inline.nextNode)?lineWidget.paragraph.characterFormat:inline.nextNode.characterFormat;}else{characterFormat=inline.characterFormat;}}return characterFormat;};/**
     * Toggles the underline property of selected contents.
     *
     * @param underline Default value of underline parameter is Single.
     * @returns {void}
     */Editor.prototype.toggleUnderline=function(underline){if((this.owner.isReadOnlyMode||this.restrictFormatting)&&!this.selection.isInlineFormFillMode()){return;}this.updateProperty(1,underline);};/**
     * Toggles the strike through property of selected contents.
     *
     * @param {Strikethrough} strikethrough Default value of strikethrough parameter is SingleStrike.
     * @returns {void}
     */Editor.prototype.toggleStrikethrough=function(strikethrough){if(!this.owner.isReadOnlyMode||this.selection.isInlineFormFillMode()){var value=void 0;if(sf.base.isNullOrUndefined(strikethrough)){value=this.selection.characterFormat.strikethrough==='SingleStrike'?'None':'SingleStrike';}else{value=strikethrough;}this.selection.characterFormat.strikethrough=value;}};Editor.prototype.updateFontSize=function(format,value){if(typeof value==='number'&&!(value<0&&format.fontSize===1)){return format.fontSize+value;}var fontsizeCollection=[8,9,10,11,12,14,16,18,20,24,26,28,36,48,72];if(typeof value==='string'&&value==='increment'){if(format.fontSize<8){return format.fontSize+1;}else if(format.fontSize>=72&&format.fontSize<80){return 80;}else if(format.fontSize>=80){return format.fontSize+10;}else{for(var i=0;i<fontsizeCollection.length;i++){if(format.fontSize<fontsizeCollection[i]){return fontsizeCollection[i];}}}}else if(typeof value==='string'&&value==='decrement'&&format.fontSize>1){if(format.fontSize<=8){return format.fontSize-1;}else if(format.fontSize>72&&format.fontSize<=80){return 72;}else if(format.fontSize>80){return format.fontSize-10;}else{for(var i=0;i<fontsizeCollection.length;i++){if(format.fontSize<=fontsizeCollection[i]){return fontsizeCollection[i-1];}}}}return format.fontSize;};// Inline
Editor.prototype.applyCharFormatInline=function(inline,selection,startIndex,endIndex,property,value,update){if(startIndex===0&&endIndex===inline.length){this.applyCharFormatValue(inline.characterFormat,property,value,update);return 0;}else if(inline instanceof TextElementBox){return this.formatInline(inline,selection,startIndex,endIndex,property,value,update);}return 0;};Editor.prototype.formatInline=function(inline,selection,startIndex,endIndex,property,value,update){var x=0;var node=inline;var index=inline.line.children.indexOf(node);var paragraph=inline.paragraph;var lineIndex=paragraph.childWidgets.indexOf(inline.line);var textElement;var indexCountForRevision=0;if(startIndex>0){indexCountForRevision+=1;textElement=new TextElementBox();textElement.characterFormat.copyFormat(inline.characterFormat);textElement.line=inline.line;textElement.text=inline.text.substr(startIndex,endIndex-startIndex);textElement.isRightToLeft=inline.isRightToLeft;this.applyCharFormatValue(textElement.characterFormat,property,value,update);if(!paragraph.paragraphFormat.bidi&&!this.documentHelper.layout.isContainsRtl(inline.line)){index++;}node.line.children.splice(index,0,textElement);x++;this.updateRevisionForFormattedContent(inline,textElement,indexCountForRevision);// this.addToLinkedFields(span);                      
}if(endIndex<node.length){indexCountForRevision+=1;textElement=new TextElementBox();textElement.characterFormat.copyFormat(inline.characterFormat);textElement.text=node.text.substring(endIndex);textElement.line=inline.line;textElement.isRightToLeft=inline.isRightToLeft;if(!paragraph.paragraphFormat.bidi&&!this.documentHelper.layout.isContainsRtl(inline.line)){index++;}node.line.children.splice(index,0,textElement);x++;this.updateRevisionForFormattedContent(inline,textElement,indexCountForRevision);// this.addToLinkedFields(span);                       
}if(startIndex===0){inline.text=inline.text.substr(0,endIndex);this.applyCharFormatValue(inline.characterFormat,property,value,update);}else{inline.text=inline.text.substr(0,startIndex);}return x;};Editor.prototype.updateRevisionForFormattedContent=function(inline,tempSpan,indexCount){for(var i=0;i<inline.revisions.length;i++){var currentRevision=inline.revisions[i];var rangeIndex=currentRevision.range.indexOf(inline)+indexCount;tempSpan.revisions.splice(0,0,currentRevision);currentRevision.range.splice(rangeIndex,0,tempSpan);}};// Cell
Editor.prototype.applyCharFormatCell=function(cell,selection,start,end,property,value,update){if(end.paragraph.isInsideTable){var containerCell=selection.getContainerCellOf(cell,end.paragraph.associatedCell);if(containerCell.ownerTable.contains(end.paragraph.associatedCell)){var startCell=selection.getSelectedCell(cell,containerCell);var endCell=selection.getSelectedCell(end.paragraph.associatedCell,containerCell);if(selection.containsCell(containerCell,end.paragraph.associatedCell)){//Selection end is in container cell.
if(selection.isCellSelected(containerCell,start,end)){value=this.getCharacterFormatValueOfCell(cell,selection,value,property);this.applyCharFormatForSelectedCell(containerCell,selection,property,value,update);}else{if(startCell===containerCell){this.applyCharFormat(start.paragraph,selection,start,end,property,value,update);}else{this.applyCharFormatRow(startCell.ownerRow,selection,start,end,property,value,update);}}}else{//Format other selected cells in current table.
this.applyCharFormatForTableCell(containerCell.ownerTable,selection,containerCell,endCell,property,value,update);}}else{this.applyCharFormatRow(containerCell.ownerRow,selection,start,end,property,value,update);}}else{var tableCell=selection.getContainerCell(cell);this.applyCharFormatRow(tableCell.ownerRow,selection,start,end,property,value,update);}};Editor.prototype.applyCharFormatForSelectedCell=function(cell,selection,property,value,update){for(var i=0;i<cell.childWidgets.length;i++){var block=cell.childWidgets[i];if(block instanceof ParagraphWidget){this.applyCharFormatForSelectedPara(block,selection,property,value,update);}else{this.applyCharFormatForSelTable(block,selection,property,value,update);}}};// Row
Editor.prototype.applyCharFormatRow=function(row,selection,start,end,property,value,update){value=this.getCharacterFormatValueOfCell(row.childWidgets[0],selection,value,property);this.applyCharFormatForTable(row.rowIndex,row.ownerTable,selection,start,end,property,value,update);};// Table
Editor.prototype.applyCharFormatForTable=function(index,table,selection,start,end,property,value,update){table=table.combineWidget(this.owner.viewer);for(var i=index;i<table.childWidgets.length;i++){var row=table.childWidgets[i];for(var j=0;j<row.childWidgets.length;j++){this.applyCharFormatForSelectedCell(row.childWidgets[j],selection,property,value,update);}if(end.paragraph.isInsideTable&&selection.containsRow(row,end.paragraph.associatedCell)){this.documentHelper.layout.layoutBodyWidgetCollection(table.index,table.containerWidget,table,false);return;}}this.documentHelper.layout.layoutBodyWidgetCollection(table.index,table.containerWidget,table,false);this.getNextParagraphForCharacterFormatting(table,start,end,property,value,update);};Editor.prototype.applyCharFormatForSelTable=function(tableWidget,selection,property,value,update){for(var i=0;i<tableWidget.childWidgets.length;i++){var row=tableWidget.childWidgets[i];for(var j=0;j<row.childWidgets.length;j++){this.applyCharFormatForSelectedCell(row.childWidgets[j],selection,property,value,update);}}};Editor.prototype.applyCharFormatForTableCell=function(table,selection,startCell,endCell,property,value,update){var startCellLeft=selection.getCellLeft(startCell.ownerRow,startCell);var startCellRight=startCellLeft+startCell.cellFormat.cellWidth;var endCellLeft=selection.getCellLeft(endCell.ownerRow,endCell);var endCellRight=endCellLeft+endCell.cellFormat.cellWidth;var cellInfo=this.updateSelectedCellsInTable(startCellLeft,startCellRight,endCellLeft,endCellRight);startCellLeft=cellInfo.start;startCellRight=cellInfo.end;var count=table.childWidgets.indexOf(endCell.ownerRow);var isStarted=false;for(var i=table.childWidgets.indexOf(startCell.ownerRow);i<=count;i++){var row=table.childWidgets[i];for(var j=0;j<row.childWidgets.length;j++){var left=selection.getCellLeft(row,row.childWidgets[j]);if(HelperMethods.round(startCellLeft,2)<=HelperMethods.round(left,2)&&HelperMethods.round(left,2)<HelperMethods.round(startCellRight,2)){if(!isStarted){value=this.getCharacterFormatValueOfCell(row.childWidgets[j],selection,value,property);isStarted=true;}this.applyCharFormatForSelectedCell(row.childWidgets[j],selection,property,value,update);}}}};Editor.prototype.updateSelectedCellsInTable=function(start,end,endCellLeft,endCellRight){var selection=this.documentHelper.selection;if(start>endCellLeft){start=endCellLeft;}if(end<endCellRight){end=endCellRight;}if(start>selection.upDownSelectionLength){start=selection.upDownSelectionLength;}if(end<selection.upDownSelectionLength){end=selection.upDownSelectionLength;}return{start:start,end:end};};Editor.prototype.getCharacterFormatValueOfCell=function(cell,selection,value,property){if(typeof value==='boolean'||value===undefined&&(property==='bold'||property==='italic')){var firstParagraph=selection.getFirstParagraph(cell);var format=firstParagraph.characterFormat;if(firstParagraph.childWidgets.length>0&&firstParagraph.childWidgets[0].children.length>0){format=firstParagraph.childWidgets[0].children[0].characterFormat;}value=!format.getPropertyValue(property);}return value;};/**
     * Apply Character format for selection
     *
     * @private
     * @returns {void}
     */Editor.prototype.applyCharFormatValueInternal=function(selection,format,property,value){this.applyCharFormatValue(format,property,value,false);};Editor.prototype.copyInlineCharacterFormat=function(sourceFormat,destFormat){destFormat.uniqueCharacterFormat=sourceFormat.uniqueCharacterFormat;destFormat.baseCharStyle=sourceFormat.baseCharStyle;};Editor.prototype.applyCharFormatValue=function(format,property,value,update){if(update&&property==='fontSize'){value=this.updateFontSize(format,value);}if(this.editorHistory&&!sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo)){value=this.editorHistory.currentBaseHistoryInfo.addModifiedProperties(format,property,value);}if(value instanceof WCharacterFormat){if(this.editorHistory&&(this.editorHistory.isUndoing||this.editorHistory.isRedoing)){this.copyInlineCharacterFormat(value,format);}else{format.copyFormat(value);}return;}if(this.isForHyperlinkFormat&&this.owner.enableTrackChanges&&format.ownerBase instanceof ElementBox){var currentElement=format.ownerBase;var prevElement=currentElement.previousNode;if(sf.base.isNullOrUndefined(prevElement)){var paraWidget=currentElement.paragraph.previousWidget;if(!sf.base.isNullOrUndefined(paraWidget)&&!paraWidget.isEmpty()){var lineWidget=paraWidget.lastChild;prevElement=lineWidget.children[lineWidget.children.length-1];}}while(!sf.base.isNullOrUndefined(prevElement)&&!(prevElement instanceof TextElementBox)){prevElement=prevElement.previousNode;}if(!sf.base.isNullOrUndefined(prevElement)&&prevElement.revisions.length>0){var currentRevision=prevElement.revisions[prevElement.revisions.length-1];if(!this.isRevisionAlreadyIn(currentElement,currentRevision)){currentElement.revisions.push(currentRevision);currentRevision.range.push(currentElement);}}else{this.insertRevision(currentElement,'Insertion');}}if(sf.base.isNullOrUndefined(value)){format.clearFormat();return;}if(property==='bold'){format.bold=value;}else if(property==='italic'){format.italic=value;}else if(property==='fontColor'){format.fontColor=value;}else if(property==='fontFamily'){format.fontFamily=value;}else if(property==='fontSize'){format.fontSize=value;}else if(property==='highlightColor'){format.highlightColor=value;}else if(property==='baselineAlignment'){format.baselineAlignment=value;}else if(property==='strikethrough'){format.strikethrough=value;}else if(property==='underline'){format.underline=value;}else if(property==='styleName'){format.baseCharStyle=value;}else if(property==='allCaps'){format.allCaps=value;}};/**
     * @private
     * @returns {void}
     */Editor.prototype.onImageFormat=function(elementBox,width,height){var modifiedFormat=new ImageInfo(elementBox);if(this.editorHistory){this.editorHistory.initializeHistory('ImageResizing');this.editorHistory.currentBaseHistoryInfo.modifiedProperties.push(modifiedFormat);}this.setOffsetValue(this.selection);elementBox.width=width;elementBox.height=height;this.documentHelper.layout.reLayoutParagraph(elementBox.line.paragraph,elementBox.line.indexInOwner,0);this.reLayout(this.selection,false);if(this.documentHelper.owner.imageResizerModule){this.documentHelper.owner.imageResizerModule.positionImageResizer(elementBox);}};/**
     * Toggles the text alignment of selected paragraphs.
     *
     * @param {TextAlignment} textAlignment - Specified the text alignment.
     * @returns {void}
     */Editor.prototype.toggleTextAlignment=function(textAlignment){if(this.documentHelper.owner.isReadOnlyMode&&!this.selection.isInlineFormFillMode()||!this.documentHelper.owner.isDocumentLoaded){return;}// Toggle performed based on current selection format similar to MS word behavior.
if(!sf.base.isNullOrUndefined(this.documentHelper.selection.paragraphFormat.textAlignment)&&this.documentHelper.selection.paragraphFormat.textAlignment===textAlignment){if(textAlignment==='Left'){this.onApplyParagraphFormat('textAlignment','Justify',false,true);}else{this.onApplyParagraphFormat('textAlignment','Left',false,true);}}else{this.onApplyParagraphFormat('textAlignment',textAlignment,false,true);}};/**
     * @private
     */Editor.prototype.setPreviousBlockToLayout=function(){var startPosition=this.documentHelper.selection.start;if(!this.documentHelper.selection.isForward){startPosition=this.documentHelper.selection.end;}var startParagraph=startPosition.paragraph;if(startParagraph.paragraphFormat.keepWithNext){var bodyWidget=startParagraph.bodyWidget;if(!sf.base.isNullOrUndefined(bodyWidget)&&bodyWidget instanceof BodyWidget&&bodyWidget.page){var previousPage=bodyWidget.page.previousPage;if(previousPage){this.previousBlockToLayout=previousPage.bodyWidgets[0].lastChild;}}}};/**
     * Applies paragraph format for the selection ranges.
     *
     * @param {string} property - Specifies the property
     * @param {Object} value - Specifies the value
     * @param {boolean} update - Specifies the update
     * @param {boolean} isSelectionChanged - Specifies the selection change.
     * @private
     * @returns {void}
     */Editor.prototype.onApplyParagraphFormat=function(property,value,update,isSelectionChanged){var allowFormatting=this.documentHelper.isFormFillProtectedMode&&this.documentHelper.selection.isInlineFormFillMode()&&this.allowFormattingInFormFields(property);if(this.restrictFormatting&&!allowFormatting){return;}this.setPreviousBlockToLayout();var action=property==='bidi'?'ParagraphBidi':property[0].toUpperCase()+property.slice(1);this.documentHelper.owner.isShiftingEnabled=true;var selection=this.documentHelper.selection;this.initHistory(action);if(this.owner.isReadOnlyMode&&!allowFormatting||!this.owner.isDocumentLoaded){return;}if(property==='leftIndent'){if(selection.paragraphFormat.listId!==-1&&update){this.updateListLevel(value>0);return;}}if(selection.isEmpty){this.setOffsetValue(selection);var isBidiList=selection.paragraphFormat.bidi&&(property==='listFormat'||selection.paragraphFormat.listId!==-1);if(!isBidiList){this.documentHelper.layout.isBidiReLayout=true;}if(update&&property==='leftIndent'){value=this.getIndentIncrementValue(selection.start.paragraph,value);}var para=selection.start.paragraph;var layout=this.documentHelper.layout;var footNoteWidgetsInfo=layout.getFootNodeWidgetsToShiftToPage(para);para=para.combineWidget(this.owner.viewer);this.applyParaFormatProperty(para,property,value,update);this.layoutItemBlock(para,false);if(footNoteWidgetsInfo.footNoteWidgets.length>0){layout.moveFootNotesToPage(footNoteWidgetsInfo.footNoteWidgets,footNoteWidgetsInfo.fromBodyWidget,footNoteWidgetsInfo.toBodyWidget);layout.layoutfootNote(footNoteWidgetsInfo.toBodyWidget.page.footnoteWidget);}if(!isBidiList){this.documentHelper.layout.isBidiReLayout=false;}}else{//Iterate and update formatting's.      
if(action!=='ParagraphBidi'){this.setOffsetValue(selection);}this.updateSelectionParagraphFormatting(property,value,update);}this.reLayout(selection);};/**
     * Update the list level
     *
     * @param {boolean} increaseLevel - Specifies the increase level
     * @private
     * @returns {void}
     */Editor.prototype.updateListLevel=function(increaseLevel){// Increment or Decrement list level for Multilevel lists.
var documentHelper=this.documentHelper;var listFormat=this.documentHelper.selection.start.paragraph.paragraphFormat.listFormat;var paragraphFormat=this.documentHelper.selection.start.paragraph.paragraphFormat;var list=documentHelper.getListById(paragraphFormat.listFormat.listId);var listLevel=documentHelper.layout.getListLevel(list,paragraphFormat.listFormat.listLevelNumber);var levelNumber;if(increaseLevel){levelNumber=paragraphFormat.listFormat.listLevelNumber+1;}else{levelNumber=paragraphFormat.listFormat.listLevelNumber-1;}var nextListLevel=documentHelper.layout.getListLevel(list,levelNumber);if(!sf.base.isNullOrUndefined(nextListLevel)){this.onApplyListInternal(list,levelNumber);documentHelper.selection.start.updatePhysicalPosition(true);documentHelper.selection.end.updatePhysicalPosition(true);documentHelper.selection.updateCaretPosition();}};/**
     * Applies list
     *
     * @param {WList} list - Specified the list
     * @param {number} listLevelNumber - Specified the list level number
     * @private
     * @returns {void}
     */Editor.prototype.onApplyListInternal=function(list,listLevelNumber){//let selection: Selection = this.documentHelper.selection;
var listFormat=new WListFormat();if(!sf.base.isNullOrUndefined(list)&&listLevelNumber>=0&&listLevelNumber<9){listFormat.listId=list.listId;listFormat.listLevelNumber=listLevelNumber;}this.onApplyParagraphFormat('listFormat',listFormat,false,false);};/**
     * Apply paragraph format to selection range
     *
     * @param {string} property - Specifies the property
     * @param {Object} value - Specifies the value
     * @param {boolean} update - Specifies the update
     * @private
     * @returns {void}
     */Editor.prototype.updateSelectionParagraphFormatting=function(property,value,update){var selection=this.documentHelper.selection;if(property==='leftIndent'&&update){if(!sf.base.isNullOrUndefined(selection.start)&&selection.start.isExistBefore(selection.end)){value=this.getIndentIncrementValue(selection.start.paragraph,value);}else{value=this.getIndentIncrementValue(selection.end.paragraph,value);}}this.updateParagraphFormatInternal(property,value,update);};Editor.prototype.getIndentIncrementValue=function(currentParagraph,incrementFactor){var currentParagraphIndent=currentParagraph.paragraphFormat.leftIndent;if(currentParagraphIndent<0){// In MS Word, if the current paragraph left indent is lesser that or equal to 0
// then performing decrement indent will set left indent to 0. 
if(incrementFactor<0||currentParagraphIndent+incrementFactor>=0){return-currentParagraphIndent;}else{var incrementValue=-this.getIndentIncrementValueInternal(-currentParagraphIndent,-incrementFactor);return incrementValue%incrementFactor===0?incrementValue:incrementValue+incrementFactor;}}else{return this.getIndentIncrementValueInternal(currentParagraphIndent,incrementFactor);}};Editor.prototype.getIndentIncrementValueInternal=function(position,incrementFactor){var tabValue=Math.abs(incrementFactor);if(position===0||tabValue===0){return incrementFactor>0?tabValue:0;}else{var diff=Math.round(position)*100%(Math.round(tabValue)*100)/100;var cnt=(Math.round(position)-diff)/Math.round(tabValue);var fPosition=cnt*tabValue;if(incrementFactor>0){fPosition+=tabValue;}return fPosition-position===0?incrementFactor:fPosition-position;}};Editor.prototype.updateParagraphFormatInternal=function(property,value,update){if(sf.base.isNullOrUndefined(property)){property='ParagraphFormat';}switch(property){case'afterSpacing':this.updateParagraphFormat('afterSpacing',value,false);break;case'beforeSpacing':this.updateParagraphFormat('beforeSpacing',value,false);break;case'rightIndent':this.updateParagraphFormat('rightIndent',value,false);break;case'leftIndent':this.updateParagraphFormat('leftIndent',value,update);break;case'firstLineIndent':this.updateParagraphFormat('firstLineIndent',value,false);break;case'lineSpacing':this.updateParagraphFormat('lineSpacing',value,false);break;case'lineSpacingType':this.updateParagraphFormat('lineSpacingType',value,false);break;case'textAlignment':this.updateParagraphFormat('textAlignment',value,false);break;case'listFormat':this.updateParagraphFormat('listFormat',value,false);break;case'ParagraphFormat':this.updateParagraphFormat(undefined,value,false);break;case'styleName':this.updateParagraphFormat('styleName',value,false);break;case'ClearParagraphFormat':// this.initializeHistory('ClearParagraphFormat', selectionRange);
this.updateParagraphFormat(undefined,value,false);break;case'bidi':var isBidiList=this.selection.paragraphFormat.listId!==-1;if(!isBidiList){this.documentHelper.layout.isBidiReLayout=true;}this.updateParagraphFormat('bidi',value,false);if(!isBidiList){this.documentHelper.layout.isBidiReLayout=false;}break;case'contextualSpacing':this.updateParagraphFormat('contextualSpacing',value,false);break;}};/**
     * Update paragraph format on undo
     *
     * @param {string} property - Specifies the property
     * @param {Object} value - Specifies the value
     * @param {boolean} update - Specifies the update
     * @private
     * @returns {void}
     */Editor.prototype.updateParagraphFormat=function(property,value,update){var selection=this.documentHelper.selection;var startPosition=selection.start;var endPosition=selection.end;if(!selection.isForward){startPosition=selection.end;endPosition=selection.start;}// this.updateInsertPosition(selection, startPosition);
this.applyParaFormatSelectedContent(startPosition,endPosition,property,value,update);// this.startSelectionReLayouting(startPosition.paragraph, selection, startPosition, endPosition);
};Editor.prototype.applyParaFormatSelectedContent=function(start,end,property,value,update){var selection=this.documentHelper.selection;if(start.paragraph.isInsideTable&&(!end.paragraph.isInsideTable||start.paragraph.associatedCell!==end.paragraph.associatedCell||selection.isCellSelected(start.paragraph.associatedCell,start,end))){var cell=void 0;start.paragraph.associatedCell.ownerTable.combineWidget(this.owner.viewer);if(this.checkInsertPosition(selection)){this.updateHistoryPosition(start,true);}cell=start.paragraph.associatedCell;this.applyParaFormatInCell(cell,start,end,property,value,update);var table=cell.ownerTable;this.documentHelper.layout.layoutBodyWidgetCollection(table.index,table.containerWidget,table,false);}else{if(!sf.base.isNullOrUndefined(value)&&!this.selection.isEmpty&&property==='styleName'&&this.applyCharacterStyle(start.paragraph,start,end,property,value,update)){return;}else{this.applyParaFormat(start.paragraph,start,end,property,value,update);}}};/**
     * Apply Paragraph format
     *
     * @param {ParagraphWidget} paragraph - Specifies the selection
     * @param {string} property - Specifies the property
     * @param {Object} value - Specifies the value
     * @param {boolean} update - Specifies the update
     * @private
     * @returns {void}
     */Editor.prototype.applyParaFormatProperty=function(paragraph,property,value,update){var format=paragraph.paragraphFormat;if(update&&property==='leftIndent'){value=format.leftIndent+value;}if(property==='listFormat'&&value instanceof WListFormat){var listFormat=value;if(!listFormat.hasValue('listLevelNumber')){listFormat.listLevelNumber=format.listFormat.listLevelNumber;}}if(this.editorHistory&&!sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo)){value=this.editorHistory.currentBaseHistoryInfo.addModifiedPropertiesForParagraphFormat(format,property,value);}if(value instanceof WParagraphFormat){if(sf.base.isNullOrUndefined(property)){if(this.editorHistory&&(this.editorHistory.isUndoing||this.editorHistory.isRedoing)){this.copyParagraphFormat(value,format);}else{format.copyFormat(value);}}else if(property==='listFormat'){format.listFormat=value.listFormat;// this.handleListFormat(format, value as WParagraphFormat);
}}if(sf.base.isNullOrUndefined(value)){format.clearFormat();this.documentHelper.layout.reLayoutParagraph(format.ownerBase,0,0);return;}if(property==='afterSpacing'){format.afterSpacing=value;}else if(property==='beforeSpacing'){format.beforeSpacing=value;}else if(property==='leftIndent'){format.leftIndent=value;}else if(property==='lineSpacingType'){format.lineSpacingType=value;}else if(property==='lineSpacing'){format.lineSpacing=value;}else if(property==='rightIndent'){format.rightIndent=value;}else if(property==='firstLineIndent'){format.firstLineIndent=value;}else if(property==='textAlignment'){format.textAlignment=value;this.documentHelper.layout.allowLayout=false;}else if(property==='styleName'){if(typeof value==='string'){value=this.documentHelper.styles.findByName(value);}format.applyStyle(value);}else if(property==='listFormat'){if(value instanceof WParagraphFormat){this.copyFromListLevelParagraphFormat(format,value);value=value.listFormat;}format.listFormat.copyFormat(value);this.documentHelper.layout.clearListElementBox(format.ownerBase);this.onListFormatChange(format.ownerBase,value,format);this.layoutItemBlock(format.ownerBase,false);return;}else if(property==='bidi'){format.bidi=value;}else if(property==='keepWithNext'){format.keepWithNext=value;}else if(property==='keepLinesTogether'){format.keepLinesTogether=value;}else if(property==='widowControl'){format.widowControl=value;}else if(property==='contextualSpacing'){format.contextualSpacing=value;}};Editor.prototype.copyParagraphFormat=function(sourceFormat,destFormat){destFormat.uniqueParagraphFormat=sourceFormat.uniqueParagraphFormat;destFormat.listFormat=sourceFormat.listFormat;destFormat.baseStyle=sourceFormat.baseStyle;};Editor.prototype.onListFormatChange=function(paragraph,listFormat,paraFormat){if(listFormat instanceof WListFormat){//let currentFormat: WListFormat = listFormat;
// currentFormat.setOwnerBase(paraFormat);
this.updateListParagraphFormat(paragraph,listFormat);}};Editor.prototype.updateListParagraphFormat=function(paragraph,listFormat){var list=this.documentHelper.getListById(listFormat.listId);var listlevel=undefined;if(!sf.base.isNullOrUndefined(list)){listlevel=this.documentHelper.layout.getListLevel(list,listFormat.listLevelNumber);}var isUpdateIndent=!this.editorHistory||this.editorHistory&&!this.editorHistory.isUndoing;if(isUpdateIndent){if(paragraph instanceof ParagraphWidget&&!sf.base.isNullOrUndefined(listlevel)&&!sf.base.isNullOrUndefined(listlevel.paragraphFormat)&&!sf.base.isNullOrUndefined(paragraph.containerWidget)){this.copyFromListLevelParagraphFormat(paragraph.paragraphFormat,listlevel.paragraphFormat);}else if(sf.base.isNullOrUndefined(list)){paragraph.paragraphFormat.leftIndent=undefined;paragraph.paragraphFormat.firstLineIndent=undefined;}}};/**
     * Copies list level paragraph format
     *
     * @param {WParagraphFormat} oldFormat - Specifies the old format
     * @param {WParagraphFormat} newFormat - Specifies the new format
     * @private
     * @returns {void}
     */Editor.prototype.copyFromListLevelParagraphFormat=function(oldFormat,newFormat){if(!sf.base.isNullOrUndefined(newFormat.leftIndent)){oldFormat.leftIndent=newFormat.leftIndent;}if(!sf.base.isNullOrUndefined(newFormat.firstLineIndent)){oldFormat.firstLineIndent=newFormat.firstLineIndent;}};/**
     * To apply continue numbering from the previous list
     *
     * @returns {void}
     */Editor.prototype.applyContinueNumbering=function(){var selection=this.selection;if(this.editorHistory){this.editorHistory.initializeHistory('ContinueNumbering');}this.applyContinueNumberingInternal(selection);};Editor.prototype.applyContinueNumberingInternal=function(selection){var paragraph=selection.start.paragraph;var numberingInfo=this.getContinueNumberingInfo(paragraph);var paraFormat=this.getParagraphFormat(paragraph,numberingInfo.listLevelNumber,numberingInfo.listPattern);this.changeListId(numberingInfo.currentList,paragraph,paraFormat,numberingInfo.listLevelNumber,numberingInfo.listPattern);this.reLayout(selection,false);this.documentHelper.updateFocus();};Editor.prototype.getContinueNumberingInfo=function(paragraph){var currentList=undefined;var listLevelNumber=0;var listPattern='None';if(!sf.base.isNullOrUndefined(paragraph.paragraphFormat)&&!sf.base.isNullOrUndefined(paragraph.paragraphFormat.listFormat)){currentList=this.documentHelper.getListById(paragraph.paragraphFormat.listFormat.listId);listLevelNumber=paragraph.paragraphFormat.listFormat.listLevelNumber;}var documentHelper=this.documentHelper;if(listLevelNumber!==0&&!sf.base.isNullOrUndefined(currentList)&&!sf.base.isNullOrUndefined(documentHelper.getAbstractListById(currentList.abstractListId))&&!sf.base.isNullOrUndefined(documentHelper.getAbstractListById(currentList.abstractListId).levels[listLevelNumber])){var listLevel=this.documentHelper.layout.getListLevel(currentList,listLevelNumber);if(!sf.base.isNullOrUndefined(listLevel)){listPattern=listLevel.listLevelPattern;}}return{currentList:currentList,listLevelNumber:listLevelNumber,listPattern:listPattern};};/**
     * @private
     * @returns {void}
     */Editor.prototype.revertContinueNumbering=function(selection,format){var paragraph=selection.start.paragraph;var numberingInfo=this.getContinueNumberingInfo(paragraph);this.changeListId(numberingInfo.currentList,paragraph,format,numberingInfo.listLevelNumber,numberingInfo.listPattern);this.reLayout(selection,false);if(this.editorHistory&&!sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo)){this.editorHistory.updateHistory();}};Editor.prototype.changeListId=function(list,block,format,levelNum,listType){if(sf.base.isNullOrUndefined(block)){return;}if(block instanceof ParagraphWidget){if(list.listId===block.paragraphFormat.listFormat.listId&&levelNum===block.paragraphFormat.listFormat.listLevelNumber){if(this.editorHistory){var baseHistoryInfo=this.editorHistory.currentBaseHistoryInfo;if(!sf.base.isNullOrUndefined(baseHistoryInfo)){format=baseHistoryInfo.addModifiedPropertiesForContinueNumbering(block.paragraphFormat,format);}}block.paragraphFormat.copyFormat(format);this.documentHelper.layout.reLayoutParagraph(block,0,0);}}return this.changeListId(list,block.nextRenderedWidget,format,levelNum,listType);};Editor.prototype.getParagraphFormat=function(paragraph,levelNumber,listType){if(!sf.base.isNullOrUndefined(paragraph.previousRenderedWidget)){if(paragraph.previousRenderedWidget instanceof ParagraphWidget){if(!sf.base.isNullOrUndefined(paragraph.previousRenderedWidget.paragraphFormat.listFormat)&&paragraph.previousRenderedWidget.paragraphFormat.listFormat.listId!==-1){var listLevel=this.selection.getListLevel(paragraph.previousRenderedWidget);if(levelNumber===0){return paragraph.previousRenderedWidget.paragraphFormat;}else if(listType===listLevel.listLevelPattern||this.checkNumberArabic(listType,listLevel.listLevelPattern)){return paragraph.previousRenderedWidget.paragraphFormat;}else{return this.getParagraphFormat(paragraph.previousRenderedWidget,levelNumber,listType);}}else{return this.getParagraphFormat(paragraph.previousRenderedWidget,levelNumber,listType);}}}return undefined;};Editor.prototype.checkNumberArabic=function(listType,levelPattern){if(listType==='Number'&&levelPattern==='Arabic'||levelPattern==='Number'&&listType==='Arabic'){return true;}return false;};/**
     * @private
     * @returns {void}
     */Editor.prototype.applyRestartNumbering=function(selection){if(this.editorHistory){this.editorHistory.initializeHistory('RestartNumbering');}this.restartListAt(selection);};/**
     * @private
     * @returns {void}
     */Editor.prototype.restartListAt=function(selection){var currentList=selection.paragraphFormat.getList();var list=currentList.clone();list.listId=this.documentHelper.lists[this.documentHelper.lists.length-1].listId+1;this.documentHelper.lists.push(list);var abstractList=currentList.abstractList.clone();abstractList.abstractListId=this.documentHelper.abstractLists[this.documentHelper.abstractLists.length-1].abstractListId+1;list.abstractListId=abstractList.abstractListId;list.abstractList=abstractList;this.documentHelper.abstractLists.push(abstractList);this.restartListAtInternal(selection,list.listId);};/**
     * @private
     * @returns {void}
     */Editor.prototype.restartListAtInternal=function(selection,listId){var numberingInfo=this.getContinueNumberingInfo(selection.start.paragraph);this.changeRestartNumbering(numberingInfo.currentList,selection.start.paragraph,listId);this.reLayout(selection,false);this.incrementListNumber=-1;this.refListNumber=undefined;this.documentHelper.updateFocus();};Editor.prototype.changeRestartNumbering=function(list,block,listId){if(sf.base.isNullOrUndefined(block)){return;}if(block instanceof ParagraphWidget){if(list.listId===block.paragraphFormat.listFormat.listId){if(this.editorHistory){var baseHistoryInfo=this.editorHistory.currentBaseHistoryInfo;if(!sf.base.isNullOrUndefined(baseHistoryInfo)){listId=baseHistoryInfo.addModifiedPropertiesForRestartNumbering(block.paragraphFormat.listFormat,listId);}}block.paragraphFormat.listFormat.listId=listId;if(this.refListNumber===undefined&&this.incrementListNumber===-1){this.incrementListNumber=block.paragraphFormat.listFormat.listLevelNumber-1;}if(this.refListNumber!==block.paragraphFormat.listFormat.listLevelNumber){this.incrementListNumber+=1;this.refListNumber=block.paragraphFormat.listFormat.listLevelNumber;}block.paragraphFormat.listFormat.listLevelNumber=this.incrementListNumber;this.documentHelper.layout.reLayoutParagraph(block,0,0);}}return this.changeRestartNumbering(list,block.nextRenderedWidget,listId);};Editor.prototype.applyParaFormat=function(paragraph,start,end,property,value,update){this.setOffsetValue(this.selection);paragraph=paragraph.combineWidget(this.owner.viewer);//Apply Paragraph Format for spitted paragraph
this.applyParaFormatProperty(paragraph,property,value,update);this.layoutItemBlock(paragraph,false);this.getOffsetValue(this.selection);if(paragraph.equals(end.paragraph)){return;}this.getNextParagraphForFormatting(paragraph,start,end,property,value,update);};Editor.prototype.applyCharacterStyle=function(paragraph,start,end,property,value,update){var paragraphWidget=paragraph.getSplitWidgets();var selection=end.owner.selection;var lastLine=end.currentWidget;var isParaSelected=start.offset===0&&(selection.isParagraphLastLine(lastLine)&&end.currentWidget===lastLine&&end.offset===selection.getLineLength(lastLine)+1||end.isAtParagraphEnd);if(!isParaSelected&&(end.paragraph===paragraph||paragraphWidget.indexOf(end.paragraph)!==-1)){if(value.type==='Paragraph'&&value.link instanceof WCharacterStyle||value.type==='Character'){var obj=value.type==='Character'?value:value.link;this.updateSelectionCharacterFormatting(property,obj,update);return true;}}return false;};// Cell
Editor.prototype.applyParaFormatInCell=function(cell,start,end,property,value,update){var selection=this.documentHelper.selection;if(end.paragraph.isInsideTable){var cellContainer=selection.getContainerCellOf(cell,end.paragraph.associatedCell);if(cellContainer.ownerTable.contains(end.paragraph.associatedCell)){var startCell=selection.getSelectedCell(cell,cellContainer);var endCell=selection.getSelectedCell(end.paragraph.associatedCell,cellContainer);if(selection.containsCell(cellContainer,end.paragraph.associatedCell)){//Selection end is in container cell.
if(selection.isCellSelected(cellContainer,start,end)){value=this.getParaFormatValueInCell(cellContainer,property,value);this.applyParaFormatCellInternal(cellContainer,property,value,update);}else{if(startCell===cellContainer){this.applyParaFormat(start.paragraph,start,end,property,value,update);}else{this.applyParagraphFormatRow(startCell.ownerRow,start,end,property,value,update);}}}else{//Format other selected cells in current table.
this.applyParaFormatTableCell(cellContainer.ownerTable,cellContainer,endCell,property,value,update);}}else{this.applyParagraphFormatRow(cellContainer.ownerRow,start,end,property,value,update);}}else{var wCell=selection.getContainerCell(cell);this.applyParagraphFormatRow(wCell.ownerRow,start,end,property,value,update);}};Editor.prototype.applyParaFormatCellInternal=function(cell,property,value,update){for(var i=0;i<cell.childWidgets.length;i++){var block=cell.childWidgets[i];if(block instanceof ParagraphWidget){this.applyParaFormatProperty(block,property,value,update);}else{this.applyParagraphFormatTableInternal(block,property,value,update);}}};Editor.prototype.getParaFormatValueInCell=function(cell,property,value){if(typeof value==='boolean'){var firstPara=this.documentHelper.selection.getFirstParagraph(cell);value=!firstPara.paragraphFormat.getPropertyValue(property);}return value;};// Row
Editor.prototype.applyParagraphFormatRow=function(wRow,start,end,property,value,update){value=this.getParaFormatValueInCell(wRow.childWidgets[0],property,value);for(var i=wRow.rowIndex;i<wRow.ownerTable.childWidgets.length;i++){var row=wRow.ownerTable.childWidgets[i];for(var j=0;j<row.childWidgets.length;j++){this.applyParaFormatCellInternal(row.childWidgets[j],property,value,update);}if(end.paragraph.isInsideTable&&this.documentHelper.selection.containsRow(row,end.paragraph.associatedCell)){return;}}this.getNextParagraphForFormatting(wRow.ownerTable,start,end,property,value,update);};// Table
Editor.prototype.applyParaFormatTableCell=function(table,startCell,endCell,property,value,update){var selection=this.documentHelper.selection;var startValue=selection.getCellLeft(startCell.ownerRow,startCell);var endValue=startValue+startCell.cellFormat.cellWidth;var endCellLeft=selection.getCellLeft(endCell.ownerRow,endCell);var endCellRight=endCellLeft+endCell.cellFormat.cellWidth;var cellInfo=this.updateSelectedCellsInTable(startValue,endValue,endCellLeft,endCellRight);startValue=cellInfo.start;endValue=cellInfo.end;var count=table.childWidgets.indexOf(endCell.ownerRow);var isStarted=false;for(var m=table.childWidgets.indexOf(startCell.ownerRow);m<=count;m++){var row=table.childWidgets[m];for(var j=0;j<row.childWidgets.length;j++){var left=selection.getCellLeft(row,row.childWidgets[j]);if(Math.round(startValue)<=Math.round(left)&&Math.round(left)<Math.round(endValue)){if(!isStarted){value=this.getParaFormatValueInCell(row.childWidgets[j],property,value);isStarted=true;}this.applyParaFormatCellInternal(row.childWidgets[j],property,value,update);}}}};Editor.prototype.applyParaFormatTable=function(table,start,end,property,value,update){table=table.combineWidget(this.owner.viewer);var selection=this.documentHelper.selection;for(var m=0;m<table.childWidgets.length;m++){var tableRow=table.childWidgets[m];for(var k=0;k<tableRow.childWidgets.length;k++){this.applyParaFormatCellInternal(tableRow.childWidgets[k],property,value,update);}if(end.paragraph.isInsideTable&&selection.containsRow(tableRow,end.paragraph.associatedCell)){this.documentHelper.layout.layoutBodyWidgetCollection(table.index,table.containerWidget,table,false);return;}}this.documentHelper.layout.layoutBodyWidgetCollection(table.index,table.containerWidget,table,false);this.getNextParagraphForFormatting(table,start,end,property,value,update);};Editor.prototype.getNextParagraphForFormatting=function(block,start,end,property,value,update){var widgetCollection=block.getSplitWidgets();block=widgetCollection[widgetCollection.length-1];block=this.documentHelper.selection.getNextRenderedBlock(block);if(!sf.base.isNullOrUndefined(block)){//Goto the next block.
if(block instanceof ParagraphWidget){this.applyParaFormat(block,start,end,property,value,update);}else{this.applyParaFormatTable(block,start,end,property,value,update);}}};Editor.prototype.applyParagraphFormatTableInternal=function(table,property,value,update){for(var x=0;x<table.childWidgets.length;x++){var row=table.childWidgets[x];for(var y=0;y<row.childWidgets.length;y++){this.applyParaFormatCellInternal(row.childWidgets[y],property,value,update);}}};//Paragraph Format apply implementation Ends
// Apply Selection Section Format Option Implementation Starts
/**
     * Apply section format selection changes
     *
     * @param {string} property - Specifies the property
     * @param {Object} value - Specifies the value
     * @private
     * @returns {void}
     */Editor.prototype.onApplySectionFormat=function(property,value){if(this.restrictFormatting){return;}if(!sf.base.isNullOrUndefined(property)){var action=property[0].toUpperCase()+property.slice(1);this.initHistory(action);}else{this.initHistory('SectionFormat');}this.updateSectionFormat(property,value);};/**
     * Update section format
     *
     * @param {string} property - Specifies the property
     * @param {Object} value - Specifies the value
     * @private
     * @returns {void}
     */Editor.prototype.updateSectionFormat=function(property,value){var selection=this.documentHelper.selection;selection.owner.isShiftingEnabled=true;var startPosition=selection.start;var endPosition=selection.end;if(!selection.isForward){startPosition=selection.end;endPosition=selection.start;}var startPageIndex;var endPageIndex;this.documentHelper.clearContent();var startSectionIndex=startPosition.paragraph.bodyWidget.sectionIndex;var endSectionIndex=endPosition.paragraph.bodyWidget.sectionIndex;for(var i=0;i<this.documentHelper.pages.length;i++){if(this.documentHelper.pages[i].bodyWidgets[0].index===startSectionIndex){startPageIndex=i;break;}}for(var i=startPageIndex;i<this.documentHelper.pages.length;i++){var bodyWidget=this.documentHelper.pages[i].bodyWidgets[0];endPageIndex=i;if(bodyWidget.index===startSectionIndex){continue;}else if(bodyWidget.index>=startSectionIndex&&bodyWidget.index<=endSectionIndex){continue;}else{endPageIndex=i-1;break;}}// let startPageIndex: number = this.documentHelper.pages.indexOf((selection.start.paragraph.containerWidget as BodyWidget).page);
// let endPageIndex: number = this.documentHelper.pages.indexOf((selection.end.paragraph.containerWidget as BodyWidget).page);
var update=true;var index=0;for(var i=startPageIndex;i<=endPageIndex;i++){if(index!==this.documentHelper.pages[i].bodyWidgets[0].index&&!update){update=true;}this.applyPropertyValueForSection(this.documentHelper.pages[i].bodyWidgets[0].sectionFormat,property,value,update);index=this.documentHelper.pages[i].bodyWidgets[0].index;update=false;}this.layoutWholeDocument();this.fireContentChange();};//Apply Selection Table Format option implementation starts
/**
     * Apply table format property changes
     *
     * @param {string} property - Specifies the property
     * @param {Object} value - Specifies the value
     * @private
     * @returns {void}
     */Editor.prototype.onApplyTableFormat=function(property,value){if(this.restrictFormatting){return;}var action=this.getTableFormatAction(property);this.viewer.owner.isShiftingEnabled=true;var selection=this.documentHelper.selection;var table=selection.start.paragraph.associatedCell.ownerTable;table=table.combineWidget(this.owner.viewer);if(selection.isEmpty){this.initHistory(action);this.applyTablePropertyValue(selection,property,value,table);}else{this.updateSelectionTableFormat(this.selection,action,value);}table.calculateGrid();this.selection.owner.isLayoutEnabled=true;this.documentHelper.layout.reLayoutTable(table);this.reLayout(selection,false);};Editor.prototype.getTableFormatAction=function(property){switch(property){case'tableAlignment':return'TableAlignment';case'leftIndent':return'TableLeftIndent';case'leftMargin':return'DefaultCellLeftMargin';case'rightMargin':return'DefaultCellRightMargin';case'bottomMargin':return'DefaultCellBottomMargin';case'topMargin':return'DefaultCellTopMargin';case'preferredWidth':return'TablePreferredWidth';case'preferredWidthType':return'TablePreferredWidthType';case'shading':return'Shading';case'bidi':return'TableBidi';default:return'DefaultCellSpacing';}};// Apply Selection Row Format Option Implementation Starts
/**
     * Apply table row format property changes
     *
     * @param {string} property - Specifies the property
     * @param {Object} value - Specifies the value
     * @private
     * @returns {void}
     */Editor.prototype.onApplyTableRowFormat=function(property,value){if(this.restrictFormatting){return;}var action=this.getRowAction(property);this.documentHelper.owner.isShiftingEnabled=true;var selection=this.documentHelper.selection;if(selection.isEmpty){this.initHistory(action);var table=selection.start.paragraph.associatedCell.ownerRow.ownerTable;this.applyRowPropertyValue(selection,property,value,selection.start.paragraph.associatedCell.ownerRow);}else{this.updateSelectionTableFormat(this.selection,action,value);}this.reLayout(selection,false);};Editor.prototype.getRowAction=function(property){switch(property){case'height':return'RowHeight';case'heightType':return'RowHeightType';case'isHeader':return'RowHeader';default:return'AllowBreakAcrossPages';}};/**
     * Apply table cell property changes
     *
     * @param {string} property - Specifies the property
     * @param {Object} value - Specifies the value
     * @private
     * @returns {void}
     */Editor.prototype.onApplyTableCellFormat=function(property,value){if(this.restrictFormatting){return;}var action=this.getTableCellAction(property);this.documentHelper.owner.isShiftingEnabled=true;var selection=this.documentHelper.selection;var table=selection.start.paragraph.associatedCell.ownerTable;table=table.combineWidget(this.owner.viewer);if(selection.isEmpty){this.initHistory(action);this.applyCellPropertyValue(selection,property,value,selection.start.paragraph.associatedCell.cellFormat);table.calculateGrid();this.selection.owner.isLayoutEnabled=true;this.documentHelper.layout.reLayoutTable(table);}else{this.updateSelectionTableFormat(this.selection,action,value);}this.reLayout(selection,false);};Editor.prototype.getTableCellAction=function(property){switch(property){case'verticalAlignment':return'CellContentVerticalAlignment';case'leftMargin':return'CellLeftMargin';case'rightMargin':return'CellRightMargin';case'bottomMargin':return'CellBottomMargin';case'topMargin':return'CellTopMargin';case'preferredWidth':return'CellPreferredWidth';case'shading':return'Shading';default:return'CellPreferredWidthType';}};Editor.prototype.applyPropertyValueForSection=function(sectionFormat,property,value,update){//let selection: Selection = this.documentHelper.selection;
if(update&&this.editorHistory&&!sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo)){value=this.editorHistory.currentBaseHistoryInfo.addModifiedPropertiesForSection(sectionFormat,property,value);}if(sf.base.isNullOrUndefined(value)){return;}if(value instanceof WSectionFormat){if(sf.base.isNullOrUndefined(property)){sectionFormat.copyFormat(value,this.editorHistory);}return;}if(property==='pageHeight'){sectionFormat.pageHeight=value;}else if(property==='pageWidth'){sectionFormat.pageWidth=value;}else if(property==='leftMargin'){sectionFormat.leftMargin=value;}else if(property==='rightMargin'){sectionFormat.rightMargin=value;}else if(property==='topMargin'){sectionFormat.topMargin=value;}else if(property==='bottomMargin'){sectionFormat.bottomMargin=value;}else if(property==='differentFirstPage'){sectionFormat.differentFirstPage=value;}else if(property==='differentOddAndEvenPages'){sectionFormat.differentOddAndEvenPages=value;}else if(property==='headerDistance'){sectionFormat.headerDistance=value;}else if(property==='footerDistance'){sectionFormat.footerDistance=value;}else if(property==='pageStartingNumber'){sectionFormat.pageStartingNumber=value;}else if(property==='restartPageNumbering'){sectionFormat.restartPageNumbering=value;}else if(property==='endnoteNumberFormat'){sectionFormat.endnoteNumberFormat=value;}else if(property==='footNoteNumberFormat'){sectionFormat.footNoteNumberFormat=value;}else if(property==='restartIndexForEndnotes'){sectionFormat.restartIndexForEndnotes=value;}else if(property==='restartIndexForFootnotes'){sectionFormat.restartIndexForFootnotes=value;}else if(property==='initialFootNoteNumber'){sectionFormat.initialFootNoteNumber=value;}else if(property==='initialEndNoteNumber'){sectionFormat.initialEndNoteNumber=value;}};/**
     * @private
     * @returns {void}
     */Editor.prototype.layoutWholeDocument=function(){this.documentHelper.layout.isLayoutWhole=true;var startPosition=this.documentHelper.selection.start;var endPosition=this.documentHelper.selection.end;if(startPosition.isExistAfter(endPosition)){startPosition=this.documentHelper.selection.end;endPosition=this.documentHelper.selection.start;}var startInfo=this.selection.getParagraphInfo(startPosition);var endInfo=this.selection.getParagraphInfo(endPosition);var startIndex=this.selection.getHierarchicalIndex(startInfo.paragraph,startInfo.offset.toString());var endIndex=this.selection.getHierarchicalIndex(endInfo.paragraph,endInfo.offset.toString());this.documentHelper.renderedLists.clear();this.documentHelper.renderedLevelOverrides=[];// this.viewer.owner.isLayoutEnabled = true;
var sections=this.combineSection();this.documentHelper.clearContent();// this.documentHelper.layout.isRelayout = false;
this.documentHelper.layout.layoutItems(sections,true);// this.documentHelper.layout.isRelayout = true;
this.documentHelper.owner.isShiftingEnabled=false;this.setPositionForCurrentIndex(startPosition,startIndex);this.setPositionForCurrentIndex(endPosition,endIndex);this.documentHelper.selection.selectPosition(startPosition,endPosition);this.reLayout(this.documentHelper.selection);this.documentHelper.layout.isLayoutWhole=false;};Editor.prototype.combineSection=function(){var sections=[];var nextSection=this.documentHelper.pages[0].bodyWidgets[0];do{nextSection=this.combineSectionChild(nextSection,sections);}while(nextSection);return sections;};Editor.prototype.combineSectionChild=function(bodyWidget,sections){var previousBodyWidget=bodyWidget;var temp=new BodyWidget();temp.sectionFormat=bodyWidget.sectionFormat;temp.index=previousBodyWidget.index;do{previousBodyWidget=bodyWidget;if(bodyWidget.lastChild){bodyWidget.lastChild.combineWidget(this.owner.viewer);}bodyWidget=bodyWidget.nextRenderedWidget;for(var j=0;j<previousBodyWidget.childWidgets.length;j++){var block=previousBodyWidget.childWidgets[j];if(block instanceof TableWidget){this.documentHelper.layout.clearTableWidget(block,true,true,true);}else{block.x=0;block.y=0;block.width=0;block.height=0;}temp.childWidgets.push(block);previousBodyWidget.childWidgets.splice(j,1);j--;block.containerWidget=temp;}previousBodyWidget.page.destroy();// this.documentHelper.pages.splice(previousBodyWidget.page.index, 1);
}while(bodyWidget&&previousBodyWidget.equals(bodyWidget));sections.push(temp);return bodyWidget;};Editor.prototype.updateSelectionTableFormat=function(selection,action,value){switch(action){case'TableAlignment':this.editorHistory.initializeHistory('TableAlignment');this.updateTableFormat(selection,'tableAlignment',value);break;case'TableLeftIndent':this.editorHistory.initializeHistory('TableLeftIndent');this.updateTableFormat(selection,'leftIndent',value);break;case'DefaultCellSpacing':this.editorHistory.initializeHistory('DefaultCellSpacing');this.updateTableFormat(selection,'cellSpacing',value);break;case'DefaultCellLeftMargin':this.editorHistory.initializeHistory('DefaultCellLeftMargin');this.updateTableFormat(selection,'leftMargin',value);break;case'DefaultCellRightMargin':this.editorHistory.initializeHistory('DefaultCellRightMargin');this.updateTableFormat(selection,'rightMargin',value);break;case'DefaultCellTopMargin':this.editorHistory.initializeHistory('DefaultCellTopMargin');this.updateTableFormat(selection,'topMargin',value);break;case'TablePreferredWidth':this.editorHistory.initializeHistory('TablePreferredWidth');this.updateTableFormat(selection,'preferredWidth',value);break;case'TablePreferredWidthType':this.editorHistory.initializeHistory('TablePreferredWidthType');this.updateTableFormat(selection,'preferredWidthType',value);break;case'DefaultCellBottomMargin':this.editorHistory.initializeHistory('DefaultCellBottomMargin');this.updateTableFormat(selection,'bottomMargin',value);break;case'CellContentVerticalAlignment':this.editorHistory.initializeHistory('CellContentVerticalAlignment');this.updateCellFormat(selection,'verticalAlignment',value);break;case'CellLeftMargin':this.editorHistory.initializeHistory('CellLeftMargin');this.updateCellFormat(selection,'leftMargin',value);break;case'CellRightMargin':this.editorHistory.initializeHistory('CellRightMargin');this.updateCellFormat(selection,'rightMargin',value);break;case'CellTopMargin':this.editorHistory.initializeHistory('CellTopMargin');this.updateCellFormat(selection,'topMargin',value);break;case'CellBottomMargin':this.editorHistory.initializeHistory('CellBottomMargin');this.updateCellFormat(selection,'bottomMargin',value);break;case'CellPreferredWidth':this.editorHistory.initializeHistory('CellPreferredWidth');this.updateCellFormat(selection,'preferredWidth',value);break;case'CellPreferredWidthType':this.editorHistory.initializeHistory('CellPreferredWidthType');this.updateCellFormat(selection,'preferredWidthType',value);break;case'Shading':this.editorHistory.initializeHistory('Shading');this.updateCellFormat(selection,'shading',value);break;case'RowHeight':this.editorHistory.initializeHistory('RowHeight');this.updateRowFormat(selection,'height',value);break;case'RowHeightType':this.editorHistory.initializeHistory('RowHeightType');this.updateRowFormat(selection,'heightType',value);break;case'RowHeader':this.editorHistory.initializeHistory('RowHeader');this.updateRowFormat(selection,'isHeader',value);break;case'AllowBreakAcrossPages':this.editorHistory.initializeHistory('AllowBreakAcrossPages');this.updateRowFormat(selection,'allowBreakAcrossPages',value);break;case'TableBidi':this.editorHistory.initializeHistory(action);this.updateTableFormat(selection,'bidi',value);break;}};// Update Table Properties
/**
     * Update Table Format on undo
     *
     * @param {Selection} selection - Specifies the selection
     * @param {string} property - Specifies the property
     * @param {Object} value - Specifies the value
     * @private
     * @returns {void}
     */Editor.prototype.updateTableFormat=function(selection,property,value){var tableStartPosition=selection.start;var tableEndPosition=selection.end;if(!selection.isForward){tableStartPosition=selection.end;tableEndPosition=selection.start;}this.initHistoryPosition(selection,tableStartPosition);this.applyTablePropertyValue(selection,property,value,tableStartPosition.paragraph.associatedCell.ownerTable);if(this.editorHistory&&(this.editorHistory.isUndoing||this.editorHistory.isRedoing)){this.documentHelper.layout.reLayoutTable(tableStartPosition.paragraph.associatedCell.ownerTable);}};/**
     * update cell format on undo
     *
     * @param {Selection} selection - Specifies the selection
     * @param {string} property - Specifies the property
     * @param {Object} value - Specifies the value
     * @private
     * @returns {void}
     */Editor.prototype.updateCellFormat=function(selection,property,value){selection.owner.isShiftingEnabled=true;var newStartPosition=selection.start;var newEndPosition=selection.end;if(!selection.isForward){newStartPosition=selection.end;newEndPosition=selection.start;}this.initHistoryPosition(selection,newStartPosition);this.updateFormatForCell(selection,property,value);};/**
     * Update row format on undo
     *
     * @param {Selection} selection - Specifies the selection
     * @param {string} property - Specifies the property
     * @param {Object} value - Specifies the value
     * @private
     * @returns {void}
     */Editor.prototype.updateRowFormat=function(selection,property,value){var rowStartPosition=selection.start;var rowEndPosition=selection.end;if(!selection.isForward){rowStartPosition=selection.end;rowEndPosition=selection.start;}this.initHistoryPosition(selection,rowStartPosition);this.applyRowFormat(rowStartPosition.paragraph.associatedCell.ownerRow,rowStartPosition,rowEndPosition,property,value);};Editor.prototype.initHistoryPosition=function(selection,position){if(this.documentHelper.owner.editorHistoryModule&&!sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo)){if(!sf.base.isNullOrUndefined(position)){if(sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo.insertPosition)){this.editorHistory.currentBaseHistoryInfo.insertPosition=position.getHierarchicalIndexInternal();}}else if(sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo.insertPosition)){this.editorHistory.currentBaseHistoryInfo.insertPosition=selection.start.getHierarchicalIndexInternal();}}};Editor.prototype.startSelectionReLayouting=function(paragraph,selection,start,end){selection.owner.isLayoutEnabled=true;if(start.paragraph.isInsideTable){var table=start.paragraph.associatedCell.ownerTable;while(table.isInsideTable){table=table.associatedCell.ownerTable;}this.reLayoutSelectionOfTable(table,selection,start,end);}else{this.reLayoutSelection(paragraph,selection,start,end);}};Editor.prototype.reLayoutSelectionOfTable=function(table,selection,start,end){var isEnded=false;this.documentHelper.layout.layoutBodyWidgetCollection(table.index,table.containerWidget,table,false);// If the selection ends in the current table, need to stop relayouting.
if(!sf.base.isNullOrUndefined(end.paragraph.associatedCell)&&table.contains(end.paragraph.associatedCell)){return true;}var block=selection.getNextRenderedBlock(table);// Relayout the next block.
if(!sf.base.isNullOrUndefined(block)){isEnded=this.reLayoutSelectionOfBlock(block,selection,start,end);}return isEnded;};Editor.prototype.reLayoutSelection=function(paragraph,selection,start,end){if(start.paragraph===paragraph){var startOffset=start.offset;var length_2=selection.getParagraphLength(paragraph);var indexInInline=0;var index=0;var inlineObj=paragraph.getInline(start.offset,indexInInline);var inline=inlineObj.element;indexInInline=inlineObj.index;if(!sf.base.isNullOrUndefined(inline)){if(indexInInline===inline.length&&!sf.base.isNullOrUndefined(inline.nextNode)){inline=inline.nextNode;}index=inline.line.children.indexOf(inline);}var lineIndex=0;if(start.currentWidget.paragraph===paragraph){lineIndex=paragraph.childWidgets.indexOf(start.currentWidget);index=start.currentWidget.children.indexOf(inline);}// If selection start inline is at new inline, need to relayout from the previous inline.
if(inline instanceof TextElementBox&&!inline.line&&index>0){this.documentHelper.layout.reLayoutParagraph(paragraph,lineIndex,index-1);}else{this.documentHelper.layout.reLayoutParagraph(paragraph,lineIndex,index);}}else{this.documentHelper.layout.reLayoutParagraph(paragraph,0,0);}// If the selection ends at the current paragraph, need to stop relayouting.
if(end.paragraph===paragraph){return true;}// _Relayout the next block.
var block=selection.getNextRenderedBlock(paragraph);if(!sf.base.isNullOrUndefined(block)){return this.reLayoutSelectionOfBlock(block,selection,start,end);}return false;};//Relayouting Start    
Editor.prototype.reLayoutSelectionOfBlock=function(block,selection,start,end){if(block instanceof ParagraphWidget){return this.reLayoutSelection(block,selection,start,end);}else{return undefined;// return this.reLayoutSelectionOfTable(block as TableWidget, selection, start, end);
}};/**
     * @private
     * @returns {void}
     */Editor.prototype.layoutItemBlock=function(block,shiftNextWidget){var section=undefined;if(block.containerWidget instanceof BlockContainer){// let index: number = section.childWidgets.indexOf(block);
if(!sf.base.isNullOrUndefined(this.documentHelper.owner)&&this.documentHelper.owner.isLayoutEnabled){block=block.combineWidget(this.viewer);section=block.containerWidget;this.documentHelper.layout.layoutBodyWidgetCollection(block.index,section,block,false);}}else if(block.containerWidget instanceof TableCellWidget){var cell=block.containerWidget;cell=this.documentHelper.selection.getContainerCell(cell);if(!sf.base.isNullOrUndefined(this.documentHelper.owner)&&this.documentHelper.owner.isLayoutEnabled){this.documentHelper.layout.reLayoutTable(block);}}};/**
     * @private
     * @returns {boolean}
     */Editor.prototype.removeSelectedContents=function(selection){return this.removeSelectedContentInternal(selection,selection.start,selection.end);};Editor.prototype.removeSelectedContentInternal=function(selection,startPosition,endPosition){var startPos=startPosition;var endPos=endPosition;if(!startPosition.isExistBefore(endPosition)){startPos=endPosition;endPos=startPosition;}if(startPos.paragraph===endPos.paragraph&&startPos.paragraph.childWidgets.indexOf(startPos.currentWidget)===startPos.paragraph.childWidgets.length-1&&startPos.offset===selection.getParagraphLength(startPos.paragraph)&&startPos.offset+1===endPos.offset){selection.owner.isShiftingEnabled=true;selection.selectContent(startPos,true);return true;}var paragraphInfo=this.selection.getParagraphInfo(startPos);selection.editPosition=this.selection.getHierarchicalIndex(paragraphInfo.paragraph,paragraphInfo.offset.toString());var isRemoved=this.removeSelectedContent(endPos.paragraph,selection,startPos,endPos);var textPosition=new TextPosition(selection.owner);this.setPositionForCurrentIndex(textPosition,selection.editPosition);selection.selectContent(textPosition,true);return isRemoved;};Editor.prototype.removeSelectedContent=function(paragraph,selection,start,end){//If end is not table end and start is outside the table, then skip removing the contents and move caret to start position.
if(end.paragraph.isInsideTable&&end.paragraph!==selection.getLastParagraphInLastCell(end.paragraph.associatedCell.ownerTable)&&(!start.paragraph.isInsideTable||start.paragraph.associatedCell.ownerTable.index!==end.paragraph.associatedCell.ownerTable.index)){return false;}selection.owner.isShiftingEnabled=true;this.deleteSelectedContent(paragraph,selection,start,end,2);return true;};Editor.prototype.deleteSelectedContent=function(paragraph,selection,start,end,editAction){var indexInInline=0;var inlineObj=start.currentWidget.getInline(start.offset,indexInInline);var inline=inlineObj.element;indexInInline=inlineObj.index;// if (!isNullOrUndefined(inline)) {
//     inline = selection.getNextRenderedInline(inline, indexInInline);
// }
// if (inline instanceof WFieldBegin && !isNullOrUndefined((inline as WFieldBegin).fieldEnd)) {
//     let fieldEndOffset: number = ((inline as WFieldBegin).fieldEnd.owner as WParagraph).getOffset((inline as WFieldBegin).fieldEnd, 1);
//     let fieldEndIndex: string = WordDocument.getHierarchicalIndexOf((inline as WFieldBegin).fieldEnd.owner as WParagraph, fieldEndOffset.toString());
//     let selectionEndIndex: string = end.getHierarchicalIndexInternal();
//     if (!TextPosition.isForwardSelection(fieldEndIndex, selectionEndIndex)) {
//         //If selection end is after field begin, moves selection start to field separator.
//         start.moveToInline((inline as WFieldBegin).fieldSeparator, 1);
//         selection.editPosition = start.getHierarchicalIndexInternal();
//         if (!isNullOrUndefined(selection.currentBaseHistoryInfo)) {
//             selection.currentBaseHistoryInfo.insertPosition = selection.editPosition;
//         }
//     }
// }
indexInInline=0;inlineObj=end.currentWidget.getInline(end.offset,indexInInline);inline=inlineObj.element;indexInInline=inlineObj.index;// if (!isNullOrUndefined(inline)) {
//     inline = selection.getNextRenderedInline(inline, indexInInline);
// }
// if (inline instanceof WFieldEnd && !isNullOrUndefined((inline as WFieldEnd).fieldBegin)) {
//     let fieldBeginOffset: number = ((inline as WFieldEnd).fieldBegin.owner as WParagraph).getOffset((inline as WFieldEnd).fieldBegin, 0);
//     let fieldBeginIndex: string = WordDocument.getHierarchicalIndexOf((inline as WFieldEnd).fieldBegin.owner as WParagraph, fieldBeginOffset.toString());
//     let selectionStartIndex: string = start.getHierarchicalIndexInternal();
//     if (!TextPosition.isForwardSelection(selectionStartIndex, fieldBeginIndex)) {
//         //If field begin is before selection start, move selection end to inline item before field end.
//         let prevInline: WInline = selection.getPreviousTextInline(inline);
//         if (isNullOrUndefined(prevInline)) {
//             end.moveBackward();
//         } else {
//             end.moveToInline(prevInline, prevInline.length);
//         }
//     }
// }
// if (inline instanceof FootnoteElementBox) {
//     this.removeFootnote(inline);
// }
if(end.paragraph!==paragraph){this.deleteSelectedContent(end.paragraph,selection,start,end,editAction);return;}//  Selection start in cell.
if(end.paragraph.isInsideTable&&(!start.paragraph.isInsideTable||start.paragraph.associatedCell!==end.paragraph.associatedCell||selection.isCellSelected(end.paragraph.associatedCell,start,end))){end.paragraph.associatedCell.ownerTable.combineWidget(this.owner.viewer);this.deleteTableCell(end.paragraph.associatedCell,selection,start,end,editAction);}else{this.deletePara(paragraph,start,end,editAction);if(this.delBlockContinue&&this.delBlock){if(this.delSection){var bodyWidget=paragraph.bodyWidget instanceof BodyWidget?paragraph.bodyWidget:undefined;this.deleteSection(selection,this.delSection,bodyWidget,editAction);this.delSection=undefined;}this.deleteBlock(this.delBlock,selection,start,end,editAction);this.delBlockContinue=false;this.delBlock=undefined;}}if(this.removeCommentCharacters.length>0&&!this.isCmtDeleteStarted){for(var k=0;k<this.removeCommentCharacters.length;k++){var currentBaseHistryInfo=this.editorHistory.currentBaseHistoryInfo;var commentStartChar=this.removeCommentCharacters[k];this.isCmtDeleteStarted=true;if(commentStartChar.commentMark){commentStartChar.removeCommentMark();}if(commentStartChar.line&&commentStartChar.line.paragraph&&commentStartChar.line.paragraph.bodyWidget&&currentBaseHistryInfo){this.removeInline(commentStartChar);this.selection.editPosition=currentBaseHistryInfo.insertPosition;this.isCmtDeleteStarted=false;if(this.editorHistory.currentHistoryInfo){this.editorHistory.currentHistoryInfo.insertPosition=currentBaseHistryInfo.insertPosition;this.editorHistory.currentHistoryInfo.endPosition=currentBaseHistryInfo.insertPosition;this.editorHistory.currentHistoryInfo.selectionStart=currentBaseHistryInfo.selectionStart;this.editorHistory.currentHistoryInfo.selectionEnd=currentBaseHistryInfo.selectionEnd;currentBaseHistryInfo.endPosition=currentBaseHistryInfo.insertPosition;this.editorHistory.updateComplexHistory();this.editorHistory.currentBaseHistoryInfo=undefined;}}}this.isCmtDeleteStarted=false;this.removeCommentCharacters=[];if(this.editorHistory.currentHistoryInfo){this.editorHistory.updateComplexHistory();this.editorHistory.currentBaseHistoryInfo=undefined;}this.selection.owner.isShiftingEnabled=false;}};/**
     * Merge the selected cells.
     *
     * @returns {void}
     */Editor.prototype.mergeCells=function(){if(this.owner.isReadOnlyMode||!this.canEditContentControl||!this.owner.isDocumentLoaded){return;}if(!sf.base.isNullOrUndefined(this.documentHelper)&&!this.selection.isEmpty){this.mergeSelectedCellsInTable();}};/**
     * Deletes the entire table at selection.
     *
     * @returns {void}
     */Editor.prototype.deleteTable=function(){if(this.owner.isReadOnlyMode||!this.canEditContentControl){return;}var startPos=this.selection.isForward?this.selection.start:this.selection.end;if(startPos.paragraph.isInsideTable){var table=this.getOwnerTable(this.selection.isForward).combineWidget(this.owner.viewer);this.selection.owner.isShiftingEnabled=true;if(this.checkIsNotRedoing()){this.initHistory('DeleteTable');//Sets the insert position in history info as current table.    
this.updateHistoryPosition(startPos,true);}var paragraph=this.getParagraphForSelection(table);if(this.editorHistory&&this.editorHistory.currentBaseHistoryInfo){this.editorHistory.currentBaseHistoryInfo.removedNodes.push(table.clone());}if(this.owner.enableTrackChanges){for(var i=0;i<table.childWidgets.length;i++){if(i===0){var nextCell=table.childWidgets[0];paragraph=this.selection.getFirstParagraph(nextCell);}this.trackRowDeletion(table.childWidgets[i]);}}else{this.removeBlock(table);}this.selection.selectParagraphInternal(paragraph,true);if(this.checkIsNotRedoing()||sf.base.isNullOrUndefined(this.editorHistory)){this.reLayout(this.selection);}}};/**
     * Deletes the selected column(s).
     *
     * @returns {void}
     */Editor.prototype.deleteColumn=function(){if(this.owner.isReadOnlyMode||!this.canEditContentControl){return;}if(this.owner.enableTrackChanges){// let locale: L10n = new L10n('documenteditor', this.owner.defaultLocale);
// locale.setLocale(this.owner.locale);
// this.alertDialog = DialogUtility.alert({
//     title: locale.getConstant('UnTrack'),
//     content: locale.getConstant('Merge Track'),
//     showCloseIcon: true,
//     okButton: {
//         text: 'Ok', click: this.onDeleteColumnConfirmed.bind(this)
//     },
//     closeOnEscape: true,
//     position: { X: 'center', Y: 'center' },
//     animationSettings: { effect: 'Zoom' }
// });
}else{this.onDeleteColumnConfirmed();}};Editor.prototype.onDeleteColumnConfirmed=function(){var startPos=this.selection.isForward?this.selection.start:this.selection.end;var endPos=this.selection.isForward?this.selection.end:this.selection.start;if(startPos.paragraph.isInsideTable){this.selection.owner.isShiftingEnabled=true;if(this.checkIsNotRedoing()){this.initHistory('DeleteColumn');}var startCell=this.getOwnerCell(this.selection.isForward);var endCell=this.getOwnerCell(!this.selection.isForward);var table=startCell.ownerTable.combineWidget(this.owner.viewer);if(this.editorHistory&&this.editorHistory.currentBaseHistoryInfo){this.cloneTableToHistoryInfo(table);}var paragraph=undefined;if(endCell.nextWidget){var nextCell=endCell.nextWidget;paragraph=this.selection.getFirstParagraph(nextCell);}else if(startCell.previousWidget){var previousCell=startCell.previousWidget;paragraph=this.selection.getFirstParagraph(previousCell);}if(sf.base.isNullOrUndefined(paragraph)){paragraph=this.getParagraphForSelection(table);}//retrieve the cell collection based on start and end cell to remove. 
var deleteCells=table.getColumnCellsForSelection(startCell,endCell);for(var i=0;i<table.childWidgets.length;i++){var row=table.childWidgets[i];if(row.childWidgets.length===1){if(deleteCells.indexOf(row.childWidgets[0])>=0){table.childWidgets.splice(table.childWidgets.indexOf(row),1);row.destroy();i--;}}else{for(var j=0;j<row.childWidgets.length;j++){var tableCell=row.childWidgets[j];if(deleteCells.indexOf(tableCell)>=0){row.childWidgets.splice(j,1);tableCell.destroy();j--;}}if(row.childWidgets.length===0){table.childWidgets.splice(table.childWidgets.indexOf(row),1);row.destroy();i--;}}}if(table.childWidgets.length===0){// Before disposing table reset the paragrph.
paragraph=this.getParagraphForSelection(table);this.removeBlock(table);if(this.editorHistory&&this.editorHistory.currentBaseHistoryInfo){this.editorHistory.currentBaseHistoryInfo.action='DeleteTable';}table.destroy();}else{table.isGridUpdated=false;table.buildTableColumns();table.isGridUpdated=true;this.documentHelper.layout.reLayoutTable(table);}this.selection.selectParagraphInternal(paragraph,true);if(sf.base.isNullOrUndefined(this.editorHistory)||this.checkIsNotRedoing()){this.reLayout(this.selection,true);}// if (!isNullOrUndefined(this.alertDialog)) {
//     this.alertDialog.close();
//     this.alertDialog = undefined;
// }
}};/**
     * Deletes the selected row(s).
     *
     * @returns {void}
     */Editor.prototype.deleteRow=function(){if(this.owner.isReadOnlyMode||!this.canEditContentControl){return;}var startPos=!this.selection.isForward?this.selection.end:this.selection.start;var endPos=!this.selection.isForward?this.selection.start:this.selection.end;var blockInfo=this.selection.getParagraphInfo(startPos);var startIndex=this.selection.getHierarchicalIndex(blockInfo.paragraph,blockInfo.offset.toString());if(startPos.paragraph.isInsideTable){var startCell=this.getOwnerCell(this.selection.isForward);var endCell=this.getOwnerCell(!this.selection.isForward);if(this.checkIsNotRedoing()){this.initHistory('DeleteRow');}this.selection.owner.isShiftingEnabled=true;var table=startCell.ownerTable.combineWidget(this.owner.viewer);var row=this.getOwnerRow(true);if(this.editorHistory&&this.editorHistory.currentBaseHistoryInfo){this.cloneTableToHistoryInfo(table);}var paragraph=undefined;if(row.nextWidget){var nextCell=row.nextWidget.childWidgets[0];paragraph=this.selection.getFirstParagraph(nextCell);}if(sf.base.isNullOrUndefined(paragraph)){paragraph=this.getParagraphForSelection(table);}startPos=startPos.clone();if(!this.selection.isEmpty){var containerCell=this.selection.getContainerCellOf(startCell,endCell);if(containerCell.ownerTable.contains(endCell)){startCell=this.selection.getSelectedCell(startCell,containerCell);endCell=this.selection.getSelectedCell(endCell,containerCell);if(this.selection.containsCell(containerCell,endCell)){row=startCell.ownerRow;this.removeRow(row);}else{row=startCell.ownerRow;var endRow=endCell.ownerRow;//Update the selection paragraph.
paragraph=undefined;if(endRow.nextWidget){var nextCell=endRow.nextWidget.childWidgets[0];paragraph=this.selection.getFirstParagraph(nextCell);}if(sf.base.isNullOrUndefined(paragraph)){paragraph=this.getParagraphForSelection(table);}for(var i=0;i<table.childWidgets.length;i++){var tableRow=table.childWidgets[i];if(tableRow.rowIndex>=row.rowIndex&&tableRow.rowIndex<=endRow.rowIndex){if(this.owner.enableTrackChanges&&this.checkIsNotRedoing()){this.trackRowDeletion(tableRow,true,false);}else{table.childWidgets.splice(i,1);tableRow.destroy();i--;}}}if(table.childWidgets.length===0){this.removeBlock(table);if(this.editorHistory&&this.editorHistory.currentBaseHistoryInfo){this.editorHistory.currentBaseHistoryInfo.action='DeleteTable';}table.destroy();}else{this.updateTable(table);}}}}else{if(this.owner.enableTrackChanges){this.trackRowDeletion(row,true,false);}else{this.removeRow(row);}}if(!this.owner.enableTrackChanges||sf.base.isNullOrUndefined(table.childWidgets)){this.selection.selectParagraphInternal(paragraph,true);}else{var textPosition=this.selection.getTextPosBasedOnLogicalIndex(startIndex);this.selection.selectContent(textPosition,true);// this.selection.start.setPositionInternal(startPos);
// this.selection.end.setPositionInternal(this.selection.start);
}if(sf.base.isNullOrUndefined(this.editorHistory)||this.checkIsNotRedoing()){this.reLayout(this.selection,true);}}};Editor.prototype.trackRowDeletion=function(row,canremoveRow,updateHistory){var rowFormat=row.rowFormat;if(!sf.base.isNullOrUndefined(rowFormat)){var canInsertRevision=true;if(rowFormat.revisions.length>0){var revision=this.retrieveRevisionInOder(rowFormat);if(revision.revisionType==='Insertion'){if(this.isRevisionMatched(rowFormat,undefined)){if(sf.base.isNullOrUndefined(canremoveRow)||canremoveRow){this.removeRow(row);}else{this.removeRevisionsInRow(row);}return true;}}else if(revision.revisionType==='Deletion'){this.unlinkWholeRangeInRevision(rowFormat,revision);}}if(canInsertRevision){if((sf.base.isNullOrUndefined(updateHistory)||updateHistory)&&this.editorHistory&&this.editorHistory.currentBaseHistoryInfo){this.editorHistory.currentBaseHistoryInfo.action='RemoveRowTrack';}this.insertRevision(rowFormat,'Deletion');}for(var i=0;i<row.childWidgets.length;i++){var cellWidget=row.childWidgets[i];for(var j=0;j<cellWidget.childWidgets.length;j++){if(cellWidget.childWidgets[j]instanceof TableWidget){this.trackInnerTable(cellWidget.childWidgets[i],canremoveRow,updateHistory);}else{var paraWidget=cellWidget.childWidgets[j];// We used this boolean since for table tracking we should add removed nodes only for entire table not for every elements in the table
this.skipTableElements=true;this.insertRevisionForBlock(paraWidget,'Deletion');this.skipTableElements=false;}}}}return false;};Editor.prototype.trackInnerTable=function(tableWidget,canremoveRow,updateHistory){for(var i=0;i<tableWidget.childWidgets.length;i++){this.trackRowDeletion(tableWidget.childWidgets[i],canremoveRow,updateHistory);}};Editor.prototype.returnDeleteRevision=function(revisions){for(var i=0;i<revisions.length;i++){if(revisions[i].revisionType==='Deletion'){return revisions[i];}}return undefined;};Editor.prototype.removeRow=function(row){var table=row.ownerTable;if(row.rowFormat.revisions.length>0){this.removeRevisionsInRow(row);}if(table.childWidgets.length===1){this.removeBlock(table);if(this.editorHistory&&this.editorHistory.currentBaseHistoryInfo){this.editorHistory.currentBaseHistoryInfo.action='Delete';}table.destroy();}else{table.childWidgets.splice(table.childWidgets.indexOf(row),1);row.destroy();this.updateTable(table);}};/**
     * @private
     * @param {TableWidget} table Specifies the table widget
     * @returns {void}
     */Editor.prototype.updateTable=function(table){table.updateRowIndex(0);table.isGridUpdated=false;table.buildTableColumns();table.isGridUpdated=true;this.documentHelper.layout.reLayoutTable(table);};Editor.prototype.getParagraphForSelection=function(table){var paragraph=undefined;var nextWidget=table.nextWidget?table.nextWidget:table.nextRenderedWidget;var previousWidget=table.previousWidget?table.previousWidget:table.previousRenderedWidget;if(nextWidget){paragraph=nextWidget instanceof ParagraphWidget?nextWidget:this.selection.getFirstParagraphInFirstCell(nextWidget);}else if(previousWidget){paragraph=previousWidget instanceof ParagraphWidget?previousWidget:this.selection.getLastParagraphInLastCell(previousWidget);}return paragraph;};Editor.prototype.deletePara=function(paragraph,start,end,editAction){paragraph=paragraph.combineWidget(this.owner.viewer);var selection=this.documentHelper.selection;var paragraphStart=selection.getStartOffset(paragraph);var endParagraphStartOffset=selection.getStartOffset(end.paragraph);var startOffset=paragraphStart;var endOffset=0;var isCombineNextParagraph=false;var lastLinelength=this.selection.getLineLength(paragraph.lastChild);var currentParagraph=paragraph;var section=paragraph.bodyWidget instanceof BodyWidget?paragraph.bodyWidget:undefined;var startLine=undefined;var endLineWidget=undefined;if(paragraph===start.paragraph){startOffset=start.offset;startLine=start.currentWidget;if(end.paragraph.isInsideTable){isCombineNextParagraph=this.isEndInAdjacentTable(paragraph,end.paragraph);}}else{startLine=paragraph.firstChild;}if(paragraph!==start.paragraph&&selection.isSkipLayouting){selection.isSkipLayouting=false;}if(paragraph===end.paragraph){endLineWidget=end.currentWidget;endOffset=end.offset;}else{endLineWidget=paragraph.lastChild;endOffset=this.documentHelper.selection.getLineLength(paragraph.lastChild);}// If previous widget is splitted paragraph, combine paragraph widget.
var block=paragraph.previousRenderedWidget?paragraph.previousRenderedWidget.combineWidget(this.documentHelper.viewer):undefined;if(startOffset>paragraphStart&&start.currentWidget===paragraph.lastChild&&startOffset===lastLinelength&&(paragraph===end.paragraph&&end.offset===startOffset+1||paragraph.nextRenderedWidget===end.paragraph&&end.offset===endParagraphStartOffset)||this.editorHistory&&this.editorHistory.isUndoing&&this.editorHistory.currentHistoryInfo&&this.editorHistory.currentHistoryInfo.action==='PageBreak'&&block&&block.isPageBreak()&&(startOffset===0&&!start.currentWidget.isFirstLine||startOffset>0)){isCombineNextParagraph=true;}var paraEnd=end.clone();paraEnd.offset=paraEnd.offset-1;var paraReplace=start.paragraph===paragraph&&start.isAtParagraphStart&&paraEnd.isAtParagraphEnd&&this.editorHistory&&this.editorHistory.currentBaseHistoryInfo.action==='Insert';if(paraReplace){this.editorHistory.currentBaseHistoryInfo.action='InsertTextParaReplace';}if(end.paragraph===paragraph&&end.currentWidget!==paragraph.lastChild||end.currentWidget===paragraph.lastChild||paraReplace){var isStartParagraph=start.paragraph===paragraph;if(end.currentWidget.isFirstLine()&&end.offset>paragraphStart||!end.currentWidget.isFirstLine()||paraReplace){//If selection end with this paragraph and selection doesnot include paragraph mark.               
this.removeInlines(paragraph,startLine,startOffset,endLineWidget,endOffset,editAction);//Removes the splitted paragraph.
}if(!sf.base.isNullOrUndefined(block)&&!isStartParagraph&&!paraReplace){this.delBlockContinue=true;this.delBlock=block;var nextSection=block.bodyWidget instanceof BodyWidget?block.bodyWidget:undefined;if(nextSection&&!section.equals(nextSection)&&section.index!==nextSection.index){this.delSection=nextSection;}else{this.delSection=undefined;}}else{this.delBlockContinue=false;this.delBlock=undefined;}}else if(start.paragraph===paragraph&&(start.currentWidget!==paragraph.firstChild||start.currentWidget===paragraph.firstChild&&startOffset>paragraphStart)){// If selection start is after paragraph start
//And selection does not end with this paragraph Or selection include paragraph mark.
this.delBlockContinue=false;this.delBlock=undefined;if(editAction===4){return;}else{if(this.skipTracking()&&this.editorHistory.currentBaseHistoryInfo.action==='ParaMarkTrack'){this.addRemovedNodes(paragraph.characterFormat.cloneFormat());if(paragraph.characterFormat.revisions.length>0){this.unlinkRangeFromRevision(paragraph.characterFormat,true);}paragraph.characterFormat.revisions=[];}else{if(this.owner.enableTrackChanges&&!this.skipTracking()&&this.editorHistory.currentBaseHistoryInfo.action!=='TOC'&&this.editorHistory.currentBaseHistoryInfo.action!=='Reject Change'){if(isCombineNextParagraph){currentParagraph=this.splitParagraph(paragraph,paragraph.firstChild,0,startLine,startOffset,true);this.deleteParagraphMark(currentParagraph,selection,editAction,true);this.addRemovedNodes(paragraph);}else{this.removeInlines(paragraph,startLine,startOffset,endLineWidget,endOffset,editAction);}}else{currentParagraph=this.splitParagraph(paragraph,paragraph.firstChild,0,startLine,startOffset,true);this.insertParagraphPaste(paragraph,currentParagraph,start,end,isCombineNextParagraph,editAction);this.removeRevisionForBlock(paragraph,undefined,false,true);this.addRemovedNodes(paragraph);}}return;}}else{var newParagraph=undefined;var previousBlock=paragraph.previousWidget;var prevParagraph=previousBlock instanceof ParagraphWidget?previousBlock:undefined;var nextWidget=paragraph.nextRenderedWidget;if(editAction<4){//Checks whether this is last paragraph of owner text body and previousBlock is not paragraph.
if(this.owner.enableTrackChanges&&!this.skipTracking()&&this.editorHistory.currentBaseHistoryInfo&&this.editorHistory.currentBaseHistoryInfo.action!=='TOC'){this.insertRevisionForBlock(paragraph,'Deletion');if(paragraph.isEmpty()&&!(end.paragraph.previousRenderedWidget instanceof TableWidget)){newParagraph=this.checkAndInsertBlock(paragraph,start,end,editAction,prevParagraph);this.removeBlock(paragraph);}else{// On deleting para, para items may be added with delete revisions so we need to ensure whether it can be combined with prev/ next para.
this.combineRevisionWithBlocks(paragraph.firstChild.children[0]);}if(paragraph===end.paragraph&&this.editorHistory.currentBaseHistoryInfo.action==='Delete'){var paraInfo=this.selection.getParagraphInfo(end);this.selection.editPosition=this.selection.getHierarchicalIndex(paraInfo.paragraph,paraInfo.offset.toString());}if(start.paragraph!==paragraph&&!sf.base.isNullOrUndefined(block)){this.delBlockContinue=true;this.delBlock=block;return;}}else{//this.documentHelper.comments;
newParagraph=this.checkAndInsertBlock(paragraph,start,end,editAction,prevParagraph);this.removeRevisionForBlock(paragraph,undefined,false,true);this.addRemovedNodes(paragraph);this.removeBlock(paragraph);/* let widget: IWidget;
                     for(let i:number =0;i< foot.childWidgets.length; i++) {
                     widget = foot.childWidgets[i];
                     if (widget instanceof ParagraphWidget) {
 
                     let para: ParagraphWidget = widget;
                     if (!isNullOrUndefined(para)) {
                         this.removeBlock(para);
                     }}}*/}if(this.documentHelper.blockToShift===paragraph){this.documentHelper.blockToShift=undefined;}if(!sf.base.isNullOrUndefined(newParagraph)){selection.editPosition=this.selection.getHierarchicalIndex(newParagraph,'0');var offset=selection.getParagraphLength(newParagraph)+1;if(this.editorHistory&&!sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo)){this.editorHistory.currentBaseHistoryInfo.endPosition=this.selection.getHierarchicalIndex(newParagraph,offset.toString());}}else if(paragraph===start.paragraph&&sf.base.isNullOrUndefined(nextWidget)&&!sf.base.isNullOrUndefined(prevParagraph)){var offset=this.selection.getParagraphLength(prevParagraph);// if (isNullOrUndefined(block)) {
selection.editPosition=this.selection.getHierarchicalIndex(prevParagraph,offset.toString());if(this.editorHistory&&!sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo)){this.updateHistoryPosition(selection.editPosition,true);this.editorHistory.currentBaseHistoryInfo.endPosition=selection.editPosition;}// } else {
//     let offset: number = selection.getParagraphLength(paragraph) + 1;
//     if (block instanceof ParagraphWidget) {
//         prevParagraph = block as ParagraphWidget;
//     }
//     // if (block instanceof WTable) {
//     //     prevParagraph = (block as WTable).getFirstParagraphInFirstCell();
//     // }
//     selection.editPosition = prevLineWidget.getHierarchicalIndex('0');
// }
}}if(start.paragraph!==paragraph&&!sf.base.isNullOrUndefined(block)){this.delBlockContinue=true;this.delBlock=block;}else{this.delBlockContinue=false;this.delBlock=undefined;}}this.insertParagraphPaste(paragraph,currentParagraph,start,end,isCombineNextParagraph,editAction);};Editor.prototype.deleteSection=function(selection,section,nextSection,editAction){if(editAction<4){this.combineSectionInternal(selection,section,nextSection);}//Copies the section properties, if this is last paragraph of section.
if(editAction>2){section.sectionFormat.copyFormat(nextSection.sectionFormat);}};Editor.prototype.combineSectionInternal=function(selection,section,nextSection){// if (section.sectionFormat.isEqualFormat(nextSection.sectionFormat)) {
// } else {
var bodyWidget=section.getSplitWidgets()[0];var currentSection=[];this.combineSectionChild(bodyWidget,currentSection);bodyWidget=currentSection[0];var lastBlockIndex=bodyWidget.lastChild.index;this.updateBlockIndex(lastBlockIndex+1,nextSection.firstChild);var insertIndex=0;var containerWidget=nextSection;for(var i=0;i<bodyWidget.childWidgets.length;i++){var block=bodyWidget.childWidgets.splice(i,1)[0];containerWidget.childWidgets.splice(insertIndex,0,block);block.containerWidget=containerWidget;this.documentHelper.layout.layoutBodyWidgetCollection(block.index,block.bodyWidget,block,false);block=block.getSplitWidgets().pop();containerWidget=block.containerWidget;insertIndex=block.indexInOwner+1;i--;}this.updateSectionIndex(undefined,nextSection,false);this.addRemovedNodes(bodyWidget);// this.insert
// }
};/* eslint-disable max-len */Editor.prototype.checkAndInsertBlock=function(block,start,end,editAction,previousParagraph){if(block instanceof ParagraphWidget&&block===start.paragraph||block instanceof TableWidget){var newParagraph=void 0;//Adds an empty paragraph, to ensure minimal content.
if(sf.base.isNullOrUndefined(block.nextWidget)&&(sf.base.isNullOrUndefined(previousParagraph)||previousParagraph.nextRenderedWidget instanceof TableWidget)){newParagraph=new ParagraphWidget();if(editAction===1&&block instanceof ParagraphWidget&&!sf.base.isNullOrUndefined(block.paragraphFormat.baseStyle)&&block.paragraphFormat.baseStyle.name==='Normal'){newParagraph.characterFormat.copyFormat(block.characterFormat);newParagraph.paragraphFormat.copyFormat(block.paragraphFormat);}newParagraph.index=block.index+1;newParagraph.containerWidget=block.containerWidget;if(block instanceof ParagraphWidget){newParagraph.paragraphFormat.lineSpacing=block.paragraphFormat.lineSpacing;newParagraph.paragraphFormat.lineSpacingType=block.paragraphFormat.lineSpacingType;var style=this.documentHelper.styles.findByName('Normal');if(!sf.base.isNullOrUndefined(style)){newParagraph.paragraphFormat.baseStyle=new WParagraphStyle();newParagraph.paragraphFormat.baseStyle.copyStyle(style);}}this.documentHelper.layout.layoutBodyWidgetCollection(newParagraph.index,newParagraph.bodyWidget,newParagraph,false);if(block.containerWidget instanceof Widget){block.containerWidget.childWidgets.push(newParagraph);}}return newParagraph;}return undefined;};Editor.prototype.splitParagraph=function(paragraphAdv,startLine,startOffset,endLine,endOffset,removeBlock){var paragraph=new ParagraphWidget();paragraph.paragraphFormat=new WParagraphFormat(paragraph);paragraph.characterFormat=new WCharacterFormat(paragraph);paragraph.paragraphFormat.copyFormat(paragraphAdv.paragraphFormat);paragraph.characterFormat.copyFormat(paragraphAdv.characterFormat);var lineWidget=new LineWidget(paragraph);paragraph.childWidgets.push(lineWidget);var blockIndex=paragraphAdv.index;var insertIndex=paragraphAdv.indexInOwner;this.moveInlines(paragraphAdv,paragraph,0,startOffset,startLine,endOffset,endLine);//Inserts new paragraph in the current text position.
paragraphAdv.containerWidget.childWidgets.splice(insertIndex,0,paragraph);paragraph.index=blockIndex;paragraph.containerWidget=paragraphAdv.containerWidget;this.updateNextBlocksIndex(paragraph,true);if(removeBlock){this.removeBlock(paragraphAdv);}this.documentHelper.layout.layoutBodyWidgetCollection(blockIndex,paragraph.containerWidget,paragraph,false);return paragraph;};Editor.prototype.addOrRemoveCommentsInBlock=function(block,isAdd){if(block instanceof TableWidget){for(var i=0;i<block.childWidgets.length;i++){var row=block.childWidgets[i];for(var j=0;j<row.childWidgets.length;j++){var cell=row.childWidgets[j];for(var k=0;k<cell.childWidgets.length;k++){var block_1=cell.childWidgets[k];this.addOrRemoveCommentsInBlock(block_1,isAdd);}}}}else{this.addOrRemoveCommentInPara(block,isAdd);}};Editor.prototype.addOrRemoveCommentInPara=function(block,isAdd){for(var i=0;i<block.childWidgets.length;i++){var lineWidget=block.childWidgets[i];//Iterate through each line widgets.
for(var j=0;j<lineWidget.children.length;j++){this.addOrRemoveCommentsInline(lineWidget.children[j],isAdd);}}};Editor.prototype.addOrRemoveCommentsInline=function(inline,isAdd){if(inline instanceof CommentCharacterElementBox&&inline.commentType===0&&!sf.base.isNullOrUndefined(inline.comment)){var comment=inline.comment.ownerComment?inline.comment.ownerComment:inline.comment;if(isAdd){this.addCommentWidget(comment,false,false,false);}else{if(inline.commentMark){inline.removeCommentMark();}this.deleteCommentWidget(comment);}}};/**
     * @private
     * @returns {void}
     */Editor.prototype.removeBlock=function(block,isSkipShifting){var index;var blockCollection;var containerWidget;this.removeFieldInBlock(block);this.removeFieldInBlock(block,true);this.removeFieldInBlock(block,undefined,true);this.addOrRemoveCommentsInBlock(block);if(block.isInsideTable){containerWidget=block.associatedCell;index=block.associatedCell.childWidgets.indexOf(block);blockCollection=block.associatedCell.childWidgets;this.updateNextBlocksIndex(block,false);block.associatedCell.childWidgets.splice(index,1);block.containerWidget=undefined;this.documentHelper.layout.layoutBodyWidgetCollection(block.index,containerWidget,block,false);}else{containerWidget=block.containerWidget;for(var i=0;i<block.childWidgets.length;i++){var isSkipTracking=void 0;if(!this.isPasteRevertAction()){isSkipTracking=this.skipTracking();}if(block.childWidgets[i]instanceof TableRowWidget&&!isSkipTracking){var tableDelete=block.childWidgets[i];this.removeDeletedCellRevision(tableDelete);}}index=containerWidget.childWidgets.indexOf(block);blockCollection=containerWidget.childWidgets;this.updateNextBlocksIndex(block,false);containerWidget.childWidgets.splice(index,1);block.containerWidget=undefined;containerWidget.height-=block.height;this.documentHelper.layout.layoutBodyWidgetCollection(block.index,containerWidget,block,false,isSkipShifting);}};Editor.prototype.isPasteRevertAction=function(){if(!sf.base.isNullOrUndefined(this.editorHistory)&&this.editorHistory.currentBaseHistoryInfo&&this.editorHistory.currentBaseHistoryInfo.action==='Paste'){return true;}return false;};Editor.prototype.toCheckForTrack=function(block){if(this.owner.enableTrackChanges&&!this.skipTracking()){if(block instanceof TableWidget&&block.childWidgets.length>0){var rowFormat=block.childWidgets[0].rowFormat;if(rowFormat.revisions.length>0&&rowFormat.revisions[0].revisionType!=='Insertion'&&rowFormat.revisions[0].author===(this.owner.currentUser===''?'Guest user':this.owner.currentUser)||rowFormat.revisions.length===0){return true;}}}return false;};Editor.prototype.removeFootnote=function(element,paragraph){if(element.paragraph.bodyWidget.page.footnoteWidget){var footnoteWidget=element.paragraph.bodyWidget.page.footnoteWidget;for(var j=0;j<footnoteWidget.childWidgets.length;j++){if(element===footnoteWidget.childWidgets[j].footNoteReference){footnoteWidget.height-=footnoteWidget.childWidgets[j].height;footnoteWidget.childWidgets.splice(j,1);j--;}}if(footnoteWidget.childWidgets.length===1){element.paragraph.bodyWidget.page.footnoteWidget=undefined;}}this.documentHelper.footnoteCollection.splice(this.documentHelper.footnoteCollection.indexOf(element),1);};Editor.prototype.removeEndnote=function(element,paragraph){if(element.paragraph.bodyWidget.page.endnoteWidget){var endnoteWidget=element.paragraph.bodyWidget.page.endnoteWidget;for(var j=0;j<endnoteWidget.childWidgets.length;j++){if(element===endnoteWidget.childWidgets[j].footNoteReference){endnoteWidget.height-=endnoteWidget.childWidgets[j].height;endnoteWidget.childWidgets.splice(j,1);j--;}}if(endnoteWidget.childWidgets.length===1){element.paragraph.bodyWidget.page.endnoteWidget=undefined;}}this.documentHelper.endnoteCollection.splice(this.documentHelper.endnoteCollection.indexOf(element),1);};Editor.prototype.removeAutoShape=function(inline){var shapeIndex=inline.line.paragraph.floatingElements.indexOf(inline);inline.line.paragraph.bodyWidget.floatingElements.splice(inline.line.paragraph.bodyWidget.floatingElements.indexOf(inline),1);inline.line.paragraph.floatingElements.splice(shapeIndex,1);};/**
     * @private
     * @returns {void}
     */Editor.prototype.removeField=function(block,isBookmark,isContentControl){var collection=this.documentHelper.fields;if(isBookmark){collection=this.documentHelper.bookmarks.keys;}else if(isContentControl){collection=this.documentHelper.contentControlCollection;}if(block.floatingElements.length>0){for(var z=0;z<block.floatingElements.length;z++){var inline=block.floatingElements[z];this.removeAutoShape(inline);}}for(var i=0;i<collection.length;i++){var element=isBookmark?this.documentHelper.bookmarks.get(collection[i]):collection[i];if(element.line.paragraph===block){if(isBookmark){this.documentHelper.bookmarks.remove(collection[i]);}else if(isContentControl){this.documentHelper.contentControlCollection.splice(i,1);}else{this.documentHelper.fields.splice(i,1);if(this.documentHelper.formFields.indexOf(element)!==-1){this.documentHelper.formFields.splice(this.documentHelper.formFields.indexOf(element),1);}}i--;}}if(this.documentHelper.footnoteCollection.length>0){for(var i=0;i<this.documentHelper.footnoteCollection.length;i++){var element=this.documentHelper.footnoteCollection[i];if(element.line.paragraph===block){if(element.paragraph.bodyWidget.page.footnoteWidget){var footnote=element.paragraph.bodyWidget.page.footnoteWidget;for(var j=0;j<footnote.childWidgets.length;j++){if(element===footnote.childWidgets[j].footNoteReference){footnote.height-=footnote.childWidgets[j].height;footnote.childWidgets.splice(j,1);j--;}}if(footnote.childWidgets.length===1){element.paragraph.bodyWidget.page.footnoteWidget=undefined;}}this.documentHelper.footnoteCollection.splice(i,1);i--;}}}if(this.documentHelper.endnoteCollection.length>0){for(var i=0;i<this.documentHelper.endnoteCollection.length;i++){var element=this.documentHelper.endnoteCollection[i];if(element.line.paragraph===block){if(element.paragraph.bodyWidget.page.endnoteWidget){var endnote=element.paragraph.bodyWidget.page.endnoteWidget;for(var j=0;j<endnote.childWidgets.length;j++){if(element===endnote.childWidgets[j].footNoteReference){endnote.height-=endnote.childWidgets[j].height;endnote.childWidgets.splice(j,1);j--;}}if(endnote.childWidgets.length===1){element.paragraph.bodyWidget.page.endnoteWidget=undefined;}}this.documentHelper.endnoteCollection.splice(i,1);i--;}}}};/**
     * @private
     * @param {IWidget} node Specifies the node.
     * @returns {void}
     */Editor.prototype.addRemovedNodes=function(node){if(node instanceof CommentCharacterElementBox&&node.commentType===0&&node.commentMark){node.removeCommentMark();}if(node instanceof ContentControl&&node.type===0){this.documentHelper.contentControlCollection.splice(this.documentHelper.contentControlCollection.indexOf(node),1);}if(node instanceof FieldElementBox&&node.fieldType===0){if(this.documentHelper.fields.indexOf(node)!==-1){this.documentHelper.fields.splice(this.documentHelper.fields.indexOf(node),1);}if(this.documentHelper.formFields.indexOf(node)!==-1){this.documentHelper.formFields.splice(this.documentHelper.formFields.indexOf(node),1);}}if(this.editorHistory&&!sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo)){this.editorHistory.currentBaseHistoryInfo.removedNodes.push(node);}else if(this.editHyperlinkInternal){this.nodes.push(node);}};Editor.prototype.deleteBlock=function(block,selection,start,end,editAction){if(block instanceof ParagraphWidget){this.deletePara(block,start,end,editAction);if(this.delBlockContinue&&this.delBlock){if(this.delSection){var bodyWidget=block.bodyWidget instanceof BodyWidget?block.bodyWidget:undefined;this.deleteSection(selection,this.delSection,bodyWidget,editAction);this.delSection=undefined;}if(this.delBlock.indexInOwner!==-1){this.deleteBlock(this.delBlock,selection,start,end,editAction);}this.delBlockContinue=false;this.delBlock=undefined;}}else{this.deleteTableBlock(block,selection,start,end,editAction);}};Editor.prototype.deleteTableCell=function(cellAdv,selection,start,end,editAction){var deletePreviousBlock=!(start.paragraph.isInsideTable&&cellAdv.ownerTable.contains(start.paragraph.associatedCell));var previousBlock=cellAdv.ownerTable.previousRenderedWidget;if(start.paragraph.isInsideTable){var containerCell=selection.getContainerCellOf(cellAdv,start.paragraph.associatedCell);if(containerCell.ownerTable.contains(start.paragraph.associatedCell)){var startCell=selection.getSelectedCell(cellAdv,containerCell);var endCell=selection.getSelectedCell(start.paragraph.associatedCell,containerCell);if(selection.containsCell(containerCell,start.paragraph.associatedCell)){//Selection end is in container cell.
if(selection.isCellSelected(containerCell,start,end)){//Container cell is completely selected.
this.updateEditPosition(containerCell,selection);if(editAction===1){//Specifically handled for backspace. Delete selected cell in current table.
this.deleteCellsInTable(cellAdv.ownerRow.ownerTable,selection,start,end,editAction);}else{//Delete contents within table cell or Copy contents within table cell to clipboard.
var isCellCleared=this.deleteCell(containerCell,selection,editAction,true);if(!isCellCleared&&editAction!==2&&this.editorHistory){this.editorHistory.currentBaseHistoryInfo=undefined;}else if(isCellCleared){this.documentHelper.layout.reLayoutTable(containerCell.ownerRow.ownerTable);}}}else{if(startCell===containerCell){this.deletePara(end.paragraph,start,end,editAction);if(this.delBlockContinue&&this.delBlock){if(this.delSection){var para=end.paragraph;var bodyWidget=para.bodyWidget instanceof BodyWidget?para.bodyWidget:undefined;this.deleteSection(selection,this.delSection,bodyWidget,editAction);this.delSection=undefined;}this.deleteBlock(this.delBlock,selection,start,end,editAction);this.delBlockContinue=false;this.delBlock=undefined;}}else{this.deleteContainer(startCell,selection,start,end,editAction);}}}else{if(editAction===2){//Delete contents within table cell.
this.deleteCell(cellAdv,selection,2,false);}else{//Delete other selected cells in current table.
this.deleteCellsInTable(containerCell.ownerTable,selection,start,end,editAction);}}}else{//Selection end is different table.
this.deleteContainer(containerCell,selection,start,end,editAction);}}else{//Selection end is outside table.
var cell=selection.getContainerCell(cellAdv);this.deleteContainer(cell,selection,start,end,editAction);}if(deletePreviousBlock){var sectionAdv=previousBlock.bodyWidget instanceof BodyWidget?previousBlock.bodyWidget:undefined;// this.deleteContent(cellAdv.ownerTable, selection, editAction);
if(!sf.base.isNullOrUndefined(previousBlock)){// let nextSection: WSection = blockAdv.section instanceof WSection ? blockAdv.section as WSection : undefined;
// if (sectionAdv !== nextSection) {
//     this.deleteSection(selection, sectionAdv, nextSection, editAction);
// }
//Goto the next block.
this.deleteBlock(previousBlock,selection,start,end,editAction);}}};Editor.prototype.deleteCellsInTable=function(table,selection,start,end,editAction,endCells){var clonedTable=undefined;var action='Delete';var isDeleteCells=false;var startCell=start.paragraph.associatedCell;var endCell=end.paragraph.associatedCell;if(!sf.base.isNullOrUndefined(endCells)){endCell=endCells;}if(this.editorHistory&&!sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo)){action=this.editorHistory.currentBaseHistoryInfo.action;isDeleteCells=this.editorHistory.currentBaseHistoryInfo.action==='BackSpace'||this.editorHistory.currentBaseHistoryInfo.action==='DeleteCells'||this.editorHistory.currentBaseHistoryInfo.action==='InsertTable'||this.editorHistory.currentBaseHistoryInfo.action==='RemoveRowTrack'||sf.base.isNullOrUndefined(startCell.ownerRow.previousWidget)&&sf.base.isNullOrUndefined(endCell.ownerRow.nextWidget)&&this.editorHistory.currentBaseHistoryInfo.action==='Cut';clonedTable=this.cloneTableToHistoryInfo(table);if(this.editorHistory.currentBaseHistoryInfo.action==='RemoveRowTrack'){return;}this.editorHistory.currentBaseHistoryInfo.action=isDeleteCells?'DeleteCells':'ClearCells';selection.owner.isLayoutEnabled=false;}var startColumnIndex=startCell.columnIndex;var endColumnIndex=endCell.columnIndex+endCell.cellFormat.columnSpan-1;var startRowIndex=startCell.rowIndex;var endRowIndex=endCell.rowIndex;//let cells: TableCellWidget[] = [];
var isRowSelected=this.isWholeRowSelected(startCell.ownerRow,startColumnIndex,endColumnIndex);if(this.owner.enableTrackChanges&&!this.skipTracking()){if(!isRowSelected){// let localizeValue: L10n = new L10n('documenteditor', this.owner.defaultLocale);
// const tiltle: string = localizeValue.getConstant('UnTrack');
// const content: string = localizeValue.getConstant('Merge Track');
// localizeValue.setLocale(this.owner.locale);
// this.alertDialog = DialogUtility.alert({
//     title: tiltle,
//     content: content,
//     showCloseIcon: true,
//     okButton: {
//         text: 'Ok', click: this.onConfirmedTableCellsDeletion.bind(this, table, selection, startRowIndex, endRowIndex, startColumnIndex, endColumnIndex, isDeleteCells, editAction, isRowSelected, action)
//     },
//     closeOnEscape: true, position: { X: 'center', Y: 'center' },
//     animationSettings: { effect: 'Zoom' }
// });
}else{this.onConfirmedTableCellsDeletion(table,selection,startRowIndex,endRowIndex,startColumnIndex,endColumnIndex,isDeleteCells,editAction,isRowSelected,action);}}else{this.onConfirmedTableCellsDeletion(table,selection,startRowIndex,endRowIndex,startColumnIndex,endColumnIndex,isDeleteCells,editAction,isRowSelected,action);}};/**
     * @private
     */Editor.prototype.removeDeletedCellRevision=function(row){if(row.rowFormat.revisions.length>0){this.unlinkRangeFromRevision(row.rowFormat,true);}for(var i=0;i<row.childWidgets.length;i++){var cellWidget=row.childWidgets[i];for(var j=0;j<cellWidget.childWidgets.length;j++){var paraWidget=cellWidget.childWidgets[j];if(!sf.base.isNullOrUndefined(paraWidget)&&paraWidget instanceof ParagraphWidget){for(var lineIndex=0;lineIndex<paraWidget.childWidgets.length;lineIndex++){var lineWidget=paraWidget.childWidgets[lineIndex];if(!sf.base.isNullOrUndefined(lineWidget.children)){for(var elementIndex=0;elementIndex<lineWidget.children.length;elementIndex++){var element=lineWidget.children[elementIndex];if(element.revisions.length>0){this.unlinkRangeFromRevision(element,true);}}}}this.unlinkRangeFromRevision(paraWidget.characterFormat,true);}}}};Editor.prototype.onConfirmedTableCellsDeletion=function(table,selection,startRowIndex,endRowIndex,startColumnIndex,endColumnIndex,isDeleteCells,editAction,isRowSelected,action){for(var i=0;i<table.childWidgets.length;i++){var row=table.childWidgets[i];var canRemoveRow=false;if(row.index>=startRowIndex&&row.index<=endRowIndex){if(this.owner.enableTrackChanges&&!this.skipTracking()){if(isRowSelected){canRemoveRow=this.trackRowDeletion(row,false);if(canRemoveRow){this.onConfirmedCellDeletion(row,selection,startRowIndex,endRowIndex,startColumnIndex,endColumnIndex,isDeleteCells,editAction);}}else{this.onConfirmedCellDeletion(row,selection,startRowIndex,endRowIndex,startColumnIndex,endColumnIndex,isDeleteCells,editAction);}}else{this.onConfirmedCellDeletion(row,selection,startRowIndex,endRowIndex,startColumnIndex,endColumnIndex,isDeleteCells,editAction);}}if(!canRemoveRow&&row.childWidgets.length===0){var rowToRemove=table.childWidgets[i];var prevRenderedRow=rowToRemove.previousRenderedWidget;while(!sf.base.isNullOrUndefined(prevRenderedRow)){for(var k=0;k<prevRenderedRow.childWidgets.length;k++){var cell=prevRenderedRow.childWidgets[k];if(rowToRemove.rowIndex<cell.ownerRow.rowIndex+cell.cellFormat.rowSpan){cell.cellFormat.rowSpan--;}}prevRenderedRow=prevRenderedRow.previousRenderedWidget;}this.updateNextBlocksIndex(rowToRemove,false);table.childWidgets.splice(i,1);i--;endRowIndex--;}}//Layouts the table after delete cells.
selection.owner.isLayoutEnabled=true;if(table.childWidgets.length===0){selection.editPosition=this.selection.getHierarchicalIndex(table,'0');this.setActionInternal(selection,action);this.removeBlock(table);}else{// Before lay outing need to update table grid.
table.isGridUpdated=false;table.buildTableColumns();table.isGridUpdated=true;this.documentHelper.layout.reLayoutTable(table);}// if (!isNullOrUndefined(this.alertDialog)) {
//     let textPosition: TextPosition = selection.getTextPosBasedOnLogicalIndex(selection.editPosition);
//     selection.selectContent(textPosition, true);
//     this.reLayout(selection);
//     this.alertDialog.close();
//     this.alertDialog = undefined;
//  }
};Editor.prototype.onConfirmedCellDeletion=function(row,selection,startRowIndex,endRowIndex,startColumnIndex,endColumnIndex,isDeleteCells,editAction){var isStarted=false;var isCellCleared=false;this.removeDeletedCellRevision(row);for(var j=0;j<row.childWidgets.length;j++){var cell=row.childWidgets[j];//this.removeRevisionForCell(cell, true);
if(cell.columnIndex>=startColumnIndex&&cell.columnIndex<=endColumnIndex){if(!isStarted){this.updateEditPosition(cell,selection);isStarted=true;}if(isDeleteCells){//Specific for Backspace and Cut if selection includes all rows.
var cell_1=row.childWidgets[j];this.updateNextBlocksIndex(cell_1,false);row.childWidgets.splice(j,1);j--;}else if(editAction<4){isCellCleared=this.deleteCell(cell,selection,editAction,false);}}}};Editor.prototype.removeRevisionForRow=function(rowWidget){if(rowWidget.rowFormat.revisions.length>0&&this.skipTracking()){this.unlinkRangeFromRevision(rowWidget.rowFormat,true);this.addRemovedRevisionInfo(rowWidget.rowFormat,undefined);}};Editor.prototype.removeRevisionsInRow=function(rowWidget){if(rowWidget.rowFormat.revisions.length>0){for(var i=0;i<rowWidget.rowFormat.revisions.length;i++){var rowRevision=rowWidget.rowFormat.revisions[i];this.unlinkWholeRangeInRevision(rowWidget.rowFormat,rowRevision);}}};/**
     * @private
     */Editor.prototype.removeRevisionForCell=function(cellWidget,removeCollection){for(var i=0;i<cellWidget.childWidgets.length;i++){if(cellWidget.childWidgets[i]instanceof ParagraphWidget){var paraWidget=cellWidget.childWidgets[i];for(var lineIndex=0;lineIndex<paraWidget.childWidgets.length;lineIndex++){var lineWidget=paraWidget.childWidgets[lineIndex];for(var elementIndex=0;elementIndex<lineWidget.children.length;elementIndex++){var currentElement=lineWidget.children[elementIndex];if(!sf.base.isNullOrUndefined(currentElement)&&currentElement.revisions.length>0){this.unlinkRangeFromRevision(currentElement,removeCollection);this.addRemovedRevisionInfo(currentElement,undefined);}}}}else if(cellWidget.childWidgets[i]instanceof TableWidget){this.removeRevisionForInnerTable(cellWidget.childWidgets[i]);}}};Editor.prototype.removeRevisionForInnerTable=function(tableWidget){if(tableWidget.childWidgets.length>0){for(var i=0;i<tableWidget.childWidgets.length;i++){var row=tableWidget.childWidgets[i];if(!sf.base.isNullOrUndefined(row)){this.removeRevisionForRow(row);}}}};/**
     * @private
     */Editor.prototype.removeRevisionForBlock=function(paraWidget,revision,skipParaMark,addToRevisionInfo){if(paraWidget.characterFormat.revisions.length>0&&!skipParaMark){if(addToRevisionInfo){this.addRemovedRevisionInfo(paraWidget.characterFormat,undefined,false);}if(sf.base.isNullOrUndefined(revision)){this.unlinkRangeFromRevision(paraWidget.characterFormat,true);}else{this.unlinkRangeByRevision(paraWidget.characterFormat,revision);}paraWidget.characterFormat.revisions=[];}if(!sf.base.isNullOrUndefined(paraWidget)){for(var lineIndex=0;lineIndex<paraWidget.childWidgets.length;lineIndex++){var lineWidget=paraWidget.childWidgets[lineIndex];for(var elementIndex=0;elementIndex<lineWidget.children.length;elementIndex++){var currentElement=lineWidget.children[elementIndex];if(!sf.base.isNullOrUndefined(currentElement)&&currentElement.revisions.length>0){if(addToRevisionInfo){this.addRemovedRevisionInfo(currentElement,undefined,false);}if(sf.base.isNullOrUndefined(revision)){this.unlinkRangeFromRevision(currentElement,true);}else{this.unlinkRangeByRevision(currentElement,revision);}currentElement.revisions=[];}}}}};Editor.prototype.unlinkRangeByRevision=function(item,revision){for(var i=0;i<item.revisions.length;i++){var currentRevision=item.revisions[i];if(currentRevision.author===revision.author&&currentRevision.revisionType===revision.revisionType){item.revisions.splice(item.revisions.indexOf(revision),1);var rangeIndex=revision.range.indexOf(item);revision.range.splice(rangeIndex,1);}}};Editor.prototype.isWholeRowSelected=function(ownerRow,startColumnIndex,endColumnIndex){var columnCount=startColumnIndex+endColumnIndex;if(startColumnIndex===0&&ownerRow.childWidgets.length-1===columnCount){return true;}return false;};Editor.prototype.deleteCell=function(cell,selection,editAction,copyChildToClipboard){//Checks whether this is last paragraph of owner textbody.
var block=cell.childWidgets[0];var bookmarkCollection=[];if(cell.childWidgets.length===1&&block instanceof ParagraphWidget&&block.isEmpty()){return false;}for(var i=0;i<cell.childWidgets.length;i++){block=cell.childWidgets[i];if(editAction<4){//Checks whether this is last paragraph of owner textbody.
if(block instanceof ParagraphWidget&&cell.childWidgets.length===1){//Preserves empty paragraph, to ensure minimal content.
var paragraph=block;bookmarkCollection=this.paragrapghBookmarkCollection(paragraph,bookmarkCollection);//Removes all the inlines in the paragraph.
for(var j=0;j<paragraph.childWidgets.length;j++){var inline=paragraph.childWidgets[j];for(var k=0;k<inline.children.length;k++){var element=inline.children[k];this.unLinkFieldCharacter(element);inline.children.splice(k,1);// this.layoutInlineCollection(true, paragraph.inlines.indexOf(inline), paragraph.inlines, inline);
k--;if(this.checkClearCells(selection)){this.addRemovedNodes(element);}}if(paragraph.childWidgets.length>1){paragraph.childWidgets.splice(j,1);j--;}}if(this.checkClearCells(selection)){//Add Index for line Widget
selection.editPosition=this.selection.getHierarchicalIndex(paragraph,'0');this.updateHistoryPosition(selection.editPosition,true);}break;}if(block instanceof ParagraphWidget){bookmarkCollection=this.paragrapghBookmarkCollection(block,bookmarkCollection);}this.removeBlock(block);i--;if(this.checkClearCells(selection)){this.addRemovedNodes(block);}}}for(var j=0;j<bookmarkCollection.length;j++){cell.childWidgets[0].childWidgets[0].children.push(bookmarkCollection[j]);cell.childWidgets[0].childWidgets[0].children.push(bookmarkCollection[j].reference);bookmarkCollection[j].line=cell.childWidgets[0].childWidgets[0];bookmarkCollection[j].reference.line=cell.childWidgets[0].childWidgets[0];this.documentHelper.bookmarks.add(bookmarkCollection[j].name,bookmarkCollection[j]);}return true;};Editor.prototype.paragrapghBookmarkCollection=function(block,existingBookmark){var bookmarkCol=this.documentHelper.bookmarks;for(var i=0;i<bookmarkCol.length;i++){var bookmark=this.documentHelper.bookmarks.get(bookmarkCol.keys[i]);if(bookmark.paragraph===block){existingBookmark.push(bookmark);}}return existingBookmark;};Editor.prototype.deleteContainer=function(cell,selection,start,end,editAction){var ownerTable=cell.ownerTable;if(selection.containsRow(ownerTable.lastChild,end.paragraph.associatedCell)){this.deleteContent(ownerTable,selection,editAction);}else{if(this.toCheckForTrack(ownerTable)){for(var i=0;i<ownerTable.childWidgets.length;i++){var inline=ownerTable.childWidgets[i];this.trackRowDeletion(inline);if(end.paragraph.isInsideTable&&selection.containsRow(inline,end.paragraph.associatedCell)){this.documentHelper.layout.reLayoutTable(ownerTable);return;}}}else{for(var i=0;i<ownerTable.childWidgets.length;i++){var row=ownerTable.childWidgets[i];if(editAction<4){this.updateNextBlocksIndex(row,false);ownerTable.childWidgets.splice(i,1);this.addRemovedNodes(row);i--;}if(end.paragraph.isInsideTable&&selection.containsRow(row,end.paragraph.associatedCell)){this.documentHelper.layout.reLayoutTable(ownerTable);return;}}}}};Editor.prototype.deleteTableBlock=function(table,selection,start,end,editAction){table=table.combineWidget(this.owner.viewer);if(start.paragraph.isInsideTable&&table.contains(start.paragraph.associatedCell)){var block=table.previousRenderedWidget;var previousBlock=this.checkAndInsertBlock(table,start,end,editAction,block instanceof ParagraphWidget?block:undefined);if(selection.containsRow(table.firstChild,start.paragraph.associatedCell)){this.deleteContent(table,selection,editAction);}else{if(this.owner.enableTrackChanges){if(sf.base.isNullOrUndefined(end.paragraph.associatedCell)&&!end.paragraph.isInsideTable){var previousChild=end.paragraph.previousRenderedWidget.lastChild;var endCells=previousChild.lastChild;this.deleteCellsInTable(table,selection,start,end,editAction,endCells);}}else{var newTable=this.splitTable(table,start.paragraph.associatedCell.ownerRow);this.deleteContent(table,selection,editAction);this.documentHelper.layout.layoutBodyWidgetCollection(newTable.index,newTable.containerWidget,newTable,false);}}if(!sf.base.isNullOrUndefined(previousBlock)){selection.editPosition=this.selection.getHierarchicalIndex(previousBlock,'0');if(this.editorHistory&&!sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo)){this.editorHistory.currentBaseHistoryInfo.endPosition=selection.editPosition;}}}else{var blockAdv=table.previousRenderedWidget;var sectionAdv=table.bodyWidget instanceof BodyWidget?table.bodyWidget:undefined;if(this.owner.enableTrackChanges){for(var i=0;i<table.childWidgets.length;i++){this.trackRowDeletion(table.childWidgets[i]);}}else{this.deleteContent(table,selection,editAction);}if(!sf.base.isNullOrUndefined(blockAdv)){// let nextSection: WSection = blockAdv.section instanceof WSection ? blockAdv.section as WSection : undefined;
// if (sectionAdv !== nextSection) {
//     this.deleteSection(selection, sectionAdv, nextSection, editAction);
// }
//Goto the next block.
this.deleteBlock(blockAdv,selection,start,end,editAction);}}};Editor.prototype.splitTable=function(table,splitEndRow){var newTable=new TableWidget();newTable.tableFormat.copyFormat(table.tableFormat);newTable.index=table.index;//Moves the rows to new table.
for(var i=0;i<table.childWidgets.length;i++){var row=table.childWidgets[i];if(row===splitEndRow){break;}newTable.childWidgets.push(row);row.containerWidget=newTable;table.childWidgets.splice(i,1);i--;}//Inserts new table in the current text position.
var insertIndex=table.getIndex();table.containerWidget.childWidgets.splice(insertIndex,0,newTable);newTable.containerWidget=table.containerWidget;this.updateNextBlocksIndex(newTable,true);return newTable;};Editor.prototype.updateEditPosition=function(cell,selection){var firstParagraph=selection.getFirstParagraphInCell(cell);selection.editPosition=this.selection.getHierarchicalIndex(firstParagraph,'0');};Editor.prototype.deleteContent=function(table,selection,editAction){if(editAction<4){this.removeBlock(table);this.addRemovedNodes(table);}};Editor.prototype.setActionInternal=function(selection,action){if(this.documentHelper.owner.enableHistoryMode&&!sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo)){this.editorHistory.currentBaseHistoryInfo.action=action;}};Editor.prototype.checkClearCells=function(selection){return this.editorHistory&&this.editorHistory.currentBaseHistoryInfo&&this.editorHistory.currentBaseHistoryInfo.action!=='ClearCells';};Editor.prototype.isEndInAdjacentTable=function(paragraph,endParagraph){var start=this.selection.getHierarchicalIndex(paragraph,'');var end=this.selection.getHierarchicalIndex(endParagraph,'');var selectionStart=start.split(';');var selectionEnd=end.split(';');return selectionStart.length<selectionEnd.length;};/**
     * @private
     * @param table
     * @returns {TableWidget}
     */Editor.prototype.cloneTableToHistoryInfo=function(table){if(this.editorHistory&&!sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo)){//Clones the entire table to preserve in history.
var clonedTable=table.clone();//Preserves the cloned table in history info, for future undo operation.
this.editorHistory.currentBaseHistoryInfo.removedNodes.push(clonedTable);//Sets the insert position in history info as current table.
if(this.documentHelper.selection.start.paragraph.isInsideTable&&this.documentHelper.selection.start.paragraph.associatedCell.ownerTable===table){this.updateHistoryPosition(this.selection.getHierarchicalIndex(table,'0'),true);}return clonedTable;}return undefined;};Editor.prototype.insertParagraphPaste=function(paragraph,currentParagraph,start,end,isCombineNextParagraph,editAction){if(this.editorHistory&&(this.editorHistory.isUndoing||this.editorHistory.isRedoing)&&!sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo)&&this.editorHistory.currentBaseHistoryInfo.action==='Paste'){var nextParagraph=this.selection.getNextParagraphBlock(currentParagraph);if(nextParagraph){if(start.offset>0&&nextParagraph===end.paragraph&&paragraph===start.paragraph&&this.editorHistory.currentBaseHistoryInfo.action==='Paste'){//Combines the current paragraph with end paragraph specific for undo/redo paste action.
var insertIndex=0;this.removeBlock(currentParagraph);this.documentHelper.layout.clearListElementBox(nextParagraph);this.documentHelper.layout.clearListElementBox(currentParagraph);for(var i=0;i<currentParagraph.childWidgets.length;i++){var line=currentParagraph.childWidgets[i];nextParagraph.childWidgets.splice(insertIndex,0,line);currentParagraph.childWidgets.splice(i,1);i--;insertIndex++;line.paragraph=nextParagraph;}this.documentHelper.layout.reLayoutParagraph(nextParagraph,0,0);isCombineNextParagraph=false;var offset=this.selection.editPosition.substring(this.selection.editPosition.lastIndexOf(';')+1);this.selection.editPosition=this.selection.getHierarchicalIndex(nextParagraph,offset);}}}if(isCombineNextParagraph){this.deleteParagraphMark(currentParagraph,this.selection,editAction);}};Editor.prototype.removeInlines=function(paragraph,startLine,startOffset,endLine,endOffset,editAction){var isRemoved=false;this.documentHelper.layout.clearListElementBox(paragraph);var startIndex=paragraph.childWidgets.indexOf(startLine);var startPosition=this.selection.start.clone();var endPosition=this.selection.end.clone();var editPosition=this.selection.editPosition;for(var i=paragraph.childWidgets.length-1;i>=0;i--){var lineWidget=paragraph.childWidgets[i];if(startLine===lineWidget&&endLine===lineWidget){this.removeContent(lineWidget,startOffset,endOffset,editAction);isRemoved=true;break;}if(endLine===lineWidget){isRemoved=true;this.removeContent(lineWidget,0,endOffset,editAction);}else if(startLine===lineWidget){this.removeContent(lineWidget,startOffset,this.documentHelper.selection.getLineLength(lineWidget),editAction);break;}else if(isRemoved){this.removeContent(lineWidget,0,this.documentHelper.selection.getLineLength(lineWidget),editAction);}}if(this.owner.enableTrackChanges&&!this.skipTracking()){this.selection.start.setPositionInternal(startPosition);this.selection.end.setPositionInternal(endPosition);if(this.editorHistory.currentBaseHistoryInfo&&this.editorHistory.currentBaseHistoryInfo.action==='Delete'){if(startPosition.offset>endPosition.offset){endPosition=startPosition;}var parInfo=this.selection.getParagraphInfo(endPosition);editPosition=this.selection.getHierarchicalIndex(parInfo.paragraph,parInfo.offset.toString());}if(this.skipReplace){this.editorHistory.currentBaseHistoryInfo.insertPosition=undefined;this.updateInsertPosition();}this.selection.editPosition=editPosition;}if(isRemoved){this.removeEmptyLine(paragraph);this.documentHelper.layout.reLayoutParagraph(paragraph,0,0);}};Editor.prototype.skipTracking=function(){if(!sf.base.isNullOrUndefined(this.editorHistory)&&(this.editorHistory.isUndoing||this.editorHistory.isRedoing)){return true;}else if(!sf.base.isNullOrUndefined(this.editorHistory)&&this.editorHistory.currentBaseHistoryInfo&&(this.editorHistory.currentBaseHistoryInfo.action==='Reject Change'||this.editorHistory.currentBaseHistoryInfo.action==='Accept Change')){return true;}return false;};Editor.prototype.canHandleDeletion=function(){if(!sf.base.isNullOrUndefined(this.editorHistory)&&this.editorHistory.currentBaseHistoryInfo&&this.editorHistory.currentBaseHistoryInfo.action==='DeleteRow'){return true;}return false;};/**
     * @private
     */Editor.prototype.removeContent=function(lineWidget,startOffset,endOffset,editAction){var count=this.selection.getLineLength(lineWidget);var isBidi=lineWidget.paragraph.paragraphFormat.bidi;var startText=undefined;var textCount=0;var lastText=undefined;for(var i=isBidi?0:lineWidget.children.length-1;isBidi?i<lineWidget.children.length:i>=0;isBidi?i++:i--){var inline=lineWidget.children[i];if(sf.base.isNullOrUndefined(editAction)||editAction!==2){for(var k=0;k<lineWidget.children.length;k++){var elementbox=lineWidget.children[k];if(elementbox instanceof TextElementBox){var text=elementbox.text;if(text.length+textCount>startOffset&&!(textCount>startOffset)){startText=text[startOffset-textCount-1];if(sf.base.isNullOrUndefined(startText)&&startOffset-textCount===0){startText=lastText;}}// tslint:disable-next-line:max-line-length
if(text.length+textCount>endOffset){if(text[endOffset-textCount]===' '&&startOffset===0||startText===' '&&text[endOffset-textCount]===' '){endOffset+=1;}}lastText=text[text.length-1];}textCount+=elementbox.length;}}if(endOffset<=count-inline.length){count-=inline.length;continue;}var endIndex=inline.length;if(count>endOffset&&count-endIndex<endOffset){endIndex=endOffset-(count-inline.length);}var startIndex=0;if(count-inline.length<startOffset){startIndex=startOffset-(count-inline.length);}if(count>endOffset){count-=inline.length-endIndex;}if(startIndex===0&&endIndex===inline.length){if(!(this.editorHistory&&(this.editorHistory.isUndoing||this.editorHistory.isRedoing))){if(inline instanceof BookmarkElementBox){this.removedBookmarkElements.push(inline);}}if(inline instanceof CommentCharacterElementBox&&inline.commentType===0){inline.comment.ownerComment?this.deleteCommentWidget(inline.comment.ownerComment):this.deleteCommentWidget(inline.comment);}if(inline instanceof BookmarkElementBox){if(this.documentHelper.bookmarks.containsKey(inline.name)){this.documentHelper.bookmarks.remove(inline.name);}}if(inline instanceof ShapeBase&&inline.textWrappingStyle!=='Inline'){this.removeAutoShape(inline);}//clear form field revisions if it is intentionally deleted.
if(this.skipFieldDeleteTracking&&inline.revisions.length>0){var fieldInline=inline;if(fieldInline instanceof FieldElementBox){if(fieldInline.fieldType===1||fieldInline.fieldType===2){fieldInline=fieldInline.fieldBegin;}this.clearFieldElementRevisions(fieldInline,inline.revisions);}}if(this.canHandleDeletion()||this.owner.enableTrackChanges&&!this.skipTracking()&&!this.skipFieldDeleteTracking){if(!this.skipTableElements){this.addRemovedNodes(inline.clone());}this.handleDeleteTracking(inline,startOffset,endOffset,i);}else{// if (editAction < 4) {
this.unLinkFieldCharacter(inline);this.unlinkRangeFromRevision(inline,true);this.addRemovedRevisionInfo(inline,undefined);this.addRemovedNodes(inline);lineWidget.children.splice(i,1);if(isBidi){if(this.isSkipHistory){i--;}}}if(isBidi){if(this.isSkipHistory){i--;}}// }
}else if(inline instanceof TextElementBox){var span=this.handleDeleteTracking(inline,startIndex,endIndex);//if (editAction < 4) {
// let span: TextElementBox = new TextElementBox();
// span.characterFormat.copyFormat(inline.characterFormat);
// span.text = inline.text.substr(startIndex, endIndex - startIndex);
// for (let i = inline.revisions.length - 1; i >= 0; i--) {
//     let revision: Revision = inline.revisions[i];
//     let splittedRange: object[] = this.splitRevisionByElement(inline, revision);
//     this.insertRevision(span, revision.revisionType, revision.author, revision.date, splittedRange);
// }
// inline.text = inline.text.slice(0, startIndex) + inline.text.slice(endIndex);
if(!sf.base.isNullOrUndefined(span)){if(!this.skipTableElements){if(inline.revisions.length>0){this.addRemovedRevisionInfo(inline,span);}this.addRemovedNodes(span);}}// else {
//     this.insertTextInternal(span.text, false, 'Deletion');
//     this.editorHistory.currentBaseHistoryInfo.revisionToRemove = inline.revisions[inline.revisions.length - 1];
//     // let info: ElementInfo = this.selection.start.currentWidget.getInline(startOffset +1, 0);
//     // let element: ElementBox = info.element.clone();
//     //this.addRemovedNodes(span);
// }
}if(inline instanceof FootnoteElementBox){if(inline.footnoteType==='Footnote'){this.removeFootnote(inline);}else{this.removeEndnote(inline);}}if(startOffset>=count-(endIndex-startIndex)){break;}count-=endIndex-startIndex;}};/**
     *
     * @param inline
     * Skips comment start marker, if its end marker is not in selection.
     */Editor.prototype.skipCommentCharacter=function(inline){var curentHistoryInfo=this.editorHistory.currentBaseHistoryInfo;var insertPosition=curentHistoryInfo.insertPosition;var startPos=curentHistoryInfo.selectionStart;var endPos=curentHistoryInfo.selectionEnd;// Initialized a complex history and skipped comment start marker position is recorded as a new action, 
// since its comment end mark is not in selection.
if(this.editorHistory.currentBaseHistoryInfo&&!this.editorHistory.currentHistoryInfo&&!(this.editorHistory.isUndoing||this.editorHistory.isRedoing)){this.initComplexHistory('SkipCommentInline');this.editorHistory.updateHistory();this.initHistory(curentHistoryInfo.action);}if(this.editorHistory.currentHistoryInfo&&this.editorHistory.currentHistoryInfo.action!=='DeleteComment'){if(!(this.editorHistory.isUndoing||this.editorHistory.isRedoing)){var offset=inline.line.getOffset(inline,1);var startPosition=new TextPosition(this.owner);startPosition.setPositionParagraph(inline.line,offset);var startOff=this.selection.getHierarchicalIndexByPosition(startPosition);if(this.selection.isForward){this.editorHistory.currentBaseHistoryInfo.selectionEnd=startOff;curentHistoryInfo.selectionStart=startOff;this.editorHistory.currentHistoryInfo.selectionEnd=curentHistoryInfo.selectionEnd;}else{this.editorHistory.currentBaseHistoryInfo.selectionStart=startOff;curentHistoryInfo.selectionEnd=startOff;this.editorHistory.currentHistoryInfo.selectionStart=curentHistoryInfo.selectionStart;}curentHistoryInfo.insertPosition=this.selection.isForward?curentHistoryInfo.selectionStart:curentHistoryInfo.selectionEnd;curentHistoryInfo.endPosition=curentHistoryInfo.insertPosition;this.editorHistory.currentHistoryInfo.insertPosition=curentHistoryInfo.insertPosition;var baseHstry=this.editorHistory.currentBaseHistoryInfo;baseHstry.insertPosition=this.selection.isForward?baseHstry.selectionStart:baseHstry.selectionEnd;baseHstry.endPosition=baseHstry.insertPosition;this.editorHistory.currentHistoryInfo.addModifiedAction(baseHstry);this.editorHistory.currentBaseHistoryInfo.insertPosition=insertPosition;this.editorHistory.currentBaseHistoryInfo.selectionStart=startPos;this.editorHistory.currentBaseHistoryInfo.selectionEnd=endPos;}}};Editor.prototype.clearFieldElementRevisions=function(inline,revision){var revisions=revision;for(var i=0;i<revisions.length;i++){var currentRevision=revisions[i];for(var j=0;j<currentRevision.range.length;j++){if(currentRevision.range[j]===inline){for(var k=j;k<currentRevision.range.length;k){if(currentRevision.range[j]instanceof FieldElementBox&&currentRevision.range[j].fieldType===1&&currentRevision.range[j].fieldBegin===inline){currentRevision.removeRangeRevisionForItem(currentRevision.range[j]);if(currentRevision.range.length===0){this.owner.revisions.remove(currentRevision);}break;}currentRevision.removeRangeRevisionForItem(currentRevision.range[j]);}}}}};Editor.prototype.addRemovedRevisionInfo=function(currentElement,spittedElement,removePrevRevisions){for(var i=0;i<currentElement.revisions.length;i++){var revisionId=currentElement.revisions[i].revisionID;if(!sf.base.isNullOrUndefined(spittedElement)){spittedElement.removedIds.push(revisionId);}else{currentElement.removedIds.push(revisionId);}}if(sf.base.isNullOrUndefined(spittedElement)&&(sf.base.isNullOrUndefined(removePrevRevisions)||removePrevRevisions)){currentElement.revisions=[];}};/**
     * @private
     * @returns {void}
     */Editor.prototype.removeEmptyLine=function(paragraph){if(paragraph.childWidgets.length>1){for(var i=0;i<paragraph.childWidgets.length;i++){var lineWidget=paragraph.childWidgets[i];if(lineWidget.children.length===0&&paragraph.childWidgets.length>1){paragraph.childWidgets.splice(i,1);i--;}}}};//#endregion
/**
     * Clone the list level
     *
     * @param {WListLevel} source - Specifies the source
     * @private
     * @returns {WListLevel} - Returns the list level
     */Editor.prototype.cloneListLevel=function(source){var listLevel=new WListLevel(undefined);this.copyListLevel(listLevel,source);return listLevel;};/**
     * Copies the list level
     *
     * @param {WListLevel} destination - Specifies the destination
     * @param {WListLevel} listLevel - Specifies the list level
     * @private
     * @returns {void}
     */Editor.prototype.copyListLevel=function(destination,listLevel){if(!sf.base.isNullOrUndefined(listLevel.paragraphFormat)){destination.paragraphFormat=new WParagraphFormat(destination);destination.paragraphFormat.copyFormat(listLevel.paragraphFormat);}if(!sf.base.isNullOrUndefined(listLevel.characterFormat)){destination.characterFormat=new WCharacterFormat(destination);destination.characterFormat.copyFormat(listLevel.characterFormat);}if(!sf.base.isNullOrUndefined(listLevel.followCharacter)){destination.followCharacter=listLevel.followCharacter;}if(!sf.base.isNullOrUndefined(listLevel.listLevelPattern)){destination.listLevelPattern=listLevel.listLevelPattern;}if(!sf.base.isNullOrUndefined(listLevel.numberFormat)){destination.numberFormat=listLevel.numberFormat;}if(!sf.base.isNullOrUndefined(listLevel.restartLevel)){destination.restartLevel=listLevel.restartLevel;}if(!sf.base.isNullOrUndefined(listLevel.startAt)){destination.startAt=listLevel.startAt;}};/**
     * Clone level override
     *
     * @param {WLevelOverride} source  @returns {void} - Specifies the level override
     * @private
     * @returns {WLevelOverride} - Returns the level overeide
     */Editor.prototype.cloneLevelOverride=function(source){var levelOverride=new WLevelOverride();if(!sf.base.isNullOrUndefined(source.startAt)){levelOverride.startAt=source.startAt;}if(!sf.base.isNullOrUndefined(source.overrideListLevel)){levelOverride.overrideListLevel=source.overrideListLevel;}if(!sf.base.isNullOrUndefined(source.levelNumber)){levelOverride.levelNumber=source.levelNumber;}return levelOverride;};/**
     * Update List Paragraph
     * @private
     * @returns {void}
     */Editor.prototype.updateListParagraphs=function(){this.documentHelper.listParagraphs=[];for(var j=0;j<this.documentHelper.pages.length;j++){var bodyWidget=this.documentHelper.pages[j].bodyWidgets[0];for(var i=0;i<bodyWidget.childWidgets.length;i++){this.updateListParagraphsInBlock(bodyWidget.childWidgets[i]);}}};/**
     * @private
     * @returns {void}
     */Editor.prototype.updateListParagraphsInBlock=function(block){if(block instanceof ParagraphWidget){if(!sf.base.isNullOrUndefined(block.paragraphFormat)&&!sf.base.isNullOrUndefined(block.paragraphFormat.listFormat)&&!sf.base.isNullOrUndefined(block.paragraphFormat.listFormat.listId)){if(sf.base.isNullOrUndefined(this.documentHelper.listParagraphs)){this.documentHelper.listParagraphs=[];}this.documentHelper.listParagraphs.push(block);}}else if(block instanceof TableWidget){for(var i=0;i<block.childWidgets.length;i++){for(var j=0;j<block.childWidgets[i].childWidgets.length;j++){var cell=block.childWidgets[i].childWidgets[j];for(var k=0;k<cell.childWidgets.length;k++){this.updateListParagraphsInBlock(cell.childWidgets[k]);}}}}};/**
     * Applies list format
     *
     * @param {WList} list - Specifies the list.
     * @private
     * @returns {void}
     */Editor.prototype.onApplyList=function(list){var selection=this.documentHelper.selection;this.setOffsetValue(this.documentHelper.selection);this.initHistory('ListFormat');var format=new WListFormat();if(!sf.base.isNullOrUndefined(list)){format.listId=list.listId;}this.documentHelper.owner.isShiftingEnabled=true;if(selection.isEmpty){this.applyParaFormatProperty(selection.start.paragraph,'listFormat',format,false);this.layoutItemBlock(selection.start.paragraph,false);}else{this.updateSelectionParagraphFormatting('listFormat',format,false);}this.reLayout(selection);};/**
     * Applies bullets or numbering list
     *
     * @param {string} format - Specifies the format
     * @param {ListLevelPattern} listLevelPattern - Specifies the list level patterns
     * @param {string} fontFamily - Specifies the font family.
     * @private
     * @returns {void}
     */Editor.prototype.applyBulletOrNumbering=function(format,listLevelPattern,fontFamily){var selection=this.documentHelper.selection;var list=selection.paragraphFormat.getList();var isUpdate=false;var start=selection.start;if(!selection.isForward){start=selection.end;}var currentParagraph=start.paragraph;if(sf.base.isNullOrUndefined(list)){while(!sf.base.isNullOrUndefined(currentParagraph.previousWidget)&&currentParagraph.previousWidget instanceof ParagraphWidget&&currentParagraph.previousWidget.isEmpty()&&currentParagraph.previousWidget.paragraphFormat.listFormat.listId===-1){currentParagraph=currentParagraph.previousWidget;}if(currentParagraph.previousWidget&&currentParagraph.previousWidget instanceof ParagraphWidget&&currentParagraph.previousWidget.paragraphFormat.listFormat.listId!==-1){currentParagraph=currentParagraph.previousWidget;list=this.documentHelper.getListById(currentParagraph.paragraphFormat.listFormat.listId);isUpdate=true;}if(!isUpdate){while(!sf.base.isNullOrUndefined(currentParagraph.nextWidget)&&currentParagraph.nextWidget instanceof ParagraphWidget&&currentParagraph.nextWidget.isEmpty()&&currentParagraph.nextWidget.paragraphFormat.listFormat.listId===-1){currentParagraph=currentParagraph.nextWidget;}if(currentParagraph.nextWidget&&currentParagraph.nextWidget instanceof ParagraphWidget&&currentParagraph.nextWidget.paragraphFormat.listFormat.listId!==-1){currentParagraph=currentParagraph.nextWidget;list=this.documentHelper.getListById(currentParagraph.paragraphFormat.listFormat.listId);isUpdate=true;}}}var startListLevel=undefined;var levelNumber=-1;var initialListLevel=undefined;var isSameList=false;if(currentParagraph.paragraphFormat.listFormat.listId!==-1&&!sf.base.isNullOrUndefined(currentParagraph.paragraphFormat.listFormat.listLevel)){this.listNumberFormat=currentParagraph.paragraphFormat.listFormat.listLevel.numberFormat;this.listLevelPattern=currentParagraph.paragraphFormat.listFormat.listLevel.listLevelPattern;this.listLevelNumber=currentParagraph.paragraphFormat.listFormat.listLevelNumber;}if(!sf.base.isNullOrUndefined(list)){levelNumber=currentParagraph.paragraphFormat.listFormat.listLevelNumber;var tempList=this.documentHelper.getListById(currentParagraph.paragraphFormat.listFormat.listId);startListLevel=this.documentHelper.layout.getListLevel(tempList,levelNumber);if(levelNumber>0){initialListLevel=this.documentHelper.layout.getListLevel(tempList,0);isSameList=!sf.base.isNullOrUndefined(initialListLevel)&&levelNumber>0&&selection.start.isInSameParagraph(selection.end);}var abstractList=tempList.abstractList;if(!abstractList){abstractList=this.documentHelper.getAbstractListById(list.abstractListId);}if(abstractList.levels.length===0){startListLevel=this.documentHelper.layout.getListLevel(tempList,currentParagraph.paragraphFormat.listFormat.listLevelNumber);}if(isUpdate){if(listLevelPattern!=='Bullet'&&startListLevel.listLevelPattern===listLevelPattern&&(startListLevel.numberFormat===format||startListLevel.numberFormat.indexOf(format)!==-1)){selection.paragraphFormat.listId=list.listId;selection.paragraphFormat.listLevelNumber=levelNumber;selection.paragraphFormat.setList(list);return;}else{startListLevel=abstractList.levels[0];}}}if(sf.base.isNullOrUndefined(list)||!sf.base.isNullOrUndefined(list)&&levelNumber===0&&(startListLevel.listLevelPattern!==listLevelPattern||startListLevel.numberFormat!==format||startListLevel.characterFormat.fontFamily!==fontFamily&&startListLevel.listLevelPattern==='Bullet')){isUpdate=false;list=new WList();if(this.documentHelper.lists.length>0){list.listId=this.documentHelper.lists[this.documentHelper.lists.length-1].listId+1;}else{list.listId=0;}var abstractList=new WAbstractList();if(this.documentHelper.abstractLists.length>0){abstractList.abstractListId=this.documentHelper.abstractLists[this.documentHelper.abstractLists.length-1].abstractListId+1;}else{abstractList.abstractListId=0;}list.abstractListId=abstractList.abstractListId;list.abstractList=abstractList;this.documentHelper.abstractLists.push(abstractList);if(format==='bullet'||format==='multiLevel'||format==='numbering'){this.addListLevels(abstractList,format,selection);}else{var listLevel=new WListLevel(abstractList);listLevel.listLevelPattern=listLevelPattern;listLevel.numberFormat=format;if(listLevelPattern!=='Bullet'){listLevel.startAt=1;}else{listLevel.characterFormat.fontFamily=fontFamily;}listLevel.paragraphFormat.leftIndent=36;listLevel.paragraphFormat.firstLineIndent=-18;abstractList.levels.push(listLevel);selection.paragraphFormat.listLevelNumber=0;}selection.paragraphFormat.setList(list);}else if(isSameList&&!sf.base.isNullOrUndefined(list)){var tempList=this.documentHelper.getListById(currentParagraph.paragraphFormat.listFormat.listId);var listLevel=this.documentHelper.layout.getListLevel(tempList,levelNumber);if(listLevelPattern==='Bullet'){listLevel.numberFormat=format;listLevel.characterFormat.fontFamily=fontFamily;}else{listLevel.listLevelPattern=listLevelPattern;listLevel.characterFormat.fontFamily=fontFamily;var currentFormat=listLevel.numberFormat.substring(listLevel.numberFormat.length-1);if(listLevel.numberFormat.length!==format.length&&levelNumber>0){listLevel.numberFormat=format;}else if(format.substring(format.length-1)!==listLevel.numberFormat.substring(listLevel.numberFormat.length-1)){listLevel.numberFormat=listLevel.numberFormat.replace(currentFormat,format.substring(format.length-1));}}selection.paragraphFormat.setList(tempList);}else if(!sf.base.isNullOrUndefined(list)&&isUpdate){selection.paragraphFormat.setList(list);}else{selection.paragraphFormat.setList(undefined);}};Editor.prototype.addListLevels=function(abstractListAdv,listName,selection){var bulletCharacters=["\uF076","\uF0D8","\uF0A7","\uF0B7","\uF0A8"];for(var i=abstractListAdv.levels.length;i<9;i++){var listLevel=new WListLevel(abstractListAdv);if(listName.match('bullet')){listLevel.listLevelPattern='Bullet';listLevel.numberFormat=bulletCharacters[i<5?i%5:i%5+1];listLevel.characterFormat.fontFamily=i<3||i===5?'Wingdings':'Symbol';}else{if(listName.match('multiLevel')){for(var j=0;j<i+1;j++){listLevel.numberFormat+='%'+(j+1).toString()+'.';}listLevel.listLevelPattern='Number';}else{listLevel.numberFormat='%'+(i+1).toString()+')';listLevel.listLevelPattern=i%3===0?'Number':i%3===1?'LowLetter':'LowRoman';}listLevel.startAt=1;listLevel.restartLevel=i;}if(i===0){listLevel.paragraphFormat.leftIndent=36;}else{listLevel.paragraphFormat.leftIndent=36*i;}listLevel.paragraphFormat.firstLineIndent=-18;abstractListAdv.levels.push(listLevel);selection.paragraphFormat.listLevelNumber=i;}};/**
     * Insert page break at cursor position
     *
     * @returns {void}
     */Editor.prototype.insertPageBreak=function(){if(!this.owner.isReadOnlyMode){if(this.documentHelper.selection.start.paragraph.isInsideTable||this.documentHelper.selection.start.paragraph.isInHeaderFooter){return;}this.initComplexHistory('PageBreak');this.onEnter(true);if(this.editorHistory&&this.editorHistory.currentHistoryInfo!==null){this.editorHistory.updateComplexHistory();}this.selection.checkForCursorVisibility();}};/**
     * @private
     * @returns {void}
     */Editor.prototype.onEnter=function(isInsertPageBreak){var selection=this.documentHelper.selection;var format;if(sf.base.isNullOrUndefined(selection.start.paragraph.paragraphFormat.baseStyle)||selection.start.paragraph.paragraphFormat.baseStyle.name==='Normal'){format=new SelectionCharacterFormat(undefined);format.cloneFormat(this.selection.characterFormat);}if(this.isXmlMapped){return;}if(selection.isEmpty){//ToDo: Need to handle the CTRL + Enter (Page Break) and SHIFT + Enter (Line Break) behavior.
var hyperlinkField=selection.getHyperlinkField();var isSelectionOnHyperlink=!sf.base.isNullOrUndefined(hyperlinkField);if(isSelectionOnHyperlink){selection.fireRequestNavigate(hyperlinkField);return;}var paragraph=selection.start.paragraph;if(paragraph.isEmpty()&&paragraph.paragraphFormat.listFormat.listId!==-1){this.onApplyListInternal(this.documentHelper.getListById(paragraph.paragraphFormat.listFormat.listId),paragraph.paragraphFormat.listFormat.listLevelNumber-1);return;}}this.initHistory('Enter');var isRemoved=true;if(!selection.isEmpty){// this.initHistoryWithSelection(selection, 'Enter');
isRemoved=this.removeSelectedContents(selection);}if(isRemoved){selection.owner.isShiftingEnabled=true;this.updateInsertPosition();var blockInfo=this.selection.getParagraphInfo(selection.start);var initialStart=this.selection.getHierarchicalIndex(blockInfo.paragraph,blockInfo.offset.toString());this.splitParagraphInternal(selection,selection.start.paragraph,selection.start.currentWidget,selection.start.offset);this.setPositionForCurrentIndex(selection.start,initialStart);if(isInsertPageBreak){var currentParagraph=selection.start.paragraph;var breakParagraph=new ParagraphWidget();breakParagraph.characterFormat.copyFormat(currentParagraph.characterFormat);breakParagraph.paragraphFormat.copyFormat(currentParagraph.paragraphFormat);var pageBreak=new TextElementBox();pageBreak.text='\f';var line=new LineWidget(breakParagraph);line.children.push(pageBreak);pageBreak.line=line;breakParagraph.childWidgets.push(line);if(this.owner.enableTrackChanges&&currentParagraph.characterFormat.revisions.length>0){var currentRevision=this.retrieveRevisionInOder(currentParagraph.characterFormat);currentRevision.range.push(breakParagraph.characterFormat);breakParagraph.characterFormat.revisions.push(currentRevision);breakParagraph.characterFormat.removedIds=[];}this.insertParagraph(breakParagraph,true);selection.selectParagraphInternal(breakParagraph,true);}var nextNode=selection.start.paragraph.nextWidget;if(sf.base.isNullOrUndefined(nextNode)){nextNode=selection.getNextRenderedBlock(selection.start.paragraph);}selection.selectParagraphInternal(nextNode,true);this.updateEndPosition();if(isInsertPageBreak&&this.editorHistory){this.owner.editorHistory.updateHistory();}// if (!isNullOrUndefined(selection.currentHistoryInfo)) {
//     this.updateComplexHistory();
// } else {
this.reLayout(selection);var currentPara=this.selection.start.paragraph.containerWidget.firstChild;if(!sf.base.isNullOrUndefined(currentPara)){currentPara.isChangeDetected=false;var nextPara=currentPara.nextRenderedWidget;while(this.owner.isSpellCheck&&!sf.base.isNullOrUndefined(nextPara)){currentPara=nextPara;currentPara.isChangeDetected=false;nextPara=currentPara.nextRenderedWidget;}}// }
var paragraph=selection.start.paragraph.previousWidget;if(!sf.base.isNullOrUndefined(paragraph)&&!paragraph.isEmpty()&&paragraph.lastChild.children[paragraph.lastChild.children.length-1]instanceof TextElementBox){this.checkAndConvertToHyperlink(selection,true,paragraph);}}if(!sf.base.isNullOrUndefined(format)&&!sf.base.isNullOrUndefined(selection.start.paragraph)&&selection.start.paragraph.isEmpty()){this.selection.isRetrieveFormatting=true;this.selection.characterFormat.cloneFormat(format);this.selection.isRetrieveFormatting=false;}};Editor.prototype.splitParagraphInternal=function(selection,paragraphAdv,currentLine,offset){var insertIndex=0;var blockIndex=paragraphAdv.index;var currentPara=paragraphAdv;currentPara.isChangeDetected=offset===0?true:false;while(this.owner.isSpellCheck&&!sf.base.isNullOrUndefined(currentPara.nextRenderedWidget)){currentPara=currentPara.nextRenderedWidget;currentPara.isChangeDetected=true;}var paragraph=new ParagraphWidget();var lineWidget=new LineWidget(paragraph);paragraph.childWidgets.push(lineWidget);//Cop ies the format to new paragraph.
paragraph.paragraphFormat.ownerBase=paragraph;paragraph.footNoteReference=paragraphAdv.footNoteReference;if(currentLine===paragraphAdv.lastChild&&offset===selection.getLineLength(currentLine)){if(paragraphAdv.paragraphFormat.baseStyle&&paragraphAdv.paragraphFormat.baseStyle.name!=='Normal'&&paragraphAdv.paragraphFormat.baseStyle.next instanceof WParagraphStyle){if(paragraphAdv.paragraphFormat.baseStyle.name===paragraphAdv.paragraphFormat.baseStyle.next.name){paragraph.paragraphFormat.copyFormat(paragraphAdv.paragraphFormat);paragraph.characterFormat.copyFormat(paragraphAdv.characterFormat);}else{paragraph.paragraphFormat.baseStyle=paragraphAdv.paragraphFormat.baseStyle.next;}this.selection.skipFormatRetrieval=false;}else{paragraph.paragraphFormat.copyFormat(paragraphAdv.paragraphFormat);paragraph.characterFormat.copyFormat(paragraphAdv.characterFormat);}if(paragraphAdv.lastChild.children.length>0){paragraphAdv.characterFormat.copyFormat(paragraphAdv.lastChild.children[paragraphAdv.lastChild.children.length-1].characterFormat);}// let revisions: Revision[] = [];
// if (paragraphAdv.characterFormat.revisions.length > 0) {
//     revisions = paragraphAdv.characterFormat.revisions;
// } else {
if(this.owner.enableTrackChanges){var lastLine=paragraphAdv.lastChild;if(!sf.base.isNullOrUndefined(lastLine)&&lastLine.children.length>0){var lastElement=lastLine.children[lastLine.children.length-1].previousValidNodeForTracking;//ensure whether para mark can be combined with element revision
if(!this.checkParaMarkMatchedWithElement(lastElement,paragraphAdv.characterFormat,false,'Insertion')){this.insertParaRevision(paragraphAdv);}}}//}
//ToDo in future: Need to skip copying formattings to new paragraph, if the style for following paragraph is same style.
insertIndex++;blockIndex++;}else{paragraph.paragraphFormat.copyFormat(paragraphAdv.paragraphFormat);paragraph.characterFormat.copyFormat(paragraphAdv.characterFormat);if(offset>0||!currentLine.isFirstLine()){paragraphAdv=paragraphAdv.combineWidget(this.owner.viewer);this.moveInlines(paragraphAdv,paragraph,0,0,paragraphAdv.firstChild,offset,currentLine);this.insertParaRevision(paragraph,paragraphAdv.firstChild);}else{if(this.owner.enableTrackChanges){var firstLine=paragraphAdv.firstChild;var firstElement=firstLine.children[0].previousValidNodeForTracking;//ensure whether para mark can be combined with element revision
if(!this.checkParaMarkMatchedWithElement(firstElement,paragraph.characterFormat,true,'Insertion')){this.insertParaRevision(paragraph);}}}paragraphAdv=paragraphAdv.getSplitWidgets()[0];}insertIndex+=paragraphAdv.getIndex();var container=paragraphAdv.containerWidget;var childNodes=container.childWidgets;childNodes.splice(insertIndex,0,paragraph);if(this.owner.enableTrackChanges&&paragraph.characterFormat.revisions.length===0&&paragraphAdv.characterFormat.revisions.length===0){if(!this.checkToMatchEmptyParaMark(paragraphAdv)){this.insertParaRevision(paragraphAdv);}}paragraph.containerWidget=container;paragraph.index=blockIndex;this.updateNextBlocksIndex(paragraph,true);this.documentHelper.layout.layoutBodyWidgetCollection(blockIndex,container,paragraph,false);};Editor.prototype.insertParaRevision=function(paragraph,firstChild){if(this.owner.enableTrackChanges&&sf.base.isNullOrUndefined(firstChild)&&!this.isRevisionMatched(paragraph.characterFormat,'Insertion')){paragraph.characterFormat.revisions=[];this.insertRevision(paragraph.characterFormat,'Insertion');}//If it is spitted para, we need to ensure whether first element of the spitted para matches with inserted revision
if(!sf.base.isNullOrUndefined(firstChild)){if(firstChild.paragraph.isInsideTable){this.insertRevision(paragraph.characterFormat,'Insertion');return;}this.applyRevisionForParaMark(paragraph,firstChild,'Insertion',true);// let firstElement: ElementBox = firstChild.children[0];
// firstElement = firstElement.nextValidNodeForTracking;
// let lastLine: LineWidget = paragraph.lastChild as LineWidget;
// let lastElement: ElementBox = lastLine.children.length === 0 ? undefined : lastLine.children[lastLine.children.length - 1].previousValidNodeForTracking;
// let isCombined: boolean = false;
// //Ensure revision matched with inserted para mark
// if (!isNullOrUndefined(lastElement)) {
//     isCombined = this.checkParaMarkMatchedWithElement(lastElement, paragraph.characterFormat, true);
// }
// if (!isNullOrUndefined(firstElement)) {
//     if (paragraph.characterFormat.revisions.length > 0) {
//         if (this.isRevisionMatched(firstElement, 'Insertion')) {
//             let revisionToInclude: Revision = paragraph.characterFormat.revisions[0];
//             let matchedRevisions: Revision[] = this.getMatchedRevisionsToCombine(firstElement.revisions, 'Insertion');
//             for (let i: number = 0; i < matchedRevisions.length; i++) {
//                 isCombined = true;
//                 this.clearAndUpdateRevisons(matchedRevisions[i].range, revisionToInclude, revisionToInclude.range.indexOf(paragraph.characterFormat) + 1);
//             }
//         }
//     } else {
//         isCombined = this.checkParaMarkMatchedWithElement(firstElement, paragraph.characterFormat, false);
//     }
// }
// if (!isCombined) {
//     this.insertRevision(paragraph.characterFormat, 'Insertion');
// }
}};Editor.prototype.applyRevisionForParaMark=function(paragraph,firstChild,revisionType,splitRevision){var firstElement=firstChild.children[0];if(sf.base.isNullOrUndefined(firstElement)){return;}firstElement=firstElement.nextValidNodeForTracking;var lastLine=paragraph.lastChild;var lastElement=lastLine.children.length===0?undefined:lastLine.children[lastLine.children.length-1].previousValidNodeForTracking;var isCombined=false;var prevRevCount=paragraph.characterFormat.revisions.length;//Ensure revision matched with inserted para mark
if(!sf.base.isNullOrUndefined(lastElement)){isCombined=this.checkParaMarkMatchedWithElement(lastElement,paragraph.characterFormat,false,revisionType);}if(!sf.base.isNullOrUndefined(firstElement)){//Ensure previous inserted para mark revision matched with first element of the next paragraph.
if(paragraph.characterFormat.revisions.length>prevRevCount){if(this.isRevisionMatched(firstElement,revisionType)){var revisionToInclude=paragraph.characterFormat.revisions[0];var matchedRevisions=this.getMatchedRevisionsToCombine(firstElement.revisions,revisionType);for(var i=0;i<matchedRevisions.length;i++){if(matchedRevisions[i]!==revisionToInclude){isCombined=true;this.clearAndUpdateRevisons(matchedRevisions[i].range,revisionToInclude,revisionToInclude.range.indexOf(paragraph.characterFormat)+1);}}}}else{isCombined=this.checkParaMarkMatchedWithElement(firstElement,paragraph.characterFormat,true,revisionType);}}if(!isCombined&&(this.owner.enableTrackChanges||firstChild.paragraph.characterFormat.revisions.length>0)){this.insertRevision(paragraph.characterFormat,revisionType);// for spitted paragraph on moving content we maintain same revision, so if it not matched with inserted paragraph then we need to spit it.
if(splitRevision&&lastElement.revisions.length>0&&firstElement.revisions.length>0){this.updateRevisionForSpittedTextElement(lastElement,firstElement);}}};//Combines para mark with element revision
Editor.prototype.checkParaMarkMatchedWithElement=function(lastElement,characterFormat,isBegin,revisionType){var matchedRevisions=this.getMatchedRevisionsToCombine(lastElement.revisions,revisionType);if(matchedRevisions.length>0){this.mapMatchedRevisions(matchedRevisions,lastElement,characterFormat,isBegin);return true;}return false;};Editor.prototype.checkToMatchEmptyParaMark=function(paraWidget){var prevPara=paraWidget.previousRenderedWidget;if(!sf.base.isNullOrUndefined(prevPara)&&prevPara instanceof ParagraphWidget&&prevPara.characterFormat.revisions.length>0){var matchedRevisions=this.getMatchedRevisionsToCombine(prevPara.characterFormat.revisions,'Insertion');if(matchedRevisions.length>0){this.mapMatchedRevisions(matchedRevisions,prevPara.characterFormat,paraWidget.characterFormat,false);return true;}}return false;};/**
     * @private
     * @returns {void}
     */Editor.prototype.updateNextBlocksIndex=function(block,increaseIndex){var nextIndex=block.containerWidget.childWidgets.indexOf(block)+1;if(block.containerWidget instanceof BodyWidget){var currentSectionIndex=block.containerWidget.index;for(var j=this.documentHelper.pages.indexOf(block.containerWidget.page);j<this.documentHelper.pages.length;j++){var page=this.documentHelper.pages[j];if(page.bodyWidgets[0].index===currentSectionIndex){for(var k=nextIndex;k<page.bodyWidgets[0].childWidgets.length;k++){var childWidget=page.bodyWidgets[0].childWidgets[k];this.updateIndex(childWidget,increaseIndex);}nextIndex=0;}else{return;}}}else if(block.containerWidget instanceof TableCellWidget){var cells=block.containerWidget.getSplitWidgets();var currentCellIndex=cells.indexOf(block.containerWidget);for(var x=currentCellIndex;x<cells.length;x++){var blocks=cells[x].childWidgets;for(var y=nextIndex;y<blocks.length;y++){this.updateIndex(blocks[y],increaseIndex);}currentCellIndex=0;nextIndex=0;}}else if(block.containerWidget instanceof TableRowWidget){for(var i=nextIndex;i<block.containerWidget.childWidgets.length;i++){var cell=block.containerWidget.childWidgets[i];if(cell.rowIndex===block.containerWidget.index){this.updateIndex(cell,increaseIndex);}}}else if(block.containerWidget instanceof TableWidget){for(var i=nextIndex;i<block.containerWidget.childWidgets.length;i++){var row=block.containerWidget.childWidgets[i];this.updateIndex(row,increaseIndex);for(var j=0;j<row.childWidgets.length;j++){var cell=row.childWidgets[j];cell.rowIndex=row.index;cell.index=j;}}//update Row index of all the cell
}else if(block.containerWidget instanceof HeaderFooterWidget||block.containerWidget instanceof TextFrame||block.containerWidget instanceof FootNoteWidget){for(var i=nextIndex;i<block.containerWidget.childWidgets.length;i++){var nextBlock=block.containerWidget.childWidgets[i];this.updateIndex(nextBlock,increaseIndex);}}};Editor.prototype.updateIndex=function(widget,increment){if(increment){widget.index++;}else{widget.index--;}};/**
     * @private
     * @returns {void}
     */Editor.prototype.updateEndPosition=function(){var selection=this.documentHelper.selection;if(this.editorHistory&&!sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo)){this.updateHistoryPosition(selection.start,false);}};/**
     * @private
     * @returns {void}
     */Editor.prototype.onBackSpace=function(){this.removeEditRange=true;var selection=this.documentHelper.selection;this.documentHelper.triggerSpellCheck=true;if(selection.isEmpty){this.singleBackspace(selection,false);}else{this.initHistory('BackSpace');var skipBackSpace=this.deleteSelectedContents(selection,true);if(this.editorHistory&&this.editorHistory.currentBaseHistoryInfo){if(skipBackSpace){this.editorHistory.currentBaseHistoryInfo=undefined;}else{if(this.checkEndPosition(selection)){this.updateHistoryPosition(selection.end,false);}this.reLayout(selection);this.insertSpaceInFormField();}}this.documentHelper.triggerSpellCheck=false;}this.removeEditRange=false;this.updateXmlMappedContentControl();};/**
     * @private
     * @returns {boolean}
     */Editor.prototype.insertRemoveBookMarkElements=function(){var isHandledComplexHistory=false;for(var i=0;i<this.removedBookmarkElements.length;i++){var bookMark=this.removedBookmarkElements[i];if(bookMark.bookmarkType===0){if(!this.documentHelper.bookmarks.containsKey(bookMark.name)){this.documentHelper.bookmarks.add(bookMark.name,bookMark);}var bookMarkStart=bookMark;if(bookMarkStart&&bookMarkStart.reference&&this.removedBookmarkElements.indexOf(bookMarkStart.reference)!==-1){var endIndex=this.removedBookmarkElements.indexOf(bookMarkStart.reference);var startIndex=this.removedBookmarkElements.indexOf(bookMarkStart);this.removedBookmarkElements.splice(endIndex,1);this.removedBookmarkElements.splice(startIndex,1);i--;}else{if(this.editorHistory.currentBaseHistoryInfo){this.initComplexHistory(this.editorHistory.currentBaseHistoryInfo.action);this.editorHistory.updateHistory();}this.initInsertInline(bookMarkStart.clone());if(this.editorHistory.currentHistoryInfo){this.editorHistory.updateComplexHistory();isHandledComplexHistory=true;}}}else{var bookMarkEnd=bookMark;if(bookMarkEnd&&bookMarkEnd.reference&&this.removedBookmarkElements.indexOf(bookMarkEnd.reference)!==-1){var endIndex=this.removedBookmarkElements.indexOf(bookMarkEnd.reference);var startIndex=this.removedBookmarkElements.indexOf(bookMarkEnd);this.removedBookmarkElements.splice(endIndex,1);this.removedBookmarkElements.splice(startIndex,1);i--;}else{if(this.editorHistory.currentBaseHistoryInfo){this.initComplexHistory(this.editorHistory.currentBaseHistoryInfo.action);this.editorHistory.updateHistory();}this.initInsertInline(bookMarkEnd.clone());if(this.editorHistory.currentHistoryInfo){this.editorHistory.updateComplexHistory();isHandledComplexHistory=true;}}}}this.removedBookmarkElements=[];return isHandledComplexHistory;};/**
     * @private
     * @param {Selection} selection - Specifies the selection
     * @param {boolean} isBackSpace - Specifies is backspace.
     * @returns {boolean}
     */Editor.prototype.deleteSelectedContents=function(selection,isBackSpace){var skipBackSpace=this.deleteSelectedContentInternal(selection,isBackSpace,selection.start,selection.end);var textPosition=selection.getTextPosBasedOnLogicalIndex(selection.editPosition);selection.selectContent(textPosition,true);return skipBackSpace;};Editor.prototype.removeWholeElement=function(selection){this.initHistory('BackSpace');this.deleteSelectedContents(selection,true);if(this.checkEndPosition(selection)){this.updateHistoryPosition(selection.end,false);}this.reLayout(selection);};/**
     * Remove single character on left of cursor position
     *
     * @param {Selection} selection - Specifies the selection
     * @param {boolean} isRedoing - Specified the is redoing.
     * @private
     * @returns {void}
     */Editor.prototype.singleBackspace=function(selection,isRedoing){var history=this.editorHistory;// If backspace is pressed after auto format to hyperlink is done, need to undo auto format.
if(history&&!isRedoing&&!history.canRedo()&&history.canUndo()){var historyInfo=history.undoStack[history.undoStack.length-1];var startBlockInfo=this.selection.getParagraphInfo(selection.start);var endBlockInfo=this.selection.getParagraphInfo(selection.end);if(historyInfo.action==='AutoFormatHyperlink'&&historyInfo.insertPosition===this.selection.getHierarchicalIndex(startBlockInfo.paragraph,startBlockInfo.offset.toString())&&historyInfo.endPosition===this.selection.getHierarchicalIndex(endBlockInfo.paragraph,endBlockInfo.offset.toString())){history.undo();return;}}var isCommentDelete=false;var paragraph=selection.start.paragraph;var currentLineWidget=selection.start.currentWidget;var offset=selection.start.offset;var indexInInline=0;var inlineObj=currentLineWidget.getInline(offset,indexInInline);var inline=inlineObj.element;if(this.selection.isInlineFormFillMode()){if(inline instanceof FieldElementBox&&inline.fieldType===2){return;}var resultText=this.getFormFieldText();if(resultText.length===1){this.selection.selectFieldInternal(this.selection.getCurrentFormField());this.insertTextInternal(this.documentHelper.textHelper.repeatChar(this.documentHelper.textHelper.getEnSpaceCharacter(),5),true);this.selection.selectTextElementStartOfField(this.selection.getCurrentFormField());return;}}indexInInline=inlineObj.index;if(inline instanceof TextElementBox){inline.ignoreOnceItems=[];}if(inline instanceof TextElementBox){inline.ignoreOnceItems=[];}if(inline instanceof FieldElementBox&&inline.fieldType===2){if(HelperMethods.isLinkedFieldCharacter(inline)){var begin=inline.fieldBegin;var end=inline.fieldEnd;if(begin.nextNode instanceof BookmarkElementBox){end=begin.nextNode.reference;}selection.start.setPositionParagraph(begin.line,begin.line.getOffset(begin,0));selection.end.setPositionParagraph(end.line,end.line.getOffset(end,0)+1);selection.fireSelectionChanged(true);return;}}if(inline instanceof FootnoteElementBox){if(inline.footnoteType==='Footnote'){this.removeFootnote(inline);}else{this.removeEndnote(inline);}}if(inline&&(inline instanceof ContentControl||inline.previousNode instanceof ContentControl)){if(inline instanceof ContentControl&&inline.previousNode){inline=inline.previousNode;paragraph=inline.line.paragraph;offset=inline.line.getOffset(inline,inline.length);}if(inline&&inline.length===1&&inline.nextNode instanceof ContentControl&&inline.previousNode instanceof ContentControl){var start=inline.previousNode;var end=inline.nextNode;if(!start.contentControlProperties.lockContentControl){selection.start.setPositionParagraph(start.line,start.line.getOffset(start,0));selection.end.setPositionParagraph(end.line,end.line.getOffset(end,0)+1);this.removeWholeElement(selection);return;}}}if(inline&&(inline instanceof BookmarkElementBox||inline.previousNode instanceof BookmarkElementBox)){if(inline instanceof BookmarkElementBox&&inline.bookmarkType===1){if(inline.previousNode){inline=inline.previousNode;paragraph=inline.line.paragraph;offset=inline.line.getOffset(inline,inline.length);}else{// remove paragraph mark and move bookmark to previous paragraph
if(paragraph.previousRenderedWidget instanceof ParagraphWidget){var prevParagraph=paragraph.previousRenderedWidget;var line=prevParagraph.lastChild;selection.start.setPositionParagraph(inline.line,inline.line.getOffset(inline,0));selection.end.setPositionParagraph(line,line.getEndOffset());this.removeWholeElement(selection);return;}}// Remove bookmark if selection is in between bookmark start and end element.
}else if(inline.nextNode instanceof BookmarkElementBox&&inline instanceof BookmarkElementBox&&inline.bookmarkType===0&&inline.reference===inline.nextNode){this.deleteBookmark(inline.name);return;}if(inline.length===1&&inline.nextNode instanceof BookmarkElementBox&&inline.previousNode instanceof BookmarkElementBox){var begin=inline.previousNode;var end=inline.nextNode;selection.start.setPositionParagraph(begin.line,begin.line.getOffset(begin,0));selection.end.setPositionParagraph(end.line,end.line.getOffset(end,0)+1);this.removeWholeElement(selection);return;}}if(inline instanceof CommentCharacterElementBox&&inline.commentType===1){var comment=inline.comment;if(comment.isReply){comment=comment.ownerComment;}while(inline instanceof CommentCharacterElementBox){inline=inline.previousNode;}this.deleteCommentInternal(comment);paragraph=inline.line.paragraph;offset=inline.line.getOffset(inline,inline.length);selection.start.setPositionParagraph(inline.line,offset);selection.end.setPositionParagraph(inline.line,offset);isCommentDelete=true;}if(inline instanceof FieldElementBox&&inline.fieldType===1){var prevInline=selection.getPreviousValidElement(inline);if(prevInline instanceof FieldElementBox){inline=prevInline.fieldBegin;paragraph=inline.line.paragraph;offset=inline.line.getOffset(inline,0);if(inline.nextNode instanceof BookmarkElementBox){var start=inline.nextNode.reference;selection.start.setPositionParagraph(start.line,start.line.getOffset(start,0));}selection.end.setPositionParagraph(inline.line,offset);//Selects the entire field.
selection.fireSelectionChanged(true);return;}else if(prevInline!==inline){inline=prevInline;//Updates the offset to delete next content.
paragraph=inline.line.paragraph;offset=inline.line.getOffset(inline,inline.length);}}if(inline instanceof EditRangeStartElementBox||inline instanceof EditRangeEndElementBox){if(inline.nextNode instanceof EditRangeEndElementBox&&inline.editRangeEnd===inline.nextNode||inline.previousNode instanceof EditRangeStartElementBox&&inline.editRangeStart===inline.previousNode){return;}if(inline instanceof EditRangeStartElementBox&&!(inline.previousNode instanceof EditRangeEndElementBox)){return;}if(inline instanceof EditRangeEndElementBox){if(!sf.base.isNullOrUndefined(inline.previousNode)){inline=inline.previousNode;paragraph=inline.line.paragraph;offset=inline.line.getOffset(inline,inline.length);}}if(inline.length===1&&inline.nextNode instanceof EditRangeEndElementBox&&inline.previousNode instanceof EditRangeStartElementBox){var start=inline.previousNode;var end=inline.nextNode;selection.start.setPositionParagraph(start.line,start.line.getOffset(start,0));selection.end.setPositionParagraph(end.line,end.line.getOffset(end,0)+1);this.removeWholeElement(selection);return;}}if(!isRedoing){this.initHistory('BackSpace');}if(offset===selection.getStartOffset(paragraph)&&selection.start.currentWidget.isFirstLine()){if(paragraph.paragraphFormat.listFormat&&paragraph.paragraphFormat.listFormat.listId!==-1){this.onApplyList(undefined);return;}if(paragraph.paragraphFormat.firstLineIndent!==0){this.onApplyParagraphFormat('firstLineIndent',0,false,false);return;}if(paragraph.paragraphFormat.leftIndent!==0){this.onApplyParagraphFormat('leftIndent',0,false,false);return;}if(!paragraph.paragraphFormat.bidi&&paragraph.paragraphFormat.textAlignment!=='Left'){this.onApplyParagraphFormat('textAlignment','Left',false,true);return;}if(paragraph.previousRenderedWidget instanceof ParagraphWidget){selection.owner.isShiftingEnabled=true;var previousParagraph=paragraph.previousRenderedWidget;// if (isNullOrUndefined(previousParagraph)) {
//     previousParagraph = this.documentHelper.selection.getPreviousBlock(paragraph) as ParagraphWidget;
// }
if(previousParagraph.isEmpty()){this.removeBlock(previousParagraph);this.addRemovedNodes(previousParagraph);}else{this.removeBlock(paragraph);var endOffset=this.documentHelper.selection.getLineLength(previousParagraph.lastChild);var previousIndex=previousParagraph.childWidgets.length-1;var lineWidget=void 0;if(!paragraph.isEmpty()){for(var i=0;i<paragraph.childWidgets.length;i++){lineWidget=paragraph.childWidgets[i];previousParagraph.childWidgets.push(lineWidget);paragraph.childWidgets.splice(i,1);i--;lineWidget.paragraph=previousParagraph;}}this.documentHelper.layout.reLayoutParagraph(previousParagraph,previousIndex,0);selection.selects(previousParagraph.childWidgets[previousIndex],endOffset,true);this.addRemovedNodes(paragraph);}this.setPositionForHistory();var footNoteWidgets=this.documentHelper.layout.getFootNoteWidgetsOf(paragraph);if(footNoteWidgets.length>0){var layout=this.documentHelper.layout;var bodyWidget=paragraph.containerWidget;layout.layoutfootNote(bodyWidget.page.footnoteWidget);}// if (!isRedoing) {
this.reLayout(selection);// }
}else{if(this.editorHistory){this.editorHistory.currentBaseHistoryInfo=undefined;}}}else{if(!isRedoing){selection.owner.isShiftingEnabled=true;}var paragraphInfo=this.selection.getParagraphInfo(selection.start);var lineWidget=selection.start.currentWidget;var removeOffset=offset-1;if(removeOffset<0){lineWidget=lineWidget.previousLine;removeOffset=this.documentHelper.selection.getLineLength(lineWidget)+removeOffset;}this.removeAtOffset(lineWidget,selection,removeOffset);this.setPositionParagraph(paragraphInfo.paragraph,paragraphInfo.offset-1,false);this.setPositionForHistory();if(!isRedoing){this.reLayout(selection);if(isCommentDelete){this.owner.editorHistory.undoStack[this.owner.editorHistory.undoStack.length-2].modifiedActions.push(this.owner.editorHistory.undoStack[this.owner.editorHistory.undoStack.length-1]);this.owner.editorHistory.undoStack.splice(this.owner.editorHistory.undoStack.length-1,1);isCommentDelete=false;}}else{this.fireContentChange();}}};Editor.prototype.setPositionForHistory=function(editPosition){var selection=this.documentHelper.selection;if(this.editorHistory&&!sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo)){if(sf.base.isNullOrUndefined(editPosition)){this.updateHistoryPosition(selection.start,true);this.editorHistory.currentBaseHistoryInfo.endPosition=this.editorHistory.currentBaseHistoryInfo.insertPosition;}else{this.editorHistory.currentBaseHistoryInfo.insertPosition=editPosition;this.editorHistory.currentBaseHistoryInfo.endPosition=editPosition;}}};Editor.prototype.removeAtOffset=function(lineWidget,selection,offset){var count=0;var lineIndex=lineWidget.paragraph.childWidgets.indexOf(lineWidget);var isBidi=lineWidget.paragraph.paragraphFormat.bidi;var childLength=lineWidget.children.length;if(!isBidi&&this.viewer.documentHelper.layout.isContainsRtl(lineWidget)){var inline=lineWidget.children[0];var endElement=undefined;var indexOf=-1;var isStarted=true;while(inline){while((isStarted||sf.base.isNullOrUndefined(endElement))&&inline instanceof TextElementBox&&(this.documentHelper.textHelper.isRTLText(inline.text)||this.documentHelper.textHelper.containsSpecialCharAlone(inline.text))&&inline.nextElement){if(!endElement){endElement=inline;}if(indexOf===-1){indexOf=lineWidget.children.indexOf(inline);}inline=inline.nextElement;}isStarted=false;var currentIndex=lineWidget.children.indexOf(inline);var isBreak=this.removeCharacter(inline,offset,count,lineWidget,lineIndex,currentIndex,true);if(isBreak){break;}count+=inline.length;if(endElement===inline){if(indexOf!==-1){inline=lineWidget.children[indexOf+1];}endElement=undefined;indexOf=-1;}else if(endElement){inline=inline.previousElement;}else{inline=inline.nextElement;}}}else{for(var i=!isBidi?0:childLength-1;!isBidi?i<childLength:i>=0;isBidi?i--:i++){var inline=lineWidget.children[i];if(inline instanceof ListTextElementBox){continue;}var isBreak=this.removeCharacter(inline,offset,count,lineWidget,lineIndex,i);if(isBreak){break;}count+=inline.length;}}};Editor.prototype.removeCharacter=function(inline,offset,count,lineWidget,lineIndex,i,isRearrange){var isBreak=false;if(inline instanceof BookmarkElementBox&&inline.line!==inline.reference.line){if(!sf.base.isNullOrUndefined(inline.line.previousLine)){inline.line.previousLine.children.splice(inline.line.previousLine.children.length,0,inline);inline.line=inline.line.previousLine;}else if(!sf.base.isNullOrUndefined(inline.line.paragraph.previousRenderedWidget)){inline.line.paragraph.previousRenderedWidget.lastChild.children.splice(inline.line.paragraph.previousRenderedWidget.lastChild.children.length,0,inline);inline.line=inline.line.paragraph.previousRenderedWidget.lastChild;}else if(!sf.base.isNullOrUndefined(inline.line.paragraph.nextRenderedWidget)){inline.line.paragraph.nextRenderedWidget.firstChild.children.splice(inline.line.paragraph.nextRenderedWidget.firstChild.children.length,0,inline);inline.line=inline.line.paragraph.nextRenderedWidget.firstChild;}lineWidget.children.splice(i,1);return true;}if(offset<count+inline.length){var indexInInline=offset-count;inline.ischangeDetected=true;if(this.owner.isSpellCheck){this.owner.spellChecker.removeErrorsFromCollection({'element':inline,'text':inline.text});}if(!inline.canTrigger){this.documentHelper.triggerSpellCheck=false;}if(offset===count&&inline.length===1){if(this.owner.enableTrackChanges&&!this.skipTracking()){this.addRemovedNodes(inline.clone());this.handleDeleteTracking(inline,indexInInline,1,i);}else{this.unLinkFieldCharacter(inline);this.unlinkRangeFromRevision(inline,true);this.addRemovedRevisionInfo(inline,undefined);this.addRemovedNodes(inline);lineWidget.children.splice(i,1);}this.documentHelper.layout.reLayoutParagraph(lineWidget.paragraph,lineIndex,i,undefined,isRearrange);}else{var span=this.handleDeleteTracking(inline,indexInInline,1);this.documentHelper.layout.reLayoutParagraph(lineWidget.paragraph,lineIndex,i,undefined,isRearrange);if(!sf.base.isNullOrUndefined(span)){if(inline.revisions.length>0){this.addRemovedRevisionInfo(inline,span);}this.addRemovedNodes(span);}}isBreak=true;}return isBreak;};Editor.prototype.removeCharacterInLine=function(inline,indexInInline,endOffset){var span=new TextElementBox();if(inline instanceof TextElementBox){span.characterFormat.copyFormat(inline.characterFormat);var removedCount=endOffset===1?1:endOffset-indexInInline;span.text=inline.text.substr(indexInInline,removedCount);var text=inline.text;inline.text=text.substring(0,indexInInline)+text.substring(indexInInline+removedCount,text.length);if(inline.contentControlProperties){span.contentControlProperties=inline.contentControlProperties.clone();}}return span;};Editor.prototype.removeRevisionsInformation=function(elementBox,indexInInline,endOffset,elementIndex){var removeElement=elementBox.previousElement;var revision;revision=this.retrieveRevisionInOder(removeElement);if(revision.revisionType==='Insertion'){if(this.isRevisionMatched(removeElement,undefined)){elementBox.line.children.splice(elementIndex,1);}}};Editor.prototype.handleDeleteTracking=function(elementBox,indexInInline,endOffset,elementIndex,startIndex,endIndex){var isTrackingEnabled=this.owner.enableTrackChanges;var isUndoing=sf.base.isNullOrUndefined(this.editorHistory)?false:this.editorHistory.isUndoing||this.editorHistory.isRedoing;var removedNode=undefined;if(this.canHandleDeletion()||isTrackingEnabled&&!this.skipTracking()){if(elementBox instanceof BookmarkElementBox||elementBox instanceof CommentCharacterElementBox||elementBox instanceof EditRangeStartElementBox||elementBox instanceof EditRangeEndElementBox){if(elementBox instanceof BookmarkElementBox&&elementBox.previousElement instanceof FieldElementBox&&elementBox.previousElement.formFieldData){if(elementBox.previousElement.revisions.length>0){this.removeRevisionsInformation(elementBox,indexInInline,endOffset,elementIndex);}}else{elementBox.line.children.splice(elementBox.indexInOwner,1);}return undefined;}var isDelete=false;if(this.owner.editorHistory){isDelete=!sf.base.isNullOrUndefined(this.owner.editorHistory.currentBaseHistoryInfo)&&this.owner.editorHistory.currentBaseHistoryInfo.action==='Delete';}if(!this.skipTableElements){this.updateEndRevisionIndex();}if(elementBox.revisions.length>0){var revision=this.retrieveRevisionInOder(elementBox);var index=this.owner.revisions.changes.indexOf(revision);if(revision.revisionType==='Insertion'){if(this.isRevisionMatched(elementBox,undefined)){// inserted revision same author as delete revision so we can delete
if(sf.base.isNullOrUndefined(elementIndex)){removedNode=this.removeCharacterInLine(elementBox,indexInInline,endOffset);}else{var index_1=revision.range.indexOf(elementBox);revision.range.splice(index_1,1);if(revision.range.length===0){this.owner.revisionsInternal.remove(revision);}this.unLinkFieldCharacter(elementBox);elementBox.line.children.splice(elementIndex,1);}}else{//Insert revision and delete revision (which is to be included) haven't matched
if(sf.base.isNullOrUndefined(elementIndex)){var text=this.removeCharacterInLine(elementBox,indexInInline,endOffset);if(indexInInline===0){var prevElement=elementBox.previousElement;this.handleDeletionForInsertRevision(prevElement,elementBox,text,endOffset,indexInInline,true);}else if(elementBox.length!==indexInInline){for(var i=elementBox.revisions.length-1;i>=0;i--){var revision_2=elementBox.revisions[i];var index_2=revision_2.range.indexOf(elementBox);var newElement=new TextElementBox();newElement.characterFormat.copyFormat(elementBox.characterFormat);newElement.line=elementBox.line;newElement.text=elementBox.text.substr(indexInInline);newElement.revisions.splice(0,0,revision_2);revision_2.range.splice(index_2+1,0,newElement);text.revisions.splice(0,0,revision_2);text.line=elementBox.line;revision_2.range.splice(index_2+1,0,text);elementBox.text=elementBox.text.substr(0,indexInInline);var indexInOwner=elementBox.indexInOwner;elementBox.line.children.splice(indexInOwner+1,0,newElement);elementBox.line.children.splice(indexInOwner+1,0,text);this.addRemovedNodes(text.clone());this.insertRevision(text,'Deletion');this.updateLastElementRevision(text);}}else if(elementBox.length===indexInInline){var nextElement=elementBox.nextElement;this.handleDeletionForInsertRevision(nextElement,elementBox,text,endOffset,indexInInline,false);}else{if(endOffset===1){if(!isDelete){this.selection.start.movePreviousPosition();this.selection.end.setPositionInternal(this.selection.start);}}else{this.updateCursorForInsertRevision(elementBox,indexInInline,endOffset);}this.addRemovedNodes(text.clone());this.insertInlineInternal(text,'Deletion');}}else if(!this.checkToCombineRevisionsInSides(elementBox,'Deletion')){this.insertRevision(elementBox,'Deletion');this.updateLastElementRevision(elementBox);}else{this.updateLastElementRevision(elementBox);}}}else if(revision.revisionType==='Deletion'){if(index!==-1&&revision.author!==this.owner.currentUser){var range=revision.range;var startOff=range[0].line.getOffset(range[0],0);var lastEle=range[range.length-1];var endOff=lastEle.line.getOffset(lastEle,lastEle.length);if(startOff===indexInInline&&endOff===endOffset){elementBox.revisions.splice(elementBox.revisions.indexOf(revision),1);if(!this.checkToCombineRevisionsInSides(elementBox,'Deletion')){this.insertRevision(elementBox,'Deletion');this.updateLastElementRevision(elementBox);}else{this.combineElementRevision(elementBox.revisions,elementBox.revisions);}if(elementBox.line.getOffset(elementBox,0)===startOff){this.owner.revisions.changes.splice(index,1);}}}if(endOffset===1){if(isDelete){this.selection.start.moveNextPosition();this.selection.end.setPositionInternal(this.selection.start);}else{this.selection.start.movePreviousPosition();this.selection.end.setPositionInternal(this.selection.start);}}else{if(this.isRevisionMatched(elementBox,'Deletion')){this.updateCursorForInsertRevision(elementBox,indexInInline,endOffset);}else{var rangeIndex=revision.range.indexOf(elementBox);var endOff=elementBox.line.getOffset(elementBox,elementBox.length);if(endOff>=endOffset&&revision.range.length>rangeIndex+1){this.updateRevisionForSpittedTextElement(elementBox,revision.range[rangeIndex+1]);revision.range.splice(revision.range.indexOf(elementBox),1);this.toCombineOrInsertRevision(elementBox,'Deletion');}else if(revision.range.length===1||indexInInline===0){this.handleDeleteBySplitting(elementBox,indexInInline,endOffset);if(rangeIndex!==-1&&revision.range.length!==1){this.updateRevisionForSpittedTextElement(revision.range[rangeIndex-1],revision.range[rangeIndex]);revision.range.splice(revision.range.indexOf(elementBox),1);}}else{revision.range.splice(revision.range.indexOf(elementBox),1);this.toCombineOrInsertRevision(elementBox,'Deletion');}}}this.updateLastElementRevision(elementBox);}}else{//No revision information in the element
if(!sf.base.isNullOrUndefined(elementIndex)){if(!this.checkToCombineRevisionsInSides(elementBox,'Deletion')){this.insertRevision(elementBox,'Deletion');}this.updateLastElementRevision(elementBox);}else{this.handleDeleteBySplitting(elementBox,indexInInline,endOffset);}}}else{removedNode=this.removeCharacterInLine(elementBox,indexInInline,endOffset);}return removedNode;};Editor.prototype.toCombineOrInsertRevision=function(elementBox,type){if(!this.checkToCombineRevisionsInSides(elementBox,type)){this.insertRevision(elementBox,type);this.updateLastElementRevision(elementBox);}else{this.combineElementRevision(elementBox.revisions,elementBox.revisions);}};Editor.prototype.updateLastElementRevision=function(elementBox){if(!this.skipTableElements){if(this.editorHistory&&this.editorHistory.currentBaseHistoryInfo&&!this.skipReplace&&(!sf.base.isNullOrUndefined(this.owner.search)?!this.owner.search.isRepalceTracking:true)){if(sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo.lastElementRevision)){this.editorHistory.currentBaseHistoryInfo.lastElementRevision=elementBox;elementBox.isMarkedForRevision=true;}}}};Editor.prototype.updateEndRevisionIndex=function(){if(!sf.base.isNullOrUndefined(this.editorHistory.undoStack)&&this.editorHistory.undoStack.length>0){var prevHistoryInfo=this.editorHistory.undoStack[this.editorHistory.undoStack.length-1];if(prevHistoryInfo.lastElementRevision&&sf.base.isNullOrUndefined(prevHistoryInfo.endRevisionLogicalIndex)){prevHistoryInfo.updateEndRevisionInfo();}}};Editor.prototype.retrieveRevisionInOder=function(elementBox){if(elementBox.revisions.length===1){return elementBox.revisions[0];}for(var i=0;i<elementBox.revisions.length;i++){if(elementBox.revisions[i].revisionType==='Deletion'){return elementBox.revisions[i];}}return elementBox.revisions[elementBox.revisions.length-1];};Editor.prototype.handleDeletionForInsertRevision=function(elementToEnsure,currentElement,spittedSpan,endOffset,indexInInline,isBegin){if(!sf.base.isNullOrUndefined(elementToEnsure)&&currentElement.revisions.length===0&&this.isRevisionMatched(elementToEnsure,'Deletion')){this.addRemovedNodes(spittedSpan.clone());this.insertTextInline(elementToEnsure,this.selection,spittedSpan.text,0);}else{var revision=currentElement.revisions[currentElement.revisions.length-1];var index=revision.range.indexOf(currentElement);revision.range.splice(isBegin?index:index+1,0,spittedSpan);spittedSpan.revisions.splice(0,0,revision);var isDelete=false;if(this.owner.editorHistory){isDelete=!sf.base.isNullOrUndefined(this.owner.editorHistory.currentBaseHistoryInfo)&&this.owner.editorHistory.currentBaseHistoryInfo.action==='Delete';}if(endOffset===1&&!isDelete){this.selection.start.movePreviousPosition();this.selection.end.setPositionInternal(this.selection.start);}else{this.updateCursorForInsertRevision(currentElement,indexInInline,endOffset);}this.addRemovedNodes(spittedSpan.clone());this.insertInlineInternal(spittedSpan,'Deletion');}};Editor.prototype.handleDeleteBySplitting=function(elementBox,indexInInline,endOffset){var isDelete=false;if(this.owner.editorHistory){isDelete=!sf.base.isNullOrUndefined(this.owner.editorHistory.currentBaseHistoryInfo)&&this.owner.editorHistory.currentBaseHistoryInfo.action==='Delete';}//Update cursor position to insert removed content
if(endOffset===1){var startPosition=elementBox.line.getOffset(elementBox,0);if(startPosition>0){var currentPosition=new TextPosition(this.owner);currentPosition.setPositionForLineWidget(elementBox.line,startPosition+indexInInline);this.selection.start.setPositionInternal(currentPosition);this.selection.end.setPositionInternal(this.selection.start);}else{if(!isDelete){this.selection.start.movePreviousPosition();this.selection.end.setPositionInternal(this.selection.start);}}}else{this.updateCursorForInsertRevision(elementBox,indexInInline,endOffset);}var spittedElement=this.removeCharacterInLine(elementBox,indexInInline,endOffset);this.addRemovedNodes(spittedElement.clone());this.insertTextInternal(spittedElement.text,false,'Deletion');};Editor.prototype.updateCursorForInsertRevision=function(inline,startOffset,endOffset){var startPosition=inline.line.getOffset(inline,0);if(startPosition>0){startOffset=startPosition+startOffset;endOffset=startPosition+endOffset;}var currentPosition=new TextPosition(this.owner);currentPosition.setPositionFromLine(inline.line,startOffset);var endPosition=new TextPosition(this.owner);endPosition.setPositionFromLine(inline.line,endOffset);if(!currentPosition.isExistBefore(endPosition)){this.selection.start.setPositionInternal(endPosition);this.selection.end.setPositionInternal(endPosition);}else{this.selection.end.setPositionInternal(currentPosition);this.selection.start.setPositionInternal(currentPosition);}};Editor.prototype.checkToCombineRevisionsInSides=function(currentElement,revisionType){var prevElement=currentElement.previousNode;var nextElement=currentElement.nextNode;var isCombined=false;if(!sf.base.isNullOrUndefined(prevElement)){prevElement=prevElement.previousValidNodeForTracking;if(!sf.base.isNullOrUndefined(prevElement)){var matchedRevisions=this.getMatchedRevisionsToCombine(prevElement.revisions,revisionType);if(matchedRevisions.length>0){this.mapMatchedRevisions(matchedRevisions,prevElement,currentElement,false);isCombined=true;}}}if(!sf.base.isNullOrUndefined(nextElement)){nextElement=nextElement.nextValidNodeForTracking;if(!sf.base.isNullOrUndefined(nextElement)){var matchedRevisions=this.getMatchedRevisionsToCombine(nextElement.revisions,revisionType);if(matchedRevisions.length>0){if(isCombined){this.combineElementRevision(currentElement.revisions,nextElement.revisions);}else{this.mapMatchedRevisions(matchedRevisions,nextElement,currentElement,true);}isCombined=true;}}}return isCombined;};/**
     * Remove the current selected content or one character right of cursor.
     *
     * @returns {void}
     */Editor.prototype["delete"]=function(){this.removeEditRange=true;var selection=this.documentHelper.selection;if(selection.isEmpty){this.singleDelete(selection,false);}else{// this.initComplexHistory('MultiSelection');
// for (let i: number = 0; i < selection.selectionRanges.length; i++) {
// let selectionRange: SelectionRange = selection.selectionRanges.getRange(i);
this.initHistory('Delete');this.deleteSelectedContentInternal(selection,false,selection.start,selection.end);var textPosition=new TextPosition(selection.owner);this.setPositionForCurrentIndex(textPosition,selection.editPosition);selection.selectContent(textPosition,true);// if (this.documentHelper.owner.enableEditorHistory) {
this.reLayout(selection);this.insertSpaceInFormField();// }
// this.updateSelectionRangeOffSet(selection.start, selection.end);
// }
// let textPosition: TextPosition = new TextPosition(selection.owner, this.documentHelper);
// this.setPositionForCurrentIndex(textPosition,selection.editPosition);
// selection.selectContent(textPosition, true);
// if (!isNullOrUndefined(selection.currentHistoryInfo)) {
//     this.updateComplexHistory();
// } else {
//     this.updateComplexWithoutHistory();
// }
}this.removeEditRange=false;this.updateXmlMappedContentControl();};Editor.prototype.deleteEditElement=function(selection){this.initHistory('Delete');this.deleteSelectedContentInternal(selection,false,selection.start,selection.end);var textPosition=new TextPosition(selection.owner);this.setPositionForCurrentIndex(textPosition,selection.editPosition);selection.selectContent(textPosition,true);this.reLayout(selection);};Editor.prototype.removeContentControlMark=function(start,end){if(!start.contentControlProperties.lockContentControl){this.selection.start.setPositionParagraph(start.line,start.line.getOffset(start,0));this.selection.end.setPositionParagraph(end.line,end.line.getOffset(end,0)+1);this.deleteEditElement(this.selection);return true;}return false;};/**
     * Remove single character on right of cursor position
     *
     * @param {Selection} selection - Specifies the selection
     * @param {boolean} isRedoing - Specified the is redoing.
     * @private
     * @returns {void}
     */ /* eslint-disable  */Editor.prototype.singleDelete=function(selection,isRedoing){var lineWidget=selection.start.currentWidget;var paragraph=selection.start.paragraph;var offset=selection.start.offset;var indexInInline=0;var inlineObj=lineWidget.getInline(selection.start.offset,indexInInline);var inline=inlineObj.element;if(this.selection.isInlineFormFillMode()){if(inline instanceof FieldElementBox&&inline.fieldType===1){return;}var resultText=this.getFormFieldText();if(!(inline instanceof TextElementBox)){inline=inline.nextElement;}if(resultText.length===1&&inline instanceof TextElementBox){this.selection.selectFieldInternal(this.selection.getCurrentFormField());this.insertTextInternal(this.documentHelper.textHelper.repeatChar(this.documentHelper.textHelper.getEnSpaceCharacter(),5),true);this.selection.selectTextElementStartOfField(this.selection.getCurrentFormField());return;}else{if(inline instanceof FieldElementBox&&inline.fieldType===1){return;}}}indexInInline=inlineObj.index;if(paragraph.paragraphFormat.listFormat&&paragraph.paragraphFormat.listFormat.listId!==-1&&this.documentHelper.isListTextSelected&&selection.contextType==='List'){this.onApplyList(undefined);return;}if(!sf.base.isNullOrUndefined(inline)&&indexInInline===inline.length&&!sf.base.isNullOrUndefined(inline.nextNode)){inline=inline.nextNode;if(inline instanceof FieldElementBox&&inline.fieldType===1&&!sf.base.isNullOrUndefined(inline.fieldBegin.formFieldData)){return;}indexInInline=0;}if(!sf.base.isNullOrUndefined(inline)&&indexInInline===inline.length&&!sf.base.isNullOrUndefined(inline.nextNode)){inline=inline.nextNode;if(inline instanceof FootnoteElementBox){return;}indexInInline=0;}if(inline instanceof FootnoteElementBox){if(inline.footnoteType==='Footnote'){this.removeFootnote(inline);}else{this.removeEndnote(inline);}}if(!sf.base.isNullOrUndefined(inline)){var nextRenderedInline=undefined;var nextInline=selection.getNextValidElement(inline);if(nextInline instanceof ElementBox){nextRenderedInline=nextInline;}if(!sf.base.isNullOrUndefined(nextRenderedInline)&&nextRenderedInline instanceof FieldElementBox&&nextRenderedInline.fieldType===0){//Selects the entire field.
inline=nextRenderedInline.fieldEnd;paragraph=inline.line.paragraph;offset=inline.line.getOffset(inline,1);selection.end.setPositionParagraph(inline.line,offset);selection.fireSelectionChanged(true);return;}else if(inline!==nextRenderedInline){//Updates the offset to delete next content.               
inline=nextRenderedInline;paragraph=inline.line.paragraph;offset=inline.line.getOffset(inline,0);if(inline instanceof FieldElementBox&&inline.fieldType===1){offset++;}}}if(inline instanceof EditRangeStartElementBox||inline instanceof EditRangeEndElementBox){if(inline.nextNode instanceof EditRangeEndElementBox&&inline.editRangeEnd===inline.nextNode||inline.previousNode instanceof EditRangeStartElementBox&&inline.editRangeStart===inline.previousNode){return;}if(this.documentHelper.isDocumentProtected&&this.documentHelper.protectionType==='ReadOnly'){if(inline instanceof EditRangeStartElementBox||inline instanceof EditRangeEndElementBox){return;}}else{if(inline instanceof EditRangeStartElementBox){inline=inline.nextNode;offset=inline.line.getOffset(inline,0);paragraph=inline.line.paragraph;}else if(inline instanceof EditRangeEndElementBox){offset++;}}if(inline.length===1&&inline.nextNode instanceof EditRangeEndElementBox&&inline.previousNode instanceof EditRangeStartElementBox){var editStart=inline.previousNode;var editEnd=inline.nextNode;selection.start.setPositionParagraph(editStart.line,editStart.line.getOffset(editStart,0));selection.end.setPositionParagraph(editEnd.line,editEnd.line.getOffset(editEnd,0)+1);this.deleteEditElement(selection);return;}}if(inline&&(inline instanceof ContentControl||inline.nextNode instanceof ContentControl)){if(inline instanceof ContentControl&&inline.nextNode){inline=inline.nextNode;paragraph=inline.line.paragraph;offset=inline.line.getOffset(inline,0);// Move cursor inbetween content control
selection.start.setPositionParagraph(inline.line,offset);selection.end.setPositionParagraph(inline.line,offset);return;}if(inline&&inline.length===1&&inline.nextNode instanceof ContentControl&&inline.previousNode instanceof ContentControl){if(this.removeContentControlMark(inline.previousNode,inline.nextNode)){return;}}// Remove content if content control is empty
if(inline instanceof ContentControl&&inline.previousNode instanceof ContentControl&&inline.previousNode.reference===inline){// Remove content control if there is no element presen in between start and end mark.
if(this.removeContentControlMark(inline.previousNode,inline)){return;}}}if(inline&&(inline instanceof BookmarkElementBox&&inline.bookmarkType===0||inline.nextNode instanceof BookmarkElementBox)){if(inline.nextNode&&inline instanceof BookmarkElementBox){inline=inline.nextNode;paragraph=inline.line.paragraph;offset=inline.line.getOffset(inline,0);}if(inline.length===1&&inline.nextNode instanceof BookmarkElementBox&&inline.previousNode instanceof BookmarkElementBox){var bookMarkBegin=inline.previousNode;var bookMarkEnd=inline.nextNode;selection.start.setPositionParagraph(bookMarkBegin.line,bookMarkBegin.line.getOffset(bookMarkBegin,0));selection.end.setPositionParagraph(bookMarkEnd.line,bookMarkEnd.line.getOffset(bookMarkEnd,0)+1);this.deleteEditElement(selection);return;}if(inline instanceof BookmarkElementBox){offset=inline.line.getOffset(inline,1);}}if(selection.start.currentWidget.isLastLine()&&offset===this.documentHelper.selection.getLineLength(selection.start.currentWidget)){if(paragraph.isInsideTable&&sf.base.isNullOrUndefined(paragraph.nextWidget)){return;}var previousParagraph=undefined;var newParagraph=undefined;var nextParagraph=selection.getNextParagraphBlock(paragraph);if(sf.base.isNullOrUndefined(nextParagraph)){if(offset>0){return;}else{if(paragraph.previousWidget instanceof ParagraphWidget){previousParagraph=paragraph.previousWidget;}if(paragraph.previousWidget instanceof FootNoteWidget){return;}if(paragraph.previousWidget instanceof TableWidget){return;}if(sf.base.isNullOrUndefined(previousParagraph)){return;//Adds an empty paragraph, to ensure minimal content.
}}}if(!isRedoing){this.initHistory('Delete');}if(paragraph.isEndsWithPageBreak){var lastLine=paragraph.lastChild;var lastChild=lastLine.children[lastLine.children.length-1];this.selection.start.setPositionForSelection(lastLine,lastChild,0,this.selection.start.location);}var blockInfo=this.selection.getParagraphInfo(selection.start);selection.editPosition=this.selection.getHierarchicalIndex(blockInfo.paragraph,blockInfo.offset.toString());if(this.checkInsertPosition(selection)){this.setPositionForHistory(selection.editPosition);}selection.owner.isShiftingEnabled=true;if(paragraph.isEmpty()){this.removeBlock(paragraph);this.addRemovedNodes(paragraph);if(sf.base.isNullOrUndefined(nextParagraph)){if(sf.base.isNullOrUndefined(previousParagraph)){// selection.selectParagraphInternal(newParagraph, true, true);
var paraEndOffset=selection.getParagraphLength(newParagraph)+1;if(this.editorHistory&&!sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo)){this.updateHistoryPosition(selection.start,true);this.editorHistory.currentBaseHistoryInfo.endPosition=this.selection.getHierarchicalIndex(newParagraph,paraEndOffset.toString());}}else{selection.selectParagraphInternal(previousParagraph,false);this.setPositionForHistory();}}else{selection.selectParagraphInternal(nextParagraph,true);}}else{paragraph=paragraph.combineWidget(this.owner.viewer);var currentParagraph=this.splitParagraph(paragraph,paragraph.firstChild,0,selection.start.currentWidget,selection.start.offset,true);this.deleteParagraphMark(currentParagraph,selection,0);this.addRemovedNodes(paragraph);this.setPositionForCurrentIndex(selection.start,selection.editPosition);selection.selectContent(selection.start,true);}// if (!isRedoing) {
this.reLayout(selection);// }
}else{this.singleDeleteInternal(selection,isRedoing,paragraph);}};Editor.prototype.singleDeleteInternal=function(selection,isRedoing,paragraph){if(!isRedoing){selection.owner.isShiftingEnabled=true;this.initHistory('Delete');}if(this.checkInsertPosition(selection)){this.updateHistoryPosition(selection.start,true);this.editorHistory.currentBaseHistoryInfo.endPosition=this.editorHistory.currentBaseHistoryInfo.insertPosition;}var paragraphInfo=this.selection.getParagraphInfo(selection.start);var lineWidget=selection.start.currentWidget;var removeOffset=selection.start.offset;var lineLength=selection.getLineLength(selection.start.currentWidget);if(removeOffset>=lineLength){lineWidget=lineWidget.nextLine;removeOffset=removeOffset-lineLength;}this.removeAtOffset(lineWidget,selection,removeOffset);if(this.owner.enableTrackChanges&&!this.skipTracking()){this.setPositionParagraph(paragraphInfo.paragraph,paragraphInfo.offset+1,false);}else{this.setPositionParagraph(paragraphInfo.paragraph,paragraphInfo.offset,false);}if(!isRedoing){this.reLayout(selection);}else{this.fireContentChange();}};Editor.prototype.deleteParagraphMark=function(paragraph,selection,editAction,handleParaMark){if(sf.base.isNullOrUndefined(paragraph.containerWidget)){return;}paragraph=paragraph.combineWidget(this.owner.viewer);var nextParagraph=selection.getNextParagraphBlock(paragraph);if(paragraph.isInsideTable&&sf.base.isNullOrUndefined(paragraph.nextWidget)||sf.base.isNullOrUndefined(nextParagraph)){return;}//BodyWidget
var section=paragraph.containerWidget instanceof BodyWidget?paragraph.containerWidget:undefined;var table=undefined;if(selection.getNextRenderedBlock(paragraph)instanceof TableWidget){table=selection.getNextRenderedBlock(paragraph);}else{table=undefined;}if(nextParagraph.isInsideTable&&!sf.base.isNullOrUndefined(table)&&table.contains(nextParagraph.associatedCell)){if(editAction<4){// let nextSection: BodyWidget = table.containerWidget instanceof BodyWidget ? table.containerWidget : undefined;
// if (section !== nextSection) {
//     this.combineSection(section, selection, nextSection);
// }                
var offset=0;this.removeBlock(paragraph);this.documentHelper.layout.clearListElementBox(nextParagraph);this.documentHelper.layout.clearListElementBox(paragraph);for(var i=paragraph.childWidgets.length-1;i>=0;i--){var line=paragraph.childWidgets[i];for(var j=line.children.length-1;j>=0;j--){var element=line.children[j];offset+=element.length;nextParagraph.firstChild.children.unshift(element);element.line=nextParagraph.firstChild;// this.layoutInlineCollection(false, 0, nextParagraph.inlines, inline);
}}this.documentHelper.layout.reLayoutParagraph(nextParagraph,0,0);if(offset>0){selection.editPosition=this.selection.getHierarchicalIndex(nextParagraph,offset.toString());}}}else{if(editAction<4){// let nextSection: WSection = nextParagraph.section instanceof WSection ? nextParagraph.section as WSection : undefined;
// if (section !== nextSection) {
//     this.combineSection(section, selection, nextSection);
// }
var prevLength=paragraph.childWidgets.length-1;var nextPara=nextParagraph.getSplitWidgets();nextParagraph=nextParagraph.combineWidget(this.owner.viewer);this.documentHelper.layout.clearListElementBox(nextParagraph);this.documentHelper.layout.clearListElementBox(paragraph);this.updateEditPositionOnMerge(paragraph,nextParagraph);var canRemoveParaMark=!sf.base.isNullOrUndefined(handleParaMark)&&handleParaMark?this.handleDeleteParaMark(paragraph,nextPara[0]):true;if(canRemoveParaMark){var prevLastLineIndex=paragraph.childWidgets.length-1;var elementIndex=paragraph.childWidgets[prevLastLineIndex].children.length-1;for(var i=0;i<nextParagraph.childWidgets.length;i++){var inline=nextParagraph.childWidgets[i];if(nextParagraph.characterFormat.revisions.length>0){for(var i_2=0;i_2<nextParagraph.characterFormat.revisions.length;i_2++){for(var j=0;j<nextParagraph.characterFormat.revisions[i_2].range.length;j++){nextParagraph.characterFormat.revisions[i_2].range[j].ownerBase=paragraph;}paragraph.characterFormat.revisions.push(nextParagraph.characterFormat.revisions[i_2]);}}nextParagraph.childWidgets.splice(i,1);paragraph.childWidgets.push(inline);inline.paragraph=paragraph;i--;}if(nextParagraph.childWidgets.length===0){nextParagraph.childWidgets.push(new LineWidget(nextParagraph));}this.removeBlock(nextParagraph);this.documentHelper.layout.reLayoutParagraph(paragraph,0,0);//this.combineRevisionOnDeleteParaMark(paragraph, prevLastLineIndex, elementIndex);
this.addRemovedNodes(nextParagraph);}}}};Editor.prototype.handleDeleteParaMark=function(currentPara,nextPara){if(!this.owner.enableTrackChanges&&currentPara.characterFormat.revisions.length>0){// If tracking disabled and revision exists then remove revision from character format
for(var i=0;i<currentPara.characterFormat.revisions.length;i++){var currentRevision=currentPara.characterFormat.revisions[i];var rangeIndex=currentRevision.range.indexOf(currentPara.characterFormat);currentRevision.range.splice(rangeIndex,1);if(currentRevision.range.length===0){this.owner.revisions.remove(currentRevision);}return true;}}if(this.owner.enableTrackChanges){var canRemoveParaMark=false;if(currentPara.characterFormat.revisions.length>0){var deleteRevision=this.retrieveRevisionByType(currentPara.characterFormat,'Deletion');if(!sf.base.isNullOrUndefined(deleteRevision)&&this.isRevisionMatched(deleteRevision,'Deletion')){var revisionIndex=currentPara.characterFormat.revisions.indexOf(deleteRevision);currentPara.characterFormat.revisions.splice(revisionIndex,1);deleteRevision.range.splice(deleteRevision.range.indexOf(currentPara.characterFormat),1);if(deleteRevision.range.length===0){this.owner.revisions.remove(deleteRevision);}canRemoveParaMark=true;}var insertRevision=this.retrieveRevisionByType(currentPara.characterFormat,'Insertion');if(!sf.base.isNullOrUndefined(insertRevision)&&this.isRevisionMatched(currentPara.characterFormat,'Insertion')){var rangeIndex=insertRevision.range.indexOf(currentPara.characterFormat);insertRevision.range.splice(rangeIndex,1);if(insertRevision.range.length===0){this.owner.revisions.remove(insertRevision);}canRemoveParaMark=true;}if(canRemoveParaMark){return true;}else{this.applyRevisionForParaMark(currentPara,nextPara.firstChild,'Deletion',false);}return false;}else{this.applyRevisionForParaMark(currentPara,nextPara.firstChild,'Deletion',false);return false;}}return true;};Editor.prototype.insertDeleteParaMarkRevision=function(currentPara,nextPara){var lastLine=currentPara.lastChild;var lastElement=lastLine.children.length>0?lastLine.children[lastLine.children.length-1].previousValidNodeForTracking:undefined;if(!sf.base.isNullOrUndefined(lastElement)){var matchedRevisions=this.getMatchedRevisionsToCombine(lastElement.revisions,'Deletion');if(matchedRevisions.length>0){this.mapMatchedRevisions(matchedRevisions,lastElement,currentPara.characterFormat,false);}}var firstLine=nextPara.firstChild;var firstElement=firstLine.children[0].nextValidNodeForTracking;};Editor.prototype.retrieveRevisionByType=function(item,revisionToRetrieve){for(var i=0;i<item.revisions.length;i++){if(item.revisions[i].revisionType===revisionToRetrieve){return item.revisions[i];}}return undefined;};Editor.prototype.combineRevisionOnDeleteParaMark=function(paragraph,lineIndex,elementIndex){var lastLine=paragraph.childWidgets[lineIndex];var lastElement=lastLine.children[elementIndex];var firstElement=lastElement.nextNode;firstElement=firstElement.nextValidNodeForTracking;lastElement=lastElement.nextValidNodeForTracking;if(firstElement.revisions.length>0&&lastElement.revisions.length>0){this.combineElementRevisions(lastElement,firstElement);}};Editor.prototype.updateEditPositionOnMerge=function(currentParagraph,nextParagraph){if(this.documentHelper.selection.editPosition===this.selection.getHierarchicalIndex(nextParagraph,'0')&&nextParagraph.nextRenderedWidget===undefined){this.documentHelper.selection.editPosition=this.selection.getHierarchicalIndex(currentParagraph,this.documentHelper.selection.getLineLength(currentParagraph.lastChild).toString());}};Editor.prototype.checkEndPosition=function(selection){return this.editorHistory&&!sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo)&&sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo.endPosition);};Editor.prototype.checkInsertPosition=function(selection){return this.editorHistory&&!sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo)&&sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo.insertPosition);};Editor.prototype.checkIsNotRedoing=function(){return this.documentHelper.owner.enableHistoryMode&&!this.editorHistory.isRedoing;};/* eslint-disable */ /**
     * deleteSelectedContentInternal
     * @private
     */Editor.prototype.deleteSelectedContentInternal=function(selection,isBackSpace,startPosition,endPosition){/* eslint-enable */var startPos=startPosition;var endPos=endPosition;if(!startPosition.isExistBefore(endPosition)){startPos=endPosition;endPos=startPosition;}var blockInfo=this.selection.getParagraphInfo(startPos);selection.editPosition=this.selection.getHierarchicalIndex(blockInfo.paragraph,blockInfo.offset.toString());var skipBackSpace=false;if(isBackSpace&&startPos.isInSameParagraph(endPos)){//Handled specifically to skip removal of contents, if selection is only paragraph mark and next rendered block is table.
if(startPos.offset<endPos.offset&&startPos.offset===selection.getParagraphLength(endPos.paragraph)){var nextBlock=selection.getNextRenderedBlock(startPos.paragraph);skipBackSpace=nextBlock instanceof TableWidget;}//Handled specifically to remove paragraph completely (Delete behavior), if the selected paragraph is empty.
if(endPos.offset===1&&endPos.offset>selection.getParagraphLength(endPos.paragraph)&&!(endPos.paragraph.isInsideTable&&sf.base.isNullOrUndefined(endPos.paragraph.nextWidget))){isBackSpace=false;}}if(!skipBackSpace){selection.owner.isShiftingEnabled=true;if(this.checkInsertPosition(selection)){this.editorHistory.currentBaseHistoryInfo.insertPosition=selection.editPosition;}var editAction=isBackSpace?1:0;this.deleteSelectedContent(endPos.paragraph,selection,startPos,endPos,editAction);}return skipBackSpace;};/**
     * Init EditorHistory
     *
     * @private
     * @param {Action} action Specified the action.
     * @returns {void}
     */Editor.prototype.initHistory=function(action){if(this.documentHelper.owner.enableHistoryMode){this.editorHistory.initializeHistory(action);}};/**
     * Init Complex EditorHistory
     *
     * @private
     * @param {Action} action Specified the action.
     * @returns {void}
     */Editor.prototype.initComplexHistory=function(action){if(this.documentHelper.owner.enableHistoryMode){this.editorHistory.initComplexHistory(this.documentHelper.selection,action);}};//Insert Picture implementation starts
/**
     * Insert image
     *
     * @private
     * @param {string} imageString  Base64 string, web URL or file URL.
     * @param {number} width Image width
     * @param {number} height Image height
     * @returns {void}
     */Editor.prototype.insertPicture=function(base64String,width,height){var imageElementBox=new ImageElementBox(true);imageElementBox.imageString=base64String;imageElementBox.width=width;imageElementBox.height=height;imageElementBox.textWrappingStyle='Inline';this.insertPictureInternal(imageElementBox);};Editor.prototype.insertPictureInternal=function(imageElementBox){var selection=this.documentHelper.selection;this.initHistory('InsertInline');this.fitImageToPage(selection,imageElementBox);this.insertInlineInSelection(selection,imageElementBox);this.reLayout(selection);};Editor.prototype.fitImageToPage=function(selection,imageElementBox){var section=selection.start.paragraph.bodyWidget;var pageWidth=section.sectionFormat.pageWidth-section.sectionFormat.leftMargin-section.sectionFormat.rightMargin;var pageHeight=section.sectionFormat.pageHeight-section.sectionFormat.topMargin-section.sectionFormat.topMargin;//Resizes image to page size.
if(imageElementBox.width>pageWidth){imageElementBox.height=imageElementBox.height*pageWidth/imageElementBox.width;imageElementBox.width=pageWidth;}if(imageElementBox.height>pageHeight){imageElementBox.width=imageElementBox.width*pageHeight/imageElementBox.height;imageElementBox.height=pageHeight;}};//Insert Picture implementation ends
/**
     * @private
     */Editor.prototype.insertInlineInSelection=function(selection,elementBox){if(this.checkIsNotRedoing()){selection.owner.isShiftingEnabled=true;}if(!selection.isEmpty){this.removeSelectedContents(selection);}this.updateInsertPosition();this.insertInlineInternal(elementBox);this.addOrRemoveCommentsInline(elementBox,true);if(this.checkEndPosition(selection)){this.updateHistoryPosition(selection.start,false);}this.fireContentChange();};/**
     * @private
     * @returns {void}
     */Editor.prototype.onPortrait=function(){var sectionFormat=new WSectionFormat();var width=this.documentHelper.selection.sectionFormat.pageWidth;var height=this.documentHelper.selection.sectionFormat.pageHeight;if(width>height){sectionFormat.pageWidth=height;sectionFormat.pageHeight=width;}this.onApplySectionFormat(undefined,sectionFormat);};/**
     * @private
     * @returns {void}
     */Editor.prototype.onLandscape=function(){var sectionFormat=new WSectionFormat();var width=this.documentHelper.selection.sectionFormat.pageWidth;var height=this.documentHelper.selection.sectionFormat.pageHeight;if(width<height){sectionFormat.pageWidth=height;sectionFormat.pageHeight=width;}this.onApplySectionFormat(undefined,sectionFormat);};Editor.prototype.copyValues=function(){var format=new WSectionFormat();format.bottomMargin=this.documentHelper.selection.sectionFormat.bottomMargin;format.topMargin=this.documentHelper.selection.sectionFormat.topMargin;format.leftMargin=this.documentHelper.selection.sectionFormat.leftMargin;format.rightMargin=this.documentHelper.selection.sectionFormat.rightMargin;format.pageHeight=this.documentHelper.selection.sectionFormat.pageHeight;format.pageWidth=this.documentHelper.selection.sectionFormat.pageWidth;format.footerDistance=this.documentHelper.selection.sectionFormat.footerDistance;format.headerDistance=this.documentHelper.selection.sectionFormat.headerDistance;return format;};/**
     * @private
     * @returns {void}
     */Editor.prototype.changeMarginValue=function(property){var sectionFormat=this.copyValues();if(property==='lastCustomSetting'||property==='normal'){sectionFormat.topMargin=72;sectionFormat.bottomMargin=72;sectionFormat.leftMargin=72;sectionFormat.rightMargin=72;}else if(property==='narrow'){sectionFormat.topMargin=36;sectionFormat.bottomMargin=36;sectionFormat.leftMargin=36;sectionFormat.rightMargin=36;}else if(property==='moderate'){sectionFormat.topMargin=72;sectionFormat.bottomMargin=72;sectionFormat.leftMargin=54;sectionFormat.rightMargin=54;}else if(property==='wide'){sectionFormat.topMargin=72;sectionFormat.bottomMargin=72;sectionFormat.leftMargin=144;sectionFormat.rightMargin=144;}else if(property==='mirrored'){sectionFormat.topMargin=72;sectionFormat.bottomMargin=72;sectionFormat.leftMargin=90;sectionFormat.rightMargin=72;}else if(property==='office2003Default'){sectionFormat.topMargin=72;sectionFormat.bottomMargin=72;sectionFormat.leftMargin=90;sectionFormat.rightMargin=90;}this.onApplySectionFormat(undefined,sectionFormat);};/**
     * @private
     * @returns {void}
     */Editor.prototype.onPaperSize=function(property){var sectionFormat=this.copyValues();var width=this.documentHelper.selection.sectionFormat.pageWidth;var height=this.documentHelper.selection.sectionFormat.pageHeight;if(property==='letter'){if(width<height){sectionFormat.pageWidth=611.9;sectionFormat.pageHeight=791.9;}else{sectionFormat.pageWidth=791.9;sectionFormat.pageHeight=611.9;}}else if(property==='tabloid'){if(width<height){sectionFormat.pageWidth=791.9;sectionFormat.pageHeight=1223.9;}else{sectionFormat.pageWidth=1223.9;sectionFormat.pageHeight=791.9;}}else if(property==='legal'){if(width<height){sectionFormat.pageWidth=611.9;sectionFormat.pageHeight=1007.9;}else{sectionFormat.pageWidth=1007.9;sectionFormat.pageHeight=611.9;}}else if(property==='statement'){if(width<height){sectionFormat.pageWidth=396;sectionFormat.pageHeight=611.9;}else{sectionFormat.pageWidth=611.9;sectionFormat.pageHeight=396;}}else if(property==='executive'){if(width<height){sectionFormat.pageWidth=521.9;sectionFormat.pageHeight=755.9;}else{sectionFormat.pageWidth=755.9;sectionFormat.pageHeight=521.9;}}else if(property==='a3'){if(width<height){sectionFormat.pageWidth=841.8;sectionFormat.pageHeight=1190.4;}else{sectionFormat.pageWidth=1190.4;sectionFormat.pageHeight=841.8;}}else if(property==='a4'){if(width<height){sectionFormat.pageWidth=595.2;sectionFormat.pageHeight=841.8;}else{sectionFormat.pageWidth=841.8;sectionFormat.pageHeight=595.2;}}else if(property==='a5'){if(width<height){sectionFormat.pageWidth=419.5;sectionFormat.pageHeight=595.2;}else{sectionFormat.pageWidth=595.2;sectionFormat.pageHeight=419.5;}}else if(property==='b4'){if(width<height){sectionFormat.pageWidth=728.4;sectionFormat.pageHeight=1031.7;}else{sectionFormat.pageWidth=1031.7;sectionFormat.pageHeight=728.4;}}else if(property==='b5'){if(width<height){sectionFormat.pageWidth=515.8;sectionFormat.pageHeight=728.4;}else{sectionFormat.pageWidth=728.4;sectionFormat.pageHeight=515.8;}}this.onApplySectionFormat(undefined,sectionFormat);};//Update List Items
/**
     * @private
     * @returns {void}
     */Editor.prototype.updateListItemsTillEnd=function(blockAdv,updateNextBlockList){var block=updateNextBlockList?this.documentHelper.selection.getNextRenderedBlock(blockAdv):blockAdv;while(!sf.base.isNullOrUndefined(block)&&!this.documentHelper.isTextInput){//Updates the list value of the rendered paragraph. 
this.updateRenderedListItems(block);block=block.getSplitWidgets().pop().nextRenderedWidget;}};/**
     * @private
     * @returns {void}
     */Editor.prototype.updateWholeListItems=function(block){this.documentHelper.renderedLists.clear();this.documentHelper.renderedLevelOverrides=[];var sectionIndex=block.bodyWidget.index;var currentBlock;for(var j=0;j<this.documentHelper.pages.length;j++){var page=this.documentHelper.pages[j];if(page.bodyWidgets[0].index===sectionIndex){currentBlock=this.getNextBlockForList(page.bodyWidgets[0].firstChild);if(!sf.base.isNullOrUndefined(currentBlock)){break;}}}var isListUpdated=false;do{isListUpdated=this.updateListItems(currentBlock,block);if(isListUpdated){break;}currentBlock=currentBlock.getSplitWidgets().pop().nextRenderedWidget;if(!sf.base.isNullOrUndefined(currentBlock)){currentBlock=this.getNextBlockForList(currentBlock);}}while(currentBlock);};Editor.prototype.getNextBlockForList=function(currentBlock){if(currentBlock instanceof ParagraphWidget&&this.documentHelper.layout.isFirstElementWithPageBreak(currentBlock)){var nextBlock=currentBlock.nextRenderedWidget;if(nextBlock.equals(currentBlock)){return nextBlock;}}return currentBlock;};Editor.prototype.updateListItems=function(blockAdv,block){var isListUpdated=false;if(blockAdv instanceof ParagraphWidget){isListUpdated=this.updateListItemsForPara(blockAdv,block);}else{isListUpdated=this.updateListItemsForTable(blockAdv,block);}return isListUpdated;};Editor.prototype.updateListItemsForTable=function(table,block){if(block instanceof TableWidget&&table.equals(block)){return true;}var row=table.firstChild;do{var isListUpdated=this.updateListItemsForRow(row,block);if(isListUpdated){return true;}row=row.getSplitWidgets().pop().nextRenderedWidget;}while(row);return false;};Editor.prototype.updateListItemsForRow=function(row,block){if(block.isInsideTable&&row.childWidgets.indexOf(this.documentHelper.selection.getContainerCell(block.associatedCell))!==-1){//Returns as list updated, inorder to start list numbering from first list paragraph of this row.
return true;}var cell=row.firstChild;do{this.updateListItemsForCell(cell,block);cell=cell.nextRenderedWidget;}while(cell);return false;};Editor.prototype.updateListItemsForCell=function(cell,block){if(cell.childWidgets.length===0){return;}var currentBlock=cell.firstChild;do{this.updateListItems(currentBlock,block);currentBlock=currentBlock.getSplitWidgets().pop().nextRenderedWidget;}while(currentBlock);};// public abstract updateListParagraphs(): void;
/**
     * @private
     * @returns {void}
     */Editor.prototype.updateRenderedListItems=function(block){if(block instanceof ParagraphWidget){this.updateRenderedListItemsForPara(block);}else{this.updateRenderedListItemsForTable(block);}};Editor.prototype.updateRenderedListItemsForTable=function(table){var row=table.firstChild;do{this.updateRenderedListItemsForRow(row);row=row.getSplitWidgets().pop().nextRenderedWidget;}while(row);};Editor.prototype.updateRenderedListItemsForRow=function(row){var cell=row.firstChild;do{this.updateRenderedListItemsForCell(cell);cell=cell.nextRenderedWidget;}while(cell);};Editor.prototype.updateRenderedListItemsForCell=function(cell){if(cell.childWidgets.length===0){return;}var currentBlock=cell.firstChild;do{this.updateRenderedListItems(currentBlock);currentBlock=currentBlock.getSplitWidgets().pop().nextRenderedWidget;}while(currentBlock);};Editor.prototype.updateListItemsForPara=function(paragraph,block){if(paragraph.equals(block)){return true;}else{var currentList=undefined;var levelNumber=0;if(!sf.base.isNullOrUndefined(paragraph.paragraphFormat)&&!sf.base.isNullOrUndefined(paragraph.paragraphFormat.listFormat)){currentList=this.documentHelper.getListById(paragraph.paragraphFormat.listFormat.listId);levelNumber=paragraph.paragraphFormat.listFormat.listLevelNumber;}if(!sf.base.isNullOrUndefined(currentList)&&!sf.base.isNullOrUndefined(this.documentHelper.getAbstractListById(currentList.abstractListId))&&!sf.base.isNullOrUndefined(this.documentHelper.getAbstractListById(currentList.abstractListId).levels[levelNumber])){var currentListLevel=this.documentHelper.layout.getListLevel(currentList,levelNumber);//Updates the list numbering from document start for reLayouting.
this.updateListNumber(currentListLevel,paragraph,false);}}return false;};Editor.prototype.updateRenderedListItemsForPara=function(paragraph){if(!sf.base.isNullOrUndefined(this.documentHelper.getListById(paragraph.paragraphFormat.listFormat.listId))){var currentList=this.documentHelper.getListById(paragraph.paragraphFormat.listFormat.listId);var listLevelNumber=paragraph.paragraphFormat.listFormat.listLevelNumber;if(!sf.base.isNullOrUndefined(currentList)&&!sf.base.isNullOrUndefined(this.documentHelper.getAbstractListById(currentList.abstractListId))&&!sf.base.isNullOrUndefined(this.documentHelper.getAbstractListById(currentList.abstractListId).levels[paragraph.paragraphFormat.listFormat.listLevelNumber])){var currentListLevel=this.documentHelper.layout.getListLevel(currentList,listLevelNumber);//Updates the list numbering from document start for reLayouting.
this.updateListNumber(currentListLevel,paragraph,true);}}};Editor.prototype.updateListNumber=function(currentListLevel,paragraph,isUpdate){if(currentListLevel.listLevelPattern!=='Bullet'){var element=undefined;if(paragraph.childWidgets.length>0){var lineWidget=paragraph.childWidgets[0];if(lineWidget.children.length>0){if(paragraph.paragraphFormat.bidi){element=lineWidget.children[lineWidget.children.length-1];}else{element=lineWidget.children[0];}}}if(!sf.base.isNullOrUndefined(element)&&element instanceof ListTextElementBox){var text=this.documentHelper.layout.getListNumber(paragraph.paragraphFormat.listFormat);if(isUpdate){var prevWidth=element.width;element.text=text;var currentWidth=this.documentHelper.textHelper.getTextSize(element,element.characterFormat);if(currentWidth>prevWidth){element.width=currentWidth;}}}}};/**
     * Get offset value to update in selection
     *
     * @private
     * @returns {void}
     */Editor.prototype.getOffsetValue=function(selection){if(this.startParagraph){var lineInfo=selection.getLineInfoBasedOnParagraph(this.startParagraph,this.startOffset);selection.start.setPositionFromLine(lineInfo.line,lineInfo.offset);}selection.start.updatePhysicalPosition(true);if(selection.isEmpty){selection.end.setPositionInternal(selection.start);}else{if(this.endParagraph){var lineInfo=selection.getLineInfoBasedOnParagraph(this.endParagraph,this.endOffset);selection.end.setPositionFromLine(lineInfo.line,lineInfo.offset);}selection.end.updatePhysicalPosition(true);}};Editor.prototype.setPositionParagraph=function(paragraph,offset,skipSelectionChange){var selection=this.documentHelper.selection;var lineInfo=selection.getLineInfoBasedOnParagraph(paragraph,offset);selection.start.setPositionFromLine(lineInfo.line,lineInfo.offset);selection.end.setPositionInternal(selection.start);if(!skipSelectionChange){selection.fireSelectionChanged(true);}};/**
     * @private
     * @returns {void}
     */Editor.prototype.setPositionForCurrentIndex=function(textPosition,editPosition){var blockInfo=this.selection.getParagraph({index:editPosition});var lineInfo=this.selection.getLineInfoBasedOnParagraph(blockInfo.paragraph,blockInfo.offset);textPosition.setPositionForLineWidget(lineInfo.line,lineInfo.offset);};/**
     * @returns {void}
     */Editor.prototype.insertPageNumber=function(numberFormat){if(sf.base.isNullOrUndefined(numberFormat)){numberFormat='';}else{numberFormat=' \\*'+numberFormat;}var fieldCode='PAGE '+numberFormat+' \\* MERGEFORMAT';this.createFields(fieldCode);};/**
     * @private
     * @returns {void}
     */Editor.prototype.insertPageCount=function(numberFormat){if(sf.base.isNullOrUndefined(numberFormat)){numberFormat='';}else{numberFormat=' \*'+numberFormat;}var fieldCode='NUMPAGES '+numberFormat+' \* MERGEFORMAT';this.createFields(fieldCode);};Editor.prototype.createFields=function(fieldCode){var paragraph=new ParagraphWidget();var line=new LineWidget(paragraph);var fieldBegin=new FieldElementBox(0);line.children.push(fieldBegin);var fieldtext=new FieldTextElementBox();fieldtext.fieldBegin=fieldBegin;fieldtext.text='1';var text=new TextElementBox();text.text=fieldCode;line.children.push(text);var fieldSeparator=new FieldElementBox(2);fieldSeparator.fieldBegin=fieldBegin;fieldBegin.fieldSeparator=fieldSeparator;line.children.push(fieldSeparator);line.children.push(fieldtext);var fieldEnd=new FieldElementBox(1);fieldEnd.fieldBegin=fieldBegin;fieldEnd.fieldSeparator=fieldSeparator;fieldSeparator.fieldEnd=fieldEnd;fieldBegin.fieldEnd=fieldEnd;line.children.push(fieldEnd);fieldBegin.line=line;paragraph.childWidgets.push(line);this.documentHelper.fields.push(fieldBegin);var bodyWidget=new BodyWidget();bodyWidget.sectionFormat=new WSectionFormat(bodyWidget);bodyWidget.childWidgets.push(paragraph);this.pasteContentsInternal([bodyWidget],false);};/**
     * Insert Bookmark at current selection range
     *
     * @param {string} name - Name of bookmark
     * @returns {void}
     */Editor.prototype.insertBookmark=function(name){if(this.documentHelper.bookmarks.containsKey(name)){var existingBookmark=this.documentHelper.bookmarks.get(name);existingBookmark.line.children.splice(existingBookmark.line.children.indexOf(existingBookmark),1);// eslint-disable-next-line max-len
existingBookmark.reference.line.children.splice(existingBookmark.reference.line.children.indexOf(existingBookmark.reference),1);this.documentHelper.bookmarks.remove(name);}var bookmark=new BookmarkElementBox(0);bookmark.name=name;var bookmarkEnd=new BookmarkElementBox(1);bookmarkEnd.name=name;bookmark.reference=bookmarkEnd;bookmarkEnd.reference=bookmark;this.initComplexHistory('InsertBookmark');this.insertElements([bookmarkEnd],[bookmark]);if(this.editorHistory){this.editorHistory.updateComplexHistoryInternal();}if(this.documentHelper.owner.enableHeaderAndFooter){this.updateHeaderFooterWidget();}this.documentHelper.bookmarks.add(name,bookmark);this.selection.start.setPositionForSelection(bookmark.line,bookmark,1,this.selection.start.location);this.selection.end.setPositionForSelection(bookmarkEnd.line,bookmarkEnd,0,this.selection.end.location);this.selection.fireSelectionChanged(true);this.fireContentChange();};/**
     * Deletes specific bookmark
     *
     * @param {string} name - Name of bookmark
     * @returns {void}
     */Editor.prototype.deleteBookmark=function(bookmarkName){var bookmarks=this.documentHelper.bookmarks;var bookmark=bookmarks.get(bookmarkName);if(bookmark instanceof BookmarkElementBox){var bookmarkEnd=bookmark.reference;this.initHistory('DeleteBookmark');if(this.editorHistory){this.editorHistory.currentBaseHistoryInfo.setBookmarkInfo(bookmark);this.editorHistory.updateHistory();}this.deleteBookmarkInternal(bookmark);}this.fireContentChange();};/**
     * @private
     * @returns {void}
     */Editor.prototype.deleteBookmarkInternal=function(bookmark){var previousNode=bookmark.previousNode;if(previousNode instanceof FieldElementBox&&previousNode.fieldType===0&&!sf.base.isNullOrUndefined(previousNode.formFieldData)){previousNode.formFieldData.name='';}this.documentHelper.bookmarks.remove(bookmark.name);bookmark.line.children.splice(bookmark.indexInOwner,1);if(!sf.base.isNullOrUndefined(bookmark.reference)){bookmark.reference.line.children.splice(bookmark.reference.indexInOwner,1);}// Remove bookmark from header footer collections
var paragraph=bookmark.line.paragraph;if(bookmark.line.paragraph.isInHeaderFooter){var headerFooterWidget=undefined;if(paragraph.containerWidget instanceof TableCellWidget){headerFooterWidget=paragraph.containerWidget.getContainerTable().containerWidget;}else if(paragraph.containerWidget instanceof HeaderFooterWidget){headerFooterWidget=paragraph.containerWidget;}this.updateHeaderFooterWidget(headerFooterWidget);}};Editor.prototype.getSelectionInfo=function(){var start=this.selection.start;var end=this.selection.end;if(!this.selection.isForward){start=this.selection.end;end=this.selection.start;}if(!(end.offset===this.selection.getLineLength(end.currentWidget)+1&&this.selection.isParagraphLastLine(end.currentWidget))){end.offset+=1;}var blockInfo=this.selection.getParagraphInfo(start);var startIndex=this.selection.getHierarchicalIndex(blockInfo.paragraph,blockInfo.offset.toString());blockInfo=this.selection.getParagraphInfo(end);var endIndex=this.selection.getHierarchicalIndex(blockInfo.paragraph,blockInfo.offset.toString());return{'start':startIndex,'end':endIndex};};Editor.prototype.insertElements=function(endElements,startElements){var info=this.getSelectionInfo();if(!sf.base.isNullOrUndefined(startElements)){this.insertElementsInternal(this.selection.getTextPosBasedOnLogicalIndex(info.start),startElements);}if(!sf.base.isNullOrUndefined(endElements)){this.insertElementsInternal(this.selection.getTextPosBasedOnLogicalIndex(info.end),endElements);}};Editor.prototype.insertElementsInternal=function(position,elements,isRelayout){this.selection.selectPosition(position,position);this.initHistory('InsertElements');this.updateInsertPosition();var indexInInline=0;var paragraphInfo=this.selection.getParagraphInfo(this.selection.start);if(this.selection.start.paragraph.isEmpty()){var paragraph=this.selection.start.paragraph;paragraph.childWidgets[0].children.push(elements[0]);elements[0].line=paragraph.childWidgets[0];elements[0].linkFieldCharacter(this.documentHelper);this.documentHelper.layout.reLayoutParagraph(paragraph,0,0);this.setPositionParagraph(paragraphInfo.paragraph,paragraphInfo.offset+length,true);position.setPositionForSelection(elements[0].line,elements[0],elements[0].length,this.selection.start.location);this.selection.selectPosition(position,position);}else{var inlineObj=this.selection.start.currentWidget.getInline(this.documentHelper.selection.start.offset,indexInInline);var curInline=inlineObj.element;indexInInline=inlineObj.index;var firstElement=elements[0];this.insertElementInternal(curInline,firstElement,indexInInline,undefined,true);var index=firstElement.indexInOwner;var lastElement=firstElement;for(var i=1;i<elements.length;i++){lastElement=elements[i];firstElement.line.children.splice(index+i,0,lastElement);}position.setPositionForSelection(lastElement.line,lastElement,lastElement.length,this.selection.start.location);this.selection.selectPosition(position,position);}if(this.editorHistory){if(this.checkEndPosition()){this.updateHistoryPosition(this.selection.start,false);}this.editorHistory.updateHistory();}};/**
     * @private
     * @returns {CommentElementBox}
     */Editor.prototype.getCommentElementBox=function(index){var position=index.split(';');var comment=this.documentHelper.comments[parseInt(position[1],10)];if(position.length>2&&position[2]!==''){return comment.replyComments[parseInt(position[2],10)];}return comment;};/**
     * @private
     * @returns {BlockInfo}
     */Editor.prototype.getBlock=function(position){var bodyWidget=this.selection.getBodyWidget(position);return this.getBlockInternal(bodyWidget,position);};Editor.prototype.getBlockInternal=function(widget,position){if(position.index===''||sf.base.isNullOrUndefined(position)){return undefined;}var index=position.index.indexOf(';');var value=position.index.substring(0,index);position.index=position.index.substring(index).replace(';','');var node=widget;// if (node instanceof WSection && value === 'HF') {
//     //Gets the block in Header footers.
//     let blockObj: BlockInfo = this.getBlock((node as WSection).headerFooters, position);
//     return { 'node': (!isNullOrUndefined(blockObj)) ? blockObj.node : undefined, 'position': (!isNullOrUndefined(blockObj)) ? blockObj.position : undefined };
// }
index=parseInt(value,10);var childWidget=this.selection.getBlockByIndex(widget,index);if(childWidget){var child=childWidget;if(position.index.indexOf(';')>=0){if(child instanceof ParagraphWidget){if(position.index.indexOf(';')>=0){position.index='0';}return{'node':child,'position':position};}if(child instanceof Widget){var blockObj=this.getBlockInternal(child,position);return{'node':!sf.base.isNullOrUndefined(blockObj)?blockObj.node:undefined,'position':!sf.base.isNullOrUndefined(blockObj)?blockObj.position:undefined};}}else{return{'node':child,'position':position};}}else{return{'node':node,'position':position};}return{'node':node,'position':position};};/**
     * @private
     * @returns {void}
     */Editor.prototype.updateHistoryPosition=function(position,isInsertPosition){if(this.editorHistory&&!sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo)){var hierarchicalIndex=void 0;if(position instanceof TextPosition){var blockInfo=this.selection.getParagraphInfo(position);hierarchicalIndex=this.selection.getHierarchicalIndex(blockInfo.paragraph,blockInfo.offset.toString());}else{hierarchicalIndex=position;}if(isInsertPosition){this.editorHistory.currentBaseHistoryInfo.insertPosition=hierarchicalIndex;}else{this.editorHistory.currentBaseHistoryInfo.endPosition=hierarchicalIndex;}}};/**
     * Applies the borders based on given settings.
     *
     * @param {BorderSettings} settings
     * @returns {void}
     */Editor.prototype.applyBorders=function(settings){this.initHistory('Borders');var startPos=this.selection.isForward?this.selection.start:this.selection.end;var endPos=this.selection.isForward?this.selection.end:this.selection.start;var table=startPos.paragraph.associatedCell.ownerTable;table=table.combineWidget(this.owner.viewer);if(this.editorHistory){var clonedTable=this.cloneTableToHistoryInfo(table);}var startCell=startPos.paragraph.associatedCell;var endCell=endPos.paragraph.associatedCell;var cells;var border=this.getBorder(settings.borderColor,settings.lineWidth,settings.borderStyle);if(this.selection.isEmpty){//Apply borders for current selected cell initially.                    
if(settings.type==='OutsideBorders'||settings.type==='AllBorders'||settings.type==='LeftBorder'){endCell.cellFormat.borders.left.copyFormat(border);}if(settings.type==='OutsideBorders'||settings.type==='AllBorders'||settings.type==='TopBorder'){endCell.cellFormat.borders.top.copyFormat(border);}if(settings.type==='OutsideBorders'||settings.type==='AllBorders'||settings.type==='RightBorder'){endCell.cellFormat.borders.right.copyFormat(border);}if(settings.type==='OutsideBorders'||settings.type==='AllBorders'||settings.type==='BottomBorder'){endCell.cellFormat.borders.bottom.copyFormat(border);}if(settings.type==='AllBorders'||settings.type==='InsideBorders'||settings.type==='InsideVerticalBorder'){endCell.cellFormat.borders.vertical.copyFormat(border);}if(settings.type==='AllBorders'||settings.type==='InsideBorders'||settings.type==='InsideHorizontalBorder'){endCell.cellFormat.borders.horizontal.copyFormat(border);}if(settings.type==='NoBorder'){this.clearAllBorderValues(endCell.cellFormat.borders);}}else{if(settings.type==='OutsideBorders'||settings.type==='TopBorder'){var selectedCell=this.getTopBorderCellsOnSelection();for(var i=0;i<selectedCell.length;i++){selectedCell[i].cellFormat.borders.top.copyFormat(border);}}if(settings.type==='OutsideBorders'||settings.type==='LeftBorder'){var selectedCell=this.getLeftBorderCellsOnSelection();for(var i=0;i<selectedCell.length;i++){selectedCell[i].cellFormat.borders.left.copyFormat(border);}}if(settings.type==='OutsideBorders'||settings.type==='RightBorder'){var selectedCell=this.getRightBorderCellsOnSelection();for(var i=0;i<selectedCell.length;i++){selectedCell[i].cellFormat.borders.right.copyFormat(border);}}if(settings.type==='OutsideBorders'||settings.type==='BottomBorder'){var selectedCell=this.getBottomBorderCellsOnSelection();for(var i=0;i<selectedCell.length;i++){selectedCell[i].cellFormat.borders.bottom.copyFormat(border);}}}//Apply Only borders property to selected cells      
if(settings.type==='BottomBorder'||settings.type==='AllBorders'||settings.type==='OutsideBorders'||settings.type==='NoBorder'){cells=this.getAdjacentCellToApplyBottomBorder();for(var i=0;i<cells.length;i++){var cell=cells[i];if(settings.type==='NoBorder'){cell.cellFormat.borders.top.copyFormat(this.clearBorder());}else{cell.cellFormat.borders.top.copyFormat(border);}}}if(settings.type==='AllBorders'||settings.type==='OutsideBorders'||settings.type==='RightBorder'||settings.type==='NoBorder'){cells=this.getAdjacentCellToApplyRightBorder();for(var i=0;i<cells.length;i++){var cell=cells[i];if(settings.type==='NoBorder'){cell.cellFormat.borders.left.copyFormat(this.clearBorder());}else{cell.cellFormat.borders.left.copyFormat(border);}}}if(settings.type==='AllBorders'||settings.type==='NoBorder'){this.applyAllBorders(border,settings.type);}if(settings.type==='InsideBorders'||settings.type==='InsideVerticalBorder'||settings.type==='InsideHorizontalBorder'||settings.type==='NoBorder'){this.applyInsideBorders(border,settings.type,table);}this.updateGridForTableDialog(table,false);this.reLayout(this.selection,false);this.editorHistory.updateHistory();};Editor.prototype.applyAllBorders=function(border,borderType){var cells=this.selection.getSelectedCells();for(var i=0;i<cells.length;i++){if(borderType==='NoBorder'){cells[i].cellFormat.borders.left.copyFormat(this.clearBorder());cells[i].cellFormat.borders.right.copyFormat(this.clearBorder());cells[i].cellFormat.borders.top.copyFormat(this.clearBorder());cells[i].cellFormat.borders.bottom.copyFormat(this.clearBorder());}else{cells[i].cellFormat.borders.left.copyFormat(border);cells[i].cellFormat.borders.right.copyFormat(border);cells[i].cellFormat.borders.top.copyFormat(border);cells[i].cellFormat.borders.bottom.copyFormat(border);}}};Editor.prototype.applyInsideBorders=function(border,borderType,table){var cells=this.selection.getSelectedCells();for(var i=0;i<cells.length;i++){var cell=cells[i];var isLastSelectedRow=cell.ownerRow===cells[cells.length-1].ownerRow;var isLastRightCell=cell.columnIndex+cell.cellFormat.columnSpan-1===cells[cells.length-1].columnIndex;if(borderType==='NoBorder'){cell.cellFormat.borders.right.copyFormat(this.clearBorder());cell.cellFormat.borders.bottom.copyFormat(this.clearBorder());}else{if(!isLastRightCell&&borderType!=='InsideHorizontalBorder'){cell.cellFormat.borders.right.copyFormat(border);}if(!isLastSelectedRow&&borderType!=='InsideVerticalBorder'){cell.cellFormat.borders.bottom.copyFormat(border);}}if(!isLastSelectedRow&&borderType!=='InsideVerticalBorder'){// Apply adjacent bottom borders.
var nextRowIndex=cell.ownerRow.rowIndex+cell.cellFormat.rowSpan;var nextRow=table.childWidgets[nextRowIndex];if(nextRow){var selectedCells=this.getAdjacentBottomBorderOnEmptyCells(nextRow,cell,true);for(var j=0;j<selectedCells.length;j++){if(borderType==='NoBorder'){selectedCells[j].cellFormat.borders.top.copyFormat(this.clearBorder());}else{selectedCells[j].cellFormat.borders.top.copyFormat(border);}}}}if(!isLastRightCell&&borderType!=='InsideHorizontalBorder'){// Apply adjacent right borders.
var rightBorderCells=this.getSelectedCellsNextWidgets(cell,table);for(var k=0;k<rightBorderCells.length;k++){if(borderType==='NoBorder'){rightBorderCells[k].cellFormat.borders.left.copyFormat(this.clearBorder());}else{rightBorderCells[k].cellFormat.borders.left.copyFormat(border);}}}}};Editor.prototype.getTopBorderCellsOnSelection=function(){var startPos=this.selection.isForward?this.selection.start:this.selection.end;var startCell=startPos.paragraph.associatedCell;var topBorderCells=[];var cells=this.selection.getSelectedCells();for(var i=0;i<cells.length;i++){if(cells[i].ownerRow===startCell.ownerRow){topBorderCells.push(cells[i]);}}return topBorderCells;};Editor.prototype.getLeftBorderCellsOnSelection=function(){var startPos=this.selection.isForward?this.selection.start:this.selection.end;var startCell=startPos.paragraph.associatedCell;var cells=this.selection.getSelectedCells();var leftBorderCells=[];for(var i=0;i<cells.length;i++){if(cells[i].columnIndex===startCell.columnIndex){leftBorderCells.push(cells[i]);}}return leftBorderCells;};Editor.prototype.getRightBorderCellsOnSelection=function(){var cells=this.selection.getSelectedCells();var rightBorderCells=[];for(var i=0;i<cells.length;i++){if(cells[i].columnIndex+cells[i].cellFormat.columnSpan-1===cells[cells.length-1].columnIndex){rightBorderCells.push(cells[i]);}}return rightBorderCells;};Editor.prototype.getBottomBorderCellsOnSelection=function(){var endPos=this.selection.isForward?this.selection.end:this.selection.start;var endCell=endPos.paragraph.associatedCell;var cells=this.selection.getSelectedCells();var bottomBorderCells=[];for(var i=0;i<cells.length;i++){if(cells[i].ownerRow===endCell.ownerRow){bottomBorderCells.push(cells[i]);}}return bottomBorderCells;};Editor.prototype.clearAllBorderValues=function(borders){var border=this.clearBorder();borders.bottom.copyFormat(border);borders.left.copyFormat(border);borders.right.copyFormat(border);borders.top.copyFormat(border);borders.vertical.copyFormat(border);borders.horizontal.copyFormat(border);};Editor.prototype.clearBorder=function(){var border=new WBorder();border.lineStyle='Cleared';return border;};Editor.prototype.getAdjacentCellToApplyBottomBorder=function(){var cells=[];var startPos=this.selection.start;var endPos=this.selection.end;if(!this.selection.isForward){startPos=this.selection.end;endPos=this.selection.start;}var table=startPos.paragraph.associatedCell.ownerTable;table=table.combineWidget(this.owner.viewer);var startCell=startPos.paragraph.associatedCell;var endCell=endPos.paragraph.associatedCell;var nextRowIndex=endCell.ownerRow.rowIndex+endCell.cellFormat.rowSpan;var nextRow=table.childWidgets[nextRowIndex];if(nextRow){if(endCell.cellFormat.columnSpan>1){for(var i=endCell.columnIndex;i<endCell.columnIndex+endCell.cellFormat.columnSpan;i++){cells.push(nextRow.childWidgets[i]);}}else{cells=this.getAdjacentBottomBorderOnEmptyCells(nextRow,endCell);if(!this.selection.isEmpty){for(var i=0;i<nextRow.childWidgets.length;i++){var nextCellColIndex=nextRow.childWidgets[i].columnIndex;if(nextCellColIndex>=startCell.columnIndex&&nextCellColIndex<=endCell.columnIndex){cells.push(nextRow.childWidgets[i]);}}}}}return cells;};Editor.prototype.getAdjacentBottomBorderOnEmptyCells=function(nextRow,cell,isSingleCell){var cells=[];if(cell.cellFormat.columnSpan>1){for(var i=cell.columnIndex;i<cell.columnIndex+cell.cellFormat.columnSpan;i++){cells.push(nextRow.childWidgets[i]);}}else{if(this.selection.isEmpty||isSingleCell){for(var i=0;i<nextRow.childWidgets.length;i++){if(nextRow.childWidgets[i].columnIndex===cell.columnIndex){cells.push(nextRow.childWidgets[i]);}}}}return cells;};Editor.prototype.getAdjacentCellToApplyRightBorder=function(){var cells=[];var startPosIn=this.selection.start;var endPosIn=this.selection.end;if(!this.selection.isForward){startPosIn=this.selection.end;endPosIn=this.selection.start;}var table=startPosIn.paragraph.associatedCell.ownerTable;table=table.combineWidget(this.owner.viewer);var startCell=startPosIn.paragraph.associatedCell;var endCell=endPosIn.paragraph.associatedCell;if(this.selection.isEmpty){var selectedCell=startPosIn.paragraph.associatedCell;cells=this.getSelectedCellsNextWidgets(selectedCell,table);}else{var selectedCells=this.getRightBorderCellsOnSelection();for(var i=0;i<selectedCells.length;i++){var cell=selectedCells[i];cells=cells.concat(this.getSelectedCellsNextWidgets(cell,table));}}return cells;};Editor.prototype.getSelectedCellsNextWidgets=function(selectedCell,table){var cells=[];if(!sf.base.isNullOrUndefined(selectedCell.nextWidget)){cells.push(selectedCell.nextWidget);if(selectedCell.cellFormat.rowSpan>1){var nextRowIndex=selectedCell.ownerRow.rowIndex+selectedCell.cellFormat.rowSpan;for(var i=selectedCell.ownerRow.rowIndex+1;i<nextRowIndex;i++){var nextRow=table.childWidgets[i];if(nextRow){for(var j=0;j<nextRow.childWidgets.length;j++){if(nextRow.childWidgets[j].columnIndex===selectedCell.nextWidget.columnIndex){cells.push(nextRow.childWidgets[j]);}}}}}}return cells;};Editor.prototype.getBorder=function(borderColor,lineWidth,borderStyle){var border=new WBorder();border.color=borderColor||'#000000';border.lineWidth=lineWidth||1;border.lineStyle=borderStyle||'Single';return border;};/**
     * Applies borders
     *
     * @param {WBorders} sourceBorders
     * @param {WBorders} applyBorders
     * @private
     * @returns {void}
     */Editor.prototype.applyBordersInternal=function(sourceBorders,applyBorders){if(!sf.base.isNullOrUndefined(sourceBorders)&&!sf.base.isNullOrUndefined(sourceBorders)){if(!sf.base.isNullOrUndefined(sourceBorders.top)){this.applyBorder(sourceBorders.top,applyBorders.top);}if(!sf.base.isNullOrUndefined(sourceBorders.bottom)){this.applyBorder(sourceBorders.bottom,applyBorders.bottom);}if(!sf.base.isNullOrUndefined(sourceBorders.left)){this.applyBorder(sourceBorders.left,applyBorders.left);}if(!sf.base.isNullOrUndefined(sourceBorders.right)){this.applyBorder(sourceBorders.right,applyBorders.right);}if(!sf.base.isNullOrUndefined(sourceBorders.horizontal)){this.applyBorder(sourceBorders.horizontal,applyBorders.horizontal);}if(!sf.base.isNullOrUndefined(sourceBorders.vertical)){this.applyBorder(sourceBorders.vertical,applyBorders.vertical);}if(!sf.base.isNullOrUndefined(sourceBorders.diagonalUp)){this.applyBorder(sourceBorders.diagonalUp,applyBorders.diagonalUp);}if(!sf.base.isNullOrUndefined(sourceBorders.diagonalDown)){this.applyBorder(sourceBorders.diagonalDown,applyBorders.diagonalDown);}}};/**
     * Apply shading to table
     *
     * @param {WShading} sourceShading
     * @param {WShading} applyShading
     * @private
     * @returns {void}
     */Editor.prototype.applyShading=function(sourceShading,applyShading){if(!sf.base.isNullOrUndefined(applyShading)&&!sf.base.isNullOrUndefined(sourceShading)){if(!sf.base.isNullOrUndefined(applyShading.backgroundColor)&&sourceShading.backgroundColor!==applyShading.backgroundColor){sourceShading.backgroundColor=applyShading.backgroundColor;}if(!sf.base.isNullOrUndefined(applyShading.foregroundColor)&&sourceShading.foregroundColor!==applyShading.foregroundColor){sourceShading.foregroundColor=applyShading.foregroundColor;}if(!sf.base.isNullOrUndefined(applyShading.textureStyle)&&sourceShading.textureStyle!==applyShading.textureStyle){sourceShading.textureStyle=applyShading.textureStyle;}}};Editor.prototype.applyBorder=function(sourceBorder,applyBorder){if(!sf.base.isNullOrUndefined(sourceBorder)&&!sf.base.isNullOrUndefined(applyBorder)){if(!sf.base.isNullOrUndefined(applyBorder.color)&&sourceBorder.color!==applyBorder.color){sourceBorder.color=applyBorder.color;}if(!sf.base.isNullOrUndefined(applyBorder.lineStyle)&&sourceBorder.lineStyle!==applyBorder.lineStyle){sourceBorder.lineStyle=applyBorder.lineStyle;}if(!sf.base.isNullOrUndefined(applyBorder.lineWidth)&&sourceBorder.lineWidth!==applyBorder.lineWidth){sourceBorder.lineWidth=applyBorder.lineWidth;}if(!sf.base.isNullOrUndefined(applyBorder.shadow)&&sourceBorder.shadow!==applyBorder.shadow){sourceBorder.shadow=applyBorder.shadow;}if(!sf.base.isNullOrUndefined(applyBorder.space)&&sourceBorder.space!==applyBorder.space){sourceBorder.space=applyBorder.space;}}};/**
     * Apply Table Format changes
     *
     * @param {WTableFormat} format Specifies table format
     * @param {boolean} isShading Specifies shading.
     * @private
     * @returns {void}
     */Editor.prototype.onTableFormat=function(format,isShading){if(!sf.base.isNullOrUndefined(this.selection.tableFormat)){if(sf.base.isNullOrUndefined(isShading)){isShading=false;}this.documentHelper.owner.isShiftingEnabled=true;this.editorHistory.initializeHistory('TableFormat');var table=this.selection.start.paragraph.associatedCell.ownerTable.combineWidget(this.owner.viewer);if(isShading){for(var i=0;i<table.childWidgets.length;i++){var rowWidget=table.childWidgets[i];for(var j=0;j<rowWidget.childWidgets.length;j++){var cellWidget=rowWidget.childWidgets[j];cellWidget.cellFormat.shading.copyFormat(format.shading);}}}this.applyTableFormat(table,undefined,format);this.reLayout(this.selection,false);}};Editor.prototype.applyTableFormat=function(table,property,value){this.applyTablePropertyValue(this.documentHelper.selection,undefined,value,table);};Editor.prototype.applyTablePropertyValue=function(selection,property,value,table){var sourceFormat=table.tableFormat;if(!sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo)){value=this.editorHistory.currentBaseHistoryInfo.addModifiedTableProperties(sourceFormat,property,value);}if(value instanceof WTableFormat){if(sf.base.isNullOrUndefined(property)){this.handleTableFormat(sourceFormat,value);}return;}if(property==='preferredWidth'){sourceFormat.preferredWidth=value;}else if(property==='leftIndent'){sourceFormat.leftIndent=value;}else if(property==='tableAlignment'){sourceFormat.tableAlignment=value;}else if(property==='cellSpacing'){sourceFormat.cellSpacing=value;}else if(property==='leftMargin'){sourceFormat.leftMargin=value;}else if(property==='rightMargin'){sourceFormat.rightMargin=value;}else if(property==='topMargin'){sourceFormat.topMargin=value;}else if(property==='bottomMargin'){sourceFormat.bottomMargin=value;}else if(property==='preferredWidthType'){sourceFormat.preferredWidthType=value;}else if(property==='bidi'){sourceFormat.bidi=value;}if(property==='shading'){sourceFormat.shading=value;}else if(property==='borders'){sourceFormat.borders=value;}// if (!isNullOrUndefined(table)) {
//     this.layoutItemBlock(table, true);
// }
};Editor.prototype.handleTableFormat=function(tableFormat,applyFormat){if(this.isBordersAndShadingDialog||this.editorHistory.isUndoing||this.editorHistory.isRedoing){if(!sf.base.isNullOrUndefined(tableFormat.borders)){this.applyBordersInternal(tableFormat.borders,applyFormat.borders);}if(!sf.base.isNullOrUndefined(tableFormat.shading)){this.applyShading(tableFormat.shading,applyFormat.shading);}}if(!this.isBordersAndShadingDialog){if(applyFormat.hasValue('bidi')&&applyFormat.bidi!==tableFormat.bidi){tableFormat.bidi=applyFormat.bidi;}if(applyFormat.hasValue('preferredWidth')&&applyFormat.preferredWidth!==tableFormat.preferredWidth){tableFormat.preferredWidth=applyFormat.preferredWidth;}if(applyFormat.hasValue('preferredWidthType')&&applyFormat.preferredWidthType!==tableFormat.preferredWidthType){tableFormat.preferredWidthType=applyFormat.preferredWidthType;}if(applyFormat.hasValue('tableAlignment')&&applyFormat.tableAlignment!==tableFormat.tableAlignment){tableFormat.tableAlignment=applyFormat.tableAlignment;}if(applyFormat.hasValue('leftIndent')&&applyFormat.leftIndent!==tableFormat.leftIndent){tableFormat.leftIndent=applyFormat.leftIndent;}// Apply from Blazor dialog
if(applyFormat.hasValue('topMargin')&&applyFormat.topMargin!==tableFormat.topMargin){tableFormat.topMargin=applyFormat.topMargin;}if(applyFormat.hasValue('bottomMargin')&&applyFormat.bottomMargin!==tableFormat.bottomMargin){tableFormat.bottomMargin=applyFormat.bottomMargin;}if(applyFormat.hasValue('leftMargin')&&applyFormat.leftMargin!==tableFormat.leftMargin){tableFormat.leftMargin=applyFormat.leftMargin;}if(applyFormat.hasValue('rightMargin')&&applyFormat.rightMargin!==tableFormat.rightMargin){tableFormat.rightMargin=applyFormat.rightMargin;}if(applyFormat.hasValue('cellSpacing')&&applyFormat.cellSpacing!==tableFormat.cellSpacing){tableFormat.cellSpacing=applyFormat.cellSpacing;}}this.updateGridForTableDialog(tableFormat.ownerBase,false);};Editor.prototype.updateGridForTableDialog=function(table,shiftNextItem){if(table.tableHolder){table.updateRowIndex(0);table.calculateGrid();table.isGridUpdated=false;}this.documentHelper.layout.reLayoutTable(table);};/**
     * Applies Row Format Changes
     * @param {WRowFormat} format Specifies row format
     * @private
     * @returns {void}
     */Editor.prototype.onRowFormat=function(format){if(sf.base.isNullOrUndefined(this.selection)||sf.base.isNullOrUndefined(format)){return;}this.editorHistory.initializeHistory('RowFormat');this.documentHelper.owner.isShiftingEnabled=true;var rowStartPos=this.selection.isForward?this.selection.start:this.selection.end;var rowEndPos=this.selection.isForward?this.selection.end:this.selection.start;var table=rowStartPos.paragraph.associatedCell.ownerTable.combineWidget(this.owner.viewer);this.applyRowFormat(rowStartPos.paragraph.associatedCell.ownerRow,rowStartPos,rowEndPos,undefined,format);this.reLayout(this.selection,false);};Editor.prototype.applyRowFormat=function(row,start,end,property,value){this.applyRowPropertyValue(this.documentHelper.selection,property,value,row);if(end.paragraph.associatedCell.ownerRow===row){return;}var newRow=row.nextWidget;if(!sf.base.isNullOrUndefined(newRow)){this.applyRowFormat(newRow,start,end,property,value);}};Editor.prototype.applyRowPropertyValue=function(selection,property,value,row){var applyFormat=row.rowFormat;if(!sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo)){value=this.editorHistory.currentBaseHistoryInfo.addModifiedRowProperties(applyFormat,property,value);}if(value instanceof WRowFormat){if(sf.base.isNullOrUndefined(property)){this.handleRowFormat(value,applyFormat);}return;}if(property==='heightType'){applyFormat.heightType=value;}else if(property==='height'){applyFormat.height=value;}else if(property==='isHeader'){applyFormat.isHeader=value;}else if(property==='allowBreakAcrossPages'){applyFormat.allowBreakAcrossPages=value;}if(!sf.base.isNullOrUndefined(row.ownerTable)){this.layoutItemBlock(row.ownerTable,true);}};Editor.prototype.handleRowFormat=function(format,applyFormat){if(format.hasValue('allowBreakAcrossPages')&&format.allowBreakAcrossPages!==applyFormat.allowBreakAcrossPages){applyFormat.allowBreakAcrossPages=format.allowBreakAcrossPages;}if(format.hasValue('isHeader')&&format.isHeader!==applyFormat.isHeader){applyFormat.isHeader=format.isHeader;}if(format.hasValue('heightType')&&format.heightType!==applyFormat.heightType){applyFormat.heightType=format.heightType;}if(format.hasValue('height')&&format.height!==applyFormat.height){applyFormat.height=format.height;}this.updateGridForTableDialog(applyFormat.ownerBase.ownerTable,true);};/**
     * Applies Cell Format changes
     *
     * @param {WCellFormat} format Specifies cell format
     * @private
     * @returns {void}
     */Editor.prototype.onCellFormat=function(format){if(sf.base.isNullOrUndefined(this.selection)||sf.base.isNullOrUndefined(format)){return;}this.editorHistory.initializeHistory('CellFormat');this.updateFormatForCell(this.selection,undefined,format);this.reLayout(this.selection,false);};/**
     * @private
     * @returns {void}
     */Editor.prototype.updateCellMargins=function(selection,value){var cellStartPosition=selection.start;var cellEndPosition=selection.end;if(!selection.isForward){cellStartPosition=selection.end;cellEndPosition=selection.start;}this.initHistoryPosition(selection,cellStartPosition);// this.documentHelper.owner.cellOptionsDialogModule.applyCellMarginValue(cellStartPosition.paragraph.associatedCell.ownerRow, cellStartPosition, cellEndPosition, value);
};Editor.prototype.updateFormatForCell=function(selection,property,value){var start=selection.start;var end=selection.end;if(!selection.isForward){start=selection.end;end=selection.start;}var startCell=start.paragraph.associatedCell;var endCell=end.paragraph.associatedCell;var cells;var table=startCell.ownerTable.combineWidget(this.owner.viewer);var appliedFormat;for(var k=startCell.columnIndex;k<=endCell.columnIndex;k++){cells=this.getSelectedCellInColumn(startCell.ownerTable,startCell.ownerRow.rowIndex,k,endCell.ownerRow.rowIndex);for(var i=0;i<cells.length;i++){appliedFormat=this.applyCellPropertyValue(this.documentHelper.selection,property,value,cells[i].cellFormat);}}this.updateGridForTableDialog(table,false);};Editor.prototype.getSelectedCellInColumn=function(table,rowStartIndex,columnIndex,rowEndIndex){var cells=[];for(var i=rowStartIndex;i<=rowEndIndex;i++){var row=table.childWidgets[i];for(var j=0;j<row.childWidgets.length;j++){if(row.childWidgets[j].columnIndex===columnIndex){cells.push(row.childWidgets[j]);}}}return cells;};Editor.prototype.getColumnCells=function(table,columnIndex,isLeftSideCollection){var cells=[];for(var k=0;k<table.childWidgets.length;k++){var row=table.childWidgets[k];for(var i=0;i<row.childWidgets.length;i++){var cell=row.childWidgets[i];if(isLeftSideCollection){if(cell.columnIndex+cell.cellFormat.columnSpan===columnIndex){cells.push(cell);}}else{if(cell.columnIndex===columnIndex){cells.push(cell);}}}}return cells;};Editor.prototype.getTableWidth=function(table){if(table.tableFormat.preferredWidth!==0||table.tableFormat.preferredWidthType==='Percent'){if(table.tableFormat.preferredWidthType==='Auto'||table.tableFormat.preferredWidthType==='Point'){return table.tableFormat.preferredWidth;}else{if(table.tableFormat.preferredWidth===0){return 0;}else{return HelperMethods.convertPixelToPoint(this.owner.viewer.clientArea.width)/100*table.tableFormat.preferredWidth;}}}return HelperMethods.convertPixelToPoint(this.documentHelper.layout.getTableWidth(table));};Editor.prototype.applyCellPropertyValue=function(selection,property,value,applyFormat){if(!sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo)){value=this.editorHistory.currentBaseHistoryInfo.addModifiedCellProperties(applyFormat,property,value);}if(value instanceof WCellFormat){if(sf.base.isNullOrUndefined(property)){this.handleCellFormat(value,applyFormat);}return value;}if(property==='leftMargin'){applyFormat.leftMargin=value;}else if(property==='topMargin'){applyFormat.topMargin=value;}else if(property==='rightMargin'){applyFormat.rightMargin=value;}else if(property==='bottomMargin'){applyFormat.bottomMargin=value;}else if(property==='preferredWidth'){applyFormat.preferredWidth=value;applyFormat.cellWidth=value;}else if(property==='cellWidth'){applyFormat.cellWidth=value;}else if(property==='columnSpan'){applyFormat.columnSpan=value;}else if(property==='rowSpan'){applyFormat.rowSpan=value;}else if(property==='preferredWidthType'){applyFormat.preferredWidthType=value;}else if(property==='verticalAlignment'){applyFormat.verticalAlignment=value;}if(property==='shading'){applyFormat.shading=value;}else if(property==='borders'){applyFormat.borders=value;}return undefined;};Editor.prototype.handleCellFormat=function(cellFormat,applyFormat){if(!sf.base.isNullOrUndefined(cellFormat)&&!sf.base.isNullOrUndefined(applyFormat)){if(this.isBordersAndShadingDialog){if(!sf.base.isNullOrUndefined(cellFormat.borders)){this.applyBordersInternal(applyFormat.borders,cellFormat.borders);}if(!sf.base.isNullOrUndefined(cellFormat.shading)){this.applyShading(applyFormat.shading,cellFormat.shading);}// this.layoutRow((applyFormat.ownerBase as TableCellWidget).ownerRow, this.documentHelper, false);
}else{if(cellFormat.hasValue('preferredWidth')&&applyFormat.preferredWidth!==cellFormat.preferredWidth){applyFormat.preferredWidth=cellFormat.preferredWidth;}if(cellFormat.hasValue('preferredWidthType')&&applyFormat.preferredWidthType!==cellFormat.preferredWidthType){applyFormat.preferredWidthType=cellFormat.preferredWidthType;}if(cellFormat.hasValue('verticalAlignment')&&applyFormat.verticalAlignment!==cellFormat.verticalAlignment){applyFormat.verticalAlignment=cellFormat.verticalAlignment;}// Apply value from Blazor dialog
if(cellFormat.hasValue('leftMargin')&&applyFormat.leftMargin!==cellFormat.leftMargin){applyFormat.leftMargin=cellFormat.leftMargin;}if(cellFormat.hasValue('rightMargin')&&applyFormat.rightMargin!==cellFormat.rightMargin){applyFormat.rightMargin=cellFormat.rightMargin;}if(cellFormat.hasValue('topMargin')&&applyFormat.topMargin!==cellFormat.topMargin){applyFormat.topMargin=cellFormat.topMargin;}if(cellFormat.hasValue('bottomMargin')&&applyFormat.bottomMargin!==cellFormat.bottomMargin){applyFormat.bottomMargin=cellFormat.bottomMargin;}}}};/**
     * @private
     * @returns {void}
     */Editor.prototype.destroy=function(){this.documentHelper=undefined;this.nodes=[];};/**
     * Updates the table of contents.
     *
     * @private
     * @returns {void}
     */Editor.prototype.updateToc=function(tocField){if(sf.base.isNullOrUndefined(tocField)){tocField=this.selection.getTocFieldInternal();}if(!this.documentHelper.layout.isTocField(tocField)){return;}// Decode field code to get parameters
var code=this.selection.getFieldCode(tocField);if(code.toLocaleLowerCase().indexOf('toc')!==-1){this.insertTableOfContents(this.validateTocSettings(this.getTocSettings(code,tocField)));}};Editor.prototype.getTocSettings=function(code,tocField){var tocSettings={};tocSettings.includePageNumber=true;tocSettings.rightAlign=true;// Decode field code to get parameters
if(code.toLowerCase()==='toc \\mergeformat'){tocSettings.startLevel=1;tocSettings.endLevel=3;}else{var swtiches=code.split('\\');for(var i=0;i<swtiches.length;i++){var swtch=swtiches[i];if(swtch.length===0){continue;}switch(swtch[0]){case'o':if(!sf.base.isNullOrUndefined(swtch.match(/\d+/g))){var levels=swtch.match(/\d+/g).map(Number);tocSettings.startLevel=levels[0];tocSettings.endLevel=levels[1];}else{tocSettings.startLevel=1;tocSettings.endLevel=9;}break;case'h':tocSettings.includeHyperlink=true;break;case'n':tocSettings.includePageNumber=false;break;case'p':tocSettings.rightAlign=false;break;case'u':tocSettings.includeOutlineLevels=true;break;case't':this.decodeTSwitch(tocSettings,swtch);break;}}}//assigns tab leader.
var tabs=tocField.paragraph.paragraphFormat.getUpdatedTabs();if(tabs.length>0){tocSettings.tabLeader=tabs[tabs.length-1].tabLeader;}if(tocSettings.rightAlign&&sf.base.isNullOrUndefined(tocSettings.tabLeader)){tocSettings.tabLeader='Dot';}return tocSettings;};Editor.prototype.decodeTSwitch=function(tocSettings,tSwitch){tocSettings.levelSettings={};tSwitch=tSwitch.replace('t','');tSwitch=tSwitch.replace('"','');tSwitch=tSwitch.replace('"','');tSwitch=tSwitch.trim();var levels=tSwitch.split(',');for(var index=0;index<levels.length;index++){tocSettings.levelSettings[levels[index]]=parseInt(levels[index+1],10);index++;}};/**
     * Inserts, modifies or updates the table of contents based on given settings.
     *
     * @param {TableOfContentsSettings} tableOfContentsSettings
     * @returns {void}
     */Editor.prototype.insertTableOfContents=function(tableOfContentsSettings){this.isInsertingTOC=true;this.initComplexHistory('TOC');if(sf.base.isNullOrUndefined(tableOfContentsSettings)){//Initializes with default value.
tableOfContentsSettings={};tableOfContentsSettings.startLevel=1;tableOfContentsSettings.endLevel=3;tableOfContentsSettings.includeHyperlink=true;tableOfContentsSettings.includeOutlineLevels=true;tableOfContentsSettings.includePageNumber=true;tableOfContentsSettings.rightAlign=true;tableOfContentsSettings.tabLeader='Dot';}var tocField=undefined;var code=undefined;if(this.selection.contextType==='TableOfContents'){tocField=this.selection.getTocFieldInternal();}if(tocField instanceof FieldElementBox){this.selection.start.setPositionForSelection(tocField.line,tocField,0,this.selection.start.location);var offset=2;if(tocField.fieldEnd.paragraph===tocField.fieldEnd.paragraph.bodyWidget.lastChild){offset--;}this.selection.end.setPositionForSelection(tocField.fieldEnd.line,tocField.fieldEnd,offset,this.selection.end.location);this["delete"]();}// Build TOC field code based on parameter
code=this.constructTocFieldCode(tableOfContentsSettings);var isStartParagraph=this.selection.start.isAtParagraphStart;var blockInfo=this.selection.getParagraphInfo(this.selection.start);var initialStart=this.selection.getHierarchicalIndex(blockInfo.paragraph,blockInfo.offset.toString());// Build TOC fields
var widgets=this.buildToc(this.validateTocSettings(tableOfContentsSettings),code,true,isStartParagraph);if(widgets.length>0){var tocLastPara=new ParagraphWidget();var tocLastLine=new LineWidget(tocLastPara);tocLastPara.childWidgets.push(tocLastLine);var index=0;if(!isStartParagraph){index=1;}var line=widgets[index].childWidgets[0];var fieldBegin=line.children[0];this.appendEndField(fieldBegin,tocLastLine);widgets.push(tocLastPara);this.appendEmptyPara(widgets);}else{// let localizeValue: L10n = new L10n('documenteditor', this.owner.defaultLocale);
// localizeValue.setLocale(this.owner.locale);
// DialogUtility.alert({
//     title: localizeValue.getConstant('No Headings'),
//     content: localizeValue.getConstant('Add Headings'),
//     showCloseIcon: true,
//     closeOnEscape: true,
//     position: { X: 'center', Y: 'center' },
//     animationSettings: { effect: 'Zoom' }
// });
}this.setPositionForCurrentIndex(this.selection.start,initialStart);this.selection.end.setPositionInternal(this.selection.start);var bodyWidget=new BodyWidget();bodyWidget.sectionFormat=new WSectionFormat(bodyWidget);bodyWidget.childWidgets=widgets;this.pasteContentsInternal([bodyWidget],false);this.isInsertingTOC=false;this.updatePageRef();if(this.editorHistory){this.editorHistory.updateComplexHistoryInternal();}if(widgets.length===0){this.owner.editorHistory.undo();this.owner.editorHistory.redoStack.pop();}};Editor.prototype.appendEmptyPara=function(widgets){var emptyPara=new ParagraphWidget();var emptyLine=new LineWidget(emptyPara);emptyPara.childWidgets.push(emptyLine);widgets.push(emptyPara);};Editor.prototype.constructTocFieldCode=function(tocSettings){var tocFieldCode='TOC';//appends styles level
if(!sf.base.isNullOrUndefined(tocSettings.startLevel)&&tocSettings.startLevel!==0&&!sf.base.isNullOrUndefined(tocSettings.endLevel)&&tocSettings.endLevel!==0){tocFieldCode=tocFieldCode+' \\o "'+tocSettings.startLevel+'-'+tocSettings.endLevel+'"';}if(tocSettings.includePageNumber&&!tocSettings.rightAlign){tocFieldCode=tocFieldCode+' \\p " "';}if(!tocSettings.includePageNumber){tocFieldCode=tocFieldCode+' \\n';}if(tocSettings.includeHyperlink){tocFieldCode=tocFieldCode+' \\h \\z';}if(tocSettings.includeOutlineLevels){tocFieldCode=tocFieldCode+" \\u";}var tSwitch=this.constructTSwitch(tocSettings);if(tSwitch.length>6){tocFieldCode=tocFieldCode+tSwitch;}return tocFieldCode;};Editor.prototype.constructTSwitch=function(tocSettings){var tSwitch='';var prefix=' \\t ';if(!sf.base.isNullOrUndefined(tocSettings.levelSettings)){for(var _i=0,_a=Object.keys(tocSettings.levelSettings);_i<_a.length;_i++){var key=_a[_i];tSwitch=tSwitch+key+','+tocSettings.levelSettings[key].toString()+',';}}tSwitch=tSwitch.slice(0,-1);tSwitch=prefix+'"'+tSwitch+'"';return tSwitch;};Editor.prototype.appendEndField=function(fieldBegin,lineWidget){var fieldEnd=new FieldElementBox(1);fieldEnd.fieldSeparator=fieldBegin.fieldSeparator;fieldBegin.fieldSeparator.fieldEnd=fieldEnd;fieldEnd.fieldBegin=fieldBegin;fieldEnd.fieldBegin.fieldEnd=fieldEnd;fieldEnd.line=lineWidget;//For TOC we used to append field end at last we need to map that inserted revision to field end.
if(fieldBegin.revisions.length>0){var currentRevision=fieldBegin.revisions[fieldBegin.revisions.length-1];currentRevision.range.push(fieldEnd);fieldEnd.revisions.push(currentRevision);}lineWidget.children.push(fieldEnd);};Editor.prototype.validateTocSettings=function(tocSettings){if(sf.base.isNullOrUndefined(tocSettings.startLevel)||tocSettings.startLevel<1){tocSettings.startLevel=1;}if(sf.base.isNullOrUndefined(tocSettings.endLevel)||tocSettings.endLevel<tocSettings.endLevel){tocSettings.endLevel=tocSettings.startLevel>3?tocSettings.startLevel:3;}if(sf.base.isNullOrUndefined(tocSettings.includeHyperlink)){tocSettings.includeHyperlink=false;}if(sf.base.isNullOrUndefined(tocSettings.includePageNumber)){tocSettings.includePageNumber=false;}if(sf.base.isNullOrUndefined(tocSettings.rightAlign)){tocSettings.rightAlign=false;}if(sf.base.isNullOrUndefined(tocSettings.levelSettings)){tocSettings.levelSettings={};}return tocSettings;};/**
     * Builds the TOC
     * @private
     * @returns {ParagraphWidget[]}
     *
     */Editor.prototype.buildToc=function(tocSettings,fieldCode,isFirstPara,isStartParagraph){var tocDomBody=this.documentHelper.pages[0].bodyWidgets[0];var widgets=[];this.createHeadingLevels(tocSettings);if(tocSettings.includeOutlineLevels){this.createOutlineLevels(tocSettings);}var sectionFormat=this.selection.start.paragraph.bodyWidget.sectionFormat;var widget=tocDomBody.childWidgets[0];while(widget!==undefined){if(widget instanceof ParagraphWidget&&(this.isHeadingStyle(widget)||tocSettings.includeOutlineLevels&&this.isOutlineLevelStyle(widget))){var bookmarkName=this.insertTocBookmark(widget);this.createTOCWidgets(widget,widgets,fieldCode,bookmarkName,tocSettings,isFirstPara,isStartParagraph,sectionFormat);isFirstPara=false;}widget=this.selection.getNextParagraphBlock(widget.getSplitWidgets().pop());}this.tocStyles={};return widgets;};Editor.prototype.createOutlineLevels=function(settings){for(var i=settings.startLevel;i<=settings.endLevel;i++){var levelStyle='Level'+i.toString();if(sf.base.isNullOrUndefined(this.tocStyles[levelStyle])){this.tocStyles[levelStyle]=i;}}};Editor.prototype.createHeadingLevels=function(settings){//let normalStyle: string = 'Normal';
for(var i=settings.startLevel;i<=settings.endLevel;i++){var headingStyle='Heading '+i.toString();if(sf.base.isNullOrUndefined(this.tocStyles[headingStyle])){this.tocStyles[headingStyle]=i;}}if(!sf.base.isNullOrUndefined(settings.levelSettings)){for(var _i=0,_a=Object.keys(settings.levelSettings);_i<_a.length;_i++){var key=_a[_i];this.tocStyles[key]=settings.levelSettings[key];}}};Editor.prototype.isHeadingStyle=function(para){var style=para.paragraphFormat.baseStyle;if(style!==undefined){return sf.base.isNullOrUndefined(this.tocStyles[style.name])?false:true;}return false;};Editor.prototype.isOutlineLevelStyle=function(para){var styleName=para.paragraphFormat.outlineLevel;return sf.base.isNullOrUndefined(this.tocStyles[styleName])?false:true;};Editor.prototype.createTocFieldElement=function(lineWidget,fieldCode,isSkipRevision){//begin
var fieldBegin=new FieldElementBox(0);fieldBegin.hasFieldEnd=true;fieldBegin.line=lineWidget;lineWidget.children.push(fieldBegin);var textElement=new TextElementBox();textElement.text=fieldCode;textElement.line=lineWidget;lineWidget.children.push(textElement);//field separator
var fieldSeparator=new FieldElementBox(2);fieldSeparator.fieldBegin=fieldBegin;fieldSeparator.fieldBegin.fieldSeparator=fieldSeparator;fieldSeparator.line=lineWidget;lineWidget.children.push(fieldSeparator);// If revision enabled.
return fieldBegin;};Editor.prototype.createTOCWidgets=function(widget,widgets,fieldCode,bookmarkName,tocSettings,isFirstPara,isStartParagraph,sectionFormat){var fieldBegin=undefined;var tocPara=undefined;var tocLine=undefined;var emptyParaAppended=false;if(widgets.length===1&&widgets[0].childWidgets[0].children.length===3&&!sf.base.isNullOrUndefined(isFirstPara)&&!isFirstPara){tocLine=widgets[0].childWidgets[0];}else{tocPara=new ParagraphWidget();var styleName=undefined;//Adds toc syles into paragraph
var headingStyleName=widget.paragraphFormat.baseStyle.name;if(tocSettings.includeOutlineLevels&&sf.base.isNullOrUndefined(this.tocStyles[headingStyleName])){styleName=widget.paragraphFormat.outlineLevel;}else{styleName=headingStyleName;}var tocStyleName='Toc'+this.tocStyles[styleName];var paraStyle=this.documentHelper.styles.findByName(tocStyleName,'Paragraph');if(sf.base.isNullOrUndefined(paraStyle)){this.documentHelper.owner.parser.parseStyle(JSON.parse(this.getCompleteStyles()),JSON.parse(this.documentHelper.preDefinedStyles.get(tocStyleName)),this.documentHelper.styles);paraStyle=this.documentHelper.styles.findByName(tocStyleName,'Paragraph');}tocPara.paragraphFormat.applyStyle(paraStyle);//Creates right tab for page number.
if(tocSettings.rightAlign&&tocSettings.includePageNumber){var tabStop=new WTabStop();tabStop.position=sectionFormat.pageWidth-(sectionFormat.leftMargin+sectionFormat.rightMargin);tabStop.tabLeader=tocSettings.tabLeader;tabStop.deletePosition=0;tabStop.tabJustification='Right';tocPara.paragraphFormat.tabs.push(tabStop);}tocLine=new LineWidget(tocPara);tocPara.childWidgets.push(tocLine);}//creates toc field element if it is insert
if(isFirstPara!==undefined&&isFirstPara){if(!sf.base.isNullOrUndefined(isStartParagraph)&&!isStartParagraph){this.appendEmptyPara(widgets);emptyParaAppended=true;}this.createTocFieldElement(tocLine,fieldCode);}var text='';var isFieldCode=false;var paragraph=widget;while(paragraph instanceof ParagraphWidget){for(var lineIndex=0;lineIndex<paragraph.childWidgets.length;lineIndex++){var lineWidget=paragraph.childWidgets[lineIndex];for(var elementIndex=0;elementIndex<lineWidget.children.length;elementIndex++){var element=lineWidget.children[elementIndex];if(element.isPageBreak){continue;}if(element instanceof FieldElementBox||element instanceof BookmarkElementBox||isFieldCode){if(element instanceof FieldElementBox){if(element.fieldType===0){isFieldCode=true;}else if(element.fieldType===2){isFieldCode=false;}}}else if(element instanceof TextElementBox||element instanceof ListTextElementBox){var temp=element.text;var tabChar='\t';if(temp.indexOf(tabChar)!==-1){temp=temp.replace(new RegExp(tabChar,'g'),' ');}text=text+temp;}}}paragraph=paragraph.nextSplitWidget;}if(text!==''){// inserts hyperlink
if(tocSettings.includeHyperlink&&bookmarkName!==undefined){fieldBegin=this.insertTocHyperlink(tocLine,bookmarkName,text);}else{var span=new TextElementBox();span.text=text;span.line=tocLine;tocLine.children.push(span);}//inserts page number
if(tocSettings.includePageNumber&&bookmarkName!==undefined){if(tocSettings.rightAlign){var tabText=new TabElementBox();tabText.text='\t';tabText.line=tocLine;tocLine.children.push(tabText);}var pageField=this.insertTocPageNumber(bookmarkName,tocLine,tocSettings.rightAlign,widget);this.appendEndField(pageField,tocLine);}if(tocSettings.includeHyperlink&&fieldBegin!==undefined){this.appendEndField(fieldBegin,tocLine);}}if(!sf.base.isNullOrUndefined(tocPara)&&(text!==''||isFirstPara)){widgets.push(tocPara);}if(this.owner.enableTrackChanges&&!sf.base.isNullOrUndefined(tocPara)){if(widgets.length===1||emptyParaAppended){this.insertRevisionForBlock(tocPara,'Insertion',true);}else{var revision=this.owner.revisionsInternal.changes[0];this.insertRevisionForBlock(tocPara,'Insertion',true,revision);}}};Editor.prototype.insertTocHyperlink=function(lineWidget,bookmarkName,text){var fieldCode=' HYPERLINK \\l \"'+bookmarkName+'\" ';var fieldBegin=this.createTocFieldElement(lineWidget,fieldCode,true);//text element.
var span=new TextElementBox();span.text=text;span.line=lineWidget;lineWidget.children.push(span);return fieldBegin;};Editor.prototype.insertTocPageNumber=function(bookMarkname,lineWidget,isRightAlign,widget){var fieldCode=' PAGEREF'+bookMarkname+' \\h ';var fieldBegin=this.createTocFieldElement(lineWidget,fieldCode,true);var text=(this.documentHelper.pages.indexOf(widget.bodyWidget.page)+1).toString();//text element.
var span=new FieldTextElementBox();span.fieldBegin=fieldBegin;if(!isRightAlign){text=' '+text;}span.text=text;span.line=lineWidget;lineWidget.children.push(span);this.pageRefFields[bookMarkname]=span;return fieldBegin;};Editor.prototype.updatePageRef=function(){for(var _i=0,_a=Object.keys(this.pageRefFields);_i<_a.length;_i++){var key=_a[_i];if(this.documentHelper.bookmarks.containsKey(key)){var bookmark=this.documentHelper.bookmarks.get(key);var pageRef=(bookmark.paragraph.bodyWidget.page.index+1).toString();var span=this.pageRefFields[key];if(pageRef!==span.text){span.text=pageRef;var paragraph=span.paragraph;var lineIndex=paragraph.childWidgets.indexOf(span.line);var elementIndex=span.line.children.indexOf(span);this.documentHelper.layout.reLayoutParagraph(paragraph,lineIndex,elementIndex);}}}};/**
     * Inserts toc bookmark.
     *
     * @returns {string}
     */Editor.prototype.insertTocBookmark=function(widget){var bookmarkName=undefined;var lineLength=widget.childWidgets.length;if(lineLength>0){var splitParagraph=widget.getSplitWidgets();var firstParagraph=splitParagraph[0];var lastParagraph=splitParagraph.pop();var startLine=firstParagraph.childWidgets[0];var endLine=lastParagraph.childWidgets[lastParagraph.childWidgets.length-1];if(startLine!==undefined&&endLine!==undefined){var startElement=startLine.children[0];if(startElement instanceof ListTextElementBox||startElement instanceof CommentCharacterElementBox){do{startElement=startElement.nextNode;}while(startElement instanceof ListTextElementBox||startElement instanceof CommentCharacterElementBox);}//Returns the bookmark if already present for paragraph.
if(!sf.base.isNullOrUndefined(startElement)&&startElement instanceof BookmarkElementBox&&startElement.bookmarkType===0&&startElement.name.toLowerCase().match('^_toc')){return startElement.name;}var endElement=endLine.children[endLine.children.length-1];if(startElement!==undefined&&endElement!==undefined){this.selection.start.setPositionForSelection(startLine,startElement,0,this.selection.start.location);this.selection.end.setPositionForSelection(endLine,endElement,endElement.length,this.selection.end.location);bookmarkName=this.generateBookmarkName();this.insertBookmark(bookmarkName);}}}return bookmarkName;};Editor.prototype.generateBookmarkName=function(){this.tocBookmarkId++;var count=10-this.tocBookmarkId.toString().length;var formatString='';while(count-1>0){formatString='0'+formatString;count--;}var bookmarkName='_Toc'+formatString+this.tocBookmarkId;return bookmarkName;};/**
     * Change cell content alignment
     * @private
     * @returns {void}
     */Editor.prototype.onCellContentAlignment=function(verticalAlignment,textAlignment){this.owner.isShiftingEnabled=true;var selection=this.owner.selection;if(selection.isEmpty&&selection.start.paragraph.isInsideTable){if(this.owner.editorHistory){this.owner.editorHistory.initComplexHistory(selection,'MultiSelection');}//Selecting the table cell to update the all the paragraph format.
selection.selectTableCell();this.initHistory('CellContentVerticalAlignment');var cellFormat=selection.start.paragraph.associatedCell.cellFormat;this.applyCellPropertyValue(selection,'verticalAlignment',verticalAlignment,cellFormat);this.reLayout(selection,false);this.initHistory('TextAlignment');this.updateParagraphFormat('textAlignment',textAlignment,false);this.reLayout(this.owner.selection,false);if(this.owner.editorHistory){this.owner.editorHistory.updateComplexHistory();}}else{if(this.owner.editorHistory){this.owner.editorHistory.initComplexHistory(selection,'MultiSelection');}if(!sf.base.isNullOrUndefined(selection.getTable(selection.start,selection.end))){//Table cell vertical alignment.
this.updateSelectionTableFormat(selection,'CellContentVerticalAlignment',verticalAlignment);this.reLayout(this.owner.selection,false);this.initHistory('TextAlignment');//Paragraph text alignment.
this.updateSelectionParagraphFormatting('textAlignment',textAlignment,false);this.reLayout(selection,false);}if(this.owner.editorHistory){this.owner.editorHistory.updateComplexHistory();}}};//Restrict editing implementation starts
/**
     * @private
     * @returns {void}
     */Editor.prototype.insertEditRangeElement=function(user){if(this.documentHelper.isDocumentProtected||this.documentHelper.selection.isEmpty){return;}this.initComplexHistory('RestrictEditing');this.selection.skipEditRangeRetrieval=true;var selection=this.documentHelper.selection;var startPos=this.selection.start;var endPos=this.selection.end;if(!this.selection.isForward){startPos=this.selection.end;endPos=this.selection.start;}if(selection.start.paragraph.isInsideTable&&selection.end.paragraph.isInsideTable&&selection.start.paragraph.associatedCell.ownerTable.contains(selection.end.paragraph.associatedCell)){var startCell=this.getOwnerCell(this.selection.isForward);var endCell=this.getOwnerCell(!this.selection.isForward);if(startCell.rowIndex===endCell.rowIndex){var startIndex=startCell.ownerRow.childWidgets.indexOf(startCell);var endIndex=startCell.ownerRow.childWidgets.indexOf(endCell);var startElement=[];var endElement=[];for(var i=startIndex;i<=endIndex;i++){var editStart=this.addEditElement(user);editStart.columnFirst=i;editStart.columnLast=i;editStart.line=selection.start.currentWidget;var editEnd=editStart.editRangeEnd;editEnd.line=selection.end.currentWidget;startElement.push(editStart);endElement.push(editEnd);}this.insertElements(endElement,startElement);var offset=startElement[0].line.getOffset(startElement[0],1);this.selection.start.setPositionParagraph(startElement[0].line,offset);offset=endElement[0].line.getOffset(endElement[0],1);this.selection.end.setPositionParagraph(endElement[0].line,offset);this.selection.fireSelectionChanged(true);this.fireContentChange();}else{this.insertEditRangeInsideTable(startCell,endCell,user);var startLine=this.selection.getFirstParagraphInCell(startCell).childWidgets[0];var endLine=this.selection.getLastParagraph(endCell).childWidgets[0];var offset=startLine.getOffset(startLine.children[0],1);this.selection.start.setPositionParagraph(startLine,offset);offset=endLine.getOffset(endLine.children[0],1);this.selection.end.setPositionParagraph(endLine,offset);this.selection.fireSelectionChanged(true);this.fireContentChange();}}else{this.addRestrictEditingForSelectedArea(user);}this.selection.skipEditRangeRetrieval=false;};Editor.prototype.insertEditRangeInsideTable=function(startCell,endCell,user){var table=startCell.ownerTable;var count=table.childWidgets.indexOf(endCell.ownerRow);var rowStartIndex=table.childWidgets.indexOf(startCell.ownerRow);var startLeft=this.selection.getCellLeft(startCell.ownerRow,startCell);var endLeft=startLeft+startCell.cellFormat.cellWidth;var endCellLeft=this.selection.getCellLeft(endCell.ownerRow,endCell);var endCellRight=endCellLeft+endCell.cellFormat.cellWidth;var cellInfo=this.updateSelectedCellsInTable(startLeft,endLeft,endCellLeft,endCellRight);startLeft=cellInfo.start;endLeft=cellInfo.end;var endElement=[];for(var i=rowStartIndex;i<=count;i++){var row=table.childWidgets[i];var cellSelectionStartIndex=-1;var cellSelectionEndIndex=-1;for(var j=0;j<row.childWidgets.length;j++){var cell=row.childWidgets[j];var cellStart=this.selection.getCellLeft(row,cell);if(this.checkCellWithInSelection(startLeft,endLeft,cellStart)){if(cellSelectionStartIndex===-1){cellSelectionStartIndex=j;}cellSelectionEndIndex=j;}}var newEndElement=[];for(var z=cellSelectionStartIndex;z<=cellSelectionEndIndex;z++){var index=0;var startCell_1=void 0;var startParagraph=void 0;if(z===cellSelectionStartIndex){startCell_1=row.childWidgets[cellSelectionStartIndex];startParagraph=this.selection.getFirstParagraphInCell(startCell_1).childWidgets[0];}var editStart=this.addEditElement(user);editStart.columnFirst=z;editStart.columnLast=z;editStart.line=startParagraph;editStart.line.children.splice(index,0,editStart);index++;var editEnd=editStart.editRangeEnd;newEndElement.push(editEnd);if(endElement.length>0&&z===cellSelectionEndIndex){for(var l=0;l<endElement.length;l++){endElement[l].line=editStart.line;editStart.line.children.splice(index,0,endElement[l]);index++;}endElement=[];}}endElement=newEndElement;if(i===count&&endElement.length>0){var cellWidget=row.childWidgets[cellSelectionEndIndex];var lastLine=this.selection.getLastParagraph(cellWidget).lastChild;var index=lastLine.children.length-1;for(var l=0;l<endElement.length;l++){endElement[l].line=lastLine;lastLine.children.splice(index,0,endElement[l]);index++;}}}};Editor.prototype.addRestrictEditingForSelectedArea=function(user){var editStart=this.addEditElement(user);var editEnd=editStart.editRangeEnd;if(this.editorHistory&&this.editorHistory.currentHistoryInfo){this.editorHistory.currentHistoryInfo.editRangeStart=editStart;}this.insertElements([editEnd],[editStart]);if(this.editorHistory){this.editorHistory.updateComplexHistoryInternal();}var offset=editStart.line.getOffset(editStart,1);this.selection.start.setPositionParagraph(editStart.line,offset);offset=editEnd.line.getOffset(editEnd,1);this.selection.end.setPositionParagraph(editEnd.line,offset);this.selection.fireSelectionChanged(true);this.fireContentChange();};/**
     * @private
     * @returns {void}
     */Editor.prototype.addEditElement=function(user){var editStart=new EditRangeStartElementBox();if(user.toLocaleLowerCase()==='everyone'){editStart.group=user;}else{editStart.user=user;}var editEnd=new EditRangeEndElementBox();editEnd.editRangeStart=editStart;editStart.editRangeEnd=editEnd;this.editStartRangeCollection.push(editStart);this.addEditCollectionToDocument();this.editStartRangeCollection=[];return editStart;};/**
     * @private
     * @returns {void}
     */Editor.prototype.protect=function(protectionType){this.documentHelper.isDocumentProtected=true;this.documentHelper.protectionType=protectionType;this.selection.highlightEditRegion();if(this.editorHistory){this.editorHistory.destroy();}};Editor.prototype.addEditCollectionToDocument=function(){for(var i=0;i<this.editStartRangeCollection.length;i++){var editStart=this.editStartRangeCollection[i];var user=editStart.user===''?editStart.group:editStart.user;if(this.documentHelper.editRanges.length>0&&this.documentHelper.editRanges.containsKey(user)){this.documentHelper.editRanges.get(user).push(editStart);}else{var collection=[];collection.push(editStart);this.documentHelper.editRanges.add(user,collection);}}this.selection.updateEditRangeCollection();};/**
     * @private
     * @returns {void}
     */Editor.prototype.updateRangeCollection=function(editStart,user){if(this.documentHelper.editRanges.length>0&&this.documentHelper.editRanges.containsKey(user)){this.documentHelper.editRanges.get(user).push(editStart);}else{var collection=[];collection.push(editStart);this.documentHelper.editRanges.add(user,collection);}};/**
     * @private
     * @returns {void}
     */Editor.prototype.removeUserRestrictions=function(user){if(!this.selection.checkSelectionIsAtEditRegion()){return;}this.selection.skipEditRangeRetrieval=true;var editStart=this.selection.getEditRangeStartElement();this.initHistory('RemoveEditRange');if(this.editorHistory){this.editorHistory.currentBaseHistoryInfo.setEditRangeInfo(editStart);this.editorHistory.updateHistory();}if(editStart.user===user||editStart.group===user){this.removeUserRestrictionsInternal(editStart,user);}this.selection.updateEditRangeCollection();this.fireContentChange();this.selection.skipEditRangeRetrieval=false;};/**
     * @private
     * @returns {void}
     */Editor.prototype.removeUserRestrictionsInternal=function(editStart,currentUser){var user=currentUser;if(sf.base.isNullOrUndefined(currentUser)){user=editStart.user===''?editStart.group:editStart.user;}var index=this.documentHelper.editRanges.get(user).indexOf(editStart);this.documentHelper.editRanges.get(user).splice(index,1);if(this.documentHelper.editRanges.get(user).length===0){this.documentHelper.editRanges.remove(user);}editStart.removeEditRangeMark();editStart.editRangeEnd.line.children.splice(editStart.editRangeEnd.indexInOwner,1);editStart.line.children.splice(editStart.indexInOwner,1);};/**
     * @private
     * @returns {void}
     */Editor.prototype.removeAllEditRestrictions=function(){this.selection.skipEditRangeRetrieval=true;var startPosition=this.selection.start;var endPosition=this.selection.end;var editStart=[];var keys=this.documentHelper.editRanges.keys;for(var j=0;j<keys.length;j++){editStart=this.documentHelper.editRanges.get(keys[j]);for(var i=0;i<editStart.length;i++){editStart[i].editRangeEnd.line.children.splice(editStart[i].editRangeEnd.indexInOwner,1);editStart[i].line.children.splice(editStart[i].indexInOwner,1);}}this.documentHelper.editRanges.clear();this.selection.updateEditRangeCollection();this.selection.start.setPositionInternal(startPosition);this.selection.end.setPositionInternal(endPosition);this.selection.editRegionHighlighters.clear();this.owner.viewer.updateScrollBars();this.selection.fireSelectionChanged(false);this.selection.skipEditRangeRetrieval=false;};/**
     * Insert specified form field at current selection.
     *
     * @param {FormFieldType} type Form field type
     * @returns {void}
     */Editor.prototype.insertFormField=function(type){if(sf.base.isNullOrUndefined(this.selection.start)||this.owner.enableHeaderAndFooter){return;}this.initHistory('InsertHyperlink');var isRemoved=true;if(!this.selection.isEmpty){isRemoved=this.removeSelectedContents(this.selection);}if(isRemoved){this.insertFormFieldInternal(type);}};Editor.prototype.insertFormFieldInternal=function(type){this.updateInsertPosition();var element=[];var temp=this.getCharacterFormat(this.selection);var format=new WCharacterFormat(undefined);format.copyFormat(temp);var fieldBegin=new FieldElementBox(0);fieldBegin.formFieldData=this.getFormFieldData(type);fieldBegin.characterFormat.copyFormat(format);element.push(fieldBegin);var bookmark=new BookmarkElementBox(0);bookmark.characterFormat.copyFormat(format);fieldBegin.formFieldData.name=this.getBookmarkName(type,'Insert',this.formFieldCounter);bookmark.name=fieldBegin.formFieldData.name;element.push(bookmark);var span=new TextElementBox();span.text=this.getFormFieldCode(type);element.push(span);var fieldSeparator=new FieldElementBox(2);element.push(fieldSeparator);var result=new TextElementBox();if(type==='CheckBox'){result.text=String.fromCharCode(9744);}else{result.text=this.documentHelper.textHelper.repeatChar(this.documentHelper.textHelper.getEnSpaceCharacter(),5);}result.characterFormat.copyFormat(format);element.push(result);var fieldEnd=new FieldElementBox(1);fieldEnd.characterFormat.copyFormat(format);element.push(fieldEnd);var bookmarkEnd=new BookmarkElementBox(1);bookmarkEnd.characterFormat.copyFormat(format);bookmarkEnd.name=fieldBegin.formFieldData.name;bookmarkEnd.reference=bookmark;bookmark.reference=bookmarkEnd;element.push(bookmarkEnd);this.insertElement(element);var paragraph=this.selection.start.paragraph;fieldEnd.linkFieldCharacter(this.documentHelper);if(this.documentHelper.fields.indexOf(fieldBegin)===-1){this.documentHelper.fields.push(fieldBegin);}if(this.documentHelper.formFields.indexOf(fieldBegin)===-1){this.documentHelper.formFields.push(fieldBegin);}var offset=bookmarkEnd.line.getOffset(bookmarkEnd,1);this.selection.selects(bookmarkEnd.line,offset,true);this.updateEndPosition();this.reLayout(this.selection,true);};Editor.prototype.getFormFieldData=function(type){switch(type){case'Text':return new TextFormField();case'CheckBox':return new CheckBoxFormField();case'DropDown':return new DropDownFormField();}};/**
     * @private
     * @returns {void}
     */Editor.prototype.setFormField=function(field,info){var type;var formField;if(!sf.base.isNullOrUndefined(info.format)){type='Text';formField=new TextFormField();}else if(!sf.base.isNullOrUndefined(info.sizeType)){type='CheckBox';formField=new CheckBoxFormField();}else if(!sf.base.isNullOrUndefined(info.dropdownItems)){type='DropDown';formField=new DropDownFormField();}if(!sf.base.isNullOrUndefined(type)&&!sf.base.isNullOrUndefined(formField)){formField.name=field.formFieldData.name;formField.copyFieldInfo(info);this.editFormField(type,formField);}};/**
     * @private
     * @returns {boolean}
     */Editor.prototype.editFormField=function(type,formData){var begin=this.selection.getCurrentFormField();if(sf.base.isNullOrUndefined(begin)||sf.base.isNullOrUndefined(begin.formFieldData)){return false;}this.initComplexHistory('FormField');var bookmarkStart;var bookmarkEnd;if(formData.name!==''){if(begin.formFieldData.name!==formData.name&&this.documentHelper.bookmarks.containsKey(formData.name)){this.deleteBookmark(formData.name);}bookmarkStart=new BookmarkElementBox(0);bookmarkStart.name=formData.name;bookmarkEnd=new BookmarkElementBox(1);bookmarkEnd.name=formData.name;bookmarkStart.reference=bookmarkEnd;bookmarkEnd.reference=bookmarkStart;}this.initHistory('InsertHyperlink');this.editHyperlinkInternal=sf.base.isNullOrUndefined(this.editorHistory)||this.editorHistory&&sf.base.isNullOrUndefined(this.editorHistory.currentBaseHistoryInfo);// Preserves the character format for hyperlink field.
var temp=begin.characterFormat.cloneFormat();var format=new WCharacterFormat();format.copyFormat(temp);var textFormat=begin.fieldSeparator.nextElement.characterFormat.cloneFormat();var currentOffset=begin.line.getOffset(begin,0);this.selection.start.setPositionParagraph(begin.line,currentOffset);var endElement=begin.fieldEnd;if(begin.nextNode&&begin.nextNode instanceof BookmarkElementBox){endElement=begin.nextNode.reference;}currentOffset=endElement.line.getOffset(endElement,1);this.selection.end.setPositionParagraph(endElement.line,currentOffset);this.skipFieldDeleteTracking=true;this.deleteSelectedContents(this.selection,false);this.skipFieldDeleteTracking=false;this.updateInsertPosition();var element=[];var fieldBegin=new FieldElementBox(0);fieldBegin.formFieldData=formData;element.push(fieldBegin);fieldBegin.characterFormat.copyFormat(format);if(!sf.base.isNullOrUndefined(bookmarkStart)){element.push(bookmarkStart);}var span=new TextElementBox();span.text=this.getFormFieldCode(type);element.push(span);var fieldSeparator=new FieldElementBox(2);fieldSeparator.characterFormat.copyFormat(format);element.push(fieldSeparator);span=new TextElementBox();span.characterFormat.copyFormat(textFormat);span.text=this.getDefaultText(formData);if(type==='CheckBox'){span.characterFormat.copyFormat(fieldBegin.characterFormat);if(formData.sizeType==='Exactly'){span.characterFormat.fontSize=formData.size;}}else if(formData instanceof TextFormField){if(formData.defaultValue!==''){if(formData.type==='Text'){span.text=HelperMethods.formatText(formData.format,formData.defaultValue);}else if(formData.type==='Number'){span.text=HelperMethods.formatNumber(formData.format,formData.defaultValue);}else{span.text=HelperMethods.formatDate(formData.format,formData.defaultValue);}}}element.push(span);var fieldEnd=new FieldElementBox(1);fieldEnd.characterFormat.copyFormat(format);element.push(fieldEnd);var lastElement=fieldEnd;if(!sf.base.isNullOrUndefined(bookmarkEnd)){lastElement=bookmarkEnd;element.push(bookmarkEnd);}this.insertElement(element);var paragraph=this.selection.start.paragraph;fieldEnd.linkFieldCharacter(this.documentHelper);if(this.documentHelper.fields.indexOf(fieldBegin)===-1){this.documentHelper.fields.push(fieldBegin);}var offset=lastElement.line.getOffset(lastElement,1);this.selection.selects(lastElement.line,offset,true);this.updateEndPosition();if(this.editorHistory&&this.editorHistory.currentBaseHistoryInfo){this.editorHistory.updateHistory();}if(this.editorHistory&&this.editorHistory.currentHistoryInfo){this.editorHistory.updateComplexHistory();}this.reLayout(this.selection,true);this.editHyperlinkInternal=false;this.nodes=[];return true;};Editor.prototype.getDefaultText=function(formField){var defaultText='';if(formField instanceof CheckBoxFormField){defaultText=formField.defaultValue?String.fromCharCode(9745):String.fromCharCode(9744);}else if(formField instanceof DropDownFormField){if(formField.dropdownItems.length>0){defaultText=formField.dropdownItems[0];}else{defaultText=this.documentHelper.textHelper.repeatChar(this.documentHelper.textHelper.getEnSpaceCharacter(),5);}}else if(formField instanceof TextFormField){if(formField.defaultValue!==''){defaultText=formField.defaultValue;}else{defaultText=this.documentHelper.textHelper.repeatChar(this.documentHelper.textHelper.getEnSpaceCharacter(),5);}}return defaultText;};Editor.prototype.getFormFieldCode=function(type){switch(type){case'Text':return'FORMTEXT';case'CheckBox':return'FORMCHECKBOX';case'DropDown':return'FORMDROPDOWN';}};/**
     * @private
     * @returns {void}
     */Editor.prototype.toggleCheckBoxFormField=function(field,reset,value){var formFieldData=field.formFieldData;if(formFieldData instanceof CheckBoxFormField&&formFieldData.enabled){this.initHistory('UpdateFormField');if(this.editorHistory){var currentValue=void 0;if(formFieldData instanceof CheckBoxFormField){currentValue=formFieldData.checked;}this.editorHistory.currentBaseHistoryInfo.setFormFieldInfo(field,currentValue);this.editorHistory.updateHistory();}if(reset){formFieldData.checked=value;}else{formFieldData.checked=!formFieldData.checked;}var separator=field.fieldSeparator;var checkBoxTextElement=separator.nextNode;if(formFieldData.checked){checkBoxTextElement.text=String.fromCharCode(9745);}else{checkBoxTextElement.text=String.fromCharCode(9744);}this.owner.documentHelper.layout.reLayoutParagraph(field.line.paragraph,0,0);this.reLayout(this.selection,false);}};/**
     * @private
     * @returns {void}
     */Editor.prototype.updateFormField=function(field,value,reset){var formFieldData=field.formFieldData;if(formFieldData){this.initHistory('UpdateFormField');if(this.editorHistory){var currentValue=void 0;if(formFieldData instanceof TextFormField){currentValue=field.resultText;}else if(formFieldData instanceof DropDownFormField){currentValue=formFieldData.selectedIndex;}this.editorHistory.currentBaseHistoryInfo.setFormFieldInfo(field,currentValue);this.editorHistory.updateHistory();}this.updateFormFieldInternal(field,formFieldData,value,reset);}};Editor.prototype.updateFormFieldInternal=function(field,formFieldData,value,reset){if(formFieldData instanceof TextFormField){if(value===''){if(reset){value=this.getDefaultText(formFieldData);}else{value=this.documentHelper.textHelper.repeatChar(this.documentHelper.textHelper.getEnSpaceCharacter(),5);}}var formattedText=value;var type=formFieldData.type;if(type==='Text'&&formFieldData.format!==''){formattedText=HelperMethods.formatText(formFieldData.format,value);}this.updateFormFieldResult(field,formattedText);}else if(formFieldData instanceof DropDownFormField){var text=formFieldData.dropdownItems[value];formFieldData.selectedIndex=value;this.updateFormFieldResult(field,text);}var endoffset=field.fieldEnd.line.getOffset(field.fieldEnd,1);var startPos=new TextPosition(this.owner);startPos.setPositionParagraph(field.fieldEnd.line,endoffset);//selects the field range
this.documentHelper.selection.selectRange(startPos,startPos);this.reLayout(this.selection,false);};Editor.prototype.updateFormFieldResult=function(field,value){var textElement=field.fieldSeparator.nextNode;while(!(textElement instanceof TextElementBox)){textElement=textElement.nextNode;if(textElement===field.fieldEnd){break;}}if(textElement instanceof TextElementBox){textElement.text=value;textElement=textElement.nextNode;do{var index=field.line.children.indexOf(textElement);if(textElement instanceof TextElementBox){textElement=textElement.nextNode;field.line.children.splice(index,1);}else{if(textElement===field.fieldEnd){break;}textElement=textElement.nextNode;}}while(textElement!==field.fieldEnd);}this.owner.documentHelper.layout.reLayoutParagraph(field.line.paragraph,0,0);var endoff=field.fieldEnd.line.getOffset(field.fieldEnd,1);var start=new TextPosition(this.owner);start.setPositionParagraph(field.fieldEnd.line,endoff);this.documentHelper.selection.selectRange(start,start);this.reLayout(this.selection,false);};Editor.prototype.checkBookmarkAvailability=function(name,action){var bookmarkCol=this.documentHelper.bookmarks;for(var i=0;i<bookmarkCol.length;i++){if(bookmarkCol.containsKey(name)){return false;}}return true;};Editor.prototype.getBookmarkName=function(type,action,count){var name;var available=false;while(available===false){name=type+count;available=this.checkBookmarkAvailability(name,action);count=count+1;}return name;};/**
     * @private
     * @returns {void}
     */Editor.prototype.applyFormTextFormat=function(formField){if(!sf.base.isNullOrUndefined(formField)){var text=this.getFormFieldText(formField);var currentValue=text;text=HelperMethods.formatText(formField.formFieldData.format,text);this.applyTextFormatInternal(formField,text);this.initHistory('FormTextFormat');if(this.editorHistory){this.editorHistory.currentBaseHistoryInfo.setFormFieldInfo(formField,currentValue);this.editorHistory.updateHistory();}}};// Inserts 5 space on Form Fill inline mode if length is 0
Editor.prototype.insertSpaceInFormField=function(){if(this.documentHelper.isInlineFormFillProtectedMode&&this.selection.isInlineFormFillMode()){var resultText=this.getFormFieldText();if(resultText.length===0||resultText==='\r'){this.insertTextInternal(this.documentHelper.textHelper.repeatChar(this.documentHelper.textHelper.getEnSpaceCharacter(),5),true);this.selection.selectTextElementStartOfField(this.selection.getCurrentFormField());}}};/**
     * @private
     * @returns {string}
     */Editor.prototype.getFormFieldText=function(formField){if(sf.base.isNullOrUndefined(formField)){formField=this.selection.getCurrentFormField();}var seperator=formField.fieldSeparator;var text=this.getNextRenderedWidgetText(seperator);return text;};Editor.prototype.getNextRenderedWidgetText=function(seperator){var text='';if(seperator instanceof FieldElementBox&&seperator.fieldType===2){var textElement=seperator;do{if(!sf.base.isNullOrUndefined(textElement)&&textElement instanceof TextElementBox){text=text+textElement.text;}if(sf.base.isNullOrUndefined(textElement.nextNode)){text+='\r';var nextBlock=textElement.paragraph.nextRenderedWidget;if(sf.base.isNullOrUndefined(nextBlock)){break;}if(nextBlock instanceof TableWidget){nextBlock=this.selection.getFirstParagraphBlock(nextBlock);}while(nextBlock.isEmpty()){text+='\r';nextBlock=nextBlock.nextRenderedWidget;}textElement=nextBlock.childWidgets[0].children[0];}else{textElement=textElement.nextNode;}}while(!(textElement instanceof FieldElementBox&&textElement.fieldType===1&&textElement===seperator.fieldEnd));}return text;};/**
     * @private
     * @returns {void}
     */Editor.prototype.applyTextFormatInternal=function(field,text){var textElement=field.fieldSeparator.nextElement;var start=0;text=text.replace(/\r/g,'');do{if(!sf.base.isNullOrUndefined(textElement)&&textElement instanceof TextElementBox){textElement.text=text.slice(start,start+textElement.text.length);start=start+textElement.length;}if(sf.base.isNullOrUndefined(textElement.nextElement)){if(!sf.base.isNullOrUndefined(textElement.line.nextLine)){textElement=textElement.line.nextLine.children[0];}else{this.documentHelper.layout.layoutBodyWidgetCollection(textElement.paragraph.index,textElement.paragraph.bodyWidget,textElement.paragraph,true);var nextBlock=textElement.paragraph.nextRenderedWidget;if(sf.base.isNullOrUndefined(nextBlock)){break;}if(nextBlock instanceof TableWidget){nextBlock=this.selection.getFirstParagraphBlock(nextBlock);}while(nextBlock.isEmpty()){nextBlock=nextBlock.nextRenderedWidget;}textElement=nextBlock.childWidgets[0].children[0];}}else{textElement=textElement.nextElement;}}while(!(textElement instanceof FieldElementBox&&textElement.fieldType===1&&textElement.fieldBegin.formFieldData instanceof TextFormField));this.documentHelper.layout.layoutBodyWidgetCollection(textElement.paragraph.index,textElement.paragraph.bodyWidget,textElement.paragraph,true);this.selection.isFormatUpdated=true;this.reLayout(this.selection,false);this.selection.isFormatUpdated=false;};Editor.prototype.constructCommentInitial=function(authorName){var splittedName=authorName.split(' ');var initials='';for(var i=0;i<splittedName.length;i++){if(splittedName[i].length>0&&splittedName[i]!==''){initials+=splittedName[i][0];}}return initials;};/**
     * Insert Footnote at current selection
     *
     * @returns {void}
     */Editor.prototype.insertFootnote=function(){if(this.selection.isinFootnote||this.selection.isinEndnote){return;}var footnote=new FootnoteElementBox();footnote.characterFormat.baselineAlignment='Superscript';footnote.footnoteType='Footnote';footnote.text='s';var paragraph=new ParagraphWidget();var lineWidget=new LineWidget(paragraph);var text=new TextElementBox();text.characterFormat.baselineAlignment='Superscript';text.line=lineWidget;text.text='?';lineWidget.children.push(text);var text1=new TextElementBox();text1.text=' ';text1.line=lineWidget;lineWidget.children.push(text1);paragraph.childWidgets.push(lineWidget);paragraph.footNoteReference=footnote;footnote.blocks.push(paragraph);if(!this.selection.isEmpty){this.selection.handleRightKey();}this.initInsertInline(footnote);// this.documentHelper.layout.isLayoutWhole = true;
// this.layoutWholeDocument();
// this.documentHelper.layout.isLayoutWhole = false;
var footPara;if(footnote.paragraph.bodyWidget.page.footnoteWidget){for(var i=0;i<footnote.paragraph.bodyWidget.page.footnoteWidget.childWidgets.length;i++){if(footnote.paragraph.bodyWidget.page.footnoteWidget.childWidgets[i].footNoteReference===footnote){footPara=footnote.paragraph.bodyWidget.page.footnoteWidget.childWidgets[i];}}}this.selection.start.setPositionForLineWidget(footPara.childWidgets[0],text1.line.getOffset(text1,footnote.text.length));this.selection.end.setPositionInternal(this.selection.start);// this.selection.fireSelectionChanged(true);
this.updateFootNoteIndex();this.reLayout(this.selection,false);this.separator('footnote');this.continuationSeparator('footnote');};Editor.prototype.updateFootnoteCollection=function(footnote){if(this.documentHelper.footnoteCollection.indexOf(footnote)===-1){var isInserted=false;if(this.documentHelper.footnoteCollection.length>0){var currentStart=this.selection.getElementPosition(footnote).startPosition;for(var i=0;i<this.documentHelper.footnoteCollection.length;i++){var paraIndex=this.selection.getElementPosition(this.documentHelper.footnoteCollection[i]).startPosition;if(currentStart.isExistBefore(paraIndex)){isInserted=true;this.documentHelper.footnoteCollection.splice(i,0,footnote);break;}}}if(!isInserted){this.documentHelper.footnoteCollection.push(footnote);}// this.viewer.updateScrollBars();
}};// Footnote implementation ends
/**
     * Insert Endnote at current selection
     *
     * @returns {void}
     */Editor.prototype.insertEndnote=function(){if(this.selection.isinFootnote||this.selection.isinEndnote){return;}this.documentHelper.layout.isEndnoteContentChanged=true;var endnote=new FootnoteElementBox();endnote.characterFormat.baselineAlignment='Superscript';endnote.footnoteType='Endnote';endnote.text='s';var paragraph=new ParagraphWidget();var lineWidget=new LineWidget(paragraph);var footText=new TextElementBox();footText.characterFormat.baselineAlignment='Superscript';footText.line=lineWidget;footText.text='?';lineWidget.children.push(footText);var followText=new TextElementBox();followText.text=' ';followText.line=lineWidget;lineWidget.children.push(followText);paragraph.childWidgets.push(lineWidget);paragraph.footNoteReference=endnote;endnote.blocks.push(paragraph);if(!this.selection.isEmpty){this.selection.handleRightKey();}this.initInsertInline(endnote);// this.documentHelper.layout.isLayoutWhole = true;
// this.layoutWholeDocument();
// this.documentHelper.layout.isLayoutWhole = false;
var lastpage=this.documentHelper.pages.length;var bodyWidget=this.documentHelper.pages[lastpage-1].bodyWidgets[0];var footPara;if(bodyWidget.page.endnoteWidget){for(var i=0;i<bodyWidget.page.endnoteWidget.childWidgets.length;i++){if(bodyWidget.page.endnoteWidget.childWidgets[i].footNoteReference===endnote){footPara=bodyWidget.page.endnoteWidget.childWidgets[i];}}}this.selection.start.setPositionForLineWidget(footPara.childWidgets[0],footText.line.getOffset(followText,endnote.text.length));this.selection.end.setPositionInternal(this.selection.start);this.reLayout(this.selection,false);this.separator('endnote');this.continuationSeparator('endnote');this.documentHelper.layout.isEndnoteContentChanged=false;};Editor.prototype.updateEndnoteCollection=function(endnote){if(this.documentHelper.endnoteCollection.indexOf(endnote)===-1){var isInserted=false;if(this.documentHelper.endnoteCollection.length>0){var currentStart=this.selection.getElementPosition(endnote).startPosition;for(var i=0;i<this.documentHelper.endnoteCollection.length;i++){var paraIndex=this.selection.getElementPosition(this.documentHelper.endnoteCollection[i]).startPosition;if(currentStart.isExistBefore(paraIndex)){isInserted=true;this.documentHelper.endnoteCollection.splice(i,0,endnote);break;}}}if(!isInserted){this.documentHelper.endnoteCollection.push(endnote);}var lastpage=this.documentHelper.pages.length;if(this.documentHelper.endnoteCollection.length>0){var positionchanged=false;// this.documentHelper.layout.isFootnoteContentChanged = true;
var foot=void 0;var endnoteWidget=void 0;var footIndex=this.documentHelper.endnoteCollection.indexOf(endnote);var insertIndex=1;var height=0;var isCreated=void 0;var bodyWidget=this.documentHelper.pages[lastpage-1].bodyWidgets[0];if(bodyWidget.page.endnoteWidget){for(var j=0;j<bodyWidget.page.endnoteWidget.childWidgets.length;j++){var currentIndex=this.documentHelper.endnoteCollection.indexOf(bodyWidget.page.endnoteWidget.childWidgets[j].footNoteReference);if(currentIndex>footIndex){if(currentIndex-footIndex===1){insertIndex=j;positionchanged=true;break;}}}}// endnote.isLayout = true;
foot=endnote;//this.documentHelper.endnoteCollection[i];
if(bodyWidget.page.endnoteWidget instanceof FootNoteWidget&&bodyWidget.page.endnoteWidget.footNoteType==='Endnote'){endnoteWidget=bodyWidget.page.endnoteWidget;}else{isCreated=true;endnoteWidget=new FootNoteWidget();endnoteWidget.footNoteType='Endnote';endnoteWidget.page=bodyWidget.page;var newParagraph=new ParagraphWidget();newParagraph.characterFormat=new WCharacterFormat();newParagraph.paragraphFormat=new WParagraphFormat();newParagraph.index=0;var lineWidget=new LineWidget(newParagraph);newParagraph.childWidgets.push(lineWidget);endnoteWidget.childWidgets.push(newParagraph);}for(var j=0;j<foot.blocks.length;j++){var block=foot.blocks[j];}if(positionchanged){endnoteWidget.childWidgets.splice(insertIndex,0,foot.blocks[0]);}else{endnoteWidget.childWidgets.push(foot.blocks[0]);}insertIndex++;if(isCreated){bodyWidget.page.endnoteWidget=endnoteWidget;}// endNote.containerWidget = bodyWidget;
endnoteWidget.height+=height;//         }
// this.documentHelper.layout.layoutfootNote(endnoteWidget);
//this.layoutfootNote(endNote);
}// this.viewer.updateScrollBars();
}};Editor.prototype.separator=function(type){//var block = new page_1.block;
var paragraph=new ParagraphWidget();var lineWidget=new LineWidget(paragraph);var text=new TextElementBox();text.characterFormat.fontColor='#00000000';text.line=lineWidget;text.text="\x03";lineWidget.children.push(text);paragraph.childWidgets.push(lineWidget);if(type==='footnote'&&this.documentHelper.footnotes.separator.length<1){this.documentHelper.footnotes.separator.push(paragraph);}else if(type==='endnote'&&this.documentHelper.endnotes.separator.length<1){this.documentHelper.endnotes.separator.push(paragraph);}};Editor.prototype.continuationSeparator=function(type){//var block = new page_1.block;
var paragraph=new ParagraphWidget();var lineWidget=new LineWidget(paragraph);var text=new TextElementBox();text.characterFormat.fontColor='#00000000';text.line=lineWidget;text.text="\x04";lineWidget.children.push(text);paragraph.childWidgets.push(lineWidget);if(type==='footnote'&&this.documentHelper.footnotes.continuationSeparator.length<1){this.documentHelper.footnotes.continuationSeparator.push(paragraph);}else if(type==='endnote'&&this.documentHelper.endnotes.continuationSeparator.length<1){this.documentHelper.endnotes.continuationSeparator.push(paragraph);}};Editor.prototype.updateFootNoteIndex=function(){var footNoteCollec=this.documentHelper.footnoteCollection;for(var i=0;i<footNoteCollec.length;i++){footNoteCollec[i].text=(i+1).toString();footNoteCollec[i].blocks[0].childWidgets[0].children[0].text=(i+1).toString();}};/**
     * @private
     */Editor.prototype.onParagraphFormat=function(paragraphFormat){var selection=this.documentHelper.selection;var isListBidi=paragraphFormat.bidi&&selection.paragraphFormat.listId!==-1;if(!isListBidi){this.documentHelper.layout.isBidiReLayout=true;}this.setPreviousBlockToLayout();this.initHistory('ParagraphFormat');this.documentHelper.owner.isShiftingEnabled=true;if(this.documentHelper.selection.isEmpty){this.applyParaFormatProperty(selection.start.paragraph,undefined,paragraphFormat,false);this.layoutItemBlock(selection.start.paragraph,false);}else{this.updateSelectionParagraphFormatting('ParagraphFormat',paragraphFormat,false);}this.reLayout(selection);if(!isListBidi){this.documentHelper.layout.isBidiReLayout=false;}};return Editor;}();/**
 * Image resizer implementation.
 */var ImageResizer=/** @class */function(){/**
     * Constructor for image resizer module.
     *
     * @param {DocumentEditor} node - Specfies the document editor
     * @param {DocumentHelper} documentHelper - Specified the document helper
     * @private
     */function ImageResizer(node,documentHelper){/**
         * @private
         */this.resizeContainerDiv=undefined;/**
         * @private
         */this.topLeftRect=undefined;/**
         * @private
         */this.topMiddleRect=undefined;/**
         * @private
         */this.topRightRect=undefined;/**
         * @private
         */this.bottomLeftRect=undefined;/**
         * @private
         */this.bottomMiddleRect=undefined;/**
         * @private
         */this.bottomRightRect=undefined;/**
         * @private
         */this.leftMiddleRect=undefined;/**
         * @private
         */this.rightMiddleRect=undefined;/**
         * @private
         */this.topLeftRectParent=undefined;/**
         * @private
         */this.topMiddleRectParent=undefined;/**
         * @private
         */this.topRightRectParent=undefined;/**
         * @private
         */this.bottomLeftRectParent=undefined;/**
         * @private
         */this.bottomMiddleRectParent=undefined;/**
         * @private
         */this.bottomRightRectParent=undefined;/**
         * @private
         */this.leftMiddleRectParent=undefined;/**
         * @private
         */this.rightMiddleRectParent=undefined;/**
         * @private
         */this.resizeMarkSizeIn=7;/**
         * @private
         */this.selectedImageWidget=undefined;/**
         * @private
         */this.baseHistoryInfo=undefined;/**
         * @private
         */this.isImageResizing=false;/**
         * @private
         */this.isImageResizerVisible=false;/**
         * @private
         */this.isImageMoveToNextPage=false;/**
         * @private
         */this.selectedResizeElement=undefined;/**
         * @private
         */this.topValue=undefined;/**
         * @private
         */this.leftValue=undefined;this.owner=node;this.selectedImageWidget=new Dictionary();this.documentHelper=documentHelper;this.imageResizerPoints=new ImageResizingPoints();if(sf.base.isNullOrUndefined(this.imageResizerDiv)&&this.viewer&&this.documentHelper.pageContainer){this.initializeImageResizer();}}Object.defineProperty(ImageResizer.prototype,"currentImageElementBox",{/**
         * Gets or Sets the current image element box.
         *
         * @private
         * @returns {ImageElementBox | ShapeElementBox} - Returns the image element.
         */get:function get(){return this.currentImageElementBoxIn;},/**
         * @param {ImageElementBox | ShapeElementBox} value - Specifies the current element box.
         */set:function set(value){this.currentImageElementBoxIn=value;},enumerable:true,configurable:true});Object.defineProperty(ImageResizer.prototype,"resizeMarkSize",{/**
         * Gets or Sets the resize mark size.
         *
         * @private
         * @returns {number} - Returns resize mark size
         */get:function get(){return this.resizeMarkSizeIn;},/**
         * @private
         * @param {number} value - Specifies resize mark size.
         */set:function set(value){this.resizeMarkSizeIn=value;},enumerable:true,configurable:true});Object.defineProperty(ImageResizer.prototype,"isShapeResize",{/**
         * @returns {boolean} - Returns the shape size.
         */get:function get(){if(this.currentImageElementBox instanceof ShapeElementBox){return true;}return false;},enumerable:true,configurable:true});Object.defineProperty(ImageResizer.prototype,"viewer",{get:function get(){return this.owner.viewer;},enumerable:true,configurable:true});ImageResizer.prototype.getModuleName=function(){return'ImageResizer';};//Image Resizing Methods
/**
     * Sets image resizer position.
     *
     * @param {number} x - Specifies for image resizer left value.
     * @param {number} y - Specifies for image resizer top value.
     * @param {number} width - Specifies for image resizer width value.
     * @param {number} height - Specifies for image resizer height value.
     * @private
     * @returns {void}
     */ImageResizer.prototype.setImageResizerPositions=function(x,y,width,height){this.imageResizerDivElement.style.top=y.toString()+'px';this.imageResizerDivElement.style.left=x.toString()+'px';this.imageResizerDivElement.style.borderWidth='0px';this.imageResizerDivElement.style.height=height+'px';if(this.owner.viewer instanceof WebLayoutViewer){this.imageResizerDivElement.style.width=width-x-this.documentHelper.scrollbarWidth+'px';}else{this.imageResizerDivElement.style.width=width+'px';}this.imageResizerDivElement.style.backgroundColor='transparent';this.imageResizerDivElement.style.overflow='hidden';this.imageResizerDivElement.style.position='absolute';};/**
     * Creates image resizer DOM element.
     *
     * @private
     * @returns {void}
     */ImageResizer.prototype.initializeImageResizer=function(){this.imageResizerDivElement=document.createElement('div');this.imageResizerDivElement.style.zIndex='1';this.imageResizerDivElement.style.display='none';this.documentHelper.pageContainer.appendChild(this.imageResizerDivElement);};/**
     * Position an image resizer
     *
     * @private
     * @param {ImageElementBox} elementBox - Specifies the image position.
     * @returns {void}
     */ImageResizer.prototype.positionImageResizer=function(elementBox){this.selectedImageWidget.clear();// Initializes the image resizer on demand, i.e at the time of selecting an image for the first time.
var resizeDiv;if(!sf.base.isNullOrUndefined(this.documentHelper.currentPage)){resizeDiv=this.imageResizerDivElement;}if(!sf.base.isNullOrUndefined(resizeDiv)&&!resizeDiv.contains(this.imageResizerDiv)){this.imageResizerDiv=this.initResizeMarks(resizeDiv,this);}this.imageResizerDiv.style.width=elementBox.width+'px';this.imageResizerDiv.style.height=elementBox.height+'px';this.currentImageElementBox=elementBox;var lineWidget=elementBox.line;var top;var left;if(elementBox instanceof ImageElementBox&&elementBox.textWrappingStyle!=='Inline'){top=elementBox.y;left=elementBox.x;}else{top=this.documentHelper.selection.getTop(lineWidget)+elementBox.margin.top;left=this.documentHelper.selection.getLeftInternal(lineWidget,elementBox,0);}var page=this.documentHelper.selection.getPage(lineWidget.paragraph);this.currentPage=page;var x=0;//let y: number = 0;
if(!sf.base.isNullOrUndefined(resizeDiv)){if(this.owner.viewer instanceof WebLayoutViewer){this.imageResizerDivElement.style.width=page.boundingRectangle.width-page.boundingRectangle.x-left-this.documentHelper.scrollbarWidth+'px';}this.imageResizerDivElement.style.display='block';if(this.owner.viewer instanceof WebLayoutViewer){resizeDiv.style.width=page.boundingRectangle.width-this.documentHelper.scrollbarWidth-page.boundingRectangle.x-left+'px';}else{resizeDiv.style.width=page.boundingRectangle.width+'px';}resizeDiv.style.height=page.boundingRectangle.height+'px';resizeDiv.style.left=page.boundingRectangle.x+'px';resizeDiv.style.top=page.boundingRectangle.y+'px';resizeDiv.style.borderWidth='0px';resizeDiv.style.backgroundColor='transparent';resizeDiv.style.overflow='hidden';resizeDiv.style.position='absolute';}var horizontalWidth=0;var pageWidth=this.documentHelper.getPageWidth(page);//const pagelayout: PageLayoutViewer = this.viewer as PageLayoutViewer;
horizontalWidth=parseFloat(this.imageResizerDivElement.style.width);x=(this.documentHelper.visibleBounds.width-horizontalWidth*this.documentHelper.zoomFactor)/2;if(x<30){x=30;}if(pageWidth<horizontalWidth){x+=(horizontalWidth-pageWidth)*this.documentHelper.zoomFactor/2;}var currentPageDiv=this.imageResizerDivElement;var currentPageDivWidth=parseFloat(currentPageDiv.style.width);var currentPageDivHeight=parseFloat(currentPageDiv.style.height);var imageResizerDivWidth=parseFloat(this.imageResizerDiv.style.width);var imageResizerDivHeight=parseFloat(this.imageResizerDiv.style.height);var margin=(this.resizeMarkSize-1)/2;var width=imageResizerDivWidth+2*margin;var height=imageResizerDivHeight+2*margin;if(width>(currentPageDivWidth-left)*this.documentHelper.zoomFactor+margin){width=(currentPageDivWidth-left)*this.documentHelper.zoomFactor;}if(height>(currentPageDivHeight-top)*this.documentHelper.zoomFactor+margin){height=(currentPageDivHeight-top)*this.documentHelper.zoomFactor;}// if (width < imageResizerDivHeight + margin || height < imageResizerDivHeight + margin) {
// }
this.imageResizerDivElement.style.width=parseInt(this.imageResizerDivElement.style.width.replace('px',''),10)*this.documentHelper.zoomFactor+'px';this.imageResizerDivElement.style.height=parseInt(this.imageResizerDivElement.style.height.replace('px',''),10)*this.documentHelper.zoomFactor+'px';height=this.documentHelper.render.getScaledValue(elementBox.height);width=this.documentHelper.render.getScaledValue(elementBox.width);if(elementBox instanceof ImageElementBox){left=this.documentHelper.render.getScaledValue(left);top=this.documentHelper.render.getScaledValue(top);}else{left=elementBox.x*this.documentHelper.zoomFactor;top=elementBox.y*this.documentHelper.zoomFactor;}this.setImageResizerPosition(left,top,width,height,this);if(this.owner.selection.isInShape){this.resizeContainerDiv.style.borderStyle='dashed';}else{this.resizeContainerDiv.style.borderStyle='solid';}if(!this.selectedImageWidget.containsKey(lineWidget)){var selectedImageInfo=new SelectedImageInfo(elementBox.height,elementBox.width);this.selectedImageWidget.add(lineWidget,selectedImageInfo);}};/**
     * Shows the image resizer.
     *
     * @private
     * @returns {void}
     */ImageResizer.prototype.showImageResizer=function(){if(!sf.base.isNullOrUndefined(this.imageResizerDivElement)){this.imageResizerDivElement.style.display='';}if(!sf.base.isNullOrUndefined(this.resizeContainerDiv)){this.resizeContainerDiv.style.display='';}if(!sf.base.isNullOrUndefined(this.bottomLeftRect)){this.bottomLeftRect.style.display='';this.bottomLeftRectParent.style.display='';}if(!sf.base.isNullOrUndefined(this.bottomRightRect)){this.bottomRightRect.style.display='';this.bottomRightRectParent.style.display='';}if(!sf.base.isNullOrUndefined(this.bottomMiddleRect)){this.bottomMiddleRect.style.display='';this.bottomMiddleRectParent.style.display='';}if(!sf.base.isNullOrUndefined(this.rightMiddleRect)){this.rightMiddleRect.style.display='';this.rightMiddleRectParent.style.display='';}if(!sf.base.isNullOrUndefined(this.topRightRect)){this.topRightRect.style.display='';this.topRightRectParent.style.display='';}if(!sf.base.isNullOrUndefined(this.topLeftRect)){this.topLeftRect.style.display='';this.topLeftRectParent.style.display='';}if(!sf.base.isNullOrUndefined(this.leftMiddleRect)){this.leftMiddleRect.style.display='';this.leftMiddleRectParent.style.display='';}if(!sf.base.isNullOrUndefined(this.topMiddleRect)){this.topMiddleRect.style.display='';this.topMiddleRectParent.style.display='';}this.isImageResizerVisible=true;};/**
     * Hides the image resizer.
     *
     * @private
     * @returns {void}
     */ImageResizer.prototype.hideImageResizer=function(){if(!sf.base.isNullOrUndefined(this.imageResizerDivElement)){this.imageResizerDivElement.style.display='none';}if(!sf.base.isNullOrUndefined(this.resizeContainerDiv)){this.resizeContainerDiv.style.display='none';}if(!sf.base.isNullOrUndefined(this.bottomLeftRect)){this.bottomLeftRect.style.display='none';this.bottomLeftRectParent.style.display='none';}if(!sf.base.isNullOrUndefined(this.bottomRightRect)){this.bottomRightRect.style.display='none';this.bottomRightRectParent.style.display='none';}if(!sf.base.isNullOrUndefined(this.bottomMiddleRect)){this.bottomMiddleRect.style.display='none';this.bottomMiddleRectParent.style.display='none';}if(!sf.base.isNullOrUndefined(this.rightMiddleRect)){this.rightMiddleRect.style.display='none';this.rightMiddleRectParent.style.display='none';}if(!sf.base.isNullOrUndefined(this.topRightRect)){this.topRightRect.style.display='none';this.topRightRectParent.style.display='none';}if(!sf.base.isNullOrUndefined(this.topLeftRect)){this.topLeftRect.style.display='none';this.topLeftRectParent.style.display='none';}if(!sf.base.isNullOrUndefined(this.leftMiddleRect)){this.leftMiddleRect.style.display='none';this.leftMiddleRectParent.style.display='none';}if(!sf.base.isNullOrUndefined(this.topMiddleRect)){this.topMiddleRect.style.display='none';this.topMiddleRectParent.style.display='none';}this.isImageResizerVisible=false;this.currentPage=undefined;};/**
     * Initialize the resize marks.
     *
     * @private
     * @param {HTMLElement} resizeDiv - Specifies to appending resizer container div element.
     * @param {ImageResizer} imageResizer - Specifies to creating div element of each position.
     * @returns {void}
     */ /* eslint-disable  */ImageResizer.prototype.initResizeMarks=function(resizeDiv,imageResizer){this.initResizeContainerDiv(imageResizer);resizeDiv.appendChild(imageResizer.resizeContainerDiv);imageResizer.topRightRectParent=document.createElement('div');imageResizer.topRightRectParent.style.cursor='ne-resize';imageResizer.topRightRectParent.id=this.documentHelper.owner.containerId+'_TopRightRectParent';this.applyProperties(imageResizer.topRightRectParent);imageResizer.topRightRectParent.style.width=!this.documentHelper.isTouchInput?'14px':'30px';imageResizer.topRightRectParent.style.height=!this.documentHelper.isTouchInput?'14px':'30px';imageResizer.topRightRectParent.style.opacity='-1';resizeDiv.appendChild(imageResizer.topRightRectParent);imageResizer.topRightRect=document.createElement('div');imageResizer.topRightRect.id=this.documentHelper.owner.containerId+'_TopRightRect';imageResizer.topRightRect.style.cursor='ne-resize';this.applyProperties(imageResizer.topRightRect);resizeDiv.appendChild(imageResizer.topRightRect);imageResizer.topLeftRectParent=document.createElement('div');imageResizer.topLeftRectParent.style.cursor='nw-resize';imageResizer.topLeftRectParent.id=this.documentHelper.owner.containerId+'_TopLeftRectParent';this.applyProperties(imageResizer.topLeftRectParent);imageResizer.topLeftRectParent.style.width=!this.documentHelper.isTouchInput?'14px':'30px';imageResizer.topLeftRectParent.style.height=!this.documentHelper.isTouchInput?'14px':'30px';imageResizer.topLeftRectParent.style.opacity='-1';resizeDiv.appendChild(imageResizer.topLeftRectParent);imageResizer.topLeftRect=document.createElement('div');imageResizer.topLeftRect.id=this.documentHelper.owner.containerId+'_TopLeftRect';imageResizer.topLeftRect.style.cursor='nw-resize';this.applyProperties(imageResizer.topLeftRect);resizeDiv.appendChild(imageResizer.topLeftRect);imageResizer.topMiddleRectParent=document.createElement('div');imageResizer.topMiddleRectParent.style.cursor='n-resize';imageResizer.topMiddleRectParent.id=this.documentHelper.owner.containerId+'_TopMiddleRectParent';this.applyProperties(imageResizer.topMiddleRectParent);imageResizer.topMiddleRectParent.style.width=!this.documentHelper.isTouchInput?'14px':'30px';imageResizer.topMiddleRectParent.style.height=!this.documentHelper.isTouchInput?'14px':'30px';imageResizer.topMiddleRectParent.style.opacity='-1';resizeDiv.appendChild(imageResizer.topMiddleRectParent);imageResizer.topMiddleRect=document.createElement('div');imageResizer.topMiddleRect.id=this.documentHelper.owner.containerId+'_TopMiddleRect';imageResizer.topMiddleRect.style.cursor='n-resize';this.applyProperties(imageResizer.topMiddleRect);resizeDiv.appendChild(imageResizer.topMiddleRect);imageResizer.bottomRightRectParent=document.createElement('div');imageResizer.bottomRightRectParent.style.cursor='se-resize';imageResizer.bottomRightRectParent.id=this.documentHelper.owner.containerId+'_BottomRightRectParent';this.applyProperties(imageResizer.bottomRightRectParent);imageResizer.bottomRightRectParent.style.width=!this.documentHelper.isTouchInput?'14px':'30px';imageResizer.bottomRightRectParent.style.height=!this.documentHelper.isTouchInput?'14px':'30px';imageResizer.bottomRightRectParent.style.opacity='-1';resizeDiv.appendChild(imageResizer.bottomRightRectParent);imageResizer.bottomRightRect=document.createElement('div');imageResizer.bottomRightRect.id=this.documentHelper.owner.containerId+'_BottomRightRect';imageResizer.bottomRightRect.style.cursor='se-resize';this.applyProperties(imageResizer.bottomRightRect);resizeDiv.appendChild(imageResizer.bottomRightRect);imageResizer.bottomLeftRectParent=document.createElement('div');imageResizer.bottomLeftRectParent.style.cursor='sw-resize';imageResizer.bottomLeftRectParent.id=this.documentHelper.owner.containerId+'_BottomLeftRectParent';this.applyProperties(imageResizer.bottomLeftRectParent);imageResizer.bottomLeftRectParent.style.width=!this.documentHelper.isTouchInput?'14px':'30px';imageResizer.bottomLeftRectParent.style.height=!this.documentHelper.isTouchInput?'14px':'30px';imageResizer.bottomLeftRectParent.style.opacity='-1';resizeDiv.appendChild(imageResizer.bottomLeftRectParent);imageResizer.bottomLeftRect=document.createElement('div');imageResizer.bottomLeftRect.id=this.documentHelper.owner.containerId+'_BottomLeftRect';imageResizer.bottomLeftRect.style.cursor='sw-resize';this.applyProperties(imageResizer.bottomLeftRect);resizeDiv.appendChild(imageResizer.bottomLeftRect);imageResizer.bottomMiddleRectParent=document.createElement('div');imageResizer.bottomMiddleRectParent.style.cursor='s-resize';imageResizer.bottomMiddleRectParent.id=this.documentHelper.owner.containerId+'_BottomMiddleRectParent';this.applyProperties(imageResizer.bottomMiddleRectParent);imageResizer.bottomMiddleRectParent.style.width=!this.documentHelper.isTouchInput?'14px':'30px';imageResizer.bottomMiddleRectParent.style.height=!this.documentHelper.isTouchInput?'14px':'30px';imageResizer.bottomMiddleRectParent.style.opacity='-1';resizeDiv.appendChild(imageResizer.bottomMiddleRectParent);imageResizer.bottomMiddleRect=document.createElement('div');imageResizer.bottomMiddleRect.id=this.documentHelper.owner.containerId+'_BottomMiddleRect';imageResizer.bottomMiddleRect.style.cursor='s-resize';this.applyProperties(imageResizer.bottomMiddleRect);resizeDiv.appendChild(imageResizer.bottomMiddleRect);imageResizer.rightMiddleRectParent=document.createElement('div');imageResizer.rightMiddleRectParent.style.cursor='e-resize';imageResizer.rightMiddleRectParent.id=this.documentHelper.owner.containerId+'_RightMiddleRectParent';this.applyProperties(imageResizer.rightMiddleRectParent);imageResizer.rightMiddleRectParent.style.width=!this.documentHelper.isTouchInput?'14px':'30px';imageResizer.rightMiddleRectParent.style.height=!this.documentHelper.isTouchInput?'14px':'30px';imageResizer.rightMiddleRectParent.style.opacity='-1';resizeDiv.appendChild(imageResizer.rightMiddleRectParent);imageResizer.rightMiddleRect=document.createElement('div');imageResizer.rightMiddleRect.id=this.documentHelper.owner.containerId+'_RightMiddleRect';imageResizer.rightMiddleRect.style.cursor='e-resize';this.applyProperties(imageResizer.rightMiddleRect);resizeDiv.appendChild(imageResizer.rightMiddleRect);imageResizer.leftMiddleRectParent=document.createElement('div');imageResizer.leftMiddleRectParent.style.cursor='w-resize';imageResizer.leftMiddleRectParent.id=this.documentHelper.owner.containerId+'_LeftMiddleRectParent';this.applyProperties(imageResizer.leftMiddleRectParent);imageResizer.leftMiddleRectParent.style.width=!this.documentHelper.isTouchInput?'14px':'30px';imageResizer.leftMiddleRectParent.style.height=!this.documentHelper.isTouchInput?'14px':'30px';imageResizer.leftMiddleRectParent.style.opacity='-1';resizeDiv.appendChild(imageResizer.leftMiddleRectParent);imageResizer.leftMiddleRect=document.createElement('div');imageResizer.leftMiddleRect.id=this.documentHelper.owner.containerId+'_LeftMiddleRect';imageResizer.leftMiddleRect.style.cursor='w-resize';this.applyProperties(imageResizer.leftMiddleRect);resizeDiv.appendChild(imageResizer.leftMiddleRect);return imageResizer.resizeContainerDiv;};/**
     * Sets the image resizer position.
     *
     * @private
     * @param {number} left - Specifies for image resizer left value.
     * @param {number} top - Specifies for image resizer top value.
     * @param {number} width - Specifies for image resizer width value.
     * @param {number} height - Specifies for image resizer height value.
     * @param {ImageResizer} imageResizer - Specifies for image resizer.
     * @returns {void}
     */ImageResizer.prototype.setImageResizerPosition=function(left,top,width,height,imageResizer){//Positions Updating For Image Resize Div
imageResizer.resizeContainerDiv.style.width=width+'px';imageResizer.resizeContainerDiv.style.height=height+'px';imageResizer.resizeContainerDiv.style.left=left+'px';imageResizer.resizeContainerDiv.style.top=top+'px';//Positions Updating For Image Resizing Points
imageResizer.topRightRect.style.left=left+width-5+'px';imageResizer.topRightRect.style.top=top-4+'px';imageResizer.topLeftRect.style.left=left-5+'px';imageResizer.topLeftRect.style.top=top-4+'px';imageResizer.topMiddleRect.style.left=parseFloat(imageResizer.topLeftRect.style.left)+width/2-4+'px';imageResizer.topMiddleRect.style.top=top-4+'px';imageResizer.bottomRightRect.style.left=imageResizer.topRightRect.style.left;imageResizer.bottomRightRect.style.top=parseFloat(imageResizer.topRightRect.style.top)+height+'px';imageResizer.bottomLeftRect.style.left=imageResizer.topLeftRect.style.left;imageResizer.bottomLeftRect.style.top=parseFloat(imageResizer.topLeftRect.style.top)+height+'px';imageResizer.bottomMiddleRect.style.left=imageResizer.topMiddleRect.style.left;imageResizer.bottomMiddleRect.style.top=parseFloat(imageResizer.topMiddleRect.style.top)+height+'px';imageResizer.rightMiddleRect.style.left=left+width-4+'px';imageResizer.rightMiddleRect.style.top=parseFloat(imageResizer.topRightRect.style.top)+height/2+'px';imageResizer.leftMiddleRect.style.left=imageResizer.topLeftRect.style.left;imageResizer.leftMiddleRect.style.top=parseFloat(imageResizer.topLeftRect.style.top)+height/2+'px';imageResizer.topRightRectParent.style.left=!this.documentHelper.isTouchInput?left+width-8+'px':left+width-15+'px';imageResizer.topRightRectParent.style.top=!this.documentHelper.isTouchInput?top-7+'px':top-15+'px';imageResizer.topLeftRectParent.style.left=!this.documentHelper.isTouchInput?left-8+'px':left-15+'px';imageResizer.topLeftRectParent.style.top=!this.documentHelper.isTouchInput?top-7+'px':top-15+'px';imageResizer.topMiddleRectParent.style.left=parseFloat(imageResizer.topLeftRectParent.style.left)+width/2-4+'px';imageResizer.topMiddleRectParent.style.top=!this.documentHelper.isTouchInput?top-7+'px':top-15+'px';imageResizer.bottomRightRectParent.style.left=imageResizer.topRightRectParent.style.left;imageResizer.bottomRightRectParent.style.top=parseFloat(imageResizer.topRightRectParent.style.top)+height+'px';imageResizer.bottomLeftRectParent.style.left=imageResizer.topLeftRectParent.style.left;imageResizer.bottomLeftRectParent.style.top=parseFloat(imageResizer.topLeftRectParent.style.top)+height+'px';imageResizer.bottomMiddleRectParent.style.left=imageResizer.topMiddleRectParent.style.left;imageResizer.bottomMiddleRectParent.style.top=parseFloat(imageResizer.topMiddleRectParent.style.top)+height+'px';imageResizer.rightMiddleRectParent.style.left=!this.documentHelper.isTouchInput?left+width-7+'px':left+width-15+'px';imageResizer.rightMiddleRectParent.style.top=parseFloat(imageResizer.topRightRectParent.style.top)+height/2+'px';imageResizer.leftMiddleRectParent.style.left=imageResizer.topLeftRectParent.style.left;imageResizer.leftMiddleRectParent.style.top=parseFloat(imageResizer.topLeftRectParent.style.top)+height/2+'px';this.setImageResizingPoints(imageResizer);if(this.documentHelper.isTouchInput){this.applyPropertiesForTouch();}else{this.applyPropertiesForMouse();}};/**
     * Sets the image resizing points.
     *
     * @private
     * @param {ImageResizer} imageResizer - Specifies for position of each resizing elements.
     * @returns {void}
     */ImageResizer.prototype.setImageResizingPoints=function(imageResizer){this.imageResizerPoints.resizeContainerDiv.x=parseFloat(imageResizer.resizeContainerDiv.style.left);this.imageResizerPoints.resizeContainerDiv.y=parseFloat(imageResizer.resizeContainerDiv.style.top);this.imageResizerPoints.bottomLeftRectParent.x=parseFloat(imageResizer.bottomLeftRectParent.style.left);this.imageResizerPoints.bottomLeftRectParent.y=parseFloat(imageResizer.bottomLeftRectParent.style.top);this.imageResizerPoints.bottomRightRectParent.x=parseFloat(imageResizer.bottomRightRectParent.style.left);this.imageResizerPoints.bottomRightRectParent.y=parseFloat(imageResizer.bottomRightRectParent.style.top);this.imageResizerPoints.bottomMiddleRectParent.x=parseFloat(imageResizer.bottomMiddleRectParent.style.left);this.imageResizerPoints.bottomMiddleRectParent.y=parseFloat(imageResizer.bottomMiddleRectParent.style.top);this.imageResizerPoints.topLeftRectParent.x=parseFloat(imageResizer.topLeftRectParent.style.left);this.imageResizerPoints.topLeftRectParent.y=parseFloat(imageResizer.topLeftRectParent.style.top);this.imageResizerPoints.topRightRectParent.x=parseFloat(imageResizer.topRightRectParent.style.left);this.imageResizerPoints.topRightRectParent.y=parseFloat(imageResizer.topRightRectParent.style.top);this.imageResizerPoints.topMiddleRectParent.x=parseFloat(imageResizer.topMiddleRectParent.style.left);this.imageResizerPoints.topMiddleRectParent.y=parseFloat(imageResizer.topMiddleRectParent.style.top);this.imageResizerPoints.leftMiddleRectParent.x=parseFloat(imageResizer.leftMiddleRectParent.style.left);this.imageResizerPoints.leftMiddleRectParent.y=parseFloat(imageResizer.leftMiddleRectParent.style.top);this.imageResizerPoints.rightMiddleRectParent.x=parseFloat(imageResizer.rightMiddleRectParent.style.left);this.imageResizerPoints.rightMiddleRectParent.y=parseFloat(imageResizer.rightMiddleRectParent.style.top);};/**
     * Initialize the resize container div element.
     *
     * @private
     * @param {ImageResizer} imageResizer - Specifies for creating resize container div element.
     * @returns {void}
     */ImageResizer.prototype.initResizeContainerDiv=function(imageResizer){imageResizer.resizeContainerDiv=document.createElement('div');imageResizer.resizeContainerDiv.id=this.documentHelper.owner.containerId+'_ResizeDivElement';imageResizer.resizeContainerDiv.style.position='absolute';imageResizer.resizeContainerDiv.style.border='1px solid #bfbfbf';imageResizer.resizeContainerDiv.style.zIndex='30';imageResizer.resizeContainerDiv.style.backgroundColor='transparent';imageResizer.resizeContainerDiv.style.display='block';};/**
     * Apply the properties of each resize rectangle element.
     *
     * @private
     * @param {HTMLDivElement} resizeRectElement - Specifies for applying properties to resize rectangle element.
     * @returns {void}
     */ImageResizer.prototype.applyProperties=function(resizeRectElement){resizeRectElement.style.position='absolute';resizeRectElement.style.width='8px';resizeRectElement.style.height='8px';resizeRectElement.style.fontSize='0px';resizeRectElement.style.zIndex=' 551';resizeRectElement.style.backgroundColor='#ffffff';resizeRectElement.style.border='1px solid #bfbfbf';resizeRectElement.style.boxShadow='0 1px 2px 0 #bfbfbf 0.35';resizeRectElement.style.color='#000000';};/**
     * Handles an image resizing.
     *
     * @private
     * @param {number} x  - Specifies for left value while resizing.
     * @param {number} y - Specifies for top value while resizing.
     * @returns {void}
     */ImageResizer.prototype.handleImageResizing=function(touchPoint,prevX,prevY){prevX=prevX/this.documentHelper.zoomFactor;prevY=prevY/this.documentHelper.zoomFactor;this.leftValue=sf.base.isNullOrUndefined(this.leftValue)?prevX:this.leftValue;this.topValue=sf.base.isNullOrUndefined(this.topValue)?prevY:this.topValue;var points;var id=this.selectedResizeElement.id.split('_');var currentElementId=id[id.length-1];switch(currentElementId){case'TopRightRectParent':points=this.topRightResizing(touchPoint);prevX=points.left;prevY=points.top;break;case'TopLeftRectParent':points=this.topLeftResizing(touchPoint);prevX=-points.left;prevY=-points.top;break;case'TopMiddleRectParent':prevX=0;prevY=this.topMiddleResizing(touchPoint);break;case'BottomRightRectParent':points=this.bottomRightResizing(touchPoint);prevX=points.left;prevY=points.top;break;case'BottomLeftRectParent':points=this.bottomLeftResizing(touchPoint);prevX=-points.left;prevY=-points.top;break;case'BottomMiddleRectParent':prevY=touchPoint.y-prevY;prevX=0;break;case'RightMiddleRectParent':prevX=touchPoint.x-prevX;prevY=0;break;case'LeftMiddleRectParent':prevX=this.leftMiddleResizing(touchPoint);prevY=0;break;default:break;}if(prevX!==0||prevY!==0){var widget=this.currentImageElementBox.line.paragraph;var image=this.currentImageElementBox;if(!sf.base.isNullOrUndefined(widget)&&widget.isInsideTable){var cellWidget=widget.containerWidget;if(!sf.base.isNullOrUndefined(cellWidget)){var rowWidget=cellWidget.containerWidget;var imageHeight=HelperMethods.convertPointToPixel(image.height);var widgetHeight=rowWidget.height-imageHeight;if(prevY>0&&rowWidget.y+widgetHeight+imageHeight+prevY>this.viewer.clientArea.bottom){this.isImageMoveToNextPage=true;}}}if(this.owner.enableHistoryMode){this.initHistoryForImageResizer(this.currentImageElementBox);}if(!sf.base.isNullOrUndefined(this.currentImageElementBox)){var width=this.currentImageElementBox.width+prevX>10?this.currentImageElementBox.width+prevX:10;var height=this.currentImageElementBox.height+prevY>10?this.currentImageElementBox.height+prevY:10;if(currentElementId==='BottomRightRectParent'||currentElementId==='TopRightRectParent'||currentElementId==='BottomLeftRectParent'||currentElementId==='TopLeftRectParent'){height=this.currentImageElementBox.height/this.currentImageElementBox.width*width;width=this.currentImageElementBox.width/this.currentImageElementBox.height*height;}this.currentImageElementBox.width=width;this.currentImageElementBox.height=height;var owner=this.currentImageElementBox.line.paragraph;this.positionImageResizer(this.currentImageElementBox);}this.isImageResizing=true;}};/**
     * Handles image resizing on mouse.
     *
     * @private
     * @param {MouseEvent} event - Specifies for image resizing using mouse event.
     * @returns {void}
     */ImageResizer.prototype.handleImageResizingOnMouse=function(event){if(!sf.base.isNullOrUndefined(this.selectedResizeElement)){var prevX=parseFloat(this.selectedResizeElement.style.left);var prevY=parseFloat(this.selectedResizeElement.style.top);var cursorPoint=new Point(event.offsetX,event.offsetY);var touchPoint=this.viewer.findFocusedPage(cursorPoint,true);this.handleImageResizing(touchPoint,prevX,prevY);}};ImageResizer.prototype.topMiddleResizing=function(touchPoint){var prevY;if(this.topValue>=touchPoint.y){prevY=this.topValue/touchPoint.y;this.topValue=touchPoint.y;if(this.viewer instanceof PageLayoutViewer){if(this.topValue<=this.viewer.pageGap){prevY=1;}}}else{prevY=-(touchPoint.y/this.topValue);this.topValue=touchPoint.y;if(this.topValue===0){prevY=-1;}}return prevY;};ImageResizer.prototype.leftMiddleResizing=function(touchPoint){var prevX;if(this.leftValue>=touchPoint.x){prevX=this.leftValue/touchPoint.x;this.leftValue=touchPoint.x;if(this.leftValue===0){prevX=1;this.leftValue=parseFloat(this.selectedResizeElement.style.left);}}else{prevX=-(touchPoint.x/this.leftValue);this.leftValue=touchPoint.x;}return prevX;};ImageResizer.prototype.topRightResizing=function(touchPoint){var points;if(this.leftValue<=touchPoint.x&&this.topValue>=touchPoint.y){points=this.getOuterResizingPoint(touchPoint);}else{points=this.getInnerResizingPoint(touchPoint);}return points;};ImageResizer.prototype.topLeftResizing=function(touchPoint){var points;if(this.leftValue>=touchPoint.x&&this.topValue>=touchPoint.y){points=this.getOuterResizingPoint(touchPoint);}else{points=this.getInnerResizingPoint(touchPoint);}return points;};ImageResizer.prototype.bottomRightResizing=function(touchPoint){var points;if(this.leftValue<=touchPoint.x&&this.topValue<=touchPoint.y){points=this.getOuterResizingPoint(touchPoint);}else{points=this.getInnerResizingPoint(touchPoint);}return points;};ImageResizer.prototype.bottomLeftResizing=function(touchPoint){var points;if(this.leftValue>=touchPoint.x&&this.topValue<=touchPoint.y){points=this.getOuterResizingPoint(touchPoint);}else{points=this.getInnerResizingPoint(touchPoint);}return points;};ImageResizer.prototype.getOuterResizingPoint=function(touchPoint){var prevX;var prevY;prevX=touchPoint.x-this.leftValue;this.leftValue=touchPoint.x;prevY=touchPoint.y-this.topValue;this.topValue=touchPoint.y;return{left:prevX,top:prevY};};ImageResizer.prototype.getInnerResizingPoint=function(touchPoint){var prevX;var prevY;prevX=-(this.leftValue-touchPoint.x);this.leftValue=touchPoint.x;prevY=-(this.topValue-touchPoint.y);this.topValue=touchPoint.y;return{left:prevX,top:prevY};};/**
     * Handles image resizing on touch.
     *
     * @private
     * @param {TouchEvent} touchEvent - Specifies for image resizing using touch event.
     * @returns {void}
     */ImageResizer.prototype.handleImageResizingOnTouch=function(touchEvent){if(!sf.base.isNullOrUndefined(this.selectedResizeElement)){var prevX=parseFloat(this.selectedResizeElement.style.left)+24;var prevY=parseFloat(this.selectedResizeElement.style.top)+24;var touch=touchEvent.touches;var cursorPoint=new Point(touch[0].clientX,touch[0].clientY);var touchPoint=this.viewer.findFocusedPage(cursorPoint,true);if(sf.base.isNullOrUndefined(this.currentImageElementBox)||sf.base.isNullOrUndefined(this.currentImageElementBox)){return;}this.handleImageResizing(touchPoint,prevX,prevY);}};/**
     * Gets the image point of mouse.
     *
     * @private
     * @param {Point} touchPoint - Specifies for resizer cursor position.
     * @returns {ImagePointInfo} - Returns image point
     */ImageResizer.prototype.getImagePoint=function(touchPoint){var x=this.documentHelper.render.getScaledValue(touchPoint.x,1);var y=this.documentHelper.render.getScaledValue(touchPoint.y,2);touchPoint=new Point(x,y);var imageResizingPoints=this.imageResizerPoints;var resizePosition='';var selectedElement=undefined;var bottomMiddle=imageResizingPoints.bottomMiddleRectParent;var bottomRight=imageResizingPoints.bottomRightRectParent;var bottomLeft=imageResizingPoints.bottomLeftRectParent;var topMiddle=imageResizingPoints.topMiddleRectParent;var topRight=imageResizingPoints.topRightRectParent;var topLeft=imageResizingPoints.topLeftRectParent;var rightMiddle=imageResizingPoints.rightMiddleRectParent;var leftMiddle=imageResizingPoints.leftMiddleRectParent;if(!sf.base.isNullOrUndefined(this.bottomMiddleRectParent)&&this.bottomMiddleRectParent.style.display!=='none'){if(touchPoint.x>bottomMiddle.x&&touchPoint.x<=bottomMiddle.x+15&&touchPoint.y>bottomMiddle.y&&touchPoint.y<=bottomMiddle.y+15){selectedElement=this.bottomMiddleRectParent;resizePosition='s-resize';}else if(touchPoint.x>bottomRight.x&&touchPoint.x<=bottomRight.x+15&&touchPoint.y>bottomRight.y&&touchPoint.y<=bottomRight.y+15){selectedElement=this.bottomRightRectParent;resizePosition='se-resize';}else if(touchPoint.x>bottomLeft.x&&touchPoint.x<=bottomLeft.x+15&&touchPoint.y>bottomLeft.y&&touchPoint.y<=bottomLeft.y+15){selectedElement=this.bottomLeftRectParent;resizePosition='sw-resize';}else if(touchPoint.x>topMiddle.x&&touchPoint.x<=topMiddle.x+15&&touchPoint.y>topMiddle.y&&touchPoint.y<=topMiddle.y+15){selectedElement=this.topMiddleRectParent;resizePosition='n-resize';}else if(touchPoint.x>topRight.x&&touchPoint.x<=topRight.x+15&&touchPoint.y>topRight.y&&touchPoint.y<=topRight.y+15){selectedElement=this.topRightRectParent;resizePosition='ne-resize';}else if(touchPoint.x>topLeft.x&&touchPoint.x<=topLeft.x+15&&touchPoint.y>topLeft.y&&touchPoint.y<=topLeft.y+15){selectedElement=this.topLeftRectParent;resizePosition='nw-resize';}else if(touchPoint.x>leftMiddle.x&&touchPoint.x<=leftMiddle.x+15&&touchPoint.y>leftMiddle.y&&touchPoint.y<=leftMiddle.y+15){selectedElement=this.leftMiddleRectParent;resizePosition='w-resize';}else if(touchPoint.x>rightMiddle.x&&touchPoint.x<=rightMiddle.x+15&&touchPoint.y>rightMiddle.y&&touchPoint.y<=rightMiddle.y+15){selectedElement=this.rightMiddleRectParent;resizePosition='e-resize';}else if(!sf.base.isNullOrUndefined(this.resizeContainerDiv)&&touchPoint.x>parseFloat(this.resizeContainerDiv.style.left)&&touchPoint.x<=parseFloat(this.resizeContainerDiv.style.left)+parseFloat(this.resizeContainerDiv.style.width)&&touchPoint.y>parseFloat(this.resizeContainerDiv.style.top)&&touchPoint.y<=parseFloat(this.resizeContainerDiv.style.top)+parseFloat(this.resizeContainerDiv.style.height)){resizePosition='move';}}return{'selectedElement':selectedElement,'resizePosition':resizePosition};};ImageResizer.prototype.applyPropertiesForMouse=function(){if(!sf.base.isNullOrUndefined(this.bottomLeftRectParent)){this.bottomMiddleRectParent.style.width='14px';this.bottomMiddleRectParent.style.height='14px';this.bottomRightRectParent.style.width='14px';this.bottomRightRectParent.style.height='14px';this.bottomLeftRectParent.style.width='14px';this.bottomLeftRectParent.style.height='14px';this.topMiddleRectParent.style.width='14px';this.topMiddleRectParent.style.height='14px';this.topRightRectParent.style.width='14px';this.topRightRectParent.style.height='14px';this.topLeftRectParent.style.width='14px';this.topLeftRectParent.style.height='14px';this.leftMiddleRectParent.style.width='14px';this.leftMiddleRectParent.style.height='14px';this.rightMiddleRectParent.style.width='14px';this.rightMiddleRectParent.style.height='14px';}};/**
     * Gets the image point of touch.
     *
     * @private
     * @param {Point} touchPoints - Specifies for resizer cursor position.
     * @returns {ImagePointInfo} - Returns image point info.
     */ImageResizer.prototype.getImagePointOnTouch=function(touchPoints){var x=this.documentHelper.render.getScaledValue(touchPoints.x,1);var y=this.documentHelper.render.getScaledValue(touchPoints.y,2);touchPoints=new Point(x,y);var imageResizingPointsOnTouch=this.imageResizerPoints;var resizePosition='';var selectedElements=undefined;var bottomMiddle=imageResizingPointsOnTouch.bottomMiddleRectParent;var bottomRight=imageResizingPointsOnTouch.bottomRightRectParent;var bottomLeft=imageResizingPointsOnTouch.bottomLeftRectParent;var topMiddle=imageResizingPointsOnTouch.topMiddleRectParent;var topRight=imageResizingPointsOnTouch.topRightRectParent;var topLeft=imageResizingPointsOnTouch.topLeftRectParent;var rightMiddle=imageResizingPointsOnTouch.rightMiddleRectParent;var leftMiddle=imageResizingPointsOnTouch.leftMiddleRectParent;if(!sf.base.isNullOrUndefined(this.bottomMiddleRectParent)&&this.bottomMiddleRectParent.style.display!=='none'){if(touchPoints.x>bottomMiddle.x&&touchPoints.x<=bottomMiddle.x+25&&touchPoints.y>bottomMiddle.y&&touchPoints.y<=bottomMiddle.y+25){selectedElements=this.bottomMiddleRectParent;resizePosition='s-resize';}else if(touchPoints.x>bottomRight.x&&touchPoints.x<=bottomRight.x+25&&touchPoints.y>bottomRight.y&&touchPoints.y<=bottomRight.y+25){selectedElements=this.bottomRightRectParent;resizePosition='se-resize';}else if(touchPoints.x>bottomLeft.x&&touchPoints.x<=bottomLeft.x+25&&touchPoints.y>bottomLeft.y&&touchPoints.y<=bottomLeft.y+25){selectedElements=this.bottomLeftRectParent;resizePosition='sw-resize';}else if(touchPoints.x>topMiddle.x&&touchPoints.x<=topMiddle.x+25&&touchPoints.y>topMiddle.y&&touchPoints.y<=topMiddle.y+25){selectedElements=this.topMiddleRectParent;resizePosition='n-resize';}else if(touchPoints.x>topRight.x&&touchPoints.x<=topRight.x+25&&touchPoints.y>topRight.y&&touchPoints.y<=topRight.y+25){selectedElements=this.topRightRectParent;resizePosition='ne-resize';}else if(touchPoints.x>topLeft.x&&touchPoints.x<=topLeft.x+25&&touchPoints.y>topLeft.y&&touchPoints.y<=topLeft.y+25){selectedElements=this.topLeftRectParent;resizePosition='nw-resize';}else if(touchPoints.x>leftMiddle.x&&touchPoints.x<=leftMiddle.x+25&&touchPoints.y>leftMiddle.y&&touchPoints.y<=leftMiddle.y+25){selectedElements=this.leftMiddleRectParent;resizePosition='w-resize';}else if(touchPoints.x>rightMiddle.x&&touchPoints.x<=rightMiddle.x+25&&touchPoints.y>rightMiddle.y&&touchPoints.y<=rightMiddle.y+25){selectedElements=this.rightMiddleRectParent;resizePosition='e-resize';}else if(!sf.base.isNullOrUndefined(this.resizeContainerDiv)&&touchPoints.x>parseFloat(this.resizeContainerDiv.style.left)&&touchPoints.x<=parseFloat(this.resizeContainerDiv.style.left)+parseFloat(this.resizeContainerDiv.style.width)&&touchPoints.y>parseFloat(this.resizeContainerDiv.style.top)&&touchPoints.y<=parseFloat(this.resizeContainerDiv.style.top)+parseFloat(this.resizeContainerDiv.style.height)){resizePosition='move';}}return{'selectedElement':selectedElements,'resizePosition':resizePosition};};ImageResizer.prototype.applyPropertiesForTouch=function(){if(!sf.base.isNullOrUndefined(this.bottomLeftRectParent)){this.bottomMiddleRectParent.style.width='30px';this.bottomMiddleRectParent.style.height='30px';this.bottomRightRectParent.style.width='30px';this.bottomRightRectParent.style.height='30px';this.bottomLeftRectParent.style.width='30px';this.bottomLeftRectParent.style.height='30px';this.topMiddleRectParent.style.width='30px';this.topMiddleRectParent.style.height='30px';this.topRightRectParent.style.width='30px';this.topRightRectParent.style.height='30px';this.topLeftRectParent.style.width='30px';this.topLeftRectParent.style.height='30px';this.leftMiddleRectParent.style.width='30px';this.leftMiddleRectParent.style.height='30px';this.rightMiddleRectParent.style.width='30px';this.rightMiddleRectParent.style.height='30px';}};/**
     * @private
     * @returns {void}
     */ImageResizer.prototype.mouseUpInternal=function(){this.currentImageElementBox.width=parseFloat(this.imageResizerDiv.style.width)/this.documentHelper.zoomFactor;this.currentImageElementBox.height=parseFloat(this.imageResizerDiv.style.height)/this.documentHelper.zoomFactor;this.owner.isShiftingEnabled=true;this.owner.editorModule.setOffsetValue(this.owner.selection);this.documentHelper.layout.reLayoutParagraph(this.currentImageElementBox.line.paragraph,0,0);this.updateHistoryForImageResizer();this.owner.editorModule.reLayout(this.owner.selection,true);this.viewer.updateScrollBars();};/**
     * Initialize history for image resizer.
     *
     * @private
     * @param {ImageResizer} imageResizer - Specifies for image resizer.
     * @param {WImage} imageContainer - Specifies for an image.
     * @returns {void}
     */ImageResizer.prototype.initHistoryForImageResizer=function(imageContainer){if(!sf.base.isNullOrUndefined(this.owner)&&sf.base.isNullOrUndefined(this.baseHistoryInfo)){this.baseHistoryInfo=new BaseHistoryInfo(this.owner);this.baseHistoryInfo.action='ImageResizing';this.baseHistoryInfo.updateSelection();this.baseHistoryInfo.modifiedProperties.push(new ImageInfo(imageContainer));}};/**
     * Updates histroy for image resizer.
     *
     * @private
     * @returns {void}
     */ImageResizer.prototype.updateHistoryForImageResizer=function(){if(!sf.base.isNullOrUndefined(this.owner)&&!sf.base.isNullOrUndefined(this.baseHistoryInfo)){var imageFormat=this.baseHistoryInfo.modifiedProperties[0];if(this.currentImageElementBox.width===imageFormat.width&&this.currentImageElementBox.height===imageFormat.height){this.baseHistoryInfo.modifiedProperties.pop();}else{//Records the image size modifications
this.owner.editorHistory.recordChanges(this.baseHistoryInfo);}//Fires the content changed event for the image size modifications
this.baseHistoryInfo=undefined;}};/**
     * Updates image resize container when applying zooming
     *
     * @private
     * @returns {void}
     */ImageResizer.prototype.updateImageResizerPosition=function(){if(!sf.base.isNullOrUndefined(this.currentImageElementBox)){var elementBox=this.currentImageElementBox instanceof ImageElementBox?this.currentImageElementBox:this.currentImageElementBox;var lineWidget=elementBox.line;var top_1;var left=void 0;var topValue=void 0;var leftValue=void 0;if(this.currentImageElementBox instanceof ImageElementBox){top_1=this.documentHelper.selection.getTop(lineWidget)+elementBox.margin.top;left=this.documentHelper.selection.getLeftInternal(lineWidget,elementBox,0);topValue=top_1*this.documentHelper.zoomFactor;leftValue=left*this.documentHelper.zoomFactor;}else{leftValue=elementBox.x*this.documentHelper.zoomFactor;topValue=elementBox.y*this.documentHelper.zoomFactor;}var height=this.documentHelper.render.getScaledValue(elementBox.height,2);var width=this.documentHelper.render.getScaledValue(elementBox.width,1);this.setImageResizerPosition(leftValue,topValue,width,height,this);}};/**
     * Dispose the internal objects which are maintained.
     *
     * @private
     * @returns {void}
     */ImageResizer.prototype.destroy=function(){if(!sf.base.isNullOrUndefined(this.resizeContainerDiv)){this.resizeContainerDiv.innerHTML='';}if(!sf.base.isNullOrUndefined(this.topLeftRect)){this.topLeftRect.innerHTML='';}if(!sf.base.isNullOrUndefined(this.topMiddleRect)){this.topMiddleRect.innerHTML='';}if(!sf.base.isNullOrUndefined(this.topRightRect)){this.topRightRect.innerHTML='';}if(!sf.base.isNullOrUndefined(this.bottomLeftRect)){this.bottomLeftRect.innerHTML='';}if(!sf.base.isNullOrUndefined(this.bottomMiddleRect)){this.bottomMiddleRect.innerHTML='';}if(!sf.base.isNullOrUndefined(this.bottomRightRect)){this.bottomRightRect.innerHTML='';}if(!sf.base.isNullOrUndefined(this.leftMiddleRect)){this.leftMiddleRect.innerHTML='';}if(!sf.base.isNullOrUndefined(this.rightMiddleRect)){this.rightMiddleRect.innerHTML='';}if(!sf.base.isNullOrUndefined(this.imageResizerDiv)){this.imageResizerDiv.innerHTML='';}if(!sf.base.isNullOrUndefined(this.selectedImageWidget)){this.selectedImageWidget.destroy();}if(!sf.base.isNullOrUndefined(this.imageResizerDivElement)){this.imageResizerDivElement.innerHTML='';}this.imageResizerDivElement=undefined;this.resizeContainerDiv=undefined;this.topLeftRect=undefined;this.topMiddleRect=undefined;this.topRightRect=undefined;this.bottomLeftRect=undefined;this.bottomMiddleRect=undefined;this.bottomRightRect=undefined;this.leftMiddleRect=undefined;this.rightMiddleRect=undefined;this.imageResizerDiv=undefined;this.selectedImageWidget=undefined;this.isImageResizing=false;this.isImageResizerVisible=false;this.currentImageElementBoxIn=undefined;//this.baseHistoryInfo = undefined;
this.resizeMarkSizeIn=undefined;this.documentHelper=undefined;this.owner=undefined;};return ImageResizer;}();/**
 * @private
 */var ImageResizingPoints=/** @class */function(){function ImageResizingPoints(){/**
         * @private
         */this.resizeContainerDiv=new Point(0,0);/**
         * @private
         */this.topLeftRectParent=new Point(0,0);/**
         * @private
         */this.topMiddleRectParent=new Point(0,0);/**
         * @private
         */this.topRightRectParent=new Point(0,0);/**
         * @private
         */this.bottomLeftRectParent=new Point(0,0);/**
         * @private
         */this.bottomMiddleRectParent=new Point(0,0);/**
         * @private
         */this.bottomRightRectParent=new Point(0,0);/**
         * @private
         */this.leftMiddleRectParent=new Point(0,0);/**
         * @private
         */this.rightMiddleRectParent=new Point(0,0);}return ImageResizingPoints;}();/**
 * @private
 */var SelectedImageInfo=/** @class */function(){/**
     * Constructor for selected image info class.
     * @param {number} height - Specifies for height value.
     * @param {number} width - Specifies for width value.
     */function SelectedImageInfo(height,width){this.heightIn=0;this.widthIn=0;this.heightIn=height;this.widthIn=width;}Object.defineProperty(SelectedImageInfo.prototype,"height",{get:function get(){return this.heightIn;},set:function set(value){this.heightIn=value;},enumerable:true,configurable:true});Object.defineProperty(SelectedImageInfo.prototype,"width",{get:function get(){return this.widthIn;},set:function set(value){this.widthIn=value;},enumerable:true,configurable:true});return SelectedImageInfo;}();/**
 * Editor Export
 */ // export * from './collaborative-editing';
/**
 * Exports the document to Word format.
 */var WordExport=/** @class */function(){function WordExport(){//Part path
this.customXMLItemsPath='customXml/item';this.customXMLItemsPropspath='customXml/itemProps';this.itemPropsPath='itemProps';this.documentPath='word/document.xml';this.stylePath='word/styles.xml';this.chartPath='word/charts';this.numberingPath='word/numbering.xml';this.settingsPath='word/settings.xml';this.headerPath='word/header';this.footerPath='word/footer';//private commentsPath: string = 'word/comments.xml';
this.imagePath='word/media/image';this.footnotesPath='word/footnotes.xml';this.endnotesPath='word/endnotes.xml';this.appPath='docProps/app.xml';this.corePath='docProps/core.xml';// private CustomPath: string = 'docProps/custom.xml';
// private FontTablePath: string = 'word/fontTable.xml';
this.contentTypesPath='[Content_Types].xml';// private ChartsPath: string = 'word/charts/';
this.defaultEmbeddingPath='word/embeddings/';this.commentsPath='word/comments.xml';this.commentsExtendedPath='word/commentsExtended.xml';// private EmbeddingPath:string = 'word\embeddings\';
// private DrawingPath:string = 'word\drawings\';
// private ThemePath: string = 'word/theme/theme1.xml';
// private FontsPath:string = 'word\fonts\';
// private DiagramPath:string = "word/diagrams/';
// private ControlPath:string = "word/activeX/';
// private VbaProject: string = 'vbaProject.bin';
// private VbaData: string = 'vbaData.xml';
// private VbaProjectPath: string = 'word/vbaProject.bin';
// private VbaDataPath: string = 'word/vbaData.xml';
// private CustomXMLPath:string = 'customXml\';
//Relationship path
this.generalRelationPath='_rels/.rels';this.wordRelationPath='word/_rels/document.xml.rels';this.customXMLRelPath='customXml/_rels/item';this.excelRelationPath='xl/_rels/workbook.xml.rels';// private FontRelationPath: string = 'word/_rels/fontTable.xml.rels';
// private CommentsRelationPath: string = 'word/_rels/comments.xml.rels';
this.footnotesRelationPath='word/_rels/footnotes.xml.rels';this.endnotesRelationPath='word/_rels/endnotes.xml.rels';// private NumberingRelationPath: string = 'word/_rels/numbering.xml.rels';
this.headerRelationPath='word/_rels/header';this.footerRelationPath='word/_rels/footer';// private SettingsRelationpath: string = 'word/_rels/settings.xml.rels';
// private VbaProjectRelsPath: string = 'word/_rels/vbaProject.bin.rels';
//Content type of the parts
this.xmlContentType='application/xml';this.fontContentType='application/vnd.openxmlformats-officedocument.obfuscatedFont';this.documentContentType='application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml';// private TemplateContentType: string = 'application/vnd.openxmlformats-officedocument.wordprocessingml.template.main+xml';
// private CommentsContentType: string = 'application/vnd.openxmlformats-officedocument.wordprocessingml.comments+xml';
this.settingsContentType='application/vnd.openxmlformats-officedocument.wordprocessingml.settings+xml';this.commentsContentType='application/vnd.openxmlformats-officedocument.wordprocessingml.comments+xml';this.commentsExContentType='application/vnd.openxmlformats-officedocument.wordprocessingml.commentsExtended+xml';this.endnoteContentType='application/vnd.openxmlformats-officedocument.wordprocessingml.endnotes+xml';// private FontTableContentType: string = 'application/vnd.openxmlformats-officedocument.wordprocessingml.fontTable+xml';
this.footerContentType='application/vnd.openxmlformats-officedocument.wordprocessingml.footer+xml';this.footnoteContentType='application/vnd.openxmlformats-officedocument.wordprocessingml.footnotes+xml';// private GlossaryDocumentContentType: string = 'application/vnd.openxmlformats-officedocument.wordprocessingml.document.glossary+xml';
this.headerContentType='application/vnd.openxmlformats-officedocument.wordprocessingml.header+xml';this.numberingContentType='application/vnd.openxmlformats-officedocument.wordprocessingml.numbering+xml';this.stylesContentType='application/vnd.openxmlformats-officedocument.wordprocessingml.styles+xml';this.webSettingsContentType='application/vnd.openxmlformats-officedocument.wordprocessingml.webSettings+xml';this.appContentType='application/vnd.openxmlformats-officedocument.extended-properties+xml';this.coreContentType='application/vnd.openxmlformats-package.core-properties+xml';this.customContentType='application/vnd.openxmlformats-officedocument.custom-properties+xml';this.customXmlContentType='application/vnd.openxmlformats-officedocument.customXmlProperties+xml';this.relationContentType='application/vnd.openxmlformats-package.relationships+xml';// private DiagramColor: string = 'application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml';
// private DiagramData: string = 'application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml';
// private DiagramLayout: string = 'application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml';
// private DiagramStyle: string = 'application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml';
this.chartsContentType='application/vnd.openxmlformats-officedocument.drawingml.chart+xml';// private ThemeContentType: string = 'application/vnd.openxmlformats-officedocument.theme+xml';
// private ChartDrawingContentType: string = 'application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml';
// private ActiveXContentType: string = 'application/vnd.ms-office.activeX+xml';
// private ActiveXBinContentType: string = 'application/vnd.ms-office.activeX';
this.tableStyleContentType='application/vnd.openxmlformats-officedocument.presentationml.tableStyles+xml';// private ChartStyleContentType: string = 'application/vnd.ms-office.chartstyle+xml';
this.chartColorStyleContentType='application/vnd.ms-office.chartcolorstyle+xml';// private VbaProjectContentType: string = 'application/vnd.ms-office.vbaProject';
// private VbaDataContentType: string = 'application/vnd.ms-word.vbaData+xml';
// private MacroDocumentContentType: string = 'application/vnd.ms-word.document.macroEnabled.main+xml';
// private MacroTemplateContentType: string = 'application/vnd.ms-word.template.macroEnabledTemplate.main+xml';
// private OleObjectContentType: string = 'application/vnd.openxmlformats-officedocument.oleObject';
// Relationship types of document parts
// private AltChunkRelType: string = 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/aFChunk';
this.commentsRelType='http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments';this.commentsExRelType='http://schemas.microsoft.com/office/2011/relationships/commentsExtended';this.settingsRelType='http://schemas.openxmlformats.org/officeDocument/2006/relationships/settings';this.endnoteRelType='http://schemas.openxmlformats.org/officeDocument/2006/relationships/endnotes';// private FontTableRelType: string = 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/fontTable';
this.footerRelType='http://schemas.openxmlformats.org/officeDocument/2006/relationships/footer';this.footnoteRelType='http://schemas.openxmlformats.org/officeDocument/2006/relationships/footnotes';this.headerRelType='http://schemas.openxmlformats.org/officeDocument/2006/relationships/header';this.documentRelType='http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument';this.numberingRelType='http://schemas.openxmlformats.org/officeDocument/2006/relationships/numbering';this.stylesRelType='http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles';// private OleObjectRelType: string = 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/oleObject';
this.chartRelType='http://schemas.openxmlformats.org/officeDocument/2006/relationships/chart';// private ThemeRelType: string = 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme';
this.fontRelType='http://schemas.openxmlformats.org/officeDocument/2006/relationships/font';this.tableStyleRelType='http://schemas.openxmlformats.org/officeDocument/2006/relationships/tableStyles';this.coreRelType='http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties';this.appRelType='http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties';this.customRelType='http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties';this.imageRelType='http://schemas.openxmlformats.org/officeDocument/2006/relationships/image';this.hyperlinkRelType='http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink';this.controlRelType='http://schemas.openxmlformats.org/officeDocument/2006/relationships/control';this.packageRelType='http://schemas.openxmlformats.org/officeDocument/2006/relationships/package';// private VbaProjectRelType: string = 'http://schemas.microsoft.com/office/2006/relationships/vbaProject';
// private VbaDataRelType: string = 'http://schemas.microsoft.com/office/2006/relationships/wordVbaData';
this.customXmlRelType='http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXml';this.customUIRelType='http://schemas.microsoft.com/office/2006/relationships/ui/extensibility';this.attachedTemplateRelType='http://schemas.openxmlformats.org/officeDocument/2006/relationships/attachedTemplate';this.chartColorStyleRelType='http://schemas.microsoft.com/office/2011/relationships/chartColorStyle';// private ChartStyleRelType: string = 'http://schemas.microsoft.com/office/2011/relationships/chartStyle';
// private ChartUserShapesRelType: string = 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/chartUserShapes';
// private ChartContentType: string = 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/package';
// Namespaces
// private PKG_namespace: string = 'http://schemas.microsoft.com/office/2006/xmlPackage';
this.wNamespace='http://schemas.openxmlformats.org/wordprocessingml/2006/main';this.wpNamespace='http://schemas.openxmlformats.org/drawingml/2006/wordprocessingDrawing';this.pictureNamespace='http://schemas.openxmlformats.org/drawingml/2006/picture';this.aNamespace='http://schemas.openxmlformats.org/drawingml/2006/main';this.a14Namespace='http://schemas.microsoft.com/office/drawing/2010/main';// private SVG_namespace: string = 'http://schemas.microsoft.com/office/drawing/2016/SVG/main';
this.rNamespace='http://schemas.openxmlformats.org/officeDocument/2006/relationships';this.rpNamespace='http://schemas.openxmlformats.org/package/2006/relationships';this.vNamespace='urn:schemas-microsoft-com:vml';this.oNamespace='urn:schemas-microsoft-com:office:office';this.xmlNamespace='http://www.w3.org/XML/1998/namespace';this.w10Namespace='urn:schemas-microsoft-com:office:word';this.cpNamespace='http://schemas.openxmlformats.org/package/2006/metadata/core-properties';this.dcNamespace='http://purl.org/dc/elements/1.1/';// private DCTERMS_namespace: string = 'http://purl.org/dc/terms/';
// private XSI_namespace: string = 'http://www.w3.org/2001/XMLSchema-instance';
this.docPropsNamespace='http://schemas.openxmlformats.org/officeDocument/2006/extended-properties';this.veNamespace='http://schemas.openxmlformats.org/markup-compatibility/2006';this.mNamespace='http://schemas.openxmlformats.org/officeDocument/2006/math';this.wneNamespace='http://schemas.microsoft.com/office/word/2006/wordml';// private DCMI_namespace: string = 'http://purl.org/dc/dcmitype/';
this.customPropsNamespace='http://schemas.openxmlformats.org/officeDocument/2006/custom-properties';this.vtNamespace='http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes';this.chartNamespace='http://schemas.openxmlformats.org/drawingml/2006/chart';this.slNamespace='http://schemas.openxmlformats.org/schemaLibrary/2006/main';//2003WML namespace
// private amlNamespace: string = 'http://schemas.microsoft.com/aml/2001/core';
this.dtNamespace='uuid:C2F41010-65B3-11d1-A29F-00AA00C14882';this.wmlNamespace='http://schemas.microsoft.com/office/word/2003/wordml';//2010 namespaces
this.w14Namespace='http://schemas.microsoft.com/office/word/2010/wordml';this.wpCanvasNamespace='http://schemas.microsoft.com/office/word/2010/wordprocessingCanvas';this.wpDrawingNamespace='http://schemas.microsoft.com/office/word/2010/wordprocessingDrawing';this.wpGroupNamespace='http://schemas.microsoft.com/office/word/2010/wordprocessingGroup';this.wpInkNamespace='http://schemas.microsoft.com/office/word/2010/wordprocessingInk';this.wpShapeNamespace='http://schemas.microsoft.com/office/word/2010/wordprocessingShape';//2013 namespaces
this.w15Namespace='http://schemas.microsoft.com/office/word/2012/wordml';this.diagramNamespace='http://schemas.openxmlformats.org/drawingml/2006/diagram';//Encryption namespaces
this.eNamespace='http://schemas.microsoft.com/office/2006/encryption';this.pNamespace='http://schemas.microsoft.com/office/2006/keyEncryptor/password';this.certNamespace='http://schemas.microsoft.com/office/2006/keyEncryptor/certificate';this.cxNamespace='http://schemas.microsoft.com/office/drawing/2014/chartex';// chart
this.c15Namespace='http://schemas.microsoft.com/office/drawing/2015/06/chart';this.c7Namespace='http://schemas.microsoft.com/office/drawing/2007/8/2/chart';this.csNamespace='http://schemas.microsoft.com/office/drawing/2012/chartStyle';// worksheet
this.spreadSheetNamespace='http://schemas.openxmlformats.org/spreadsheetml/2006/main';this.spreadSheet9='http://schemas.microsoft.com/office/spreadsheetml/2009/9/main';// Dls xml tags
this.cRelationshipsTag='Relationships';this.cRelationshipTag='Relationship';this.cIdTag='Id';this.cTypeTag='Type';this.cTargetTag='Target';this.cUserShapesTag='userShapes';this.cExternalData='externalData';this.twipsInOnePoint=20;this.twentiethOfPoint=20;this.borderMultiplier=8;this.percentageFactor=50;this.emusPerPoint=12700;// private const TOC_SYMBOL:string = (char)0x01;
// private const FOOTNOTE_SYMBOL:string = (char)0x02;
// private const PAGENUMBER_SYMBOL:string = (char)0xB;
// private DEF_FIT_TEXT_TO_SHAPE: string = 'mso-fit-shape-to-text:t';
// Document tags
this.cConditionalTableStyleTag='tblStylePr';this.cTableFormatTag='tblPr';this.cTowFormatTag='trPr';this.cCellFormatTag='tcPr';this.cParagraphFormatTag='pPr';this.cCharacterFormatTag='rPr';this.packageType='http://schemas.microsoft.com/office/2006/xmlPackage';this.relsPartPath='/_rels/.rels';this.documentRelsPartPath='/word/_rels/document.xml.rels';this.webSettingsPath='/word/webSettings.xml';this.wordMLDocumentPath='/word/document.xml';this.wordMLStylePath='/word/styles.xml';this.wordMLNumberingPath='/word/numbering.xml';this.wordMLSettingsPath='/word/settings.xml';this.wordMLHeaderPath='/word/header';this.wordMLFooterPath='/word/footer';this.wordMLCommentsPath='/word/comments.xml';this.wordMLImagePath='/word/media/image';this.wordMLFootnotesPath='/word/footnotes.xml';this.wordMLEndnotesPath='/word/endnotes.xml';this.wordMLAppPath='/docProps/app.xml';this.wordMLCorePath='/docProps/core.xml';this.wordMLCustomPath='/docProps/custom.xml';this.wordMLFontTablePath='/word/fontTable.xml';this.wordMLChartsPath='/word/charts/';this.wordMLDefaultEmbeddingPath='/word/embeddings/';this.wordMLEmbeddingPath='/word/embeddings/';this.wordMLDrawingPath='/word/drawings/';this.wordMLThemePath='/word/theme/theme1.xml';this.wordMLFontsPath='/word/fonts/';this.wordMLDiagramPath='/word/diagrams/';this.wordMLControlPath='/word/activeX/';this.wordMLVbaProject='/vbaProject.bin';this.wordMLVbaData='/vbaData.xml';this.wordMLVbaProjectPath='/word/vbaProject.bin';this.wordMLVbaDataPath='/word/vbaData.xml';// private WordMLCustomXMLPath: string = '/customXml/';
this.wordMLWebSettingsPath='/word/webSettings.xml';this.wordMLCustomItemProp1Path='/customXml/itemProps1.xml';// private WordMLCustomXMLRelPath: string = '/customXml/_rels/item1.xml.rels';
this.wordMLFootnoteRelPath='/word/_rels/footnotes.xml.rels';this.wordMLEndnoteRelPath='/word/_rels/endnotes.xml.rels';this.wordMLSettingsRelPath='/word/_rels/settings.xml.rels';this.wordMLNumberingRelPath='/word/_rels/numbering.xml.rels';this.wordMLFontTableRelPath='/word/_rels/fontTable.xml.rels';this.wordMLCustomXmlPropsRelType='http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXmlProps';this.wordMLControlRelType='http://schemas.microsoft.com/office/2006/relationships/activeXControlBinary';this.wordMLDiagramContentType='application/vnd.ms-office.drawingml.diagramDrawing+xml';this.dsNamespace='http://schemas.openxmlformats.org/officeDocument/2006/customXml';this.excelFiles=undefined;this.lastSection=false;this.mRelationShipID=0;this.cRelationShipId=0;this.eRelationShipId=0;this.efRelationShipId=0;this.mDocPrID=1;this.chartCount=0;this.seriesCount=0;this.chartStringCount=0;this.mDifferentFirstPage=false;this.mBookmarks=undefined;this.mComments=[];this.revisions=[];this.customXMLProps=[];this.paraID=0;this.commentParaID=0;this.commentParaIDInfo={};this.isInsideComment=false;this.commentId={};this.currentCommentId=0;this.trackChangesId=0;this.prevRevisionIds=[];this.isRevisionContinuous=false;/* eslint-enable @typescript-eslint/no-explicit-any */ /* eslint-enable */}WordExport.prototype.getModuleName=function(){return'WordExport';};Object.defineProperty(WordExport.prototype,"bookmarks",{// Gets the bookmark name
get:function get(){if(sf.base.isNullOrUndefined(this.mBookmarks)){this.mBookmarks=[];}return this.mBookmarks;},enumerable:true,configurable:true});Object.defineProperty(WordExport.prototype,"documentImages",{// Gets the collection of images present in the document body
get:function get(){if(this.mDocumentImages===undefined){this.mDocumentImages=new Dictionary();}return this.mDocumentImages;},enumerable:true,configurable:true});Object.defineProperty(WordExport.prototype,"externalImages",{// Gets the collection of images present in the document body
get:function get(){if(this.mExternalLinkImages===undefined){this.mExternalLinkImages=new Dictionary();}return this.mExternalLinkImages;},enumerable:true,configurable:true});Object.defineProperty(WordExport.prototype,"headerFooterImages",{// Gets the collections of images present in the HeaderFooters
get:function get(){if(this.mHeaderFooterImages===undefined){this.mHeaderFooterImages=new Dictionary();}return this.mHeaderFooterImages;},enumerable:true,configurable:true});Object.defineProperty(WordExport.prototype,"documentCharts",{// Gets the collection of charts present in the document body
get:function get(){if(this.mDocumentCharts===undefined){this.mDocumentCharts=new Dictionary();}return this.mDocumentCharts;},enumerable:true,configurable:true});Object.defineProperty(WordExport.prototype,"headersFooters",{/// Gets the HeaderFooter Collection
get:function get(){if(this.mHeaderFooterColl===undefined){this.mHeaderFooterColl=new Dictionary();}return this.mHeaderFooterColl;},enumerable:true,configurable:true});Object.defineProperty(WordExport.prototype,"endnotesFootnotes",{/// Gets the Endnote and Footnote Collection
get:function get(){if(this.mFootEndnotesColl===undefined){this.mFootEndnotesColl=new Dictionary();}return this.mFootEndnotesColl;},enumerable:true,configurable:true});/**
     * @private
     * @param {DocumentHelper} documentHelper - Document helper
     * @param {string} fileName - file name
     * @returns {void}
     */WordExport.prototype.save=function(documentHelper,fileName){var _this=this;this.fileName=fileName;this.serialize(documentHelper);var excelFiles=this.serializeExcelFiles();if(excelFiles&&excelFiles.length>0){Promise.all(excelFiles).then(function(){_this.saveInternal(fileName);});}else{this.saveInternal(fileName);}this.close();};WordExport.prototype.saveInternal=function(fileName){this.mArchive.save(fileName+'.docx').then(function(mArchive){mArchive.destroy();});};/**
     * @private
     * @param {DocumentHelper} documentHelper - Document helper
     * @returns {Promise<Blob>} - Return Promise
     */WordExport.prototype.saveAsBlob=function(documentHelper){var _this=this;this.serialize(documentHelper);var excelFiles=this.serializeExcelFiles();/* eslint-disable */return new Promise(function(resolve,reject){if(excelFiles.length>0){Promise.all(excelFiles).then(function(){_this.mArchive.saveAsBlob().then(function(blob){_this.mArchive.destroy();blob=new Blob([blob],{type:'application/vnd.openxmlformats-officedocument.wordprocessingml.document'});resolve(blob);});});}else{_this.mArchive.saveAsBlob().then(function(blob){_this.mArchive.destroy();blob=new Blob([blob],{type:'application/vnd.openxmlformats-officedocument.wordprocessingml.document'});resolve(blob);});}});/* eslint-enable */};WordExport.prototype.serializeExcelFiles=function(){var _this=this;var excelFiles=this.excelFiles;var files=[];if(excelFiles&&excelFiles.length>0){var _loop_1=function _loop_1(i){var fileName=excelFiles.keys[i];var excelFile=excelFiles.get(fileName);var excelPromise=excelFile.saveAsBlob();files.push(excelPromise);excelPromise.then(function(blob){var zipArchiveItem=new sf.compression.ZipArchiveItem(blob,fileName);_this.mArchive.addItem(zipArchiveItem);});};for(var i=0;i<excelFiles.length;i++){_loop_1(i);}this.excelFiles.clear();}return files;};/**
     * @private
     * @returns {void}
     */WordExport.prototype.saveExcel=function(){var xlsxPath=this.defaultEmbeddingPath+'Microsoft_Excel_Worksheet'+this.chartCount+'.xlsx';this.excelFiles.add(xlsxPath,this.mArchiveExcel);this.mArchiveExcel=undefined;};/**
     * @private
     * @returns {void}
     */WordExport.prototype.destroy=function(){this.clearDocument();this.mRelationShipID=undefined;this.mDocPrID=undefined;this.mDifferentFirstPage=undefined;this.fileName=undefined;if(this.mArchive){this.mArchive.destroy();this.mArchive=undefined;}if(this.mArchiveExcel){this.mArchiveExcel.destroy();this.mArchiveExcel=undefined;}};// Saves the word document in the stream
WordExport.prototype.serialize=function(documentHelper){/* eslint-disable @typescript-eslint/no-explicit-any */var document=documentHelper.owner.sfdtExportModule.write();this.setDocument(document);this.mComments=documentHelper.comments;this.mCustomXML=documentHelper.customXmlData;this.revisions=documentHelper.owner.revisions.changes;this.mArchive=new sf.compression.ZipArchive();this.mArchive.compressionLevel='Normal';this.commentParaIDInfo={};this.commentParaID=0;this.currentCommentId=0;this.commentId={};this.mVerticalMerge=new Dictionary();this.mGridSpans=new Dictionary();var contenttype;//document.xml
this.serializeDocument();//Styles.xml
this.serializeStyles();//numbering.xml
this.serializeNumberings();//comments.xml
this.serializeComments();//commentsExtended.xml
this.serializeCommentsExtended();//theme.xml
// if (m_document.DocHasThemes && !isNullOrUndefined(m_document.Themes))
//     SerializeThemes();
// else
// this.serializeDefaultThemes();
//settings.xml
this.serializeSettings();//core.xml
this.serializeCoreProperties();//app.xml
this.serializeAppProperties();//fontTable.xml
this.serializeFontTable(contenttype);//custom.xml
// if (!isNullOrUndefined(this.wordDocument.CustomDocumentProperties) && m_document.CustomDocumentProperties.length > 0) {
//     SerializeCustomProperties();
// }
//Settings Relations
this.serializeSettingsRelation();//Numbering relation if the document has picture bullet
// if (PictureBullets.length > 0) {
//     SerializeNumberingsRelation();
// }
this.serializeHeaderFooters();this.serializeFootnotes();this.serializeEndnotes();//document relations
this.serializeDocumentRelations();// Add controls to archieve.
// if (ControlsPathNames.length > 0) {
//     AddControlsToZip(m_document.DocxPackage);
// }
// if (!isNullOrUndefined(m_document.CustomUIPartContainer))
//     AddPartContainerToArchive(m_document.CustomUIPartContainer);
// if (!isNullOrUndefined(m_document.CustomXMLContainer))
//     AddPartContainerToArchive(m_document.CustomXMLContainer);
//general relations
this.serializeGeneralRelations();//[ContentTypes].xml
this.serializeContentTypes(contenttype);// Clears the internal fields maintained for serializing.
this.clearDocument();};// Sets the document
WordExport.prototype.setDocument=function(document){this.document=document;this.mSections=document.sections;this.mLists=document.lists;this.mAbstractLists=document.abstractLists;this.defCharacterFormat=document.characterFormat;this.defParagraphFormat=document.paragraphFormat;this.defaultTabWidthValue=document.defaultTabWidth;this.dontUseHtmlParagraphAutoSpacing=document.dontUseHTMLParagraphAutoSpacing;this.mStyles=document.styles;this.formatting=document.formatting;this.enforcement=document.enforcement;this.hashValue=document.hashValue;this.saltValue=document.saltValue;this.protectionType=document.protectionType;this.formFieldShading=document.formFieldShading;this.trackChanges=document.trackChanges;this.compatibilityMode=document.compatibilityMode;};// Clears the document
WordExport.prototype.clearDocument=function(){// Owner Nodes
this.section=undefined;this.lastSection=undefined;this.blockOwner=undefined;this.paragraph=undefined;this.table=undefined;this.row=undefined;this.headerFooter=undefined;this.commentParaIDInfo={};this.commentParaID=0;this.currentCommentId=0;this.commentId={};this.document=undefined;this.mSections=undefined;this.mLists=undefined;this.mAbstractLists=undefined;this.defCharacterFormat=undefined;this.defParagraphFormat=undefined;this.defaultTabWidthValue=undefined;this.trackChanges=undefined;this.customXMLProps=[];this.mRelationShipID=0;this.eRelationShipId=0;this.cRelationShipId=0;this.efRelationShipId=0;this.mDocPrID=1;this.chartCount=0;this.mDifferentFirstPage=false;if(this.mHeaderFooterColl){this.mHeaderFooterColl.destroy();this.mHeaderFooterColl=undefined;}if(this.mVerticalMerge){this.mVerticalMerge.destroy();this.mVerticalMerge=undefined;}if(this.mGridSpans){this.mGridSpans.destroy();this.mGridSpans=undefined;}if(this.mDocumentImages){this.mDocumentImages.destroy();this.mDocumentImages=undefined;}if(this.mExternalLinkImages){this.mExternalLinkImages.destroy();this.mExternalLinkImages=undefined;}if(this.mHeaderFooterImages){this.mHeaderFooterImages.destroy();this.mHeaderFooterImages=undefined;}if(this.mDocumentCharts){this.mDocumentCharts.destroy();this.mDocumentCharts=undefined;}if(this.mFootEndnotesColl){this.mFootEndnotesColl.destroy();this.mFootEndnotesColl=undefined;}};// Serializes the document elements (document.xml)
WordExport.prototype.serializeDocument=function(){var writer=new sf.fileutils.XmlWriter();writer.writeStartElement('w','document',this.wNamespace);this.writeCommonAttributeStrings(writer);this.serializeDocumentBody(writer);writer.writeEndElement();//end of document tag
var archiveItem=new sf.compression.ZipArchiveItem(writer.buffer,this.documentPath);this.mArchive.addItem(archiveItem);};WordExport.prototype.writeCommonAttributeStrings=function(writer){writer.writeAttributeString('xmlns','wpc',undefined,this.wpCanvasNamespace);this.writeCustom(writer);writer.writeAttributeString('xmlns','wp14',undefined,this.wpDrawingNamespace);writer.writeAttributeString('xmlns','wp',undefined,this.wpNamespace);writer.writeAttributeString('xmlns','w10',undefined,this.w10Namespace);writer.writeAttributeString('xmlns','w',undefined,this.wNamespace);this.writeDup(writer);writer.writeAttributeString('xmlns','wne',undefined,this.wneNamespace);writer.writeAttributeString('xmlns','wps',undefined,this.wpShapeNamespace);writer.writeAttributeString('mc','Ignorable',undefined,'w14 w15 wp14');};WordExport.prototype.writeDup=function(writer){writer.writeAttributeString('xmlns','w14',undefined,this.w14Namespace);writer.writeAttributeString('xmlns','w15',undefined,this.w15Namespace);writer.writeAttributeString('xmlns','wpg',undefined,this.wpGroupNamespace);writer.writeAttributeString('xmlns','wpi',undefined,this.wpInkNamespace);};WordExport.prototype.writeCustom=function(writer){writer.writeAttributeString('xmlns','mc',undefined,this.veNamespace);writer.writeAttributeString('xmlns','o',undefined,this.oNamespace);writer.writeAttributeString('xmlns','r',undefined,this.rNamespace);writer.writeAttributeString('xmlns','m',undefined,this.mNamespace);writer.writeAttributeString('xmlns','v',undefined,this.vNamespace);};// Serializes the document body
WordExport.prototype.serializeDocumentBody=function(writer){writer.writeStartElement(undefined,'body',this.wNamespace);var count=this.document.sections.length;for(var i=0;i<count;i++){this.section=this.document.sections[i];this.lastSection=i===count-1;this.serializeSection(writer,this.section,i===count-1);this.section=undefined;}writer.writeEndElement();};// Serializes the Section.
WordExport.prototype.serializeSection=function(writer,section,last){this.blockOwner=section;this.serializeBodyItems(writer,section.blocks,last);if(last){this.serializeSectionProperties(writer,section);}this.blockOwner=undefined;};// Serialize the comments (comments.xml)
WordExport.prototype.serializeComments=function(){if(this.mComments.length===0||this.mComments.length===1&&this.mComments[0].text===''){return;}var writer=new sf.fileutils.XmlWriter();writer.writeStartElement('w','comments',this.wNamespace);this.serializeCommentCommonAttribute(writer);this.serializeCommentInternal(writer,this.mComments);writer.writeEndElement();var zipArchiveItem=new sf.compression.ZipArchiveItem(writer.buffer,this.commentsPath);this.mArchive.addItem(zipArchiveItem);};WordExport.prototype.serializeCommentCommonAttribute=function(writer){writer.writeAttributeString('xmlns','wpc',undefined,this.wpCanvasNamespace);writer.writeAttributeString('xmlns','cx',undefined,this.cxNamespace);writer.writeAttributeString('xmlns','mc',undefined,this.veNamespace);writer.writeAttributeString('xmlns','o',undefined,this.oNamespace);writer.writeAttributeString('xmlns','r',undefined,this.rNamespace);writer.writeAttributeString('xmlns','m',undefined,this.mNamespace);writer.writeAttributeString('xmlns','v',undefined,this.vNamespace);writer.writeAttributeString('xmlns','wp14',undefined,this.wpDrawingNamespace);writer.writeAttributeString('xmlns','wp',undefined,this.wpNamespace);writer.writeAttributeString('xmlns','w10',undefined,this.w10Namespace);writer.writeAttributeString('xmlns','w',undefined,this.wNamespace);writer.writeAttributeString('xmlns','w14',undefined,this.w14Namespace);writer.writeAttributeString('xmlns','w15',undefined,this.w15Namespace);writer.writeAttributeString('mc','Ignorable',undefined,'w14 w15');};WordExport.prototype.serializeCommentInternal=function(writer,comments){for(var i=0;i<comments.length;i++){var comment=comments[i];writer.writeStartElement('w','comment',this.wNamespace);writer.writeAttributeString('w','id',this.wNamespace,this.commentId[comment.commentId].toString());if(comment.author&&comment.author!==' '){writer.writeAttributeString('w','author',this.wNamespace,comment.author);}if(comment.date){writer.writeAttributeString('w','date',this.wNamespace,comment.date);}if(comment.initial&&comment.initial!==''){writer.writeAttributeString('w','initials',this.wNamespace,comment.initial);}var blocks=this.retrieveCommentText(comment.text);for(var k=0;k<blocks.length;k++){this.isInsideComment=true;this.commentParaID++;this.serializeBodyItem(writer,blocks[k],true);this.isInsideComment=false;}if(blocks.length===0){this.isInsideComment=true;this.commentParaID++;}this.commentParaIDInfo[comment.commentId]=this.commentParaID;//}
this.isInsideComment=false;//}
writer.writeEndElement();if(comment.replyComments.length>0){this.serializeCommentInternal(writer,comment.replyComments);}}};WordExport.prototype.retrieveCommentText=function(text){var blocks=[];var multiText=text.split('\n');multiText=multiText.filter(function(x){return x!=='';});var block={};if(multiText.length===0){block.inlines=[{text:''}];blocks.push(block);}else{while(multiText.length>0){block.inlines=[{text:multiText[0]}];blocks.push(block);multiText.splice(0,1);}}return blocks;};// Serialize the comments (commentsExtended.xml)
WordExport.prototype.serializeCommentsExtended=function(){if(this.mComments.length===0||this.mComments.length===1&&this.mComments[0].text===''){return;}var writer=new sf.fileutils.XmlWriter();writer.writeStartElement('w15','commentsEx',this.wNamespace);this.serializeCommentCommonAttribute(writer);this.serializeCommentsExInternal(writer,this.mComments,false);writer.writeEndElement();var zipArchiveItem=new sf.compression.ZipArchiveItem(writer.buffer,this.commentsExtendedPath);this.mArchive.addItem(zipArchiveItem);};WordExport.prototype.serializeCommentsExInternal=function(writer,comments,isReply){for(var i=0;i<comments.length;i++){var comment=comments[i];writer.writeStartElement('w15','commentEx',this.wNamespace);//if (comment.blocks.length > 0) {
var syncParaID=this.commentParaIDInfo[comment.commentId];if(isReply){var paraID=this.commentParaIDInfo[comment.ownerComment.commentId];writer.writeAttributeString('w15','paraIdParent',this.wNamespace,paraID.toString());}writer.writeAttributeString('w15','paraId',this.wNamespace,syncParaID.toString());//}
var val=comment.done?1:0;writer.writeAttributeString('w15','done',this.wNamespace,val.toString());writer.writeEndElement();if(comment.replyComments.length>0){this.serializeCommentsExInternal(writer,comment.replyComments,true);}}};// Serialize the section properties.
WordExport.prototype.serializeSectionProperties=function(writer,section){writer.writeStartElement('w','sectPr',this.wNamespace);if(section.headersFooters){this.serializeHFReference(writer,section.headersFooters);}// if (IsNeedToSerializeSectionFootNoteProperties(section))
//     SerializeFootnoteProperties(section);
// if (IsNeedToSerializeSectionEndNoteProperties(section))
//     SerializeEndnoteProperties(section);
this.serializeSectionType(writer,'nextPage');this.serializePageSetup(writer,section.sectionFormat);this.serializeColumns(writer);this.serializeFootNotesPr(writer,section.sectionFormat);this.serializeEndNotesPr(writer,section.sectionFormat);// this.serializeSectionProtection(section);
// if (section.PageSetup.VerticalAlignment !== PageAlignment.Top) {
//     writer.writeStartElement('vAlign', this.wNamespace);
//     switch (section.PageSetup.VerticalAlignment) {
//         case PageAlignment.Top:
//             writer.WriteAttributeString('val', this.wNamespace, 'top');
//             break;
//         case PageAlignment.Middle:
//             writer.WriteAttributeString('val', this.wNamespace, 'center');
//             break;
//         case PageAlignment.Justified:
//             writer.WriteAttributeString('val', this.wNamespace, 'both');
//             break;
//         case PageAlignment.Bottom:
//             writer.WriteAttributeString('val', this.wNamespace, 'bottom');
//             break;
//     }
//     writer.WriteEndElement();
// }
if(section.sectionFormat!==undefined&&section.sectionFormat.differentFirstPage){writer.writeStartElement(undefined,'titlePg',this.wNamespace);writer.writeEndElement();}// SerializeTextDirection(section);
if(!sf.base.isNullOrUndefined(section.sectionFormat)&&section.sectionFormat.bidi){writer.writeStartElement(undefined,'bidi',this.wNamespace);writer.writeEndElement();}//rtlGutter
// SerializeDocGrid(section);
//printerSettings
writer.writeEndElement();//end of sectPr tag
};WordExport.prototype.serializeFootNotesPr=function(writer,section){if(section.footNoteNumberFormat||section.restartIndexForFootnotes){writer.writeStartElement(undefined,'footnotePr',this.wNamespace);writer.writeStartElement(undefined,'pos',this.wNamespace);writer.writeAttributeString(undefined,'val',this.wNamespace,'pageBottom');writer.writeEndElement();if(section.footNoteNumberFormat!==undefined){writer.writeStartElement(undefined,'numFmt',this.wNamespace);writer.writeAttributeString(undefined,'val',this.wNamespace,this.getFootNoteNumberFormat(section.footNoteNumberFormat));writer.writeEndElement();}if(section.restartIndexForFootnotes!==undefined){writer.writeStartElement(undefined,'numRestart',this.wNamespace);writer.writeAttributeString(undefined,'val',this.wNamespace,this.getFootNoteNumberRestart(section.restartIndexForFootnotes));writer.writeEndElement();}if(section.initialFootNoteNumber!==undefined){writer.writeStartElement(undefined,'numStart',this.wNamespace);writer.writeAttributeString(undefined,'val',this.wNamespace,section.initialFootNoteNumber.toString());writer.writeEndElement();}writer.writeEndElement();}};WordExport.prototype.getFootNoteNumberFormat=function(numberFormat){var patternType;switch(numberFormat){case'UpperCaseRoman':patternType='upperRoman';break;case'LowerCaseRoman':patternType='lowerRoman';break;case'UpperCaseLetter':patternType='upperLetter';break;case'LowerCaseLetter':patternType='lowerLetter';break;default:patternType='decimal';break;}return patternType;};WordExport.prototype.getFootNoteNumberRestart=function(numberRestart){switch(numberRestart){case'RestartForEachSection ':return'eachSect';case'RestartForEachPage':return'eachPage';default:return'continuous';}};// Serialize the Footnote Properties
WordExport.prototype.serializeEndNotesPr=function(writer,section){if(section.endnoteNumberFormat||section.restartIndexForEndnotes){writer.writeStartElement(undefined,'endnotePr',this.wNamespace);writer.writeStartElement(undefined,'pos',this.wNamespace);writer.writeAttributeString(undefined,'val',this.wNamespace,'docEnd');writer.writeEndElement();if(section.endnoteNumberFormat!==undefined){writer.writeStartElement(undefined,'numFmt',this.wNamespace);writer.writeAttributeString(undefined,'val',this.wNamespace,this.getFootNoteNumberFormat(section.endnoteNumberFormat));writer.writeEndElement();}if(section.restartIndexForEndnotes!==undefined){writer.writeStartElement(undefined,'numRestart',this.wNamespace);writer.writeAttributeString(undefined,'val',this.wNamespace,this.getFootNoteNumberRestart(section.restartIndexForEndnotes));writer.writeEndElement();}if(section.initialEndNoteNumber!==undefined){writer.writeStartElement(undefined,'numStart',this.wNamespace);writer.writeAttributeString(undefined,'val',this.wNamespace,section.initialEndNoteNumber.toString());writer.writeEndElement();}writer.writeEndElement();}};// Serialize the column properties of section.
WordExport.prototype.serializeColumns=function(writer){writer.writeStartElement(undefined,'cols',this.wNamespace);writer.writeAttributeString(undefined,'equalWidth',this.wNamespace,'1');writer.writeAttributeString(undefined,'space',this.wNamespace,'0');writer.writeEndElement();// ColumnCollection columns = section.Columns;
// writer.WriteStartElement('cols', this.wNamespace);
// if (columns.length > 0)
// {
//     writer.WriteAttributeString('num', this.wNamespace, columns.length.ToString());
// }
// if (section.PageSetup.DrawLinesBetweenCols)
//     writer.WriteAttributeString('sep', this.wNamespace, '1');
// if (columns.OwnerSection.PageSetup.EqualColumnWidth)
// {
//     writer.WriteAttributeString('equalWidth', this.wNamespace, '1');
//     //When the column count is negative, MS word just reset the column's count to zero
//     //To avoid index out of exception, checked the columns count
//     writer.WriteAttributeString('space', this.wNamespace, ToString(columns.length > 0 ? columns[0].Space * this.TwentiethOfPoint : 0));
// }
// else if (columns.length > 0)
// {
//     writer.WriteAttributeString('equalWidth', this.wNamespace, '0');
//     foreach (Column column in columns)
//     {
//         writer.WriteStartElement('col', this.wNamespace);
//         writer.WriteAttributeString('w', this.wNamespace, ToString(column.Width * this.TwentiethOfPoint));
//         writer.WriteAttributeString('space', this.wNamespace, ToString(column.Space * this.TwentiethOfPoint));
//         writer.WriteEndElement();
//     }
// }
// writer.WriteEndElement();
};// Serialize the page setup properties.
WordExport.prototype.serializePageSetup=function(writer,pageSetup){if(pageSetup!==undefined){this.serializePageSize(writer,pageSetup);this.serializePageMargins(writer,pageSetup);}// // StartElement paperSrc (if any)
// if (pageSetup.FirstPageTray > 0 || pageSetup.OtherPagesTray > 0) {
//     writer.WriteStartElement('paperSrc', this.wNamespace);
//     if (pageSetup.FirstPageTray > 0) {
//         writer.WriteAttributeString('first', this.wNamespace, pageSetup.FirstPageTray.ToString());
//     }
//     if (pageSetup.OtherPagesTray > 0) {
//         writer.WriteAttributeString('other', this.wNamespace, pageSetup.OtherPagesTray.ToString());
//     }
//     writer.WriteEndElement();
// }
if(pageSetup.restartPageNumbering){writer.writeStartElement(undefined,'pgNumType',this.wNamespace);writer.writeAttributeString(undefined,'start',this.wNamespace,pageSetup.pageStartingNumber.toString());writer.writeEndElement();}writer.writeStartElement(undefined,'pgBorders',this.wNamespace);// //zOrder
// if (pageSetup.PageBordersApplyType === PageBordersApplyType.FirstPage)
//     writer.WriteAttributeString('display', this.wNamespace, 'firstPage');
// else if (pageSetup.PageBordersApplyType === PageBordersApplyType.AllExceptFirstPage)
//     writer.WriteAttributeString('display', this.wNamespace, 'notFirstPage');
// if (pageSetup.PageBorderOffsetFrom === PageBorderOffsetFrom.PageEdge) {
//     writer.WriteAttributeString('offsetFrom', this.wNamespace, 'page');
// }
// //Serializing zOrder of the front page border
// if (!pageSetup.IsFrontPageBorder) {
//     writer.WriteAttributeString('zOrder', this.wNamespace, 'back');
// }
// SerializePageBorders(pageSetup.Borders);
writer.writeEndElement();// this.serializeLineNumberType(writer, pageSetup);
//this.serializePageNumberType(writer, pageSetup);
};// serialize the page size
WordExport.prototype.serializePageSize=function(writer,pageSetup){writer.writeStartElement(undefined,'pgSz',this.wNamespace);writer.writeAttributeString(undefined,'w',this.wNamespace,this.roundToTwoDecimal(pageSetup.pageWidth*this.twentiethOfPoint).toString());writer.writeAttributeString(undefined,'h',this.wNamespace,this.roundToTwoDecimal(pageSetup.pageHeight*this.twentiethOfPoint).toString());// if (pageSetup.Orientation === PageOrientation.Landscape)
// {
//     writer.WriteAttributeString('orient', this.wNamespace, 'landscape');
// }
writer.writeEndElement();};// Serialize the border.
WordExport.prototype.serializePageMargins=function(writer,pageSetup){writer.writeStartElement(undefined,'pgMar',this.wNamespace);var marginValue=Math.round(pageSetup.topMargin*this.twentiethOfPoint);writer.writeAttributeString(undefined,'top',this.wNamespace,marginValue.toString());marginValue=Math.round(pageSetup.rightMargin*this.twentiethOfPoint);writer.writeAttributeString(undefined,'right',this.wNamespace,marginValue.toString());marginValue=Math.round(pageSetup.bottomMargin*this.twentiethOfPoint);writer.writeAttributeString(undefined,'bottom',this.wNamespace,marginValue.toString());marginValue=Math.round(pageSetup.leftMargin*this.twentiethOfPoint);writer.writeAttributeString(undefined,'left',this.wNamespace,marginValue.toString());writer.writeAttributeString(undefined,'header',this.wNamespace,this.roundToTwoDecimal(pageSetup.headerDistance*this.twentiethOfPoint).toString());writer.writeAttributeString(undefined,'footer',this.wNamespace,this.roundToTwoDecimal(pageSetup.footerDistance*this.twentiethOfPoint).toString());writer.writeAttributeString(undefined,'gutter',this.wNamespace,'0');writer.writeEndElement();};// Serialize the section type.
WordExport.prototype.serializeSectionType=function(writer,sectionBreakCode){writer.writeStartElement('w','type',this.wNamespace);writer.writeAttributeString('w','val',this.wNamespace,sectionBreakCode);//GetSectionBreakCode(sectionBreakCode));
writer.writeEndElement();};// Serialize the heeader/footer reference.
WordExport.prototype.serializeHFReference=function(writer,headersFooters){var hfId='';if(headersFooters!==undefined){this.mDifferentFirstPage=this.section.sectionFormat.differentOddAndEvenPages;var hf=headersFooters.firstPageHeader;if(hf&&hf.blocks&&hf.blocks.length>0){writer.writeStartElement(undefined,'headerReference',this.wNamespace);writer.writeAttributeString(undefined,'type',this.wNamespace,'first');hfId=this.getNextRelationShipID();writer.writeAttributeString(undefined,'id',this.rNamespace,hfId);this.addHeaderFooter(hf,'FirstPageHeader',hfId);writer.writeEndElement();}hf=headersFooters.firstPageFooter;if(hf&&hf.blocks&&hf.blocks.length>0){writer.writeStartElement(undefined,'footerReference',this.wNamespace);writer.writeAttributeString(undefined,'type',this.wNamespace,'first');hfId=this.getNextRelationShipID();writer.writeAttributeString(undefined,'id',this.rNamespace,hfId);this.addHeaderFooter(hf,'FirstPageFooter',hfId);writer.writeEndElement();}hf=headersFooters.evenHeader;if(hf&&hf.blocks&&hf.blocks.length>0){writer.writeStartElement(undefined,'headerReference',this.wNamespace);writer.writeAttributeString(undefined,'type',this.wNamespace,'even');hfId=this.getNextRelationShipID();writer.writeAttributeString(undefined,'id',this.rNamespace,hfId);this.addHeaderFooter(hf,'EvenHeader',hfId);writer.writeEndElement();}hf=headersFooters.evenFooter;if(hf&&hf.blocks&&hf.blocks.length>0){writer.writeStartElement(undefined,'footerReference',this.wNamespace);writer.writeAttributeString(undefined,'type',this.wNamespace,'even');hfId=this.getNextRelationShipID();writer.writeAttributeString(undefined,'id',this.rNamespace,hfId);this.addHeaderFooter(hf,'EvenFooter',hfId);writer.writeEndElement();}hf=headersFooters.header;if(hf&&hf.blocks&&hf.blocks.length>0){writer.writeStartElement(undefined,'headerReference',this.wNamespace);writer.writeAttributeString(undefined,'type',this.wNamespace,'default');hfId=this.getNextRelationShipID();writer.writeAttributeString(undefined,'id',this.rNamespace,hfId);this.addHeaderFooter(hf,'OddHeader',hfId);writer.writeEndElement();}hf=headersFooters.footer;if(hf&&hf.blocks&&hf.blocks.length>0){writer.writeStartElement(undefined,'footerReference',this.wNamespace);writer.writeAttributeString(undefined,'type',this.wNamespace,'default');hfId=this.getNextRelationShipID();writer.writeAttributeString(undefined,'id',this.rNamespace,hfId);this.addHeaderFooter(hf,'OddFooter',hfId);writer.writeEndElement();}}};// Adds the header footer details to the collection.
WordExport.prototype.addHeaderFooter=function(hf,hfType,id){var hfColl=new Dictionary();this.headersFooters.add(hfType,hfColl);this.headersFooters.get(hfType).add(id,hf);};// Serializes the bodyItems
WordExport.prototype.serializeBodyItems=function(writer,blockCollection,isLastSection){for(var i=0;i<blockCollection.length;i++){this.serializeBodyItem(writer,blockCollection[i],isLastSection);}};// serialize the content Control
// eslint-disable-next-line max-len
WordExport.prototype.serializeContentControl=function(writer,contentControlItem,item,isLastSection,inlines){if(sf.base.isNullOrUndefined(contentControlItem)){throw new Error('contentCOntrol should not be undefined');}writer.writeStartElement('w','sdt',this.wNamespace);writer.writeStartElement(undefined,'sdtPr',this.wNamespace);if(!sf.base.isNullOrUndefined(contentControlItem)){this.serializeContentProperties(writer,contentControlItem,item,isLastSection,inlines);}};// serialize Content Control Properties
// eslint-disable-next-line max-len
WordExport.prototype.serializeContentProperties=function(writer,contentProperties,items,isLastSection,inlines){var repeatSdt=undefined;if(!sf.base.isNullOrUndefined(contentProperties.title)){writer.writeStartElement(undefined,'alias',this.wNamespace);writer.writeAttributeString('w','val',this.wNamespace,contentProperties.title);writer.writeEndElement();writer.writeStartElement(undefined,'tag',this.wNamespace);writer.writeAttributeString('w','val',this.wNamespace,contentProperties.tag);writer.writeEndElement();}if(!sf.base.isNullOrUndefined(contentProperties.characterFormat)){this.serializeCharacterFormat(writer,items.contentControlProperties.characterFormat);}// if (items.hasOwnProperty('blocks') && contentProperties.type !== 'CheckBox') {
//     this.serializeContentParagraph(writer, items);
// }
if(contentProperties.lockContents||contentProperties.lockContentControl){writer.writeStartElement(undefined,'lock',this.wNamespace);if(contentProperties.lockContentControl&&contentProperties.lockContents){writer.writeAttributeString('w','val',this.wNamespace,'sdtContentLocked');}else if(contentProperties.lockContentControl){writer.writeAttributeString('w','val',this.wNamespace,'sdtLocked');}else if(contentProperties.lockContents){writer.writeAttributeString('w','val',this.wNamespace,'contentLocked');}writer.writeEndElement();}if(contentProperties.hasPlaceHolderText&&sf.base.isNullOrUndefined(repeatSdt)){writer.writeStartElement('w','placeholder',undefined);writer.writeAttributeString('w','docPart',this.wNamespace,undefined);writer.writeEndElement();writer.writeStartElement('w','showingPlcHdr',undefined);writer.writeEndElement();}if(contentProperties.isTemporary){writer.writeStartElement('w','temporary',undefined);writer.writeEndElement();}if(!sf.base.isNullOrUndefined(contentProperties.appearance)){writer.writeStartElement('w15','appearance',undefined);writer.writeAttributeString('w15','val',undefined,contentProperties.appearance.toLowerCase());writer.writeEndElement();}if(!sf.base.isNullOrUndefined(contentProperties.color)){writer.writeStartElement('w15','color',undefined);writer.writeAttributeString('w','val',undefined,this.getColor(contentProperties.color));writer.writeEndElement();}if(contentProperties.multiline){writer.writeStartElement(undefined,'text',this.wNamespace);writer.writeAttributeString('w','multiLine',this.wNamespace,'1');writer.writeEndElement();}if(!sf.base.isNullOrUndefined(contentProperties.xmlMapping)){if(contentProperties.xmlMapping.isMapped){writer.writeStartElement('w','dataBinding',this.wNamespace);writer.writeAttributeString('w','xpath',undefined,contentProperties.xmlMapping.xPath);writer.writeAttributeString('w','storeItemID',undefined,contentProperties.xmlMapping.storeItemId);writer.writeEndElement();}}if(contentProperties.picture){writer.writeStartElement('w','picture',this.wNamespace);writer.writeEndElement();}if(!sf.base.isNullOrUndefined(contentProperties.uncheckedState||contentProperties.checkedState)){writer.writeStartElement('w14','checkbox',undefined);if(contentProperties.isChecked){writer.writeStartElement('w14','checked',undefined);writer.writeAttributeString('w14','val',undefined,'1');writer.writeEndElement();}else{writer.writeStartElement('w14','checked',undefined);writer.writeAttributeString('w14','val',undefined,'0');writer.writeEndElement();}writer.writeStartElement('w14','uncheckedState',undefined);writer.writeAttributeString('w14','val',undefined,this.toUnicode(contentProperties.uncheckedState.value));writer.writeAttributeString('w14','font',undefined,contentProperties.uncheckedState.font);writer.writeEndElement();writer.writeStartElement('w14','checkedState',undefined);writer.writeAttributeString('w14','val',undefined,this.toUnicode(contentProperties.checkedState.value));writer.writeAttributeString('w14','font',undefined,contentProperties.checkedState.font);writer.writeEndElement();writer.writeEndElement();}if(!sf.base.isNullOrUndefined(contentProperties.contentControlListItems)&&contentProperties.type==='DropDownList'){var dropDownLists=contentProperties.contentControlListItems;writer.writeStartElement(undefined,'dropDownList',this.wNamespace);this.serializeContentControlList(writer,dropDownLists);writer.writeEndElement();}if(!sf.base.isNullOrUndefined(contentProperties.contentControlListItems)&&contentProperties.type==='ComboBox'){var comboList=contentProperties.contentControlListItems;writer.writeStartElement(undefined,'comboBox',this.wNamespace);this.serializeContentControlList(writer,comboList);writer.writeEndElement();}this.serializeContentControlDate(writer,contentProperties);if(!sf.base.isNullOrUndefined(contentProperties.type)){if(contentProperties.type==='Picture'){writer.writeStartElement(undefined,'picture',this.wNamespace);writer.writeEndElement();}}writer.writeEndElement();writer.writeStartElement('w','sdtContent',this.wNamespace);if(inlines){return;}/* eslint-disable */if(items.hasOwnProperty('blocks')&&sf.base.isNullOrUndefined(items.cellFormat)){for(var i=0;i<items.blocks.length;i++){var block=items.blocks[i];if(block.hasOwnProperty('inlines')){this.paragraph=block;this.serializeParagraph(writer,block,isLastSection);this.paragraph=undefined;}else if(block.hasOwnProperty('rowFormat')){var mVerticalMerge=new Dictionary();this.serializeRow(writer,block,mVerticalMerge);}else if(block.hasOwnProperty('contentControlProperties')){this.serializeContentControl(writer,block.contentControlProperties,block,isLastSection);}else{var table=block;this.serializeTable(writer,table);}}}else if(items.hasOwnProperty('rowFormat')){if(items.cells.length>0){var mVerticalMerge=new Dictionary();this.serializeRow(writer,items,mVerticalMerge);}}else if(items.hasOwnProperty('cellFormat')){var mVerticalMerge=new Dictionary();this.serializeCell(writer,items,mVerticalMerge);}writer.writeEndElement();writer.writeEndElement();};WordExport.prototype.toUnicode=function(code){var charCode=code.charCodeAt(0);return charCode.toString(16);};//serialize dropdown and list property
WordExport.prototype.serializeContentControlList=function(writer,lists){for(var i=0;i<lists.length;i++){writer.writeStartElement(undefined,'listItem',this.wNamespace);if(!sf.base.isNullOrUndefined(lists[i].displayText)){writer.writeAttributeString('w','displayText',this.wNamespace,lists[i].displayText);}writer.writeAttributeString('w','value',this.wNamespace,lists[i].value);writer.writeEndElement();}};//Serialize character formatfor content control
WordExport.prototype.serializeContentParagraph=function(writer,items){for(var i=0;i<items.blocks.length;i++){var blocks=items.blocks[i];if(blocks.hasOwnProperty('inlines')){for(var j=0;j<blocks.inlines.length;j++){var inlines=blocks.inlines[j];if(!sf.base.isNullOrUndefined(inlines.characterFormat)){this.serializeCharacterFormat(writer,inlines.characterFormat);}}}}};// serialize content control date property
WordExport.prototype.serializeContentControlDate=function(writer,contentProperties){if(contentProperties.type==='Date'){writer.writeStartElement('w','date',this.wNamespace);if(!sf.base.isNullOrUndefined(contentProperties.dateDisplayFormat)){writer.writeStartElement('w','calender',this.wNamespace);writer.writeAttributeString(undefined,'val',this.wNamespace,contentProperties.dateCalendarType);writer.writeEndElement();}if(!sf.base.isNullOrUndefined(contentProperties.dateDisplayLocale)){writer.writeStartElement('w','lid',this.wNamespace);writer.writeAttributeString(undefined,'val',this.wNamespace,contentProperties.dateDisplayLocale);writer.writeEndElement();}if(!sf.base.isNullOrUndefined(contentProperties.dateStorageFormat)){writer.writeStartElement('w','storeMappedDataAs',this.wNamespace);writer.writeAttributeString(undefined,'val',this.wNamespace,contentProperties.dateStorageFormat);writer.writeEndElement();}if(!sf.base.isNullOrUndefined(contentProperties.dateCalendarType)){writer.writeStartElement('w','dateFormat',this.wNamespace);writer.writeAttributeString(undefined,'val',this.wNamespace,contentProperties.dateDisplayFormat);writer.writeEndElement();}writer.writeEndElement();}};// Serialize the TextBody item
WordExport.prototype.serializeBodyItem=function(writer,item,isLastSection){if(sf.base.isNullOrUndefined(item)){throw new Error('BodyItem should not be undefined');}if(item.hasOwnProperty('contentControlProperties')){this.serializeContentControl(writer,item.contentControlProperties,item,isLastSection);}else if(item.hasOwnProperty('inlines')){this.paragraph=item;this.serializeParagraph(writer,item,isLastSection);this.paragraph=undefined;}else{var table=item;for(var i=0;i<table.rows.length;i++){if(table.rows[i].cells.length>0){this.serializeTable(writer,table);break;}}}var sec=this.blockOwner;//Need to write the Section Properties if the Paragraph is last item in the section
if(!isLastSection&&sec.hasOwnProperty('sectionFormat')&&sec.blocks.indexOf(item)===sec.blocks.length-1){writer.writeStartElement('w','p',this.wNamespace);writer.writeStartElement(undefined,'pPr',this.wNamespace);this.serializeSectionProperties(writer,sec);writer.writeEndElement();writer.writeEndElement();}};// Serialize the paragraph
WordExport.prototype.serializeParagraph=function(writer,paragraph,isLastSection){if(sf.base.isNullOrUndefined(paragraph)){throw new Error('Paragraph should not be undefined');}// if (paragraph.ParagraphFormat.PageBreakAfter && !IsPageBreakNeedToBeSkipped(paragraph as Entity))
//     paragraph.InsertBreak(BreakType.PageBreak);
// if (paragraph.ParagraphFormat.ColumnBreakAfter && !IsPageBreakNeedToBeSkipped(paragraph as Entity))
//     paragraph.InsertBreak(BreakType.ColumnBreak);
//Splits the paragraph based on the newline character
// paragraph.SplitTextRange();
writer.writeStartElement('w','p',this.wNamespace);if(this.isInsideComment){writer.writeAttributeString('w14','paraId',undefined,this.commentParaID.toString());}writer.writeStartElement(undefined,'pPr',this.wNamespace);if(!sf.base.isNullOrUndefined(paragraph.paragraphFormat)){this.serializeParagraphFormat(writer,paragraph.paragraphFormat,paragraph);}if(!sf.base.isNullOrUndefined(paragraph.characterFormat)){this.serializeCharacterFormat(writer,paragraph.characterFormat);}writer.writeEndElement();//end of pPr
// Serialize watermark if paragraph is the first item of Header document.
// EnsureWatermark(paragraph);
this.prevRevisionIds=[];this.serializeParagraphItems(writer,paragraph.inlines);writer.writeEndElement();//end of paragraph tag.
};//Serialize Revision start
WordExport.prototype.serializeRevisionStart=function(writer,item,previousNode){if(item.hasOwnProperty('revisionIds')){if(!sf.base.isNullOrUndefined(previousNode)&&previousNode.hasOwnProperty('fieldType')&&previousNode.fieldType===0){return;}if(item.hasOwnProperty('fieldType')&&item.fieldType===1){return;}if(!sf.base.isNullOrUndefined(previousNode)&&previousNode.hasOwnProperty('bookmarkType')&&previousNode.bookmarkType===0&&!(previousNode.name.indexOf('_Toc')>=0)){return;}var ids=item.revisionIds;for(var i=0;i<ids.length;i++){var revision=this.retrieveRevision(ids[i]);if(revision.revisionType==='Insertion'){this.serializeTrackChanges(writer,'ins',revision.author,revision.date);}if(revision.revisionType==='Deletion'){this.serializeTrackChanges(writer,'del',revision.author,revision.date);}}}};//Serialize track changes
WordExport.prototype.serializeTrackChanges=function(writer,type,author,date){writer.writeStartElement('w',type,this.wNamespace);writer.writeAttributeString('w','id',this.wNamespace,(this.trackChangesId++).toString());writer.writeAttributeString('w','author',this.wNamespace,author);writer.writeAttributeString('w','date',this.wNamespace,date);};WordExport.prototype.retrieveRevision=function(id){for(var i=0;i<this.revisions.length;i++){if(this.revisions[i].revisionID===id){return this.revisions[i];}}return undefined;};// Serialize the paragraph items
WordExport.prototype.serializeParagraphItems=function(writer,paraItems){var inlines;var previousNode=undefined;var isContinueOverride=false;for(var i=0;i<paraItems.length;i++){var item=paraItems[i];if(item.hasOwnProperty('contentControlProperties')){inlines=true;this.serializeContentControl(writer,item.contentControlProperties,item,undefined,inlines);this.serializeParagraphItems(writer,item.inlines);}if(item.hasOwnProperty('inlines')){this.serializeParagraphItems(writer,item);}this.serializeRevisionStart(writer,item,previousNode);var isBdo=false;if(item.characterFormat){isBdo=!sf.base.isNullOrUndefined(item.characterFormat.bdo)&&item.characterFormat.bdo!=='None';if(isBdo&&!isContinueOverride){this.serializeBiDirectionalOverride(writer,item.characterFormat);isContinueOverride=true;}}if(isContinueOverride&&!isBdo){writer.writeEndElement();isContinueOverride=false;}if(item.hasOwnProperty('fieldType')){this.serializeFieldCharacter(writer,item);}else if(item.hasOwnProperty('imageString')){this.serializePicture(writer,item);}else if(item.hasOwnProperty('shapeId')){var currentParargaph=this.paragraph;this.serializeShape(writer,item);this.paragraph=currentParargaph;}else if(item.hasOwnProperty('bookmarkType')){this.serializeBookMark(writer,item);}else if(item.hasOwnProperty('editRangeId')){this.serializeEditRange(writer,item);}else if(item.hasOwnProperty('chartType')){this.chart=item;this.serializeChart(writer,item);// chart.xml
this.serializeChartStructure();}else if(item.hasOwnProperty('commentCharacterType')){this.serializeComment(writer,item);}else if(item.hasOwnProperty('footnoteType')){this.serializeEFReference(writer,item);}else{this.serializeTextRange(writer,item,previousNode);}//Serialize revision end
this.serializeRevisionEnd(writer,item,previousNode);previousNode=item;if(inlines){writer.writeEndElement();writer.writeEndElement();inlines=false;}}if(isContinueOverride){writer.writeEndElement();}};WordExport.prototype.serializeEFReference=function(writer,item){var efId='';var ef=item.blocks;if(item.footnoteType==='Footnote'){writer.writeStartElement(undefined,'r',this.wNamespace);this.serializeCharacterFormat(writer,item.characterFormat);writer.writeStartElement(undefined,'footnoteReference',this.wNamespace);efId=this.getEFNextRelationShipID();writer.writeAttributeString(undefined,'id',this.wNamespace,efId);this.addFootnotesEndnotes(ef,'footnote',efId);writer.writeEndElement();writer.writeEndElement();}else{writer.writeStartElement(undefined,'r',this.wNamespace);this.serializeCharacterFormat(writer,item.characterFormat);writer.writeStartElement(undefined,'endnoteReference',this.wNamespace);efId=this.getEFNextRelationShipID();writer.writeAttributeString(undefined,'id',this.wNamespace,efId);this.addFootnotesEndnotes(ef,'endnote',efId);writer.writeEndElement();writer.writeEndElement();}};WordExport.prototype.addFootnotesEndnotes=function(ef,efType,id){var efColl=new Dictionary();this.endnotesFootnotes.add(efType,efColl);this.endnotesFootnotes.get(efType).add(id,ef);};WordExport.prototype.serializeEndnotesFootnote=function(writer,efType){if(this.endnotesFootnotes.length===0){return;}var endnoteFootnotePath;var endnoteFootnoteRelsPath;if(!this.endnotesFootnotes.containsKey(efType)){return;}var efColl=this.endnotesFootnotes.get(efType);var ef=undefined;for(var i=0;i<efColl.keys.length;i++){var id=efColl.keys[i];ef=efColl.get(id);if(efType==='endnote'){endnoteFootnotePath=this.endnotesPath;endnoteFootnoteRelsPath=this.endnotesRelationPath;this.serializeInlineEndnotes(writer,ef,id);}else{endnoteFootnotePath=this.footnotesPath;endnoteFootnoteRelsPath=this.footnotesRelationPath;this.serializeInlineFootnotes(writer,ef,id);}}};WordExport.prototype.serializeInlineEndnotes=function(writer,endNote,id){this.endNoteFootnote=endNote;var owner=this.blockOwner;this.blockOwner=endNote;writer.writeStartElement('w','endnote',this.wNamespace);writer.writeAttributeString(undefined,'id',this.wNamespace,id);this.serializeBodyItems(writer,endNote,true);writer.writeEndElement();this.blockOwner=owner;this.endNoteFootnote=undefined;};WordExport.prototype.serializeInlineFootnotes=function(writer,footNote,id){this.endNoteFootnote=footNote;var owner=this.blockOwner;this.blockOwner=footNote;writer.writeStartElement('w','footnote',this.wNamespace);writer.writeAttributeString(undefined,'id',this.wNamespace,id);this.serializeBodyItems(writer,footNote,true);writer.writeEndElement();this.blockOwner=owner;this.endNoteFootnote=undefined;};// private footnoteXMLItem(fileIndex: number): any {
//     let writer = new XmlWriter;
//     writer.writeStartElement(undefined, 'Sources', this.wNamespace)
//     writer.writeAttributeString('xmlns', 'b', undefined, 'http://schemas.openxmlformats.org/officeDocument/2006/bibliography')
//     writer.writeAttributeString(undefined,'xmlns',  undefined, 'http://schemas.openxmlformats.org/officeDocument/2006/bibliography')
//     writer.writeAttributeString(undefined,'SelectedStyle', undefined,"\APASixthEditionOfficeOnline.xsl")
//     writer.writeAttributeString(undefined,'StyleName',  undefined,"APA")
//     writer.writeAttributeString(undefined,'Version',  undefined,"6")
//     writer.writeEndElement();
//     let itemPath: string = this.customXMLItemsPath + fileIndex + '.xml';
//     let zipArchiveItem: ZipArchiveItem = new ZipArchiveItem(writer.buffer, itemPath);
//     this.mArchive.addItem(zipArchiveItem);
//     return itemPath;
// }
// private footnoteXMLItemProps(itemID: string, fileIndex: number): any {
//     let writer: XmlWriter = new XmlWriter();
//     let customitemPropsPath: string = this.customXMLItemsPropspath + fileIndex + '.xml';
//     let itemPropsPath: string = this.itemPropsPath + fileIndex + '.xml';
//     writer.writeStartElement('ds', 'datastoreItem', this.wNamespace);
//     writer.writeAttributeString('ds', 'itemID', undefined, itemID);
//     writer.writeAttributeString('xmlns', 'ds', undefined, this.dsNamespace);
//     writer.writeStartElement('ds','schemaRefs', this.wNamespace);
//     writer.writeStartElement('ds', 'schemaRef', this.wNamespace);
//     writer.writeAttributeString('ds','uri', undefined,'http://schemas.openxmlformats.org/officeDocument/2006/bibliography' )
//     writer.writeEndElement();
//     writer.writeEndElement();
//     writer.writeEndElement();
//     this.customXMLProps.push(customitemPropsPath);
//     let zipArchiveItem: ZipArchiveItem = new ZipArchiveItem(writer.buffer, customitemPropsPath);
//     this.mArchive.addItem(zipArchiveItem);
//     return itemPropsPath;
// }
//Serialize the Footnote Endnotes Common Atributes
WordExport.prototype.writeEFCommonAttributes=function(writer){writer.writeAttributeString('xmlns','wpc',undefined,this.wpCanvasNamespace);writer.writeAttributeString('xmlns','cx',undefined,this.cxNamespace);writer.writeAttributeString('xmlns','aink',undefined,'http://schemas.microsoft.com/office/drawing/2016/ink');writer.writeAttributeString('xmlns','am3d',undefined,'http://schemas.microsoft.com/office/drawing/2017/,odel3d');this.writeCustom(writer);writer.writeAttributeString('xmlns','wp14',undefined,this.wpDrawingNamespace);writer.writeAttributeString('xmlns','wp',undefined,this.wpNamespace);writer.writeAttributeString('xmlns','w',undefined,this.wNamespace);this.writeDup(writer);writer.writeAttributeString('xmlns','wne',undefined,this.wneNamespace);writer.writeAttributeString('xmlns','wps',undefined,this.wpShapeNamespace);writer.writeAttributeString('mc','Ignorable',undefined,'w14 w15');};WordExport.prototype.serializeFootnotes=function(){if(sf.base.isNullOrUndefined(this.document.footnotes)){return;}else{var writer=new sf.fileutils.XmlWriter();writer.writeStartElement('w','footnotes',this.wNamespace);this.writeEFCommonAttributes(writer);writer.writeStartElement('w','footnote',this.wNamespace);writer.writeAttributeString(undefined,'type',this.wNamespace,'separator');writer.writeAttributeString(undefined,'id',this.wNamespace,'-1');this.serializeBodyItems(writer,this.document.footnotes.separator,true);writer.writeEndElement();writer.writeStartElement('w','footnote',this.wNamespace);writer.writeAttributeString(undefined,'type',this.wNamespace,'continuationSeparator');writer.writeAttributeString(undefined,'id',this.wNamespace,'0');this.serializeBodyItems(writer,this.document.footnotes.continuationSeparator,true);writer.writeEndElement();if(this.document.footnotes.continuationNotice){writer.writeStartElement('w','endnote',this.wNamespace);writer.writeAttributeString(undefined,'type',this.wNamespace,'continuationNotice');writer.writeAttributeString(undefined,'id',this.wNamespace,'1');this.serializeBodyItems(writer,this.document.footnotes.continuationNotice,true);writer.writeEndElement();}this.serializeEndnotesFootnote(writer,'footnote');writer.writeEndElement();var zipArchiveItem=new sf.compression.ZipArchiveItem(writer.buffer,this.footnotesPath);this.mArchive.addItem(zipArchiveItem);}};WordExport.prototype.serializeEndnotes=function(){if(sf.base.isNullOrUndefined(this.document.endnotes)){return;}else{var writer=new sf.fileutils.XmlWriter();writer.writeStartElement('w','endnotes',this.wNamespace);this.writeEFCommonAttributes(writer);writer.writeStartElement('w','endnote',this.wNamespace);writer.writeAttributeString(undefined,'type',this.wNamespace,'separator');writer.writeAttributeString(undefined,'id',this.wNamespace,'-1');this.serializeBodyItems(writer,this.document.endnotes.separator,true);writer.writeEndElement();writer.writeStartElement('w','endnote',this.wNamespace);writer.writeAttributeString(undefined,'type',this.wNamespace,'continuationSeparator');writer.writeAttributeString(undefined,'id',this.wNamespace,'0');this.serializeBodyItems(writer,this.document.endnotes.continuationSeparator,true);writer.writeEndElement();if(this.document.endnotes.continuationNotice){writer.writeStartElement('w','endnote',this.wNamespace);writer.writeAttributeString(undefined,'type',this.wNamespace,'continuationNotice');writer.writeAttributeString(undefined,'id',this.wNamespace,'1');this.serializeBodyItems(writer,this.document.endnotes.continuationNotice,true);writer.writeEndElement();}this.serializeEndnotesFootnote(writer,'endnote');writer.writeEndElement();var zipArchiveItem=new sf.compression.ZipArchiveItem(writer.buffer,this.endnotesPath);this.mArchive.addItem(zipArchiveItem);}};//Serialize Revision end
WordExport.prototype.serializeRevisionEnd=function(writer,item,previousNode){if(item.hasOwnProperty('revisionIds')){//skip revision end for field begin as we combine to end with field code text
if(item.hasOwnProperty('fieldType')&&item.fieldType===0){return;}//skip revision end for field result text as we need to only on field end.
if(!sf.base.isNullOrUndefined(previousNode)&&previousNode.hasOwnProperty('fieldType')&&(previousNode.fieldType===2||previousNode.fieldType===0&&item.text.indexOf('TOC')>=0)){return;}for(var i=0;i<item.revisionIds.length;i++){var revision=this.retrieveRevision(item.revisionIds[i]);if(revision.revisionType==='Insertion'||revision.revisionType==='Deletion'){writer.writeEndElement();}}}};// Serialize the comment
WordExport.prototype.serializeComment=function(writer,comment){if(!(this.mComments.length===1&&this.mComments[0].text==='')){if(comment.commentCharacterType===0){writer.writeStartElement('w','commentRangeStart',this.wNamespace);}else if(comment.commentCharacterType===1){writer.writeStartElement('w','commentRangeEnd',this.wNamespace);}var commentId=this.commentId[comment.commentId];if(sf.base.isNullOrUndefined(commentId)){commentId=this.commentId[comment.commentId]=this.currentCommentId++;}writer.writeAttributeString('w','id',this.wNamespace,commentId.toString());writer.writeEndElement();if(comment.commentCharacterType===1){this.serializeCommentItems(writer,commentId);}}};WordExport.prototype.serializeCommentItems=function(writer,commentId){writer.writeStartElement('w','r',this.wNamespace);writer.writeStartElement('w','commentReference',this.wNamespace);writer.writeAttributeString('w','id',this.wNamespace,commentId.toString());writer.writeEndElement();writer.writeEndElement();};WordExport.prototype.serializeBiDirectionalOverride=function(writer,characterFormat){writer.writeStartElement(undefined,'bdo',this.wNamespace);writer.writeAttributeString(undefined,'val',this.wNamespace,characterFormat.bdo.toLowerCase());};// Serialize Document Protection
//<w:permStart w:id="627587516" w:edGrp="everyone" />
WordExport.prototype.serializeEditRange=function(writer,editElement){if(editElement.hasOwnProperty('editableRangeStart')){writer.writeStartElement('w','permEnd',this.wNamespace);}else{writer.writeStartElement('w','permStart',this.wNamespace);if(editElement.user&&editElement.user!==''){writer.writeAttributeString('w','ed',this.wNamespace,editElement.user);}if(editElement.group&&editElement.group!==''){writer.writeAttributeString('w','edGrp',this.wNamespace,editElement.group.toLowerCase());}if(editElement.columnFirst&&editElement.columnFirst!==-1){writer.writeAttributeString('w','colFirst',this.wNamespace,editElement.columnFirst.toString());}if(editElement.columnLast&&editElement.columnLast!==-1){writer.writeAttributeString('w','colLast',this.wNamespace,editElement.columnLast.toString());}}writer.writeAttributeString('w','id',this.wNamespace,editElement.editRangeId);writer.writeEndElement();};// Serialize the book mark
WordExport.prototype.serializeBookMark=function(writer,bookmark){var bookmarkId=this.getBookmarkId(bookmark.name);var bookmarkName=bookmark.name;if(bookmark.bookmarkType===0){writer.writeStartElement('w','bookmarkStart',this.wNamespace);writer.writeAttributeString('w','name',this.wNamespace,bookmarkName);}else if(bookmark.bookmarkType===1){writer.writeStartElement('w','bookmarkEnd',this.wNamespace);}writer.writeAttributeString('w','id',this.wNamespace,bookmarkId.toString());writer.writeEndElement();};WordExport.prototype.getBookmarkId=function(name){var index=this.bookmarks.indexOf(name);if(index<0){index=this.bookmarks.length;this.bookmarks.push(name);}return index;};// Serialize the picture.
WordExport.prototype.serializePicture=function(writer,image){if(image.width>=0&&image.height>=0){writer.writeStartElement(undefined,'r',this.wNamespace);this.serializeCharacterFormat(writer,image.characterFormat);this.serializeDrawing(writer,image);writer.writeEndElement();//end of run element
}};WordExport.prototype.serializeShape=function(writer,item){if(item.width>=0&&item.height>=0){writer.writeStartElement(undefined,'r',this.wNamespace);this.serializeCharacterFormat(writer,item.characterFormat);this.serializeDrawing(writer,item);writer.writeEndElement();//end of run element
}};// Serialize the drawing element.
WordExport.prototype.serializeDrawing=function(writer,draw){writer.writeStartElement(undefined,'drawing',this.wNamespace);if(draw.hasOwnProperty('chartType')){this.serializeInlineCharts(writer,draw);}else{if(draw.textWrappingStyle==='Inline'){this.serializeInlinePictureAndShape(writer,draw);}else{this.serializeWrappingPictureAndShape(writer,draw);}}writer.writeEndElement();};// Serialize the Other Wrapping picture & Shape.
WordExport.prototype.serializeWrappingPictureAndShape=function(writer,picture){writer.writeStartElement('wp','anchor',this.wpNamespace);this.serializePictureAndShapeDistance(writer,picture);writer.writeAttributeString(undefined,'simplePos',undefined,'0');writer.writeAttributeString(undefined,'relativeHeight',undefined,picture.zOrderPosition?Math.abs(picture.zOrderPosition).toString():'0');var behindText=picture.textWrappingStyle&&picture.textWrappingStyle==='Behind';writer.writeAttributeString(undefined,'behindDoc',undefined,behindText?'1':'0');var lockAnchor=picture.LockAnchor?'1':'0';writer.writeAttributeString(undefined,'locked',undefined,lockAnchor);var layoutcell=picture.layoutInCell?'1':'0';writer.writeAttributeString(undefined,'layoutInCell',undefined,layoutcell);var allowOverlap=picture.allowOverlap?'1':'0';writer.writeAttributeString(undefined,'allowOverlap',undefined,allowOverlap);writer.writeStartElement('wp','simplePos',this.wpNamespace);writer.writeAttributeString(undefined,'x',undefined,'0');writer.writeAttributeString(undefined,'y',undefined,'0');writer.writeEndElement();writer.writeStartElement('wp','positionH',this.wpNamespace);writer.writeAttributeString(undefined,'relativeFrom',undefined,HelperMethods.formatText("firstlower",picture.horizontalOrigin.toString()));if(picture.horizontalAlignment==='None'){writer.writeStartElement('wp','posOffset',this.wpNamespace);var horPos=Math.round(picture.horizontalPosition*this.emusPerPoint);writer.writeString(horPos.toString());writer.writeEndElement();//end of posOffset
}else{writer.writeStartElement('wp','align',this.wpNamespace);var horAlig=picture.horizontalAlignment.toString().toLowerCase();writer.writeString(horAlig);writer.writeEndElement();//end of align
}writer.writeEndElement();//end of postionH
writer.writeStartElement('wp','positionV',this.wpNamespace);writer.writeAttributeString(undefined,'relativeFrom',undefined,HelperMethods.formatText("firstlower",picture.verticalOrigin.toString()));if(picture.verticalAlignment==='None'){writer.writeStartElement('wp','posOffset',this.wpNamespace);var vertPos=Math.round(picture.verticalPosition*this.emusPerPoint);writer.writeString(vertPos.toString());writer.writeEndElement();// end of posOffset
}else{writer.writeStartElement('wp','align',this.wpNamespace);var verAlig=picture.verticalAlignment.toString().toLowerCase();writer.writeString(verAlig);writer.writeEndElement();//end of align
}writer.writeEndElement();//end of postionV
writer.writeStartElement(undefined,'extent',this.wpNamespace);var cx=Math.round(picture.width*this.emusPerPoint);writer.writeAttributeString(undefined,'cx',undefined,cx.toString());var cy=Math.round(picture.height*this.emusPerPoint);writer.writeAttributeString(undefined,'cy',undefined,cy.toString());writer.writeEndElement();if(!sf.base.isNullOrUndefined(picture.imageString)){// this.serializePicProperties(writer, draw);
this.serializeShapeWrapStyle(writer,picture);this.serializeDrawingGraphics(writer,picture);}else{this.serializeShapeDrawingGraphics(writer,picture);}writer.writeEndElement();// end of anchor
};// Serialize the inline picture & Shape.
WordExport.prototype.serializeInlinePictureAndShape=function(writer,draw){writer.writeStartElement(undefined,'inline',this.wpNamespace);this.writeDefaultDistAttribute(writer);writer.writeStartElement(undefined,'extent',this.wpNamespace);var cx=Math.round(draw.width*this.emusPerPoint);writer.writeAttributeString(undefined,'cx',undefined,cx.toString());var cy=Math.round(draw.height*this.emusPerPoint);writer.writeAttributeString(undefined,'cy',undefined,cy.toString());writer.writeEndElement();// double borderWidth = (double)picture.PictureShape.PictureDescriptor.BorderLeft.LineWidth / DLSConstants.BorderLineFactor;
// if (borderWidth > 0 && picture.DocxProps.length === 0) {
//     long leftTop = 0, rightBottom = 0;
//     picture.PictureShape.GetEffectExtent(borderWidth, ref leftTop, ref rightBottom);
//     m_writer.WriteStartElement('effectExtent', WP_namespace);
//     m_writer.WriteAttributeString('l', leftTop.ToString(CultureInfo.InvariantCulture));
//     m_writer.WriteAttributeString('t', leftTop.ToString(CultureInfo.InvariantCulture));
//     m_writer.WriteAttributeString('r', rightBottom.ToString(CultureInfo.InvariantCulture));
//     m_writer.WriteAttributeString('b', rightBottom.ToString(CultureInfo.InvariantCulture));
//     m_writer.WriteEndElement();
// }
//this.serializePicProperties(writer, image);
if(!sf.base.isNullOrUndefined(draw.imageString)){this.serializeShapeWrapStyle(writer,draw);this.serializeDrawingGraphics(writer,draw);}else{this.serializeShapeDrawingGraphics(writer,draw);}writer.writeEndElement();};WordExport.prototype.serializePictureAndShapeDistance=function(writer,draw){var top=draw.distanceTop?Math.round(draw.distanceTop*this.emusPerPoint).toString():'0';writer.writeAttributeString(undefined,'distT',undefined,top);var bottom=draw.distanceBottom?Math.round(draw.distanceBottom*this.emusPerPoint).toString():'0';writer.writeAttributeString(undefined,'distB',undefined,bottom);var left=draw.distanceLeft?Math.round(draw.distanceLeft*this.emusPerPoint).toString():'114300';writer.writeAttributeString(undefined,'distL',undefined,left);var right=draw.distanceRight?Math.round(draw.distanceRight*this.emusPerPoint).toString():'114300';writer.writeAttributeString(undefined,'distR',undefined,right);};WordExport.prototype.writeDefaultDistAttribute=function(writer){writer.writeAttributeString(undefined,'distT',undefined,'0');writer.writeAttributeString(undefined,'distB',undefined,'0');writer.writeAttributeString(undefined,'distL',undefined,'0');writer.writeAttributeString(undefined,'distR',undefined,'0');};// serialize inline chart
WordExport.prototype.serializeInlineCharts=function(writer,item){writer.writeStartElement(undefined,'inline',this.wpNamespace);this.writeDefaultDistAttribute(writer);writer.writeStartElement(undefined,'extent',this.wpNamespace);var cx=Math.round(item.width*this.emusPerPoint);writer.writeAttributeString(undefined,'cx',undefined,cx.toString());var cy=Math.round(item.height*this.emusPerPoint);writer.writeAttributeString(undefined,'cy',undefined,cy.toString());writer.writeEndElement();// end of wp:extend
writer.writeStartElement(undefined,'effectExtent',this.wpNamespace);writer.writeAttributeString(undefined,'l',undefined,'0');writer.writeAttributeString(undefined,'t',undefined,'0');writer.writeAttributeString(undefined,'r',undefined,'0');writer.writeAttributeString(undefined,'b',undefined,'0');writer.writeEndElement();// end of wp: effectExtent
this.serializeDrawingGraphicsChart(writer,item);writer.writeEndElement();// end of inline
};// Serialize the graphics element for chart.
WordExport.prototype.serializeDrawingGraphicsChart=function(writer,chart){var id='';id=this.updatechartId(chart);// Processing chart
writer.writeStartElement('wp','docPr',this.wpNamespace);writer.writeAttributeString(undefined,'id',undefined,(this.mDocPrID++).toString());writer.writeAttributeString(undefined,'name',undefined,this.getNextChartName());writer.writeEndElement();// end of wp docPr
writer.writeStartElement('wp','cNvGraphicFramePr',this.wpNamespace);writer.writeEndElement();// end of cNvGraphicFramePr
writer.writeStartElement('a','graphic',this.aNamespace);writer.writeStartElement('a','graphicData',this.aNamespace);writer.writeAttributeString(undefined,'uri',undefined,this.chartNamespace);writer.writeStartElement('c','chart',this.chartNamespace);writer.writeAttributeString('xmlns','r',undefined,this.rNamespace);writer.writeAttributeString('r','id',undefined,id);writer.writeEndElement();// end of chart
writer.writeEndElement();// end of graphic data
writer.writeEndElement();// end of graphic
};WordExport.prototype.getNextChartName=function(){return'Chart'+ ++this.chartCount;};// serialize chart
WordExport.prototype.serializeChart=function(writer,chart){writer.writeStartElement('w','r',this.wNamespace);this.serializeCharacterFormat(writer,chart.characterFormat);this.serializeDrawing(writer,chart);writer.writeEndElement();};WordExport.prototype.serializeChartStructure=function(){this.serializeChartXML();this.serializeChartColors();this.serializeChartExcelData();this.serializeChartRelations();this.chart=undefined;this.saveExcel();};// serialize Chart.xml
WordExport.prototype.serializeChartXML=function(){var chartPath='';var writer=new sf.fileutils.XmlWriter();writer.writeStartElement('c','chartSpace',this.chartNamespace);writer.writeAttributeString('xmlns','a',undefined,this.aNamespace);writer.writeAttributeString('xmlns','r',undefined,this.rNamespace);writer.writeAttributeString('xmlns','c16r2',undefined,this.c15Namespace);this.serializeChartData(writer,this.chart);writer.writeStartElement('c','externalData',this.chartNamespace);writer.writeAttributeString('r','id',undefined,'rId1');writer.writeStartElement('c','autoUpdate',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'0');writer.writeEndElement();// end of autoUpdate
writer.writeEndElement();// end of externalData
writer.writeEndElement();// end of chartSpace
chartPath=this.chartPath+'/chart'+this.chartCount+'.xml';var zipArchiveItem=new sf.compression.ZipArchiveItem(writer.buffer,chartPath);this.mArchive.addItem(zipArchiveItem);};// serialize chart colors.xml
WordExport.prototype.serializeChartColors=function(){var writer=new sf.fileutils.XmlWriter();var colorPath='';writer.writeStartElement('cs','colorStyle',this.csNamespace);writer.writeAttributeString('xmlns','a',undefined,this.aNamespace);writer.writeAttributeString(undefined,'meth',undefined,'cycle');writer.writeAttributeString(undefined,'id',undefined,'10');this.serializeChartColor(writer);colorPath=this.chartPath+'/colors'+this.chartCount+'.xml';writer.writeEndElement();// end of cs:colorStyle chart color
var zipArchiveItem=new sf.compression.ZipArchiveItem(writer.buffer,colorPath);this.mArchive.addItem(zipArchiveItem);colorPath='';};WordExport.prototype.serializeChartColor=function(writer){for(var i=1;i<=6;i++){writer.writeStartElement('a','schemeClr',this.aNamespace);writer.writeAttributeString(undefined,'val',undefined,'accent'+i);writer.writeEndElement();// end of a:schemeClr
}writer.writeStartElement('cs','variation',this.csNamespace);writer.writeEndElement();// end of cs:variation
writer.writeStartElement('cs','variation',this.csNamespace);writer.writeStartElement('a','lumMod',this.aNamespace);writer.writeAttributeString(undefined,'val',undefined,'60000');writer.writeEndElement();// end of lumMod
writer.writeEndElement();// end of cs:variation
writer.writeStartElement('cs','variation',this.csNamespace);writer.writeStartElement('a','lumMod',this.aNamespace);writer.writeAttributeString(undefined,'val',undefined,'80000');writer.writeEndElement();// end of lumMod
writer.writeStartElement('a','lumOff',this.aNamespace);writer.writeAttributeString(undefined,'val',undefined,'20000');writer.writeEndElement();// end of lumoff
writer.writeEndElement();// end of cs:variation
writer.writeStartElement('cs','variation',this.csNamespace);writer.writeStartElement('a','lumMod',this.aNamespace);writer.writeAttributeString(undefined,'val',undefined,'80000');writer.writeEndElement();// end of lumMod
writer.writeEndElement();// end of cs:variation
writer.writeStartElement('cs','variation',this.csNamespace);writer.writeStartElement('a','lumMod',this.aNamespace);writer.writeAttributeString(undefined,'val',undefined,'60000');writer.writeEndElement();// end of lumMod
writer.writeStartElement('a','lumOff',this.aNamespace);writer.writeAttributeString(undefined,'val',undefined,'40000');writer.writeEndElement();// end of lumoff
writer.writeEndElement();// end of cs:variation
writer.writeStartElement('cs','variation',this.csNamespace);writer.writeStartElement('a','lumMod',this.aNamespace);writer.writeAttributeString(undefined,'val',undefined,'50000');writer.writeEndElement();// end of lumMod
writer.writeEndElement();// end of cs:variation
writer.writeStartElement('cs','variation',this.csNamespace);writer.writeStartElement('a','lumMod',this.aNamespace);writer.writeAttributeString(undefined,'val',undefined,'70000');writer.writeEndElement();// end of lumMod
writer.writeStartElement('a','lumOff',this.aNamespace);writer.writeAttributeString(undefined,'val',undefined,'30000');writer.writeEndElement();// end of lumoff
writer.writeEndElement();// end of cs:variation
writer.writeStartElement('cs','variation',this.csNamespace);writer.writeStartElement('a','lumMod',this.aNamespace);writer.writeAttributeString(undefined,'val',undefined,'70000');writer.writeEndElement();// end of lumMod
writer.writeEndElement();// end of cs:variation
writer.writeStartElement('cs','variation',this.csNamespace);writer.writeStartElement('a','lumMod',this.aNamespace);writer.writeAttributeString(undefined,'val',undefined,'50000');writer.writeEndElement();// end of lumMod
writer.writeStartElement('a','lumOff',this.aNamespace);writer.writeAttributeString(undefined,'val',undefined,'50000');writer.writeEndElement();// end of lumoff
writer.writeEndElement();// end of cs:variation
};// serialize chart Excel Data
WordExport.prototype.serializeChartExcelData=function(){if(sf.base.isNullOrUndefined(this.excelFiles)){this.excelFiles=new Dictionary();}this.mArchiveExcel=new sf.compression.ZipArchive();this.mArchiveExcel.compressionLevel='Normal';var type=this.chart.chartType;var isScatterType=type==='Scatter_Markers'||type==='Bubble';this.serializeWorkBook();this.serializeSharedString(isScatterType);this.serializeExcelContentTypes();this.serializeExcelData(isScatterType);this.serializeExcelStyles();this.serializeExcelRelation();this.serializeExcelGeneralRelations();this.chartStringCount=0;};WordExport.prototype.serializeWorkBook=function(){var writer=new sf.fileutils.XmlWriter();var workbookPath='xl/workbook.xml';this.resetExcelRelationShipId();writer.writeStartElement(undefined,'workbook',undefined);writer.writeAttributeString('xmlns','r',undefined,this.rNamespace);writer.writeAttributeString('xmlns',undefined,undefined,this.spreadSheetNamespace);writer.writeStartElement(undefined,'sheets',undefined);writer.writeStartElement(undefined,'sheet',undefined);writer.writeAttributeString(undefined,'name',undefined,'Sheet1');writer.writeAttributeString(undefined,'sheetId',undefined,'1');writer.writeAttributeString('r','id',undefined,this.getNextExcelRelationShipID());writer.writeEndElement();// end of sheet
writer.writeEndElement();// end of sheets
writer.writeEndElement();// end of workbook
var zipArchiveItem=new sf.compression.ZipArchiveItem(writer.buffer,workbookPath);this.mArchiveExcel.addItem(zipArchiveItem);};WordExport.prototype.serializeExcelStyles=function(){var writer=new sf.fileutils.XmlWriter();var stylePath='xl/styles.xml';writer.writeStartElement(undefined,'styleSheet',undefined);writer.writeAttributeString('xmlns','mc',undefined,this.veNamespace);writer.writeAttributeString('mc','Ignorable',undefined,'x14ac');writer.writeAttributeString('xmlns','x14ac',undefined,'http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac');writer.writeAttributeString('xmlns',undefined,undefined,this.spreadSheetNamespace);writer.writeEndElement();// end of styleSheet
var zipArchiveItem=new sf.compression.ZipArchiveItem(writer.buffer,stylePath);this.mArchiveExcel.addItem(zipArchiveItem);};WordExport.prototype.serializeExcelData=function(isScatterType){// excel data
var sheetPath='';var writer=new sf.fileutils.XmlWriter();writer.writeStartElement(undefined,'worksheet',undefined);writer.writeAttributeString('xmlns','r',undefined,this.rNamespace);writer.writeAttributeString('xmlns','x14',undefined,this.spreadSheet9);writer.writeAttributeString('xmlns','mc',undefined,this.veNamespace);writer.writeAttributeString('xmlns',undefined,undefined,this.spreadSheetNamespace);this.serializeExcelSheet(writer,isScatterType);writer.writeEndElement();// end of worksheet
sheetPath='xl/worksheets'+'/sheet1.xml';var zipArchiveItem=new sf.compression.ZipArchiveItem(writer.buffer,sheetPath);this.mArchiveExcel.addItem(zipArchiveItem);};WordExport.prototype.serializeSharedString=function(isScatterType){var chart=this.chart;var writer=new sf.fileutils.XmlWriter();var sharedStringPath='';var chartSharedString=[];var type=this.chart.chartType;var seriesLength=chart.chartSeries.length;for(var column=0;column<seriesLength;column++){var series=chart.chartSeries[column];var seriesName=series.seriesName;var isString=seriesName.match(/[a-z]/i);if(isScatterType&&column===0){chartSharedString.push('X-Values');}if(isString){chartSharedString.push(series.seriesName);this.chartStringCount++;}}if(type==='Bubble'){chartSharedString.push('Size');}for(var row=0;row<chart.chartCategory.length;row++){var category=chart.chartCategory[row];var format=chart.chartPrimaryCategoryAxis.numberFormat;var categoryName=category.categoryXName;var isString=categoryName.match(/[a-z]/i);if(isString||format==='m/d/yyyy'){chartSharedString.push(category.categoryXName);this.chartStringCount++;}}var uniqueCount=this.chartStringCount+1;writer.writeStartElement(undefined,'sst',undefined);writer.writeAttributeString('xmlns',undefined,undefined,this.spreadSheetNamespace);writer.writeAttributeString(undefined,'count',undefined,uniqueCount.toString());writer.writeAttributeString(undefined,'uniqueCount',undefined,uniqueCount.toString());for(var i=0;i<=chartSharedString.length;i++){writer.writeStartElement(undefined,'si',undefined);writer.writeStartElement(undefined,'t',undefined);if(i!==chartSharedString.length){writer.writeString(chartSharedString[i]);}else if(!isScatterType){writer.writeAttributeString('xml','space',this.xmlNamespace,'preserve');writer.writeString(' ');}writer.writeEndElement();// end of t
writer.writeEndElement();// end of si
}writer.writeEndElement();// end of sst
sharedStringPath='xl/sharedStrings'+'.xml';var zipArchiveItem=new sf.compression.ZipArchiveItem(writer.buffer,sharedStringPath);this.mArchiveExcel.addItem(zipArchiveItem);};// excel sheet data
WordExport.prototype.serializeExcelSheet=function(writer,isScatterType){var chart=this.chart;var type='s';var isBubbleType=chart.chartType==='Bubble';var bubbleLength;var categoryLength=chart.chartCategory.length+1;var format=chart.chartPrimaryCategoryAxis.numberFormat;var seriesLength=chart.chartSeries.length+1;if(isBubbleType){bubbleLength=seriesLength;seriesLength=seriesLength+1;}var category=undefined;var series=undefined;var count=0;writer.writeStartElement(undefined,'sheetData',undefined);for(var row=0;row<categoryLength;row++){writer.writeStartElement(undefined,'row',undefined);writer.writeAttributeString(undefined,'r',undefined,(row+1).toString());for(var column=0;column<seriesLength;column++){var alphaNumeric=String.fromCharCode('A'.charCodeAt(0)+column)+(row+1).toString();writer.writeStartElement(undefined,'c',undefined);writer.writeAttributeString(undefined,'r',undefined,alphaNumeric);if(row!==0&&column===0){category=chart.chartCategory[row-1];var categoryName=category.categoryXName;var isString=categoryName.match(/[a-z]/i);if(sf.base.isNullOrUndefined(isString)&&format==='m/d/yyyy'){type='s';}else if(!isString&&!sf.base.isNullOrUndefined(isString)||isScatterType){type='n';}else{type='s';}}else if(row===0&&column!==0&&column!==bubbleLength){series=chart.chartSeries[column-1];var seriesName=series.seriesName;var isString=seriesName.match(/[a-z]/i);if(!isString){type='n';}else{type='s';}}else if(row===0&&isBubbleType&&column===bubbleLength){type='s';}else if(row===0&&column===0){type='s';}else{type='n';}writer.writeAttributeString(undefined,'t',undefined,type);writer.writeStartElement(undefined,'v',undefined);if(row===0&&column===0&&!isScatterType){writer.writeString(this.chartStringCount.toString());}else if(type==='s'){writer.writeString(count.toString());count++;}else if(row!==0&&type!=='s'&&column===0&&column!==bubbleLength){writer.writeString(category.categoryXName);}else if(column!==0&&type!=='s'&&row===0&&column!==bubbleLength){writer.writeString(series.seriesName);}else if(column!==0&&column!==bubbleLength){var data=category.chartData[column-1];var yValue=data.yValue;writer.writeString(yValue.toString());}else if(isBubbleType&&column===bubbleLength){var data=category.chartData[column-2];var size=data.size;writer.writeString(size.toString());}writer.writeEndElement();// end of v[value]
writer.writeEndElement();// end of c[column]
type='';}writer.writeEndElement();// end of row
}writer.writeEndElement();// end of sheetData
};// excel content types
WordExport.prototype.serializeExcelContentTypes=function(){var writer=new sf.fileutils.XmlWriter();writer.writeStartElement(undefined,'Types','http://schemas.openxmlformats.org/package/2006/content-types');this.serializeDefaultContentType(writer,'xml',this.xmlContentType);this.serializeDefaultContentType(writer,'rels',this.relationContentType);this.serializeOverrideContentType(writer,'xl/styles.xml','application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml');this.serializeOverrideContentType(writer,'xl/workbook.xml','application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml');// this.serializeOverrideContentType(writer, '/docProps/app.xml', 'application/vnd.openxmlformats-officedocument.extended-properties+xml');
// this.serializeOverrideContentType(writer, '/docProps/core.xml', 'application/vnd.openxmlformats-package.core-properties+xml');
this.serializeOverrideContentType(writer,'xl/sharedStrings.xml','application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml');this.serializeOverrideContentType(writer,'xl/worksheets/sheet1.xml','application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml');writer.writeEndElement();// end of types tag
var zipArchiveItem=new sf.compression.ZipArchiveItem(writer.buffer,this.contentTypesPath);this.mArchiveExcel.addItem(zipArchiveItem);};WordExport.prototype.serializeExcelRelation=function(){var writer=new sf.fileutils.XmlWriter();this.resetExcelRelationShipId();var worksheetType='http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet';var sharedStringType='http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings';writer.writeStartElement(undefined,'Relationships',this.rpNamespace);this.serializeRelationShip(writer,this.getNextExcelRelationShipID(),worksheetType,'worksheets/sheet1.xml');this.serializeRelationShip(writer,this.getNextExcelRelationShipID(),this.stylesRelType,'styles.xml');this.serializeRelationShip(writer,this.getNextExcelRelationShipID(),sharedStringType,'sharedStrings.xml');writer.writeEndElement();// end of relationships
var zipArchiveItem=new sf.compression.ZipArchiveItem(writer.buffer,this.excelRelationPath);this.mArchiveExcel.addItem(zipArchiveItem);};WordExport.prototype.serializeExcelGeneralRelations=function(){var writer=new sf.fileutils.XmlWriter();this.resetExcelRelationShipId();writer.writeStartElement(undefined,'Relationships',this.rpNamespace);this.serializeRelationShip(writer,this.getNextExcelRelationShipID(),this.documentRelType,'xl/workbook.xml');writer.writeEndElement();// end of relationships
var zipArchiveItem=new sf.compression.ZipArchiveItem(writer.buffer,this.generalRelationPath);this.mArchiveExcel.addItem(zipArchiveItem);};// get the next Excel relationship ID
WordExport.prototype.getNextExcelRelationShipID=function(){return'rId'+ ++this.eRelationShipId;};// get the next Chart relationship ID
WordExport.prototype.getNextChartRelationShipID=function(){return'rId'+ ++this.cRelationShipId;};//  chart data
WordExport.prototype.serializeChartData=function(writer,chart){writer.writeStartElement('c','date1904',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'0');writer.writeEndElement();writer.writeStartElement('c','lang',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'en-US');writer.writeEndElement();writer.writeStartElement('c','roundedCorners',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'0');writer.writeEndElement();writer.writeStartElement('mc','AlternateContent',this.veNamespace);writer.writeStartElement('mc','Choice',this.veNamespace);writer.writeAttributeString('xmlns','c14',undefined,this.c7Namespace);writer.writeAttributeString(undefined,'Requires',undefined,'c14');writer.writeStartElement('c14','style',undefined);writer.writeAttributeString(undefined,'val',undefined,'102');writer.writeEndElement();// c14 style end
writer.writeEndElement();// mc:choice ened
writer.writeStartElement('mc','Fallback',this.veNamespace);writer.writeStartElement('c','style',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'2');writer.writeEndElement();writer.writeEndElement();writer.writeEndElement();// end tag of mc alternate content
writer.writeStartElement('c','chart',this.chartNamespace);if(!sf.base.isNullOrUndefined(this.chart.chartTitle)){writer.writeStartElement('c','title',this.chartNamespace);this.serializeTextProperties(writer,this.chart.chartTitleArea,this.chart.chartTitle);writer.writeEndElement();// end tag of title
}// serialize plot area
this.serializeChartPlotArea(writer,chart);writer.writeEndElement();// end tag of chart
this.serializeShapeProperties(writer,'D9D9D9',true);writer.writeStartElement('c','txPr',this.chartNamespace);writer.writeAttributeString('xmlns','c',undefined,this.chartNamespace);writer.writeStartElement('a','bodyPr',this.aNamespace);writer.writeAttributeString('xmlns','a',undefined,this.aNamespace);writer.writeEndElement();// end tag of bodyPr
writer.writeStartElement('a','lstStyle',this.aNamespace);writer.writeAttributeString('xmlns','a',undefined,this.aNamespace);writer.writeEndElement();// end of a:lstStyle
writer.writeStartElement('a','p',this.aNamespace);writer.writeAttributeString('xmlns','a',undefined,this.aNamespace);writer.writeStartElement('a','pPr',this.aNamespace);writer.writeStartElement('a','defRPr',this.aNamespace);writer.writeEndElement();// end tag of defRPr
writer.writeEndElement();// end tag of pPr
writer.writeStartElement('a','endParaRPr',this.aNamespace);writer.writeAttributeString(undefined,'lang',undefined,'en-US');writer.writeEndElement();// end of a:endParaRPr
writer.writeEndElement();// end tag of p
writer.writeEndElement();// end tag of txPr
};//  chart plot area
/* eslint-disable */WordExport.prototype.serializeChartPlotArea=function(writer,chart){writer.writeStartElement('c','autoTitleDeleted',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'0');writer.writeEndElement();// end of autoTitleDeleted
writer.writeStartElement('c','plotArea',this.chartNamespace);writer.writeStartElement('c','layout',this.chartNamespace);writer.writeEndElement();// chart Type
var serializationChartType=this.chartType(chart);var isPieTypeSerialization=serializationChartType==='pieChart'||serializationChartType==='doughnutChart';var isScatterType=serializationChartType==='scatterChart'||serializationChartType==='bubbleChart';writer.writeStartElement('c',serializationChartType,this.chartNamespace);if(serializationChartType==='barChart'){var barDiv='';if(chart.chartType==='Column_Clustered'||chart.chartType==='Column_Stacked'||chart.chartType==='Column_Stacked_100'){barDiv='col';}else{barDiv='bar';}writer.writeStartElement('c','barDir',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,barDiv);writer.writeEndElement();// end of barDir
}if(!isPieTypeSerialization&&!isScatterType){var grouping=this.chartGrouping(chart.chartType);writer.writeStartElement('c','grouping',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,grouping);writer.writeEndElement();// end of grouping
}if(serializationChartType==='scatterChart'){writer.writeStartElement('c','scatterStyle',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'marker');writer.writeEndElement();// end of scatterStyle
}writer.writeStartElement('c','varyColors',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'0');writer.writeEndElement();// end of c:varyColors
var valueSheet='';for(var i=0;i<chart.chartSeries.length;i++){var series=chart.chartSeries[i];this.seriesCount=i;writer.writeStartElement('c','ser',this.chartNamespace);writer.writeStartElement('c','idx',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,i.toString());writer.writeEndElement();// end of c:idx
writer.writeStartElement('c','order',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,i.toString());writer.writeEndElement();// end of c:order
writer.writeStartElement('c','tx',this.chartNamespace);writer.writeStartElement('c','strRef',this.chartNamespace);writer.writeStartElement('c','f',this.chartNamespace);var alphaNumeric=String.fromCharCode('B'.charCodeAt(0)+i);valueSheet='Sheet1!$'+alphaNumeric;writer.writeString(valueSheet+'$1');valueSheet=valueSheet+'$2:$'+alphaNumeric+'$';writer.writeEndElement();// end of c:f
writer.writeStartElement('c','strCache',this.chartNamespace);writer.writeStartElement('c','ptCount',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'1');writer.writeEndElement();// end of ptCount
writer.writeStartElement('c','pt',this.chartNamespace);writer.writeAttributeString(undefined,'idx',undefined,'0');writer.writeStartElement('c','v',this.chartNamespace);writer.writeString(series.seriesName);writer.writeEndElement();// end of c:v
writer.writeEndElement();// end of pt
writer.writeEndElement();// end of strCache
writer.writeEndElement();// end of strRef
writer.writeEndElement();// end of tx
if(chart.chartType==='Pie'||chart.chartType==='Doughnut'){this.parseChartDataPoint(writer,series);writer.writeStartElement('c','explosion',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'0');writer.writeEndElement();// end of explosion
}else if(!isScatterType){this.parseChartSeriesColor(writer,series.dataPoints,serializationChartType);}if(serializationChartType==='scatterChart'){var fillColor=series.dataPoints[0].fill.foreColor;writer.writeStartElement('c','marker',this.chartNamespace);writer.writeStartElement('c','symbol',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'circle');writer.writeEndElement();// end of a: symbol
writer.writeStartElement('c','size',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'5');writer.writeEndElement();// end of a: size
this.serializeShapeProperties(writer,fillColor,false);writer.writeEndElement();// end of a: marker
}if(series.dataLabel){this.parseChartDataLabels(writer,series.dataLabel);}if(series.trendLines){this.parseChartTrendLines(writer,series);}if(series.errorBar){this.serializeChartErrorBar(writer,series);}if(serializationChartType==='scatterChart'){this.serializeDefaultShapeProperties(writer);}else if(serializationChartType==='bubbleChart'){this.serializeShapeProperties(writer,series.dataPoints[i].fill.foreColor,false);}var categoryType='cat';var categoryRef='strRef';var cacheType='strCache';if(serializationChartType==='scatterChart'){categoryType='xVal';categoryRef='numRef';cacheType='numCache';}writer.writeStartElement('c',categoryType,this.chartNamespace);writer.writeStartElement('c',categoryRef,this.chartNamespace);this.serializeChartCategory(writer,chart,cacheType);// serialize chart yvalue
writer.writeEndElement();// end of categoryRef
writer.writeEndElement();// end of cat
this.serializeChartValue(writer,valueSheet,serializationChartType);writer.writeEndElement();// end of c:ser
}writer.writeStartElement('c','dLbls',this.chartNamespace);if(isPieTypeSerialization){writer.writeStartElement('c','dLblPos',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'bestFit');writer.writeEndElement();// end of dLblPos
}writer.writeStartElement('c','showLegendKey',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'0');writer.writeEndElement();// end of c: showLegendKey
writer.writeStartElement('c','showVal',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'0');writer.writeEndElement();// end of c: showVal
writer.writeStartElement('c','showCatName',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'0');writer.writeEndElement();// end of c: showCatName
writer.writeStartElement('c','showSerName',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'0');writer.writeEndElement();// end of c: showSerName
writer.writeStartElement('c','showPercent',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'0');writer.writeEndElement();// end of c: showPercent
writer.writeStartElement('c','showBubbleSize',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'0');writer.writeEndElement();// end of c: showBubbleSize
writer.writeStartElement('c','showLeaderLines',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'1');writer.writeEndElement();// end of c: showLeaderLines
writer.writeEndElement();// end of c: dLbls
if(isPieTypeSerialization){var series=this.chart.chartSeries[0];var sliceAngle=0;var holeSize=0;if(series.hasOwnProperty('firstSliceAngle')){sliceAngle=series.firstSliceAngle;}writer.writeStartElement('c','firstSliceAng',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,sliceAngle.toString());writer.writeEndElement();// end of c: firstSliceAng
if(chart.chartType==='Doughnut'){holeSize=series.holeSize;writer.writeStartElement('c','holeSize',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,holeSize.toString());writer.writeEndElement();// end of c: holeSize
}}if(serializationChartType!=='lineChart'&&!isScatterType){writer.writeStartElement('c','gapWidth',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,this.chart.gapWidth.toString());writer.writeEndElement();// end of gapWidth
writer.writeStartElement('c','overlap',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,this.chart.overlap.toString());writer.writeEndElement();// end of overlap
}else if(serializationChartType!=='bubbleChart'){writer.writeStartElement('c','smooth',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'0');writer.writeEndElement();// end of smooth
}if(serializationChartType==='bubbleChart'){writer.writeStartElement('c','sizeRepresents',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'area');writer.writeEndElement();// end of smooth
}var type=this.chart.chartType;if(!isPieTypeSerialization){writer.writeStartElement('c','axId',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'335265000');writer.writeEndElement();// end of axId
writer.writeStartElement('c','axId',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'335263360');writer.writeEndElement();// end of axId
}writer.writeEndElement();// end of chart type
var isStackedPercentage=type==='Column_Stacked_100'||type==='Area_Stacked_100'||type==='Bar_Stacked_100'||type==='Line_Stacked_100'||type==='Line_Markers_Stacked_100';var format=this.chart.chartPrimaryCategoryAxis.categoryType;if(!isPieTypeSerialization){this.serializeCategoryAxis(writer,format,isStackedPercentage);this.serializeValueAxis(writer,format,isStackedPercentage);}if(this.chart.hasOwnProperty('chartDataTable')){var dataTable=this.chart.chartDataTable;var showHorzBorder=0;var showVertBorder=0;var showOutline=0;var showKeys=0;if(dataTable.showSeriesKeys){showKeys=1;}if(dataTable.hasHorzBorder){showHorzBorder=1;}if(dataTable.hasVertBorder){showVertBorder=1;}if(dataTable.hasBorders){showOutline=1;}writer.writeStartElement('c','dTable',this.chartNamespace);writer.writeStartElement('c','showHorzBorder',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,showHorzBorder.toString());writer.writeEndElement();// end of showHorzBorder
writer.writeStartElement('c','showVertBorder',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,showVertBorder.toString());writer.writeEndElement();// end of showVertBorder
writer.writeStartElement('c','showOutline',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,showOutline.toString());writer.writeEndElement();// end of showOutline
writer.writeStartElement('c','showKeys',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,showKeys.toString());writer.writeEndElement();// end of showKeys
writer.writeEndElement();// end of dTable
}this.serializeDefaultShapeProperties(writer);writer.writeEndElement();// end of plot area
// legend
if(!sf.base.isNullOrUndefined(this.chart.chartLegend.position)){this.serializeChartLegend(writer);}writer.writeStartElement('c','plotVisOnly',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'1');writer.writeEndElement();// end of c: plotVisOnly
writer.writeStartElement('c','dispBlanksAs',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'gap');writer.writeEndElement();// end of c: dispBlanksAs
};WordExport.prototype.serializeChartLegend=function(writer){var legendPosition=this.chartLegendPosition(this.chart.chartLegend);var title=this.chart.chartLegend.chartTitleArea;var fill=title.dataFormat.fill.foreColor;writer.writeStartElement('c','legend',this.chartNamespace);writer.writeStartElement('c','legendPos',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,legendPosition);writer.writeEndElement();writer.writeStartElement('c','overlay',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'0');writer.writeEndElement();this.serializeDefaultShapeProperties(writer);writer.writeStartElement('c','txPr',this.chartNamespace);writer.writeStartElement('a','bodyPr',this.aNamespace);writer.writeEndElement();writer.writeStartElement('a','lstStyle',this.aNamespace);writer.writeEndElement();writer.writeStartElement('a','p',this.aNamespace);this.serializeChartTitleFont(writer,title.fontSize,fill,title.fontName);writer.writeEndElement();writer.writeEndElement();writer.writeEndElement();};WordExport.prototype.serializeChartErrorBar=function(writer,series){var errorBar=series.errorBar;var errorBarValueType=this.errorBarValueType(errorBar.type);var endStyle=0;if(errorBar.endStyle!=='Cap'){endStyle=1;}writer.writeStartElement('c','errBars',this.chartNamespace);writer.writeStartElement('c','errBarType',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,errorBar.direction.toLowerCase());writer.writeEndElement();// end of c: errBarType
writer.writeStartElement('c','errValType',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,errorBarValueType);writer.writeEndElement();// end of c: errValType
writer.writeStartElement('c','noEndCap',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,endStyle.toString());writer.writeEndElement();// end of c: noEndCap
writer.writeStartElement('c','val',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,errorBar.numberValue.toString());writer.writeEndElement();// end of c: val
this.serializeShapeProperties(writer,'595959',true);writer.writeEndElement();// end of c: errBars
};WordExport.prototype.errorBarValueType=function(type){var valueType='';switch(type){case'StandardError':valueType='stdErr';break;case'StandardDeviation':valueType='stdDev';break;case'Percentage':valueType='percentage';break;case'Fixed':valueType='fixedVal';break;default:valueType='stdErr';break;}return valueType;};WordExport.prototype.serializeCategoryAxis=function(writer,format,isStackedPercentage){// serialize category axis
var axisType='catAx';var formatCode=this.chart.chartPrimaryCategoryAxis.numberFormat;var type=this.chart.chartType;var isScatterType=type==='Scatter_Markers'||type==='Bubble';if(format==='Time'){axisType='dateAx';}if(isScatterType){axisType='valAx';}writer.writeStartElement('c',axisType,this.chartNamespace);writer.writeStartElement('c','axId',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'335265000');writer.writeEndElement();// end of axId
this.serializeAxis(writer,'335263360',this.chart.chartPrimaryCategoryAxis,formatCode,isStackedPercentage);if(!isScatterType){writer.writeStartElement('c','auto',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'1');writer.writeEndElement();// end of auto
writer.writeStartElement('c','lblAlgn',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'ctr');writer.writeEndElement();// end of lblAlgn
writer.writeStartElement('c','lblOffset',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'100');writer.writeEndElement();// end of lblOffset
}if(format==='Time'){writer.writeStartElement('c','baseTimeUnit',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'days');writer.writeEndElement();// end of baseTimeUnit
}else if(this.chart.chartType!=='Bubble'){writer.writeStartElement('c','noMultiLvlLbl',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'0');writer.writeEndElement();// end of noMultiLvlLbl
}writer.writeEndElement();// end of catAx
};WordExport.prototype.serializeValueAxis=function(writer,format,isStackedPercentage){// serialize category axis
var valueAxis=this.chart.chartPrimaryValueAxis;var crossBetween='between';if(format==='Time'){crossBetween='midCat';}writer.writeStartElement('c','valAx',this.chartNamespace);writer.writeStartElement('c','axId',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'335263360');writer.writeEndElement();// end of axId
this.serializeAxis(writer,'335265000',valueAxis,'General',isStackedPercentage);writer.writeStartElement('c','crossBetween',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,crossBetween);writer.writeEndElement();// end of crossBetween
if(valueAxis.majorUnit!==0&&!isStackedPercentage){writer.writeStartElement('c','majorUnit',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,valueAxis.majorUnit.toString());writer.writeEndElement();// end of majorUnit
}writer.writeEndElement();// end of valAx
};WordExport.prototype.serializeAxis=function(writer,axisID,axis,formatCode,isStackedPercentage){var majorTickMark='none';var minorTickMark='none';var tickLabelPosition='nextTo';writer.writeStartElement('c','scaling',this.chartNamespace);writer.writeStartElement('c','orientation',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'minMax');writer.writeEndElement();// end of orientation
if(axis.maximumValue!==0&&!isStackedPercentage){writer.writeStartElement('c','max',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,axis.maximumValue.toString());writer.writeEndElement();// end of max
writer.writeStartElement('c','min',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,axis.minimumValue.toString());writer.writeEndElement();// end of min
}writer.writeEndElement();// end of scaling
writer.writeStartElement('c','delete',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'0');writer.writeEndElement();// end of delete
writer.writeStartElement('c','axPos',this.chartNamespace);if(axisID==='335265000'){writer.writeAttributeString(undefined,'val',undefined,'l');}else{writer.writeAttributeString(undefined,'val',undefined,'b');}writer.writeEndElement();// end of axPos
if(axis.hasMajorGridLines){writer.writeStartElement('c','majorGridlines',this.chartNamespace);this.serializeShapeProperties(writer,'D9D9D9',true);writer.writeEndElement();// end of majorGridlines
}if(axis.hasMinorGridLines){writer.writeStartElement('c','minorGridlines',this.chartNamespace);this.serializeShapeProperties(writer,'F2F2F2',true);writer.writeEndElement();// end of minorGridlines
}if(axis.chartTitle){writer.writeStartElement('c','title',this.chartNamespace);this.serializeTextProperties(writer,axis.chartTitleArea,axis.chartTitle);writer.writeEndElement();// end tag of title
}writer.writeStartElement('c','numFmt',this.chartNamespace);writer.writeAttributeString(undefined,'formatCode',undefined,formatCode);writer.writeAttributeString(undefined,'sourceLinked',undefined,'1');writer.writeEndElement();// end of numFmt
writer.writeStartElement('c','majorTickMark',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,majorTickMark);writer.writeEndElement();// end of majorTickMark
writer.writeStartElement('c','minorTickMark',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,minorTickMark);writer.writeEndElement();// end of minorTickMark
writer.writeStartElement('c','tickLblPos',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,tickLabelPosition);writer.writeEndElement();// end of tickLblPos
if(this.chart.chartType==='Bubble'){this.serializeShapeProperties(writer,'BFBFBF',true);}else{this.serializeDefaultShapeProperties(writer);}writer.writeStartElement('c','txPr',this.chartNamespace);writer.writeStartElement('a','bodyPr',this.aNamespace);writer.writeEndElement();// end of bodyPr
writer.writeStartElement('a','p',this.aNamespace);this.serializeChartTitleFont(writer,axis.fontSize,'595959',axis.fontName);writer.writeEndElement();// end of a: p
writer.writeEndElement();// end of c: txPr
writer.writeStartElement('c','crossAx',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,axisID);writer.writeEndElement();// end of crossAx
writer.writeStartElement('c','crosses',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'autoZero');writer.writeEndElement();// end of crosses
};WordExport.prototype.parseChartTrendLines=function(writer,series){for(var i=0;i<series.trendLines.length;i++){var data=series.trendLines[i];var type=this.chartTrendLineType(data.type);var dispRSqr=0;var dispEq=0;if(data.isDisplayEquation){dispEq=1;}else if(data.isDisplayRSquared){dispRSqr=1;}var solidFill=series.dataPoints[i];writer.writeStartElement('c','trendline',this.chartNamespace);writer.writeStartElement('c','spPr',this.chartNamespace);writer.writeStartElement('a','ln',this.aNamespace);writer.writeAttributeString(undefined,'w',undefined,'19050');this.serializeChartSolidFill(writer,solidFill.fill.foreColor,false);writer.writeStartElement('a','prstDash',this.aNamespace);writer.writeAttributeString(undefined,'val',undefined,'sysDot');writer.writeEndElement();// end of a: prstDash
writer.writeStartElement('a','round',this.aNamespace);writer.writeEndElement();// end of a: round
writer.writeEndElement();// end of a: ln
writer.writeEndElement();// end of c: spPr
writer.writeStartElement('c','trendlineType',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,type);writer.writeEndElement();// end of c: trendlineType
writer.writeStartElement('c','forward',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,data.forward.toString());writer.writeEndElement();// end of c: forward
writer.writeStartElement('c','backward',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,data.backward.toString());writer.writeEndElement();// end of c: backward
if(data.intercept!=='NaN'){writer.writeStartElement('c','intercept',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,data.intercept.toString());writer.writeEndElement();// end of c: intercept
}writer.writeStartElement('c','dispRSqr',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,dispRSqr.toString());writer.writeEndElement();// end of c: dispRSqr
writer.writeStartElement('c','dispEq',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,dispEq.toString());writer.writeEndElement();// end of c: dispEq
writer.writeEndElement();// end of c: trendline
}};WordExport.prototype.chartTrendLineType=function(type){var trendlineType='';switch(type){case'Linear':trendlineType='linear';break;case'Exponential':trendlineType='exp';break;}return trendlineType;};WordExport.prototype.parseChartDataLabels=function(writer,dataLabels){var position='';var dataLabelPosition=dataLabels.position;var isLegendKey=0;var isBubbleSize=0;var isCategoryName=0;var isSeriesName=0;var isValue=0;var isPercentage=0;var isLeaderLines=0;switch(dataLabelPosition){case'Center':position='ctr';break;case'Left':position='l';break;case'Right':position='r';break;case'Outside':position='outEnd';break;case'BestFit':position='bestFit';break;case'Bottom':case'OutsideBase':position='inBase';break;case'Inside':position='inEnd';break;case'Above':position='t';break;case'Below':position='b';break;default:position='Automatic';break;}writer.writeStartElement('c','dLbls',this.chartNamespace);this.serializeDefaultShapeProperties(writer);writer.writeStartElement('c','txPr',this.chartNamespace);writer.writeStartElement('a','bodyPr',this.aNamespace);writer.writeEndElement();//end of a:bodyPr.
writer.writeStartElement('a','lstStyle',this.aNamespace);writer.writeEndElement();//end of a:lstStyle.
writer.writeStartElement('a','p',this.aNamespace);this.serializeChartTitleFont(writer,dataLabels.fontSize,dataLabels.fontColor,dataLabels.fontName);writer.writeEndElement();//end of a:p.
writer.writeEndElement();//end of c:txPr.
if(dataLabels.isLegendKey){isLegendKey=1;}else if(dataLabels.isBubbleSize){isBubbleSize=1;}else if(dataLabels.isCategoryName){isCategoryName=1;}else if(dataLabels.isSeriesName){isSeriesName=1;}else if(dataLabels.isValue){isValue=1;}else if(dataLabels.isPercentage){isPercentage=1;}else if(dataLabels.isLeaderLines){isLeaderLines=1;}if(position!=='Automatic'){writer.writeStartElement('c','dLblPos',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,position);writer.writeEndElement();// end of dLblPos
}writer.writeStartElement('c','showLegendKey',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,isLegendKey.toString());writer.writeEndElement();// end of showLegendKey
writer.writeStartElement('c','showVal',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,isValue.toString());writer.writeEndElement();// end of showVal
writer.writeStartElement('c','showCatName',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,isCategoryName.toString());writer.writeEndElement();// end of showCatName
writer.writeStartElement('c','showSerName',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,isSeriesName.toString());writer.writeEndElement();// end of showSerName
writer.writeStartElement('c','showPercent',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,isPercentage.toString());writer.writeEndElement();// end of showPercent
writer.writeStartElement('c','showBubbleSize',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,isBubbleSize.toString());writer.writeEndElement();// end of showBubbleSize
writer.writeStartElement('c','showLeaderLines',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,isLeaderLines.toString());writer.writeEndElement();// end of showBubbleSize
writer.writeEndElement();// end of dLbls
};WordExport.prototype.serializeShapeProperties=function(writer,color,isLine){var chartType=this.chart.chartType;var isScatterType=chartType==='Scatter_Markers'||chartType==='Bubble';// serialize shape
writer.writeStartElement('c','spPr',this.chartNamespace);if(!isScatterType||isLine){writer.writeStartElement('a','ln',this.aNamespace);writer.writeAttributeString(undefined,'w',undefined,'9525');this.serializeChartSolidFill(writer,color,false);writer.writeStartElement('a','prstDash',this.aNamespace);writer.writeAttributeString(undefined,'val',undefined,'solid');writer.writeEndElement();// end of prstDash
writer.writeStartElement('a','round',this.aNamespace);writer.writeEndElement();// end tag of round
writer.writeEndElement();// end tag of ln
}else if(chartType==='Scatter_Markers'){this.serializeChartSolidFill(writer,color,false);this.serializeDefaultLineProperties(writer);}else if(chartType==='Bubble'){this.serializeChartSolidFill(writer,color,true);this.serializeDefaultLineProperties(writer);}writer.writeStartElement('a','effectLst',this.aNamespace);writer.writeEndElement();// end of a: effectLst
writer.writeEndElement();// end tag of spPr
};WordExport.prototype.serializeDefaultShapeProperties=function(writer){writer.writeStartElement('c','spPr',this.chartNamespace);writer.writeStartElement('a','noFill',this.aNamespace);writer.writeEndElement();// end of a: noFill
this.serializeDefaultLineProperties(writer);writer.writeStartElement('a','effectLst',this.aNamespace);writer.writeEndElement();// end of a: effectLst
writer.writeEndElement();// end of c: spPr
};WordExport.prototype.serializeDefaultLineProperties=function(writer){writer.writeStartElement('a','ln',this.aNamespace);writer.writeStartElement('a','noFill',this.aNamespace);writer.writeEndElement();// end of a: noFill
writer.writeStartElement('a','round',this.aNamespace);writer.writeEndElement();// end of a: round
writer.writeEndElement();// end of a: ln
};WordExport.prototype.serializeTextProperties=function(writer,title,chartTitleName){var fill=title.dataFormat.fill.foreColor;var fontSize=title.fontSize*100;writer.writeStartElement('c','tx',this.chartNamespace);writer.writeStartElement('c','rich',this.chartNamespace);writer.writeStartElement('a','bodyPr',this.aNamespace);writer.writeAttributeString(undefined,'rot',undefined,'0');writer.writeAttributeString(undefined,'vert',undefined,'horz');writer.writeEndElement();// end of a: bodyPr
writer.writeStartElement('a','lstStyle',this.aNamespace);writer.writeEndElement();// end of a:lstStyle
writer.writeStartElement('a','p',this.aNamespace);this.serializeChartTitleFont(writer,title.fontSize,fill,title.fontName);writer.writeStartElement('a','r',this.aNamespace);writer.writeStartElement('a','rPr',this.aNamespace);writer.writeAttributeString(undefined,'lang',undefined,'en-US');writer.writeAttributeString(undefined,'b',undefined,'0');writer.writeAttributeString(undefined,'sz',undefined,fontSize.toString());writer.writeAttributeString(undefined,'baseline',undefined,'0');this.serializeChartSolidFill(writer,fill,false);this.serializeFont(writer,title.fontName);writer.writeEndElement();// end of a: rPr
writer.writeStartElement('a','t',this.aNamespace);writer.writeString(chartTitleName);writer.writeEndElement();// end of a:t
writer.writeEndElement();// end of a: r
writer.writeEndElement();// end of a: p
writer.writeEndElement();// end of c: rich
writer.writeEndElement();// end of c: tx
writer.writeStartElement('c','layout',this.chartNamespace);// writer.writeAttributeString(undefined, 'val', undefined, '0');
writer.writeEndElement();// end of c: layout
writer.writeStartElement('c','overlay',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'0');writer.writeEndElement();// end of c: overlay
this.serializeDefaultShapeProperties(writer);writer.writeStartElement('c','txPr',this.chartNamespace);writer.writeStartElement('a','bodyPr',this.aNamespace);writer.writeEndElement();// end of a: bodyPr
writer.writeStartElement('a','lstStyle',this.aNamespace);writer.writeEndElement();// end of a: lstStyle
writer.writeStartElement('a','p',this.aNamespace);writer.writeEndElement();// end of a: p
this.serializeChartTitleFont(writer,title.fontSize,fill,title.fontName);writer.writeEndElement();// end of c: txPr
};WordExport.prototype.serializeChartTitleFont=function(writer,fontSize,fill,fontName){var fontSizeCalc=fontSize*100;writer.writeStartElement('a','pPr',this.aNamespace);writer.writeStartElement('a','defRPr',this.aNamespace);writer.writeAttributeString(undefined,'lang',undefined,'en-US');writer.writeAttributeString(undefined,'b',undefined,'0');writer.writeAttributeString(undefined,'sz',undefined,fontSizeCalc.toString());writer.writeAttributeString(undefined,'baseline',undefined,'0');this.serializeChartSolidFill(writer,fill,false);this.serializeFont(writer,fontName);writer.writeEndElement();// end of defRPr
writer.writeEndElement();// end of a: pPr
};WordExport.prototype.serializeChartSolidFill=function(writer,fill,isSeriesFill){writer.writeStartElement('a','solidFill',this.aNamespace);writer.writeStartElement('a','srgbClr',this.aNamespace);if(fill!=='000000'){writer.writeAttributeString(undefined,'val',undefined,fill);}else{writer.writeAttributeString(undefined,'val',undefined,'595959');}if(this.chart.chartType==='Bubble'&&isSeriesFill){writer.writeStartElement('a','alpha',this.aNamespace);writer.writeAttributeString(undefined,'val',undefined,'75000');writer.writeEndElement();// end of alpha
}writer.writeEndElement();// end of srgbClr
writer.writeEndElement();// end of solidFill
};WordExport.prototype.serializeFont=function(writer,fontName){writer.writeStartElement('a','latin',this.aNamespace);writer.writeAttributeString(undefined,'typeface',undefined,fontName);writer.writeEndElement();// end of a:latin
writer.writeStartElement('a','ea',this.aNamespace);writer.writeAttributeString(undefined,'typeface',undefined,fontName);writer.writeEndElement();// end of a:ea
writer.writeStartElement('a','cs',this.aNamespace);writer.writeAttributeString(undefined,'typeface',undefined,fontName);writer.writeEndElement();// end of a:cs
};WordExport.prototype.parseChartSeriesColor=function(writer,dataPoints,chartType){for(var i=0;i<dataPoints.length;i++){var data=dataPoints[i];writer.writeStartElement('c','spPr',this.chartNamespace);if(chartType==='lineChart'){writer.writeStartElement('a','ln',this.aNamespace);writer.writeAttributeString(undefined,'w',undefined,'28575');writer.writeAttributeString(undefined,'cap',undefined,'rnd');}if(chartType!=='lineChart'){this.serializeChartSolidFill(writer,data.fill.foreColor,true);}else{this.serializeChartSolidFill(writer,data.line.color,true);}if(chartType!=='lineChart'){writer.writeStartElement('a','ln',this.aNamespace);writer.writeStartElement('a','noFill',this.aNamespace);writer.writeEndElement();// end of a: noFill
}writer.writeStartElement('a','round',this.aNamespace);writer.writeEndElement();// end of a: round
writer.writeEndElement();// end of a: ln
writer.writeStartElement('a','effectLst',this.aNamespace);writer.writeEndElement();// end of a: effectLst
writer.writeEndElement();// end of c: spPr
if(chartType==='lineChart'){var symbolType='none';var size=0;if(this.chart.chartSeries[i].hasOwnProperty('seriesFormat')){symbolType=this.chart.chartSeries[i].seriesFormat.markerStyle;size=this.chart.chartSeries[i].seriesFormat.markerSize;}writer.writeStartElement('c','marker',this.chartNamespace);writer.writeStartElement('c','symbol',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,symbolType.toLowerCase());writer.writeEndElement();// end of a: symbol
if(this.chart.chartSeries[i].hasOwnProperty('seriesFormat')){writer.writeStartElement('c','size',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,size.toString());writer.writeEndElement();// end of a: size
}writer.writeEndElement();// end of a: marker
}}};WordExport.prototype.parseChartDataPoint=function(writer,series){// data point
var dataPoints=series.dataPoints;var points=[];for(var j=0;j<dataPoints.length;j++){points.push(dataPoints[j]);writer.writeStartElement('c','dPt',this.chartNamespace);writer.writeStartElement('c','idx',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,j.toString());writer.writeEndElement();// end of c:idx
writer.writeStartElement('c','bubble3D',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'0');writer.writeEndElement();// end of c:bubble3D
this.parseChartSeriesColor(writer,points,this.chart.chartType);writer.writeEndElement();// end of c:dPt
points=[];}};// chart data value
WordExport.prototype.serializeChartCategory=function(writer,chart,cacheType){var chartCategory=chart.chartCategory;var chartCategoryCount=chartCategory.length;writer.writeStartElement('c','f',this.chartNamespace);writer.writeString('Sheet1!$A$2:$A$'+(chartCategoryCount+1).toString());writer.writeEndElement();// end of f
writer.writeStartElement('c',cacheType,this.chartNamespace);if(cacheType==='numCache'){writer.writeStartElement('c','formatCode',this.chartNamespace);writer.writeString('General');writer.writeEndElement();// end of formatCode
}writer.writeStartElement('c','ptCount',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,chartCategoryCount.toString());writer.writeEndElement();// end of ptCount
for(var i=0;i<chartCategory.length;i++){var category=chartCategory[i];writer.writeStartElement('c','pt',this.chartNamespace);writer.writeAttributeString(undefined,'idx',undefined,i.toString());writer.writeStartElement('c','v',this.chartNamespace);if(category.categoryXName!==''){writer.writeString(category.categoryXName);}writer.writeEndElement();// end of v
writer.writeEndElement();// end of pt
}writer.writeEndElement();// end of cacheType
};// chart value
WordExport.prototype.serializeChartValue=function(writer,valueSheet,chartType){var isScatterType=chartType==='scatterChart'||chartType==='bubbleChart';var valueType='val';if(isScatterType){valueType='yVal';}this.serializeChartYValue(writer,valueType,valueSheet);if(chartType==='bubbleChart'){valueType='bubbleSize';valueSheet='Sheet1!$C$2:$C$';this.serializeChartYValue(writer,valueType,valueSheet);}if(chartType==='lineChart'||chartType==='scatterChart'){writer.writeStartElement('c','smooth',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,'0');writer.writeEndElement();// end of smooth
}};WordExport.prototype.serializeChartYValue=function(writer,valueType,valueSheet){var chart=this.chart;var chartCategory=chart.chartCategory;var chartCategoryCount=chartCategory.length;writer.writeStartElement('c',valueType,this.chartNamespace);writer.writeStartElement('c','numRef',this.chartNamespace);writer.writeStartElement('c','f',this.chartNamespace);writer.writeString(valueSheet+(chartCategoryCount+1).toString());writer.writeEndElement();// end of f
writer.writeStartElement('c','numCache',this.chartNamespace);writer.writeStartElement('c','formatCode',this.chartNamespace);writer.writeString('General');writer.writeEndElement();// end of formatCode
writer.writeStartElement('c','ptCount',this.chartNamespace);writer.writeAttributeString(undefined,'val',undefined,chartCategoryCount.toString());writer.writeEndElement();// end of ptCount
for(var j=0;j<chartCategoryCount;j++){var category=chartCategory[j];for(var k=0;k<category.chartData.length;k++){if(k===this.seriesCount){var chartData=category.chartData[this.seriesCount];writer.writeStartElement('c','pt',this.chartNamespace);writer.writeAttributeString(undefined,'idx',undefined,j.toString());writer.writeStartElement('c','v',this.chartNamespace);if(valueType!=='bubbleSize'){writer.writeString(chartData.yValue.toString());}else{writer.writeString(chartData.size.toString());}writer.writeEndElement();// end of v
writer.writeEndElement();// end of pt
}}}writer.writeEndElement();// end of numCache
writer.writeEndElement();// end of numRef
writer.writeEndElement();// end of val
};// chart type
WordExport.prototype.chartType=function(chart){var chartType=chart.chartType;switch(chartType){case'Pie':chartType='pieChart';break;case'Doughnut':chartType='doughnutChart';break;case'Scatter_Markers':chartType='scatterChart';break;case'Bubble':chartType='bubbleChart';break;}if(chartType==='Area'||chartType==='Area_Stacked'||chartType==='Area_Stacked_100'){chartType='areaChart';}if(chartType==='Bar_Stacked_100'||chartType==='Bar_Stacked'||chartType==='Bar_Clustered'||chartType==='Column_Clustered'||chartType==='Column_Stacked'||chartType==='Column_Stacked_100'){chartType='barChart';}if(chartType==='Line'||chartType==='Line_Markers'||chartType==='Line_Markers_Stacked'||chartType==='Line_Stacked'||chartType==='Line_Markers_Stacked_100'||chartType==='Line_Stacked_100'){chartType='lineChart';}return chartType;};// chart group
WordExport.prototype.chartGrouping=function(type){var grouping='standard';if(type==='Bar_Stacked'||type==='Column_Stacked'||type==='Area_Stacked'||type==='Line_Stacked'||type==='Line_Markers_Stacked'){grouping='stacked';}else if(type==='Bar_Stacked_100'||type==='Column_Stacked_100'||type==='Area_Stacked_100'||type==='Line_Stacked_100'||type==='Line_Markers_Stacked_100'){grouping='percentStacked';}else if(type==='Bar_Clustered'||type==='Column_Clustered'){grouping='clustered';}return grouping;};// chart legend position
WordExport.prototype.chartLegendPosition=function(chart){var legendPosition=chart.position;switch(legendPosition){case'Top':legendPosition='t';break;case'Bottom':legendPosition='b';break;case'Left':legendPosition='l';break;case'Right':legendPosition='r';break;case'Corner':legendPosition='tr';break;default:legendPosition='b';break;}return legendPosition;};// update the chard id
WordExport.prototype.updatechartId=function(chart){var id='';if(id===''){id=this.addChartRelation(this.documentCharts,chart);}return id;};// adds the chart relation.
WordExport.prototype.addChartRelation=function(chartCollection,chart){var relationId='';relationId=this.getNextRelationShipID();chartCollection.add(relationId,chart);return relationId;};WordExport.prototype.startsWith=function(sourceString,startString){return startString.length>0&&sourceString.substring(0,startString.length)===startString;};WordExport.prototype.serializeShapeDrawingGraphics=function(writer,shape){var val=shape.autoShapeType;var id=shape.shapeId;this.serializeShapeWrapStyle(writer,shape);writer.writeStartElement('wp','docPr',this.wpNamespace);writer.writeAttributeString(undefined,'id',undefined,(this.mDocPrID++).toString());writer.writeAttributeString(undefined,'name',undefined,shape.name);writer.writeAttributeString(undefined,'title',undefined,shape.title);writer.writeEndElement();writer.writeStartElement('a','graphic',this.aNamespace);writer.writeStartElement('a','graphicData',this.aNamespace);writer.writeAttributeString(undefined,'uri',undefined,this.wpShapeNamespace);writer.writeStartElement('wps','wsp',this.wpShapeNamespace);writer.writeStartElement('wps','cNvCnPr',this.wpShapeNamespace);writer.writeStartElement('a','cxnSpLocks',this.aNamespace);writer.writeAttributeString(undefined,'noChangeShapeType',undefined,'1');writer.writeEndElement();writer.writeEndElement();writer.writeStartElement('wps','spPr',this.wpShapeNamespace);writer.writeAttributeString(undefined,'bwMode',undefined,'auto');writer.writeStartElement('a','xfrm',this.aNamespace);writer.writeStartElement('a','off',this.aNamespace);writer.writeAttributeString(undefined,'x',undefined,'0');writer.writeAttributeString(undefined,'y',undefined,'0');writer.writeEndElement();writer.writeStartElement('a','ext',this.aNamespace);var cx=Math.round(shape.width*this.emusPerPoint);writer.writeAttributeString(undefined,'cx',undefined,cx.toString());var cy=Math.round(shape.height*this.emusPerPoint);writer.writeAttributeString(undefined,'cy',undefined,cy.toString());writer.writeEndElement();writer.writeEndElement();writer.writeStartElement('a','prstGeom',this.aNamespace);if(val==='StraightConnector'){writer.writeAttributeString(undefined,'prst',undefined,'straightConnector1');}else if(val==='RoundedRectangle'){writer.writeAttributeString(undefined,'prst',undefined,'roundRect');}else{writer.writeAttributeString(undefined,'prst',undefined,'rect');}writer.writeStartElement('a','avLst',this.aNamespace);writer.writeEndElement();writer.writeEndElement();if(shape.fillFormat&&shape.fillFormat.color&&shape.fillFormat.fill){writer.writeStartElement('a','solidFill',this.aNamespace);writer.writeStartElement('a','srgbClr',this.aNamespace);writer.writeAttributeString(undefined,'val',undefined,this.getColor(shape.fillFormat.color));writer.writeEndElement();writer.writeEndElement();}else{writer.writeStartElement('a','noFill',this.aNamespace);writer.writeEndElement();}var lineWeight=shape.lineFormat.weight?shape.lineFormat.weight*this.emusPerPoint:this.emusPerPoint;writer.writeStartElement('a','ln',this.aNamespace);writer.writeAttributeString(undefined,'w',undefined,lineWeight.toString());if(!sf.base.isNullOrUndefined(shape.lineFormat.lineFormatType)&&shape.lineFormat.lineFormatType!=='None'||shape.lineFormat.line){writer.writeStartElement('a','solidFill',this.aNamespace);writer.writeStartElement('a','srgbClr',this.aNamespace);writer.writeAttributeString(undefined,'val',undefined,this.getColor(shape.lineFormat.color));writer.writeEndElement();writer.writeEndElement();writer.writeStartElement('a','round',this.aNamespace);writer.writeEndElement();writer.writeStartElement('a','headEnd',this.aNamespace);writer.writeEndElement();writer.writeStartElement('a','tailEnd',this.aNamespace);writer.writeEndElement();}else{writer.writeStartElement('a','noFill',this.aNamespace);writer.writeEndElement();}writer.writeEndElement();writer.writeEndElement();if(val==='Rectangle'||val==='RoundedRectangle'){writer.writeStartElement('wps','txbx',this.wpShapeNamespace);writer.writeStartElement(undefined,'txbxContent',this.wNamespace);this.serializeBodyItems(writer,shape.textFrame.blocks,true);writer.writeEndElement();writer.writeEndElement();}writer.writeStartElement('wps','bodyPr',this.wpShapeNamespace);if(!sf.base.isNullOrUndefined(shape.textFrame)){var margin=void 0;if(shape.textFrame.leftMargin>=0){margin=Math.round(shape.textFrame.leftMargin*this.emusPerPoint).toString();writer.writeAttributeString(undefined,'lIns',undefined,margin);}if(shape.textFrame.topMargin>=0){margin=Math.round(shape.textFrame.topMargin*this.emusPerPoint).toString();writer.writeAttributeString(undefined,'tIns',undefined,margin);}if(shape.textFrame.rightMargin>=0){margin=Math.round(shape.textFrame.rightMargin*this.emusPerPoint).toString();writer.writeAttributeString(undefined,'rIns',undefined,margin);}if(shape.textFrame.bottomMargin>=0){margin=Math.round(shape.textFrame.bottomMargin*this.emusPerPoint).toString();writer.writeAttributeString(undefined,'bIns',undefined,margin);}writer.writeAttributeString(undefined,'anchor',undefined,'t');writer.writeAttributeString(undefined,'anchorCtr',undefined,'0');}writer.writeEndElement();writer.writeEndElement();writer.writeEndElement();writer.writeEndElement();};WordExport.prototype.serializeShapeWrapStyle=function(writer,shape){if(shape.textWrappingStyle!=='Inline'){var textWrappingStyle='wrapNone';if(shape.textWrappingStyle&&shape.textWrappingStyle!=='InFrontOfText'&&shape.textWrappingStyle!=='Behind'){textWrappingStyle='wrap'+shape.textWrappingStyle;if(shape.textWrappingStyle==='Tight'){textWrappingStyle='wrap'+'Square';}}writer.writeStartElement('wp',textWrappingStyle,this.wpNamespace);if(shape.textWrappingStyle&&shape.textWrappingStyle!=='InFrontOfText'&&shape.textWrappingStyle!=='Behind'&&shape.textWrappingType){var wrapType=shape.textWrappingType==='Both'?'bothSides':shape.textWrappingType.toLowerCase();writer.writeAttributeString(undefined,'wrapText',undefined,wrapType);}writer.writeEndElement();}};// Serialize the graphics element for pictures.
WordExport.prototype.serializeDrawingGraphics=function(writer,picture){var id='';if(picture.isMetaFile&&!sf.base.isNullOrUndefined(picture.metaFileImageString)){picture.imageString=picture.metaFileImageString;}id=this.updateShapeId(picture);// picture.ShapeId = this.getNextDocPrID();
// Processing picture
writer.writeStartElement('wp','docPr',this.wpNamespace);writer.writeAttributeString(undefined,'id',undefined,(this.mDocPrID++).toString());if(!sf.base.isNullOrUndefined(picture.alternativeText)){writer.writeAttributeString(undefined,'descr',undefined,picture.alternativeText);}writer.writeAttributeString(undefined,'name',undefined,!sf.base.isNullOrUndefined(picture.name)?picture.name:'');if(!sf.base.isNullOrUndefined(picture.title))writer.writeAttributeString(undefined,'title',undefined,picture.title);// else
//writer.writeAttributeString(undefined, 'title', undefined, '');
// if (!picture.Visible)
//     m_writer.WriteAttributeString('hidden', '1');
// SerializePictureHyperlink(picture);
writer.writeEndElement();writer.writeStartElement('a','graphic',this.aNamespace);writer.writeStartElement('a','graphicData',this.aNamespace);writer.writeAttributeString(undefined,'uri',undefined,this.pictureNamespace);writer.writeStartElement('pic','pic',this.pictureNamespace);writer.writeStartElement('pic','nvPicPr',this.pictureNamespace);writer.writeStartElement('pic','cNvPr',this.pictureNamespace);writer.writeAttributeString(undefined,'id',undefined,'0');writer.writeAttributeString(undefined,'name',undefined,'');writer.writeAttributeString(undefined,'descr',undefined,'');writer.writeEndElement();writer.writeStartElement('pic','cNvPicPr',this.pictureNamespace);writer.writeStartElement('a','picLocks',this.aNamespace);writer.writeAttributeString(undefined,'noChangeAspect',undefined,'1');writer.writeAttributeString(undefined,'noChangeArrowheads',undefined,'1');writer.writeEndElement();writer.writeEndElement();writer.writeEndElement();writer.writeStartElement('pic','blipFill',this.pictureNamespace);writer.writeStartElement('a','blip',this.aNamespace);if(this.startsWith(picture.imageString,'data:image')){writer.writeAttributeString('r','embed',this.rNamespace,id);}else{if(this.documentImages.containsKey(id)){//Remove the image document images collection for this particular key
//If the picture image data has href means MS Word contains the image in media folder as well as 
//it is having external relationship id
// if (!this.startsWith(picture.imageString, 'data:image')) {
this.documentImages.remove(id);this.externalImages.add(id,picture.imageString);writer.writeAttributeString(undefined,'link',this.rNamespace,id);}}//End Element Blip
writer.writeEndElement();if(picture.iscrop){writer.writeStartElement('a','srcRect',this.aNamespace);var l=Math.round(picture.left*1000);writer.writeAttributeString(undefined,'l',undefined,l.toString());var t=Math.round(picture.top*1000);writer.writeAttributeString(undefined,'t',undefined,t.toString());var r=Math.round(picture.right*1000);writer.writeAttributeString(undefined,'r',undefined,r.toString());var b=Math.round(picture.bottom*1000);writer.writeAttributeString(undefined,'b',undefined,b.toString());writer.writeEndElement();}writer.writeStartElement('a','stretch',this.aNamespace);writer.writeStartElement('a','fillRect',this.aNamespace);writer.writeEndElement();writer.writeEndElement();writer.writeEndElement();writer.writeStartElement('pic','spPr',this.pictureNamespace);writer.writeAttributeString(undefined,'bwMode',undefined,'auto');writer.writeStartElement('a','xfrm',this.aNamespace);// if (picture.Rotation !== 0)
//     m_writer.WriteAttributeString('rot', picture.Rotation.ToString());
writer.writeStartElement('a','off',this.aNamespace);writer.writeAttributeString(undefined,'x',undefined,'0');writer.writeAttributeString(undefined,'y',undefined,'0');writer.writeEndElement();writer.writeStartElement('a','ext',this.aNamespace);var cx=Math.round(picture.width*this.emusPerPoint);writer.writeAttributeString(undefined,'cx',undefined,cx.toString());var cy=Math.round(picture.height*this.emusPerPoint);writer.writeAttributeString(undefined,'cy',undefined,cy.toString());writer.writeEndElement();writer.writeEndElement();writer.writeStartElement('a','prstGeom',this.aNamespace);writer.writeAttributeString(undefined,'prst',undefined,'rect');writer.writeStartElement('a','avLst',this.aNamespace);writer.writeEndElement();writer.writeEndElement();//When the picture border has been added next to effect list
//if not, Picture border has not been preserved
// if (picture.HasBorder)
// {
//     if (picture.TextWrappingStyle === TextWrappingStyle.Inline && picture.IsShape)
//         SerializeInlineShapeLine(picture.PictureShape);
//     else
//         SerializeShapeLine(picture.PictureShape);
// }
// if (picture.DocxProps.length > 0)
//     SerializeDocxProps(picture.DocxProps, 'effectLst');
writer.writeEndElement();writer.writeEndElement();writer.writeEndElement();writer.writeEndElement();};/// Update the shape id.
WordExport.prototype.updateShapeId=function(picture){var id='';var tOwner=this.paragraph;// Adding picture byte data to the corresponding picture collection 
// depending on its owner subdocument
if(this.headerFooter){id=this.updateHFImageRels(this.headerFooter,picture);}else{if(id===''){if(tOwner.hasOwnProperty('sectionFormat')||tOwner.hasOwnProperty('inlines')){id=this.addImageRelation(this.documentImages,picture);// if (owner is WFootnote)
// {
//     if ((owner as WFootnote).FootnoteType === FootnoteType.Footnote)
//         id = AddImageRelation(FootnoteImages, picture.ImageRecord);
//     else
//         id = AddImageRelation(EndnoteImages, picture.ImageRecord);
// }
// if (owner is WComment)
//     id = AddImageRelation(CommentImages, picture.ImageRecord);
}}}return id;};// Adds the image relation.
WordExport.prototype.addImageRelation=function(imageCollection,image){var relationId='';// if (imageCollection.ContainsValue(imageRecord)) {
//     foreach(string key in imageCollection.keys)
//     {
//         if (imageRecord === imageCollection[key]) {
//             relationId = key;
//             break;
//         }
//     }
// }
// else {
relationId=this.getNextRelationShipID();imageCollection.add(relationId,image);// }
return relationId;};// Update the HeaderFooter image relations.
WordExport.prototype.updateHFImageRels=function(hf,image){var id='';// UpdateImages(image);
var headerId='';var types=this.headersFooters.keys;for(var i=0;i<types.length;i++){var hfColl=this.headersFooters.get(types[i]);var hfKeys=hfColl.keys;for(var j=0;j<hfKeys.length;j++){if(hfColl.get(hfKeys[j])===hf){headerId=hfKeys[j];var headerImages=void 0;if(this.headerFooterImages.containsKey(headerId)){headerImages=this.headerFooterImages.get(headerId);id=this.addImageRelation(headerImages,image);}else{headerImages=new Dictionary();id=this.addImageRelation(headerImages,image);this.headerFooterImages.add(headerId,headerImages);}}}}return id;};// Serialize the table
WordExport.prototype.serializeTable=function(writer,table){if(table.rows.length<=0){return;}var owner=this.table;this.table=table;writer.writeStartElement(undefined,'tbl',this.wNamespace);var tableFormat=table.rows[0].rowFormat;this.serializeTableFormat(writer,tableFormat,table);this.serializeTableGrid(writer,table);var mVerticalMerge=new Dictionary();var mHorizontalMerge=new Dictionary();var cellFormats=new Dictionary();var rows=table.rows;if(rows.length>0){for(var rowIndex=0;rowIndex<rows.length;rowIndex++){var row=rows[rowIndex];if(row.cells.length>0){if(row.hasOwnProperty('contentControlProperties')){this.serializeContentControl(writer,row.contentControlProperties,row);continue;}var owner_1=this.row;this.row=row;writer.writeStartElement(undefined,'tr',this.wNamespace);this.serializeRowFormat(writer,row);var cells=row.cells;var cellLength=cells.length;var prevColIndex=0;for(var i=0;i<cellLength;i++){var cell=cells[i];var columnIndex=cell.columnIndex;if(cell.hasOwnProperty('contentControlProperties')){this.serializeContentControl(writer,cell.contentControlProperties,cell);continue;}var cellFormat=cell.cellFormat;if(columnIndex-prevColIndex>0){var checkIndex=i===0?0:prevColIndex+1;for(var k=checkIndex;k<columnIndex;k++){if(mVerticalMerge.containsKey(k)){var format=this.getMergeCellFormat(cellFormat,cellFormats.get(k),k<cell.columnIndex);this.serializeTableCell(writer,cell,format,false);mVerticalMerge.set(k,mVerticalMerge.get(k)-1);if(mVerticalMerge.get(k)===1){mVerticalMerge.remove(k);cellFormats.remove(k);if(mHorizontalMerge.containsKey(k)){mHorizontalMerge.remove(k);}}if(mHorizontalMerge.containsKey(k)){prevColIndex+=mHorizontalMerge.get(k)-1;k+=mHorizontalMerge.get(k);}}}}prevColIndex=columnIndex;if(cellFormat.rowSpan>1){mVerticalMerge.add(columnIndex,cellFormat.rowSpan);cellFormats.add(columnIndex,cellFormat);}this.serializeTableCell(writer,cell,cellFormat,true);if(cellFormat.columnSpan>1&&cellFormat.rowSpan>1){mHorizontalMerge.add(columnIndex,cellFormat.columnSpan);}for(var j=columnIndex+1;;j++){if(mVerticalMerge.containsKey(j)){var mergeFormat=this.getMergeCellFormat(cellFormat,cellFormats.get(j),j<cell.columnIndex);this.serializeTableCell(writer,cell,mergeFormat,false);mVerticalMerge.set(j,mVerticalMerge.get(j)-1);prevColIndex++;if(mVerticalMerge.get(j)===1){mVerticalMerge.remove(j);cellFormats.remove(j);if(mHorizontalMerge.containsKey(j)){mHorizontalMerge.remove(j);}}if(mHorizontalMerge.containsKey(j)){prevColIndex+=mHorizontalMerge.get(j)-1;j+=mHorizontalMerge.get(j);}}else if(!(i===cellLength-1&&j<table.columnCount)){break;}}}writer.writeEndElement();//end od table row 'tr'
this.row=owner_1;}}}writer.writeEndElement();this.table=owner;};WordExport.prototype.getMergeCellFormat=function(cellFormat,mergedCellFormat,before){var format=mergedCellFormat;if(before){format.borders.right=cellFormat.borders.left;}else{format.borders.left=cellFormat.borders.right;}return format;};WordExport.prototype.serializeTableCell=function(xmlWriter,cell,cellFormat,mergeStart){var owner=this.blockOwner;this.blockOwner=cell;xmlWriter.writeStartElement(undefined,'tc',this.wNamespace);xmlWriter.writeStartElement(undefined,'tcPr',this.wNamespace);this.serializeCellWidth(xmlWriter,cellFormat);this.serializeCellMargins(xmlWriter,cellFormat);xmlWriter.writeStartElement(undefined,'tcBorders',this.wNamespace);this.serializeBorders(xmlWriter,cellFormat.borders,8);xmlWriter.writeEndElement();// end of tcBorders
this.serializeShading(xmlWriter,cell.cellFormat.shading);this.serializeTableCellDirection(xmlWriter,cellFormat);this.serializeCellVerticalAlign(xmlWriter,cellFormat.verticalAlignment);if(cellFormat.columnSpan>1){var num=cellFormat.columnSpan;xmlWriter.writeStartElement(undefined,'gridSpan',this.wNamespace);xmlWriter.writeAttributeString('w','val',this.wNamespace,num.toString());xmlWriter.writeEndElement();}if(cellFormat.rowSpan>1){xmlWriter.writeStartElement(undefined,'vMerge',this.wNamespace);xmlWriter.writeAttributeString('w','val',this.wNamespace,mergeStart?'restart':'continue');xmlWriter.writeEndElement();// end of vMerge
}xmlWriter.writeEndElement();// end of tcPr
if(cell&&cell.blocks.length>0){var itemIndex=0;var item=undefined;while(itemIndex<cell.blocks.length){item=cell.blocks[itemIndex];this.serializeBodyItem(xmlWriter,item,false);itemIndex+=1;}}else{xmlWriter.writeStartElement(undefined,'p',this.wNamespace);xmlWriter.writeStartElement(undefined,'pPr',this.wNamespace);xmlWriter.writeStartElement(undefined,'pStyle',this.wNamespace);xmlWriter.writeAttributeString('w','val',this.wNamespace,'Normal');xmlWriter.writeEndElement();//end of pStyle
xmlWriter.writeEndElement();//end of pPr
xmlWriter.writeEndElement();//end of P
}xmlWriter.writeEndElement();//end of table cell 'tc' 
this.blockOwner=owner;};// Serialize the table grid
WordExport.prototype.serializeTableGrid=function(writer,table){writer.writeStartElement(undefined,'tblGrid',this.wNamespace);if(table.grid.length!==0){this.serializeGridColumns(writer,table.grid);}writer.writeEndElement();};// Serialize the table rows
WordExport.prototype.serializeTableRows=function(writer,rows){var mVerticalMerge=new Dictionary();if(rows.length>0){for(var i=0;i<rows.length;i++){var row=rows[i];if(row.cells.length>0){if(row.hasOwnProperty('contentControlProperties')){this.serializeContentControl(writer,row.contentControlProperties,row);continue;}this.serializeRow(writer,row,mVerticalMerge);}}}};// Serialize the table row
WordExport.prototype.serializeRow=function(writer,row,mVerticalMerge){var owner=this.row;this.row=row;writer.writeStartElement(undefined,'tr',this.wNamespace);this.serializeRowFormat(writer,row);this.serializeCells(writer,row.cells,mVerticalMerge);writer.writeEndElement();//end od table row 'tr'
this.row=owner;};// Serialize the row format
WordExport.prototype.serializeRowFormat=function(writer,row){this.serializeRowMargins(writer,row.rowFormat);writer.writeStartElement(undefined,'trPr',this.wNamespace);//Serialize Row Height
if(row.rowFormat.height>0){writer.writeStartElement(undefined,'trHeight',this.wNamespace);if(row.rowFormat.heightType==='Exactly'){writer.writeAttributeString('w','hRule',this.wNamespace,'exact');}else if(row.rowFormat.heightType==='AtLeast'){writer.writeAttributeString('w','hRule',this.wNamespace,'atLeast');}var height=this.roundToTwoDecimal(row.rowFormat.height*this.twentiethOfPoint).toString();writer.writeAttributeString('w','val',this.wNamespace,height);writer.writeEndElement();}var rowFormat=row.rowFormat;// //Serialize 'gridBefore' element
var gridBefore=rowFormat.gridBefore;if(gridBefore>0){writer.writeStartElement(undefined,'gridBefore',this.wNamespace);writer.writeAttributeString('w','val',this.wNamespace,gridBefore.toString());writer.writeEndElement();}// //Serialize 'gridAfter' element
var gridAfter=rowFormat.gridAfter;if(gridAfter>0){writer.writeStartElement(undefined,'gridAfter',this.wNamespace);writer.writeAttributeString('w','val',this.wNamespace,gridAfter.toString());writer.writeEndElement();}// //Serialize 'wBefore' element 
if(gridBefore>0){writer.writeStartElement(undefined,'wBefore',this.wNamespace);switch(rowFormat.gridBeforeWidthType){case'Percent':var width=this.roundToTwoDecimal(rowFormat.gridBeforeWidth*this.percentageFactor).toString();writer.writeAttributeString('w','w',this.wNamespace,width);writer.writeAttributeString('w','type',this.wNamespace,'pct');break;case'Point':var pointWidth=this.roundToTwoDecimal(rowFormat.gridBeforeWidth*this.twipsInOnePoint).toString();writer.writeAttributeString('w','w',this.wNamespace,pointWidth);writer.writeAttributeString('w','type',this.wNamespace,'dxa');break;}writer.writeEndElement();}//Serialize 'wAfter' element
if(gridAfter>0){writer.writeStartElement(undefined,'wAfter',this.wNamespace);switch(rowFormat.gridAfterWidthType){case'Percent':var width=this.roundToTwoDecimal(rowFormat.gridAfterWidth*this.percentageFactor).toString();writer.writeAttributeString('w','val',this.wNamespace,width);writer.writeAttributeString('w','type',this.wNamespace,'pct');break;case'Point':var pointWidth=this.roundToTwoDecimal(rowFormat.gridAfterWidth*this.twipsInOnePoint).toString();writer.writeAttributeString('w','val',this.wNamespace,pointWidth);writer.writeAttributeString('w','type',this.wNamespace,'dxa');break;}writer.writeEndElement();}//Serialize 'cantSplit' element 
if(!rowFormat.allowBreakAcrossPages){writer.writeStartElement(undefined,'cantSplit',this.wNamespace);writer.writeEndElement();}// //Serialize 'tblHeader' element 
if(rowFormat.isHeader){writer.writeStartElement(undefined,'tblHeader',this.wNamespace);writer.writeEndElement();}//serialize revision
if(!sf.base.isNullOrUndefined(rowFormat.revisionIds)&&rowFormat.revisionIds.length>0){this.serializeRevisionStart(writer,rowFormat,undefined);this.serializeRevisionEnd(writer,rowFormat,undefined);}writer.writeEndElement();};// serialize the table cells
WordExport.prototype.serializeCells=function(writer,cells,mVerticalMerge){for(var i=0;i<cells.length;i++){if(cells[i].hasOwnProperty('contentControlProperties')){this.serializeContentControl(writer,cells[i].contentControlProperties,cells[i]);continue;}this.serializeCell(writer,cells[i],mVerticalMerge);}};// Serialize the table cell
WordExport.prototype.serializeCell=function(writer,cell,mVerticalMerge){var owner=this.blockOwner;this.blockOwner=cell;writer.writeStartElement(undefined,'tc',this.wNamespace);mVerticalMerge=this.serializeCellFormat(writer,cell.cellFormat,true,true,mVerticalMerge);if(cell.blocks.length>0){var itemIndex=0;var item=undefined;while(itemIndex<cell.blocks.length){item=cell.blocks[itemIndex];this.serializeBodyItem(writer,item,false);itemIndex+=1;}}else{writer.writeStartElement(undefined,'p',this.wNamespace);writer.writeStartElement(undefined,'pPr',this.wNamespace);writer.writeStartElement(undefined,'pStyle',this.wNamespace);writer.writeAttributeString('w','val',this.wNamespace,'Normal');writer.writeEndElement();//end of pStyle
writer.writeEndElement();//end of pPr
writer.writeEndElement();//end of P
}writer.writeEndElement();//end of table cell 'tc' 
var increment=1;// let count: number = 0;
if(mVerticalMerge.containsKey(cell.columnIndex+cell.cellFormat.columnSpan-1+increment)&&this.row.cells.length===1){var length_1=mVerticalMerge.keys[mVerticalMerge.keys.length-1];while(increment<=length_1){increment=this.createCellForMerge(writer,cell,mVerticalMerge,increment);increment++;}}else{this.createCellForMerge(writer,cell,mVerticalMerge,increment);}this.blockOwner=owner;};WordExport.prototype.createCellForMerge=function(writer,cell,mVerticalMerge,increment){while(mVerticalMerge.containsKey(cell.columnIndex+cell.cellFormat.columnSpan-1+increment)&&(this.row.cells.indexOf(cell)===this.row.cells.length-1||this.row.cells.indexOf(cell)===cell.columnIndex)&&cell.nextNode===undefined){var collKey=cell.columnIndex+cell.cellFormat.columnSpan-1+increment;writer.writeStartElement(undefined,'tc',this.wNamespace);var endProperties=true;if(!sf.base.isNullOrUndefined(this.spanCellFormat)){endProperties=false;mVerticalMerge=this.serializeCellFormat(writer,this.spanCellFormat,false,endProperties,mVerticalMerge);}else{writer.writeStartElement(undefined,'tcPr',this.wNamespace);endProperties=false;}this.serializeColumnSpan(collKey,writer);writer.writeStartElement(undefined,'vMerge',this.wNamespace);writer.writeAttributeString('w','val',this.wNamespace,'continue');writer.writeEndElement();if(sf.base.isNullOrUndefined(this.spanCellFormat)){writer.writeStartElement(undefined,'tcBorders',this.wNamespace);this.serializeBorders(writer,cell.cellFormat.borders,8);writer.writeEndElement();}if(!endProperties){writer.writeEndElement();}mVerticalMerge=this.checkMergeCell(collKey,mVerticalMerge);writer.writeStartElement('w','p',this.wNamespace);writer.writeEndElement();//end of P
writer.writeEndElement();//end of table cell 'tc'  
increment++;//count++;
}return increment;};// Serialize the cell formatting
WordExport.prototype.serializeCellFormat=function(writer,cellFormat,ensureMerge,endProperties,mVerticalMerge){var cell=this.blockOwner;//Get the table fomat
var tf=this.table.tableFormat;//Get the row format
var rf=this.row.rowFormat;writer.writeStartElement(undefined,'tcPr',this.wNamespace);//w:cnfStyle -   Table Cell Conditional Formatting
// SerializeCnfStyleElement(cell);
//w:tcW -    Preferred Table Cell Width
this.serializeCellWidth(writer,cellFormat);// serialize cell margins
this.serializeCellMargins(writer,cellFormat);if(ensureMerge){//w:hMerge -    Horizontally Merged Cell and w:vMerge -    Vertically Merged Cell
mVerticalMerge=this.serializeCellMerge(writer,cellFormat,mVerticalMerge);//w:gridSpan -   Grid Columns Spanned by Current Table Cell
this.serializeGridSpan(writer,cell);}//w:tcBorders -    Table Cell Borders
writer.writeStartElement(undefined,'tcBorders',this.wNamespace);this.serializeBorders(writer,cellFormat.borders,8);writer.writeEndElement();//w:shd -  Table Cell Shading
this.serializeShading(writer,cell.cellFormat.shading);// //w:noWrap -   Don't Wrap Cell Content
// if (cellFormat.HasValue(CellFormat.TextWrapKey)) {
//     m_writer.WriteStartElement('noWrap', W_namespace);
//     if (cellFormat.TextWrap)
//         m_writer.WriteAttributeString('w', 'val', W_namespace, 'false');
//     m_writer.WriteEndElement();
// }
// //w:tcMar -  Single Table Cell Margins
// if (!cellFormat.SamePaddingsAsTable) {
//     m_writer.WriteStartElement('tcMar', W_namespace);
//     SerializePaddings(cellFormat.Paddings);
//     m_writer.WriteEndElement();
// }
//w:textDirection -   Table Cell Text Flow Direction
this.serializeTableCellDirection(writer,cellFormat);// //w:tcFitText -  Fit Text Within Cell
// if (cellFormat.FitText) {
//     m_writer.WriteStartElement('tcFitText', W_namespace);
//     m_writer.WriteEndElement();
// }
// //w:hideMark 
// if (cellFormat.HideMark) {
//     m_writer.WriteStartElement('hideMark', W_namespace);
//     m_writer.WriteEndElement();
// }
//w:vAlign -  Table Cell Vertical Alignment
// if (cellFormat.HasValue(CellFormat.VrAlignmentKey))
this.serializeCellVerticalAlign(writer,cellFormat.verticalAlignment);// //w:hideMark -   Ignore End Of Cell Marker In Row Height Calculation
// SerializeDocxProps(tempDocxProps, 'hideMark');
// //w:cellIns -    Table Cell Insertion
// SerializeDocxProps(tempDocxProps, 'cellIns');
// //w:cellDel -    Table Cell Deletion
// SerializeDocxProps(tempDocxProps, 'cellDel');
// //w:cellMerge -   Vertically Merged/Split Table Cells
// SerializeDocxProps(tempDocxProps, 'cellMerge');
// if (cellFormat.OldPropertiesHash.length > 0 && !m_isAlternativeCellFormat) {
//     m_isAlternativeCellFormat = true;
//     SerializeTrackChangeProps('tcPrChange', cellFormat.FormatChangeAuthorName, cellFormat.FormatChangeDateTime);
//     Dictionary < int, object > oldPropertyHash = new Dictionary<int, object>(cellFormat.OldPropertiesHash);
//     Dictionary < int, object > propertyHash = new Dictionary<int, object>(cellFormat.PropertiesHash);
//     cellFormat.PropertiesHash.Clear();
//     cellFormat.OldPropertiesHash.Clear();
//     foreach(KeyValuePair < int, object > keyValue in oldPropertyHash)
//     cellFormat.PropertiesHash[keyValue.Key] = keyValue.Value;
//     SerializeCellFormat(cellFormat);
//     cellFormat.PropertiesHash.Clear();
//     foreach(KeyValuePair < int, object > keyValue in propertyHash)
//     cellFormat.PropertiesHash[keyValue.Key] = keyValue.Value;
//     foreach(KeyValuePair < int, object > keyValue in oldPropertyHash)
//     cellFormat.OldPropertiesHash[keyValue.Key] = keyValue.Value;
//     m_writer.WriteEndElement();
//     m_isAlternativeCellFormat = false;
// }
if(endProperties){writer.writeEndElement();}return mVerticalMerge;};// Serialize the cell width
WordExport.prototype.serializeCellWidth=function(writer,cf){writer.writeStartElement(undefined,'tcW',this.wNamespace);if(cf.preferredWidthType==='Percent'){writer.writeAttributeString(undefined,'type',this.wNamespace,'pct');writer.writeAttributeString(undefined,'w',this.wNamespace,this.roundToTwoDecimal(cf.preferredWidth*this.percentageFactor).toString());}else if(cf.preferredWidthType==='Auto'){writer.writeAttributeString(undefined,'type',this.wNamespace,'auto');writer.writeAttributeString(undefined,'w',this.wNamespace,'0');}else{writer.writeAttributeString(undefined,'w',this.wNamespace,this.roundToTwoDecimal(cf.preferredWidth*this.twipsInOnePoint).toString());writer.writeAttributeString(undefined,'type',this.wNamespace,'dxa');}writer.writeEndElement();};// Serialize cell merge
WordExport.prototype.serializeCellMerge=function(writer,cellFormat,mVerticalMerge){var cell=this.blockOwner;var isserialized=false;var collKey;var currentIndex=cell.columnIndex;var cellIndex=this.row.cells.indexOf(cell);var prevIndex=cellIndex>0?this.row.cells[cellIndex-1].columnIndex:cell.columnIndex;if(cell.columnIndex===cellIndex){collKey=cell.columnIndex;isserialized=true;}else{isserialized=false;}if(!isserialized){if(cellIndex===0){currentIndex=cell.columnIndex;prevIndex=-1;}for(var i=prevIndex;i<currentIndex;i++){collKey=prevIndex+1;prevIndex+=1;if(collKey===0&&mVerticalMerge.containsKey(collKey)){mVerticalMerge=this.createMerge(writer,collKey,cell,mVerticalMerge);}}}if(cellFormat.rowSpan>1){writer.writeStartElement(undefined,'vMerge',this.wNamespace);this.spanCellFormat=cellFormat;mVerticalMerge.add(collKey,cellFormat.rowSpan-1);if(cellFormat.columnSpan>1){this.mGridSpans.add(collKey,cellFormat.columnSpan);}writer.writeAttributeString('w','val',this.wNamespace,'restart');writer.writeEndElement();}else if(mVerticalMerge.containsKey(collKey)&&isserialized){mVerticalMerge=this.createMerge(writer,collKey,cell,mVerticalMerge);}return mVerticalMerge;};WordExport.prototype.createMerge=function(writer,collKey,cell,mVerticalMerge){this.serializeColumnSpan(collKey,writer);writer.writeStartElement(undefined,'vMerge',this.wNamespace);writer.writeAttributeString('w','val',this.wNamespace,'continue');writer.writeEndElement();writer.writeStartElement(undefined,'tcBorders',this.wNamespace);this.serializeBorders(writer,cell.cellFormat.borders,8);writer.writeEndElement();writer.writeEndElement();//end tcPr
writer.writeStartElement('w','p',this.wNamespace);writer.writeEndElement();writer.writeEndElement();//end tc
writer.writeStartElement(undefined,'tc',this.wNamespace);writer.writeStartElement(undefined,'tcPr',this.wNamespace);this.serializeCellWidth(writer,cell.cellFormat);mVerticalMerge=this.checkMergeCell(collKey,mVerticalMerge);return mVerticalMerge;};WordExport.prototype.serializeColumnSpan=function(collKey,writer){if(this.mGridSpans.keys.length>0&&this.mGridSpans.containsKey(collKey)){writer.writeStartElement(undefined,'gridSpan',this.wNamespace);writer.writeAttributeString('w','val',this.wNamespace,this.mGridSpans.get(collKey).toString());writer.writeEndElement();}};WordExport.prototype.checkMergeCell=function(collKey,mVerticalMerge){if(mVerticalMerge.get(collKey)-1===0){mVerticalMerge.remove(collKey);this.spanCellFormat=undefined;if(this.mGridSpans.keys.length>0&&this.mGridSpans.containsKey(collKey)){this.mGridSpans.remove(collKey);}}else{mVerticalMerge.set(collKey,mVerticalMerge.get(collKey)-1);}return mVerticalMerge;};// Serialize the grid span element of cell.
WordExport.prototype.serializeGridSpan=function(writer,cell){// int gridSpan = cell.cellFormat.GridSpan;
if(cell.cellFormat.columnSpan>1){var num=cell.cellFormat.columnSpan;writer.writeStartElement(undefined,'gridSpan',this.wNamespace);writer.writeAttributeString('w','val',this.wNamespace,num.toString());writer.writeEndElement();}};// Serialize the table cell direction
WordExport.prototype.serializeTableCellDirection=function(writer,cellFormat){// if (cellFormat..textDirection !== TextDirection.Horizontal)
// {
//     m_writer.WriteStartElement('textDirection', W_namespace);
//     switch (cellFormat.TextDirection)
//     {
//         case TextDirection.Horizontal:
//             m_writer.WriteAttributeString('w', 'val', W_namespace, 'lrTb');
//             break;
//         case TextDirection.VerticalBottomToTop:
//             m_writer.WriteAttributeString('w', 'val', W_namespace, 'btLr');
//             break;
//         case TextDirection.VerticalTopToBottom:
//             m_writer.WriteAttributeString('w', 'val', W_namespace, 'tbRl');
//             break;
//         case TextDirection.HorizontalFarEast:
//             m_writer.WriteAttributeString('w', 'val', W_namespace, 'lrTbV');
//             break;
//         case TextDirection.Vertical:
//             m_writer.WriteAttributeString('w', 'val', W_namespace, 'tbLrV');
//             break;
//         case TextDirection.VerticalFarEast:
//             m_writer.WriteAttributeString('w', 'val', W_namespace, 'tbRlV');
//             break;
//     }
//     m_writer.WriteEndElement();
// }
};// Serialize the cell vertical alignment
WordExport.prototype.serializeCellVerticalAlign=function(writer,alignment){writer.writeStartElement(undefined,'vAlign',this.wNamespace);switch(alignment){case'Center':writer.writeAttributeString('w','val',this.wNamespace,'center');break;case'Bottom':writer.writeAttributeString('w','val',this.wNamespace,'bottom');break;default:writer.writeAttributeString('w','val',this.wNamespace,'top');break;}writer.writeEndElement();};// Serialize the table grid columns.
WordExport.prototype.serializeGridColumns=function(writer,grid){for(var i=0,count=grid.length;i<count;i++){var gridValue=Math.round(grid[i]*20);writer.writeStartElement(undefined,'gridCol',this.wNamespace);writer.writeAttributeString(undefined,'w',this.wNamespace,gridValue.toString());writer.writeEndElement();}};// Serialize the row formattings.
// Table parameter is passed for serializing table format and undefined for serializing row format.
WordExport.prototype.serializeTableFormat=function(writer,format,table){// if (!isNullOrUndefined(table))
// {
//     List<Stream> tempDocxProps = new List<Stream>();
//     for (int i = 0, cnt = table.DocxTableFormat.NodeArray.length; i < cnt; i++)
//         tempDocxProps.Add(table.DocxTableFormat.NodeArray[i]);
writer.writeStartElement(undefined,'tblPr',this.wNamespace);//     SerializeTableStlye(format);
//     if (format.WrapTextAround &&!((table.OwnerTextBody.Owner is WTextBox) || 
//(table.OwnerTextBody.Owner is WComment) || (table.OwnerTextBody.Owner is WFootnote)))
//     {
//         SerializeTablePositioning(format.Positioning);
//         if (!format.Positioning.AllowOverlap)
//         {
//             m_writer.WriteStartElement('tblOverlap', W_namespace);
//             m_writer.WriteAttributeString('val', W_namespace, 'never');
//             m_writer.WriteEndElement();
//         }
//     }
//     SerializeDocxProps(tempDocxProps, 'tblStyleRowBandSize');
//     SerializeDocxProps(tempDocxProps, 'tblStyleColBandSize');  
this.serializeTablePositioning(writer,table);this.serializeTableWidth(writer,table);this.serializeTableAlignment(writer,table.tableFormat);this.serializeCellSpacing(writer,table.tableFormat);this.serializeTableIndentation(writer,table.tableFormat);this.serializeTableMargins(writer,table.tableFormat);this.serializeTableBorders(writer,table.tableFormat);this.serializeShading(writer,table.tableFormat.shading);if(table.tableFormat.bidi){writer.writeStartElement(undefined,'bidiVisual',this.wNamespace);writer.writeEndElement();}this.serializeTblLayout(writer,table.tableFormat);// this.serializeTableCellMargin(writer, table.tableFormat);
//     SerializeTableLook(table);
//         if (!isNullOrUndefined(table.Title))
//             SerializeTableTitle(table);
//         if (!isNullOrUndefined(table.Description))
//             SerializeTableDescription(table);
// }
// else
// {
//     SerializeCellSpacing(format);
//     SerializeTableIndentation(format);
//     SerializeTableBorders(format);
//     SerializeTableShading(format);
//     SerializeTblLayout(format);
//     SerializeTableCellMargin(format);
// }
// if (!isNullOrUndefined(format.OwnerBase) && format.OwnerBase is WTable
//   && format.OldPropertiesHash.length > 0 && !m_isAlternativeTableFormat)
// {
//     m_isAlternativeTableFormat = true;
//     SerializeTrackChangeProps('tblPrChange', format.FormatChangeAuthorName, format.FormatChangeDateTime);
//     SerializeTableTrackChanges(format, format.OwnerBase as WTable);
//     m_writer.WriteEndElement();
//     m_isAlternativeTableFormat = false;
// }
// if (!isNullOrUndefined(format.OwnerRow) && format.OldPropertiesHash.length > 0)
// {
//     SerializeTrackChangeProps('tblPrExChange', format.FormatChangeAuthorName, format.FormatChangeDateTime);
//     SerializeTableTrackChanges(format, undefined);
//     m_writer.WriteEndElement();
// }
// SerializeTblTrackChanges(format);
if(!sf.base.isNullOrUndefined(table)){writer.writeEndElement();//end of tblPr
}};// Serialize the table position
WordExport.prototype.serializeTablePositioning=function(writer,table){if(table.wrapTextAround){writer.writeStartElement('w','tblpPr',this.wNamespace);if(table.positioning.distanceLeft>0){var left=Math.round(table.positioning.distanceLeft*this.twipsInOnePoint).toString();writer.writeAttributeString('w','leftFromText',this.wNamespace,left);}if(table.positioning.distanceRight>0){var right=Math.round(table.positioning.distanceRight*this.twipsInOnePoint).toString();writer.writeAttributeString('w','rightFromText',this.wNamespace,right);}if(table.positioning.distanceTop>0){var top_1=Math.round(table.positioning.distanceTop*this.twipsInOnePoint).toString();writer.writeAttributeString('w','topFromText',this.wNamespace,top_1);}if(table.positioning.distanceBottom>0){var bottom=Math.round(table.positioning.distanceBottom*this.twipsInOnePoint).toString();writer.writeAttributeString('w','bottomFromText',this.wNamespace,bottom);}if(table.positioning.verticalOrigin){var verticalOrigin=table.positioning.verticalOrigin==='Paragraph'?'text':table.positioning.verticalOrigin.toLowerCase();writer.writeAttributeString('w','vertAnchor',this.wNamespace,verticalOrigin);}if(table.positioning.horizontalOrigin&&table.positioning.horizontalOrigin!=='Column'){writer.writeAttributeString('w','horzAnchor',this.wNamespace,table.positioning.horizontalOrigin.toLowerCase());}if(table.positioning.horizontalAlignment&&table.positioning.horizontalAlignment!=='Left'){var horizontalAlignment=table.positioning.horizontalAlignment.toLowerCase();writer.writeAttributeString('w','tblpXSpec',this.wNamespace,horizontalAlignment);}if(table.positioning.verticalAlignment){var verticalAlignment=table.positioning.verticalAlignment.toLowerCase();writer.writeAttributeString('w','tblpYSpec',this.wNamespace,verticalAlignment);}if((!sf.base.isNullOrUndefined(table.positioning.horizontalAlignment)&&table.positioning.horizontalAlignment==='Left'||!table.positioning.horizontalAlignment)&&table.positioning.horizontalPosition>0){var horizontalPosition=Math.round(table.positioning.horizontalPosition*this.twipsInOnePoint).toString();writer.writeAttributeString('w','tblpX',this.wNamespace,horizontalPosition);}if(!table.positioning.verticalAlignment&&table.positioning.verticalPosition>0){var verticalPosition=Math.round(table.positioning.verticalPosition*this.twipsInOnePoint).toString();writer.writeAttributeString('w','tblpY',this.wNamespace,verticalPosition);}writer.writeEndElement();if(!table.positioning.allowOverlap){writer.writeStartElement('w','tblOverlap',this.wNamespace);writer.writeAttributeString('w','val',this.wNamespace,'never');writer.writeEndElement();}}};// serialize the table margin
WordExport.prototype.serializeTableMargins=function(writer,format){this.serializeMargins(writer,format,'tblCellMar');};// serialize the row margin
WordExport.prototype.serializeRowMargins=function(writer,format){writer.writeStartElement(undefined,'tblPrEx',this.wNamespace);this.serializeMargins(writer,format,'tblCellMar');writer.writeEndElement();};// serialize the cell margins
WordExport.prototype.serializeCellMargins=function(writer,format){this.serializeMargins(writer,format,'tcMar');};// serialize the table margins, row margins, cell margins
WordExport.prototype.serializeMargins=function(writer,format,tag){writer.writeStartElement(undefined,tag,this.wNamespace);if(!sf.base.isNullOrUndefined(format.topMargin)){var topMargin=Math.round(format.topMargin*20);writer.writeStartElement(undefined,'top',this.wNamespace);writer.writeAttributeString(undefined,'w',this.wNamespace,topMargin.toString());writer.writeAttributeString(undefined,'type',this.wNamespace,'dxa');writer.writeEndElement();}if(!sf.base.isNullOrUndefined(format.leftMargin)){var leftMargin=Math.round(format.leftMargin*20);writer.writeStartElement(undefined,'left',this.wNamespace);writer.writeAttributeString(undefined,'w',this.wNamespace,leftMargin.toString());writer.writeAttributeString(undefined,'type',this.wNamespace,'dxa');writer.writeEndElement();}if(!sf.base.isNullOrUndefined(format.bottomMargin)){var bottomMargin=Math.round(format.bottomMargin*20);writer.writeStartElement(undefined,'bottom',this.wNamespace);writer.writeAttributeString(undefined,'w',this.wNamespace,bottomMargin.toString());writer.writeAttributeString(undefined,'type',this.wNamespace,'dxa');writer.writeEndElement();}if(!sf.base.isNullOrUndefined(format.rightMargin)){var rightMargin=Math.round(format.rightMargin*20);writer.writeStartElement(undefined,'right',this.wNamespace);writer.writeAttributeString(undefined,'w',this.wNamespace,rightMargin.toString());writer.writeAttributeString(undefined,'type',this.wNamespace,'dxa');writer.writeEndElement();}writer.writeEndElement();};// Serialize the table borders
WordExport.prototype.serializeShading=function(writer,format){// if (format.textureStyle !== 'TextureNone') {
writer.writeStartElement(undefined,'shd',this.wNamespace);if(format.backgroundColor&&format.backgroundColor!=='empty'){writer.writeAttributeString(undefined,'fill',this.wNamespace,this.getColor(format.backgroundColor));}else{writer.writeAttributeString(undefined,'fill',this.wNamespace,'auto');}if(format.foregroundColor==='empty'||sf.base.isNullOrUndefined(format.foregroundColor)){writer.writeAttributeString(undefined,'color',this.wNamespace,'auto');}else{writer.writeAttributeString(undefined,'color',this.wNamespace,this.getColor(format.foregroundColor));}if(!sf.base.isNullOrUndefined(format.textureStyle)){writer.writeAttributeString('w','val',this.wNamespace,this.getTextureStyle(format.textureStyle));}writer.writeEndElement();// }
};WordExport.prototype.getTextureStyle=function(textureStyle){switch(textureStyle){case'Texture5Percent':case'Texture2Pt5Percent':case'Texture7Pt5Percent':return'pct5';case'Texture10Percent':return'pct10';case'Texture12Pt5Percent':return'pct12';case'Texture15Percent':case'Texture17Pt5Percent':return'pct15';case'Texture20Percent':case'Texture22Pt5Percent':return'pct20';case'Texture25Percent':case'Texture27Pt5Percent':return'pct25';case'Texture30Percent':case'Texture32Pt5Percent':return'pct30';case'Texture35Percent':return'pct35';case'Texture37Pt5Percent':return'pct37';case'Texture40Percent':case'Texture42Pt5Percent':return'pct40';case'Texture45Percent':case'Texture47Pt5Percent':return'pct45';case'Texture50Percent':case'Texture52Pt5Percent':return'pct50';case'Texture55Percent':case'Texture57Pt5Percent':return'pct55';case'Texture60Percent':return'pct60';case'Texture62Pt5Percent':return'pct62';case'Texture65Percent':case'Texture67Pt5Percent':return'pct65';case'Texture70Percent':case'Texture72Pt5Percent':return'pct70';case'Texture75Percent':case'Texture77Pt5Percent':return'pct75';case'Texture80Percent':case'Texture82Pt5Percent':return'pct80';case'Texture85Percent':return'pct85';case'Texture87Pt5Percent':return'pct87';case'Texture90Percent':case'Texture92Pt5Percent':return'pct90';case'Texture95Percent':case'Texture97Pt5Percent':return'pct95';case'TextureCross':return'thinHorzCross';case'TextureDarkCross':return'horzCross';case'TextureDarkDiagonalCross':return'diagCross';case'TextureDarkDiagonalDown':return'reverseDiagStripe';case'TextureDarkDiagonalUp':return'diagStripe';case'TextureDarkHorizontal':return'horzStripe';case'TextureDarkVertical':return'vertStripe';case'TextureDiagonalCross':return'thinDiagCross';case'TextureDiagonalDown':return'thinReverseDiagStripe';case'TextureDiagonalUp':return'thinDiagStripe';case'TextureHorizontal':return'thinHorzStripe';case'TextureSolid':return'solid';case'TextureVertical':return'thinVertStripe';default:return'clear';}};// Serialize the table borders
WordExport.prototype.serializeTableBorders=function(writer,format){var borders=format.borders;// if (IsNoneBorder(borders))
//     return;
writer.writeStartElement(undefined,'tblBorders',this.wNamespace);this.serializeBorders(writer,format.borders,8);writer.writeEndElement();};// Serialize the borders.
WordExport.prototype.serializeBorders=function(writer,borders,multipler){this.serializeBorder(writer,borders.top,'top',multipler);this.serializeBorder(writer,borders.left,'left',multipler);this.serializeBorder(writer,borders.bottom,'bottom',multipler);this.serializeBorder(writer,borders.right,'right',multipler);this.serializeBorder(writer,borders.horizontal,'insideH',multipler);this.serializeBorder(writer,borders.vertical,'insideV',multipler);this.serializeBorder(writer,borders.diagonalDown,'tl2br',multipler);this.serializeBorder(writer,borders.diagonalUp,'tr2bl',multipler);};// Serialize the table layout element
WordExport.prototype.serializeTblLayout=function(writer,format){if(!format.allowAutoFit){writer.writeStartElement(undefined,'tblLayout',this.wNamespace);writer.writeAttributeString(undefined,'type',this.wNamespace,'fixed');writer.writeEndElement();}};// Serializes the Border
WordExport.prototype.serializeBorder=function(writer,border,tagName,multiplier){var borderStyle=border.lineStyle;var sz=(border.lineWidth?border.lineWidth:0)*multiplier;var space=border.space?border.space:0;if(borderStyle==='Cleared'){writer.writeStartElement(undefined,tagName,this.wNamespace);writer.writeAttributeString('w','val',this.wNamespace,'nil');writer.writeEndElement();return;}else if((borderStyle==='None'||sf.base.isNullOrUndefined(borderStyle))&&!border.hasNoneStyle||sz<=0){return;}writer.writeStartElement(undefined,tagName,this.wNamespace);writer.writeAttributeString('w','val',this.wNamespace,this.getBorderStyle(borderStyle));// if (border.color === '#000000')
// {
//     writer.writeAttributeString(undefined, 'color', this.wNamespace, 'auto');
// }
// else
// {
if(border.color){writer.writeAttributeString(undefined,'color',this.wNamespace,this.getColor(border.color));}// }
writer.writeAttributeString(undefined,'sz',this.wNamespace,this.roundToTwoDecimal(sz).toString());writer.writeAttributeString(undefined,'space',this.wNamespace,space.toString());if(border.shadow){writer.writeAttributeString(undefined,'shadow',this.wNamespace,'on');}writer.writeEndElement();};// Get the border style as string
WordExport.prototype.getBorderStyle=function(borderStyle){switch(borderStyle){case'Cleared':return'cleared';case'DashSmallGap':return'dashSmallGap';case'Triple':return'triple';case'Dot':return'dotted';case'DashDot':return'dotDash';case'DashLargeGap':return'dashed';case'DashDotDot':return'dotDotDash';case'Double':return'double';case'ThinThickSmallGap':return'thinThickSmallGap';case'ThickThinSmallGap':return'thickThinSmallGap';case'ThinThickThinSmallGap':return'thinThickThinSmallGap';case'ThickThinMediumGap':return'thickThinMediumGap';case'ThinThickMediumGap':return'thinThickMediumGap';case'ThinThickThinMediumGap':return'thinThickThinMediumGap';case'ThickThinLargeGap':return'thickThinLargeGap';case'ThinThickLargeGap':return'thinThickLargeGap';case'ThinThickThinLargeGap':return'thinThickThinLargeGap';case'Thick':return'thick';case'SingleWavy':return'wave';case'DoubleWavy':return'doubleWave';case'DashDotStroked':return'dashDotStroked';case'Engrave3D':return'threeDEngrave';case'Emboss3D':return'threeDEmboss';case'Outset':return'outset';case'Inset':return'inset';// case 'None':
//     return 'none';
default:return'single';}};// Serialize the table indentation.
WordExport.prototype.serializeTableIndentation=function(writer,format){if(!sf.base.isNullOrUndefined(format.leftIndent)){writer.writeStartElement(undefined,'tblInd',this.wNamespace);var tableIndent=Math.round(format.leftIndent*this.twipsInOnePoint);writer.writeAttributeString(undefined,'w',this.wNamespace,tableIndent.toString());writer.writeAttributeString(undefined,'type',this.wNamespace,'dxa');writer.writeEndElement();}};// Serialize the cell spacing.
WordExport.prototype.serializeCellSpacing=function(writer,format){if(!sf.base.isNullOrUndefined(format.cellSpacing)&&format.cellSpacing>0){writer.writeStartElement(undefined,'tblCellSpacing',this.wNamespace);writer.writeAttributeString(undefined,'w',this.wNamespace,this.roundToTwoDecimal(format.cellSpacing/2*this.twentiethOfPoint).toString());writer.writeAttributeString(undefined,'type',this.wNamespace,'dxa');writer.writeEndElement();}};// Serialize the table width
WordExport.prototype.serializeTableWidth=function(writer,table){writer.writeStartElement(undefined,'tblW',this.wNamespace);if(table.tableFormat.preferredWidthType==='Percent'){writer.writeAttributeString(undefined,'w',this.wNamespace,(table.tableFormat.preferredWidth*this.percentageFactor).toString());writer.writeAttributeString(undefined,'type',this.wNamespace,'pct');}else if(table.tableFormat.preferredWidthType==='Point'){var tableWidth=Math.round(table.tableFormat.preferredWidth*this.twipsInOnePoint);writer.writeAttributeString(undefined,'w',this.wNamespace,tableWidth.toString());writer.writeAttributeString(undefined,'type',this.wNamespace,'dxa');}else{writer.writeAttributeString(undefined,'w',this.wNamespace,'0');writer.writeAttributeString(undefined,'type',this.wNamespace,'auto');}writer.writeEndElement();};// Serialize the table alignment
WordExport.prototype.serializeTableAlignment=function(writer,format){writer.writeStartElement(undefined,'jc',this.wNamespace);switch(format.tableAlignment){case'Right':writer.writeAttributeString('w','val',this.wNamespace,'right');break;case'Center':writer.writeAttributeString('w','val',this.wNamespace,'center');break;default:writer.writeAttributeString('w','val',this.wNamespace,'left');break;}writer.writeEndElement();};// Serialize the field
WordExport.prototype.serializeFieldCharacter=function(writer,field){writer.writeStartElement(undefined,'r',this.wNamespace);this.serializeCharacterFormat(writer,field.characterFormat);writer.writeStartElement(undefined,'fldChar',this.wNamespace);var type=field.fieldType===0?'begin':field.fieldType===1?'end':'separate';writer.writeAttributeString(undefined,'fldCharType',this.wNamespace,type);if(type==='begin'&&!sf.base.isNullOrUndefined(field.formFieldData)){var formFieldData=field.formFieldData;writer.writeStartElement(undefined,'ffData',this.wNamespace);writer.writeStartElement(undefined,'name',this.wNamespace);writer.writeAttributeString(undefined,'val',this.wNamespace,formFieldData.name);writer.writeEndElement();writer.writeStartElement(undefined,'enabled',this.wNamespace);writer.writeEndElement();if(formFieldData.hasOwnProperty('textInput')){writer.writeStartElement(undefined,'textInput',this.wNamespace);var type_1=formFieldData.textInput.type;if(type_1==='Number'||'Date'){writer.writeStartElement(undefined,'type',this.wNamespace);writer.writeAttributeString(undefined,'val',this.wNamespace,formFieldData.textInput.type.toString().toLowerCase());writer.writeEndElement();}writer.writeStartElement(undefined,'default',this.wNamespace);writer.writeAttributeString(undefined,'val',this.wNamespace,formFieldData.textInput.defaultValue);writer.writeEndElement();writer.writeStartElement(undefined,'format',this.wNamespace);writer.writeAttributeString(undefined,'val',this.wNamespace,formFieldData.textInput.format);writer.writeEndElement();writer.writeEndElement();}else if(formFieldData.hasOwnProperty('checkBox')){writer.writeStartElement(undefined,'checkBox',this.wNamespace);if(formFieldData.checkBox.sizeType==='Auto'){writer.writeStartElement(undefined,'sizeAuto',this.wNamespace);writer.writeEndElement();}else{writer.writeStartElement(undefined,'size',this.wNamespace);writer.writeAttributeString(undefined,'val',this.wNamespace,this.roundToTwoDecimal(formFieldData.checkBox.size*2).toString());writer.writeEndElement();}writer.writeStartElement(undefined,'defalut',this.wNamespace);writer.writeAttributeString(undefined,'val',this.wNamespace,formFieldData.checkBox.defaultValue?'1':'0');writer.writeEndElement();if(formFieldData.checkBox.checked){writer.writeStartElement(undefined,'checked',this.wNamespace);writer.writeAttributeString(undefined,'val',this.wNamespace,formFieldData.checkBox.checked?'1':'0');writer.writeEndElement();}writer.writeEndElement();}else{writer.writeStartElement(undefined,'ddList',this.wNamespace);if(formFieldData.dropDownList.selectedIndex!==0){writer.writeStartElement(undefined,'result',this.wNamespace);writer.writeAttributeString(undefined,'val',this.wNamespace,formFieldData.dropDownList.selectedIndex.toString());writer.writeEndElement();}for(var i=0;i<formFieldData.dropDownList.dropDownItems.length;i++){writer.writeStartElement(undefined,'listEntry',this.wNamespace);writer.writeAttributeString(undefined,'val',this.wNamespace,formFieldData.dropDownList.dropDownItems[i].toString());writer.writeEndElement();}writer.writeEndElement();}writer.writeEndElement();}writer.writeEndElement();writer.writeEndElement();if(field.fieldType===0&&field.fieldCodeType==='FieldFormTextInput'){writer.writeStartElement('w','r',this.wNamespace);writer.writeStartElement(undefined,'instrText',this.wNamespace);writer.writeAttributeString('xml','space',this.xmlNamespace,'preserve');writer.writeString('FORMTEXT');writer.writeEndElement();writer.writeEndElement();}};// Serialize the text range.
WordExport.prototype.serializeTextRange=function(writer,span,previousNode,efType){writer.writeStartElement('w','r',this.wNamespace);if(!sf.base.isNullOrUndefined(span.characterFormat)){this.serializeCharacterFormat(writer,span.characterFormat);}if(span.text==='\t'){writer.writeElementString(undefined,'tab',this.wNamespace,undefined);}else if(span.text==='\v'){writer.writeElementString(undefined,'br',this.wNamespace,undefined);}else if(span.text==='\f'){writer.writeStartElement(undefined,'br',this.wNamespace);writer.writeAttributeString('w','type',this.wNamespace,'page');writer.writeEndElement();}else if(encodeURI(span.text)==='%02'){writer.writeStartElement(undefined,'footnoteRef',this.wNamespace);writer.writeEndElement();}else if(encodeURI(span.text)==='%02'&&efType==='endnote'){writer.writeStartElement(undefined,'endnoteRef',this.wNamespace);writer.writeEndElement();}else if(encodeURI(span.text)==='%03'){writer.writeStartElement(undefined,'separator',this.wNamespace);writer.writeEndElement();}else if(encodeURI(span.text)==='%04'){writer.writeStartElement(undefined,'continuationSeparator',this.wNamespace);writer.writeEndElement();}else{var isDeleteText=this.retrieveDeleteRevision(span);var isField=!sf.base.isNullOrUndefined(previousNode)&&previousNode.hasOwnProperty('fieldType')&&previousNode.fieldType!==2;var localName=isField?isDeleteText?'delInstrText':'instrText':isDeleteText?'delText':'t';writer.writeStartElement(undefined,localName,this.wNamespace);writer.writeAttributeString('xml','space',this.xmlNamespace,'preserve');writer.writeString(span.text);writer.writeEndElement();}writer.writeEndElement();};WordExport.prototype.retrieveDeleteRevision=function(span){if(span.hasOwnProperty('revisionIds')){if(span.revisionIds.length>0){for(var i=0;i<span.revisionIds.length;i++){if(this.retrieveRevision(span.revisionIds[i]).revisionType==='Deletion'){return true;}}}}return false;};// Serializes the paragraph format
WordExport.prototype.serializeParagraphFormat=function(writer,paragraphFormat,paragraph){if(sf.base.isNullOrUndefined(paragraphFormat)){return;}if(!sf.base.isNullOrUndefined(paragraphFormat.styleName)){writer.writeStartElement(undefined,'pStyle',this.wNamespace);writer.writeAttributeString('w','val',this.wNamespace,paragraphFormat.styleName);writer.writeEndElement();//end of pStyle
}if(!sf.base.isNullOrUndefined(paragraph)){this.serializeListFormat(writer,paragraph.paragraphFormat.listFormat);}else{this.serializeListFormat(writer,paragraphFormat.listFormat);}if(paragraphFormat.bidi){writer.writeStartElement(undefined,'bidi',this.wNamespace);writer.writeEndElement();}if(!sf.base.isNullOrUndefined(paragraphFormat.keepWithNext)&&paragraphFormat.keepWithNext){writer.writeStartElement(undefined,'keepNext',this.wNamespace);writer.writeEndElement();}if(!sf.base.isNullOrUndefined(paragraphFormat.keepLinesTogether)&&paragraphFormat.keepLinesTogether){writer.writeStartElement(undefined,'keepLines',this.wNamespace);writer.writeEndElement();}if(!sf.base.isNullOrUndefined(paragraphFormat.outlineLevel)){writer.writeStartElement(undefined,'outlineLvl',this.wNamespace);writer.writeAttributeString('w','val',this.wNamespace,this.getOutlineLevelValue(paragraphFormat.outlineLevel).toString());writer.writeEndElement();}this.serializeParagraphSpacing(writer,paragraphFormat);if(!sf.base.isNullOrUndefined(paragraphFormat.contextualSpacing)){writer.writeStartElement('w','contextualSpacing',this.wNamespace);if(!paragraphFormat.contextualSpacing){writer.writeAttributeString('w','val',this.wNamespace,'0');}writer.writeEndElement();}if(!sf.base.isNullOrUndefined(paragraphFormat.widowControl)){writer.writeStartElement('w','widowControl',this.wNamespace);if(paragraphFormat.widowControl){writer.writeAttributeString('w','val',this.wNamespace,'1');}else{writer.writeAttributeString('w','val',this.wNamespace,'0');}writer.writeEndElement();}this.serializeIndentation(writer,paragraphFormat);this.serializeParagraphAlignment(writer,paragraphFormat.textAlignment,paragraphFormat.bidi);if(!sf.base.isNullOrUndefined(paragraphFormat.tabs)&&paragraphFormat.tabs.length>0){this.serializeTabs(writer,paragraphFormat.tabs);}};WordExport.prototype.getOutlineLevelValue=function(outlineLvl){if(outlineLvl.indexOf('Level')!==-1){var lvlNumber=parseInt(outlineLvl.substring(5),10);if(lvlNumber>0){return lvlNumber-1;}}return 9;};// Serialize Tabs
WordExport.prototype.serializeTabs=function(writer,tabStops){writer.writeStartElement('w','tabs',this.wNamespace);for(var i=0;i<tabStops.length;i++){this.serializeTab(writer,tabStops[i]);}writer.writeEndElement();};WordExport.prototype.serializeTab=function(writer,tabStop){var position=0;writer.writeStartElement('w','tab',this.wNamespace);if(tabStop.position===0&&tabStop.deletePosition!==0){position=tabStop.deletePosition*this.twentiethOfPoint;writer.writeAttributeString('w','val',this.wNamespace,'clear');}else{position=tabStop.position*this.twentiethOfPoint;writer.writeAttributeString('w','val',this.wNamespace,this.getTabJustification(tabStop.tabJustification));}if(!sf.base.isNullOrUndefined(tabStop.tabLeader)&&tabStop.tabLeader!=='None'){writer.writeAttributeString('w','leader',this.wNamespace,this.getTabLeader(tabStop.tabLeader));}if(!isNaN(position)){writer.writeAttributeString('w','pos',this.wNamespace,position.toString()+'');}writer.writeEndElement();};WordExport.prototype.getTabLeader=function(tabLeader){switch(tabLeader){case'Dot':return'dot';case'Hyphen':return'hyphen';case'Underscore':return'underscore';default:return'none';}};WordExport.prototype.getTabJustification=function(tabJustification){switch(tabJustification){case'Bar':return'bar';case'Center':return'center';case'Decimal':return'decimal';case'Left':return'left';case'List':return'num';case'Right':return'right';default:return'clear';}};// // Seraializes the pargraph list format
// private serializeListParagraph(writer: XmlWriter, paragraph: any): void {
//     if (!isNullOrUndefined(paragraph.paragraphFormat.listFormat)) {
//         this.serializeListFormat(writer, paragraph.paragraphFormat.listFormat);
//     }
// }
// Serialize the list format
WordExport.prototype.serializeListFormat=function(writer,lf){// let pStyleName = undefined;
// if (lf.CurrentListStyle.IsBuiltInStyle && !isNullOrUndefined(lf.OwnerParagraph))
// {
//     pStyleName = lf.OwnerParagraph.StyleName;
// }
// int listId = GetListId(lf);
// if (!isNullOrUndefined(pStyleName) && string.IsNullOrEmpty(lf.LFOStyleName)) 
// {
//     WordDocument doc = lf.OwnerParagraph.Document;
//     WParagraphStyle style = doc.Styles.FindByName(pStyleName, StyleType.ParagraphStyle) as WParagraphStyle;
//     if (style.ListIndex === -1)
//     {
//         ListStyle lstStyle = lf.OwnerParagraph.Document.ListStyles.FindByName(lf.CustomStyleName);
//         style.ListIndex = listId;
//         if (lstStyle.Levels.length > 1)
//         {
//             style.ListLevel = lf.ListLevelNumber;
//         }
//         pStyleName = pStyleName.Replace(' ', '');
//         lstStyle.Levels[lf.ListLevelNumber].ParaStyleName = pStyleName;
//     }
// }
// else
// {
// if (!isNullOrUndefined(lf.listId) && !isNullOrUndefined(lf.listLevelNumber)) {
//     this.serializeNumPr(writer, lf.listId, lf.listLevelNumber);
// }
// }
if(!sf.base.isNullOrUndefined(lf.listId)||!sf.base.isNullOrUndefined(lf.listLevelNumber)){writer.writeStartElement(undefined,'numPr',this.wNamespace);if(!sf.base.isNullOrUndefined(lf.listLevelNumber)&&lf.listLevelNumber!==-1){writer.writeStartElement(undefined,'ilvl',this.wNamespace);writer.writeAttributeString('w','val',this.wNamespace,lf.listLevelNumber.toString());writer.writeEndElement();}if(!sf.base.isNullOrUndefined(lf.listId)){writer.writeStartElement(undefined,'numId',this.wNamespace);var listId=(lf.listId+1).toString();if(lf.listId===-1){listId='';}writer.writeAttributeString('w','val',this.wNamespace,listId);writer.writeEndElement();}writer.writeEndElement();}};// // Serializes the numbering properties to the paragraph
// private serializeNumPr(writer: XmlWriter, listId: number, listLevel: number): void {
//     writer.writeStartElement(undefined, 'numPr', this.wNamespace);
//     if (listLevel !== -1) {
//         writer.writeStartElement(undefined, 'ilvl', this.wNamespace);
//         writer.writeAttributeString('w', 'val', this.wNamespace, listLevel.toString());
//         writer.writeEndElement();
//     }
//     if (listId !== -1) {
//         writer.writeStartElement(undefined, 'numId', this.wNamespace);
//         writer.writeAttributeString('w', 'val', this.wNamespace, listId.toString());
//         writer.writeEndElement();
//     }
//     writer.writeEndElement();
// }
WordExport.prototype.serializeParagraphAlignment=function(writer,txtAlignment,isBidi){if(isBidi){if(txtAlignment==='Right'){txtAlignment='Left';}else if(txtAlignment==='Left'){txtAlignment='Right';}}if(!sf.base.isNullOrUndefined(txtAlignment)){writer.writeStartElement(undefined,'jc',this.wNamespace);var alignment=void 0;switch(txtAlignment){case'Center':alignment='center';break;case'Right':alignment='right';break;case'Justify':alignment='both';break;default:alignment='left';break;}writer.writeAttributeString('w','val',this.wNamespace,alignment);writer.writeEndElement();}};// Serializes the paragraph spacings
WordExport.prototype.serializeParagraphSpacing=function(writer,paragraphFormat){writer.writeStartElement(undefined,'spacing',this.wNamespace);// if (paragraphFormat.HasValue(WParagraphFormat.BeforeLinesKey))
// {
//     short beforeLines = (short)Math.Round(paragraphFormat.BeforeLines * DLSConstants.HundredthsUnit);
//     writer.WriteAttributeString('beforeLines', this.wNamespace, ToString((float)beforeLines));               
// }
// if (paragraphFormat.HasValue(WParagraphFormat.AfterLinesKey))
// {
//     short afterLines = (short)Math.Round(paragraphFormat.AfterLines * DLSConstants.HundredthsUnit);
//     writer.WriteAttributeString('afterLines', this.wNamespace, ToString((float)afterLines));                 
// }
if(!sf.base.isNullOrUndefined(paragraphFormat.beforeSpacing)){writer.writeAttributeString(undefined,'before',this.wNamespace,this.roundToTwoDecimal(paragraphFormat.beforeSpacing*this.twentiethOfPoint).toString());}//TODO:ISSUEFIX(paragraphFormat.beforeSpacing * this.twentiethOfPoint).toString());
// if (paragraphFormat.HasValue(WParagraphFormat.SpacingBeforeAutoKey))
// {
//     if (paragraphFormat.SpaceBeforeAuto)
//     {
//         writer.WriteAttributeString('beforeAutospacing', this.wNamespace, '1');
//     }
//     else
//     {
//         writer.WriteAttributeString('beforeAutospacing', this.wNamespace, '0');
//     }
// }
if(!sf.base.isNullOrUndefined(paragraphFormat.afterSpacing)){writer.writeAttributeString(undefined,'after',this.wNamespace,this.roundToTwoDecimal(paragraphFormat.afterSpacing*this.twentiethOfPoint).toString());}//TODO:ISSUEFIX(paragraphFormat.afterSpacing * this.twentiethOfPoint).toString());
// if (paragraphFormat.HasValue(WParagraphFormat.SpacingAfterAutoKey))
// {
//     if (paragraphFormat.SpaceAfterAuto)
//     {
//         writer.WriteAttributeString('afterAutospacing', this.wNamespace, '1');
//     }
//     else
//     {
//         writer.WriteAttributeString('afterAutospacing', this.wNamespace, '0');
//     }
// }
//TODO:ISSUEFIX((paragraphFormat.lineSpacing) * this.twentiethOfPoint).toString());
if(!sf.base.isNullOrUndefined(paragraphFormat.lineSpacing)){var lineSpacingValue=paragraphFormat.lineSpacingType==='AtLeast'||paragraphFormat.lineSpacingType==='Exactly'?this.roundToTwoDecimal(paragraphFormat.lineSpacing*this.twentiethOfPoint):this.roundToTwoDecimal(paragraphFormat.lineSpacing*240);writer.writeAttributeString(undefined,'line',this.wNamespace,lineSpacingValue.toString());}if(!sf.base.isNullOrUndefined(paragraphFormat.lineSpacingType)){var lineSpacingType='auto';if(paragraphFormat.lineSpacingType==='AtLeast'){lineSpacingType='atLeast';}else if(paragraphFormat.lineSpacingType==='Exactly'){lineSpacingType='exact';}writer.writeAttributeString(undefined,'lineRule',this.wNamespace,lineSpacingType);}writer.writeEndElement();};// Serializes the paragraph indentation
WordExport.prototype.serializeIndentation=function(writer,paragraphFormat){writer.writeStartElement(undefined,'ind',this.wNamespace);if(!sf.base.isNullOrUndefined(paragraphFormat.leftIndent)){writer.writeAttributeString(undefined,'left',this.wNamespace,this.roundToTwoDecimal(paragraphFormat.leftIndent*this.twipsInOnePoint).toString());}if(!sf.base.isNullOrUndefined(paragraphFormat.rightIndent)){writer.writeAttributeString(undefined,'right',this.wNamespace,this.roundToTwoDecimal(paragraphFormat.rightIndent*this.twipsInOnePoint).toString());}if(!sf.base.isNullOrUndefined(paragraphFormat.firstLineIndent)){if(paragraphFormat.firstLineIndent<0){writer.writeAttributeString(undefined,'hanging',this.wNamespace,this.roundToTwoDecimal(-1*paragraphFormat.firstLineIndent*this.twipsInOnePoint).toString());}else{writer.writeAttributeString(undefined,'firstLine',this.wNamespace,this.roundToTwoDecimal(paragraphFormat.firstLineIndent*this.twipsInOnePoint).toString());}}writer.writeEndElement();};//creates custom xml mapping
WordExport.prototype.serializeCustomXMLMapping=function(customXML,writer){if(customXML.length>0){var keys=customXML.keys;for(var i=0;i<keys.length;i++){var customXmlWriter=new sf.fileutils.XmlWriter();customXmlWriter.writeStartElement(undefined,'Relationships',this.rpNamespace);var xmlData=this.mCustomXML.get(keys[i]);var itemID=keys[i];var id=this.getNextRelationShipID();var fileIndex=i+1;var itemPath=this.createXMLItem(xmlData,id,fileIndex);var itemPropsPath=this.createXMLItemProps(itemID,fileIndex);this.serializeRelationShip(writer,id,this.customXmlRelType,'../'+itemPath);this.customXMLRelation(customXmlWriter,fileIndex,itemPropsPath);customXmlWriter.writeEndElement();var zipArchiveItem=new sf.compression.ZipArchiveItem(customXmlWriter.buffer,this.customXMLRelPath+fileIndex+'.xml.rels');this.mArchive.addItem(zipArchiveItem);}}};WordExport.prototype.customXMLRelation=function(writer,fileIndex,itemPropsPath){this.serializeRelationShip(writer,'rId1',this.wordMLCustomXmlPropsRelType,itemPropsPath);};WordExport.prototype.createXMLItem=function(xmlData,id,fileIndex){var xmlBlob=new Blob([xmlData],{type:'text/plain'});var itemPath=this.customXMLItemsPath+fileIndex+'.xml';var zipArchiveItem=new sf.compression.ZipArchiveItem(xmlBlob,itemPath);this.mArchive.addItem(zipArchiveItem);return itemPath;};WordExport.prototype.createXMLItemProps=function(itemID,fileIndex){var writer=new sf.fileutils.XmlWriter();var customitemPropsPath=this.customXMLItemsPropspath+fileIndex+'.xml';var itemPropsPath=this.itemPropsPath+fileIndex+'.xml';writer.writeStartElement('ds','datastoreItem',this.wNamespace);writer.writeAttributeString('ds','itemID',undefined,itemID);writer.writeAttributeString('xmlns','ds',undefined,this.dsNamespace);writer.writeEndElement();this.customXMLProps.push(customitemPropsPath);var zipArchiveItem=new sf.compression.ZipArchiveItem(writer.buffer,customitemPropsPath);this.mArchive.addItem(zipArchiveItem);return itemPropsPath;};// Serialize the styles (styles.xml)
WordExport.prototype.serializeStyles=function(){var writer=new sf.fileutils.XmlWriter();writer.writeStartElement('w','styles',this.wNamespace);writer.writeAttributeString('xmlns','mc',undefined,this.veNamespace);writer.writeAttributeString('xmlns','r',undefined,this.rNamespace);writer.writeAttributeString('xmlns','w',undefined,this.wNamespace);writer.writeAttributeString('xmlns','w14',undefined,this.w14Namespace);writer.writeAttributeString('xmlns','w15',undefined,this.w15Namespace);writer.writeAttributeString('mc','Ignorable',undefined,'w14 w15');//writes the document defaults, latent styles and default styles.
this.serializeDefaultStyles(writer);//writes the document styles
this.serializeDocumentStyles(writer);writer.writeEndElement();//end of styles tag
var zipArchiveItem=new sf.compression.ZipArchiveItem(writer.buffer,this.stylePath);this.mArchive.addItem(zipArchiveItem);//this.stylePath, styleStream, false, FileAttributes.Archive);
};// Serializes the default styles (document default paragraph and character format)
WordExport.prototype.serializeDefaultStyles=function(writer){writer.writeStartElement(undefined,'docDefaults',this.wNamespace);//if (HasDefaultCharFormat())
//{
writer.writeStartElement(undefined,'rPrDefault',this.wNamespace);// if (!isNullOrUndefined(this.mDocument.characterFormat)) {
this.serializeCharacterFormat(writer,this.defCharacterFormat);writer.writeEndElement();// end of rPrDefault
// }
// else {
//     writer.writeStartElement(undefined, 'rPr', this.wNamespace);
//     writer.writeStartElement(undefined, 'rFonts', this.wNamespace);
//     if (!string.IsNullOrEmpty(m_document.StandardAsciiFont))
//         writer.WriteAttributeString('ascii', this.wNamespace, m_document.StandardAsciiFont);
//     if (!string.IsNullOrEmpty(m_document.StandardFarEastFont))
//         writer.WriteAttributeString('eastAsia', this.wNamespace, m_document.StandardFarEastFont);
//     if (!string.IsNullOrEmpty(m_document.StandardNonFarEastFont))
//         writer.WriteAttributeString('hAnsi', this.wNamespace, m_document.StandardNonFarEastFont);
//     if (!string.IsNullOrEmpty(m_document.StandardBidiFont))
//         writer.WriteAttributeString('cs', this.wNamespace, m_document.StandardBidiFont);
//     writer.WriteEndElement();
//     float fontSize = GetDefFontSize(m_document, WCharacterFormat.FontSizeKey);
//     if (fontSize !== 0f)
//     {
//         writer.WriteStartElement('sz', this.wNamespace);
//         writer.WriteAttributeString('val', this.wNamespace, (fontSize * 2).ToString(CultureInfo.InvariantCulture));
//         writer.WriteEndElement();
//     }
//     fontSize = GetDefFontSize(m_document, WCharacterFormat.FontSizeBidiKey);
//     if (fontSize !== 0f)
//     {
//         writer.WriteStartElement('szCs', this.wNamespace);
//         writer.WriteAttributeString('val', this.wNamespace, (fontSize * 2).ToString(CultureInfo.InvariantCulture));
//         writer.WriteEndElement();
//     }
//     writer.WriteEndElement();
// }
// writer.WriteEndElement();
// //}
writer.writeStartElement(undefined,'pPrDefault',this.wNamespace);if(!sf.base.isNullOrUndefined(this.defParagraphFormat)){writer.writeStartElement(undefined,'pPr',this.wNamespace);this.serializeParagraphFormat(writer,this.defParagraphFormat,undefined);writer.writeEndElement();//end of pPr
}writer.writeEndElement();//end of pPrDefault
// writer.WriteEndElement();
// SerializeLatentStyles();
// //Default styles
// if (m_document.Styles.length === 0 || isNullOrUndefined(m_document.Styles.FindByName('Normal')))
// {
//     SerializeDefaultParagraphStyle();
// }
// if (!IsDocumentContainsDefaultTableStyle())
// {
//     SerializeTableNormalStyle();
// }
// if (isNullOrUndefined(m_document.Styles.FindByName('No List')) && isNullOrUndefined(m_document.Styles.FindByName('NoList')))
//     SerializeNoListStyle();
// if (isNullOrUndefined(m_document.Styles.FindByName('Table Grid')) && isNullOrUndefined(m_document.Styles.FindByName('TableGrid')))
// {
//     SerializeTableGridStyle();
// }
// }        
writer.writeEndElement();};WordExport.prototype.serializeDocumentStyles=function(writer){for(var i=0;i<this.mStyles.length;i++){var style=this.mStyles[i];writer.writeStartElement(undefined,'style',this.wNamespace);var type=style.type==='Paragraph'?'paragraph':'character';writer.writeAttributeString('w','type',this.wNamespace,type);writer.writeAttributeString('w','styleId',this.wNamespace,style.name);//name
writer.writeStartElement(undefined,'name',this.wNamespace);writer.writeAttributeString('w','val',this.wNamespace,style.name);writer.writeEndElement();//basedOn
if(!sf.base.isNullOrUndefined(style.basedOn)){writer.writeStartElement(undefined,'basedOn',this.wNamespace);writer.writeAttributeString('w','val',this.wNamespace,style.basedOn);writer.writeEndElement();}//next
if(!sf.base.isNullOrUndefined(style.next)){writer.writeStartElement(undefined,'next',this.wNamespace);writer.writeAttributeString('w','val',this.wNamespace,style.next);writer.writeEndElement();}//link
if(!sf.base.isNullOrUndefined(style.link)){writer.writeStartElement(undefined,'link',this.wNamespace);writer.writeAttributeString('w','val',this.wNamespace,style.link);writer.writeEndElement();}if(style.type==='Paragraph'){writer.writeStartElement(undefined,'pPr',this.wNamespace);this.serializeParagraphFormat(writer,style.paragraphFormat,undefined);writer.writeEndElement();}// let value = (style.characterFormat as WCharacterFormat).newgetCharacterFormat();
this.serializeCharacterFormat(writer,style.characterFormat);writer.writeEndElement();//end of Style
}};// Serializes the Character format
WordExport.prototype.serializeCharacterFormat=function(writer,characterFormat){writer.writeStartElement(undefined,'rPr',this.wNamespace);if(!sf.base.isNullOrUndefined(characterFormat.styleName)){writer.writeStartElement(undefined,'rStyle',this.wNamespace);writer.writeAttributeString('w','val',this.wNamespace,characterFormat.styleName);writer.writeEndElement();}if(!sf.base.isNullOrUndefined(characterFormat.fontFamily)){writer.writeStartElement(undefined,'rFonts',this.wNamespace);writer.writeAttributeString(undefined,'ascii',this.wNamespace,characterFormat.fontFamily);writer.writeAttributeString(undefined,'hAnsi',this.wNamespace,characterFormat.fontFamily);writer.writeAttributeString(undefined,'eastAsia',this.wNamespace,characterFormat.fontFamily);writer.writeAttributeString(undefined,'cs',this.wNamespace,characterFormat.fontFamilyBidi);writer.writeEndElement();//end         
}if(!sf.base.isNullOrUndefined(characterFormat.bold)){this.serializeBoolProperty(writer,'b',characterFormat.bold);}if(characterFormat.boldBidi){this.serializeBoolProperty(writer,'bCs',characterFormat.boldBidi);}if(!sf.base.isNullOrUndefined(characterFormat.italic)){this.serializeBoolProperty(writer,'i',characterFormat.italic);}if(!sf.base.isNullOrUndefined(characterFormat.italicBidi)){this.serializeBoolProperty(writer,'iCs',characterFormat.italicBidi);}if(characterFormat.bidi){writer.writeStartElement(undefined,'rtl',this.wNamespace);writer.writeEndElement();}if(characterFormat.allCaps){this.serializeBoolProperty(writer,'caps',characterFormat.allCaps);}if(!sf.base.isNullOrUndefined(characterFormat.strikethrough)){switch(characterFormat.strikethrough){case'SingleStrike':this.serializeBoolProperty(writer,'strike',true);break;case'DoubleStrike':this.serializeBoolProperty(writer,'dstrike',true);break;default:this.serializeBoolProperty(writer,'strike',false);this.serializeBoolProperty(writer,'dstrike',false);break;}}if(!sf.base.isNullOrUndefined(characterFormat.fontColor)){writer.writeStartElement(undefined,'color',this.wNamespace);// "empty" is old value used for auto color till v19.2.49. It is maintained for backward compatibility.
if(characterFormat.fontColor==='empty'||characterFormat.fontColor==='#00000000'){writer.writeAttributeString('w','val',this.wNamespace,'auto');}else{writer.writeAttributeString('w','val',this.wNamespace,this.getColor(characterFormat.fontColor));}writer.writeEndElement();}if(!sf.base.isNullOrUndefined(characterFormat.fontSize)){writer.writeStartElement(undefined,'sz',this.wNamespace);writer.writeAttributeString('w','val',this.wNamespace,this.roundToTwoDecimal(characterFormat.fontSize*2).toString());writer.writeEndElement();}if(!sf.base.isNullOrUndefined(characterFormat.fontSizeBidi)){writer.writeStartElement(undefined,'szCs',this.wNamespace);writer.writeAttributeString('w','val',this.wNamespace,this.roundToTwoDecimal(characterFormat.fontSizeBidi*2).toString());writer.writeEndElement();}if(!sf.base.isNullOrUndefined(characterFormat.highlightColor)&&characterFormat.highlightColor!=='NoColor'){writer.writeStartElement(undefined,'highlight',this.wNamespace);writer.writeAttributeString('w','val',this.wNamespace,this.getHighlightColor(characterFormat.highlightColor));writer.writeEndElement();}if(!sf.base.isNullOrUndefined(characterFormat.revisionIds)&&characterFormat.revisionIds.length>0){this.serializeRevisionStart(writer,characterFormat,undefined);this.serializeRevisionEnd(writer,characterFormat,undefined);}if(!sf.base.isNullOrUndefined(characterFormat.underline)&&characterFormat.underline!=='None'){writer.writeStartElement(undefined,'u',this.wNamespace);writer.writeAttributeString('w','val',this.wNamespace,this.getUnderlineStyle(characterFormat.underline));writer.writeEndElement();}if(!sf.base.isNullOrUndefined(characterFormat.baselineAlignment)){writer.writeStartElement(undefined,'vertAlign',this.wNamespace);switch(characterFormat.baselineAlignment){case'Subscript':writer.writeAttributeString('w','val',this.wNamespace,'subscript');break;case'Superscript':writer.writeAttributeString('w','val',this.wNamespace,'superscript');break;default:writer.writeAttributeString('w','val',this.wNamespace,'baseline');break;}writer.writeEndElement();}writer.writeEndElement();//end of rPrChange
};WordExport.prototype.getColor=function(color){if(color.length>0){if(color[0]==='#'){color=color.substr(1);}if(color.length>6){color=color.substr(0,6);}}return color;};// Get the underline style as string
WordExport.prototype.getUnderlineStyle=function(underlineStyle){switch(underlineStyle){case'DotDotDashHeavy':return'dashDotDotHeavy';case'DotDashHeavy':return'dashDotHeavy';case'DashHeavy':return'dashedHeavy';case'DashLong':return'dashLong';case'DashLongHeavy':return'dashLongHeavy';case'DotDash':return'dotDash';case'DotDotDash':return'dotDotDash';case'Dotted':return'dotted';case'DottedHeavy':return'dottedHeavy';case'Double':return'double';case'Single':return'single';case'Thick':return'thick';case'Wavy':return'wave';case'WavyDouble':return'wavyDouble';case'WavyHeavy':return'wavyHeavy';case'Words':return'words';default:return'dash';}};WordExport.prototype.getHighlightColor=function(highlight){switch(highlight){// Highlights the content with bright green (#ff00ff00) color.
case'BrightGreen':return'green';// Highlights the content with turquoise (#ff00ffff) color.
case'Turquoise':return'cyan';// Highlights the content with pink (#ffff00ff) color.
case'Pink':return'magenta';// Highlights the content with blue (#ff0000ff) color.
case'Blue':return'blue';// Highlights the content with red (#ffff0000) color.
case'Red':return'red';// Highlights the content with dark blue (#ff000080) color.
case'DarkBlue':return'darkBlue';// Highlights the content with teal (#ff008080) color.
case'Teal':return'darkCyan';// Highlights the content with green (#ff008000) color.
case'Green':return'darkGreen';// Highlights the content with violet (#ff800080) color.
case'Violet':return'darkMagenta';// Highlights the content with dark red (#ff800000) color.
case'DarkRed':return'darkRed';// Highlights the content with dark yellow (#ff808000)  color.
case'DarkYellow':return'darkYellow';// Highlights the content with gray 50 (#ff808080) color.
case'Gray50':return'darkGray';// Highlights the content with gray 25 (#ffc0c0c0) color.
case'Gray25':return'lightGray';// Highlights the content with black (#ff000000) color.
case'Black':return'black';// Highlights the content with yellow (#ffffff00) color.
default:return'yellow';}};/*private toggleFirstCahar(text: string) {
        return text.charAt(0).toLowerCase() + text.slice(1);
    }*/ // Serializes the bool character format property
WordExport.prototype.serializeBoolProperty=function(writer,tag,value){writer.writeStartElement(undefined,tag,this.wNamespace);if(!value){writer.writeAttributeString(undefined,'val',this.wNamespace,'0');}writer.writeEndElement();};// Serialize the list styles and numberings (numberings.xml)
WordExport.prototype.serializeNumberings=function(){if(this.document.lists.length===0){return;}var writer=new sf.fileutils.XmlWriter();writer.writeStartElement('w','numbering',this.wNamespace);this.writeCommonAttributeStrings(writer);// this.serializePictureBullets(writer, this.mDocument.lists);
this.serializeAbstractListStyles(writer,this.document.abstractLists);this.serializeListInstances(writer,this.document.lists);// SerializeListOverrides(writer, this.mDocument.ridesm_document.ListOverrides);
writer.writeEndElement();var zipArchiveItem=new sf.compression.ZipArchiveItem(writer.buffer,this.numberingPath);this.mArchive.addItem(zipArchiveItem);};// Serializes the abstract list styles
WordExport.prototype.serializeAbstractListStyles=function(writer,listStyles){for(var i=0;i<listStyles.length;i++){var abstractList=listStyles[i];writer.writeStartElement(undefined,'abstractNum',this.wNamespace);writer.writeAttributeString(undefined,'abstractNumId',this.wNamespace,abstractList.abstractListId.toString());writer.writeStartElement(undefined,'nsid',this.wNamespace);writer.writeAttributeString(undefined,'val',this.wNamespace,this.generateHex());writer.writeEndElement();for(var ilvl=0,cnt=abstractList.levels.length;ilvl<cnt;ilvl++){this.serializeListLevel(writer,abstractList.levels[ilvl],ilvl);}writer.writeEndElement();//end of abstractNum
}};// Serializes the list styles
WordExport.prototype.serializeListInstances=function(writer,listStyles){for(var i=0;i<listStyles.length;i++){var list=listStyles[i];writer.writeStartElement(undefined,'num',this.wNamespace);writer.writeAttributeString(undefined,'numId',this.wNamespace,(list.listId+1).toString());writer.writeStartElement(undefined,'abstractNumId',this.wNamespace);writer.writeAttributeString(undefined,'val',this.wNamespace,list.abstractListId.toString());writer.writeEndElement();writer.writeEndElement();}};WordExport.prototype.generateHex=function(){return(Math.floor(Math.random()*(4000000000-270000000))+270000000).toString(16).toUpperCase();};WordExport.prototype.roundToTwoDecimal=function(num){return Math.round(num);// * 100) / 100;
};// Serialize the list level
WordExport.prototype.serializeListLevel=function(writer,listLevel,levelIndex){writer.writeStartElement(undefined,'lvl',this.wNamespace);writer.writeAttributeString(undefined,'ilvl',this.wNamespace,levelIndex.toString());writer.writeStartElement(undefined,'start',this.wNamespace);writer.writeAttributeString(undefined,'val',this.wNamespace,listLevel.startAt.toString());writer.writeEndElement();writer.writeStartElement(undefined,'numFmt',this.wNamespace);writer.writeAttributeString(undefined,'val',this.wNamespace,this.getLevelPattern(listLevel.listLevelPattern));writer.writeEndElement();// if (listLevel.restartLevel > 0) {
//     writer.writeStartElement(undefined, 'lvlRestart', this.wNamespace);
//     writer.writeAttributeString(undefined, 'val', this.wNamespace, '0');
//     writer.writeEndElement();
// }
// if (!isNullOrUndefined(listLevel.paragraphFormat)) {
//     string name = listLevel.ParaStyleName.Substring(0, 1).ToUpper() + listLevel.ParaStyleName.Remove(0, 1);
//     writer.WriteStartElement('pStyle', this.wNamespace);
//     writer.WriteAttributeString('val', this.wNamespace, name);
//     writer.WriteEndElement();
// }
// if (listLevel.IsLegalStyleNumbering) {
//     writer.WriteStartElement('isLgl', this.wNamespace);
//     writer.WriteEndElement();
// }
this.serializeLevelFollow(writer,listLevel);this.serializeLevelText(writer,listLevel,levelIndex+1);// SerializeLegacyProperties(listLevel);
// if (listLevel.PicBulletId > 0) {
//     writer.WriteStartElement('lvlPicBulletId', this.wNamespace);
//     writer.WriteAttributeString('val', this.wNamespace, listLevel.PicBulletId.ToString());
//     writer.WriteEndElement();
// }
// //lvlJc
// if (listLevel.NumberAlignment !== ListNumberAlignment.Left) {
//     writer.WriteStartElement('lvlJc', this.wNamespace);
//     string alignment = string.Empty;
//     if (listLevel.NumberAlignment === ListNumberAlignment.Right) {
//         alignment = 'right';
//     }
//     else {
//         alignment = 'center';
//     }
//     writer.WriteAttributeString('val', this.wNamespace, alignment);
//     writer.WriteEndElement();
// }
writer.writeStartElement(undefined,'pPr',this.wNamespace);this.serializeParagraphFormat(writer,listLevel.paragraphFormat,undefined);writer.writeEndElement();//end of pPr
this.serializeCharacterFormat(writer,listLevel.characterFormat);writer.writeEndElement();};WordExport.prototype.getLevelPattern=function(levelPattern){var patternType;switch(levelPattern){case'Arabic':patternType='decimal';break;case'UpRoman':patternType='upperRoman';break;case'LowRoman':patternType='lowerRoman';break;case'UpLetter':patternType='upperLetter';break;case'LowLetter':patternType='lowerLetter';break;// case 'Ordinal':
//     patternType = 'ordinal';
//     break;
// case 'Number':
//     patternType = 'cardinalText';
//     break;
// case 'OrdinalText':
//     patternType = 'ordinalText';
//     break;
// case 'LeadingZero':
//     patternType = 'decimalZero';
//     break;
// case 'Bullet':
default:patternType='bullet';break;// case 'FarEast':
//     patternType = 'aiueoFullWidth';
//     break;
// case 'Special':
//     patternType = 'russianLower';
//     break;
// case 'None':
//     patternType = 'none';
//     break;
}return patternType;};// Serializes the level text
WordExport.prototype.serializeLevelText=function(writer,listLevel,lvlIndex){writer.writeStartElement(undefined,'lvlText',this.wNamespace);writer.writeAttributeString(undefined,'val',this.wNamespace,listLevel.numberFormat);writer.writeEndElement();};// Serialize the level follow character
WordExport.prototype.serializeLevelFollow=function(writer,listLevel){var fc;//TODO:Type issue returns number instead of string
if(listLevel.followCharacter==='Tab'){fc='tab';}else if(listLevel.followCharacter==='Space'){fc='space';}else{fc='nothing';}writer.writeStartElement(undefined,'suff',this.wNamespace);writer.writeAttributeString(undefined,'val',this.wNamespace,fc);writer.writeEndElement();};WordExport.prototype.serializeDocumentProtectionSettings=function(writer){writer.writeStartElement('w','documentProtection',this.wNamespace);if(this.formatting){writer.writeAttributeString('w','formatting',this.wNamespace,'1');}if(this.protectionType&&this.protectionType!=='NoProtection'){var editMode=this.protectionType==='ReadOnly'?'readOnly':'forms';writer.writeAttributeString('w','edit',this.wNamespace,editMode);}writer.writeAttributeString('w','cryptProviderType',this.wNamespace,'rsaAES');writer.writeAttributeString('w','cryptAlgorithmClass',this.wNamespace,'hash');writer.writeAttributeString('w','cryptAlgorithmType',this.wNamespace,'typeAny');writer.writeAttributeString('w','cryptAlgorithmSid',this.wNamespace,'14');writer.writeAttributeString('w','cryptSpinCount',this.wNamespace,'100000');if(this.enforcement){writer.writeAttributeString('w','enforcement',this.wNamespace,'1');}if(this.hashValue){writer.writeAttributeString('w','hash',this.wNamespace,this.hashValue);}if(this.saltValue){writer.writeAttributeString('w','salt',this.wNamespace,this.saltValue);}writer.writeEndElement();};WordExport.prototype.serializeSettings=function(){var writer=new sf.fileutils.XmlWriter();writer.writeStartElement('w','settings',this.wNamespace);this.writeCustom(writer);// writer.writeAttributeString('xmlns', 'mc', undefined, this.veNamespace);
// writer.writeAttributeString('xmlns', 'o', undefined, this.oNamespace);
// writer.writeAttributeString('xmlns', 'r', undefined, this.rNamespace);
// writer.writeAttributeString('xmlns', 'm', undefined, this.mNamespace);
// writer.writeAttributeString('xmlns', 'v', undefined, this.vNamespace);
writer.writeAttributeString('xmlns','w10',undefined,this.w10Namespace);writer.writeAttributeString('xmlns','w14',undefined,this.w14Namespace);writer.writeAttributeString('xmlns','w15',undefined,this.w15Namespace);writer.writeAttributeString('xmlns','sl',undefined,this.slNamespace);writer.writeAttributeString('mc','Ignorable',undefined,'w14 w15');// //w:writeProtection - Write Protection
this.serializeDocumentProtectionSettings(writer);//w:view - Document View Setting
// if (this.mDocument.ViewSetup.DocumentViewType !== DocumentViewType.PrintLayout &&
//   m_document.ViewSetup.DocumentViewType !== DocumentViewType.NormalLayout)
// {
//     writer.writeStartElement('view', this.wNamespace);
//     string viewTypeStr = string.Empty;
//     if (m_document.ViewSetup.DocumentViewType === DocumentViewType.OutlineLayout)
//     {
//         viewTypeStr = 'outline';
//     }
//     else if (m_document.ViewSetup.DocumentViewType === DocumentViewType.WebLayout)
//     {
//         viewTypeStr = 'web';
//     }
//     writer.writeAttributeString('val', this.wNamespace, viewTypeStr);
//     writer.writeEndElement();
// }
//w:zoom - Magnification Setting
writer.writeStartElement('w','zoom',this.wNamespace);// switch (m_document.ViewSetup.ZoomType)
// {
//     case ZoomType.FullPage:
//         writer.writeAttributeString('w', 'val', this.wNamespace, 'fullPage');
//         break;
//     case ZoomType.PageWidth:
//         writer.writeAttributeString('w', 'val', this.wNamespace, 'bestFit');
//         break;
//     case ZoomType.TextFit:
//         writer.writeAttributeString('w', 'val', this.wNamespace, 'textFit');
//         break;
// default:
writer.writeAttributeString('w','val',this.wNamespace,'none');// break;
// }
writer.writeAttributeString('w','percent',this.wNamespace,'100');writer.writeEndElement();//w:displayBackgroundShape - Display Background Objects When Displaying Document
// if (m_document.Background.Type !== BackgroundType.NoBackground)
// {
writer.writeStartElement(undefined,'displayBackgroundShape',this.wNamespace);writer.writeEndElement();// }
//w:defaultTabStop - Distance Between Automatic Tab Stops
writer.writeStartElement(undefined,'defaultTabStop',this.wNamespace);var tabWidth=Math.round(this.defaultTabWidthValue*this.twipsInOnePoint);writer.writeAttributeString(undefined,'val',this.wNamespace,tabWidth.toString());writer.writeEndElement();if(this.trackChanges){writer.writeStartElement(undefined,'trackRevisions',this.wNamespace);writer.writeEndElement();}//w:evenAndOddHeaders - Different Even/Odd Page Headers and Footers        
if(this.mDifferentFirstPage){writer.writeStartElement(undefined,'evenAndOddHeaders',this.wNamespace);writer.writeEndElement();}//w:footnotePr - Document-Wide Footnote Properties and w:endnotePr - Document-Wide Endnote Properties
// SerializeFootnoteSettings();
//w:compat - Compatibility Settings
if(!this.formFieldShading){writer.writeStartElement(undefined,'doNotShadeFormData',this.wNamespace);writer.writeEndElement();}writer.writeStartElement(undefined,'compat',this.wNamespace);if(this.dontUseHtmlParagraphAutoSpacing){this.serializeBoolProperty(writer,'doNotUseHTMLParagraphAutoSpacing',this.dontUseHtmlParagraphAutoSpacing);}writer.writeStartElement(undefined,'compatSetting',this.wNamespace);writer.writeAttributeString(undefined,'name',this.wNamespace,'compatibilityMode');writer.writeAttributeString(undefined,'uri',this.wNamespace,'http://schemas.microsoft.com/office/word');var compatValue=HelperMethods.getCompatibilityModeValue(this.compatibilityMode);writer.writeAttributeString(undefined,'val',this.wNamespace,compatValue);writer.writeEndElement();writer.writeEndElement();if(this.document.footnotes){//this.serializeFootNotesPr(writer, this.document.section.sectionFormat);
writer.writeStartElement(undefined,'footnotePr',this.wNamespace);writer.writeStartElement(undefined,'footnote',this.wNamespace);writer.writeAttributeString(undefined,'id',this.wNamespace,'-1');writer.writeEndElement();writer.writeStartElement(undefined,'footnote',this.wNamespace);writer.writeAttributeString(undefined,'id',this.wNamespace,'0');writer.writeEndElement();writer.writeEndElement();}if(this.document.endnotes){// this.serializeEndNotesPr(writer, this.document.section.sectionFormat);
writer.writeStartElement(undefined,'endnotePr',this.wNamespace);writer.writeStartElement(undefined,'endnote',this.wNamespace);writer.writeAttributeString(undefined,'id',this.wNamespace,'-1');writer.writeEndElement();writer.writeStartElement(undefined,'endnote',this.wNamespace);writer.writeAttributeString(undefined,'id',this.wNamespace,'0');writer.writeEndElement();writer.writeEndElement();}writer.writeEndElement();var zipArchiveItem=new sf.compression.ZipArchiveItem(writer.buffer,this.settingsPath);this.mArchive.addItem(zipArchiveItem);};WordExport.prototype.serializeCoreProperties=function(){//implementation
};WordExport.prototype.serializeAppProperties=function(){//implementation
};WordExport.prototype.serializeFontTable=function(contentType){//implementation
};WordExport.prototype.serializeSettingsRelation=function(){//implementation
};WordExport.prototype.serializeHeaderFooters=function(){this.serializeHeaderFooter('EvenFooter');this.serializeHeaderFooter('EvenHeader');this.serializeHeaderFooter('FirstPageFooter');this.serializeHeaderFooter('FirstPageHeader');this.serializeHeaderFooter('OddFooter');this.serializeHeaderFooter('OddHeader');};// Serializes the Header/Footer
WordExport.prototype.serializeHeaderFooter=function(hfType){if(this.headersFooters.length===0){return;}var headerFooterPath;var headerFooterRelsPath;if(!this.headersFooters.containsKey(hfType)){return;}var hfColl=this.headersFooters.get(hfType);var hf=undefined;for(var i=0;i<hfColl.keys.length;i++){var id=hfColl.keys[i];hf=hfColl.get(id);if(hfType==='EvenHeader'||hfType==='FirstPageHeader'||hfType==='OddHeader'){headerFooterPath=this.headerPath+id.replace('rId','')+'.xml';headerFooterRelsPath=this.headerRelationPath+id.replace('rId','')+'.xml.rels';this.serializeHeader(hf,id,headerFooterPath,headerFooterRelsPath);}else{headerFooterPath=this.footerPath+id.replace('rId','')+'.xml';headerFooterRelsPath=this.footerRelationPath+id.replace('rId','')+'.xml.rels';this.serializeFooter(hf,id,headerFooterPath,headerFooterRelsPath);}}};// Serialize the header part
WordExport.prototype.serializeHeader=function(header,id,headerFooterPath,headerFooterRelsPath){this.headerFooter=header;var writer=new sf.fileutils.XmlWriter();writer.writeStartElement('w','hdr',this.wNamespace);this.writeHFCommonAttributes(writer);var owner=this.blockOwner;this.blockOwner=header;this.serializeBodyItems(writer,header.blocks,true);this.blockOwner=owner;writer.writeEndElement();var zipArchiveItem=new sf.compression.ZipArchiveItem(writer.buffer,headerFooterPath);this.mArchive.addItem(zipArchiveItem);this.serializeHFRelations(id,headerFooterRelsPath);this.headerFooter=undefined;};// Serializes the HeaderFooter relations
WordExport.prototype.serializeHFRelations=function(hfId,headerFooterRelsPath){var hasHFImage=this.headerFooterImages.containsKey(hfId);// let hasHFHyperlinks = HeaderFooterHyperlinks.ContainsKey(hfId);
// let hasHFInclPics = HeaderFooterInclPicUrls.ContainsKey(hfId);
// let hasHFAlternateChunks = HeaderFooterAlternateChunks.ContainsKey(hfId);
if(hasHFImage){// || hasHFHyperlinks ||hasHFAlternateChunks
var writer=new sf.fileutils.XmlWriter();writer.writeStartElement(undefined,'Relationships',this.rpNamespace);this.serializeImagesRelations(this.headerFooterImages.get(hfId),writer);// if (hasHFHyperlinks)
//     SerializeHyperlinkRelations(stream, HeaderFooterHyperlinks[hfId]);
// if (hasHFAlternateChunks)
//     SerializeAltChunkRelations(stream, HeaderFooterAlternateChunks[hfId]);
// if (hasHFInclPics)
//     SerializeIncludePictureUrlRelations(stream, HeaderFooterInclPicUrls[hfId]);
// if (HFOleContainers.ContainsKey(hfId))
// {
//     AddOLEToZip(HFOleContainers[hfId]);
// }
// if (HFRelations.ContainsKey(hfId))
//     SerializeHFCommonRelations(stream, HFRelations[hfId]);
writer.writeEndElement();var zipArchiveItem=new sf.compression.ZipArchiveItem(writer.buffer,headerFooterRelsPath);this.mArchive.addItem(zipArchiveItem);}else{return;}};WordExport.prototype.writeHFCommonAttributes=function(writer){writer.writeAttributeString('xmlns','v',undefined,this.vNamespace);writer.writeAttributeString('xmlns','w10',undefined,this.w10Namespace);writer.writeAttributeString('xmlns','o',undefined,this.oNamespace);writer.writeAttributeString('xmlns','ve',undefined,this.veNamespace);writer.writeAttributeString('xmlns','r',undefined,this.rNamespace);writer.writeAttributeString('xmlns','m',undefined,this.mNamespace);writer.writeAttributeString('xmlns','wne',undefined,this.wneNamespace);writer.writeAttributeString('xmlns','a',undefined,this.aNamespace);writer.writeAttributeString('xmlns','pic',undefined,this.pictureNamespace);writer.writeAttributeString('xmlns','wp',undefined,this.wpNamespace);writer.writeAttributeString('xmlns','wpc',undefined,this.wpCanvasNamespace);writer.writeAttributeString('xmlns','wp14',undefined,this.wpDrawingNamespace);this.writeDup(writer);writer.writeAttributeString('xmlns','wps',undefined,this.wpShapeNamespace);writer.writeAttributeString('ve','Ignorable',undefined,'w14 w15 wp14');};// Serailize the footer and its relations
WordExport.prototype.serializeFooter=function(footer,id,headerFooterPath,headerFooterRelsPath){this.headerFooter=footer;var writer=new sf.fileutils.XmlWriter();writer.writeStartElement('w','ftr',this.wNamespace);this.writeHFCommonAttributes(writer);this.serializeBodyItems(writer,footer.blocks,true);writer.writeEndElement();var zipArchiveItem=new sf.compression.ZipArchiveItem(writer.buffer,headerFooterPath);this.mArchive.addItem(zipArchiveItem);this.serializeHFRelations(id,headerFooterRelsPath);};WordExport.prototype.serializeDocumentRelations=function(){var writer=new sf.fileutils.XmlWriter();writer.writeStartElement(undefined,'Relationships',this.rpNamespace);this.serializeRelationShip(writer,this.getNextRelationShipID(),this.stylesRelType,'styles.xml');this.serializeRelationShip(writer,this.getNextRelationShipID(),this.settingsRelType,'settings.xml');if(this.document.endnotes){this.serializeRelationShip(writer,this.getNextRelationShipID(),this.endnoteRelType,'endnotes.xml');}if(this.document.footnotes){this.serializeRelationShip(writer,this.getNextRelationShipID(),this.footnoteRelType,'footnotes.xml');}if(this.mComments.length>0){if(!(this.mComments.length===1&&this.mComments[0].text==='')){this.serializeRelationShip(writer,this.getNextRelationShipID(),this.commentsRelType,'comments.xml');this.serializeRelationShip(writer,this.getNextRelationShipID(),this.commentsExRelType,'commentsExtended.xml');}}// this.serializeRelationShip(writer, this.getNextRelationShipID(), this.ThemeRelType, 'theme/theme1.xml');
if(this.document.lists.length>0){this.serializeRelationShip(writer,this.getNextRelationShipID(),this.numberingRelType,'numbering.xml');}//this.serializeFootnoteEndnoteRelations(writer);
this.serializeHeaderFooterRelations(writer);//this.serializeFootnoteXMLMapping(writer);
// if (HasFontTable) {
//     SerializeRelationShip(docRelstream, GetNextRelationShipID(), this.FontTableRelType, 'fontTable.xml');
// }
// SerializeIncludePictureUrlRelations(docRelstream, InclPicFieldUrl);
// //// Creating relationships for every hyperlink and image containing in the document
this.serializeImagesRelations(this.documentImages,writer);// serialize custom xml
this.serializeCustomXMLMapping(this.mCustomXML,writer);// serialize chart relations
this.serializeChartDocumentRelations(this.documentCharts,writer);// SerializeSvgImageRelation();
//this.serializeExternalLinkImages(writer);
// if (HasHyperlink && HyperlinkTargets.length > 0) {
//     SerializeHyperlinkRelations(docRelstream, HyperlinkTargets);
// }
// if (m_document.HasMacros
//     && IsMacroEnabled)
//     SerializeRelationShip(docRelstream, GetNextRelationShipID(), this.VbaProjectRelType, this.VbaProject);
writer.writeEndElement();var zipArchiveItem=new sf.compression.ZipArchiveItem(writer.buffer,this.wordRelationPath);this.mArchive.addItem(zipArchiveItem);this.headerFooter=undefined;};// serialize chart relations
WordExport.prototype.serializeChartDocumentRelations=function(charts,writer){if(charts.length>0){var keys=charts.keys;for(var i=1;i<=keys.length;i++){this.serializeRelationShip(writer,keys[i-1],this.chartRelType,'charts/chart'+i+'.xml');}}};WordExport.prototype.serializeChartRelations=function(){var writer=new sf.fileutils.XmlWriter();this.resetChartRelationShipId();writer.writeStartElement(undefined,'Relationships',this.rpNamespace);var chartColorPath='colors'+this.chartCount+'.xml';var chartRelationPath=this.chartPath+'/_rels/chart'+this.chartCount+'.xml.rels';var chartExcelPath='../embeddings/Microsoft_Excel_Worksheet'+this.chartCount+'.xlsx';this.serializeRelationShip(writer,this.getNextChartRelationShipID(),this.packageRelType,chartExcelPath);this.serializeRelationShip(writer,this.getNextChartRelationShipID(),this.chartColorStyleRelType,chartColorPath);writer.writeEndElement();// end of relationships
var zipArchiveItem=new sf.compression.ZipArchiveItem(writer.buffer,chartRelationPath);this.mArchive.addItem(zipArchiveItem);};// Serializes the image relations
WordExport.prototype.serializeImagesRelations=function(images,writer){if(images.length>0){var imagePath='';var base64ImageString=void 0;var keys=images.keys;for(var i=0;i<keys.length;i++){var mImage=images.get(keys[i]);base64ImageString=mImage.imageString;if(sf.base.isNullOrUndefined(base64ImageString)){imagePath=this.imagePath+'/0.jpeg';this.serializeRelationShip(writer,keys[i],this.imageRelType,imagePath.replace('word/',''));}else{var imageInfo=HelperMethods.formatClippedString(base64ImageString);var extension=imageInfo.extension;var formatClippedString=imageInfo.formatClippedString;imagePath=this.imagePath+keys[i]+extension;this.serializeRelationShip(writer,keys[i],this.imageRelType,imagePath.replace('word/',''));//if (m_archive.Find(imagePath.Replace('\\', '/')) === -1)
// {
var imageBlob=new Blob([this.encodedString(formatClippedString)]);var zipArchiveItem=new sf.compression.ZipArchiveItem(imageBlob,imagePath);// let TestArchive = new ZipArchive();
this.mArchive.addItem(zipArchiveItem);// TestArchive.save('image.zip').then(function (): void {
//     TestArchive.destroy();
// });
// }
}}}};/**
     * @private
     */WordExport.prototype.encodedString=function(input){var keyStr='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';var chr1;var chr2;var chr3;var encode1;var encode2;var encode3;var encode4;var count=0;var resultIndex=0;/*let dataUrlPrefix: string = 'data:';*/input=input.replace(/[^A-Za-z0-9\+\/\=]/g,'');var totalLength=input.length*3/4;if(input.charAt(input.length-1)===keyStr.charAt(64)){totalLength--;}if(input.charAt(input.length-2)===keyStr.charAt(64)){totalLength--;}if(totalLength%1!==0){// totalLength is not an integer, the length does not match a valid
// base64 content. That can happen if:
// - the input is not a base64 content
// - the input is *almost* a base64 content, with a extra chars at the
// beginning or at the end
// - the input uses a base64 variant (base64url for example)
throw new Error('Invalid base64 input, bad content length.');}var output=new Uint8Array(totalLength|0);while(count<input.length){encode1=keyStr.indexOf(input.charAt(count++));encode2=keyStr.indexOf(input.charAt(count++));encode3=keyStr.indexOf(input.charAt(count++));encode4=keyStr.indexOf(input.charAt(count++));chr1=encode1<<2|encode2>>4;chr2=(encode2&15)<<4|encode3>>2;chr3=(encode3&3)<<6|encode4;output[resultIndex++]=chr1;if(encode3!==64){output[resultIndex++]=chr2;}if(encode4!==64){output[resultIndex++]=chr3;}}return output;};WordExport.prototype.serializeExternalLinkImages=function(writer){var keys=this.externalImages.keys;for(var i=0;i<this.externalImages.keys.length;i++){this.serializeRelationShip(writer,keys[i],this.imageRelType,this.externalImages.get(keys[i]));}};// Serializes the HeaderFooters relations to the document relations stream
WordExport.prototype.serializeHeaderFooterRelations=function(writer){this.serializeHFRelation(writer,'EvenFooter');this.serializeHFRelation(writer,'EvenHeader');this.serializeHFRelation(writer,'FirstPageFooter');this.serializeHFRelation(writer,'FirstPageHeader');this.serializeHFRelation(writer,'OddFooter');this.serializeHFRelation(writer,'OddHeader');};// Serializes the headers footers relations.
WordExport.prototype.serializeHFRelation=function(writer,hfType){var headerFooterPath='';var relType;if(!this.headersFooters.containsKey(hfType)){return;}var hfColl=this.headersFooters.get(hfType);for(var i=0;i<hfColl.keys.length;i++){var id=hfColl.keys[i];if(hfType==='EvenHeader'||hfType==='FirstPageHeader'||hfType==='OddHeader'){headerFooterPath='header'+id.replace('rId','')+'.xml';relType=this.headerRelType;}else{headerFooterPath='footer'+id.replace('rId','')+'.xml';relType=this.footerRelType;}this.serializeRelationShip(writer,id,relType,headerFooterPath);}};// Serializes the relationship
WordExport.prototype.serializeRelationShip=function(writer,relationshipID,relationshipType,targetPath){writer.writeStartElement(undefined,'Relationship',undefined);writer.writeAttributeString(undefined,'Id',undefined,relationshipID);writer.writeAttributeString(undefined,'Type',undefined,relationshipType);writer.writeAttributeString(undefined,'Target',undefined,targetPath.replace('\\','/').replace('\v',''));if(relationshipType===this.hyperlinkRelType||this.startsWith(targetPath,'http://')||this.startsWith(targetPath,'https://')||this.startsWith(targetPath,'file:///')){// Uri targetUri;
// if ((!targetPath.StartsWith('file:///')) && Uri.TryCreate(targetPath, UriKind.Absolute, out targetUri))
// {
//     //Handled using Try catch to avoid exception if the Host name type is None because in 
//Silverlight 'HostNameType' property is not available.
//     try
//     {
//         m_writer.WriteAttributeString('Target', targetUri.AbsoluteUri);
//     }
//     catch
//     {
//         m_writer.WriteAttributeString('Target', targetPath.Replace('\\', '/').Replace(ControlChar.LineBreak, string.Empty));
//     }
// }
// else
// {
//     m_writer.WriteAttributeString('Target', targetPath.Replace('\\', '/').Replace(ControlChar.LineBreak, string.Empty));
// }
writer.writeAttributeString(undefined,'TargetMode',undefined,'External');}writer.writeEndElement();};// Get the next relationship ID
WordExport.prototype.getNextRelationShipID=function(){return'rId'+ ++this.mRelationShipID;};WordExport.prototype.getEFNextRelationShipID=function(){return(++this.efRelationShipId).toString();};WordExport.prototype.serializeGeneralRelations=function(){var writer=new sf.fileutils.XmlWriter();this.resetRelationShipID();writer.writeStartElement(undefined,'Relationships',this.rpNamespace);this.serializeRelationShip(writer,this.getNextRelationShipID(),this.documentRelType,this.documentPath);// this.serializeRelationShip(writer, this.getNextRelationShipID(), this.AppRelType, this.appPath);
// this.serializeRelationShip(writer, this.getNextRelationShipID(), this.CoreRelType, this.corePath);
//End of Relationships tag
writer.writeEndElement();var zipArchiveItem=new sf.compression.ZipArchiveItem(writer.buffer,this.generalRelationPath);this.mArchive.addItem(zipArchiveItem);};WordExport.prototype.serializeContentTypes=function(contentType){var writer=new sf.fileutils.XmlWriter();writer.writeStartElement(undefined,'Types','http://schemas.openxmlformats.org/package/2006/content-types');//if (m_hasOleObject)
//{
//    //<Default Extension='bin' ContentType='application/vnd.openxmlformats-officedocument.oleObject'/>
//    SerializeDefaultContentType(contentStream, 'bin', 'application/vnd.openxmlformats-officedocument.oleObject');
//}
this.serializeDefaultContentType(writer,'rels',this.relationContentType);this.serializeDefaultContentType(writer,'xml',this.xmlContentType);// if (m_hasEmbedFonts && !string.IsNullOrEmpty(type))
// {
//     SerializeDefaultContentType(contentStream,type, this.fontContentType);
// }
if(this.documentImages.length>0||this.externalImages.length>0||this.headerFooterImages.length>0){this.serializeDefaultContentType(writer,'png','image/png');this.serializeDefaultContentType(writer,'bmp','image/bmp');this.serializeDefaultContentType(writer,'emf','image/x-emf');this.serializeDefaultContentType(writer,'wmf','image/x-wmf');this.serializeDefaultContentType(writer,'gif','image/gif');this.serializeDefaultContentType(writer,'ico','image/x-icon');this.serializeDefaultContentType(writer,'tif','image/tiff');this.serializeDefaultContentType(writer,'tiff','image/tiff');this.serializeDefaultContentType(writer,'jpeg','image/jpeg');this.serializeDefaultContentType(writer,'jpg','image/jpeg');this.serializeDefaultContentType(writer,'svg','image/svg+xml');}// if (m_document.HasMacros
//     && IsMacroEnabled && !m_isSkipBinExtension)
// {
//     SerializeDefaultContentType(contentStream, 'bin', this.VbaProjectContentType);
//     m_isSkipBinExtension = true;
// }
// if (m_hasOleObject)
// {
//     SerializeOleContentType(contentStream);
// }
//document.xml
this.serializeOverrideContentType(writer,this.documentPath,this.documentContentType);//<Override PartName='/word/numbering.xml' ContentType='application/vnd.openxmlformats-officedocument.wordprocessingml.numbering+xml'/>
// if (HasNumbering) {
this.serializeOverrideContentType(writer,this.numberingPath,this.numberingContentType);// }
//Add the header/footer Alternate chunks
// if (HeaderFooterAlternateChunks.length > 0) {
//     foreach(Dictionary < string, string > item in m_headerFooterAlternateChunks.Values)
//     AddAlternateChunkItem(item);
// }
//styles.xml
this.serializeOverrideContentType(writer,this.stylePath,this.stylesContentType);//settings.xml
this.serializeOverrideContentType(writer,this.settingsPath,this.settingsContentType);this.serializeOverrideContentType(writer,this.commentsPath,this.commentsContentType);//comments.xml
this.serializeOverrideContentType(writer,this.commentsExtendedPath,this.commentsExContentType);//charts.xml
if(this.chartCount>0){var count=1;this.serializeDefaultContentType(writer,'xlsx','application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');while(count<=this.chartCount){this.serializeOverrideContentType(writer,'word/charts/chart'+count+'.xml',this.chartsContentType);this.serializeOverrideContentType(writer,'word/charts/colors'+count+'.xml',this.chartColorStyleContentType);count++;}}// Custom XML mapping
if(this.customXMLProps.length>0){for(var i=0;i<this.customXMLProps.length;i++){this.serializeOverrideContentType(writer,this.customXMLProps[i],this.customXmlContentType);}}//             //core.xml
//             SerializeOverrideContentType(contentStream, this.corePath, this.CoreContentType);
//             //app.xml
//             SerializeOverrideContentType(contentStream, this.appPath, this.AppContentType);
//             //custom.xml
//             if (!isNullOrUndefined(m_document.CustomDocumentProperties) && m_document.CustomDocumentProperties.length > 0)
//                 SerializeOverrideContentType(contentStream, this.CustomPath, this.CustomContentType);
// #if Chart
//             if (m_hasChart)
//                 SerializeChartContentType(contentStream);
// #endif
this.serializeHFContentTypes(writer);this.SerializeEFContentTypes(writer);// WriteXmlItemsContentTypes(contentStream);
//End of Types tag
writer.writeEndElement();var zipArchiveItem=new sf.compression.ZipArchiveItem(writer.buffer,this.contentTypesPath);this.mArchive.addItem(zipArchiveItem);};// Serializes the HeaderFooter content types
WordExport.prototype.serializeHFContentTypes=function(writer){this.serializeHeaderFootersContentType(writer,'EvenFooter');this.serializeHeaderFootersContentType(writer,'EvenHeader');this.serializeHeaderFootersContentType(writer,'FirstPageFooter');this.serializeHeaderFootersContentType(writer,'FirstPageHeader');this.serializeHeaderFootersContentType(writer,'OddFooter');this.serializeHeaderFootersContentType(writer,'OddHeader');};// Serializes the HeaderFooter content types.
WordExport.prototype.serializeHeaderFootersContentType=function(writer,headerFooterType){var contentType;var partName;if(!this.headersFooters.containsKey(headerFooterType)){return;}var hfColl=this.headersFooters.get(headerFooterType);for(var i=0;i<hfColl.keys.length;i++){var id=hfColl.keys[i];if(headerFooterType==='EvenHeader'||headerFooterType==='FirstPageHeader'||headerFooterType==='OddHeader'){partName=this.headerPath+id.replace('rId','')+'.xml';contentType=this.headerContentType;}else{partName=this.footerPath+id.replace('rId','')+'.xml';contentType=this.footerContentType;}this.serializeOverrideContentType(writer,partName,contentType);}};WordExport.prototype.SerializeEFContentTypes=function(writer){this.serializeEFContentType(writer);};// Serializes the HeaderFooter content types.
WordExport.prototype.serializeEFContentType=function(writer){var contentType;var partName;partName=this.endnotesPath;contentType=this.endnoteContentType;this.serializeOverrideContentType(writer,partName,contentType);partName=this.footnotesPath;contentType=this.footnoteContentType;this.serializeOverrideContentType(writer,partName,contentType);};// Serializes the Override content type.
WordExport.prototype.serializeOverrideContentType=function(writer,partName,contentType){writer.writeStartElement(undefined,'Override',undefined);writer.writeAttributeString(undefined,'PartName',undefined,'/'+partName.replace('\\','/'));writer.writeAttributeString(undefined,'ContentType',undefined,contentType);writer.writeEndElement();};// Serializes the default content type
WordExport.prototype.serializeDefaultContentType=function(writer,extension,contentType){writer.writeStartElement(undefined,'Default',undefined);writer.writeAttributeString(undefined,'Extension',undefined,extension);writer.writeAttributeString(undefined,'ContentType',undefined,contentType);writer.writeEndElement();};// Reset the relationship id counter
WordExport.prototype.resetRelationShipID=function(){this.mRelationShipID=0;};WordExport.prototype.resetExcelRelationShipId=function(){this.eRelationShipId=0;};WordExport.prototype.resetChartRelationShipId=function(){this.cRelationShipId=0;};WordExport.prototype.close=function(){//Implement
};return WordExport;}();/* eslint-disable */ /**
 * Exports the document to Text format.
 */var TextExport=/** @class */function(){function TextExport(){/**
         * @private
         */this.pageContent='';this.curSectionIndex=0;this.inField=false;}TextExport.prototype.getModuleName=function(){return'TextExport';};/**
     * @private
     * @param {DocumentHelper} documentHelper - Document helper.
     * @param {string} fileName - Specified file name.
     * @return {void}
     */TextExport.prototype.save=function(documentHelper,fileName){this.serialize(documentHelper);var writer=new sf.fileutils.StreamWriter();this.writeInternal(writer);writer.save(fileName+'.txt');};/**
     * Save text document as Blob.
     *
     * @private
     * @param {DocumentHelper} documentHelper - Document helper.
     * @return {Promise<Blob>} - Returns promise object.
     */TextExport.prototype.saveAsBlob=function(documentHelper){this.serialize(documentHelper);var streamWriter=new sf.fileutils.StreamWriter();this.writeInternal(streamWriter);var blob=streamWriter.buffer;streamWriter.destroy();return new Promise(function(resolve,reject){resolve(blob);});};TextExport.prototype.serialize=function(documentHelper){var document=documentHelper.owner.sfdtExportModule.write();this.setDocument(document);};/**
     * @private
     * @param document
     */TextExport.prototype.setDocument=function(document){this.document=document;this.mSections=document.sections;};/**
     * @private
     * @param streamWriter - Stream writer instance.
     * @return {void}
     */TextExport.prototype.writeInternal=function(streamWriter){var section=undefined;var sectionCount=this.document.sections.length-1;var isLastSection=false;this.updateLastParagraph();for(var i=0;i<=sectionCount;i++){section=this.document.sections[i];isLastSection=i===sectionCount?true:false;this.writeBody(streamWriter,section.blocks);this.writeNewLine(streamWriter);this.writeSectionEnd(section,isLastSection);}for(var j=0;j<=sectionCount;j++){section=this.document.sections[j];this.writeHeadersFooters(streamWriter,section);}};/// <summary>
/// Writes the specified document content to the text file.
/// </summary>
TextExport.prototype.writeBody=function(streamWriter,body){var bodyItemsCount=body.length-1;var bodyItem=undefined;for(var i=0;i<=bodyItemsCount;i++){bodyItem=body[i];if(bodyItem.hasOwnProperty('inlines')){var isLastPara=bodyItem===this.lastPara?true:false;this.writeParagraph(streamWriter,bodyItem,isLastPara);}else{this.writeTable(streamWriter,bodyItem);}}};TextExport.prototype.writeParagraph=function(streamWriter,paragraph,isLastPara){for(var i=0;i<paragraph.inlines.length;i++){var item=paragraph.inlines[i];if(item.hasOwnProperty('fieldType')){this.inField=item.fieldType===0;}else if(item.hasOwnProperty('text')&&!this.inField){this.writeText(streamWriter,item.text);}}if(!isLastPara){this.writeNewLine(streamWriter);}};/// }
/// <summary>
/// Writes the specified table text content to the text file.
/// </summary>
TextExport.prototype.writeTable=function(streamWriter,table){for(var i=0;i<table.rows.length;i++){var row=table.rows[i];for(var j=0;j<row.cells.length;j++){var cell=row.cells[j];this.writeBody(streamWriter,cell.blocks);}}};/// <summary>
/// Writes the specified Header Footer text content to the text file.
/// </summary>
TextExport.prototype.writeHeadersFooters=function(streamWriter,section){var headersFooters=section.headersFooters;if(sf.base.isNullOrUndefined(headersFooters)){return;}this.writeHeaderFooter(streamWriter,section.headersFooters.header);this.writeHeaderFooter(streamWriter,section.headersFooters.footer);this.writeHeaderFooter(streamWriter,section.headersFooters.evenFooter);this.writeHeaderFooter(streamWriter,section.headersFooters.evenHeader);this.writeHeaderFooter(streamWriter,section.headersFooters.firstPageHeader);this.writeHeaderFooter(streamWriter,section.headersFooters.firstPageFooter);};TextExport.prototype.writeHeaderFooter=function(streamWriter,headerFooter){if(headerFooter&&headerFooter.blocks){this.writeBody(streamWriter,headerFooter.blocks);}};/// <summary>
/// Writes the end of the section.
/// </summary>
TextExport.prototype.writeSectionEnd=function(section,lastSection){this.curSectionIndex++;};TextExport.prototype.writeNewLine=function(writer){if(!sf.base.isNullOrUndefined(writer)){writer.writeLine('');}else{this.pageContent=this.pageContent+' ';}};TextExport.prototype.writeText=function(writer,text){if(!sf.base.isNullOrUndefined(writer)){writer.write(text);}else{this.pageContent+=text;}};TextExport.prototype.updateLastParagraph=function(){var cnt=this.document.sections.length;var sec;if(cnt>0){sec=this.document.sections[cnt-1];}if(!sf.base.isNullOrUndefined(sec)){var paragraphs=[];for(var i=0;i<sec.blocks.length;i++){if(sec.blocks[i].hasOwnProperty('inlines')){paragraphs.push(sec.blocks[i]);}}var pCount=paragraphs.length;if(pCount>0){this.lastPara=paragraphs[pCount-1];}}};/**
     * @private
     * @returns {void}
     */TextExport.prototype.destroy=function(){this.document=undefined;this.lastPara=undefined;this.mSections=undefined;this.sections=undefined;};return TextExport;}();/**
 * Exports the document to Sfdt format.
 */var SfdtExport=/** @class */function(){function SfdtExport(documentHelper){/* eslint-disable @typescript-eslint/no-explicit-any */this.startLine=undefined;this.endLine=undefined;this.endOffset=undefined;this.endCell=undefined;this.startColumnIndex=undefined;this.endColumnIndex=undefined;this.lists=undefined;this.document=undefined;this.writeInlineStyles=undefined;this.blockContent=false;this.startContent=false;this.multipleLineContent=false;this.nestedContent=false;this.editRangeId=-1;this.selectedCommentsId=[];this.selectedRevisionId=[];this.nestedBlockContent=false;this.nestedBlockEnabled=false;this.blocks=[];this.contentInline=[];this.isContentControl=false;this.isBlockClosed=true;/**
         * @private
         */this.isExport=true;/**
         * @private
         */this.isPartialExport=false;this.checkboxOrDropdown=false;/**
         * @private
         */this.copyWithTrackChange=false;this.documentHelper=documentHelper;}Object.defineProperty(SfdtExport.prototype,"viewer",{get:function get(){return this.documentHelper.owner.viewer;},enumerable:true,configurable:true});Object.defineProperty(SfdtExport.prototype,"owner",{get:function get(){return this.documentHelper.owner;},enumerable:true,configurable:true});SfdtExport.prototype.getModuleName=function(){return'SfdtExport';};SfdtExport.prototype.clear=function(){this.writeInlineStyles=undefined;this.startLine=undefined;this.endLine=undefined;this.lists=undefined;this.document=undefined;this.endCell=undefined;this.startColumnIndex=undefined;this.endColumnIndex=undefined;this.selectedCommentsId=[];this.selectedRevisionId=[];this.startBlock=undefined;this.endBlock=undefined;this.isPartialExport=false;};/**
     * Serialize the data as Syncfusion document text.
     *
     * @private
     */SfdtExport.prototype.serialize=function(){return JSON.stringify(this.write());};/**
     * @private
     * @param documentHelper - Specifies document helper instance.
     * @returns {Promise<Blob>}
     */SfdtExport.prototype.saveAsBlob=function(documentHelper){var streamWriter=new sf.fileutils.StreamWriter();streamWriter.write(this.serialize());var blob=streamWriter.buffer;streamWriter.destroy();return new Promise(function(resolve,reject){resolve(blob);});};SfdtExport.prototype.updateEditRangeId=function(){var index=-1;for(var i=0;i<this.documentHelper.editRanges.keys.length;i++){var keys=this.documentHelper.editRanges.keys;for(var j=0;j<keys[i].length;j++){var editRangeStart=this.documentHelper.editRanges.get(keys[i]);for(var z=0;z<editRangeStart.length;z++){index++;editRangeStart[z].editRangeId=index;editRangeStart[z].editRangeEnd.editRangeId=index;}}}};/**
     * @private
     */ /* eslint-disable  */SfdtExport.prototype.write=function(line,startOffset,endLine,endOffset,writeInlineStyles,isExport){if(writeInlineStyles){this.writeInlineStyles=true;}this.Initialize();this.updateEditRangeId();if(line instanceof LineWidget&&endLine instanceof LineWidget){this.isExport=false;if(!sf.base.isNullOrUndefined(isExport)){this.isExport=isExport;}// For selection
var startPara=line.paragraph;var endPara=endLine.paragraph;if(this.isPartialExport){this.startBlock=this.getParentBlock(startPara);this.endBlock=this.getParentBlock(endPara);}var startCell=startPara.associatedCell;var endCell=endPara.associatedCell;// Creates section
var bodyWidget=startPara.bodyWidget;var section=this.createSection(line.paragraph.bodyWidget);this.document.sections.push(section);if(startCell===endCell||sf.base.isNullOrUndefined(endCell)){this.startLine=line;this.endLine=endLine;this.endOffset=endOffset;}else{// Todo: Handle nested table cases
if(startCell instanceof TableCellWidget){var startTable=startCell.getContainerTable();var endTable=endCell.getContainerTable();if(startTable.tableFormat===endTable.tableFormat){this.endCell=endCell;if(this.endCell.ownerTable!==startCell.ownerTable&&startCell.ownerTable.associatedCell&&startCell.ownerTable.associatedCell.ownerTable===this.endCell.ownerTable&&startCell.ownerTable.associatedCell.childWidgets.indexOf(startCell.ownerTable)===0){startCell=startCell.ownerTable.associatedCell;}this.endColumnIndex=this.endCell.columnIndex+this.endCell.cellFormat.columnSpan;this.startColumnIndex=startCell.columnIndex;}}else{this.endCell=endCell;}}var nextBlock=void 0;if(startCell===endCell&&!this.isPartialExport||sf.base.isNullOrUndefined(startCell)){var paragraph=this.createParagraph(line.paragraph);section.blocks.push(paragraph);var lastBlock=line.paragraph;nextBlock=this.writeParagraph(line.paragraph,paragraph,section.blocks,line.indexInOwner,startOffset);if(this.isPartialExport){nextBlock=this.getNextBlock(nextBlock,lastBlock);section=this.document.sections[this.document.sections.length-1];}while(nextBlock){lastBlock=nextBlock;nextBlock=this.writeBlock(nextBlock,0,section.blocks);if(this.isPartialExport&&sf.base.isNullOrUndefined(nextBlock)){nextBlock=this.getNextBlock(nextBlock,lastBlock);section=this.document.sections[this.document.sections.length-1];}}// Todo:continue in next section
}else{// Specially handled for nested table cases
// selection start inside table and end in paragraph outside table
if(sf.base.isNullOrUndefined(endCell)&&startCell.ownerTable.associatedCell){var startTable=startCell.getContainerTable();var lastRow=startTable.childWidgets[startTable.childWidgets.length-1];var endCell_1=lastRow.childWidgets[lastRow.childWidgets.length-1];if(endCell_1.ownerTable!==startCell.ownerTable&&startCell.ownerTable.associatedCell&&startCell.ownerTable.associatedCell.childWidgets.indexOf(startCell.ownerTable)===0){while(startCell.ownerTable!==endCell_1.ownerTable){startCell=startCell.ownerTable.associatedCell;}}this.endColumnIndex=endCell_1.columnIndex+endCell_1.cellFormat.columnSpan;this.startColumnIndex=startCell.columnIndex;}var table=this.createTable(startCell.ownerTable);section.blocks.push(table);var lastBlock=startCell.ownerTable;nextBlock=this.writeTable(startCell.ownerTable,table,startCell.ownerRow.indexInOwner,section.blocks);if(this.isPartialExport){nextBlock=this.getNextBlock(nextBlock,lastBlock);section=this.document.sections[this.document.sections.length-1];}while(nextBlock){lastBlock=nextBlock;nextBlock=this.writeBlock(nextBlock,0,section.blocks);if(this.isPartialExport){nextBlock=this.getNextBlock(nextBlock,lastBlock);section=this.document.sections[this.document.sections.length-1];}}}}else{this.isExport=true;if(this.documentHelper.pages.length>0){var page=this.documentHelper.pages[0];this.writePage(page);}}this.writeStyles(this.documentHelper);this.writeLists(this.documentHelper);this.writeComments(this.documentHelper);this.writeRevisions(this.documentHelper);this.writeCustomXml(this.documentHelper);this.footnotes(this.documentHelper);this.endnotes(this.documentHelper);var doc=this.document;this.clear();return doc;};SfdtExport.prototype.getNextBlock=function(nextBlock,lastBlock){if(sf.base.isNullOrUndefined(nextBlock)&&this.isPartialExport&&this.endBlock&&!this.endBlock.equals(lastBlock)){nextBlock=lastBlock.getSplitWidgets().pop().nextRenderedWidget;if(nextBlock&&lastBlock.bodyWidget.index!==nextBlock.bodyWidget.index){var section=this.createSection(nextBlock.bodyWidget);this.document.sections.push(section);}else{nextBlock=undefined;}}return nextBlock;};/**
     * @private
     */SfdtExport.prototype.Initialize=function(){this.lists=[];this.document={};this.document.sections=[];this.document.characterFormat=this.writeCharacterFormat(this.documentHelper.characterFormat);this.document.paragraphFormat=this.writeParagraphFormat(this.documentHelper.paragraphFormat);this.document.defaultTabWidth=this.documentHelper.defaultTabWidth;this.document.trackChanges=this.owner.enableTrackChanges;this.document.enforcement=this.documentHelper.isDocumentProtected;this.document.hashValue=this.documentHelper.hashValue;this.document.saltValue=this.documentHelper.saltValue;this.document.formatting=this.documentHelper.restrictFormatting;this.document.protectionType=this.documentHelper.protectionType;this.document.dontUseHTMLParagraphAutoSpacing=this.documentHelper.dontUseHtmlParagraphAutoSpacing;this.document.formFieldShading=this.documentHelper.owner.documentEditorSettings.formFieldSettings.applyShading;this.document.compatibilityMode=this.documentHelper.compatibilityMode;};/**
     * @private
     */SfdtExport.prototype.writePage=function(page){if(page.bodyWidgets.length>0){var nextBlock=page.bodyWidgets[0];do{nextBlock=this.writeBodyWidget(nextBlock,0);}while(!sf.base.isNullOrUndefined(nextBlock));}return this.document;};SfdtExport.prototype.writeBodyWidget=function(bodyWidget,index){if(!(bodyWidget instanceof BodyWidget)){return undefined;}var section=this.createSection(bodyWidget);this.document.sections.push(section);this.writeHeaderFooters(this.documentHelper.headersFooters[bodyWidget.index],section);var firstBlock=bodyWidget.childWidgets[index];do{firstBlock=this.writeBlock(firstBlock,0,section.blocks);}while(firstBlock);var next=bodyWidget;do{bodyWidget=next;next=next.nextRenderedWidget;if(sf.base.isNullOrUndefined(next)&&!sf.base.isNullOrUndefined(bodyWidget.page.nextPage)&&!sf.base.isNullOrUndefined(bodyWidget.page.nextPage)){next=bodyWidget.page.nextPage.bodyWidgets[0];}}while(next instanceof BodyWidget&&next.index===bodyWidget.index);return next;};SfdtExport.prototype.writeHeaderFooters=function(hfs,section){if(sf.base.isNullOrUndefined(hfs)){return;}section.headersFooters.header=this.writeHeaderFooter(hfs[0]);section.headersFooters.footer=this.writeHeaderFooter(hfs[1]);section.headersFooters.evenHeader=this.writeHeaderFooter(hfs[2]);section.headersFooters.evenFooter=this.writeHeaderFooter(hfs[3]);section.headersFooters.firstPageHeader=this.writeHeaderFooter(hfs[4]);section.headersFooters.firstPageFooter=this.writeHeaderFooter(hfs[5]);};SfdtExport.prototype.writeHeaderFooter=function(widget){if(sf.base.isNullOrUndefined(widget)||widget.isEmpty){return undefined;}var headerFooter={};if(widget&&widget.childWidgets&&widget.childWidgets.length>0){headerFooter.blocks=[];var firstBlock=widget.firstChild;do{firstBlock=this.writeBlock(firstBlock,0,headerFooter.blocks);}while(firstBlock);}return headerFooter;};SfdtExport.prototype.createSection=function(bodyWidget){var section={};section.sectionFormat={};section.sectionFormat.pageWidth=bodyWidget.sectionFormat.pageWidth;section.sectionFormat.pageHeight=bodyWidget.sectionFormat.pageHeight;section.sectionFormat.leftMargin=bodyWidget.sectionFormat.leftMargin;section.sectionFormat.rightMargin=bodyWidget.sectionFormat.rightMargin;section.sectionFormat.topMargin=bodyWidget.sectionFormat.topMargin;section.sectionFormat.bottomMargin=bodyWidget.sectionFormat.bottomMargin;section.sectionFormat.differentFirstPage=bodyWidget.sectionFormat.differentFirstPage;section.sectionFormat.differentOddAndEvenPages=bodyWidget.sectionFormat.differentOddAndEvenPages;section.sectionFormat.headerDistance=bodyWidget.sectionFormat.headerDistance;section.sectionFormat.footerDistance=bodyWidget.sectionFormat.footerDistance;section.sectionFormat.bidi=bodyWidget.sectionFormat.bidi;if(bodyWidget.sectionFormat.restartPageNumbering){section.sectionFormat.restartPageNumbering=bodyWidget.sectionFormat.restartPageNumbering;section.sectionFormat.pageStartingNumber=bodyWidget.sectionFormat.pageStartingNumber;}if(!sf.base.isNullOrUndefined(bodyWidget.page.endnoteWidget||bodyWidget.page.footnoteWidget)){section.sectionFormat.endnoteNumberFormat=bodyWidget.sectionFormat.endnoteNumberFormat;section.sectionFormat.footNoteNumberFormat=bodyWidget.sectionFormat.footNoteNumberFormat;section.sectionFormat.restartIndexForFootnotes=bodyWidget.sectionFormat.restartIndexForFootnotes;section.sectionFormat.restartIndexForEndnotes=bodyWidget.sectionFormat.restartIndexForEndnotes;section.sectionFormat.initialFootNoteNumber=bodyWidget.sectionFormat.initialFootNoteNumber;section.sectionFormat.initialEndNoteNumber=bodyWidget.sectionFormat.initialEndNoteNumber;}section.blocks=[];section.headersFooters={};return section;};SfdtExport.prototype.writeBlock=function(widget,index,blocks){if(!(widget instanceof BlockWidget)){return undefined;}if(widget instanceof ParagraphWidget){if(widget.hasOwnProperty('contentControlProperties')&&widget.contentControlProperties.type!=='BuildingBlockGallery'){var block=this.blockContentControl(widget);if(!sf.base.isNullOrUndefined(block)&&this.isBlockClosed){blocks.push(block);this.blocks=[];}return this.nextBlock;}else{var paragraph=this.createParagraph(widget);blocks.push(paragraph);return this.writeParagraph(widget,paragraph,blocks);}}else{var tableWidget=widget;if(tableWidget.hasOwnProperty('contentControlProperties')&&tableWidget.contentControlProperties.type!=='BuildingBlockGallery'){var block=this.tableContentControl(tableWidget);if(this.isBlockClosed){blocks.push(block);}return this.nextBlock;}var table=this.createTable(tableWidget);blocks.push(table);return this.writeTable(tableWidget,table,0,blocks);}};SfdtExport.prototype.writeParagraphs=function(widget){var blocks=this.blocks;var child=widget.childWidgets[0];var firstElement=child.children[0];var secondElement=child.children[1];if(firstElement instanceof ListTextElementBox||secondElement instanceof ListTextElementBox){firstElement=child.children[2];secondElement=child.children[3];}if(this.nestedBlockEnabled){blocks=[];}if(firstElement instanceof ContentControl&&secondElement instanceof ContentControl&&!this.nestedBlockContent||this.blockContent&&firstElement instanceof ContentControl&&!this.nestedBlockContent){var nestedBlocks=false;if(secondElement instanceof ContentControl){if(secondElement.contentControlWidgetType==='Block'){nestedBlocks=true;}}if(nestedBlocks||this.blockContent&&firstElement instanceof ContentControl&&!this.nestedBlockContent&&firstElement.type===0&&firstElement.contentControlWidgetType==='Block'){this.nestedBlockContent=true;this.nestedBlockEnabled=true;var block=this.blockContentControl(widget);if(!sf.base.isNullOrUndefined(block)){this.blocks.push(block);}}else{var paragraph=this.createParagraph(widget);blocks.push(paragraph);this.nextBlock=this.writeParagraph(widget,paragraph,blocks);}}else{var paragraph=this.createParagraph(widget);blocks.push(paragraph);this.nextBlock=this.writeParagraph(widget,paragraph,blocks);}if(!this.blockContent){return blocks;}else if(!this.nestedBlockContent&&this.nestedBlockEnabled){this.nestedBlockEnabled=false;return blocks;}};SfdtExport.prototype.contentControlProperty=function(contentControlPropertie){var contentControlProperties={};contentControlProperties.lockContentControl=contentControlPropertie.lockContentControl;contentControlProperties.lockContents=contentControlPropertie.lockContents;contentControlProperties.tag=contentControlPropertie.tag;contentControlProperties.color=contentControlPropertie.color;contentControlProperties.title=contentControlPropertie.title;if(!sf.base.isNullOrUndefined(contentControlPropertie.appearance)){contentControlProperties.appearance=contentControlPropertie.appearance;}contentControlProperties.type=contentControlPropertie.type;contentControlProperties.hasPlaceHolderText=contentControlPropertie.hasPlaceHolderText;contentControlProperties.multiline=contentControlPropertie.multiline;contentControlProperties.isTemporary=contentControlPropertie.isTemporary;if(!sf.base.isNullOrUndefined(contentControlPropertie.isChecked)){contentControlProperties.isChecked=contentControlPropertie.isChecked;}if(!sf.base.isNullOrUndefined(contentControlPropertie.uncheckedState)){contentControlProperties.uncheckedState=this.tounCheckedState(contentControlPropertie.uncheckedState);}if(!sf.base.isNullOrUndefined(contentControlPropertie.checkedState)){contentControlProperties.checkedState=this.toCheckedState(contentControlPropertie.checkedState);}if(!sf.base.isNullOrUndefined(contentControlPropertie.dateCalendarType)){contentControlProperties.dateCalendarType=contentControlPropertie.dateCalendarType;}if(!sf.base.isNullOrUndefined(contentControlPropertie.dateStorageFormat)){contentControlProperties.dateStorageFormat=contentControlPropertie.dateStorageFormat;}if(!sf.base.isNullOrUndefined(contentControlPropertie.dateDisplayLocale)){contentControlProperties.dateDisplayLocale=contentControlPropertie.dateDisplayLocale;}if(!sf.base.isNullOrUndefined(contentControlPropertie.dateDisplayFormat)){contentControlProperties.dateDisplayFormat=contentControlPropertie.dateDisplayFormat;}if(!sf.base.isNullOrUndefined(contentControlPropertie.xmlMapping)){contentControlProperties.xmlMapping=contentControlPropertie.xmlMapping;}if(!sf.base.isNullOrUndefined(contentControlPropertie.characterFormat)){contentControlProperties.characterFormat=this.writeCharacterFormat(contentControlPropertie.characterFormat);}contentControlProperties.contentControlListItems=contentControlPropertie.contentControlListItems;return contentControlProperties;};SfdtExport.prototype.tounCheckedState=function(state){var unCheckedState={};unCheckedState.font=state.font;unCheckedState.value=state.value;return unCheckedState;};SfdtExport.prototype.toCheckedState=function(state){var checkedState={};checkedState.font=state.font;checkedState.value=state.value;return checkedState;};SfdtExport.prototype.blockContentControl=function(widget){var block={};if(widget.childWidgets.length===0){this.nextBlock=widget.nextWidget;return undefined;}block.blocks=this.writeParagraphs(widget);if(!sf.base.isNullOrUndefined(block.blocks)){var child=widget.childWidgets[0];var firstChild=child.children[0];var secondChild=child.children[1];if(firstChild instanceof ListTextElementBox||secondChild instanceof ListTextElementBox){firstChild=child.children[2];secondChild=child.children[3];}if(firstChild instanceof ContentControl&&secondChild instanceof ContentControl&&!this.nestedBlockContent||this.blockContent&&firstChild instanceof ContentControl&&!this.nestedBlockContent){if(!(secondChild instanceof ContentControl)){block.contentControlProperties=this.contentControlProperty(firstChild.contentControlProperties);return block;}else if(secondChild.contentControlWidgetType==='Block'){block.contentControlProperties=this.contentControlProperty(secondChild.contentControlProperties);}else{block.contentControlProperties=this.contentControlProperty(widget.contentControlProperties);}}else{block.contentControlProperties=this.contentControlProperty(widget.contentControlProperties);}return block;}};SfdtExport.prototype.tableContentControl=function(tableWidget){var block={};block.blocks=this.tableContentControls(tableWidget);if(!sf.base.isNullOrUndefined(this.nextBlock)){if(tableWidget.contentControlProperties===this.nextBlock.contentControlProperties){return this.blocks=block.blocks;}}block.contentControlProperties=this.contentControlProperty(tableWidget.contentControlProperties);return block;};SfdtExport.prototype.tableContentControls=function(tableWidget){var blocks=[];if(!this.isBlockClosed){blocks=this.blocks;}var table=this.createTable(tableWidget);blocks.push(table);this.nextBlock=this.writeTable(tableWidget,table,0,blocks);return blocks;};SfdtExport.prototype.writeParagraph=function(paragraphWidget,paragraph,blocks,lineIndex,start){if(sf.base.isNullOrUndefined(lineIndex)){lineIndex=0;}if(sf.base.isNullOrUndefined(start)){start=0;}var next=paragraphWidget;while(next instanceof ParagraphWidget){if(this.writeLines(next,lineIndex,start,paragraph.inlines)){return undefined;}lineIndex=0;start=0;paragraphWidget=next;next=paragraphWidget.nextSplitWidget;}next=paragraphWidget.nextRenderedWidget;if(sf.base.isNullOrUndefined(next)&&paragraphWidget.containerWidget instanceof BodyWidget&&!sf.base.isNullOrUndefined(paragraphWidget.containerWidget.page.nextPage)&&!sf.base.isNullOrUndefined(paragraphWidget.containerWidget.page.nextPage.bodyWidgets)){next=paragraphWidget.containerWidget.page.nextPage.bodyWidgets[0].childWidgets[0];}return next instanceof BlockWidget&&paragraphWidget.containerWidget.index===next.containerWidget.index?next:undefined;};SfdtExport.prototype.writeInlines=function(paragraph,line,inlines){this.contentInline=[];var lineWidget=line.clone();var isformField=false;var bidi=paragraph.paragraphFormat.bidi;if(bidi||this.documentHelper.layout.isContainsRtl(lineWidget)){this.documentHelper.layout.reArrangeElementsForRtl(lineWidget,bidi);}for(var i=0;i<lineWidget.children.length;i++){var element=lineWidget.children[i];if(this.isExport&&this.checkboxOrDropdown){if(isformField&&element instanceof TextElementBox){continue;}if(element instanceof FieldElementBox&&element.fieldType===2){isformField=true;}}if(element instanceof ListTextElementBox){continue;}if(element instanceof FootnoteElementBox){inlines.push(this.writeInlinesFootNote(paragraph,element,line,inlines));continue;}if(element instanceof ContentControl&&!sf.base.isNullOrUndefined(element.contentControlProperties)&&element.contentControlProperties.type!=='BuildingBlockGallery'||this.startContent||this.blockContent){if(inlines.length>0){this.writeInlinesContentControl(element,line,inlines,i);}continue;}else{var inline=this.writeInline(element);if(!sf.base.isNullOrUndefined(inline)){inlines.push(inline);}}if(this.isExport&&element instanceof FieldElementBox&&element.fieldType===1){isformField=false;this.checkboxOrDropdown=false;}}};SfdtExport.prototype.inlineContentControl=function(element,nextElement,inlines){var inline={};var nestedContentInline=[];if(!sf.base.isNullOrUndefined(inlines)){if(this.nestedContent){inlines=inlines[inlines.length-1].inlines;inline=this.inlineContentControls(element,inlines[inlines.length-1].inlines);var nestedContentinline=this.nestedContentProperty(nextElement,inlines[inlines.length-1]);if(!sf.base.isNullOrUndefined(nestedContentinline)){this.contentInline.push(inline);nestedContentInline=[];}}else{this.inlineContentControls(element,inlines[inlines.length-1].inlines);}}else{if(this.nestedContent){inline.inlines=this.inlineContentControls(element,undefined,nestedContentInline);var nestedContentinline=this.nestedContentProperty(nextElement,inline);if(!sf.base.isNullOrUndefined(nestedContentinline)||this.multipleLineContent){this.contentInline.push(inline);nestedContentInline=[];}}else{inline.inlines=this.inlineContentControls(element,this.contentInline);}}if(!sf.base.isNullOrUndefined(nextElement)){if(nextElement.type===1&&!this.nestedContent){if(this.multipleLineContent){inlines[inlines.length-1].contentControlProperties=this.contentControlProperty(nextElement.contentControlProperties);this.multipleLineContent=false;return;}else{inline.contentControlProperties=this.contentControlProperty(nextElement.contentControlProperties);}return inline;}}else if(this.startContent){this.multipleLineContent=true;return inline;}};SfdtExport.prototype.nestedContentProperty=function(nextElement,inline,inlines){if(!sf.base.isNullOrUndefined(nextElement)){if(nextElement.type===1){inline.contentControlProperties=this.contentControlProperty(nextElement.contentControlProperties);return inline;}else if(this.startContent){this.multipleLineContent=true;return inline;}}else if(this.startContent){this.multipleLineContent=true;return inline;}};SfdtExport.prototype.inlineContentControls=function(element,contentInline,nestedContentInline){var inline=this.writeInline(element);if(!sf.base.isNullOrUndefined(nestedContentInline)){nestedContentInline.push(inline);return nestedContentInline;}contentInline.push(inline);return contentInline;};/* eslint-disable  */SfdtExport.prototype.writeInline=function(element){var inline={};if(element.removedIds.length>0){for(var i=0;i<element.removedIds.length;i++){element.revisions[i]=this.documentHelper.revisionsInternal.get(element.removedIds[i]);}}inline.characterFormat=this.writeCharacterFormat(element.characterFormat);if(element instanceof FieldElementBox){inline.fieldType=element.fieldType;if(element.fieldType===0){inline.hasFieldEnd=true;if(element.formFieldData){inline.formFieldData={};inline.formFieldData.name=element.formFieldData.name;inline.formFieldData.enabled=element.formFieldData.enabled;inline.formFieldData.helpText=element.formFieldData.helpText;inline.formFieldData.statusText=element.formFieldData.statusText;if(element.formFieldData instanceof TextFormField){inline.formFieldData.textInput={};inline.formFieldData.textInput.type=element.formFieldData.type;inline.formFieldData.textInput.maxLength=element.formFieldData.maxLength;inline.formFieldData.textInput.defaultValue=element.formFieldData.defaultValue;inline.formFieldData.textInput.format=element.formFieldData.format;}else if(element.formFieldData instanceof CheckBoxFormField){inline.formFieldData.checkBox={};this.checkboxOrDropdown=true;inline.formFieldData.checkBox.sizeType=element.formFieldData.sizeType;inline.formFieldData.checkBox.size=element.formFieldData.size;inline.formFieldData.checkBox.defaultValue=element.formFieldData.defaultValue;inline.formFieldData.checkBox.checked=element.formFieldData.checked;}else{inline.formFieldData.dropDownList={};this.checkboxOrDropdown=true;inline.formFieldData.dropDownList.dropDownItems=element.formFieldData.dropdownItems;inline.formFieldData.dropDownList.selectedIndex=element.formFieldData.selectedIndex;}}}if(element.fieldCodeType&&element.fieldCodeType!==''){inline.fieldCodeType=element.fieldCodeType;}}else if(element instanceof ChartElementBox){this.writeChart(element,inline);}else if(element instanceof ImageElementBox){inline.imageString=element.imageString;inline.metaFileImageString=element.metaFileImageString;inline.isMetaFile=element.isMetaFile;inline.isCompressed=element.isCompressed;inline.width=HelperMethods.convertPixelToPoint(element.width);inline.height=HelperMethods.convertPixelToPoint(element.height);inline.iscrop=element.isCrop;if(element.isCrop){inline.bottom=element.bottom;inline.right=element.right;inline.left=element.left;inline.top=element.top;inline.getimagewidth=element.cropWidthScale;inline.getimageheight=element.cropHeightScale;}inline.name=element.name;inline.alternativeText=element.alternativeText;inline.title=element.title;inline.visible=element.visible;inline.widthScale=element.widthScale;inline.heightScale=element.heightScale;inline.verticalPosition=HelperMethods.convertPixelToPoint(element.verticalPosition);inline.verticalOrigin=element.verticalOrigin;inline.verticalAlignment=element.verticalAlignment;inline.horizontalPosition=HelperMethods.convertPixelToPoint(element.horizontalPosition);inline.horizontalOrigin=element.horizontalOrigin;inline.horizontalAlignment=element.horizontalAlignment;inline.allowOverlap=element.allowOverlap;inline.textWrappingStyle=element.textWrappingStyle;inline.textWrappingType=element.textWrappingType;inline.layoutInCell=element.layoutInCell;inline.zOrderPosition=element.zOrderPosition;}else if(element instanceof BookmarkElementBox){inline.bookmarkType=element.bookmarkType;inline.name=element.name;}else if(element instanceof TextElementBox){// replacing the no break hyphen character by '-'
if(element.text.indexOf("\x1E")!==-1){inline.text=element.text.replace(/\u001e/g,'-');}else if(element.text.indexOf("\x1F")!==-1){inline.text=element.text.replace(/\u001f/g,'');}else if(element.revisions.length!==0){if(!this.isExport&&this.owner.enableTrackChanges&&!this.isPartialExport){this.copyWithTrackChange=true;for(var x=0;x<element.revisions.length;x++){var revision=element.revisions[x];if(this.selectedRevisionId.indexOf(revision.revisionID)===-1){this.selectedRevisionId.push(revision.revisionID);}if(element.revisions[x].revisionType==='Deletion'){element.revisions.pop();}else if(element.revisions[x].revisionType==='Insertion'){element.revisions.pop();inline.text=element.text;}else{inline.text=element.text;}}}else{inline.text=element.text;}}else{inline.text=element.text;}}else if(element instanceof EditRangeStartElementBox){inline.user=element.user;inline.group=element.group;inline.columnFirst=element.columnFirst;inline.columnLast=element.columnLast;inline.editRangeId=element.editRangeId.toString();}else if(element instanceof EditRangeEndElementBox){inline.editableRangeStart={'user':element.editRangeStart.user,'group':element.editRangeStart.group,'columnFirst':element.editRangeStart.columnFirst,'columnLast':element.editRangeStart.columnLast};inline.editRangeId=element.editRangeId.toString();}else if(element instanceof CommentCharacterElementBox){if(!this.isExport&&element.commentType===0){this.selectedCommentsId.push(element.commentId);}inline.commentCharacterType=element.commentType;inline.commentId=element.commentId;}else if(element instanceof ShapeElementBox){this.writeShape(element,inline);}else{inline=undefined;}if(element.revisions.length>0){inline.revisionIds=[];for(var x=0;x<element.revisions.length;x++){//revisionIdes[x] = element.revisions[x];
if(this.selectedRevisionId.indexOf(element.revisions[x].revisionID)===-1){this.selectedRevisionId.push(element.revisions[x].revisionID);}inline.revisionIds.push(element.revisions[x].revisionID);//this.document.revisionIdes.push(inline.revisionIds)
}}/*if(element.removedIds.length > 0){
            inline.revisionIds = [];
            for(let x:number = 0;x < element.removedIds.length; x++){
            inline.revisionIds.push(element.removedIds);
            }
        }*/return inline;};SfdtExport.prototype.writeShape=function(element,inline){inline.shapeId=element.shapeId;inline.name=element.name;inline.alternativeText=element.alternativeText;inline.title=element.title;inline.visible=element.visible;inline.width=HelperMethods.convertPixelToPoint(element.width);inline.height=HelperMethods.convertPixelToPoint(element.height);inline.widthScale=element.widthScale;inline.heightScale=element.heightScale;inline.verticalPosition=HelperMethods.convertPixelToPoint(element.verticalPosition);inline.verticalOrigin=element.verticalOrigin;inline.verticalAlignment=element.verticalAlignment;inline.verticalRelativePercent=element.verticalRelativePercent;inline.horizontalPosition=HelperMethods.convertPixelToPoint(element.horizontalPosition);inline.horizontalOrigin=element.horizontalOrigin;inline.horizontalAlignment=element.horizontalAlignment;inline.horizontalRelativePercent=element.horizontalRelativePercent;inline.zOrderPosition=element.zOrderPosition;inline.allowOverlap=element.allowOverlap;inline.textWrappingStyle=element.textWrappingStyle;inline.textWrappingType=element.textWrappingType;inline.distanceBottom=HelperMethods.convertPixelToPoint(element.distanceBottom);inline.distanceLeft=HelperMethods.convertPixelToPoint(element.distanceLeft);inline.distanceRight=HelperMethods.convertPixelToPoint(element.distanceRight);inline.distanceTop=HelperMethods.convertPixelToPoint(element.distanceTop);inline.layoutInCell=element.layoutInCell;inline.lockAnchor=element.lockAnchor;inline.autoShapeType=element.autoShapeType;if(element.fillFormat){inline.fillFormat={};inline.fillFormat.color=element.fillFormat.color;inline.fillFormat.fill=element.fillFormat.fill;}if(element.lineFormat){inline.lineFormat={};inline.lineFormat.lineFormatType=element.lineFormat.lineFormatType;inline.lineFormat.color=element.lineFormat.color;inline.lineFormat.weight=element.lineFormat.weight;inline.lineFormat.lineStyle=element.lineFormat.dashStyle;inline.lineFormat.line=element.lineFormat.line;}if(element.textFrame){inline.textFrame={};inline.textFrame.textVerticalAlignment=element.textFrame.textVerticalAlignment;inline.textFrame.leftMargin=HelperMethods.convertPixelToPoint(element.textFrame.marginLeft);inline.textFrame.rightMargin=HelperMethods.convertPixelToPoint(element.textFrame.marginRight);inline.textFrame.topMargin=HelperMethods.convertPixelToPoint(element.textFrame.marginTop);inline.textFrame.bottomMargin=HelperMethods.convertPixelToPoint(element.textFrame.marginBottom);inline.textFrame.blocks=[];for(var j=0;j<element.textFrame.childWidgets.length;j++){var textFrameBlock=element.textFrame.childWidgets[j];this.writeBlock(textFrameBlock,0,inline.textFrame.blocks);}}};SfdtExport.prototype.writeChart=function(element,inline){inline.chartLegend={};inline.chartTitleArea={};inline.chartArea={};inline.plotArea={};inline.chartCategory=[];inline.chartSeries=[];inline.chartPrimaryCategoryAxis={};inline.chartPrimaryValueAxis={};this.writeChartTitleArea(element.chartTitleArea,inline.chartTitleArea);this.writeChartArea(element.chartArea,inline.chartArea);this.writeChartArea(element.chartPlotArea,inline.plotArea);this.writeChartCategory(element,inline.chartCategory);this.createChartSeries(element,inline.chartSeries);this.writeChartLegend(element.chartLegend,inline.chartLegend);this.writeChartCategoryAxis(element.chartPrimaryCategoryAxis,inline.chartPrimaryCategoryAxis);this.writeChartCategoryAxis(element.chartPrimaryValueAxis,inline.chartPrimaryValueAxis);if(element.chartDataTable.showSeriesKeys!==undefined){inline.chartDataTable={};this.writeChartDataTable(element.chartDataTable,inline.chartDataTable);}inline.chartTitle=element.title;inline.chartType=element.type;inline.gapWidth=element.chartGapWidth;inline.overlap=element.chartOverlap;inline.height=HelperMethods.convertPixelToPoint(element.height);inline.width=HelperMethods.convertPixelToPoint(element.width);};SfdtExport.prototype.writeChartTitleArea=function(titleArea,chartTitleArea){chartTitleArea.fontName=titleArea.chartfontName;chartTitleArea.fontSize=titleArea.chartFontSize;chartTitleArea.layout={};chartTitleArea.dataFormat=this.writeChartDataFormat(titleArea.dataFormat);this.writeChartLayout(titleArea.layout,chartTitleArea.layout);};SfdtExport.prototype.writeChartDataFormat=function(format){var chartDataFormat={};chartDataFormat.fill={};chartDataFormat.line={};chartDataFormat.fill.foreColor=format.fill.color;chartDataFormat.fill.rgb=format.fill.rgb;chartDataFormat.line.color=format.line.color;chartDataFormat.line.rgb=format.line.rgb;return chartDataFormat;};SfdtExport.prototype.writeChartLayout=function(layout,chartLayout){chartLayout.layoutX=layout.chartLayoutLeft;chartLayout.layoutY=layout.chartLayoutTop;};SfdtExport.prototype.writeChartArea=function(area,chartArea){chartArea.foreColor=area.chartForeColor;};SfdtExport.prototype.writeChartLegend=function(legend,chartLegend){chartLegend.position=legend.chartLegendPostion;chartLegend.chartTitleArea={};this.writeChartTitleArea(legend.chartTitleArea,chartLegend.chartTitleArea);};SfdtExport.prototype.writeChartCategoryAxis=function(categoryAxis,primaryCategoryAxis){primaryCategoryAxis.chartTitle=categoryAxis.categoryAxisTitle;primaryCategoryAxis.chartTitleArea={};this.writeChartTitleArea(categoryAxis.chartTitleArea,primaryCategoryAxis.chartTitleArea);primaryCategoryAxis.categoryType=categoryAxis.categoryAxisType;primaryCategoryAxis.fontSize=categoryAxis.axisFontSize;primaryCategoryAxis.fontName=categoryAxis.axisFontName;primaryCategoryAxis.numberFormat=categoryAxis.categoryNumberFormat;primaryCategoryAxis.maximumValue=categoryAxis.max;primaryCategoryAxis.minimumValue=categoryAxis.min;primaryCategoryAxis.majorUnit=categoryAxis.interval;primaryCategoryAxis.hasMajorGridLines=categoryAxis.majorGridLines;primaryCategoryAxis.hasMinorGridLines=categoryAxis.minorGridLines;primaryCategoryAxis.majorTickMark=categoryAxis.majorTick;primaryCategoryAxis.minorTickMark=categoryAxis.minorTick;primaryCategoryAxis.tickLabelPosition=categoryAxis.tickPosition;};SfdtExport.prototype.writeChartDataTable=function(chartDataTable,dataTable){dataTable.showSeriesKeys=chartDataTable.showSeriesKeys;dataTable.hasHorzBorder=chartDataTable.hasHorzBorder;dataTable.hasVertBorder=chartDataTable.hasVertBorder;dataTable.hasBorders=chartDataTable.hasBorders;};SfdtExport.prototype.writeChartCategory=function(element,chartCategory){var data=element.chartCategory;chartCategory.chartData=[];for(var i=0;i<data.length;i++){var xData=data[i];var categories=this.createChartCategory(xData,element.chartType);chartCategory.push(categories);}};SfdtExport.prototype.createChartCategory=function(data,type){var chartCategory={};chartCategory.chartData=[];this.writeChartData(data,chartCategory.chartData,type);chartCategory.categoryXName=data.categoryXName;return chartCategory;};SfdtExport.prototype.writeChartData=function(element,chartData,type){var data=element.chartData;for(var i=0;i<data.length;i++){var yData=data[i];var yCategory=this.createChartData(yData,type);chartData.push(yCategory);}};SfdtExport.prototype.createChartData=function(data,type){var chartData={};chartData.yValue=data.yValue;if(type==='Bubble'){chartData.size=data.size;}return chartData;};SfdtExport.prototype.createChartSeries=function(element,chartSeries){var data=element.chartSeries;var type=element.chartType;for(var i=0;i<data.length;i++){var yData=data[i];var series=this.writeChartSeries(yData,type);chartSeries.push(series);}};SfdtExport.prototype.writeChartSeries=function(series,type){var isPieType=type==='Pie'||type==='Doughnut';var chartSeries={};var errorBar={};var errorBarData=series.errorBar;chartSeries.dataPoints=[];chartSeries.seriesName=series.seriesName;if(isPieType){if(!sf.base.isNullOrUndefined(series.firstSliceAngle)){chartSeries.firstSliceAngle=series.firstSliceAngle;}if(type==='Doughnut'){chartSeries.holeSize=series.doughnutHoleSize;}}if(!sf.base.isNullOrUndefined(series.dataLabels.labelPosition)){var dataLabel=this.writeChartDataLabels(series.dataLabels);chartSeries.dataLabel=dataLabel;}if(!sf.base.isNullOrUndefined(series.seriesFormat.markerStyle)){var seriesFormat={};var format=series.seriesFormat;seriesFormat.markerStyle=format.markerStyle;seriesFormat.markerSize=format.numberValue;seriesFormat.markerColor=format.markerColor;chartSeries.seriesFormat=seriesFormat;}if(!sf.base.isNullOrUndefined(errorBarData.type)){errorBar.type=errorBarData.type;errorBar.direction=errorBarData.direction;errorBar.endStyle=errorBarData.endStyle;errorBar.numberValue=errorBarData.numberValue;chartSeries.errorBar=errorBarData;}if(series.trendLines.length>0){chartSeries.trendLines=[];for(var i=0;i<series.trendLines.length;i++){var trendLine=this.writeChartTrendLines(series.trendLines[i]);chartSeries.trendLines.push(trendLine);}}for(var i=0;i<series.chartDataFormat.length;i++){var format=this.writeChartDataFormat(series.chartDataFormat[i]);chartSeries.dataPoints.push(format);}return chartSeries;};SfdtExport.prototype.writeChartDataLabels=function(dataLabels){var dataLabel={};dataLabel.position=dataLabels.position;dataLabel.fontName=dataLabels.fontName;dataLabel.fontColor=dataLabels.fontColor;dataLabel.fontSize=dataLabels.fontSize;dataLabel.isLegendKey=dataLabels.isLegendKey;dataLabel.isBubbleSize=dataLabels.isBubbleSize;dataLabel.isCategoryName=dataLabels.isCategoryName;dataLabel.isSeriesName=dataLabels.isSeriesName;dataLabel.isValue=dataLabels.isValue;dataLabel.isPercentage=dataLabels.isPercentage;dataLabel.isLeaderLines=dataLabels.isLeaderLines;return dataLabel;};SfdtExport.prototype.writeChartTrendLines=function(trendLines){var trendLine={};trendLine.name=trendLines.trendLineName;trendLine.type=trendLines.trendLineType;trendLine.forward=trendLines.forwardValue;trendLine.backward=trendLines.backwardValue;trendLine.intercept=trendLines.interceptValue;trendLine.isDisplayEquation=trendLines.isDisplayEquation;trendLine.isDisplayRSquared=trendLines.isDisplayRSquared;return trendLine;};SfdtExport.prototype.writeLines=function(paragraph,lineIndex,offset,inlines){var startIndex=lineIndex;var endParagraph=this.endLine instanceof LineWidget&&this.endLine.paragraph===paragraph;var endIndex=endParagraph?this.endLine.indexInOwner:paragraph.childWidgets.length-1;for(var i=startIndex;i<=endIndex;i++){var child=paragraph.childWidgets[i];if(this.endLine===child||lineIndex===i&&offset!==0){this.writeLine(child,this.startLine!==this.endLine&&child!==this.startLine?0:offset,inlines);}else{this.writeInlines(paragraph,child,inlines);}}return endParagraph;};SfdtExport.prototype.writeLine=function(line,offset,inlines){this.contentInline=[];var isContentStarted=false;var contentControl=false;var isEnd=line===this.endLine;var lineWidget=line.clone();var bidi=line.paragraph.paragraphFormat.bidi;if(bidi||this.documentHelper.layout.isContainsRtl(lineWidget)){this.documentHelper.layout.reArrangeElementsForRtl(lineWidget,bidi);}var started=false;var ended=false;var length=0;for(var j=0;j<lineWidget.children.length;j++){var element=lineWidget.children[j];if(element instanceof ListTextElementBox){continue;}var inline=undefined;length+=element.length;started=length>offset;if(element instanceof ContentControl){if(!started){isContentStarted=element.type===0?true:false;}contentControl=true;}if(element instanceof TextElementBox&&element.hasOwnProperty('contentControlProperties')&&started&&!contentControl){isContentStarted=true;}if(element instanceof ContentControl){if(isContentStarted){if(element.type===1){isContentStarted=false;}}if(contentControl){if(element.type===1){contentControl=false;}}}ended=isEnd&&length>=this.endOffset;if(!started||isContentStarted){continue;}if(element instanceof ContentControl&&!sf.base.isNullOrUndefined(element.contentControlProperties)&&element.contentControlProperties.type!=='BuildingBlockGallery'||this.startContent||this.blockContent){if(ended){this.startContent=false;break;}this.writeInlinesContentControl(element,line,inlines,j);continue;}inline=this.writeInline(element);inlines[inlines.length]=inline;if(length>offset||ended){if(inline.hasOwnProperty('text')){var startIndex=length-element.length;var indexInInline=offset-startIndex;var endIndex=ended?this.endOffset-startIndex:element.length;inline.text=inline.text.substring(indexInInline,endIndex);}offset=-1;}if(ended){break;}}};SfdtExport.prototype.writeInlinesFootNote=function(paragraph,element,line,inlines){var inline={};inline.footnoteType=element.footnoteType;inline.characterFormat={};inline.characterFormat=this.writeCharacterFormat(element.characterFormat);inline.blocks=[];for(var i=0;i<element.blocks.length;i++){this.writeBlock(element.blocks[i],0,inline.blocks);}inline.symbolCode=element.symbolCode;inline.symbolFontName=element.symbolFontName;inline.customMarker=element.customMarker;return inline;};SfdtExport.prototype.writeInlinesContentControl=function(element,lineWidget,inlines,i){if(element instanceof ContentControl){if(element.contentControlWidgetType==='Block'){this.isBlockClosed=false;if(this.blockContent&&element.type===0){this.nestedBlockContent=true;return true;}else if(this.nestedBlockContent&&element.type===1){this.nestedBlockContent=false;return true;}this.blockContent=element.type===0?true:false;if(lineWidget.children[i-1]instanceof ContentControl){if(lineWidget.children[i-1].contentControlWidgetType==='Block'){this.blockContent=true;}}if(!this.blockContent){this.isBlockClosed=true;}return true;}}if(element instanceof ContentControl){if(this.startContent&&element.type===0){this.nestedContent=true;return true;}else if(this.startContent&&this.nestedContent){var inline={};inline.inlines=this.contentInline;if(this.contentInline.length>0){var nestedContent=this.nestedContentProperty(lineWidget.children[i+1],inline);inlines.push(nestedContent);this.contentInline=[];}if(this.multipleLineContent){inline=inlines[inlines.length-1];this.nestedContentProperty(lineWidget.children[i+1],inline);this.multipleLineContent=false;}this.nestedContent=false;return true;}this.contentType=element.contentControlWidgetType;this.startContent=element.type===0?true:false;return true;}if(this.startContent&&this.contentType==='Inline'){if(this.multipleLineContent){this.inlineContentControl(element,lineWidget.children[i+1],inlines);this.contentInline=[];}else{var contentinline=this.inlineContentControl(element,lineWidget.children[i+1]);if(!sf.base.isNullOrUndefined(contentinline)){if(this.nestedContent&&this.multipleLineContent){var inline={};inline.inlines=this.contentInline;inlines.push(inline);}else{inlines.push(contentinline);this.contentInline=[];return false;}}}}else{var inline=this.writeInline(element);if(!sf.base.isNullOrUndefined(inline)){inlines.push(inline);}}};SfdtExport.prototype.createParagraph=function(paragraphWidget){var paragraph={};var isParaSelected=false;if(this.documentHelper.selection&&!this.documentHelper.selection.isEmpty&&!this.isExport){var endPos=this.documentHelper.selection.end;if(!this.documentHelper.selection.isForward){endPos=this.documentHelper.selection.start;}var lastLine=endPos.paragraph.childWidgets[endPos.paragraph.childWidgets.length-1];isParaSelected=this.documentHelper.selection.isParagraphLastLine(lastLine)&&endPos.currentWidget===lastLine&&endPos.offset===this.documentHelper.selection.getLineLength(lastLine)+1;}else{isParaSelected=true;}paragraph.paragraphFormat=this.writeParagraphFormat(isParaSelected?paragraphWidget.paragraphFormat:new WParagraphFormat(paragraphWidget));paragraph.characterFormat=this.writeCharacterFormat(isParaSelected?paragraphWidget.characterFormat:new WCharacterFormat(paragraphWidget));paragraph.inlines=[];return paragraph;};/**
     * @private
     */SfdtExport.prototype.writeCharacterFormat=function(format,isInline){var characterFormat={};HelperMethods.writeCharacterFormat(characterFormat,isInline,format);characterFormat.boldBidi=isInline?format.bold:format.getValue('bold');characterFormat.italicBidi=isInline?format.italic:format.getValue('italic');characterFormat.fontSizeBidi=isInline?format.fontSize:format.getValue('fontSize');characterFormat.fontFamilyBidi=isInline?format.fontFamily:format.getValue('fontFamily');if(this.writeInlineStyles&&!isInline){characterFormat.inlineFormat=this.writeCharacterFormat(format,true);}return characterFormat;};SfdtExport.prototype.writeParagraphFormat=function(format,isInline){var paragraphFormat={};paragraphFormat.leftIndent=isInline?format.leftIndent:format.getValue('leftIndent');paragraphFormat.rightIndent=isInline?format.rightIndent:format.getValue('rightIndent');paragraphFormat.firstLineIndent=isInline?format.firstLineIndent:format.getValue('firstLineIndent');paragraphFormat.textAlignment=isInline?format.textAlignment:format.getValue('textAlignment');paragraphFormat.beforeSpacing=isInline?format.beforeSpacing:format.getValue('beforeSpacing');paragraphFormat.afterSpacing=isInline?format.afterSpacing:format.getValue('afterSpacing');paragraphFormat.lineSpacing=isInline?format.lineSpacing:format.getValue('lineSpacing');paragraphFormat.lineSpacingType=isInline?format.lineSpacingType:format.getValue('lineSpacingType');paragraphFormat.styleName=!sf.base.isNullOrUndefined(format.baseStyle)?format.baseStyle.name:undefined;paragraphFormat.outlineLevel=isInline?format.outlineLevel:format.getValue('outlineLevel');paragraphFormat.listFormat=this.writeListFormat(format.listFormat,isInline);paragraphFormat.tabs=this.writeTabs(format.tabs);paragraphFormat.bidi=isInline?format.bidi:format.getValue('bidi');paragraphFormat.keepLinesTogether=isInline?format.keepLinesTogether:format.getValue('keepLinesTogether');paragraphFormat.keepWithNext=isInline?format.keepWithNext:format.getValue('keepWithNext');paragraphFormat.widowControl=isInline?format.widowControl:format.getValue('widowControl');paragraphFormat.contextualSpacing=isInline?format.contextualSpacing:format.getValue('contextualSpacing');if(this.writeInlineStyles&&!isInline){paragraphFormat.inlineFormat=this.writeParagraphFormat(format,true);}return paragraphFormat;};SfdtExport.prototype.writeTabs=function(tabStops){if(sf.base.isNullOrUndefined(tabStops)||tabStops.length<1){return undefined;}var tabs=[];for(var i=0;i<tabStops.length;i++){var tabStop=tabStops[i];var tab={};tab.position=tabStop.position;tab.deletePosition=tabStop.deletePosition;tab.tabJustification=tabStop.tabJustification;tab.tabLeader=tabStop.tabLeader;tabs.push(tab);}return tabs;};/**
     * @private
     */SfdtExport.prototype.writeListFormat=function(format,isInline){var listFormat={};var listIdValue=format.getValue('listId');if(!sf.base.isNullOrUndefined(listIdValue)){listFormat.listId=listIdValue;if(this.lists.indexOf(format.listId)<0){this.lists.push(format.listId);}}var listLevelNumber=format.getValue('listLevelNumber');if(!sf.base.isNullOrUndefined(listLevelNumber)){listFormat.listLevelNumber=listLevelNumber;}return listFormat;};SfdtExport.prototype.writeTable=function(tableWidget,table,index,blocks){var widget=tableWidget.childWidgets[index];if(widget instanceof TableRowWidget){if(this.writeRow(widget,table.rows)){return undefined;}}var next=tableWidget;do{tableWidget=next;next=tableWidget.nextSplitWidget;}while(next instanceof BlockWidget);next=tableWidget.nextRenderedWidget;return next instanceof BlockWidget&&next.containerWidget.index===tableWidget.containerWidget.index?next:undefined;};SfdtExport.prototype.writeRow=function(rowWidget,rows){if(!(rowWidget instanceof TableRowWidget)){return false;}var row=this.createRow(rowWidget);rows.push(row);for(var i=0;i<rowWidget.childWidgets.length;i++){var widget=rowWidget.childWidgets[i];if(widget instanceof TableCellWidget){if(rowWidget.index===widget.rowIndex&&(sf.base.isNullOrUndefined(this.startColumnIndex)||widget.columnIndex>=this.startColumnIndex)&&(sf.base.isNullOrUndefined(this.endColumnIndex)||widget.columnIndex<this.endColumnIndex)){if(this.writeCell(widget,row.cells)){return true;}}}}var next=rowWidget;do{rowWidget=next;next=rowWidget.nextRenderedWidget;if(!sf.base.isNullOrUndefined(rowWidget.ownerTable.bodyWidget)&&next&&(rowWidget.ownerTable.index!==next.ownerTable.index&&rowWidget.ownerTable.bodyWidget.sectionIndex===next.ownerTable.bodyWidget.sectionIndex||rowWidget.ownerTable.bodyWidget.sectionIndex!==next.ownerTable.bodyWidget.sectionIndex)){next=undefined;}}while(next instanceof TableRowWidget&&next.index===rowWidget.index);return this.writeRow(next,rows);};SfdtExport.prototype.writeCell=function(cellWidget,cells){var cell=this.createCell(cellWidget);cells.push(cell);var firstBlock=cellWidget.firstChild;do{firstBlock=this.writeBlock(firstBlock,0,cell.blocks);}while(firstBlock);return this.endCell instanceof TableCellWidget?this.endCell.cellFormat===cellWidget.cellFormat:false;};SfdtExport.prototype.createTable=function(tableWidget){var table={};table.rows=[];table.grid=[];for(var i=0;i<tableWidget.tableHolder.columns.length;i++){table.grid[i]=tableWidget.tableHolder.columns[i].preferredWidth;}table.tableFormat=this.writeTableFormat(tableWidget.tableFormat);table.description=tableWidget.description;table.title=tableWidget.title;table.columnCount=tableWidget.tableHolder.columns.length;this.writeTablePositioning(table,tableWidget);return table;};SfdtExport.prototype.writeTablePositioning=function(table,tableWidget){if(tableWidget.wrapTextAround){table.wrapTextAround=tableWidget.wrapTextAround;table.positioning={};table.positioning.allowOverlap=tableWidget.positioning.allowOverlap;table.positioning.distanceBottom=HelperMethods.convertPixelToPoint(tableWidget.positioning.distanceBottom);table.positioning.distanceLeft=HelperMethods.convertPixelToPoint(tableWidget.positioning.distanceLeft);table.positioning.distanceRight=HelperMethods.convertPixelToPoint(tableWidget.positioning.distanceRight);table.positioning.distanceTop=HelperMethods.convertPixelToPoint(tableWidget.positioning.distanceTop);if(!sf.base.isNullOrUndefined(tableWidget.positioning.verticalAlignment)){table.positioning.verticalAlignment=tableWidget.positioning.verticalAlignment;}if(!sf.base.isNullOrUndefined(tableWidget.positioning.verticalOrigin)){table.positioning.verticalOrigin=tableWidget.positioning.verticalOrigin;}table.positioning.verticalPosition=tableWidget.positioning.verticalPosition;if(!sf.base.isNullOrUndefined(tableWidget.positioning.horizontalAlignment)){table.positioning.horizontalAlignment=tableWidget.positioning.horizontalAlignment;}if(!sf.base.isNullOrUndefined(tableWidget.positioning.horizontalOrigin)){table.positioning.horizontalOrigin=tableWidget.positioning.horizontalOrigin;}table.positioning.horizontalPosition=tableWidget.positioning.horizontalPosition;}};SfdtExport.prototype.createRow=function(rowWidget){var row={};row.cells=[];row.rowFormat=this.writeRowFormat(rowWidget.rowFormat);if(rowWidget.hasOwnProperty('contentControlProperties')){row.contentControlProperties=this.contentControlProperty(rowWidget.contentControlProperties);}return row;};SfdtExport.prototype.createCell=function(cellWidget){var cell={};cell.blocks=[];cell.cellFormat=this.writeCellFormat(cellWidget.cellFormat);cell.columnIndex=cellWidget.columnIndex;if(cellWidget.hasOwnProperty('contentControlProperties')){cell.contentControlProperties=this.contentControlProperty(cellWidget.contentControlProperties);}return cell;};SfdtExport.prototype.writeShading=function(wShading){var shading={};shading.backgroundColor=wShading.hasValue('backgroundColor')?wShading.backgroundColor:undefined;shading.foregroundColor=wShading.hasValue('foregroundColor')?wShading.foregroundColor:undefined;shading.textureStyle=wShading.hasValue('textureStyle')?wShading.textureStyle:undefined;return shading;};SfdtExport.prototype.writeBorder=function(wBorder){var border={};border.color=wBorder.hasValue('color')?wBorder.color:undefined;border.hasNoneStyle=wBorder.hasValue('hasNoneStyle')?wBorder.hasNoneStyle:undefined;border.lineStyle=wBorder.hasValue('lineStyle')?wBorder.lineStyle:undefined;border.lineWidth=wBorder.hasValue('lineWidth')?wBorder.lineWidth:undefined;border.shadow=wBorder.hasValue('shadow')?wBorder.shadow:undefined;border.space=wBorder.hasValue('space')?wBorder.space:undefined;return border;};/**
     * @private
     */SfdtExport.prototype.writeBorders=function(wBorders){var borders={};borders.top=this.writeBorder(wBorders.top);borders.left=this.writeBorder(wBorders.left);borders.right=this.writeBorder(wBorders.right);borders.bottom=this.writeBorder(wBorders.bottom);borders.diagonalDown=this.writeBorder(wBorders.diagonalDown);borders.diagonalUp=this.writeBorder(wBorders.diagonalUp);borders.horizontal=this.writeBorder(wBorders.horizontal);borders.vertical=this.writeBorder(wBorders.vertical);return borders;};SfdtExport.prototype.writeCellFormat=function(wCellFormat){var cellFormat={};cellFormat.borders=this.writeBorders(wCellFormat.borders);cellFormat.shading=this.writeShading(wCellFormat.shading);cellFormat.topMargin=wCellFormat.hasValue('topMargin')?wCellFormat.topMargin:undefined;cellFormat.rightMargin=wCellFormat.hasValue('rightMargin')?wCellFormat.rightMargin:undefined;cellFormat.leftMargin=wCellFormat.hasValue('leftMargin')?wCellFormat.leftMargin:undefined;cellFormat.bottomMargin=wCellFormat.hasValue('bottomMargin')?wCellFormat.bottomMargin:undefined;cellFormat.preferredWidth=wCellFormat.hasValue('preferredWidth')?wCellFormat.preferredWidth:undefined;cellFormat.preferredWidthType=wCellFormat.hasValue('preferredWidthType')?wCellFormat.preferredWidthType:undefined;cellFormat.cellWidth=wCellFormat.hasValue('cellWidth')?wCellFormat.cellWidth:undefined;cellFormat.columnSpan=wCellFormat.columnSpan;cellFormat.rowSpan=wCellFormat.rowSpan;cellFormat.verticalAlignment=wCellFormat.hasValue('verticalAlignment')?wCellFormat.verticalAlignment:undefined;return cellFormat;};SfdtExport.prototype.writeRowFormat=function(wRowFormat){var rowFormat={};var revisionIds=[];rowFormat.height=wRowFormat.hasValue('height')?wRowFormat.height:undefined;rowFormat.allowBreakAcrossPages=wRowFormat.hasValue('allowBreakAcrossPages')?wRowFormat.allowBreakAcrossPages:undefined;rowFormat.heightType=wRowFormat.hasValue('heightType')?wRowFormat.heightType:undefined;rowFormat.isHeader=wRowFormat.hasValue('isHeader')?wRowFormat.isHeader:undefined;rowFormat.borders=this.writeBorders(wRowFormat.borders);rowFormat.gridBefore=wRowFormat.gridBefore;rowFormat.gridBeforeWidth=wRowFormat.hasValue('gridBeforeWidth')?wRowFormat.gridBeforeWidth:undefined;rowFormat.gridBeforeWidthType=wRowFormat.hasValue('gridBeforeWidthType')?wRowFormat.gridBeforeWidthType:undefined;rowFormat.gridAfter=wRowFormat.gridAfter;rowFormat.gridAfterWidth=wRowFormat.hasValue('gridAfterWidth')?wRowFormat.gridAfterWidth:undefined;rowFormat.gridAfterWidthType=wRowFormat.hasValue('gridAfterWidthType')?wRowFormat.gridAfterWidthType:undefined;rowFormat.leftMargin=wRowFormat.hasValue('leftMargin')?wRowFormat.leftMargin:undefined;rowFormat.topMargin=wRowFormat.hasValue('topMargin')?wRowFormat.topMargin:undefined;rowFormat.rightMargin=wRowFormat.hasValue('rightMargin')?wRowFormat.rightMargin:undefined;rowFormat.bottomMargin=wRowFormat.hasValue('bottomMargin')?wRowFormat.bottomMargin:undefined;rowFormat.leftIndent=wRowFormat.hasValue('leftIndent')?wRowFormat.leftIndent:undefined;for(var j=0;j<wRowFormat.revisions.length;j++){rowFormat.revisionIds=this.writeRowRevisions(wRowFormat.revisions[j],revisionIds);}return rowFormat;};SfdtExport.prototype.writeRowRevisions=function(wrevisions,revisionIds){if(this.selectedRevisionId.indexOf(wrevisions.revisionID)===-1){this.selectedRevisionId.push(wrevisions.revisionID);}revisionIds.push(wrevisions.revisionID);return revisionIds;};SfdtExport.prototype.writeTableFormat=function(wTableFormat){var tableFormat={};tableFormat.borders=this.writeBorders(wTableFormat.borders);tableFormat.shading=this.writeShading(wTableFormat.shading);tableFormat.cellSpacing=wTableFormat.hasValue('cellSpacing')?wTableFormat.cellSpacing:undefined;tableFormat.leftIndent=wTableFormat.hasValue('leftIndent')?wTableFormat.leftIndent:undefined;tableFormat.tableAlignment=wTableFormat.hasValue('tableAlignment')?wTableFormat.tableAlignment:undefined;tableFormat.topMargin=wTableFormat.hasValue('topMargin')?wTableFormat.topMargin:undefined;tableFormat.rightMargin=wTableFormat.hasValue('rightMargin')?wTableFormat.rightMargin:undefined;tableFormat.leftMargin=wTableFormat.hasValue('leftMargin')?wTableFormat.leftMargin:undefined;tableFormat.bottomMargin=wTableFormat.hasValue('bottomMargin')?wTableFormat.bottomMargin:undefined;tableFormat.preferredWidth=wTableFormat.hasValue('preferredWidth')?wTableFormat.preferredWidth:undefined;tableFormat.preferredWidthType=wTableFormat.hasValue('preferredWidthType')?wTableFormat.preferredWidthType:undefined;tableFormat.bidi=wTableFormat.hasValue('bidi')?wTableFormat.bidi:undefined;tableFormat.allowAutoFit=wTableFormat.hasValue('allowAutoFit')?wTableFormat.allowAutoFit:undefined;return tableFormat;};SfdtExport.prototype.footnotes=function(documentHelper){for(var i=0;i<documentHelper.footnotes.separator.length;i++){this.seprators(documentHelper);}};SfdtExport.prototype.seprators=function(documentHelper){if(documentHelper.footnotes.separator.length>0){this.document.footnotes={};this.document.footnotes.separator=[];for(var i=0;i<documentHelper.footnotes.separator.length;i++){this.writeBlock(documentHelper.footnotes.separator[i],0,this.document.footnotes.separator);}}if(documentHelper.footnotes.continuationSeparator.length>0){this.document.footnotes.continuationSeparator=[];for(var i=0;i<documentHelper.footnotes.continuationSeparator.length;i++){this.writeBlock(documentHelper.footnotes.continuationSeparator[i],0,this.document.footnotes.continuationSeparator);}}if(documentHelper.footnotes.continuationNotice.length>0){this.document.footnotes.continuationNotice=[];for(var i=0;i<documentHelper.footnotes.continuationNotice.length;i++){this.writeBlock(documentHelper.footnotes.continuationNotice[i],0,this.document.footnotes.continuationNotice);}}};SfdtExport.prototype.endnotes=function(documentHelper){for(var i=0;i<this.documentHelper.endnotes.separator.length;i++){this.endnoteSeparator(documentHelper);}};SfdtExport.prototype.endnoteSeparator=function(documentHelper){if(documentHelper.endnotes.separator.length>0){this.document.endnotes={};this.document.endnotes.separator=[];for(var i=0;i<documentHelper.endnotes.separator.length;i++){this.writeBlock(documentHelper.endnotes.separator[i],0,this.document.endnotes.separator);}}if(documentHelper.endnotes.continuationSeparator.length>0){this.document.endnotes.continuationSeparator=[];for(var i=0;i<documentHelper.endnotes.continuationSeparator.length;i++){this.writeBlock(documentHelper.endnotes.continuationSeparator[i],0,this.document.endnotes.continuationSeparator);}}if(documentHelper.endnotes.continuationNotice.length>0){this.document.endnotes.continuationNotice=[];for(var i=0;i<documentHelper.endnotes.continuationNotice.length;i++){this.writeBlock(documentHelper.endnotes.continuationNotice[i],0,this.document.endnotes.continuationNotice);}}};SfdtExport.prototype.writeStyles=function(documentHelper){this.document.styles=[];for(var i=0;i<documentHelper.styles.length;i++){this.document.styles.push(this.writeStyle(documentHelper.styles.getItem(i)));}};SfdtExport.prototype.writeStyle=function(style){var wStyle={};wStyle.name=style.name;if(style.type==='Paragraph'){wStyle.type='Paragraph';wStyle.paragraphFormat=this.writeParagraphFormat(style.paragraphFormat);wStyle.characterFormat=this.writeCharacterFormat(style.characterFormat);}if(style.type==='Character'){wStyle.type='Character';wStyle.characterFormat=this.writeCharacterFormat(style.characterFormat);}if(!sf.base.isNullOrUndefined(style.basedOn)){wStyle.basedOn=style.basedOn.name;}if(!sf.base.isNullOrUndefined(style.link)){wStyle.link=style.link.name;}if(!sf.base.isNullOrUndefined(style.next)){wStyle.next=style.next.name;}return wStyle;};SfdtExport.prototype.writeRevisions=function(documentHelper){this.document.revisions=[];for(var i=0;i<documentHelper.owner.revisions.changes.length;i++){if(this.isExport||!this.isExport&&this.selectedRevisionId.indexOf(documentHelper.owner.revisions.changes[i].revisionID)!==-1){this.document.revisions.push(this.writeRevision(documentHelper.owner.revisions.changes[i]));}}};SfdtExport.prototype.writeRevision=function(revisions){var revision={};revision.author=revisions.author;revision.date=revisions.date;revision.revisionType=revisions.revisionType;revision.revisionId=revisions.revisionID;return revision;};SfdtExport.prototype.writeComments=function(documentHelper){this.document.comments=[];for(var i=0;i<documentHelper.comments.length;i++){if(this.isExport||!this.isExport&&this.selectedCommentsId.indexOf(this.documentHelper.comments[i].commentId)!==-1){this.document.comments.push(this.writeComment(this.documentHelper.comments[i]));}}};SfdtExport.prototype.writeCustomXml=function(documentHelper){this.document.customXml=[];for(var i=0;i<documentHelper.customXmlData.length;i++){var customXml={};var key=documentHelper.customXmlData.keys[i];customXml.itemID=key;var xmlValue=this.documentHelper.customXmlData.get(key);customXml.xml=xmlValue;this.document.customXml.push(customXml);}};SfdtExport.prototype.writeComment=function(comments){var comment={};comment.commentId=comments.commentId;comment.author=comments.author;comment.date=comments.date;comment.blocks=[];comment.blocks.push(this.commentInlines(comments.text));comment.done=comments.isResolved;comment.replyComments=[];for(var i=0;i<comments.replyComments.length;i++){comment.replyComments.push(this.writeComment(comments.replyComments[i]));}return comment;};SfdtExport.prototype.commentInlines=function(ctext){var blocks={};blocks.inlines=[{text:ctext}];return blocks;};SfdtExport.prototype.writeLists=function(documentHelper){var abstractLists=[];this.document.lists=[];for(var i=0;i<documentHelper.lists.length;i++){var list=documentHelper.lists[i];if(this.lists.indexOf(list.listId)>-1){this.document.lists.push(this.writeList(list));if(abstractLists.indexOf(list.abstractListId)<0){abstractLists.push(list.abstractListId);}}}this.document.abstractLists=[];for(var i=0;i<documentHelper.abstractLists.length;i++){var abstractList=documentHelper.abstractLists[i];if(abstractLists.indexOf(abstractList.abstractListId)>-1){this.document.abstractLists.push(this.writeAbstractList(abstractList));}}};SfdtExport.prototype.writeAbstractList=function(wAbstractList){var abstractList={};abstractList.abstractListId=wAbstractList.abstractListId;abstractList.levels=[];for(var i=0;i<wAbstractList.levels.length;i++){abstractList.levels[i]=this.writeListLevel(wAbstractList.levels[i]);}return abstractList;};SfdtExport.prototype.writeList=function(wList){var list={};list.abstractListId=wList.abstractListId;list.levelOverrides=[];for(var i=0;i<wList.levelOverrides.length;i++){list.levelOverrides.push(this.writeLevelOverrides(wList.levelOverrides[i]));}list.listId=wList.listId;return list;};SfdtExport.prototype.writeLevelOverrides=function(wlevel){var levelOverrides={};levelOverrides.levelNumber=wlevel.levelNumber;if(wlevel.overrideListLevel){levelOverrides.overrideListLevel=this.writeListLevel(wlevel.overrideListLevel);}levelOverrides.startAt=wlevel.startAt;return levelOverrides;};SfdtExport.prototype.writeListLevel=function(wListLevel){var listLevel={};listLevel.characterFormat=this.writeCharacterFormat(wListLevel.characterFormat);listLevel.paragraphFormat=this.writeParagraphFormat(wListLevel.paragraphFormat);listLevel.followCharacter=wListLevel.followCharacter;listLevel.listLevelPattern=wListLevel.listLevelPattern;listLevel.numberFormat=wListLevel.numberFormat;listLevel.restartLevel=wListLevel.restartLevel;listLevel.startAt=wListLevel.startAt;return listLevel;};SfdtExport.prototype.getParentBlock=function(widget){if(widget.isInsideTable){widget=this.owner.documentHelper.layout.getParentTable(widget);}return widget;};/**
     * @private
     * @returns {void}
     */SfdtExport.prototype.destroy=function(){this.lists=undefined;this.endLine=undefined;this.startLine=undefined;this.endOffset=undefined;this.documentHelper=undefined;};return SfdtExport;}();/**
 * Export Export
 */ /**
 *  Class which performs optimized text measuring logic to find font height.
 */var Optimized=/** @class */function(){/**
     * Constructor to initialize Optimized module.
     * @param {DocumentHelper} documentHelper - the document helper object.
     */function Optimized(documentHelper){this.documentHelper=documentHelper;this.optimizedHeightCollection={};}/**
     * Get module name.
     */Optimized.prototype.getModuleName=function(){return'Optimized';};/**
     * Construct key based on the character format.
     * @param {WCharacterFormat} characterFormat - the character format to construct key.
     * @returns {string} - the constructed key.
     */Optimized.prototype.getkeyFromCharFormat=function(characterFormat){var formatText=characterFormat.fontFamily.toLocaleLowerCase();if(characterFormat.bold){formatText+=';'+'bold';}if(characterFormat.italic){formatText+=';'+'italic';}return formatText;};/**
     * Method to retrieve font information with optimized text measuring logic.
     * @param {WCharacterFormat} characterFormat -character format to apply.
     * @returns {string} - returns font size information.
     */Optimized.prototype.getFontInfo=function(characterFormat){var container=document.createElement("div");container.setAttribute('style','position:absolute;top:-1000px;left:-1000px;opacity:0;font-size:0px;line-height:normal;');// constant tested height value for calculating height factor which matches 90% accuracy with GDI+ value.
var maxFontHeight=288;var factor=1.0/window.devicePixelRatio;container.style.transform="scale("+factor.toString()+","+factor.toString()+")";container.innerHTML='<span style="font-size:0; font-family: '+characterFormat.fontFamily+'; display: inline-block;">m</span><span style="font-size:'+maxFontHeight+"pt; font-family: "+characterFormat.fontFamily+';'+(characterFormat.bold?'font-weight:bold;':'')+(characterFormat.italic?'font-style:italic;':'')+' display: inline-block;">m</span>';document.body.appendChild(container);var baseLineFactor=container.firstChild.offsetTop/container.lastChild.offsetHeight;var heightFactor=parseFloat((container.lastChild.offsetHeight/maxFontHeight).toFixed(2));document.body.removeChild(container);return{HeightFactor:heightFactor,BaselineFactor:baseLineFactor};};/**
     * @private
     * @param {WCharacterFormat} characterFormat - character format to apply.
     * @returns {TextSizeInfo} returns text size information.
     */Optimized.prototype.getHeightInternal=function(characterFormat){var key=this.getkeyFromCharFormat(characterFormat);//With optimized technique, height and baseline factor will be same for each font-family, hence we maintaining cache for the factors and updating height based on font size.
if(sf.base.isNullOrUndefined(this.optimizedHeightCollection[key])){var fontInfo=this.getFontInfo(characterFormat);this.optimizedHeightCollection[key]=fontInfo;var fontHeight=fontInfo.HeightFactor*characterFormat.fontSize;return{Height:fontHeight,BaselineOffset:fontInfo.BaselineFactor*fontHeight};}else{var fontSizeInfo=this.optimizedHeightCollection[key];var fontHeight=fontSizeInfo.HeightFactor*characterFormat.fontSize;return{Height:fontHeight,BaselineOffset:fontSizeInfo.BaselineFactor*fontHeight};}};/**
   * @private
   * @returns {void}
   */Optimized.prototype.destroy=function(){this.documentHelper=undefined;this.optimizedHeightCollection=undefined;};return Optimized;}();/**
 * Class which performs regular text measuring logic to find font height.
 */var Regular=/** @class */function(){/**
     * Constructor to initialize Regular module.
     * @param {DocumentHelper} documentHelper - the document helper object
     */function Regular(documentHelper){this.documentHelper=documentHelper;}/**
     * Gets module name.
     * @returns {string} - the module name.
     */Regular.prototype.getModuleName=function(){return'Regular';};/**
     * @private
     * @param {WCharacterFormat} characterFormat - character format to apply.
     * @returns {TextSizeInfo} returns text size information.
     */Regular.prototype.getHeightInternal=function(characterFormat){var textHeight=0;var baselineOffset=0;var spanElement=document.createElement('span');spanElement.innerText='m';var iframe=sf.base.createElement('iframe');document.body.appendChild(iframe);var innerHtml='<!DOCTYPE html>'+'<html><head></head>'+'<body>'+'</body>'+'</html>';if(!sf.base.isNullOrUndefined(iframe.contentDocument)){iframe.contentDocument.open();iframe.contentDocument.write(innerHtml);iframe.contentDocument.close();}this.applyStyle(spanElement,characterFormat);var parentDiv=document.createElement('div');parentDiv.setAttribute('style','display:inline-block;position:absolute;');var tempDiv=document.createElement('div');tempDiv.setAttribute('style','display:inline-block;width: 1px; height: 0px;vertical-align: baseline;');parentDiv.appendChild(spanElement);parentDiv.appendChild(tempDiv);iframe.contentDocument.body.appendChild(parentDiv);textHeight=spanElement.offsetHeight;var textTopVal=spanElement.offsetTop;var tempDivTopVal=tempDiv.offsetTop;baselineOffset=tempDivTopVal-textTopVal;document.body.removeChild(iframe);return{'Height':textHeight,'BaselineOffset':baselineOffset};};Regular.prototype.applyStyle=function(spanElement,characterFormat){if(!sf.base.isNullOrUndefined(spanElement)&&!sf.base.isNullOrUndefined(characterFormat)){var style='white-space:nowrap;';if(characterFormat.fontFamily!==''){style+='font-family:'+characterFormat.fontFamily+';';}var fontSize=characterFormat.fontSize;if(fontSize<=0.5){fontSize=0.5;}style+='font-size:'+fontSize.toString()+'pt;';if(characterFormat.bold){style+='font-weight:bold;';}if(characterFormat.italic){style+='font-style:italic;';}spanElement.setAttribute('style',style);}};/**
   * @private
   * @returns {void}
   */Regular.prototype.destroy=function(){this.documentHelper=undefined;};return Regular;}();/**
 * Text measuring logics.
 */ /**
 * Document Editor implementation
 */ /**
 * Text Properties pane
 * @private
 */ /**
 * Image Properties pane
 * @private
 */ /**
 * Table Properties pane
 * @private
 */ /**
 * TOC Properties pane
 * @private
 */ /**
 * Header Footer Properties pane
 * @private
 */ // import { ContextMenu } from './index';
// tslint:disable-next-line:max-line-length
/**
 * Document Editor component.
 */var SfDocumentEditor=/** @class */function(){/**
     * Initialize the constructor of DocumentEditor
     */function SfDocumentEditor(element,dotnetRef,options){this.enableHeaderFooterIn=false;/**
         * @private
         */this.isShiftingEnabled=false;/**
         * @private
         */this.isLayoutEnabled=true;/**
         * @private
         */this.isPastingContent=false;/**
         * @private
         */this.parser=undefined;this.disableHistoryIn=false;/**
         * @private
         */this.findResultsList=undefined;this.defaultLocale={};// /**
//  * @private
//  */
// public hyperlinkDialogModule: HyperlinkDialog;
// /**
//  * @private
//  */
// public bookmarkDialogModule: BookmarkDialog;
// /**
//  * @private
//  */
// public stylesDialogModule: StylesDialog;
// /**
//  * @private
//  */
// public contextMenuModule: ContextMenu;
/**
         * @private
         */this.imageResizerModule=undefined;// Public Implementation Starts
/**
         * Gets or sets the zoom factor in document editor.
         * @default 1
         */this.zoomFactor=1;// debugger;
this.dotNetRef=dotnetRef;if(!sf.base.isNullOrUndefined(element)){element.blazor__instance=this;}this.element=element;this.documentHelper=new DocumentHelper(this);if(!sf.base.isNullOrUndefined(options)){this.options=options;this.updateOptions(options);}if(this.layoutType==='Pages'){this.viewer=new PageLayoutViewer(this);}else{this.viewer=new WebLayoutViewer(this);}}Object.defineProperty(SfDocumentEditor.prototype,"enableHeaderAndFooter",{/**
         * @private
         */get:function get(){return this.enableHeaderFooterIn;},set:function set(value){this.enableHeaderFooterIn=value;if(!value&&this.selection&&this.selection.isWebLayout){this.selection.isWebLayout=false;}this.viewer.updateScrollBars();},enumerable:true,configurable:true});Object.defineProperty(SfDocumentEditor.prototype,"pageCount",{/**
         * Gets the total number of pages.
         * @blazorType int
         * @returns {number}
         */get:function get(){if(!this.isDocumentLoaded||sf.base.isNullOrUndefined(this.viewer)||this.viewer instanceof WebLayoutViewer){return 1;}return this.documentHelper.pages.length;},enumerable:true,configurable:true});Object.defineProperty(SfDocumentEditor.prototype,"selection",{/**
         *  Gets the selection object of the document editor.
         * @aspType Selection
         * @blazorType Selection
         * @returns {Selection}
         * @default undefined
         */get:function get(){return this.selectionModule;},enumerable:true,configurable:true});Object.defineProperty(SfDocumentEditor.prototype,"editor",{/**
         *  Gets the editor object of the document editor.
         * @aspType Editor
         * @blazorType Editor
         * @returns {Editor}
         * @default undefined
         */get:function get(){return this.editorModule;},enumerable:true,configurable:true});Object.defineProperty(SfDocumentEditor.prototype,"editorHistory",{/**
         * Gets the editor history object of the document editor.
         * @aspType EditorHistory
         * @blazorType EditorHistory
         * @returns {EditorHistory}
         */get:function get(){return this.editorHistoryModule;},enumerable:true,configurable:true});Object.defineProperty(SfDocumentEditor.prototype,"search",{/**
         * Gets the search object of the document editor.
         * @aspType Search
         * @blazorType Search
         * @returns { Search }
         */get:function get(){return this.searchModule;},enumerable:true,configurable:true});Object.defineProperty(SfDocumentEditor.prototype,"spellChecker",{// /**
//  * Gets the context menu object of the document editor.
//  * @aspType ContextMenu
//  * @blazorType ContextMenu
//  * @returns {ContextMenu}
//  */
// public get contextMenu(): ContextMenu {
//     return this.contextMenuModule;
// }
// /**
//  * Gets the spell check dialog object of the document editor.
//  * @returns SpellCheckDialog
//  */
// get spellCheckDialog(): SpellCheckDialog {
//     return this.spellCheckDialogModule;
// }
/**
         * Gets the spell check object of the document editor.
         * @aspType SpellChecker
         * @blazorType SpellChecker
         * @returns SpellChecker
         */get:function get(){return this.spellCheckerModule;},enumerable:true,configurable:true});Object.defineProperty(SfDocumentEditor.prototype,"containerId",{/**
         * @private
         */get:function get(){return this.element.id;},enumerable:true,configurable:true});Object.defineProperty(SfDocumentEditor.prototype,"isDocumentLoaded",{/**
         * @private
         */get:function get(){return this.isDocumentLoadedIn;},set:function set(value){this.isDocumentLoadedIn=value;},enumerable:true,configurable:true});Object.defineProperty(SfDocumentEditor.prototype,"revisions",{/**
         * Gets the revision collection which contains information about changes made from original document
         */get:function get(){if(sf.base.isNullOrUndefined(this.revisionsInternal)){this.revisionsInternal=new RevisionCollection(this);}return this.revisionsInternal;},enumerable:true,configurable:true});Object.defineProperty(SfDocumentEditor.prototype,"enableHistoryMode",{/**
         * Determines whether history needs to be enabled or not.
         * @default - false
         * @private
         */get:function get(){return this.enableEditorHistory&&!sf.base.isNullOrUndefined(this.editorHistoryModule);},enumerable:true,configurable:true});Object.defineProperty(SfDocumentEditor.prototype,"documentStart",{/**
         * Gets the start text position in the document.
         * @default undefined
         * @private
         */get:function get(){if(!sf.base.isNullOrUndefined(this.selectionModule)){return this.selection.getDocumentStart();}return undefined;},enumerable:true,configurable:true});Object.defineProperty(SfDocumentEditor.prototype,"documentEnd",{/**
         * Gets the end text position in the document.
         * @default undefined
         * @private
         */get:function get(){if(!sf.base.isNullOrUndefined(this.selectionModule)){return this.selection.getDocumentEnd();}return undefined;},enumerable:true,configurable:true});Object.defineProperty(SfDocumentEditor.prototype,"isReadOnlyMode",{/**
         * @private
         */get:function get(){return this.isReadOnly||sf.base.isNullOrUndefined(this.editorModule)||sf.base.isNullOrUndefined(this.selectionModule)||!sf.base.isNullOrUndefined(this.editor)&&this.editor.restrictEditing;},enumerable:true,configurable:true});Object.defineProperty(SfDocumentEditor.prototype,"isSpellCheck",{/**
         * @private
         */get:function get(){return this.enableSpellCheck&&this.spellChecker.enableSpellCheck;},enumerable:true,configurable:true});Object.defineProperty(SfDocumentEditor.prototype,"enableImageResizerMode",{/**
         * Specifies to enable image resizer option
         * default - false
         * @private
         */get:function get(){return this.enableImageResizer&&!sf.base.isNullOrUndefined(this.imageResizerModule);},enumerable:true,configurable:true});SfDocumentEditor.prototype.updateOptions=function(options){this.acceptTab=options.acceptTab;this.currentUser=options.currentUser;this.documentName=options.documentName;this.enableBookmarkDialog=options.enableBookmarkDialog;this.enableBordersAndShadingDialog=options.enableBordersAndShadingDialog;this.enableComment=options.enableComment;this.enableContextMenu=options.enableContextMenu;this.enableCursorOnReadOnly=options.enableCursorOnReadOnly;this.enableEditor=options.enableEditor;this.enableEditorHistory=options.enableEditorHistory;this.enableFontDialog=options.enableFontDialog;this.enableFormField=options.enableFormField;this.enableHyperlinkDialog=options.enableHyperlinkDialog;this.enableImageResizer=options.enableImageResizer;this.enableListDialog=options.enableListDialog;this.enableLocalPaste=options.enableLocalPaste;this.enableOptionsPane=options.enableOptionsPane;this.enablePageSetupDialog=options.enablePageSetupDialog;this.enableParagraphDialog=options.enableParagraphDialog;this.enablePrint=options.enablePrint;this.enableSearch=options.enableSearch;this.enableSelection=options.enableSelection;this.enableSfdtExport=options.enableSfdtExport;this.enableSpellCheck=options.enableSpellCheck;this.enableStyleDialog=options.enableStyleDialog;this.enableTableDialog=options.enableTableDialog;this.enableTableOfContentsDialog=options.enableTableOfContentsDialog;this.enableTableOptionsDialog=options.enableTableOptionsDialog;this.enableTextExport=options.enableTextExport;this.enableTrackChanges=options.enableTrackChanges;this.enableWordExport=options.enableWordExport;this.headers=options.headers?options.headers:[];this.height=options.height;this.isReadOnly=options.isReadOnly;this.pageGap=options.pageGap;this.pageOutline=options.pageOutline;this.serviceUrl=options.serviceUrl;this.showComments=options.showComments;this.showRevisions=options.showRevisions;this.useCtrlClickToFollowHyperlink=options.useCtrlClickToFollowHyperlink;this.userColor=options.userColor;this.width=options.width;this.zIndex=options.zIndex;this.zoomFactor=options.zoomFactor;this.layoutType=options.layoutType;this.defaultPasteOption=options.defaultPasteOption;this.documentEditorSettings=options.documentEditorSettings;this.serverActionSettings=options.serverActionSettings;this.requiredModules();};SfDocumentEditor.prototype.setOptions=function(model,options,update){var _this=this;for(var _i=0,_a=Object.keys(model);_i<_a.length;_i++){var prop=_a[_i];switch(prop){case'zoomFactor':if(options.zoomFactor!=model.zoomFactor){this.zoomFactor=model.zoomFactor;if(this.documentHelper){this.documentHelper.zoomFactor=model.zoomFactor;}}break;case'layoutType':if(this.selection&&this.selection.isWebLayout){break;}if(options.layoutType!=model.layoutType){this.layoutType=model.layoutType;this.viewer.destroy();if(this.layoutType==='Pages'){this.viewer=new PageLayoutViewer(this);}else{if(this.enableHeaderAndFooter===true){this.selection.closeHeaderFooter();}this.viewer=new WebLayoutViewer(this);}this.editor.layoutWholeDocument();setTimeout(function(){_this.fireViewChange();},200);}break;case'locale':// this.localizeDialogs();
break;case'isReadOnly':this.isReadOnly=model.isReadOnly;break;case'currentUser':if(options.currentUser!=model.currentUser){this.currentUser=model.currentUser;if(this.selection&&this.documentHelper.isDocumentProtected){this.selection.highlightEditRegion();}}break;case'userColor':if(options.userColor!=model.userColor){this.userColor=model.userColor;if(this.selection&&this.documentHelper.isDocumentProtected){this.selection.highlightEditRegion();}}break;case'pageGap':if(options.pageGap!=model.pageGap){this.pageGap=model.pageGap;this.viewer.updateScrollBars();}break;case'pageOutline':if(options.pageOutline!=model.pageOutline){this.pageOutline=model.pageOutline;this.viewer.updateScrollBars();}break;case'zIndex':// if (this.documentHelper.dialog) {
//     this.documentHelper.dialog.zIndex = model.zIndex + 10;
// }
// if (this.documentHelper.dialog2) {
//     this.documentHelper.dialog2.zIndex = model.zIndex;
// }
break;case'showComments':// if (this.viewer) {
//     this.documentHelper.showComments(model.showComments);
// }
break;case'enableRtl':// this.localizeDialogs(model.enableRtl);
break;case'enableComment':// if (this.viewer && this.showComments) {
//     this.showComments = this.showComments ? this.enableComment : false;
//     this.documentHelper.showComments(model.enableComment);
// }
// this.viewer.updateScrollBars();
break;case'showRevisions':if(this.isReadOnly||this.documentHelper.isDocumentProtected){this.showRevisions=false;this.documentHelper.showRevisions(false);}else if(this.viewer){this.documentHelper.showRevisions(model.showRevisions);}break;case'documentEditorSettings':this.documentEditorSettings=options.documentEditorSettings;if(options.documentEditorSettings.enableOptimizedTextMeasuring){this.textMeasureHelper=new Optimized(this.documentHelper);}else{this.textMeasureHelper=new Regular(this.documentHelper);}this.viewer.updateScrollBars();break;case'height':if(options.height!=model.height){var calcHeight='';if(this.height.indexOf('%')!==-1){calcHeight=window.innerHeight*(parseInt(this.height)/100)+'px';}else{calcHeight=sf.base.formatUnit(this.height);}this.height=model.height;this.element.style.height=calcHeight;this.resize();}break;case'width':if(options.width!=model.width){this.width=model.width;this.element.style.width=sf.base.formatUnit(this.width);this.resize();}break;}}if(update){this.updateOptions(model);}};SfDocumentEditor.prototype.preRender=function(){//pre render section
this.findResultsList=[];};SfDocumentEditor.prototype.render=function(){if(!sf.base.isNullOrUndefined(this.element)){var container=this.element;container.style.minHeight='200px';container.style.minWidth='200px';this.element.style.height=sf.base.formatUnit(this.height);if(this.width!==''){this.element.style.width=sf.base.formatUnit(this.width);}}this.documentHelper.initializeComponents();this.openBlank();// this.renderComplete();
};/**
     * Called internally if any of the property value changed.
     * @private
     */SfDocumentEditor.prototype.onPropertyChanged=function(model,oldProp){var _this=this;for(var _i=0,_a=Object.keys(model);_i<_a.length;_i++){var prop=_a[_i];switch(prop){case'zoomFactor':if(this.viewer){this.documentHelper.zoomFactor=model.zoomFactor;}break;case'layoutType':if(this.selection&&this.selection.isWebLayout){break;}this.viewer.destroy();if(this.layoutType==='Pages'){this.viewer=new PageLayoutViewer(this);}else{if(this.enableHeaderAndFooter===true){this.selection.closeHeaderFooter();}this.viewer=new WebLayoutViewer(this);}this.editor.layoutWholeDocument();setTimeout(function(){_this.fireViewChange();},200);break;case'locale':// this.localizeDialogs();
break;case'isReadOnly':this.isReadOnly=model.isReadOnly;break;case'currentUser':case'userColor':if(this.selection&&this.documentHelper.isDocumentProtected){this.selection.highlightEditRegion();}break;case'pageGap':case'pageOutline':this.viewer.updateScrollBars();break;case'zIndex':// if (this.documentHelper.dialog) {
//     this.documentHelper.dialog.zIndex = model.zIndex + 10;
// }
// if (this.documentHelper.dialog2) {
//     this.documentHelper.dialog2.zIndex = model.zIndex;
// }
break;case'showComments':if(this.viewer){this.documentHelper.showComments(model.showComments);}break;case'enableRtl':// this.localizeDialogs(model.enableRtl);
break;case'enableComment':if(this.viewer&&this.showComments){this.showComments=this.showComments?this.enableComment:false;this.documentHelper.showComments(model.enableComment);}this.viewer.updateScrollBars();break;case'showRevisions':if(this.viewer){this.documentHelper.showRevisions(model.showRevisions);}this.viewer.updateScrollBars();break;case'documentEditorSettings':this.viewer.updateScrollBars();break;case'height':this.element.style.height=sf.base.formatUnit(this.height);this.resize();break;case'width':this.element.style.width=sf.base.formatUnit(this.width);this.resize();break;}}};// private localizeDialogs(enableRtl?: boolean): void {
//     if (this.locale !== '') {
//         let l10n: L10n = new L10n('documenteditor', this.defaultLocale);
//         l10n.setLocale(this.locale);
//         if (!isNullOrUndefined(enableRtl)) {
//             this.documentHelper.dialog.enableRtl = enableRtl;
//             this.documentHelper.dialog2.enableRtl = enableRtl;
//         }
//         if (this.optionsPaneModule) {
//             this.optionsPaneModule.initOptionsPane(l10n, enableRtl);
//         }
//         if (this.paragraphDialogModule) {
//             this.paragraphDialogModule.initParagraphDialog(l10n);
//         }
//         if (this.pageSetupDialogModule) {
//             this.pageSetupDialogModule.initPageSetupDialog(l10n, enableRtl);
//         }
//         if (this.fontDialogModule) {
//             this.fontDialogModule.initFontDialog(l10n, enableRtl);
//         }
//         if (this.hyperlinkDialogModule) {
//             this.hyperlinkDialogModule.initHyperlinkDialog(l10n, enableRtl);
//         }
//         if (this.contextMenuModule) {
//             this.contextMenuModule.contextMenuInstance.destroy();
//             this.contextMenuModule.initContextMenu(l10n, enableRtl);
//         }
//         if (this.listDialogModule) {
//             this.listDialogModule.initListDialog(l10n, enableRtl);
//         }
//         if (this.tablePropertiesDialogModule) {
//             this.tablePropertiesDialogModule.initTablePropertyDialog(l10n, enableRtl);
//         }
//         if (this.bordersAndShadingDialogModule) {
//             this.bordersAndShadingDialogModule.initBordersAndShadingsDialog(l10n, enableRtl);
//         }
//         if (this.cellOptionsDialogModule) {
//             this.cellOptionsDialogModule.initCellMarginsDialog(l10n, enableRtl);
//         }
//         if (this.tableOptionsDialogModule) {
//             this.tableOptionsDialogModule.initTableOptionsDialog(l10n, enableRtl);
//         }
//         if (this.tableDialogModule) {
//             this.tableDialogModule.initTableDialog(l10n);
//         }
//         if (this.styleDialogModule) {
//             this.styleDialogModule.initStyleDialog(l10n, enableRtl);
//         }
//         if (this.tableOfContentsDialogModule) {
//             this.tableOfContentsDialogModule.initTableOfContentDialog(l10n, enableRtl);
//         }
//         if (this.commentReviewPane && this.commentReviewPane.parentPaneElement) {
//             if (this.enableRtl) {
//                 classList(this.commentReviewPane.parentPaneElement, ['e-rtl'], []);
//             } else {
//                 classList(this.commentReviewPane.parentPaneElement, [], ['e-rtl']);
//             }
//         }
//     }
// }
/**
     * Set the default character format for document editor
     * @param characterFormat
     */SfDocumentEditor.prototype.setDefaultCharacterFormat=function(characterFormat){this.characterFormat=characterFormat;};/**
     * Set the default paragraph format for document editor
     * @param paragraphFormat
     */SfDocumentEditor.prototype.setDefaultParagraphFormat=function(paragraphFormat){this.paragraphFormat=paragraphFormat;};/**
     * Set the default section format for document editor
     * @param sectionFormat
     */SfDocumentEditor.prototype.setDefaultSectionFormat=function(sectionFormat){this.sectionFormat=sectionFormat;};/**
     * Get the properties to be maintained in the persisted state.
     * @private
     */SfDocumentEditor.prototype.getPersistData=function(){return'documenteditor';};SfDocumentEditor.prototype.clearPreservedCollectionsInViewer=function(){if(this.viewer instanceof LayoutViewer){this.documentHelper.clearDocumentItems();}};/**
     * @private
     */SfDocumentEditor.prototype.getDocumentEditorElement=function(){return this.element;};/**
     * @private
     */SfDocumentEditor.prototype.fireContentChange=function(){var _this=this;if(this.contentChangeTimer){clearTimeout(this.contentChangeTimer);}this.contentChangeTimer=setTimeout(function(){var eventArgs={canUndo:_this.editorHistory.canUndo(),canRedo:_this.editorHistory.canRedo(),pageCount:_this.pageCount};_this.dotNetRef.invokeMethodAsync('ContentChangeInternal',eventArgs);},200);this.dotNetRef.invokeMethodAsync('ContentChange');};/**
     * @private
     */SfDocumentEditor.prototype.fireDocumentChange=function(){var _this=this;if(this.documentChangeTimer){clearTimeout(this.documentChangeTimer);}var args={enableTrackChanges:this.enableTrackChanges};this.documentChangeTimer=setTimeout(function(){_this.dotNetRef.invokeMethodAsync('DocumentChangeInternal',args);},200);this.dotNetRef.invokeMethodAsync('DocumentChange',args);this.dotNetRef.invokeMethodAsync('UpdateCommentsCollection',this.fetchComments());};/**
     * @private
     */SfDocumentEditor.prototype.showFormFieldPopup=function(formFieldInfo){this.dotNetRef.invokeMethodAsync('ShowFormFieldPopup',formFieldInfo.type,JSON.stringify(formFieldInfo),true);};/**
     * @private
     */SfDocumentEditor.prototype.hideFormFieldPopup=function(){this.dotNetRef.invokeMethodAsync('ShowFormFieldPopup',"","",false);};/**
     * @private
     */SfDocumentEditor.prototype.fireSelectionChange=function(){var _this=this;// debugger;
if(!this.documentHelper.isCompositionStart&&sf.base.Browser.isDevice&&this.editorModule){this.editorModule.predictText();}if(this.editor&&this.editor.isInsertingTOC){return;}var eventArgs={source:sf.base.isBlazor()?null:this};sf.base.EventHandler.trigger(this.element,'selectionChange',eventArgs);if(this.selectionTimer){clearTimeout(this.selectionTimer);}this.selectionTimer=setTimeout(function(){_this.fireSelectionChangeInternal();},200);this.dotNetRef.invokeMethodAsync("SelectionChange");};/**
     * @private
     */SfDocumentEditor.prototype.fireSelectionChangeInternal=function(){this.dotNetRef.invokeMethodAsync("SelectionChangeInternal",this.getCurrentContext());};SfDocumentEditor.prototype.isContentProtected=function(){var isProtectedDocument=this.documentHelper.isDocumentProtected;var allowFormatting=false;var isSelectionInProtectecRegion=false;var protectionType="NoProtection";if(isProtectedDocument){allowFormatting=isProtectedDocument&&this.documentHelper.restrictFormatting;isSelectionInProtectecRegion=this.editor.restrictEditing;protectionType=this.documentHelper.protectionType;}var isReadOnly=this.isReadOnly;var protectionInfo={isDocumentProtected:isProtectedDocument,allowFormatting:allowFormatting,isInProtectecRegion:isSelectionInProtectecRegion,isReadOnly:isReadOnly,protectionType:protectionType};return protectionInfo;};SfDocumentEditor.prototype.getCurrentContext=function(){var context={};context.characterFormat=this.fetchCharacterFormat(this.selection.characterFormat);context.paragraphFormat=this.fetchParagraphFormat(this.selection.paragraphFormat);context.sectionFormat=this.fetchSectionFormat(this.selection.sectionFormat);if(this.selection.contextType.indexOf('Table')>=0){context.tableFormat=this.fetchTableFormat(this.selection.tableFormat);context.rowFormat=this.fetchRowFormat(this.selection.rowFormat);context.cellFormat=this.fetchCellFormat(this.selection.cellFormat);}if(this.selection.contextType.indexOf('Image')>=0){context.imageFormat=this.fetchImageFormat();}var data={};var contextTypeInternal=this.selection.contextType;var selection=this.documentHelper.selection;var isCrossRefField=false;var field=selection.getHyperlinkField();data.isHideComment=this.documentHelper.owner.isReadOnlyMode||this.documentHelper.owner.enableHeaderAndFooter||!this.documentHelper.owner.enableComment;if(field instanceof FieldElementBox&&selection.isReferenceField(field)){isCrossRefField=true;if(this.documentHelper.protectionType==='FormFieldsOnly'||!this.documentHelper.owner.isReadOnlyMode){data.canUpdateField=true;}}data.contextType=contextTypeInternal;data.isReadOnly=this.documentHelper.owner.isReadOnlyMode;var isEmpty=this.selection.isEmpty;data.isEmpty=isEmpty;if(contextTypeInternal==='TableOfContents'){data.isTableOfContents=true;}else{var start=selection.start;var end=selection.end;if(selection.contextType==='List'&&selection.getListLevel(start.paragraph).listLevelPattern!=='Bullet'){data.isList=true;}var isCellOrRowSelected=start.paragraph.isInsideTable&&(!end.paragraph.isInsideTable||start.paragraph.associatedCell!==end.paragraph.associatedCell||this.documentHelper.selection.isCellSelected(start.paragraph.associatedCell,start,end));if(isCellOrRowSelected){data.isHyperlinkEnabled=true;}else{data.isHyperlinkEnabled=false;}if(field instanceof FieldElementBox&&!selection.isImageField()&&!isCrossRefField){data.editHyperLink=true;}else{data.editHyperLink=false;}data.formFieldType="";if(selection.isFormField()){var inline=this.documentHelper.selection.getCurrentFormField();if(inline instanceof FieldElementBox){if(inline.formFieldData instanceof TextFormField){data.formFieldType="Text";}else if(inline.formFieldData instanceof CheckBoxFormField){data.formFieldType="CheckBox";}else if(inline.formFieldData instanceof DropDownFormField){data.formFieldType="DropDown";}}}if(field instanceof FieldElementBox&&isCrossRefField){data.canUpdateField=true;}}if(this.documentHelper.owner.selection.start.paragraph.isInsideTable&&this.documentHelper.owner.selection.end.paragraph.isInsideTable){data.isTable=true;if(this.editor.canMergeCells()){data.canMergeCells=true;}data.isTableSelected=this.documentHelper.selection.isTableSelected();}else{data.isFont=contextTypeInternal!=='Image'?true:false;}if(this.enableTrackChanges&&this.documentHelper.selection.hasRevisions()){data.canAcceptChange=true;}data.isElementBox=this.isSpellCheck&&this.hasElementBox();context.selectionContext=data;context.protectionInfo=this.isContentProtected();return context;};SfDocumentEditor.prototype.fetchImageFormat=function(){var imageFormat={};imageFormat.width=this.selection.imageFormat.width;imageFormat.height=this.selection.imageFormat.height;return imageFormat;};SfDocumentEditor.prototype.fetchCharacterFormat=function(format){var select$$1={};select$$1.bold=format.bold;select$$1.fontSize=format.fontSize;select$$1.fontFamily=format.fontFamily;select$$1.italic=format.italic;select$$1.baselineAlignment=format.baselineAlignment;select$$1.underline=format.underline;select$$1.fontColor=format.fontColor;select$$1.highlightColor=format.highlightColor;select$$1.strikethrough=format.strikethrough;select$$1.allCaps=format.allCaps;return select$$1;};SfDocumentEditor.prototype.fetchParagraphFormat=function(format){var select$$1={};select$$1.leftIndent=format.leftIndent;select$$1.rightIndent=format.rightIndent;select$$1.firstLineIndent=format.firstLineIndent;select$$1.lineSpacing=format.lineSpacing;select$$1.lineSpacingType=format.lineSpacingType;select$$1.textAlignment=format.textAlignment;select$$1.beforeSpacing=format.beforeSpacing;select$$1.afterSpacing=format.afterSpacing;select$$1.bidi=format.bidi;select$$1.keepWithNext=format.keepWithNext;select$$1.keepLinesTogether=format.keepLinesTogether;select$$1.widowControl=format.widowControl;select$$1.contextualSpacing=format.contextualSpacing;select$$1.styleName=format.styleName;if(!sf.base.isNullOrUndefined(format.listFormat)){select$$1.listFormat=this.fetchListFormat(format.listFormat);}return select$$1;};SfDocumentEditor.prototype.fetchListFormat=function(format){var listFormat={};var listIdValue=format.getValue('listId');if(!sf.base.isNullOrUndefined(listIdValue)){listFormat.listId=listIdValue;}var listLevelNumber=format.getValue('listLevelNumber');if(!sf.base.isNullOrUndefined(listLevelNumber)){listFormat.listLevelNumber=listLevelNumber;}return listFormat;};SfDocumentEditor.prototype.fetchTableFormat=function(format){var select$$1={};select$$1.topMargin=format.topMargin;select$$1.bottomMargin=format.bottomMargin;select$$1.leftMargin=format.leftMargin;select$$1.rightMargin=format.rightMargin;select$$1.leftIndent=format.leftIndent;select$$1.background=format.background;select$$1.tableAlignment=format.tableAlignment;select$$1.cellSpacing=format.cellSpacing;select$$1.bidi=format.bidi;select$$1.preferredWidth=format.preferredWidth;select$$1.preferredWidthType=format.preferredWidthType;select$$1.borders=this.getTableBorder();select$$1.shading=this.getTableShading();return select$$1;};SfDocumentEditor.prototype.fetchCellFormat=function(format){var select$$1={};select$$1.topMargin=format.topMargin;select$$1.bottomMargin=format.bottomMargin;select$$1.leftMargin=format.leftMargin;select$$1.rightMargin=format.rightMargin;select$$1.verticalAlignment=format.verticalAlignment;select$$1.background=format.background;select$$1.preferredWidth=format.preferredWidth;select$$1.preferredWidthType=format.preferredWidthType;select$$1.canMerge=this.editor.canMergeCells();select$$1.borders=this.getCellBorder();select$$1.shading=this.getCellShading();return select$$1;};SfDocumentEditor.prototype.fetchRowFormat=function(format){var select$$1={};select$$1.allowBreakAcrossPages=format.allowBreakAcrossPages;select$$1.height=format.height;select$$1.heightType=format.heightType;select$$1.isHeader=format.isHeader;return select$$1;};SfDocumentEditor.prototype.fetchList=function(lists,abstractList){var list={};list.listId=lists.listId;list.sourceListId=lists.sourceListId;list.abstractListId=lists.abstractListId;list.listLength=this.documentHelper.lists.length;list.abstractLength=this.documentHelper.abstractLists.length;//list.abstractList = JSON.parse(this.fetchAbstractList(abstractList));
return JSON.stringify(list);};/**
     * @private
     */SfDocumentEditor.prototype.hasElementBox=function(){var isElementBox=false;this.errorElementInfo=this.spellChecker.findCurretText();if(this.errorElementInfo.element){isElementBox=true;this.spellChecker.currentContextInfo=this.errorElementInfo;this.errorElementInfo=this.spellChecker.retriveText();}return isElementBox;};SfDocumentEditor.prototype.fetchSectionFormat=function(format){var select$$1={};select$$1.topMargin=format.topMargin;select$$1.bottomMargin=format.bottomMargin;select$$1.leftMargin=format.leftMargin;select$$1.rightMargin=format.rightMargin;select$$1.pageHeight=format.pageHeight;select$$1.pageWidth=format.pageWidth;select$$1.footerDistance=format.footerDistance;select$$1.headerDistance=format.headerDistance;select$$1.differentFirstPage=format.differentFirstPage;select$$1.differentOddAndEvenPages=format.differentOddAndEvenPages;return select$$1;};SfDocumentEditor.prototype.fetchStyleValue=function(styleValues){var style={};style.name=styleValues.name;style.type=styleValues.type;style.paragraphFormat=this.fetchParagraphFormat(styleValues.paragraphFormat);style.characterFormat=this.fetchCharacterFormat(styleValues.characterFormat);if(!sf.base.isNullOrUndefined(styleValues.next)){style.next=styleValues.next.name;}if(!sf.base.isNullOrUndefined(styleValues.basedOn)){style.basedOn=styleValues.basedOn.name;}if(!sf.base.isNullOrUndefined(styleValues.link)){style.link=styleValues.link.name;}return JSON.stringify(style);};SfDocumentEditor.prototype.fetchComments=function(){var commentCollec=this.getComments();if(!sf.base.isNullOrUndefined(commentCollec)&&commentCollec.length>0){return JSON.stringify(commentCollec);}return"";};SfDocumentEditor.prototype.getComments=function(replyComments){var commentObj=[];var commentCollec=replyComments?replyComments:this.documentHelper.comments;if(!sf.base.isNullOrUndefined(commentCollec)&&commentCollec.length>0){for(var i=0;i<commentCollec.length;i++){var comment={};var currentComment=commentCollec[i];comment.date=currentComment.date;comment.text=currentComment.text;comment.isReply=currentComment.isReply;comment.isResolved=currentComment.isResolved;comment.author=currentComment.author;comment.initial=currentComment.initial;comment.commentId=currentComment.commentId;comment.userColor=this.documentHelper.getAuthorColor(currentComment.author);if(currentComment.ownerComment&&currentComment.ownerComment.commentId){comment.ownerCommentId=currentComment.ownerComment.commentId;}if(!replyComments){var reply=this.getComments(currentComment.replyComments);if(reply&&reply.length>0){comment.replyComments=reply;}}commentObj.push(comment);}return commentObj;}return undefined;};SfDocumentEditor.prototype.getCellBorder=function(){var cellBorder={};if(!sf.base.isNullOrUndefined(this.selection.start.paragraph.associatedCell)){var border=this.selection.start.paragraph.associatedCell.cellFormat.borders;return this.sfdtExportModule.writeBorders(border);}return cellBorder;};SfDocumentEditor.prototype.getTableBorder=function(){var tableBorder={};if(!sf.base.isNullOrUndefined(this.selection.tableFormat.table)){var border=this.selection.tableFormat.table.tableFormat.borders;return this.sfdtExportModule.writeBorders(border);}return tableBorder;};SfDocumentEditor.prototype.getCellShading=function(){var cellShading={};if(!sf.base.isNullOrUndefined(this.selection.tableFormat.table)){var shading=this.selection.start.paragraph.associatedCell.cellFormat.shading;cellShading.backgroundColor=shading.backgroundColor;cellShading.foregroundColor=shading.foregroundColor;cellShading.textureStyle=shading.textureStyle;}return cellShading;};SfDocumentEditor.prototype.getTableShading=function(){var tableShading={};if(!sf.base.isNullOrUndefined(this.selection.start.paragraph.associatedCell)){var shading=this.selection.start.paragraph.associatedCell.cellFormat.shading;tableShading.backgroundColor=shading.backgroundColor;tableShading.foregroundColor=shading.foregroundColor;tableShading.textureStyle=shading.textureStyle;}return tableShading;};/**
     * @private
     */SfDocumentEditor.prototype.applyCellOption=function(cellFormat){this.documentHelper.owner.editorHistory.initComplexHistory(this.documentHelper.selection,'CellMarginsSelection');this.documentHelper.owner.editorModule.initHistory('CellOptions');/* tslint:disable:max-line-length */if(!sf.base.isNullOrUndefined(this.documentHelper.selection.start.paragraph.associatedCell)){var startTable=this.documentHelper.selection.start.paragraph.associatedCell.ownerTable;startTable=startTable.combineWidget(this.viewer);this.applyCellmarginsValue(this.documentHelper.selection.start.paragraph.associatedCell.ownerRow.combineWidget(this.viewer),this.documentHelper.selection.start,this.documentHelper.selection.end,cellFormat);this.documentHelper.owner.editorModule.reLayout(this.documentHelper.selection,false);if(!sf.base.isNullOrUndefined(this.documentHelper.owner.editorHistory.currentHistoryInfo)){this.documentHelper.owner.editorHistory.updateComplexHistory();}}};SfDocumentEditor.prototype.applyCellmarginsValue=function(row,start,end,cellFormat){this.applyCellMarginsInternal(row,cellFormat);if(end.paragraph.associatedCell.ownerRow===row){return;}var newRow=row.nextWidget;if(!sf.base.isNullOrUndefined(newRow)){this.applyCellmarginsValue(newRow,start,end,cellFormat);}};SfDocumentEditor.prototype.applyCellMarginsInternal=function(row,cellFormat){if(!sf.base.isNullOrUndefined(this.documentHelper.owner.editorHistory.currentBaseHistoryInfo)){var currentFormat=row.childWidgets[0].cellFormat;/* tslint:disable:max-line-length */cellFormat=this.documentHelper.owner.editorHistory.currentBaseHistoryInfo.addModifiedCellOptions(currentFormat,cellFormat,row.ownerTable);}if(!sf.base.isNullOrUndefined(cellFormat)){this.applyCellMarginsForCells(row,cellFormat);}};SfDocumentEditor.prototype.applyCellMarginsForCells=function(row,cellFormat){var cells=row.childWidgets;for(var i=0;i<cells.length;i++){this.applySubCellMargins(cells[i].cellFormat,cellFormat);}this.calculateGridValue(cells[0].ownerTable);};SfDocumentEditor.prototype.applySubCellMargins=function(sourceFormat,cellFormat){sourceFormat.leftMargin=cellFormat.leftMargin;sourceFormat.topMargin=cellFormat.topMargin;sourceFormat.rightMargin=cellFormat.rightMargin;sourceFormat.bottomMargin=cellFormat.bottomMargin;};SfDocumentEditor.prototype.calculateGridValue=function(table){table.calculateGrid();table.isGridUpdated=false;table.buildTableColumns();table.isGridUpdated=true;this.documentHelper.selection.owner.isLayoutEnabled=true;this.documentHelper.layout.reLayoutTable(table);this.documentHelper.owner.editorModule.reLayout(this.documentHelper.selection);this.documentHelper.owner.editorModule.updateSelectionTextPosition(true);var history=this.documentHelper.owner.editorHistory;if(history&&history.currentBaseHistoryInfo){if(history.currentBaseHistoryInfo.modifiedProperties.length>0){history.currentBaseHistoryInfo.updateSelection();}history.updateHistory();}this.documentHelper.owner.editorModule.fireContentChange();};/**
     * @private
     */SfDocumentEditor.prototype.applyTableOption=function(tableFormat){this.documentHelper.owner.editorHistory.initComplexHistory(this.documentHelper.selection,'TableMarginsSelection');this.documentHelper.owner.editorModule.initHistory('TableOptions');if(!sf.base.isNullOrUndefined(this.documentHelper.selection.start.currentWidget.paragraph.associatedCell)){var ownerTable=this.documentHelper.selection.start.currentWidget.paragraph.associatedCell.ownerTable;ownerTable=ownerTable.combineWidget(this.viewer);var currentTableFormat=ownerTable.tableFormat;if(!sf.base.isNullOrUndefined(this.documentHelper.owner.editorHistory.currentBaseHistoryInfo)){this.documentHelper.owner.editorHistory.currentBaseHistoryInfo.addModifiedTableOptions(currentTableFormat);}currentTableFormat.cellSpacing=tableFormat.cellSpacing;currentTableFormat.leftMargin=tableFormat.leftMargin;currentTableFormat.topMargin=tableFormat.topMargin;currentTableFormat.rightMargin=tableFormat.rightMargin;currentTableFormat.bottomMargin=tableFormat.bottomMargin;this.calculateGridValue(ownerTable);if(!sf.base.isNullOrUndefined(this.documentHelper.owner.editorHistory.currentHistoryInfo)){this.documentHelper.owner.editorHistory.updateComplexHistory();}}};/**
     * @private
     */SfDocumentEditor.prototype.applyTableProperties=function(tableFormat,rowFormat,cellFormat){this.documentHelper.owner.editorModule.initComplexHistory('TableProperties');this.documentHelper.owner.editorModule.onTableFormat(tableFormat);this.documentHelper.owner.editorModule.onRowFormat(rowFormat);this.documentHelper.owner.editorModule.onCellFormat(cellFormat);this.documentHelper.owner.editorHistory.updateComplexHistory();};/**
     * @private
     */SfDocumentEditor.prototype.enableRepeatHeader=function(){var selection=this.documentHelper.selection;var start=selection.start;var end=selection.end;if(!selection.isForward){start=selection.end;end=selection.start;}var startCell=start.paragraph.associatedCell;var endCell=end.paragraph.associatedCell;return startCell.ownerRow.index===0&&endCell.ownerTable.equals(startCell.ownerTable);};/**
     * @private
     */SfDocumentEditor.prototype.fireZoomFactorChange=function(){this.dotNetRef.invokeMethodAsync('ZoomFactorChange',this.documentHelper.zoomFactor);// let eventArgs: ZoomFactorChangeEventArgs = { source: isBlazor() ? null : this };
// this.trigger('zoomFactorChange', eventArgs);
};/**
     * @private
     */SfDocumentEditor.prototype.fireBeformFieldFill=function(){// let eventArgs: FormFieldFillEventArgs = {};
// this.trigger('beforeFieldFill', eventArgs);
};/**
     * @private
     */SfDocumentEditor.prototype.fireAfterFormFieldFill=function(){// let eventArgs: FormFieldFillEventArgs = {};
// this.trigger('afterFieldFill', eventArgs);
};/**
     * @private
     */SfDocumentEditor.prototype.fireServiceFailure=function(eventArgs){// this.trigger('serviceFailure', eventArgs);
};/**
     * @private
     */SfDocumentEditor.prototype.fireViewChange=function(){if(this.viewer&&this.documentHelper.pages.length>0){if(this.viewer.visiblePages.length>0){var pages=this.viewer.visiblePages;var eventArgs={startPage:pages[0].index+1,endPage:pages[pages.length-1].index+1};this.dotNetRef.invokeMethodAsync('ViewChange',JSON.stringify(eventArgs));}}};/**
     * @private
     */SfDocumentEditor.prototype.fireCustomContextMenuSelect=function(item){// let eventArgs: CustomContentMenuEventArgs = { id: item };
// this.trigger('customContextMenuSelect', eventArgs);
};/**
     * @private
     */SfDocumentEditor.prototype.fireCustomContextMenuBeforeOpen=function(item){// let eventArgs: BeforeOpenCloseCustomContentMenuEventArgs = { ids: item };
// this.trigger('customContextMenuBeforeOpen', eventArgs);
};/**
     * Shows the Paragraph dialog
     * @private
     */SfDocumentEditor.prototype.showParagraphDialog=function(paragraphFormat){// if (this.paragraphDialogModule && !this.isReadOnlyMode && this.viewer) {
//     this.paragraphDialogModule.show(paragraphFormat);
// }
};/**
     * Shows the margin dialog
     * @private
     */SfDocumentEditor.prototype.showPageSetupDialog=function(){// if (this.pageSetupDialogModule && !this.isReadOnlyMode && this.viewer) {
//     this.pageSetupDialogModule.show();
// }
};/**
     * Shows the font dialog
     * @private
     */SfDocumentEditor.prototype.showFontDialog=function(characterFormat){// if (this.fontDialogModule && !this.isReadOnlyMode && this.viewer) {
//     this.fontDialogModule.showFontDialog(characterFormat);
// }
};/**
     * Shows the cell option dialog
     * @private
     */SfDocumentEditor.prototype.showCellOptionsDialog=function(){// if (this.cellOptionsDialogModule && !this.isReadOnlyMode && this.viewer) {
//     this.cellOptionsDialogModule.show();
// }
};/**
     * Shows the table options dialog.
     * @private
     */SfDocumentEditor.prototype.showTableOptionsDialog=function(){// if (this.tableOptionsDialogModule && !this.isReadOnlyMode && this.viewer) {
//     this.tableOptionsDialogModule.show();
// }
};/**
     * Shows insert table dialog
     * @private
     */SfDocumentEditor.prototype.showTableDialog=function(){// if (this.tableDialogModule && !this.isReadOnlyMode && this.viewer) {
//     this.tableDialogModule.show();
// }
};/**
     * Shows the table of content dialog
     * @private
     */SfDocumentEditor.prototype.showTableOfContentsDialog=function(){// if (this.tableOfContentsDialogModule && !this.isReadOnlyMode && this.viewer) {
//     this.tableOfContentsDialogModule.show();
// }
};/**
     * Shows the style dialog
     * @private
     */SfDocumentEditor.prototype.showStyleDialog=function(){// if (this.styleDialogModule && !this.isReadOnlyMode && this.viewer) {
//     this.styleDialogModule.show();
// }
};/**
     * Shows the hyperlink dialog
     * @private
     */SfDocumentEditor.prototype.showHyperlinkDialog=function(){// if (this.hyperlinkDialogModule && !this.isReadOnlyMode && this.viewer) {
//     this.hyperlinkDialogModule.show();
// }
};/**
     * Shows the bookmark dialog.
     * @private
     */SfDocumentEditor.prototype.showBookmarkDialog=function(){// if (this.bookmarkDialogModule && !this.isReadOnlyMode && this.viewer) {
//     this.bookmarkDialogModule.show();
// }
};/**
     * Shows the styles dialog.
     * @private
     */SfDocumentEditor.prototype.showStylesDialog=function(){// if (this.stylesDialogModule && !this.isReadOnlyMode && this.viewer) {
//     this.stylesDialogModule.show();
// }
};/**
     * Shows the List dialog
     * @private
     */SfDocumentEditor.prototype.showListDialog=function(){// if (this.listDialogModule && !this.isReadOnlyMode && this.viewer) {
//     this.listDialogModule.showListDialog();
// }
};/**
     * Shows the table properties dialog
     * @private
     */SfDocumentEditor.prototype.showTablePropertiesDialog=function(){// if (this.tablePropertiesDialogModule && !this.isReadOnlyMode && this.viewer) {
//     this.tablePropertiesDialogModule.show();
// }
};/**
     * Shows the borders and shading dialog
     * @private
     */SfDocumentEditor.prototype.showBordersAndShadingDialog=function(){// if (this.bordersAndShadingDialogModule && !this.isReadOnlyMode && this.viewer) {
//     this.bordersAndShadingDialogModule.show();
// }
};//tslint:disable: max-func-body-length
SfDocumentEditor.prototype.requiredModules=function(){// debugger;
this.parser=new SfdtReader(this.documentHelper);if(this.enablePrint){if(sf.base.isNullOrUndefined(this.printModule)){this.printModule=new Print();}}if(this.enableSfdtExport||this.enableWordExport||this.enableTextExport||this.enableSelection||this.enableEditor){if(sf.base.isNullOrUndefined(this.sfdtExportModule)){this.sfdtExportModule=new SfdtExport(this.documentHelper);}}if(this.enableWordExport){if(sf.base.isNullOrUndefined(this.wordExportModule)){this.wordExportModule=new WordExport();}}if(this.enableTextExport){if(sf.base.isNullOrUndefined(this.textExportModule)){this.textExportModule=new TextExport();}}if(this.enableSelection||this.enableSearch||this.enableEditor){if(sf.base.isNullOrUndefined(this.selectionModule)){this.selectionModule=new Selection(this);}if(this.enableContextMenu){// modules.push({
//     member: 'ContextMenu', args: [this.documentHelper]
// });
}}if(this.enableSearch){if(sf.base.isNullOrUndefined(this.searchModule)){this.searchModule=new Search(this);}if(this.enableOptionsPane){if(sf.base.isNullOrUndefined(this.optionsPaneModule)){this.optionsPaneModule=new OptionsPane();}}}if(!sf.base.isNullOrUndefined(this.documentEditorSettings)){if(this.documentEditorSettings.enableOptimizedTextMeasuring){this.textMeasureHelper=new Optimized(this.documentHelper);}else{this.textMeasureHelper=new Regular(this.documentHelper);}}if(this.enableEditor){if(sf.base.isNullOrUndefined(this.editorModule)){this.editorModule=new Editor(this.documentHelper);}if(this.enableImageResizer){if(sf.base.isNullOrUndefined(this.imageResizerModule)){this.imageResizerModule=new ImageResizer(this,this.documentHelper);}}if(this.enableEditorHistory){if(sf.base.isNullOrUndefined(this.editorHistoryModule)){this.editorHistoryModule=new EditorHistory(this);}}if(this.enableHyperlinkDialog){// modules.push({
//     member: 'HyperlinkDialog', args: [this.documentHelper]
// });
}if(this.enableTableDialog){// modules.push({
//     member: 'TableDialog', args: [this.documentHelper]
// });
}if(this.enableBookmarkDialog){// modules.push({
//     member: 'BookmarkDialog', args: [this.documentHelper]
// });
}if(this.enableTableOfContentsDialog){// modules.push({
//     member: 'TableOfContentsDialog', args: [this.documentHelper]
// });
}if(this.enablePageSetupDialog){// modules.push({
//     member: 'PageSetupDialog', args: [this.documentHelper]
// });
}if(this.enableStyleDialog){// modules.push({
//     member: 'StylesDialog', args: [this.documentHelper]
// });
// modules.push({
//     member: 'StyleDialog', args: [this.documentHelper]
// });
// modules.push({
//     member: 'BulletsAndNumberingDialog', args: [this.documentHelper]
// });
}if(this.enableListDialog){// modules.push({
//     member: 'ListDialog', args: [this.documentHelper]
// });
}if(this.enableParagraphDialog){// modules.push({
//     member: 'ParagraphDialog', args: [this.documentHelper]
// });
}if(this.enableFontDialog){// modules.push({
//     member: 'FontDialog', args: [this.documentHelper]
// });
}if(this.enableTablePropertiesDialog){// modules.push({
//     member: 'TablePropertiesDialog', args: [this.documentHelper]
// });
// modules.push({
//     member: 'CellOptionsDialog', args: [this.documentHelper]
// });
}if(this.enableBordersAndShadingDialog){// modules.push({
//     member: 'BordersAndShadingDialog', args: [this.documentHelper]
// });
}if(this.enableTableOptionsDialog){// modules.push({
//     member: 'TableOptionsDialog', args: [this.documentHelper]
// });
}if(this.enableSpellCheck){// modules.push({
//     member: 'SpellChecker', args: [this.documentHelper]
// });
// modules.push({
//     member: 'SpellCheckDialog', args: [this.documentHelper]
// });
}if(this.enableFormField){// modules.push({
//     member: 'TextFormFieldDialog', args: [this]
// });
// modules.push({
//     member: 'DropDownFormFieldDialog', args: [this]
// });
// modules.push({
//     member: 'CheckBoxFormFieldDialog', args: [this]
// });
}}};// Public Implementation Starts
/**
     * Opens the given Sfdt text.
     * @param {string} sfdtText.
     */SfDocumentEditor.prototype.open=function(sfdtText){if(!sf.base.isNullOrUndefined(this.viewer)){this.showComments=false;this.clearPreservedCollectionsInViewer();this.documentHelper.userCollection.push('Everyone');this.documentHelper.lists=[];this.documentHelper.abstractLists=[];this.documentHelper.styles=new WStyles();this.documentHelper.cachedPages=[];this.showRevisions=false;if(this.isSpellCheck&&!this.spellChecker.enableOptimizedSpellCheck){this.documentHelper.triggerElementsOnLoading=true;this.documentHelper.triggerSpellCheck=true;}if(!sf.base.isNullOrUndefined(sfdtText)&&this.viewer){this.documentHelper.setDefaultDocumentFormat();this.documentHelper.onDocumentChanged(this.parser.convertJsonToDocument(sfdtText));if(this.editorModule){this.editorModule.intializeDefaultStyles();}}if(this.isSpellCheck&&!this.spellChecker.enableOptimizedSpellCheck){this.documentHelper.triggerElementsOnLoading=false;this.documentHelper.triggerSpellCheck=false;}}};/**
     * Scrolls view to start of the given page number if exists.
     * @param  {number} pageNumber.
     * @returns void
     */SfDocumentEditor.prototype.scrollToPage=function(pageNumber){if(sf.base.isNullOrUndefined(this.viewer)||pageNumber<1||pageNumber>this.documentHelper.pages.length){return false;}this.viewer.scrollToPage(pageNumber-1);return true;};/**
     * Enables all the modules.
     * @returns void
     */SfDocumentEditor.prototype.enableAllModules=function(){this.enablePrint=this.enableSfdtExport=this.enableWordExport=this.enableTextExport=this.enableSelection=this.enableContextMenu=this.enableSearch=this.enableOptionsPane=this.enableEditor=this.enableImageResizer=this.enableEditorHistory=this.enableHyperlinkDialog=this.enableTableDialog=this.enableBookmarkDialog=this.enableTableOfContentsDialog=this.enablePageSetupDialog=this.enableStyleDialog=this.enableListDialog=this.enableParagraphDialog=this.enableFontDialog=this.enableTablePropertiesDialog=this.enableBordersAndShadingDialog=this.enableTableOptionsDialog=this.enableComment=this.enableFormField=true;this.requiredModules();};/**
     * Resizes the component and its sub elements based on given size or container size.
     * @param width
     * @param height
     */SfDocumentEditor.prototype.resize=function(width,height){if(this.element){if(!sf.base.isNullOrUndefined(width)&&width>200){this.element.style.width=width+'px';}if(!sf.base.isNullOrUndefined(height)&&height>200){this.element.style.height=height+'px';}}if(this.documentHelper){this.documentHelper.updateViewerSize();}};/**
     * Get all form field names.
     */SfDocumentEditor.prototype.getFormFieldNames=function(){var formFieldNames=[];var formFields=this.documentHelper.formFields;for(var i=0;i<formFields.length;i++){if(formFields[i].formFieldData.name!==''){formFieldNames.push(formFields[i].formFieldData.name);}}return formFieldNames;};/**
     * Get form field by name
     * @param name - Form field name.
     */SfDocumentEditor.prototype.getFormFieldInfo=function(name){var formFields=this.documentHelper.formFields;for(var i=0;i<formFields.length;i++){if(formFields[i].formFieldData.name===name&&formFields[i].formFieldData.name!==''){return formFields[i].formFieldData.getFormFieldInfo();}}return undefined;};/**
     * Set form field.
     * @param name - Form field name.
     * @param formFieldInfo - Form Field info
     */SfDocumentEditor.prototype.setFormFieldInfo=function(name,formFieldInfo){var formFields=this.documentHelper.formFields;for(var i=0;i<formFields.length;i++){if(formFields[i].formFieldData.name===name&&formFields[i].formFieldData.name!==''){var currentField=formFields[i];if(this.selection){this.selection.selectFieldInternal(currentField);if(this.editor){this.editor.setFormField(currentField,formFieldInfo);}}return;}}};/**
     * Reset form field value to default.
     * @param name - specify form field name
     */SfDocumentEditor.prototype.resetFormFields=function(name){var formFields=this.documentHelper.formFields;for(var i=0;i<formFields.length;i++){if(sf.base.isNullOrUndefined(name)||name===formFields[i].formFieldData.name){if(formFields[i].formFieldData instanceof TextFormField){this.editor.updateFormField(formFields[i],formFields[i].formFieldData.defaultValue,true);}else if(formFields[i].formFieldData instanceof CheckBoxFormField){// tslint:disable-next-line:max-line-length
this.editor.toggleCheckBoxFormField(formFields[i],true,formFields[i].formFieldData.defaultValue);}else if(formFields[i].formFieldData instanceof DropDownFormField){this.editor.updateFormField(formFields[i],0,true);}}}};/**
     * Import form field values.
     * @param - formDate  - { FormFieldData[] }
     */SfDocumentEditor.prototype.importFormData=function(formData){var formField=this.documentHelper.formFields;for(var i=0;i<formData.length;i++){var formFieldData=formData[i];var fieldName=formFieldData.fieldName;for(var j=0;j<formField.length;j++){if(formField[j].formFieldData.name===fieldName){if(formField[j].formFieldData instanceof CheckBoxFormField){this.editor.toggleCheckBoxFormField(formField[j],true,formFieldData.value);}else if(formField[j].formFieldData instanceof TextFormField){this.editor.updateFormField(formField[j],formFieldData.value);}else if(formField[j].formFieldData instanceof DropDownFormField){this.editor.updateFormField(formField[j],formFieldData.value);}}}}};/**
     * Export form field values.
     * @returns - { FormFieldData[] }
     */SfDocumentEditor.prototype.exportFormData=function(){var data=[];var formField=this.documentHelper.formFields;for(var i=0;i<formField.length;i++){if(formField[i].formFieldData.name!==''){var formData={fieldName:'',value:''};formData.fieldName=formField[i].formFieldData.name;if(formField[i].formFieldData instanceof CheckBoxFormField){// tslint:disable-next-line:max-line-length
formData.value=formField[i].formFieldData.checked;}else if(formField[i].formFieldData instanceof TextFormField){var resultText='';// if (this.documentHelper.isInlineFormFillProtectedMode) {
//     resultText = this.editorModule.getFormFieldText(formField[i]);
// } else {
//     resultText = formField[i].resultText;
// }
var rex=new RegExp(this.documentHelper.textHelper.getEnSpaceCharacter(),'gi');if(resultText.replace(rex,'')===''){resultText='';}formData.value=resultText;}else if(formField[i].formFieldData instanceof DropDownFormField){// tslint:disable-next-line:max-line-length
formData.value=formField[i].formFieldData.selectedIndex;}data.push(formData);}}return data;};/**
     * Updated fields in document.
     * Currently cross reference field only supported.
     */SfDocumentEditor.prototype.updateFields=function(){for(var i=0;i<this.documentHelper.fields.length;i++){var field=this.documentHelper.fields[i];var code=this.selection.getFieldCode(field);if(code.toLowerCase().trim().indexOf('ref ')===0){this.selection.updateRefField(field);}}};/**
     * Shifts the focus to the document.
     */SfDocumentEditor.prototype.focusIn=function(){if(this.viewer){this.documentHelper.updateFocus();}};/**
     * Fits the page based on given fit type.
     * @param  {PageFitType} pageFitType? - Default value of pageFitType parameter is 'None'
     * @returns void
     */SfDocumentEditor.prototype.fitPage=function(pageFitType){if(sf.base.isNullOrUndefined(pageFitType)){pageFitType='None';}if(this.viewer){this.viewer.pageFitType=pageFitType;}};/**
     * Prints the document.
     * @param  {Window} printWindow? - Default value of 'printWindow' parameter is undefined.
     */SfDocumentEditor.prototype.print=function(printWindow){if(sf.base.isNullOrUndefined(this.viewer)){throw new Error('Invalid operation.');}if(this.printModule){if(this.layoutType==='Continuous'){this.documentHelper.isWebPrinting=true;this.viewer=new PageLayoutViewer(this);this.editor.layoutWholeDocument();this.printModule.print(this.documentHelper,printWindow);this.viewer=new WebLayoutViewer(this);this.editor.layoutWholeDocument();this.documentHelper.isWebPrinting=false;}else{this.printModule.print(this.documentHelper,printWindow);}}else{throw new Error('Invalid operation. Print is not enabled.');}};/**
     * Serialize the data to JSON string.
     */SfDocumentEditor.prototype.serialize=function(){var json='';if(this.enableSfdtExport&&this.sfdtExportModule instanceof SfdtExport){json=this.sfdtExportModule.serialize();}else{throw new Error('Invalid operation. Sfdt export is not enabled.');}return json;};/**
     * Saves the document.
     * @param {string} fileName
     * @param {FormatType} formatType
     */SfDocumentEditor.prototype.save=function(fileName,formatType){fileName=fileName||'Untitled';if(sf.base.isNullOrUndefined(this.documentHelper)){throw new Error('Invalid operation.');}if(formatType==='Docx'&&this.wordExportModule){if(this.wordExportModule){this.wordExportModule.save(this.documentHelper,fileName);}}else if(formatType==='Txt'&&this.textExportModule){this.textExportModule.save(this.documentHelper,fileName);}else if(formatType==='Sfdt'&&this.enableSfdtExport&&this.sfdtExportModule){var jsonString=this.serialize();var blob=new Blob([jsonString],{type:'application/json'});sf.fileutils.Save.save(fileName+'.sfdt',blob);}else{throw new Error('Invalid operation. Specified export is not enabled.');}};/**
     * Saves the document as blob.
     * @param {FormatType} formatType
     */SfDocumentEditor.prototype.saveAsBlob=function(formatType){var _this=this;if(sf.base.isNullOrUndefined(this.viewer)){throw new Error('Invalid operation');}return new Promise(function(resolve,reject){if(formatType==='Docx'&&_this.wordExportModule){resolve(_this.wordExportModule.saveAsBlob(_this.documentHelper));}else if(formatType==='Txt'&&_this.textExportModule){resolve(_this.textExportModule.saveAsBlob(_this.documentHelper));}else if(formatType==='Sfdt'&&_this.enableSfdtExport&&_this.sfdtExportModule){resolve(_this.sfdtExportModule.saveAsBlob(_this.documentHelper));}});};/**
     * Opens a blank document.
     */SfDocumentEditor.prototype.openBlank=function(){// debugger;
var section=new BodyWidget();section.index=0;section.sectionFormat=new WSectionFormat(section);if(this.sectionFormat){this.parser.parseSectionFormat(this.sectionFormat,section.sectionFormat);}var paragraph=new ParagraphWidget();paragraph.index=0;paragraph.paragraphFormat=new WParagraphFormat(paragraph);paragraph.characterFormat=new WCharacterFormat(paragraph);section.childWidgets.push(paragraph);paragraph.containerWidget=section;var sections=[];sections.push(section);// tslint:disable-next-line:max-line-length
var hfs=this.parser.parseHeaderFooter({header:{},footer:{},evenHeader:{},evenFooter:{},firstPageHeader:{},firstPageFooter:{}},undefined);if(this.viewer){this.clearPreservedCollectionsInViewer();this.documentHelper.userCollection.push('Everyone');this.documentHelper.cachedPages=[];this.documentHelper.setDefaultDocumentFormat();this.documentHelper.headersFooters.push(hfs);if(this.editorModule){this.editorModule.intializeDefaultStyles();var style=this.documentHelper.styles.findByName('Normal');paragraph.paragraphFormat.baseStyle=style;paragraph.paragraphFormat.listFormat.baseStyle=style;}this.documentHelper.onDocumentChanged(sections);}};/**
     * Gets the style names based on given style type.
     * @param styleType
     */SfDocumentEditor.prototype.getStyleNames=function(styleType){if(this.viewer){return this.documentHelper.styles.getStyleNames(styleType);}return[];};/**
     * Gets the style objects on given style type.
     * @param styleType
     */SfDocumentEditor.prototype.getStyles=function(styleType){if(this.viewer){return this.documentHelper.styles.getStyles(styleType);}return[];};/**
     * Gets the bookmarks.
     */SfDocumentEditor.prototype.getBookmarks=function(){var bookmarks=[];if(this.viewer){bookmarks=this.documentHelper.getBookmarks(true);}return bookmarks;};/**
     * Shows the dialog.
     * @param {DialogType} dialogType
     * @returns void
     */SfDocumentEditor.prototype.showDialog=function(dialogType){this.dotNetRef.invokeMethodAsync("ShowDialog",dialogType);};/**
     * Shows the options pane.
     */SfDocumentEditor.prototype.showOptionsPane=function(){// if (!isNullOrUndefined(this.optionsPaneModule) && !isNullOrUndefined(this.viewer)) {
//     this.optionsPaneModule.showHideOptionsPane(true);
// }
};/**
     * Shows the restrict editing pane.
     */SfDocumentEditor.prototype.showRestrictEditingPane=function(){// if (this.documentHelper && this.documentHelper.restrictEditingPane) {
//     this.documentHelper.restrictEditingPane.showHideRestrictPane(true);
// }
};/**
     * Destroys all managed resources used by this object.
     */SfDocumentEditor.prototype.destroy=function(){// super.destroy();
this.destroyDependentModules();if(!sf.base.isNullOrUndefined(this.documentHelper)){this.documentHelper.destroy();}this.viewer=undefined;// if (!isNullOrUndefined(this.element)) {
//     this.element.classList.remove('e-documenteditor');
//     this.element.innerHTML = '';
// }
// this.element = undefined;
this.findResultsList=[];this.findResultsList=undefined;};/* tslint:disable */SfDocumentEditor.prototype.destroyDependentModules=function(){if(this.printModule){this.printModule.destroy();this.printModule=undefined;}if(this.sfdtExportModule){this.sfdtExportModule.destroy();this.sfdtExportModule=undefined;}if(this.optionsPaneModule){// this.optionsPaneModule.destroy();
this.optionsPaneModule=undefined;}// if (this.commentReviewPane) {
//     this.commentReviewPane.destroy();
//     this.commentReviewPane = undefined;
// }
if(this.trackChangesPane){this.trackChangesPane.destroy();this.trackChangesPane=undefined;}// if (!isNullOrUndefined(this.hyperlinkDialogModule)) {
//     this.hyperlinkDialogModule.destroy();
//     this.hyperlinkDialogModule = undefined;
// }
if(this.searchModule){this.searchModule.destroy();this.searchModule=undefined;}// if (this.contextMenuModule) {
//     this.contextMenuModule.destroy();
//     this.contextMenuModule = undefined;
// }
if(this.editorModule){this.editorModule.destroy();this.editorModule=undefined;}if(this.selectionModule){this.selectionModule.destroy();this.selectionModule=undefined;}if(this.editorHistoryModule){this.editorHistoryModule.destroy();this.editorHistoryModule=undefined;}// if (!isNullOrUndefined(this.paragraphDialogModule)) {
//     this.paragraphDialogModule.destroy();
//     this.paragraphDialogModule = undefined;
// }
// if (this.pageSetupDialogModule) {
//     this.pageSetupDialogModule.destroy();
//     this.pageSetupDialogModule = undefined;
// }
// if (this.fontDialogModule) {
//     this.fontDialogModule.destroy();
//     this.fontDialogModule = undefined;
// }
// if (this.listDialogModule) {
//     this.listDialogModule.destroy();
//     this.listDialogModule = undefined;
// }
// if (this.imageResizerModule) {
//     this.imageResizerModule.destroy();
//     this.imageResizerModule = undefined;
// }
// if (this.tablePropertiesDialogModule) {
//     this.tablePropertiesDialogModule.destroy();
//     this.tablePropertiesDialogModule = undefined;
// }
// if (this.bordersAndShadingDialogModule) {
//     this.bordersAndShadingDialogModule.destroy();
//     this.bordersAndShadingDialogModule = undefined;
// }
// if (this.cellOptionsDialogModule) {
//     this.cellOptionsDialogModule.destroy();
//     this.cellOptionsDialogModule = undefined;
// }
// if (this.tableOptionsDialogModule) {
//     this.tableOptionsDialogModule.destroy();
//     this.tableOptionsDialogModule = undefined;
// }
// if (this.tableDialogModule) {
//     this.tableDialogModule.destroy();
//     this.tableDialogModule = undefined;
// }
// if (this.styleDialogModule) {
//     this.styleDialogModule = undefined;
// }
// if (this.bookmarkDialogModule) {
//     this.bookmarkDialogModule.destroy();
//     this.bookmarkDialogModule = undefined;
// }
// if (this.styleDialogModule) {
//     this.styleDialogModule.destroy();
//     this.styleDialogModule = undefined;
// }
if(this.textExportModule){this.textExportModule.destroy();this.textExportModule=undefined;}if(this.wordExportModule){this.wordExportModule.destroy();this.wordExportModule=undefined;}// if (this.tableOfContentsDialogModule) {
//     this.tableOfContentsDialogModule.destroy();
//     this.tableOfContentsDialogModule = undefined;
// }
if(this.spellCheckerModule){this.spellCheckerModule.destroy();this.spellCheckerModule=undefined;}};return SfDocumentEditor;}();var __awaiter=undefined&&undefined.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value);}).then(fulfilled,rejected);}step((generator=generator.apply(thisArg,_arguments||[])).next());});};var __generator=undefined&&undefined.__generator||function(thisArg,body){var _={label:0,sent:function sent(){if(t[0]&1)throw t[1];return t[1];},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this;}),g;function verb(n){return function(v){return step([n,v]);};}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_){try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue;}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break;}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break;}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break;}if(t[2])_.ops.pop();_.trys.pop();continue;}op=body.call(thisArg,_);}catch(e){op=[6,e];y=0;}finally{f=t=0;}}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true};}};var DocumentEditor={sendHandler:null,info:null,isSpellChecking:null,elementRef:null,dotnetRef:null,initialize:function initialize(element,options,dotnetRef){sf.base.enableBlazorMode();var docEdit=new SfDocumentEditor(element,dotnetRef,options);docEdit.preRender();docEdit.render();this.elementRef=element;this.dotnetRef=dotnetRef;this.sendHandler=XmlHttpRequestHandler.prototype.send;XmlHttpRequestHandler.prototype.send=this.docEditRequestHandler.bind(this);},updateOptions:function updateOptions(element,options,dotnetRef){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){var instance=element.blazor__instance;instance.setOptions(options,instance.options,true);instance.options=options;}},docEditRequestHandler:function docEditRequestHandler(jsonObject){return __awaiter(this,void 0,void 0,function(){var value,pastedContent,result;return __generator(this,function(_a){switch(_a.label){case 0:if(!(typeof jsonObject==='string'))return[3/*break*/,1];value=JSON.parse(jsonObject);if(value['LanguageID']!==''){this.sendHandler.call(jsonObject);}return[3/*break*/,3];case 1:jsonObject['action']='SystemClipboard';return[4/*yield*/,this.dotnetRef.invokeMethodAsync('SystemClipboard',jsonObject)];case 2:pastedContent=_a.sent();result={data:JSON.parse(pastedContent)};this.elementRef.blazor__instance.editor.pasteRequestHandler.successHandler(result);_a.label=3;case 3:return[2/*return*/];}});});},openblank:function openblank(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.openBlank();}},loadDocument:function loadDocument(element,content){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.open(content);}},insertTable:function insertTable(element,row,column){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.insertTable(row,column);}},goToHeader:function goToHeader(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.goToHeader();}},goToFooter:function goToFooter(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.goToFooter();}},insertPageNumber:function insertPageNumber(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.insertPageNumber();}},undo:function undo(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editorHistory.undo();}},redo:function redo(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editorHistory.redo();}},updateFields:function updateFields(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.updateFields();}},canUndo:function canUndo(element){var canundo;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){canundo=element.blazor__instance.editorHistory.canUndo();}return canundo;},canRedo:function canRedo(element){var canRedo;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){canRedo=element.blazor__instance.editorHistory.canRedo();}return canRedo;},getBookMarks:function getBookMarks(element){var bookmarks;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){bookmarks=element.blazor__instance.getBookmarks();}return bookmarks;},getText:function getText(element,includeObject){var text=undefined;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){text=element.blazor__instance.selection.getText(includeObject);}return text;},sfdt:function sfdt(element,includeObject){var text=undefined;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){text=element.blazor__instance.selection.sfdt;}return text;},insertHyperlinkInternal:function insertHyperlinkInternal(element,url,displayText,remove,isBookmark){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.insertHyperlinkInternal(url,displayText,remove,isBookmark);}},insertTableOfContents:function insertTableOfContents(element,tableOfContentsSettings){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.insertTableOfContents(tableOfContentsSettings);}},insertText:function insertText(element,text){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.insertText(text);}},applyStyle:function applyStyle(element,style){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.applyStyle(style);}},insertRow:function insertRow(element,value){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.insertRow(value);}},insertColumn:function insertColumn(element,value){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.insertColumn(value);}},deleteTable:function deleteTable(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.deleteTable();}},deleteRow:function deleteRow(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.deleteRow();}},deleteColumn:function deleteColumn(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.deleteColumn();}},canMergeCells:function canMergeCells(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.canMergeCells();}},insertPageBreak:function insertPageBreak(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.insertPageBreak();}},toggleBold:function toggleBold(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.toggleBold();}},toggleItalic:function toggleItalic(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.toggleItalic();}},toggleSubscript:function toggleSubscript(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.toggleSubscript();}},toggleSuperscript:function toggleSuperscript(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.toggleSuperscript();}},toggleUnderline:function toggleUnderline(element,value){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.toggleUnderline(value);}},toggleHighlightColor:function toggleHighlightColor(element,value){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.toggleHighlightColor(value);}},toggleStrikethrough:function toggleStrikethrough(element,value){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.toggleStrikethrough(value);}},toggleTextAlignment:function toggleTextAlignment(element,value){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.toggleTextAlignment(value);}},toggleBaselineAlignment:function toggleBaselineAlignment(element,value){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.toggleBaselineAlignment(value);}},applyBullet:function applyBullet(element,bullet,fontFamily){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.applyBullet(bullet,fontFamily);}},applyNumbering:function applyNumbering(element,numberFormat,value){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.applyNumbering(numberFormat,value);}},paste:function paste(element,value){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.paste(value);}},clearFormatting:function clearFormatting(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.clearFormatting();}},createStyle:function createStyle(element,style){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.createStyle(element.blazor__instance.documentHelper.preDefinedStyles.get(style));}},closeHeaderFooter:function closeHeaderFooter(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.closeHeaderFooter();}},selectAll:function selectAll(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.selectAll();}},selectLine:function selectLine(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.selectLine();}},selectCurrentWord:function selectCurrentWord(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.selectCurrentWord();}},selectParagraph:function selectParagraph(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.selectParagraph();}},selectTable:function selectTable(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.selectTable();}},mergeCells:function mergeCells(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.mergeCells();}},autoFitTable:function autoFitTable(element,fitType){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.autoFitTable(fitType);}},fitPage:function fitPage(element,fitPageType){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.fitPage(fitPageType);}},updateZoomFactor:function updateZoomFactor(element,factor){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.setOptions({"zoomFactor":parseInt(factor,0)/100},{"zoomFactor":element.blazor__instance.options.zoomFactor},false);}},goToPage:function goToPage(element,index){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.goToPage(index);}},extendToWordStart:function extendToWordStart(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.extendToWordStart();}},insertEditingRegion:function insertEditingRegion(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.insertEditingRegion();}},moveToLineStart:function moveToLineStart(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.moveToLineStart();}},insertSectionBreak:function insertSectionBreak(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.insertSectionBreak();}},enforceProtection:function enforceProtection(element,saltValue,hashValue,protectionType){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){var data=[saltValue,hashValue];var result={data:JSON.stringify(data)};element.blazor__instance.editor.enforceProtectionInternal(result,protectionType);}},stopProtection:function stopProtection(element,saltValue,hashValue){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){var data=[saltValue,hashValue];var result={data:JSON.stringify(data)};element.blazor__instance.editor.onUnProtectionSuccess(result);}return element.blazor__instance.documentHelper.isDocumentProtected;},getCurrentSaltValue:function getCurrentSaltValue(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){return element.blazor__instance.documentHelper.saltValue;}return"";},insertEditRangeElement:function insertEditRangeElement(element,userName){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.isHighlightEditRegion=true;element.blazor__instance.editor.insertEditRangeElement(userName);}},removeUserRestrictions:function removeUserRestrictions(element,userName){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.removeUserRestrictions(userName);}},setIsHighlightEditRegion:function setIsHighlightEditRegion(element,isHighlight){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.isHighlightEditRegion=isHighlight;}},navigateNextEditRegion:function navigateNextEditRegion(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.navigateToNextEditingRegion();}},showAllEditingRegion:function showAllEditingRegion(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.showAllEditingRegion();}},deleteComment:function deleteComment(element,comment){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.deleteCommentInternal(this.getComment(element,comment));}},getCurrentEditRangeUser:function getCurrentEditRangeUser(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){if(element.blazor__instance.documentHelper.selection.checkSelectionIsAtEditRegion()){var editRange=element.blazor__instance.documentHelper.selection.getEditRangeStartElement();if(editRange){return editRange.user;}}}return"";},resolveReOpenComment:function resolveReOpenComment(element,comment){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){if(comment.isResolved){element.blazor__instance.editor.resolveComment(this.getComment(element,comment));}else{element.blazor__instance.editor.reopenComment(this.getComment(element,comment));}}},updateCommentText:function updateCommentText(element,comment){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){var commentEle=this.getComment(element,comment);commentEle.text=comment.text;}},addEmptyComment:function addEmptyComment(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.selectComment(element.blazor__instance.editor.insertCommentInternal(''));}},addReplyComment:function addReplyComment(element,parentComment,replyText){var commentJson;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){var commentEle=this.getComment(element,parentComment);element.blazor__instance.editor.replyComment(commentEle,replyText);commentJson=JSON.stringify(element.blazor__instance.editor.getCommentObj(commentEle.replyComments[commentEle.replyComments.length-1]));}return commentJson;},selectComment:function selectComment(element,comment){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){var commentEle=this.getComment(element,comment);element.blazor__instance.selection.selectComment(commentEle);}},updateCommentPaneHeight:function updateCommentPaneHeight(element,reviewPane){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){var tabHeaderHeight=reviewPane.getElementsByClassName('e-tab-header')[0].getBoundingClientRect().height;var toolbarHeight=reviewPane.getElementsByClassName('e-de-cmt-toolbar')[0].getBoundingClientRect().height;var commentArea=reviewPane.getElementsByClassName('e-de-cmt-container')[0];commentArea.style.height=reviewPane.getBoundingClientRect().height-tabHeaderHeight-toolbarHeight+'px';}},setFocusToElement:function setFocusToElement(element,elementRef){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){elementRef.focus();}},updateTextBoxHeight:function updateTextBoxHeight(element,elementRef){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){setTimeout(function(){elementRef.style.height='auto';var scrollHeight=elementRef.scrollHeight;elementRef.style.height=scrollHeight+'px';});}},getComment:function getComment(element,comment){var comments=element.blazor__instance.documentHelper.comments;for(var i=0;i<comments.length;i++){if(comment.isReply){for(var j=0;j<comments[i].replyComments.length;j++){var replyComment=comments[i].replyComments[j];if(replyComment.commentId==comment.commentId){return replyComment;}}}else if(comments[i].commentId==comment.commentId){return comments[i];}}return undefined;},navigateNextComment:function navigateNextComment(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.navigateNextComment();}},navigatePreviousComment:function navigatePreviousComment(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.navigatePreviousComment();}},increaseIndent:function increaseIndent(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.increaseIndent();}},decreaseIndent:function decreaseIndent(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.decreaseIndent();}},insertField:function insertField(element,code){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.insertField(code);}},getIsInField:function getIsInField(element){var isInField;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){isInField=element.blazor__instance.selection.isInField;}return isInField;},insertHyperlink:function insertHyperlink(element,address,displayText){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.insertHyperlink(address,displayText);}},removeHyperlink:function removeHyperlink(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.removeHyperlink();}},insertBookmark:function insertBookmark(element,name){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.insertBookmark(name);}},clearList:function clearList(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.clearList();}},//  EditorHistoryModule()
setRedoLimit:function setRedoLimit(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editorHistory.redoLimit=val;}},getRedoLimit:function getRedoLimit(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.editorHistory.redoLimit;}return result;},setIndex:function setIndex(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){setTimeout(function(){var elementFocus=document.activeElement;element.blazor__instance.searchModule.searchResults.index=val;elementFocus.focus();},10);}},getIndex:function getIndex(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.searchModule.searchResults.index;}return result;},//     SearchModule
findAll:function findAll(element,text,findoption){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.documentHelper.owner.findResultsList=[];element.blazor__instance.searchModule.findAll(text,findoption);if(element.blazor__instance.searchModule.textSearchResults.length>0){element.blazor__instance.searchModule.addFindResultView(element.blazor__instance.searchModule.textSearchResults);return element.blazor__instance.documentHelper.owner.findResultsList;}}return[];},find:function find(element,text,findOption){var result;var results;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.documentHelper.owner.findResultsList=[];result=element.blazor__instance.searchModule.textSearch.findAll(text,findOption);if(!sf.base.isNullOrUndefined(result)){element.blazor__instance.searchModule.addFindResultView(result);results=element.blazor__instance.documentHelper.owner.findResultsList;}}return results;},navigateNextResult:function navigateNextResult(element,text,findOption){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.searchModule.find(text,findOption);}},navigatePreviousResult:function navigatePreviousResult(element,text,findOption){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.searchModule.find(text,findOption);}},replace:function replace(element,findText,replaceText,findOption){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){var documentHelper=element.blazor__instance.documentHelper;var results=documentHelper.owner.searchModule.textSearchResults;if(findText!==''&&!sf.base.isNullOrUndefined(findText)){if(documentHelper.owner.selection!=null){var selectionText=documentHelper.owner.selection.text;if(!documentHelper.owner.selection.isEmpty){if(documentHelper.owner.selection.isForward){documentHelper.owner.selection.selectContent(documentHelper.owner.selection.start,true);}else{documentHelper.owner.selection.selectContent(documentHelper.owner.selection.end,true);}}if(!sf.base.isNullOrUndefined(results)&&!sf.base.isNullOrUndefined(results.currentSearchResult)){var result=results.currentSearchResult;documentHelper.owner.searchModule.navigate(result);if(result.text===selectionText){var replace=sf.base.isNullOrUndefined(replaceText)?'':replaceText;documentHelper.owner.searchModule.replace(replace,result,results);}}}}}},replaceAll:function replaceAll(element,text,findOption){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.searchModule.replaceAllInternal(text,findOption);}},getsearchresults:function getsearchresults(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.searchModule.searchResults;}},clear:function clear(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.searchModule.searchResults.clear;}},//  SelectionCellFormatModule
setBackground:function setBackground(element,color){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.cellFormat.background=color;}},getBackground:function getBackground(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.cellFormat.background;}return result;},setBottomMargin:function setBottomMargin(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.cellFormat.bottomMargin=val;}},getBottomMargin:function getBottomMargin(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.cellFormat.bottomMargin;}return result;},setLeftMargin:function setLeftMargin(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.cellFormat.leftMargin=val;}},getLeftMargin:function getLeftMargin(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.cellFormat.leftMargin;}return result;},setPreferredWidth:function setPreferredWidth(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.cellFormat.preferredWidth=val;}},getPreferredWidth:function getPreferredWidth(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.cellFormat.preferredWidth;}return result;},setRightMargin:function setRightMargin(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.cellFormat.rightMargin=val;}},getRightMargin:function getRightMargin(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.cellFormat.rightMargin;}return result;},setTopMargin:function setTopMargin(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.cellFormat.topMargin=val;}},getTopMargin:function getTopMargin(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.cellFormat.topMargin;}return result;},setPreferredWidthType:function setPreferredWidthType(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.cellFormat.preferredWidthType=val;}},getPreferredWidthType:function getPreferredWidthType(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.cellFormat.preferredWidthType;}return result;},setVerticalAlignment:function setVerticalAlignment(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.cellFormat.verticalAlignment=val;}},getVerticalAlignment:function getVerticalAlignment(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.cellFormat.verticalAlignment;}return result;},//   SelectionImageFormatModule
insertImage:function insertImage(element,imageString,width,height){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.insertImage(imageString,width,height);}},resizeWindow:function resizeWindow(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){setTimeout(function(){element.blazor__instance.resize();},100);}},resize:function resize(element,width,height){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.imageFormat.resize(width,height);}},getImageHeight:function getImageHeight(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.imageFormat.height;}},getImageWidth:function getImageWidth(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.imageFormat.width;}},// SelectionParagraphFormatModule
setAfterSpacing:function setAfterSpacing(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.paragraphFormat.afterSpacing=val;}},getAfterSpacing:function getAfterSpacing(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.paragraphFormat.afterSpacing;}return result;},setBeforeSpacing:function setBeforeSpacing(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.paragraphFormat.beforeSpacing=val;}},getBeforeSpacing:function getBeforeSpacing(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.paragraphFormat.beforeSpacing;}return result;},setBidi:function setBidi(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.paragraphFormat.bidi=val;}},getBidi:function getBidi(element){var bidi;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){bidi=element.blazor__instance.selection.paragraphFormat.bidi;}return bidi;},setContextualSpacing:function setContextualSpacing(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.paragraphFormat.contextualSpacing=val;}},getContextualSpacing:function getContextualSpacing(element){var bidi;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){bidi=element.blazor__instance.selection.paragraphFormat.contextualSpacing;}return bidi;},setFirstLineIndent:function setFirstLineIndent(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.paragraphFormat.firstLineIndent=val;}},getFirstLineIndent:function getFirstLineIndent(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.paragraphFormat.firstLineIndent;}return result;},setLeftIndent:function setLeftIndent(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.paragraphFormat.leftIndent=val;}},getLeftIndent:function getLeftIndent(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.paragraphFormat.leftIndent;}return result;},setLineSpacing:function setLineSpacing(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.paragraphFormat.lineSpacing=val;}},getLineSpacing:function getLineSpacing(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.paragraphFormat.lineSpacing;}return result;},setListLevelNumber:function setListLevelNumber(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.paragraphFormat.listLevelNumber=val;}},getListLevelNumber:function getListLevelNumber(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.paragraphFormat.listLevelNumber;}return result;},setRightIndent:function setRightIndent(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.paragraphFormat.rightIndent=val;}},getRightIndent:function getRightIndent(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.paragraphFormat.rightIndent;}return result;},getListText:function getListText(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.paragraphFormat.listText;}},setLineSpacingType:function setLineSpacingType(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.paragraphFormat.lineSpacingType=val;}},getLineSpacingType:function getLineSpacingType(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.paragraphFormat.lineSpacingType;}return result;},setTextAlignment:function setTextAlignment(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.paragraphFormat.textAlignment=val;}},getTextAlignment:function getTextAlignment(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.paragraphFormat.textAlignment;}return result;},//   SelectionCharacterFormatModule
setBaselineAlignment:function setBaselineAlignment(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.characterFormat.baselineAlignment=val;}},getBaselineAlignment:function getBaselineAlignment(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.characterFormat.baselineAlignment;}return result;},setBold:function setBold(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.characterFormat.bold=val;}},getBold:function getBold(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.characterFormat.bold;}return result;},setItalic:function setItalic(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.characterFormat.italic=val;}},getItalic:function getItalic(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.characterFormat.italic;}return result;},setFontColor:function setFontColor(element,color){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.characterFormat.fontColor=color;}},getFontColor:function getFontColor(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.characterFormat.fontColor;}return result;},setFontFamily:function setFontFamily(element,family){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.characterFormat.fontFamily=family;}},getFontFamily:function getFontFamily(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.characterFormat.fontFamily;}return result;},setFontSize:function setFontSize(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.characterFormat.fontSize=val;}},getFontSize:function getFontSize(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.characterFormat.fontSize;}return result;},setHighlightColor:function setHighlightColor(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.characterFormat.highlightColor=val;}},getHighlightColor:function getHighlightColor(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.characterFormat.highlightColor;}return result;},setStrikethrough:function setStrikethrough(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.characterFormat.strikethrough=val;}},getStrikethrough:function getStrikethrough(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.characterFormat.strikethrough;}return result;},setUnderline:function setUnderline(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.characterFormat.underline=val;}},getUnderline:function getUnderline(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.characterFormat.underline;}return result;},//   SelectionRowFormat
selectRow:function selectRow(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.selectRow();}},setAllowBreakAcrossPages:function setAllowBreakAcrossPages(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.rowFormat.allowBreakAcrossPages=val;}},getAllowBreakAcrossPages:function getAllowBreakAcrossPages(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.rowFormat.allowBreakAcrossPages;}return result;},setIsHeader:function setIsHeader(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.rowFormat.isHeader=val;}},getIsHeader:function getIsHeader(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.rowFormat.isHeader;}return result;},setRowHeight:function setRowHeight(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.rowFormat.height=val;}},getRowHeight:function getRowHeight(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.rowFormat.height;}return result;},setHeightType:function setHeightType(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.rowFormat.heightType=val;}},getHeightType:function getHeightType(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.rowFormat.heightType;}return result;},// SelectionSectionFormatModule
setSectionBottomMargin:function setSectionBottomMargin(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.sectionFormat.bottomMargin=val;}},getSectionBottomMargin:function getSectionBottomMargin(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.sectionFormat.bottomMargin;}return result;},setFooterDistance:function setFooterDistance(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.sectionFormat.footerDistance=val;}},getFooterDistance:function getFooterDistance(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.sectionFormat.footerDistance;}return result;},setHeaderDistance:function setHeaderDistance(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.sectionFormat.headerDistance=val;}},getHeaderDistance:function getHeaderDistance(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.sectionFormat.headerDistance;}return result;},setSectionLeftMargin:function setSectionLeftMargin(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.sectionFormat.leftMargin=val;}},getSectionLeftMargin:function getSectionLeftMargin(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.sectionFormat.leftMargin;}return result;},setPageHeight:function setPageHeight(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.sectionFormat.pageHeight=val;}},getPageHeight:function getPageHeight(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.sectionFormat.pageHeight;}return result;},setPageWidth:function setPageWidth(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.sectionFormat.pageWidth=val;}},getPageWidth:function getPageWidth(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.sectionFormat.pageWidth;}return result;},setSectionRightMargin:function setSectionRightMargin(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.sectionFormat.rightMargin=val;}},getSectionRightMargin:function getSectionRightMargin(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.sectionFormat.rightMargin;}return result;},setSectionTopMargin:function setSectionTopMargin(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.sectionFormat.topMargin=val;}},getSectionTopMargin:function getSectionTopMargin(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.sectionFormat.topMargin;}return result;},setDifferentFirstPage:function setDifferentFirstPage(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.sectionFormat.differentFirstPage=val;}},getDifferentFirstPage:function getDifferentFirstPage(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.sectionFormat.differentFirstPage;}return result;},setDifferentOddAndEvenPages:function setDifferentOddAndEvenPages(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.sectionFormat.differentOddAndEvenPages=val;}},getDifferentOddAndEvenPages:function getDifferentOddAndEvenPages(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.sectionFormat.differentOddAndEvenPages;}return result;},//   SelectionTableFormatModule
setTableBackground:function setTableBackground(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.tableFormat.background=val;}},getTableBackground:function getTableBackground(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.tableFormat.background;}return result;},setTableBottomMargin:function setTableBottomMargin(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.tableFormat.bottomMargin=val;}},getTableBottomMargin:function getTableBottomMargin(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.tableFormat.bottomMargin;}return result;},setTableCellSpacing:function setTableCellSpacing(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.tableFormat.cellSpacing=val;}},getTableCellSpacing:function getTableCellSpacing(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.tableFormat.cellSpacing;}return result;},setTableLeftIndent:function setTableLeftIndent(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.tableFormat.leftIndent=val;}},getTableLeftIndent:function getTableLeftIndent(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.tableFormat.leftIndent;}return result;},setTableLeftMargin:function setTableLeftMargin(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.tableFormat.leftMargin=val;}},getTableLeftMargin:function getTableLeftMargin(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.tableFormat.leftMargin;}return result;},setTablePreferredWidth:function setTablePreferredWidth(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.tableFormat.preferredWidth=val;}},getTablePreferredWidth:function getTablePreferredWidth(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.tableFormat.preferredWidth;}return result;},setTableRightMargin:function setTableRightMargin(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.tableFormat.rightMargin=val;}},getTableRightMargin:function getTableRightMargin(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.tableFormat.rightMargin;}return result;},setTableTopMargin:function setTableTopMargin(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.tableFormat.topMargin=val;}},getTableTopMargin:function getTableTopMargin(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.tableFormat.topMargin;}return result;},setTableBidi:function setTableBidi(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.tableFormat.bidi=val;}},getTableBidi:function getTableBidi(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.tableFormat.bidi;}return result;},setTablePreferredWidthType:function setTablePreferredWidthType(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.tableFormat.preferredWidthType=val;}},getTablePreferredWidthType:function getTablePreferredWidthType(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.tableFormat.preferredWidthType;}return result;},setTableAlignment:function setTableAlignment(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.tableFormat.tableAlignment=val;}},getTableAlignment:function getTableAlignment(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.tableFormat.tableAlignment;}return result;},//list dialog
getListFormat:function getListFormat(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.start.paragraph.paragraphFormat.listFormat;}return result;},getList:function getList(element){var result={};if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.fetchList(element.blazor__instance.documentHelper.lists,element.blazor__instance.documentHelper.abstractLists);}return result;},getListLength:function getListLength(element){var length=0;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){if(this.documentHelper.owner.documentHelper.lists.length>0){length=this.documentHelper.owner.documentHelper.lists[this.documentHelper.owner.documentHelper.lists.length-1].listId+1;}}return length;},getAbstractListLength:function getAbstractListLength(element){var length=0;if(this.documentHelper.owner.documentHelper.abstractLists.length>0){length=this.documentHelper.owner.documentHelper.abstractLists[this.documentHelper.owner.documentHelper.abstractLists.length-1].abstractListId+1;}return length;},getListLevel:function getListLevel(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.getListLevel(element.blazor__instance.selection.start.paragraph);}return result;},getListLevelPattern:function getListLevelPattern(element,listLevelNumber){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.documentHelper.layout.getListLevelPattern(listLevelNumber);}return result;},setListLevelPattern:function setListLevelPattern(element,listLevelNumber){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){///element.blazor__instance.documentHelper.layout.setli;
}},applyListProperties:function applyListProperties(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.paragraphFormat.setList(val);}},//Page setup dialog
applyPageSetupProperties:function applyPageSetupProperties(element,format){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){var sectionFormat=new WSectionFormat();if(!sf.base.isNullOrUndefined(format)){sectionFormat.topMargin=format.topMargin;sectionFormat.bottomMargin=format.bottomMargin;sectionFormat.leftMargin=format.leftMargin;sectionFormat.rightMargin=format.rightMargin;sectionFormat.pageHeight=format.pageHeight;sectionFormat.pageWidth=format.pageWidth;sectionFormat.footerDistance=format.footerDistance;sectionFormat.headerDistance=format.headerDistance;sectionFormat.differentFirstPage=format.differentFirstPage;sectionFormat.differentOddAndEvenPages=format.differentOddAndEvenPages;}element.blazor__instance.editor.onApplySectionFormat(undefined,sectionFormat);}},//paragraph dialog
applyParagraphFormat:function applyParagraphFormat(element,paragraphFormat){var paraFormat=new WParagraphFormat();if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){if(!sf.base.isNullOrUndefined(paragraphFormat)){paraFormat.leftIndent=paragraphFormat.leftIndent;paraFormat.rightIndent=paragraphFormat.rightIndent;paraFormat.firstLineIndent=paragraphFormat.firstLineIndent;paraFormat.lineSpacing=paragraphFormat.lineSpacing;paraFormat.lineSpacingType=paragraphFormat.lineSpacingType;paraFormat.textAlignment=paragraphFormat.textAlignment;paraFormat.beforeSpacing=paragraphFormat.beforeSpacing;paraFormat.afterSpacing=paragraphFormat.afterSpacing;paraFormat.bidi=paragraphFormat.bidi;paraFormat.keepWithNext=paragraphFormat.keepWithNext;paraFormat.keepLinesTogether=paragraphFormat.keepLinesTogether;paraFormat.widowControl=paragraphFormat.widowControl;paraFormat.contextualSpacing=paragraphFormat.contextualSpacing;}element.blazor__instance.editor.onParagraphFormat(paraFormat);}},//styles dialog
getStyleName:function getStyleName(element,styleType){var style;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){style=element.blazor__instance.getStyleNames(styleType);}return style;},getStyles:function getStyles(element,styleType){var style;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){style=element.blazor__instance.getStyles(styleType);}return style;},findByName:function findByName(element,styleType){var style={};if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){style=element.blazor__instance.documentHelper.styles.findByName(styleType);}style=element.blazor__instance.fetchStyleValue(style);return style;},layoutWholeDocument:function layoutWholeDocument(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.layoutWholeDocument();}},shiftingEnableDisable:function shiftingEnableDisable(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.isShiftingEnabled=val;}},updateStyleValues:function updateStyleValues(element,tmpStyle){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.documentHelper.styles.push(tmpStyle);}},setCharStyleName:function setCharStyleName(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.characterFormat.styleName=val;}},setParaStyleName:function setParaStyleName(element,val){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.paragraphFormat.styleName=val;}},getCharStyleName:function getCharStyleName(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.characterFormat.styleName;}return result;},getParaStyleName:function getParaStyleName(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.paragraphFormat.styleName;}return result;},//Bookmark dialog
gotoBookmark:function gotoBookmark(element,name){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.selectBookmark(name);}},deleteBookmark:function deleteBookmark(element,name){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editorModule.deleteBookmark(name);}},//Borders and shading dialog
applyBorderAndShading:function applyBorderAndShading(element,applyTo,border,shading){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){if(applyTo==='Table'){element.blazor__instance.editorModule.applyBordersInternal(element.blazor__instance.selection.tableFormat.table.tableFormat.borders,border);element.blazor__instance.editorModule.applyShading(element.blazor__instance.selection.tableFormat.table.tableFormat.shading,shading);}else{element.blazor__instance.editorModule.applyBordersInternal(element.blazor__instance.selection.start.paragraph.associatedCell.cellFormat.borders,border);element.blazor__instance.editorModule.applyShading(element.blazor__instance.selection.start.paragraph.associatedCell.cellFormat.shading,shading);}}},//Text form field dialog
insertFormField:function insertFormField(element,Type){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.insertFormField(Type);}},insertTextFormField:function insertTextFormField(element,formField){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){var field=new TextFormField();field.type=formField.type;field.name=formField.name;field.enabled=formField.enabled;field.helpText=formField.helpText;field.statusText=formField.statusText;field.maxLength=formField.maxLength;field.defaultValue=formField.defaultValue;field.format=formField.format;element.blazor__instance.editorModule.editFormField('Text',field);}},//Check box form field dialog
insertCheckBoxFormField:function insertCheckBoxFormField(element,formField){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){var field=new CheckBoxFormField();field.name=formField.name;field.enabled=formField.enabled;field.helpText=formField.helpText;field.sizeType=formField.sizeType;field.size=formField.size;field.defaultValue=formField.defaultValue;element.blazor__instance.editorModule.editFormField('CheckBox',field);}},//Drop down form field dialog
insertDropDownFormField:function insertDropDownFormField(element,formField){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){var field=new DropDownFormField();field.name=formField.name;field.enabled=formField.enabled;field.helpText=formField.helpText;field.statusText=formField.statusText;field.dropdownItems=formField.dropdownItems.slice();field.selectedIndex=formField.selectedIndex;element.blazor__instance.editorModule.editFormField('DropDown',field);}},//form field popup dialog
getCurrentField:function getCurrentField(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.getCurrentFormField();}return JSON.stringify(result.formFieldData);},updateFormFieldValue:function updateFormFieldValue(element,value){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){var formField=element.blazor__instance.selection.getCurrentFormField();if(formField){element.blazor__instance.editorModule.updateFormField(formField,value);}}},onCharacterFormat:function onCharacterFormat(element,result){var format=new WCharacterFormat();if(!sf.base.isNullOrUndefined(result)){format.bold=result.bold;format.fontSize=result.fontSize;format.fontFamily=result.fontFamily;format.italic=result.italic;format.baselineAlignment=result.baselineAlignment;format.underline=result.underline;format.fontColor=result.fontColor;format.highlightColor=result.highlightColor;format.strikethrough=result.strikethrough;format.allCaps=result.allCaps;}element.blazor__instance.editor.initHistory('CharacterFormat');if(element.blazor__instance.selection.isEmpty){if(element.blazor__instance.selection.start.offset===element.blazor__instance.selection.getParagraphLength(element.blazor__instance.selection.start.paragraph)){element.blazor__instance.editor.applyCharFormatValueInternal(element.blazor__instance.selection,element.blazor__instance.selection.start.paragraph.characterFormat,undefined,format);element.blazor__instance.editor.reLayout(element.blazor__instance.selection);}return;}else{//Iterate and update formating.
element.blazor__instance.editor.setOffsetValue(element.blazor__instance.selection);element.blazor__instance.editor.updateSelectionCharacterFormatting('CharacterFormat',format,false);}},//Table properties    
//cell option
applyCellOption:function applyCellOption(element,format){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){var cellFormat=new WCellFormat();if(!sf.base.isNullOrUndefined(format)){cellFormat.topMargin=format.topMargin;cellFormat.bottomMargin=format.bottomMargin;cellFormat.leftMargin=format.leftMargin;cellFormat.rightMargin=format.rightMargin;}element.blazor__instance.applyCellOption(cellFormat);}},//Table option
applyTableOption:function applyTableOption(element,format){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){var tableFormat=new WTableFormat();if(!sf.base.isNullOrUndefined(format)){tableFormat.topMargin=format.topMargin;tableFormat.bottomMargin=format.bottomMargin;tableFormat.leftMargin=format.leftMargin;tableFormat.rightMargin=format.rightMargin;}element.blazor__instance.applyTableOption(tableFormat);}},applyTableProperties:function applyTableProperties(element,tableFormat,rowFormat,cellFormat){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editorModule.initComplexHistory('TableProperties');if(tableFormat){var tableProperties=new WTableFormat();if(tableFormat.cellSpacing){tableProperties.cellSpacing=tableFormat.cellSpacing;}if(tableFormat.leftMargin)tableProperties.leftMargin=tableFormat.leftMargin;if(tableFormat.topMargin)tableProperties.topMargin=tableFormat.topMargin;if(tableFormat.rightMargin)tableProperties.rightMargin=tableFormat.rightMargin;if(tableFormat.bottomMargin)tableProperties.bottomMargin=tableFormat.bottomMargin;if(tableFormat.leftIndent)tableProperties.leftIndent=tableFormat.leftIndent;if(tableFormat.tableAlignment)tableProperties.tableAlignment=tableFormat.tableAlignment;if(tableFormat.preferredWidth)tableProperties.preferredWidth=tableFormat.preferredWidth;if(tableFormat.preferredWidthType)tableProperties.preferredWidthType=tableFormat.preferredWidthType;if(tableFormat.bidi)tableProperties.bidi=tableFormat.bidi;element.blazor__instance.editorModule.onTableFormat(tableProperties);}if(rowFormat){var rowProperties=new WRowFormat();if(rowFormat.isHeader){rowProperties.isHeader=rowFormat.isHeader;}if(rowFormat.allowBreakAcrossPages){rowProperties.allowBreakAcrossPages=rowFormat.allowBreakAcrossPages;}if(rowFormat.height){rowProperties.height=rowFormat.height;}if(rowFormat.heightType){rowProperties.heightType=rowFormat.heightType;}element.blazor__instance.editorModule.onRowFormat(rowFormat);}if(cellFormat){var cellProperties=new WCellFormat();if(cellFormat.leftMargin){cellProperties.leftMargin=cellFormat.leftMargin;}if(cellFormat.topMargin){cellProperties.topMargin=cellFormat.topMargin;}if(cellFormat.bottomMargin){cellProperties.bottomMargin=cellFormat.bottomMargin;}if(cellFormat.rightMargin){cellProperties.rightMargin=cellFormat.rightMargin;}element.blazor__instance.editorModule.onCellFormat(cellProperties);}element.blazor__instance.editorHistory.updateComplexHistory();}},// Table Properties 
enableRepeatHeader:function enableRepeatHeader(element){var val;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){val=element.blazor__instance.enableRepeatHeader();}return val;},RowFormatIsInHeader:function RowFormatIsInHeader(element){var val;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){val=element.blazor__instance.documentHelper.selection.rowFormat.isHeader;}return val;},applyShading:function applyShading(element,value){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.cellFormat.background=value;}},applyBorder:function applyBorder(element,value,size,color){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.applyBorders(this.getBorder(value,size,color));}},getBorder:function getBorder(value,borderSize,color){var linestyle=borderSize===0?'Cleared':'Single';var borderSettings={type:value,borderColor:color,lineWidth:borderSize,borderStyle:linestyle};return borderSettings;},initTrackChangesPane:function initTrackChangesPane(element){element.blazor__instance.trackChangesPane.initTrackChangePane();},sortByUser:function sortByUser(element,userName){element.blazor__instance.trackChangesPane.onUserSelect(userName);},sortByRevision:function sortByRevision(element,revisionType){element.blazor__instance.trackChangesPane.onTypeSelect(revisionType);},acceptOrRejectChanges:function acceptOrRejectChanges(element,type){element.blazor__instance.trackChangesPane.onMenuSelect(type);},navigatePreviousRevision:function navigatePreviousRevision(element){element.blazor__instance.selection.navigatePreviousRevision();},navigateNextChanges:function navigateNextChanges(element){element.blazor__instance.selection.navigateNextRevision();},getHyperlinkField:function getHyperlinkField(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){var fieldBegin=element.blazor__instance.selection.getHyperlinkField();var displayText="";var link="";if(!sf.base.isNullOrUndefined(fieldBegin.fieldSeparator)){var format=undefined;// tslint:disable-next-line:max-line-length
var fieldObj=element.blazor__instance.selection.getHyperlinkDisplayText(fieldBegin.fieldSeparator.line.paragraph,fieldBegin.fieldSeparator,fieldBegin.fieldEnd,false,format);displayText=fieldObj.displayText;}link=element.blazor__instance.selection.getLinkText(fieldBegin);return JSON.stringify({'displayText':displayText,'link':link});}return"";},isTableSelected:function isTableSelected(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){return element.blazor__instance.selection.isTableSelected();}return false;},getPageCount:function getPageCount(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){return element.blazor__instance.pageCount;}return 1;},getContextType:function getContextType(element){var contextTypeInternal='';if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){contextTypeInternal=element.blazor__instance.selection.contextType;}return contextTypeInternal;},//#region New Methods
copy:function copy(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.copy();}},cut:function cut(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editor.cut();}},pasteInternal:function pasteInternal(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){if(!element.blazor__instance.isReadOnlyMode){element.blazor__instance.editorModule.pasteInternal(undefined);}}},updateField:function updateField(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){var isReadOnly=element.blazor__instance.isReadOnlyMode;if(element.blazor__instance.selection.isReferenceField()&&(!isReadOnly||isReadOnly&&element.blazor__instance.documentHelper.protectionType==='FormFieldsOnly')){element.blazor__instance.selection.updateRefField();}else{element.blazor__instance.editorModule.updateToc();}}},navigateHyperlink:function navigateHyperlink(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.navigateHyperlink();}},copyHyperlink:function copyHyperlink(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.copyHyperlink();}},applyContinueNumbering:function applyContinueNumbering(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editorModule.applyContinueNumbering();}},applyRestartNumbering:function applyRestartNumbering(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.editorModule.applyRestartNumbering(element.blazor__instance.selection);}},handleAcceptReject:function handleAcceptReject(element,value){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.handleAcceptReject(value);}},spellCheck:function spellCheck(element,value,item){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){var expectedData=element.blazor__instance.element.id+value;if(item.substring(0,expectedData.length)===expectedData){var content=item.substring(item.lastIndexOf('_')+1);if(content==='Add To Dictionary'){//element.blazor__instance.documentHelper.owner.();
}else if(content==='Ignore All'){this.spellChecker.handleIgnoreAllItems();}else{this.spellChecker.manageReplace(content);}}else{element.blazor__instance.fireCustomContextMenuSelect(item);}}},checkEmpty:function checkEmpty(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.selection.isEmpty;}return result;},checkReadOnly:function checkReadOnly(element){var result;if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){result=element.blazor__instance.isReadOnlyMode;}return result;},hasRevision:function hasRevision(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){return element.blazor__instance.selection.hasRevisions();}return false;},isContentProtected:function isContentProtected(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){var documentEditor=element.blazor__instance;var isProtectedDocument=documentEditor.documentHelper.isDocumentProtected;var allowFormatting=isProtectedDocument&&documentEditor.documentHelper.restrictFormatting;var isSelectionInProtectecRegion=documentEditor.editor.restrictEditing;var isReadOnly=documentEditor.isReadOnly;var protectionType=documentEditor.documentHelper.protectionType;var protectionInfo={isDocumentProtected:isProtectedDocument,allowFormatting:allowFormatting,isInProtectecRegion:isSelectionInProtectecRegion,isReadOnly:isReadOnly,protectionType:protectionType};return JSON.stringify(protectionInfo);}return"";},clearSelectionHighlight:function clearSelectionHighlight(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.documentHelper.clearSelectionHighlight();}},onIgnore:function onIgnore(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){if(!sf.base.isNullOrUndefined(this.info.element)){//show spinner
var instance=element.blazor__instance;instance.spellChecker.manageReplace('Ignore Once',this.info.element);this.removeErrors(element);instance.spellChecker.checkForNextError();}}},removeErrors:function removeErrors(element){var instance=element.blazor__instance;if(!sf.base.isNullOrUndefined(this.info.text)&&instance.spellChecker.errorWordCollection.containsKey(this.info.text)){var textElement=instance.spellChecker.errorWordCollection.get(this.info.text);textElement.splice(0,1);if(textElement.length===0){instance.spellChecker.errorWordCollection.remove(this.info.text);}}if(instance.spellChecker.errorWordCollection.length===0){//hide dialog
}},onIgnoreAll:function onIgnoreAll(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){var instance=element.blazor__instance;if(!sf.base.isNullOrUndefined(this.info.element)){//show spinner
var text=this.info.element.text;instance.spellChecker.handleIgnoreAllItems({element:this.info.element,text:text});instance.spellChecker.checkForNextError();}}},addToDictionary:function addToDictionary(element){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){if(sf.base.isNullOrUndefined(this.info.element)){var instance=element.blazor__instance;instance.spellChecker.handleAddToDictionary({element:this.info.element,text:this.info.element.text});if(instance.spellChecker.errorWordCollection.containsKey(this.info.text)){instance.spellChecker.errorWordCollection.remove(this.info.text);}}}},onChange:function onChange(element,selectedText){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){if(!sf.base.isNullOrUndefined(selectedText)){//Show Spinner
this.isSpellChecking=true;var instance=element.blazor__instance;instance.spellChecker.manageReplace(selectedText,this.info.element);this.removeErrors(element);instance.spellChecker.checkForNextError();// this.documentHelper.dialog.content = '';
}}},onChangeAll:function onChangeAll(element,selectedText){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){if(!sf.base.isNullOrUndefined(selectedText)){//Show Spinner
this.isSpellChecking=true;var instance=element.blazor__instance;var elements=instance.spellChecker.errorWordCollection.get(this.info.text);for(var i=0;i<elements.length;i++){if(elements[i]instanceof ErrorTextElementBox&&!elements[i].ischangeDetected){instance.spellChecker.manageReplace(selectedText,elements[i]);}else if(elements[i]instanceof TextElementBox){var matchResults=instance.spellChecker.getMatchedResultsFromElement(elements[i]);var results=matchResults.textResults;// tslint:disable-next-line:max-line-length
var markIndex=elements[i].ischangeDetected?elements[i].start.offset:elements[i].line.getOffset(elements[i],0);// tslint:disable-next-line:max-line-length
instance.searchModule.textSearch.updateMatchedTextLocation(matchResults.matches,results,matchResults.elementInfo,0,elements[i],false,null,markIndex);for(var j=0;j<results.length;j++){var element_1=instance.spellChecker.createErrorElementWithInfo(results.innerList[j],elements[i]);instance.spellChecker.manageReplace(selectedText,element_1);}}}if(instance.spellChecker.errorWordCollection.containsKey(this.info.text)){instance.spellChecker.errorWordCollection.remove(this.info.text);}instance.spellChecker.checkForNextError();// this.documentHelper.dialog.content = '';
}}},getErrorString:function getErrorString(element){var error=[];if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){if(this.info.text){error.push(this.info.text);}}return error;},getSuggestionsString:function getSuggestionsString(element){var suggestions=[];var error=this.info.text;if(this.isSpellChecking){this.isSpellChecking=false;}if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){if(this.info.text){error=element.blazor__instance.spellChecker.manageSpecialCharacters(error,undefined,true);// tslint:disable-next-line:max-line-length
suggestions=element.blazor__instance.spellChecker.errorSuggestions.containsKey(error)?element.blazor__instance.spellChecker.errorSuggestions.get(error):[];}}return suggestions;},hasElementBox:function hasElementBox(element){var isElementBox=false;var instance=element.blazor__instance;this.info=instance.spellChecker.findCurretText();if(this.info.element){isElementBox=true;instance.spellChecker.currentContextInfo=this.info;this.info=instance.spellChecker.retriveText();}return isElementBox;},invokeMethod:function invokeMethod(element,methodName,moduleName,args){return __awaiter(this,void 0,void 0,function(){var returnValue,comp,e_1;return __generator(this,function(_a){switch(_a.label){case 0:_a.trys.push([0,4,,5]);returnValue=null;comp=element.blazor__instance;if(!comp)return[3/*break*/,3];if(moduleName===null){returnValue=comp[methodName].apply(comp,args);}else{comp=element.blazor__instance;comp=this.getChildModule(comp,moduleName);returnValue=comp[methodName].apply(comp,args);}if(returnValue&&_typeof(returnValue)==="object"&&!(returnValue instanceof Promise)){returnValue=this.cleanStringify(returnValue);}if(!(methodName=='saveAsBlob'&&returnValue instanceof Promise))return[3/*break*/,2];return[4/*yield*/,this.promiseHandler(returnValue)];case 1:returnValue=_a.sent();_a.label=2;case 2:return[2/*return*/,returnValue];case 3:return[3/*break*/,5];case 4:e_1=_a.sent();return[2/*return*/,this.throwError(e_1,comp)];case 5:return[2/*return*/,{}];}});});},promiseHandler:function promiseHandler(returnValue){return __awaiter(this,void 0,void 0,function(){var object;return __generator(this,function(_a){switch(_a.label){case 0:object=this;if(!(returnValue instanceof Promise))return[3/*break*/,2];return[4/*yield*/,returnValue.then(function(data){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4/*yield*/,object.docEditFileReader(data).then(function(dataUrl){returnValue=JSON.stringify({"data":dataUrl.substr(dataUrl.indexOf(',')+1)});})];case 1:_a.sent();return[2/*return*/];}});});})];case 1:_a.sent();_a.label=2;case 2:return[2/*return*/,returnValue];}});});},docEditFileReader:function docEditFileReader(file){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2/*return*/,new Promise(function(resolve,reject){var fileReader=new FileReader();fileReader.onload=function(){resolve(fileReader.result);};fileReader.readAsDataURL(file);})];});});},getMethodCall:function getMethodCall(element,moduleName,methodName){try{var comp=element.blazor__instance;if(moduleName==null||moduleName=="null"){return comp[methodName];}else{comp=this.getChildModule(comp,moduleName);return comp[methodName];}}catch(e){this.throwError(e,comp);}},setMethodCall:function setMethodCall(element,moduleName,methodName,args){try{var comp=element.blazor__instance;comp=this.getChildModule(comp,moduleName);comp[methodName]=args[0];}catch(e){this.throwError(e,comp);}},cleanStringify:function cleanStringify(object){try{return JSON.stringify(object);}catch(e){console.log(e);return'';}},getChildModule:function getChildModule(comp,moduleName){try{var path=moduleName.split(',');for(var i=0;i<path.length;i++){comp=comp[path[i]];}return comp;}catch(e){}return comp;},insertNotes:function insertNotes(element,type){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){if(type==="Footnote"){element.blazor__instance.editor.insertFootnote();}else{element.blazor__instance.editor.insertEndnote();}}},pasteOptions:function pasteOptions(element,type){if(!sf.base.isNullOrUndefined(element)&&!sf.base.isNullOrUndefined(element.blazor__instance)){element.blazor__instance.selection.pasteOptions(type);}},modifyStyle:function modifyStyle(element,styleName,styleData,basedOn,followStyle,type,isEdit){var documentHelper=element.blazor__instance.documentHelper;var styleObject=styleData;if(styleName.length>0){var style=documentHelper.styles.findByName(styleName);var name_1;if(!sf.base.isNullOrUndefined(style)){style.type=type==='Character'?'Character':'Paragraph';style.basedOn=documentHelper.styles.findByName(basedOn);if(styleObject.type==='Paragraph'||styleObject.type.indexOf('Linked(Paragraph and Character)')!==-1){style.next=documentHelper.styles.findByName(styleObject.next);element.blazor__instance.parser.parseCharacterFormat(styleObject.characterFormat,style.characterFormat,false);element.blazor__instance.parser.parseParagraphFormat(styleObject.paragraphFormat,style.paragraphFormat);style.link=type.indexOf('Linked(Paragraph and Character)')!==-1?this.createLinkStyle(documentHelper,styleName,style,isEdit):undefined;}documentHelper.owner.isShiftingEnabled=true;documentHelper.owner.editorModule.layoutWholeDocument();documentHelper.owner.isShiftingEnabled=false;}else{var tmpStyle=type==='Character'?new WCharacterStyle():new WParagraphStyle();var format=new WCharacterFormat();if(!sf.base.isNullOrUndefined(styleObject.characterFormat)){format.bold=styleObject.characterFormat.bold;format.fontSize=styleObject.characterFormat.fontSize;format.fontFamily=styleObject.characterFormat.fontFamily;format.italic=styleObject.characterFormat.italic;format.baselineAlignment=styleObject.characterFormat.baselineAlignment;format.underline=styleObject.characterFormat.underline;format.fontColor=styleObject.characterFormat.fontColor;format.highlightColor=styleObject.characterFormat.highlightColor;format.strikethrough=styleObject.characterFormat.strikethrough;format.allCaps=styleObject.characterFormat.allCaps;}styleObject.characterFormat=format;var paraFormat=new WParagraphFormat();if(!sf.base.isNullOrUndefined(styleObject.paragraphFormat)){paraFormat.leftIndent=styleObject.paragraphFormat.leftIndent;paraFormat.rightIndent=styleObject.paragraphFormat.rightIndent;paraFormat.firstLineIndent=styleObject.paragraphFormat.firstLineIndent;paraFormat.lineSpacing=styleObject.paragraphFormat.lineSpacing;paraFormat.lineSpacingType=styleObject.paragraphFormat.lineSpacingType;paraFormat.textAlignment=styleObject.paragraphFormat.textAlignment;paraFormat.beforeSpacing=styleObject.paragraphFormat.beforeSpacing;paraFormat.afterSpacing=styleObject.paragraphFormat.afterSpacing;paraFormat.bidi=styleObject.paragraphFormat.bidi;paraFormat.contextualSpacing=styleObject.paragraphFormat.contextualSpacing;}styleObject.paragraphFormat=paraFormat;tmpStyle.copyStyle(styleObject);var basedOnInfo=documentHelper.styles.findByName(basedOn);if(type==='Paragraph'||type==='Linked(Paragraph and Character)'){if(styleName===followStyle){tmpStyle.next=tmpStyle;}else{tmpStyle.next=documentHelper.styles.findByName(followStyle);}}tmpStyle.link=type==='Linked(Paragraph and Character)'?this.createLinkStyle(styleName):undefined;tmpStyle.type=type==='Character'?'Character':'Paragraph';tmpStyle.name=styleName;tmpStyle.basedOn=basedOnInfo;documentHelper.styles.push(tmpStyle);name_1=styleName;documentHelper.owner.editorModule.applyStyle(name_1);}documentHelper.updateFocus();}else{throw new Error('Enter valid Style name');}documentHelper.updateFocus();},createLinkStyle:function createLinkStyle(documentHelper,name,style,isEdit){var charStyle;if(isEdit){charStyle=documentHelper.styles.findByName(name+' Char','Character');}else{charStyle=new WCharacterStyle();}charStyle.type='Character';charStyle.name=name+' Char';charStyle.characterFormat=style.characterFormat.cloneFormat();charStyle.basedOn=style.basedOn;if(!isEdit){documentHelper.styles.push(charStyle);}return documentHelper.styles.findByName(charStyle.name,'Character');},updateParagraphDialogHeight:function updateParagraphDialogHeight(element,dialogObject,target){//Update dialog height
var dialogElement=document.getElementById(dialogObject.id);var header=dialogElement.getElementsByClassName('e-dlg-header-content')[0];var contentElement=dialogElement.getElementsByClassName('e-dlg-content')[0];var footer=dialogElement.getElementsByClassName('e-footer-content')[0];var contentStyle=getComputedStyle(contentElement);var dialogStyle=getComputedStyle(dialogElement);var paddingTop=parseInt(contentStyle.paddingTop);var paddingBottom=parseInt(contentStyle.paddingBottom);var paddingVertical=(isNaN(paddingTop)?0:paddingTop)+(isNaN(paddingBottom)?0:paddingBottom);var borderTop=parseInt(dialogStyle.borderTop);var borderBottom=parseInt(dialogStyle.borderBottom);var borderVertical=(isNaN(borderTop)?0:borderTop)+(isNaN(borderBottom)?0:borderBottom);var contentHeight=dialogElement.offsetHeight-(header.offsetHeight+footer.offsetHeight+paddingVertical+borderVertical);target.style.height=contentHeight+'px';//Get dialog width
var paddingLeft=parseInt(contentStyle.paddingLeft);var paddingRight=parseInt(contentStyle.paddingRight);var paddingHorizontal=(isNaN(paddingLeft)?0:paddingLeft)+(isNaN(paddingRight)?0:paddingRight);var borderLeft=parseInt(dialogStyle.borderLeft);var borderRight=parseInt(dialogStyle.borderRight);var borderHorizontal=(isNaN(borderLeft)?0:borderLeft)+(isNaN(borderRight)?0:borderRight);var contentWidth=dialogElement.offsetWidth-(paddingHorizontal+borderHorizontal);return contentWidth;},getDocumentEditorElementHeight:function getDocumentEditorElementHeight(element){return element.offsetHeight;},getTablePropertiesPaneHeight:function getTablePropertiesPaneHeight(element){var tabHeaderHeight=element.getElementsByClassName('e-tab-header')[0];if(tabHeaderHeight){return element.offsetHeight-tabHeaderHeight.offsetHeight+'px';}return'auto';}};return DocumentEditor;}();

/***/ })

/******/ });